"use strict";let At=Object.create;let Me=Object.defineProperty;let Lt=Object.getOwnPropertyDescriptor;let It=Object.getOwnPropertyNames;let Dt=Object.getPrototypeOf,Bt=Object.prototype.hasOwnProperty;let Ot=(n,e,t)=>e in n?Me(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;let Ut=(n,e)=>()=>(e||n((e={exports:{}}).exports,e),e.exports);let Nt=(n,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of It(e))!Bt.call(n,o)&&o!==t&&Me(n,o,{get:()=>e[o],enumerable:!(r=Lt(e,o))||r.enumerable});return n};let _t=(n,e,t)=>(t=n!=null?At(Dt(n)):{},Nt(e||!n||!n.__esModule?Me(t,"default",{value:n,enumerable:!0}):t,n));let O=(n,e,t)=>(Ot(n,typeof e!="symbol"?e+"":e,t),t);let gt=Ut((pr,Ue)=>{(function(){"use strict";let n={fatal:!0},e=[new TextDecoder("iso-8859-15",n),new TextDecoder("utf-8",n),new TextDecoder("sjis",n),new TextDecoder("euc-jp",n),new TextDecoder("ascii")],t={debug:!1,parse:function(r,o){if(r instanceof Uint8Array)return t.Uint8(r);if(typeof r=="string")return t.Base64(r);if(r instanceof HTMLElement&&r.type==="file")return t.addListener(r,o);throw new Error("MidiParser.parse() : Invalid input provided")},addListener:function(r,o){if(!File||!FileReader)throw new Error("The File|FileReader APIs are not supported in this browser. Use instead MidiParser.Base64() or MidiParser.Uint8()");if(r===void 0||!(r instanceof HTMLElement)||r.tagName!=="INPUT"||r.type.toLowerCase()!=="file")return console.warn("MidiParser.addListener() : Provided element is not a valid FILE INPUT element"),!1;o=o||function(){},r.addEventListener("change",function(f){if(!f.target.files.length)return!1;console.log("MidiParser.addListener() : File detected in INPUT ELEMENT processing data..");let p=new FileReader;p.readAsArrayBuffer(f.target.files[0]),p.onload=function(g){o(t.Uint8(new Uint8Array(g.target.result)))}})},Base64:function(r){let o=function(g){let b="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";if(g=g.replace(/^.*?base64,/,""),g=String(g).replace(/[\t\n\f\r ]+/g,""),!/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/.test(g))throw new TypeError("Failed to execute _atob() : The string to be decoded is not correctly encoded.");g+="==".slice(2-(3&g.length));let k,C="",a,s,c=0;for(;c<g.length;)k=b.indexOf(g.charAt(c++))<<18|b.indexOf(g.charAt(c++))<<12|(a=b.indexOf(g.charAt(c++)))<<6|(s=b.indexOf(g.charAt(c++))),C+=a===64?String.fromCharCode(k>>16&255):s===64?String.fromCharCode(k>>16&255,k>>8&255):String.fromCharCode(k>>16&255,k>>8&255,255&k);return C}(r=String(r));let f=o.length;let p=new Uint8Array(new ArrayBuffer(f));for(let g=0;g<f;g++)p[g]=o.charCodeAt(g);return t.Uint8(p)},Uint8:function(p){let o={data:null,pointer:0,movePointer:function(a){return this.pointer+=a,this.pointer},readInt:function(a){if((a=Math.min(a,this.data.byteLength-this.pointer))<1)return-1;let s=0;if(1<a)for(let c=1;c<=a-1;c++)s+=this.data.getUint8(this.pointer)*Math.pow(256,a-c),this.pointer++;return s+=this.data.getUint8(this.pointer),this.pointer++,s},readStr:function(a){let s=new Uint8Array(a),c=!1,i;s.forEach((d,l)=>{s[l]=this.readInt(1)});for(let d=0;d<e.length;d++)if(!c)try{if(i=e[d].decode(s),d===0)for(let l=0;l<i.length;l++){let h=i.charCodeAt(l);if(h>191||h>127&&h<160)throw new RangeError(`Invalid code point: ${h}`)}c=!0,console.debug(`String byte sequence in ${e[d].encoding}`)}catch(l){console.debug(`SMF string ${l}`)}return i||"String byte sequence read failed."},backOne:function(){this.pointer--},readIntVLV:function(){let a=0;if(this.pointer>=this.data.byteLength)return-1;if(this.data.getUint8(this.pointer)<128)a=this.readInt(1);else{let c=[];for(;128<=this.data.getUint8(this.pointer);)c.push(this.readInt(1)-128);let s=this.readInt(1);for(let i=1;i<=c.length;i++)a+=c[c.length-i]*Math.pow(128,i);a+=s}return a}};if(o.data=new DataView(p.buffer,p.byteOffset,p.byteLength),o.readInt(4)!==1297377380)return console.warn("Header validation failed (not MIDI standard or file corrupt.)"),!1;o.readInt(4);let f={};f.formatType=o.readInt(2),f.tracks=o.readInt(2),f.track=[];let p=o.readInt(1),g=o.readInt(1);128<=p?(f.timeDivision=[],f.timeDivision[0]=p-128,f.timeDivision[1]=g):f.timeDivision=256*p+g;for(let a=1;a<=f.tracks;a++){f.track[a-1]={event:[]};let b,k=o.readInt(4);if(k===-1)break;if(k!==1297379947)return!1;o.readInt(4);let s=0,c=!1,i,d;for(;!c&&(s++,f.track[a-1].event[s-1]={},f.track[a-1].event[s-1].deltaTime=o.readIntVLV(),(i=o.readInt(1))!==-1);)if(128<=i?d=i:(i=d,o.movePointer(-1)),i===255){f.track[a-1].event[s-1].type=255,f.track[a-1].event[s-1].metaType=o.readInt(1);let C=o.readIntVLV();switch(f.track[a-1].event[s-1].metaType){case 47:case-1:c=!0;break;case 1:case 2:case 3:case 4:case 5:case 7:case 6:f.track[a-1].event[s-1].data=o.readStr(C);break;case 33:case 89:case 81:f.track[a-1].event[s-1].data=o.readInt(C);break;case 84:f.track[a-1].event[s-1].data=[],f.track[a-1].event[s-1].data[0]=o.readInt(1),f.track[a-1].event[s-1].data[1]=o.readInt(1),f.track[a-1].event[s-1].data[2]=o.readInt(1),f.track[a-1].event[s-1].data[3]=o.readInt(1),f.track[a-1].event[s-1].data[4]=o.readInt(1);break;case 88:f.track[a-1].event[s-1].data=[],f.track[a-1].event[s-1].data[0]=o.readInt(1),f.track[a-1].event[s-1].data[1]=o.readInt(1),f.track[a-1].event[s-1].data[2]=o.readInt(1),f.track[a-1].event[s-1].data[3]=o.readInt(1);break;default:this.customInterpreter!==null&&(f.track[a-1].event[s-1].data=this.customInterpreter(f.track[a-1].event[s-1].metaType,o,C)),this.customInterpreter!==null&&f.track[a-1].event[s-1].data!==!1||(o.readInt(C),f.track[a-1].event[s-1].data=o.readInt(C),this.debug&&console.info("Unimplemented 0xFF meta event! data block readed as Integer"))}}else switch((i=i.toString(16).split(""))[1]||i.unshift("0"),f.track[a-1].event[s-1].type=parseInt(i[0],16),f.track[a-1].event[s-1].channel=parseInt(i[1],16),f.track[a-1].event[s-1].type){case 15:this.customInterpreter!==null&&(f.track[a-1].event[s-1].data=this.customInterpreter(f.track[a-1].event[s-1].type,o,!1)),this.customInterpreter!==null&&f.track[a-1].event[s-1].data!==!1||(b=o.readIntVLV(),f.track[a-1].event[s-1].data=o.readInt(b),this.debug&&console.info("Unimplemented 0xF exclusive events! data block readed as Integer"));break;case 10:case 11:case 14:case 8:case 9:f.track[a-1].event[s-1].data=[],f.track[a-1].event[s-1].data[0]=o.readInt(1),f.track[a-1].event[s-1].data[1]=o.readInt(1);break;case 12:case 13:f.track[a-1].event[s-1].data=o.readInt(1);break;case-1:c=!0;break;default:if(this.customInterpreter!==null&&(f.track[a-1].event[s-1].data=this.customInterpreter(f.track[a-1].event[s-1].metaType,o,!1)),this.customInterpreter===null||f.track[a-1].event[s-1].data===!1)return console.log("Unknown EVENT detected... reading cancelled!"),!1}}return f},customInterpreter:null};if(typeof Ue<"u")Ue.exports=t;else{let r=typeof window=="object"&&window.self===window&&window||typeof self=="object"&&self.self===self&&self||typeof global=="object"&&global.global===global&&global;r.MidiParser=t}})()});let Ye=function(n,e){let t=Math.min(n.length,e.length),r=n.slice(0,t),o=e.slice(0,t),f=0,p=0;for(;p<t&&f==0;)f=Math.sign(r[p]-o[p]),p++;return f},H=function(n=""){this.name=n,this.pool=[],this.point=function(e,t=!1){if(this.pool.length>0){let r=this.pool.length,o=1<<Math.floor(Math.log2(r)),f=o,p=64;for(;o>=1&&p>=0;){if(p<=0)throw new Error("TTL reached.");if(f==r)f-=o;else{let b=Ye(e,this.pool[f]);switch(b){case 0:{p=0;break}case 1:{f+o<=r&&(f+=o);break}case-1:{f!=0&&(f-=o);break}default:console.warn(`Unexpected result ${b}.`)}}o=o>>1,p--}let g=!0;if(f>=this.pool.length)g=!1;else{let b=this;this.pool[f].forEach(function(k,C,a){g&&k!=e[C]&&(g=!1)}),!g&&Ye(e,this.pool[f])>0&&f++}return g||t?f:-1}else return t?0:-1},this.add=function(e,t){return e.data=t,this.pool.splice(this.point(e,!0),0,e),this},this.default=function(e){console.warn(`No match in "${this.name||"(unknown)"}" for "${e}". Default action not defined.`)},this.get=function(e){let t=this.point(e);if(t>-1)return this.pool[t].data;this.default(e)},this.run=function(e,...t){let r=this.point(e);r>-1?e.subarray?this.pool[r].data(e.subarray(this.pool[r].length),...t):this.pool[r].data(e.slice(this.pool[r].length),...t):this.default(e,...t)}};let ge=class{#a={};addEventListener(n,e){this.#a[n]||(this.#a[n]=[]),this.#a[n].unshift(e)}removeEventListener(n,e){if(this.#a[n]){let t=this.#a[n].indexOf(e);t>-1&&this.#a[n].splice(t,1),this.#a[n].length<1&&delete this.#a[n]}}dispatchEvent(n,e){let t=new Event(n),r=this;t.data=e,this.#a[n]?.length>0&&this.#a[n].forEach(function(o){try{o?.call(r,t)}catch(f){console.error(f)}}),this[`on${n}`]&&this[`on${n}`](t)}};let Vt=["MSB","PRG","LSB","NME","ELC","DRM","LVL","VXP"],Xt={krs:"KR",s90es:"ES",motif:"ES"},Ht={krs:"Kr",s90es:"SE",motif:"ME"},j={g2:new Set("gm,GM,g2,G2".split(",")),xg:new Set};for(let n of"XG,MU,AN,AP,DR,DX,PC,PF,SG,VL".split(","))j.xg.add(n),j.xg.add(n.toLowerCase());let Pe=function(n){let e=Math.floor(n/10),t=n%10;return`${e.toString(16)}${t}`},Re=class{HINT_XG_MUBASIC=0;HINT_XG_MU100=1;HINT_XG_PSR=2;#a;get bankInfo(){return this.#a}strictMode=!1;get(n=0,e=0,t=0,r,o=0){let f=[n,e,t],p,g=1,b=0,k,C,a,s=Array.from(arguments);switch(r){case"xg":{switch(n){case 0:{if(o===2)t>>4===7?s[2]+=16:t>>3===13&&(s[2]+=40);else switch(t){case 127:{s[2]=0;break}}break}case 16:{t===126&&(s[2]=0);break}case 32:{t>125&&(s[2]=0),s[2]+=4;break}case 33:{(t>125||t===3)&&(s[2]=0),s[2]+=5;break}case 34:case 35:case 36:{t>125&&(s[2]=0),s[2]+=5;break}case 79:case 80:case 81:case 82:case 83:case 84:s[0]+=16;case 95:case 96:case 97:case 98:case 99:case 100:{t===126&&(s[2]=0);break}case 48:case 64:case 126:case 127:{t===126&&(n===127&&e===0||(s[2]=0));break}case 121:{switch(t){case 126:{s[2]=0;break}case 16:{s[2]=15;break}default:s[2]=s[2]&15}break}}break}case"gs":case"sc":{n===0&&t<5?s[0]=49:n<128&&n>125&&t<5&&t!==2&&(s[2]=n,s[0]=49);break}case"mt32":{n===0&&(s[0]=49);break}case"sd":{switch(n){case 121:{s[0]=96;break}case 120:{s[0]=104;break}}s[0]>>1===40?s[2]|=16:s[0]>95&&s[0]<100&&(s[2]|=16,e>>4===7&&(s[0]=96));break}case"pa":{switch(n){case 120:{t==64?s[2]=2:s[2]=1;break}case 121:{switch(t){case 127:{s[2]=79;break}default:s[2]=(s[2]&63)+32}break}}break}case"g2":{n>>1===40?s[2]|=16:n>95&&n<100&&(s[2]|=16,e>>4===7&&(s[0]=96));break}case"sg":{n===8&&t===0&&(s[2]=5);break}case"05rw":case"x5d":{n&&n<56&&(s[0]=56);break}case"s90es":case"motif":case"an1x":case"cs1x":case"cs6x":{if(n===0)break;switch(n){case 63:{switch(r){case"s90es":{t<8?s[2]+=17:t<32?s[2]+=13:s[2]=(s[2]>>3)+19;break}case"motif":{t<8?s[2]+=28:t<32?s[2]+=13:s[2]=(s[2]>>3)+19;break}case"cs1x":{switch(t>>1){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:case 10:{s[2]+=34;break}case 32:{s[2]=34+((t&1)<<2);break}case 33:{s[2]=47+((t&1)<<2);break}case 61:{s[2]=34+((t&1)<<2);break}case 62:{s[2]=47+((t&1)<<2);break}}break}}break}case 32:{t>125&&(s[2]=0),s[2]+=4;break}case 33:{(t>125||t===3)&&(s[2]=0),s[2]+=5;break}case 34:case 35:case 36:{t>125&&(s[2]=0),s[2]+=5;break}case 79:case 80:case 81:case 82:case 83:case 84:s[0]+=16;case 95:case 96:case 97:case 98:case 99:case 100:{t===126&&(s[2]=0);break}}break}}let c=" ",i="M",d="",l=0,h=0;switch(s[0]){case 0:{switch(s[2]){case 127:{i="GM-a";break}case 126:{i="GM-n";break}case 7:{i="GM-k",d="GLX";break}case 5:{i="SG-a",d="000";break}case 4:{r==="gs"||r==="sc"?(i="GM-a",d="000"):(i="SP-l",d="C/M");break}case 3:case 2:case 1:{(r==="gs"||r==="sc")&&(i="GM-a",d="000");break}case 0:{i="GM-a";break}default:i="y",l=3}break}case 8:{r==="sg"?i="GM-s":i="r:";break}case 32:case 33:case 34:case 35:case 36:{r==="xg"&&(i=`${["AP","VL","PF","DX","AN"][n&7]}-${"abcdefgh"[t]}`,l=3);break}case 48:{d=`M${(s[2]>>3).toString().padStart(2,"0")}`,i=`y${d}`,l=1;break}case 49:{s[2]>>1===63?(i=`MT-${"ba"[s[2]&1]}`,d=`C${"-/"[s[2]&1]}M`):(i="GM-a",d="000");break}case 56:{i="GM-b";break}case 57:i=["yDOC","QY10","QY20"][s[2]-112]||"yMxv",d=["DOC","QY1","QY2"][s[2]-112]||"057";case 61:case 128:{i="rDrm";break}case 120:{i="gDrm";break}case 62:{i="kDrm";break}case 63:{if(s[2]<17){let w=s[2];i=w<10?"kP:":"kC:",i+=w%10}else if(s[2]<34)i=["Pre1","Pre2","Pre3","Pre4","Usr1","Usr2","DrmP","DrmU","Plg1","Plg2","Plg3","Pre1","Pre2","Pre3","Pre4","Pre5","Pre6"][s[2]-17];else if(s[2]<55){let w=s[2]-34;switch(w>12&&w--,t>>1){case 32:case 33:{i=`Pr${t-63}U`;break}case 61:case 62:{i=`Pr${t-121}U`;break}default:i=s[2]===46?"PrDr":`Pr${(w>>2)+1}${String.fromCharCode(65+(w&3))}`}}else i="Ds";l=1;break}case 64:{i="ySFX",d="SFX";break}case 67:{i="DX:S";break}case 80:case 81:case 82:case 83:{i=`Prg${"UABC"[s[0]-80]}`;break}case 88:case 89:case 90:case 91:{i=`Cmb${"UABC"[s[0]-88]}`;break}case 95:{i=`${["DR","PC"][s[2]]}-d`;break}case 96:{i=s[2]===106?"AP-a":s[2]>>4===1?"SDg":"PF",s[2]>63?h=63:s[2]>>4===1&&(h=16),l=3;break}case 97:{i=s[2]>>4===1?"SDa":"VL:",l=3,s[2]>>4===1?h=16:h=112;break}case 98:{i=s[2]>>4===1?"SDb":"SG-a",l=3,h=16;break}case 99:{i=s[2]>>4===1?"SDc":"DX",s[2]>63?h=63:s[2]>>4===1&&(h=16),l=3;break}case 100:{i="AN",s[2]>63?h=63:s[2]>>4===1&&(h=16),l=3;break}case 104:case 105:case 106:case 107:{i="SDd",h=104;break}case 121:{i=`GM${s[2]?"":"-a"}`,l=1;break}case 122:{i="lDrm";break}case 126:{i="yDrS";break}case 127:{s[2]===127?i="rDrm":i="yDrm";break}default:s[0]<48?i="r:":i="M"}i.length<4&&(i+=`${[n,t,s[0],s[2]][l]-h}`.padStart(4-i.length,"0")),d.length<3&&(d+=`${[n,t,n,t][l]}`.padStart(3-d.length,"0")),r==="xg"&&(n===0?s[2]<100?i=i.replace("y0","y:"):s[2]===125&&(i="y126"):n===16?(p=`Voice${((s[2]<<7)+s[1]+1).toString().padStart(3,"0")}`,c=" "):n===35&&t>>1===2&&(p=`DXCH_${(((s[2]&1)<<7)+e+1).toString().padStart(3,"0")}`,c=" "));let m=[s[0],s[1],s[2]];for(;!(p?.length>=0);)if(p=this.#a[s[1]||0][(s[0]<<8)+s[2]]?.name,p){let w=this.#a[s[1]||0][(s[0]<<8)+s[2]];g=w?.poly||g,b=w?.type||b,k=w?.drum,C=w?.level,a=w?.voice}else if(this.strictMode)p="",c="?";else if(s[0]===0&&s[1]===0&&s[2]===0)p="Unloaded";else if(this.#a[s[1]||0][s[0]<<8])s[0]===0?(s[2]=0,c="^"):s[2]<1?(s[0]=0,c="*"):(s[2]--,c="^");else if(n===48)s[0]=0,s[2]=0,c="!";else if(n===62)s[1]--,c=" ",s[1]<1&&!p?.length&&(s[0]=0,c="!");else if(n<63)s[0]===0?(s[2]=0,c="^"):s[2]<1?(s[0]=0,c="*"):s[2]--;else if(n===80)p=`PrgU:${e.toString().padStart(3,"0")}`,c="!";else if(n===88)p=`CmbU:${e.toString().padStart(3,"0")}`,c="!";else if(n===121)p=`GM2Vox0${t}`,c="#";else if(n===122)if(s[1]===32?s[1]:s[1]%=7,p=this.#a[s[1]||0][(s[0]<<8)+s[2]]?.name,p){c=" ";let w=this.#a[s[1]||0][(s[0]<<8)+s[2]];g=w?.poly||g,b=w?.type||b,k=w?.drum,C=w?.level}else p="",c="*";else s[1]===0?(p=`${n.toString().padStart(3,"0")} ${e.toString().padStart(3,"0")} ${t.toString().padStart(3,"0")}`,c="!"):s[0]===0?(s[2]=0,c="^"):s[2]>0?s[2]--:s[1]>0?(s[1]=0,c="!"):(s[0]=0,c="?");let u=[s[0],s[1],s[2]];switch(c){case"^":{switch(r){case"gs":case"sc":case"ns5r":{c=" ";break}case"xg":{(t===126||t===152)&&(c=" ");break}}n===127&&(c=" ");break}case"*":break;case"!":break;case"?":break}let E="??";switch(s[0]){case 0:{s[2]===0?E="GM":s[2]===5||s[2]===7?E="KG":s[2]<154&&(E="XG");break}case 32:case 33:case 35:case 36:{s[2]>4?E=["AP","VL","PF","DX","AN"][s[0]-32]:E="GS";break}case 48:{E="MU";break}case 49:{s[2]>>1===63?E="MT":s[2]<5&&(E="GM");break}case 56:case 62:{E="AG";break}case 61:case 80:case 83:case 88:case 89:case 91:{E="AI";break}case 82:case 90:{E="XD";break}case 63:{s[2]<17?E="KR":s[2]<34?E="ES":s[2]<55?E="CS":E="DS";break}case 64:case 126:{E="XG";break}case 67:case 99:{E=s[2]>>4===1?"SD":"DX";break}case 81:{E="RW";break}case 95:{E=["DR","PC"][s[2]];break}case 96:{E=s[2]===106?"AP":s[2]>>4===1?"SD":"PF";break}case 97:{E=s[2]>>4===1?"SD":"VL";break}case 98:{E=s[2]>>4===1?"SD":"SG";break}case 100:{E="AN";break}case 104:case 105:case 106:case 107:{E="SD";break}case 120:{E=e===0?"GM":["G2","PA","PA"][s[2]]??"G2";break}case 128:{E=e===0?"GM":"GS";break}case 121:{E=s[2]?["G2","XG","PA","PA","PA"][s[2]>>4]:"GM";break}case 122:{E="KG";break}case 127:{E=s[2]===127?"MT":e===0?"GM":"XG";break}default:s[0]<48&&(s[0]===16&&r==="xg"?E="XG":E="GS")}switch(r){case"xg":{let w=0,$=0,M="GM",B=!1,P=!1;if(j.xg.has(E)||j.g2.has(E)?c!==" "?n>>4===6?P=!0:n!==0&&(B=!0):m[2]!==u[2]&&(n===81?t>>3===14?(w=97,$=112,P=!0,M="VL"):t>>3===15&&(B=!0):n===97&&(P=!0)):n>>4===6?P=!0:B=!0,P&&n===0&&t===0&&($=[0,126,152][o]),B)p="Silence",c="?",E="??";else if(P){let Y=this.#a[e][w<<8|$];E=M,p=Y?.name,g=Y?.poly||g,b=Y?.type||b,k=Y?.drum,C=Y?.level,a=Y?.voice,c="^"}break}}if(c!==" ")switch(r){case"krs":case"s90es":case"motif":{p="",E=Xt[r],c="?";break}case"g2":{p="GM2 Ext?",c="?";break}case"pa":{c==="^"&&(p="Unknown",c="?");break}case"xg":{if(c!=="^"){switch(n){case 120:case 127:case 126:{p="SilntKit";break}default:p="Silence"}c="?"}break}default:self.debugMode&&(p="",c="?")}return c==="?"&&(g=0),{name:p||`${Ht[r]||r.toUpperCase()}${Pe(n||0)}${Pe(e||0)}${Pe(t||0)}`,poly:g,type:b,drum:k,level:C,voice:a,iid:m,eid:u,sid:f,hint:o,ending:c,sect:i,bank:d,standard:E,mode:r}}async load(n,e,t="(internal)",r){let o=this,f=[],p=0,g=0,b=0;n.split(`
`).forEach(function(k,C){let a=k.split("	"),s=[];if(C===0){if(a.forEach(function(c,i){f[Vt.indexOf(c)]=i}),f.length<4){console.debug("Debugger launched.");debugger}}else{let c=0,i=0,d=0,l,h=1,m=0,u,E,w;a.forEach(function(P,Y){switch(Y){case f[0]:{c=parseInt(P);break}case f[1]:{i=parseInt(P);break}case f[2]:{d=parseInt(P);break}case f[3]:{l=P;break}case f[4]:{P=parseInt(P),P<16?h=P+1:(m=(P&15)+1,h=m);break}case f[5]:{E=P;break}case f[6]:{typeof P=="string"&&(u=parseInt(P));break}case f[7]:{w=P;break}}}),o.#a[i]=o.#a[i]||[];let $=o.#a[i],M={msb:c,prg:i,lsb:d,name:l,poly:h,type:m,drum:E,level:u,voice:w,priority:r},B=!1;r<$[c<<8|d]?.priority&&(B=!0,b++),(!$[c<<8|d]||B||e)&&($[c<<8|d]=M,p++),g++}}),e||console.debug(`Map: From "${t}", ${g} total, ${p} loaded (${p-b} + ${b}).`)}clearRange(n){let e=n.prg!==void 0?n.prg.constructor===Array?n.prg:[n.prg,n.prg]:[0,127],t=n.msb!==void 0?n.msb.constructor===Array?n.msb:[n.msb,n.msb]:[0,127],r=n.lsb!==void 0?n.lsb.constructor===Array?n.lsb:[n.lsb,n.lsb]:[0,127];for(let o=t[0];o<=t[1];o++){let f=o<<8;for(let p=r[0];p<=r[1];p++){let g=f+p;for(let b=e[0];b<=e[1];b++)delete this.#a[b][g]}}}init(){this.#a=[];for(let n=0;n<128;n++)this.#a.push([""])}async loadFiles(...n){this.init();let e=this;n.forEach(async function(t,r){try{e.load(await(await fetch(`./data/bank/${t}.tsv`)).text(),!1,t,r)}catch{console.error(`Failed loading "${t}.tsv".`)}})}constructor(...n){this.loadFiles(...n)}};let We=class{#a={};context;set(n,e){this.#a[n]=e}has(n){return!!this.#a[n]}async read(n,e){if(!this.has(n))throw new Error(`No decoder registered for "${n}"`);return await this.#a[n].call(this.context||this,e)}};let Gt=function(n,e){let t=!0;return e.forEach((r,o)=>{t=t&&n[o]===r}),t},ne=function(n){let e=0;return n.forEach(t=>{e*=256,e+=t}),e},W=new TextDecoder,le=new We;le.set("s7e",async function(n){let e=new Uint8Array(await n.slice(0,65536).arrayBuffer()),t="MSB	LSB	PRG	NME",r=[0,0,0,0],o=32,f=0,p=0,g=!0,b=[],k=0;for(;g;){let C=e.subarray(f);([()=>{W.decode(C.subarray(0,4))==="YSFC"?(f+=80,p=1):f++},()=>{if(Gt(C.subarray(0,4),r))b.forEach((a,s,c)=>{let i=ne(e.subarray(a.start+4,a.start+8));a.length=i}),p=2;else{let a=W.decode(C.subarray(0,4)),s=ne(C.subarray(4,8));b.push({type:a,start:s}),f+=8}},()=>{let a=b[k],s=e.subarray(a.start,a.start+a.length),c=32;switch(a.type){case"ENVC":{let i=o;for(;i<s.length;){let d=s.subarray(i,i+c),l=W.decode(d.subarray(0,10)).trimEnd();l.slice(0,5)==="Init "&&(l=""),l&&(t+=`
063	${(d[17]+13).toString().padStart(3,"0")}	${d[19].toString().padStart(3,"0")}	${l}`),i+=c}break}case"EDVC":{let i=o;for(;i<s.length;){let d=s.subarray(i,i+c),l=W.decode(d.subarray(0,10)).trimEnd();l.slice(0,5)==="Init "&&(l=""),l&&(t+=`
063	024	${d[19].toString().padStart(3,"0")}	${l}`),i+=c}break}case"EPVC":{let i=32,d=o;for(;d<s.length;){let l=s.subarray(d,d+i),h=W.decode(l.subarray(0,10)).trimEnd();h==="----------"&&(h=""),h&&(t+=`
063	${(l[17]+1).toString().padStart(3,"0")}	${l[19].toString().padStart(3,"0")}	${h}`),d+=i}break}}k++,k>=b.length&&(p=3,g=!1)}][p]||(()=>{g=!1}))()}return t});le.set("pcg",async function(n){let e=new Uint8Array(await n.arrayBuffer()),t="MSB	LSB	PRG	NME",r=100,o=0,f=0,p=!0,g=[],b=0;for(;p;){let k=e.subarray(r);([()=>{p=W.decode(k.subarray(0,4))==="INI2",f=k[15],r+=16,o=1},()=>{let C=W.decode(k.subarray(0,4)),a=k[5],s=k[7],c=k[11],i=ne(k.subarray(12,16)),d=ne(k.subarray(16,20)),l=ne(k.subarray(36,40)),h=W.decode(k.subarray(44,44+c));g.push({type:C,tipMsb:a,tipLsb:s,nameLen:c,length:i,start:d,entryLen:l,name:h}),r+=64,f--,f<1&&(o=2)},()=>{let C=g[b],a=e.subarray(C.start,C.start+C.length);switch(C.type){case"PRG1":break;case"PBK1":{let s=63,c=(C.tipMsb?6:0)+C.tipLsb;for(let i=0;i<128;i++){let d=i*C.entryLen,l=a.subarray(d,d+C.entryLen),h=W.decode(l.subarray(0,24)).trimEnd().replace("InitProg","");h.length&&c>5&&(t+=`
${s.toString().padStart(3,"0")}	${c.toString().padStart(3,"0")}	${i.toString().padStart(3,"0")}	${h}`)}break}case"CBK1":{let s=63,c=(C.tipMsb?3:0)+C.tipLsb+10;for(let i=0;i<128;i++){let d=i*C.entryLen,l=a.subarray(d,d+C.entryLen),h=W.decode(l.subarray(0,24)).trimEnd().replace("InitCombi","");h.length&&c>12&&(t+=`
${s.toString().padStart(3,"0")}	${c.toString().padStart(3,"0")}	${i.toString().padStart(3,"0")}	${h}`)}break}}b++,b>=g.length&&(o=3,p=!1)}][o]||(()=>{p=!1}))()}return t});let oe=["off","hall","room","stage","plate","delay LCR","delay LR","echo","cross delay","early reflections","gate reverb","reverse gate"].concat(new Array(4),["white room","tunnel","canyon","basement","karaoke"],new Array(43),["pass through","chorus","celeste","flanger","symphonic","rotary speaker","tremelo","auto pan","phaser","distortion","overdrive","amplifier","3-band EQ","2-band EQ","auto wah"],new Array(1),["pitch change","harmonic","touch wah","compressor","noise gate","voice channel","2-way rotary speaker","ensemble detune","ambience"],new Array(4),["talking mod","Lo-Fi","dist + delay","comp + dist + delay","wah + dist + delay","V dist","dual rotor speaker"]),ce=["melodic","drums","drum set 1","drum set 2","drum set 3","drum set 4","drum set 5","drum set 6","drum set 7","drum set 8"],Ft=[17.1,18.6,20.2,21.8,23.3,24.9,26.5,28,29.6,31.2,32.8,34.3,35.9,37.5,39,40.6,42.2,43.7,45.3,46.9,48.4,50],ae=[20,22,25,28,32,36,40,45,50,56,63,70,80,90,100,110,125,140,160,180,200,225,250,280,315,355,400,450,500,560,630,700,800,900,1e3,1100,1200,1400,1600,1800,2e3,2200,2500,2800,3200,3600,4e3,4500,5e3,5600,6300,7e3,8e3,9e3,1e4,11e3,12e3,14e3,16e3,18e3,2e4],ze=[0,.04,.08,.13,.17,.21,.25,.29,.34,.38,.42,.46,.51,.55,.59,.63,.67,.72,.76,.8,.84,.88,.93,.97,1.01,1.05,1.09,1.14,1.18,1.22,1.26,1.3,1.35,1.39,1.43,1.47,1.51,1.56,1.6,1.64,1.68,1.72,1.77,1.81,1.85,1.89,1.94,1.98,2.02,2.06,2.1,2.15,2.19,2.23,2.27,2.31,2.36,2.4,2.44,2.48,2.52,2.57,2.61,2.65,2.69,2.78,2.86,2.94,3.03,3.11,3.2,3.28,3.37,3.45,3.53,3.62,3.7,3.87,4.04,4.21,4,37,4.54,4.71,4.88,5.05,5.22,5.38,5.55,5.72,6.06,6.39,6.73,7.07,7.4,7.74,8.08,8.41,8.75,9.08,9.42,9.76,10.1,10.8,11.4,12.1,12.8,13.5,14.1,14.8,15.5,16.2,16.8,17.5,18.2,19.5,20.9,22.2,23.6,24.9,26.2,27.6,28.9,30.3,31.6,33,34.3,37,39.7],qe=function(n){let e=.1,t=-.3;return n>66?(e=5,t=315):n>56?(e=1,t=47):n>46&&(e=.5,t=18.5),e*n-t},Qe=function(n){return n>105?Ft[n-106]:n>100?n*1.1-100:n/10},Je=",a,i,u,e,o,ka,ki,ku,ke,ko,ky,kw,sa,si,su,se,so,sh,ta,ti,tu,te,to,t,ch,t,s,na,ni,nu,ne,no,ny,nn,ha,hi,hu,he,ho,hy,fa,fi,fu,fe,fo,ma,mi,mu,me,mo,my,mm,ya,yu,ye,yo,ra,ri,ru,re,ro,ry,wa,wi,we,wo,ga,gi,gu,ge,go,gy,gw,za,zi,zu,ze,zo,ja,ji,ju,je,jo,jy,da,di,du,de,do,dy,ba,bi,bu,be,bo,by,va,vi,vu,ve,vo,pa,pi,pu,pe,po,py,nga,ngi,ngu,nge,ngo,ngy,ng,hha,hhi,hhu,hhe,hho,hhy,hhw,*,_,,,~,.".split(","),Ae={};`hi*,
ka,„Åã
ki,„Åç
ku,„Åè
ke,„Åë
ko,„Åì
ky,„Åç!
kw,„Åèl
tsu,„Å§
ts,„Å§l
sa,„Åï
si,„Åô„ÅÉ
su,„Åô
se,„Åõ
so,„Åù
shi,„Åó
sh,„Åó!
ta,„Åü
ti,„Å¶„ÅÉ
tu,„Å®„ÅÖ
te,„Å¶
to,„Å®
tchy,„Å°!
tchi,„Å°
na,„Å™
ni,„Å´
nu,„Å¨
ne,„Å≠
no,„ÅÆ
ny,„Å´!
nn,„Çì
ha,„ÅØ
hi,„Å≤
hu,„Åª„ÅÖ
he,„Å∏
ho,„Åª
hy,„Å≤!
fa,„Åµ„ÅÅ
fi,„Åµ„ÅÉ
fu,„Åµ
fe,„Åµ„Åá
fo,„Åµ„Åâ
ma,„Åæ
mi,„Åø
mu,„ÇÄ
me,„ÇÅ
mo,„ÇÇ
my,„Åø!
mm,„á∫
ra,„Çâ
ri,„Çä
ru,„Çã
re,„Çå
ro,„Çç
ry,„Çä!
wa,„Çè
wi,„Çê
we,„Çë
wo,„Çí
nga,„Åã„Çö
ngi,„Åç„Çö
ngu,„Åè„Çö
nge,„Åë„Çö
ngo,„Åì„Çö
ngy,„Åç„Çö!
ng,„É≥
ga,„Åå
gi,„Åé
gu,„Åê
ge,„Åí
go,„Åî
gy,„Åé!
gw,„Åêl
za,„Åñ
zi,„Åö„ÅÉ
zu,„Åö
ze,„Åú
zo,„Åû
ja,„Åò„ÇÉ
ji,„Åò
ju,„Åò„ÇÖ
je,„Åò„Åá
jo,„Åò„Çá
jy,„Åò!
da,„Å†
di,„Åß„ÅÉ
du,„Å©„ÅÖ
de,„Åß
do,„Å©
dy,„Åß!
ba,„Å∞
bi,„Å≥
bu,„Å∂
be,„Åπ
bo,„Åº
by,„Å≥!
va,„Çî„ÅÅ
vi,„Çî„ÅÉ
vu,„Çî
ve,„Çî„Åá
vo,„Çî„Åâ
pa,„Å±
pi,„Å¥
pu,„Å∑
pe,„Éö
po,„ÅΩ
py,„Å¥!
!ya,„ÇÉ
!yu,„ÇÖ
!ye,„Åá
!yo,„Çá
ya,„ÇÑ
yu,„ÇÜ
ye,õÄÅ
yo,„Çà
!a,„ÇÉ
!u,„ÇÖ
!e,„Åá
!o,„Çá
!a,„ÇÉ
!u,„ÇÖ
!e,„Åá
!o,„Çá
la,„ÅÅ
li,„ÅÉ
lu,„ÅÖ
le,„Åá
lo,„Åâ
a,„ÅÇ
i,„ÅÑ
u,„ÅÜ
e,„Åà
o,„Åä
*,„Å£
~,
^,
_,`.split(`
`).forEach(n=>{let e=n.split(",");Ae[e[0]]=e[1]});let Ze=function(n){let e=n;n[0]=="*"&&(e=e.slice(1)),["aa","ii","uu","ee","oo"].forEach(r=>{for(;e.indexOf(r)>-1;)e=e.replace(r,r[0])});for(let r in Ae)e=e.replaceAll(r,Ae[r]);e.indexOf("„Çì")==0&&e.length>1&&(e=e.slice(1));let t=e.indexOf("!");return t>-1&&e.length>1&&(e=e.slice(t+1)),e},je=function(n){return n?n<96?`cc${n}`:["aftertouch","velocity","pitch bend"][n-96]:"off"},et={"":["l9","Undefined fallback"],u8:["utf-8","Unicode"],l1:["l9","Pan-Latin"],jp:["sjis","Japanese"],kr:["iso-2022-kr","Korean"],hz:["gb18030","Simplified Chinese"],b5:["big5","Traditional Chinese"],cy:["koi8-ru","Cyrillic"],vn:["tcvn-5773-1993","Vietnamese"]},tt={m:"Male",f:"Female",c:"Chorus",s:"Solo",p:"Plural",w:"Words",x:"Non-vocal"};let Le=["room 1","room 2","room 3","hall 1","hall 2","plate","delay","panning delay"],at=["chorus 1","chorus 2","chorus 3","chorus 4","feedback","flanger","short delay","short delay feedback"],rt=["delay 1","delay 2","delay 3","delay 4","pan delay 1","pan delay 2","pan delay 3","pan delay 4","delay to reverb","pan repeat"];let Kt={0:"thru",256:"stereo EQ",257:"spectrum",258:"enhancer",259:"humanizer",272:"overdrive",273:"distortion",288:"phaser",289:"auto wah",290:"rotary",291:"stereo flanger",292:"step flanger",293:"tremelo",294:"auto pan",304:"compressor",305:"limiter",320:"hexa chorus",321:"tremelo chorus",322:"stereo chorus",323:"space D",324:"3D chorus",336:"stereo delay",337:"modulated delay",338:"3-tap delay",339:"4-tap delay",340:"tremelo control delay",341:"reverb",342:"gate reverb",343:"3D delay",352:"2-pitch shifter",353:"feedback pitch shifter",368:"3D auto",369:"3D manual",370:"Lo-Fi 1",371:"Lo-Fi 2",512:"overdrive - chorus",513:"overdrive - flanger",514:"overdrive - delay",515:"distortion - chorus",516:"distortion - flanger",517:"distortion - delay",518:"enhancer - chorus",519:"enhancer - flanger",520:"enhancer - delay",521:"chorus - delay",522:"flanger - delay",523:"chorus - flanger",524:"rotary multi",1024:"guitar multi 1",1025:"guitar multi 2",1026:"guitar multi 3",1027:"clean guitar multi 1",1028:"clean guitar multi 2",1029:"bass multi",1030:"rhodes multi",1280:"keyboard multi",4352:"chorus / delay",4353:"flanger / delay",4354:"chorus / flanger",4355:"overdrive / distortion",4356:"overdrive / rotary",4357:"overdrive / phaser",4358:"overdrive / auto wah",4359:"phaser / rotary",4360:"phaser / auto wah"},Yt={66307:["drive"],66309:["vowel",n=>"aiueo"[n]],94723:["pre-filter"],94724:["Lo-Fi type"],94725:["post-filter"],94979:["Lo-Fi type"],94980:["fill type",n=>["off","LPF","HPF"][n]],94984:["noise type",n=>["white","pink"][n]],94987:["disc type",n=>["LP","SP","EP","RND"]],94990:["hum type",n=>`${n+5}0Hz`],94993:["M/S",n=>["mono","stereo"][n]]},Ie=function(n){return Kt[(n[0]-32<<8)+n[1]]||`0x${n[0].toString(16).padStart(2,"0")}${n[1].toString(16).padStart(2,"0")}`},it=function(n,e,t){let r=(n[0]-32<<16)+(n[1]<<8)+e,o=Yt[r]||{},f=o[0];if(f?.length)return f+=`: ${(o[1]||function(){})(t)||t}`,f},De=[68,48,95,78,41,3,110,122,0];let z=new TextEncoder,st=(n,e)=>{let t=Math.min(n.length,e.length),r=0;for(let o=0;o<t;o++)if(r=n[o]-e[o],r!==0)return[o,r];return n.length!==e.length?[t,n.length-e.length]:[0,0]},_=function(n=64){return Math.round(2e3*Math.log10(n/64))/100},nt=function(n,e,t){let r=[],o=t==!1?e.readIntVLV():t;n==0||n==127;for(let f=0;f<o;f++){let p=e.readInt(1);if(r.push(p),p!=247){if(p!=240){if(p>127)return console.debug(`Early termination: ${r}`),r.pop(),e.backOne(),e.backOne(),new Uint8Array(r)}}}return new Uint8Array(r)},ee=function(n){let e=0;return n.forEach(t=>{e+=t,e=e&127}),~e+1&127},G=function(n,e){let t=0,r=0;for(let o=0;o<n.length;o++){let f=(o&7)-1,p=(r>>f&1)<<7,g=n[o];g+=p,o&7?(e(g,t,n),t++):r=n[o]}};let Wt=function(n,e){let t=0;for(let r=0;r<n.length;r++)if(r&1){t=t<<4|n[r]&15;let o=r>>1;e(t,o,n)}else t=n[r]&15},lt=function(n){let e=n.length>>1,t=new Uint8Array(e);return Wt(n,(r,o)=>{t[o]=r}),t},de=function(n){let e=Math.floor(n*14.2);return e<128?e:0},T=function(){return self?.debugMode??!1},ot=function(n){let e=(n.length+1)*3>>2,t=new Uint8Array(e),r=n.length+3>>2;for(let o=0;o<r;o++){let f=o<<2,p=o*3,g=0;for(let b=0;b<4;b++)g<<=6,g|=n.charCodeAt(f+b)-32&63;t[p]=g>>16,t[p+1]=g>>8&255,t[p+2]=g&255}return t};let Va="‚ô≠ùÑ´,ùÑ´,‚ô≠,,‚ôØ,ùÑ™,ùÑ™‚ôØ".split(",");let N=[new Map,new Map];N[0].set("base64",z.encode("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"));N[0].set("base64url",z.encode("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"));N[0].set("hex",z.encode("0123456789abcdef"));N[0].set("ovm43",z.encode("0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_"));N[0].set("radix64",z.encode("0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz+/"));N[0].set("radix64url",z.encode("0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_"));N[0].set("xx",z.encode("+-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz"));N[0].set("xxurl",z.encode("_-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz"));N[0].set("z64",z.encode("0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ+/"));N[0].set("z64url",z.encode("0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ-_"));for(let[n,e]of N[0]){let t=new Uint8Array(128).fill(255);for(let r=0;r<e.length;r++)t[e[r]]=r;switch(n){case"hex":{for(let r=10;r<16;r++)t[r+55]=r;break}default:t[9]=254,t[10]=254,t[12]=254,t[13]=254,t[32]=254,t[61]=254}N[1].set(n,t)}console.debug(N);let zt=(n="base64",e,t=!1)=>{};self.bufferTo=zt;let ye={red:"#ff7986",orange:"#fca022",grYellow:"#c9e10a",green:"#c1ff0a",white:"#b7e5e3",blue:"#2280ff"},be={black:"#000000",blue:"#0516bb",purple:"#48009a",inactive:22,medium:59,active:170,range:148},qt=[[6,26],[7,35],[8,44],[9,53],[10,62],[11,71],[12,80],[13,89],[14,98],[15,107],[16,116],[17,125],[18,134],[19,143],[20,152],[21,161],[22,170]],fe={},Qt="06,68,2a,16,aa,3b".split(",");for(let n in be)fe[n]=[],Qt.forEach(e=>{fe[n].push(`${be[n]}${e}`)});let Ee=[];for(let n of qt)Ee.push([`${be.black}${n[0].toString(16).padStart(2,"0")}`,`${be.black}${n[1].toString(16).padStart(2,"0")}`]),n.push(n[1]-n[0]);let Ha=`${ye.orange}64`,Ga=`${ye.green}64`,Fa=`${ye.white}64`,Ka=`${ye.red}64`,Ya=fe.black[0],Wa=fe.black[2],za=fe.black[1];let L=["?","gm","gs","sc","xg","g2","mt32","doc","qy10","qy20","ns5r","x5d","05rw","k11","sg","sd","pa","krs","s90es","motif","cs6x","trin","an1x","cs1x"],Jt={gm2:"g2","mt-32":"mt32","c/m":"mt32",ag10:"05rw","ag-10":"05rw","05r/w":"05rw",x5:"05rw",x5dr:"x5d",gmega:"k11","kross 2":"krs","motif es":"motif","s90 es":"s90es",trinity:"trin","tr-rack":"trin"},Zt=["melodic","drum","menu"],he={"?":[0,0,120,0,0],gm:[0,0,120,0,0],gs:[0,0,128,0,0],sc:[0,0,128,0,0],xg:[0,0,127,0,0],g2:[0,0,120,0,0],mt32:[0,127,127,0,127],doc:[57,112,127,57,112],qy10:[57,113,127,57,113],qy20:[57,114,127,57,114],ns5r:[0,0,61,0,0],x5d:[82,0,62,56,0],"05rw":[81,0,62,56,0],k11:[0,0,122,0,0],sg:[0,0,122,0,0],sd:[97,0,105,0,0],pa:[0,0,120,121,0],krs:[121,0,120,0,0],s90es:[0,0,127,0,0],motif:[0,0,127,0,0],cs6x:[0,0,127,0,0],trin:[0,0,61,0,0],an1x:[36,3,127,0,0],cs1x:[0,0,127,63,0],cs2x:[0,0,127,63,0]},jt=[9,25,41,57,73,89,105,121],ea=[0,3,81,84,88],ct={8:"Off",9:"On",10:"Note aftertouch",11:"cc",12:"pc",13:"Channel aftertouch",14:"Pitch"},we={0:0,1:1,2:3,5:4},dt={0:0,1:1,2:2,5:3},ft=[[0,24],[0,127],[0,127],[40,88],[0,127],[0,127]],Oe=[36,37,48,49,52,53],Ce=[20,21,22,23,24,25,26,28,29,30,31,36,37,48,49,52,53,64,65],ht={26:127,29:0,30:0,31:0,52:12,53:54},te=[0,1,2,4,5,6,7,8,10,11,12,13,14,15,16,17,18,19,20,21,22,26,28,32,38,40,41,42,43,44,45,46,47,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,80,81,82,83,84,91,92,93,94,95,98,99,100,101,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157],ta=[2,4,12,13,14,15,16,17,18,19,20,21,40,41,42,43,44,45,46,47,80,81,83,136,130,131,132,133,134,135,137,138,139,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157],aa=[33,102,99,32,100,8,9,10],ut=[0,16,25,40,32,64,24,48],ue="reverb,chorus,delay,insert0,insert1,insert2,insert3,insert4".split(","),F=[["VL",32,8,1],["SG",8,1,1],["DX",16,1,16],["AN",16,2,5],["PF",2,1,64],["DR",2,1,32],["PC",2,1,32],["AP",2,1,64]],v={};L.forEach((n,e)=>{v[n]=e});let x=[];te.forEach((n,e)=>{x[n]=e});let X={length:Ce.length};Ce.forEach((n,e)=>{X[n]=e});let ra={};Zt.forEach((n,e)=>{ra[n]=e});let ia=function(n){let e=[],t=0;return n?.forEach(function(r,o){r===247?e.push(n.subarray(t,o)):r===240&&(t=o+1)}),e.length||e.push(n.subarray(0)),T()&&console.debug(e),e};let Be=8,y={port:Be,ch:Be<<4,chShift:Math.ceil(Math.log2(Be))+4,cc:te.length,nn:128,pl:512,tr:256,cmt:14,rpn:6,rpnt:4,nrpn:Oe.length,ace:8,drm:8,dpn:Ce.length,dnc:128,ext:3,efx:8,cvn:12,redir:32,vxPrim:3,invalidCh:255};y.chcc=y.cc*y.ch;let K={bank0:255},sa=new TextDecoder("l9"),R=new Uint16Array(y.ch),re=new Uint16Array(y.ch),na=new Uint16Array(y.ch),ke=new Uint16Array(y.ch),la=new Uint16Array(y.ch),ie=new Uint16Array(y.ch),pt=new Array(y.drm);for(let n=0;n<y.ch;n++)R[n]=n*y.cc,re[n]=n*y.rpn,na[n]=n*y.nrpn,ke[n]=n*y.ace,la[n]=n*y.ext,ie[n]=n*y.cvn;for(let n=0;n<y.drm;n++){pt[n]=new Uint16Array(y.dpn);let e=n*y.dpn*y.dnc;for(let t=0;t<y.dpn;t++)pt[n][t]=e+t*y.dnc}if(typeof self?.require<"u")throw new Error("Environments supporting CommonJS is not supported.");let oa=class{#a;#h=!0;autoRealtime=!1;detach(){this.#a=void 0,this.#h=!0,this.autoRealtime=!1}attach(e,t){if(typeof e<"u"&&typeof e.currentTime=="number")this.#a=e,this.#h=!1,this.autoRealtime=!0;else throw new TypeError("Not a valid time source.")}timeMs(){return typeof performance?.now=="function"?performance.now():Object.hasOwn(self,"Temporal")?Temporal.Now.instant().epochMilliseconds:Date.now()}get realtime(){return this.#h||typeof this.#a>"u"}set realtime(e){if(e)this.#h=!0;else{if(typeof this.#a>"u")throw new TypeError("No attached time source is present.");this.#h=!1}}get currentTime(){return this.realtime||!this.#a?this.timeMs()*.001:this.#a.currentTime}now(){return this.realtime||!this.#a?Math.floor(this.timeMs()):Math.round(this.#a.currentTime*1e3)}constructor(e){e&&this.attach(e)}},mt=class extends ge{NOTE_IDLE=0;NOTE_ATTACK=1;NOTE_DECAY=2;NOTE_SUSTAIN=3;NOTE_HELD=4;NOTE_RELEASE=5;NOTE_SOSTENUTO_ATTACK=8;NOTE_SOSTENUTO_DECAY=9;NOTE_SOSTENUTO_SUSTAIN=10;NOTE_SOSTENUTO_HELD=11;NOTE_MUTED_RECOVERABLE=16;CH_MELODIC=0;CH_DRUMS=1;CH_DRUM1=2;CH_DRUM2=3;CH_DRUM3=4;CH_DRUM4=5;CH_DRUM5=6;CH_DRUM6=7;CH_DRUM7=8;CH_DRUM8=9;DUMP_ALL=0;DUMP_ONCE=1;DUMP_MODE=2;EXT_NONE=0;EXT_VL=1;EXT_DX=3;VLBC_SYSTEM=0;VLBC_BRTHEXPR=1;VLBC_VELOINIT=2;VLBC_VELOALL=3;CH_INACTIVE=0;CH_ACTIVE=1;CH_DISABLED=2;KARAOKE_NONE=0;KARAOKE_TEXT=1;KARAOKE_XF=2;#a=0;#h=0;#C=0;#v=new Array(11);get#k(){return this.#v[this.#h]}set#k(e){this.#v[this.#h]=e}#x=16;get lcdContrast(){return this.#x}set lcdContrast(e){(e<0||e>=Ee.length)&&(e=Ee.length-1),this.#x=e,this.dispatchEvent("lcdcontrast",e)}#P=new Uint8Array(y.ch);#d=new Uint8Array(y.ch);#i=new Uint8Array(y.ch);#e=new Uint8Array(y.chcc<<1);#b=new Uint8Array(y.ch*y.ace);#n=new Uint8Array(y.ch*y.vxPrim);#m=new Uint8Array(y.ch*y.nn);#u=new Uint8Array(y.ch);#c=new Uint16Array(y.pl);#o=new Uint8Array(y.pl);#R=new Int16Array(y.ch);#T=new Uint8Array(y.ch);#S=new Uint8Array(y.ch);#y=new Uint8Array(y.ch*y.ext);#s=new Uint8Array(y.ch*y.rpn);#f=new Uint8Array(y.ch*y.rpnt);#J=new Int8Array(y.ch*Oe.length);#D=new Uint8Array(y.drm*y.dpn*y.dnc);#B=new Uint8Array(y.drm*2);#O=new Uint8Array(y.efx*3);#K=new Uint8Array(y.ch);#Z=new Uint8Array(y.ch*y.redir);#g=new Uint8Array(y.port);#E=new Uint8Array(y.port);#Y=new Uint8Array(y.ch);#N=new Uint8Array(y.ch);#X=new Uint8Array(y.ch*y.cvn);#H=new Uint8Array(y.ch);#$=new Uint8Array(128);#_=new Uint8Array(y.cmt*8);#t=new Uint8Array(1024);#L=new Uint8Array(y.cmt*64);#l={};clockSource=new oa;modelEx={xg:{map:0,varSys:!1,insPart:new Uint8Array(5)},yPlg:[],vl:{module:0,breath:1,voiceCh:y.invalidCh},sc:{showBar:!0,invBar:!1,invDisp:!1,peakHold:1},cs1x:{perfCh:0},kross:{chToggle:!1},sg:{convLastSyll:0,runLineLen:0,maxLineLen:32,splitMask:!1}};#r;get detect(){return structuredClone(this.#r)}#A;#te;#p=100;#j=0;#ae=500;#ue=0;#ge=0;#ie=32;#be=!1;#q="";#G=0;#re=0;#pe=0;#W=!0;#w=0;#ye;#M=!1;#me=0;#ne=new Array(y.ch);#F=[];#ee=new Uint8Array(y.ch);#se=new Uint8Array(y.tr);baseBank=new Re("gm2","ns5r","xg","gs","sd","gmega","plg-vl","plg-pf","plg-dx","plg-an","plg-dr","plg-sg","kross","s90es","cs2x","pa");userBank=new Re("gm2");initOnReset=!1;aiEfxName="";polyIndexShrink=!0;polyIndexLatest=0;polyIndexLast=0;lcdHideBankInfo=!1;chRedir(e,t,r){let o=this;if(o.#se[t])return(o.#se[t]-1)*16+e;if(o.#a===v.sc||o.#a===v.sd){if(r===1)return e;for(let g=0;g<y.ch;g++)if(o.#ee[g]===t)return g&112|e&15;let f=0,p=!0;for(;p;)o.#ee[e+f]===0?(o.#ee[e+f]=t,console.info(`Allocated track ${t} to channel ${e+f+1}.`),p=!1):this.#ee[e+f]===t?p=!1:(f+=16,f>=128&&(f=0,p=!1));return e+f}else return e}getTrackPort(e){return this.chRedir(0,e,!0)>>4}forceVoiceRefresh(){for(let e=0;e<y.ch;e++)this.#P[e]&&this.dispatchEvent("voice",{part:e})}#V=[];#le;#I={nOff:(e,t)=>{let r=e*128+t,o=this.#c.lastIndexOf(r);if(o>-1)if(this.getChCc(e,64)>>6)this.#o[o]=this.NOTE_HELD,this.dispatchEvent("note",{part:e,note:t,velo:this.#m[r],state:this.NOTE_HELD});else if(this.getChCc(e,66)>>6&&this.#o[o]===this.NOTE_SOSTENUTO_SUSTAIN)this.#o[o]=this.NOTE_SOSTENUTO_HELD,this.dispatchEvent("note",{part:e,note:t,velo:this.#m[r],state:this.NOTE_SOSTENUTO_HELD});else{this.#c[o]=0,this.#m[r]=0,this.#o[o]=this.NOTE_IDLE;let f=this.getExt(e)[1];(f===this.VLBC_VELOINIT||f===this.VLBC_VELOALL)&&this.setChCc(e,129,0),this.dispatchEvent("note",{part:e,note:t,velo:0,state:this.NOTE_IDLE})}if(this.#u[e]){for(let f=this.polyIndexLast;f>=0;f--)if(this.#c[f]>>7===e&&this.#o[f]!==0){this.#o[f]===this.NOTE_MUTED_RECOVERABLE&&(this.#o[f]=this.NOTE_SUSTAIN);break}}if(this.polyIndexShrink&&this.polyIndexLast>0){let p=!1,g=this.polyIndexLast-8,b=this.polyIndexLast;for(;b>g&&this.#o[b]===0;b--)p=!0;p&&(this.polyIndexLast=b,this.#o[b+1]!==0&&console.error("Polyphonic slot shrinking edge case."))}},nOn:(e,t,r)=>{let o=e*128+t,f=0;if(this.#u[e])for(let p=0;p<=this.polyIndexLast;p++)this.#c[p]>>7===e&&this.#o[p]!==0&&(this.#o[p]=this.NOTE_MUTED_RECOVERABLE);for(;this.#o[f]>0&&this.#c[f]!==o;)f++;if(f<y.pl){this.#c[f]=o,this.#m[o]=r,this.#o[f]=this.NOTE_SUSTAIN,this.#T[e]<r&&(this.#T[e]=r);let p=this.getExt(e)[1];(p===this.VLBC_VELOINIT||p===this.VLBC_VELOALL)&&this.setChCc(e,129,r),this.dispatchEvent("note",{part:e,note:t,velo:r,state:this.NOTE_SUSTAIN}),this.polyIndexLatest=f+1,f>this.polyIndexLast&&(this.polyIndexLast=f)}else console.error("Polyphony exceeded.")},nAt:(e,t,r)=>{},cAt:(e,t)=>{},hoOf:e=>{this.#o.forEach((t,r)=>{if(t===this.NOTE_HELD){let o=this.#c[r],f=o>>7;e===f&&(this.#o[r]=this.NOTE_IDLE,this.#c[r]=0,this.#m[o]=0,this.dispatchEvent("note",{part:e,note:o&127,velo:0,state:this.NOTE_IDLE}))}})},soOn:e=>{this.#o.forEach((t,r)=>{let o;switch(t){case this.NOTE_ATTACK:{o=this.NOTE_SOSTENUTO_ATTACK;break}case this.NOTE_DECAY:{o=this.NOTE_SOSTENUTO_DECAY;break}case this.NOTE_SUSTAIN:{o=this.NOTE_SOSTENUTO_SUSTAIN;break}}if(o){this.#o[r]=o;let f=this.#c[r];this.dispatchEvent("note",{part:e,note:f&127,velo:this.#m[f],state:o})}})},soOf:e=>{this.#o.forEach((t,r)=>{if(t===this.NOTE_SOSTENUTO_HELD){let o=this.#c[r],f=o>>7;e===f&&(this.#o[r]=this.NOTE_IDLE,this.#c[r]=0,this.#m[o]=0,this.dispatchEvent("note",{part:e,note:o&127,velo:0,state:this.NOTE_IDLE}))}})},ano:e=>{this.#c.forEach(t=>{let r=t>>7,o=t&127;t===0&&this.#m[0]===0||r===e&&this.#I.nOff(r,o)})}};#Ee={8:function(e){let t=e.channel,r=e.data[0];this.#I.nOff(t,r)},9:function(e){let t=e.channel,r=this;if(r.getChModeId(t)===v.xg&&r.#i[t]>1){let p=r.getChDrumFirstWrite(t);p[0]&&p[1]!==y.invalidCh&&!r.#P[t]&&(r.copyChSetup(p[1],t),r.pushChPrimitives(t),console.debug(`Part CH${t+1} copied from CH${p[1]+1}.`))}r.setChActive(t,1);let o=e.data[0],f=e.data[1];f>0?r.#I.nOn(t,o,f):r.#I.nOff(t,o)},10:function(e){let t=e.channel,r=t*128+e.data[0];this.#c.indexOf(r)>-1&&(this.#m[r]=data[1],this.getExt(t)[1]===this.VLBC_VELOALL&&this.setChCc(t,129,data[1]),this.dispatchEvent("note",{part:t,note:e.data[0],velo:e.data[1],state:this.NOTE_SUSTAIN}))},11:function(e){let t=e.channel,r=this,o=r.#ne[t],f=o[e.data[0]];f&&(e.data[0]=f),[0,32].indexOf(e.data[0])>-1&&(()=>{switch(this.#a){case v.s90es:case v.motif:{if(e.data[0]===0){[0,63].indexOf(e.data[1])>-1&&r.setChActive(t,1);break}e.data[1]&&r.setChActive(t,1);break}default:break}})();let p=t*y.ext,g=r.getChModeId(t);switch(e.data[0]){case 96:return;case 97:return;case 120:return;case 121:{this.#I.ano(t),this.#R[t]=0,r.resetChCc(t,1,0),r.resetChCc(t,5,0),r.resetChCc(t,64,0),r.resetChCc(t,65,0),r.resetChCc(t,66,0),r.resetChCc(t,67,0),r.resetChCc(t,11,127),r.resetChCc(t,101,127),r.resetChCc(t,100,127),r.resetChCc(t,99,127),r.resetChCc(t,98,127);return}case 123:{this.#I.ano(t);return}case 124:{this.#I.ano(t);return}case 125:{this.#I.ano(t);return}case 126:{this.#u[t]=1,this.#I.ano(t);return}case 127:{this.#u[t]=0,this.#I.ano(t);return}}if(x[e.data[0]]===void 0)console.warn(`cc${e.data[0]} is not accepted.`);else{switch(ta.indexOf(e.data[0])>-1&&this.allocateAce(t,e.data[0]),e.data[0]){case 0:{switch(T()&&console.debug(`${L[r.#a]}, CH${t+1}: ${e.data[1]}`),this.#a===0?e.data[1]<48?(r.#i[t]>0&&(e.data[1]=r.getChPrimitive(t,1,!1),e.data[1]=he.gs[2],console.debug(`Forced channel ${t+1} to stay drums.`)),e.data[1]>0&&(console.debug(`Roland GS detected with MSB: ${e.data[1]}`),r.switchMode("gs",0))):e.data[1]===56?r.switchMode(r.#r.x5===82?"x5d":"05rw",0):e.data[1]===62?r.switchMode(r.#r.x5===82?"x5d":"05rw",0):e.data[1]===63?r.switchMode(L[r.#r.ds],0):e.data[1]===64||e.data[1]===127?r.switchMode("xg",0):(e.data[1]===120||e.data[1]===121)&&r.switchMode("g2",0):r.#a===v.gs||r.#a===v.sc?e.data[1]<56&&this.#i[t]>0&&(e.data[1]=this.getChPrimitive(t,1,!1),e.data[1]=he.gs[2],console.debug(`Forced channel ${t+1} to stay drums.`)):this.#a===v.gm&&(e.data[1]<48?this.#i[t]>0&&(e.data[1]=he.gs[2],this.switchMode("gs",1),console.debug(`Forced channel ${t+1} to stay drums.`)):(e.data[1]===64||e.data[1]===127)&&this.switchMode("xg",1)),this.#a){case v.xg:{[79,95,120,126,127].indexOf(e.data[1])>-1?this.#i[t]===0&&(this.setChType(t,this.CH_DRUM2),console.debug(`CH${t+1} set to drums by MSB.`)):this.#i[t]>0&&(this.setChType(t,this.CH_MELODIC),console.debug(`CH${t+1} set to melodic by MSB.`)),[33,81,97].indexOf(e.data[1])>-1?this.#y[p]=this.EXT_VL:[35,67,83,99].indexOf(e.data[1])>-1?this.#y[p]=this.EXT_DX:this.#y[p]=this.EXT_NONE;break}case v["05rw"]:case v.x5d:case v.ns5r:{[61,62,126,127].indexOf(e.data[1])>-1?this.#i[t]===this.CH_MELODIC&&(this.setChType(t,this.CH_DRUM2),console.debug(`CH${t+1} set to drums by MSB.`)):this.#i[t]!==this.CH_MELODIC&&(this.setChType(t,this.CH_MELODIC),console.debug(`CH${t+1} set to melodic by MSB.`));break}case v.sd:{[104,105,106,107,120].indexOf(e.data[1])>-1?this.#i[t]===0&&(this.setChType(t,this.CH_DRUM2),console.debug(`CH${t+1} set to drums by MSB.`)):this.#i[t]>0&&(this.setChType(t,this.CH_MELODIC),console.debug(`CH${t+1} set to melodic by MSB.`));break}case v.g2:{e.data[1]===120?this.#i[t]===0&&(this.setChType(t,this.CH_DRUMS),console.debug(`CH${t+1} set to drums by MSB.`)):this.#i[t]>0&&(this.setChType(t,this.CH_MELODIC),console.debug(`CH${t+1} set to melodic by MSB.`));break}}break}case 2:{this.getExt(t)[1]===this.VLBC_BRTHEXPR&&this.setChCc(t,129,e.data[1]);break}case 6:{if(this.#S[t]){[v.xg,v.gs,v.sc,v.ns5r].indexOf(this.#a)<0&&console.warn(`NRPN commits are not available under "${L[this.#a]}" mode, even when they are supported in Octavia.`);let b=this.getChCc(t,99),k=this.getChCc(t,98);if(b===1){let C=aa.indexOf(k);if(C>-1)this.setChCc(t,71+C,e.data[1]),T()&&console.debug(`Redirected NRPN 1 ${k} to cc${71+C}.`),this.dispatchEvent("cc",{part:t,cc:71+C,data:e.data[1]});else{let a=Oe.indexOf(k);a>-1?this.#J[t*10+a]=e.data[1]-64:console.warn(`NRPN 0x01${k.toString(16).padStart(2,"0")} is not supported.`),T()&&console.debug(`CH${t+1} voice NRPN ${k} commit`)}}else{if(Ce.indexOf(b)<0){let a=`NRPN 0x${b.toString(16).padStart(2,"0")}${k.toString(16).padStart(2,"0")} `;console.warn(b===127?`${a}is not necessary. Consider removing it.`:`${a}is not supported.`)}else{let a=this.#i[t]-2;a<0?console.warn(`CH${t+1} cannot accept drum NRPN as type ${ce[this.#i[t]]}.`):this.#D[(a*y.dpn+X[b])*y.dnc+k]=e.data[1]}T()&&console.debug(`CH${t+1} (${ce[this.#i[t]]}) drum NRPN ${b} commit`)}}else{let b=we[this.getChCc(t,100)],k=dt[this.getChCc(t,100)];if(this.getChCc(t,101)===0&&b!==void 0)switch(T()&&console.debug(`CH${t+1} RPN 0 ${this.getChCc(t,100)} commit: ${e.data[1]}`),e.data[1]=Math.min(Math.max(e.data[1],ft[b][0]),ft[b][1]),this.#s[t*y.rpn+b]=e.data[1],this.#f[t*y.rpnt+k]=1,g){case v.xg:case v.gs:case v.sc:case v.mt32:case v.s90es:case v.motif:case v.cs1x:case v.cs6x:{switch(this.getChCc(t,100)){case 1:case 2:{this.dispatchEvent("pitch",{part:t,pitch:this.getPitchShift(t)});break}}break}default:this.dispatchEvent("pitch",{part:t,pitch:this.getPitchShift(t)})}}break}case 32:{switch(T()&&console.debug(`${L[this.#a]}, CH${t+1} LSB: ${e.data[1]}`),this.#a){case v.s90es:case v.motif:{this.setChType(t,[32,40].indexOf(e.data[1])>-1?this.CH_DRUMS:this.CH_MELODIC,this.#a,!0);break}}this.getExt(t)[0],this.EXT_DX;break}case 38:{if(!this.#S[t]){let b=we[this.getChCc(t,100)],k=dt[this.getChCc(t,100)];this.getChCc(t,101)===0&&b!==void 0&&(this.#s[t*y.rpn+b+1]=e.data[1],this.#f[t*y.rpnt+k]=1)}break}case 64:{e.data[1]<64&&this.#I.hoOf(t);break}case 66:{e.data[1]>>6?this.#I.soOn(t):this.#I.soOf(t);break}case 98:case 99:{this.#S[t]=1;break}case 100:case 101:{this.#S[t]=0;break}}this.setChCc(t,e.data[0],e.data[1]),this.dispatchEvent("cc",{part:t,cc:e.data[0],data:e.data[1]})}r.getChModeId(t)===v.xg&&r.#i[t]&&r.setDrumFirstWrite(t)},12:function(e){let t=e.channel,r=this;switch(r.#a){case v.s90es:case v.motif:{e.data&&r.setChActive(t,1);break}default:r.setChActive(t,1)}let o=R[t];switch(r.getExt(t)[0]){case r.EXT_VL:break}r.#n[t]=e.data,r.#N[t]=0,r.pushChPrimitives(t),T()&&console.debug(`T:${e.track} C:${t} P:${e.data}`),r.getChModeId(t)===v.xg&&r.#i[t]&&r.setDrumFirstWrite(t)},13:function(e){let t=this,r=e.channel;this.#c.forEach(function(o){let f=o>>7;r===f&&(t.#m[o]=e.data,t.dispatchEvent("note",{part:r,note:o&127,velo:e.data,state:t.NOTE_SUSTAIN}))})},14:function(e){let t=e.channel;this.#R[t]=e.data[1]*128+e.data[0]-8192,this.dispatchEvent("pitch",{part:t,pitch:this.getPitchShift(t)})},15:function(e){ia(e.data).forEach(t=>{let r=t[0],o=t[1];this.#me=t.length,(this.#we[r]||function(){console.debug(`Unknown manufacturer ${r}.`)})(o,t.subarray(2),e.track)})},248:function(e){},250:function(e){},251:function(e){},252:function(e){},254:function(e){},255:function(e){(this.#V[e.meta]||function(r,o,f){}).call(this,e.data,e.track,e.meta),e.meta!==32&&(this.#j=0);let t=ea.indexOf(e.meta)>-1;if(T()&&console.debug(e),t)return e.reply="meta",e}};#we={64:(e,t,r)=>{this.#de.run(t,r,e)},65:(e,t,r)=>{if(t[0]<16)if(t[1]===72){let o=t[t.length-1],f=ee(t.subarray(3,t.length-1));o===f?this.#z.run(t.subarray(0,t.length-1),r,e):console.warn(`Bad SD checksum ${o} - should be ${f}.`)}else this.#z.run(t,r,e);else{let o=t[t.length-1],f=ee(t.subarray(2,t.length-1));o===f?this.#z.run(t.subarray(0,t.length-1),r,e):console.warn(`Bad GS checksum ${o} - should be ${f}.`)}},66:(e,t,r)=>{this.#Q.run(t,r,e)},67:(e,t,r)=>{switch(e>>4){case 0:{let o=0;for(;t[o]===127&&o<4;)o++;let f=t[1+o]<<7|t[2+o];if(f+7+o!==t.length){console.warn(`Yamaha bulk dump length mismatch! Expected ${t.length-7-o}, received ${f}.`),console.debug(t);break}let p=ee(t.subarray(1+o,t.length-1)),g=t[t.length-1];if(t[t.length-1]>>7)console.warn(`Yamaha bulk dump checksum invalid! Expected ${p}, received ${g}:
`),console.debug(t);else if(p!==g)console.warn(`Yamaha bulk dump checksum mismatch! Expected ${p}, received ${g}:
`),console.debug(t);else{let b=t.slice(2,t.length-1);for(let k=0;k<=o;k++)b[k]=t[k];this.#U.run(b,r,e&15)}break}case 1:{this.#U.run(t,r,e&15);break}case 2:{console.warn("Octavia doesn't yet support Yamaha bulk dump requests.");break}case 3:{console.warn("Octavia doesn't yet support Yamaha parameter requests.");break}case 7:{switch(e&15){case 14:{let o=new Uint8Array(t.length+1);o[0]=126,o.set(t,1),this.#U.run(o,r,0);break}default:console.warn(`Unknown Yamaha special SysEx type: ${e}.`)}break}default:console.warn(`Unknown Yamaha SysEx type: ${e>>4}.`)}},68:(e,t,r)=>{this.#he.run(t,r,e)},71:(e,t,r)=>{this.#fe.run(t,r,e)},126:(e,t,r)=>{this.#oe.run(t,r,e)},127:(e,t,r)=>{this.switchMode("gm",0),this.#ce.run(t,r,e)}};#oe;#ce;#U;#z;#Q;#de;#fe;#he;buildRchTree(){let e=[];this.#d.forEach((t,r)=>{t<y.ch&&(e[t]?.constructor||(e[t]=[]),e[t].push(r))}),this.#ye=e}buildRccMap(){let e=this;for(let t=0;t<y.ch;t++)e.#ne[t]={};e.#Z.forEach((t,r)=>{t&&(e.#ne[Math.floor(r/y.redir)][t]=r%y.redir|128)}),T()&&console.debug(e.#ne)}invokeSysExIndicator(){this.dispatchEvent("mupromptex",this.#me)}getActive(){return this.#P}getChActive(e){return this.#P[e]}getCc(e){if(typeof e!="number"||e<0||e>=y.ch)throw new RangeError(`Invalid part number: CH${e+1}`);let t=this,r=R[e];return t.#e.subarray(r,r+y.cc)}getChCc(e,t){let r=this;if(te.indexOf(t)<0)throw new Error("CC number not accepted");return r.#e[R[e]+x[t]]}getChCcWritten(e,t){let r=this;if(te.indexOf(t)<0)throw new Error("CC number not accepted");return r.#e[y.chcc+R[e]+x[t]]}setChCc(e=0,t,r){let o=this;if(te.indexOf(t)<0)throw new Error("CC number not accepted");if(r?.constructor!==Number)throw new TypeError("Expected numbers for value");let f=r&255,p=R[e]+x[t];o.#e[p]=f,o.#e[p+y.chcc]=1,o.dispatchEvent("cc",{part:e,cc:t,data:f})}getCcAll(){return this.#e.slice()}resetCc(e){let t=this,r=R[e]+y.chcc;t.#e.fill(0,r,r+y.cc)}resetChCc(e,t,r){let o=this;r?.constructor&&o.setChCc(e,t,r),o.#e[R[e]+x[t]+y.chcc]=0}resetCcAll(){this.#e.fill(0,y.chcc,y.chcc<<1)}isChCcWritten(e,t){if(te.indexOf(t)<0)throw new Error("CC number not accepted");return upThis.#e[R[e]+x[t]+y.chcc]}getChSource(){return this.#d}getChType(e=0){return this.#i[e]}getChTypes(){return this.#i}setChType(e,t,r=0,o=!1){t&=15;let f=this;r=r||f.getChModeId(e),f.#i[e]=t,t>0&&!o&&(f.setChCc(e,0,f.#l[r][2]),f.pushChPrimitives(e))}setChActive(e,t=0){this.#P[e]!==t&&this.dispatchEvent("channeltoggle",{part:e,active:t}),this.#P[e]=t}getExt(e){let t=y.ext*e,r=this.#y.subarray(t,t+y.ext),o=new Uint8Array(r.length);switch(o.set(r),o[0]){case this.EXT_VL:{o[1]=o[1]||this.modelEx.vl.breath;break}}return o}getProgram(){return this.#n}getTexts(){return this.#F.slice()}getVel(e){let t=new Map,r=this;return r.#c.forEach(function(o,f){let p=o>>7,g=o&127;e===p&&r.#m[o]>0&&t.set(g,{v:r.#m[o],s:r.#o[f]})}),t}getBitmap(){return{bitmap:this.#k,expire:this.#C}}getLetter(){return{text:this.#q,set:this.#re,expire:this.#G}}getMode(){return L[this.#a]}getMaster(){return{volume:this.#p}}getRpn(){return this.#s}getNrpn(){return this.#J}getSubDb(){return self?.structuredClone(this.#l)}getDetect(){return self?.structuredClone(this.#r)}getVoice(e,t,r,o="?",f=0){let p=this;v[o]?.constructor||(o="?");let g=v[o],b=e||p.#l[g][0],k=t,C=r||p.#l[g][1];b===K.bank0&&(b=0),C===K.bank0&&(C=0),o==="ns5r"&&b>0&&b<56&&(C=3);let a=p.userBank.get(b,k,C,o,f);if(o==="mt32"&&a.name.indexOf("MT-m:")===0){let s=parseInt(a.name.slice(5)),c=s*y.cmt,i="";p.#L.subarray(c,c+10).forEach(l=>{l>31&&(i+=String.fromCharCode(l))});let d=`MSB	LSB	PRG	NME
49	127	${k}	${i}`;p.userBank.load(d,!0),a.name=i,a.ending=" "}return(a.ending!==" "||!a.name.length)&&(a=p.baseBank.get(b,k,C,o,f)),a}getChPrimitive(e,t,r){if(t>=y.vxPrim||t?.constructor!==Number)throw new RangeError(`Invalid voice primitive component "${t}"`);if(typeof e!="number"||e<0||e>=y.ch)throw new RangeError(`Invalid part number: CH${e+1}`);let o=this,f=o.#n[t<<y.chShift|e];switch(t){case 1:case 2:{o.getChCcWritten(e,[255,0,32][t])||(f=f||o.#l[o.getChModeId(e)][t+2]),r&&(f=f||o.#l[o.getChModeId(e)][t-1]),f===K.bank0&&(f=0);break}}return f}getChPrimitives(e,t){let r=this,o=new Uint8Array(3);return o[1]=r.#n[e],o[0]=r.getChPrimitive(e,1,t),o[2]=r.getChPrimitive(e,2,t),o}pushChPrimitives(e){let t=this;t.#n[1<<y.chShift|e]=t.getChCc(e,0),t.#n[2<<y.chShift|e]=t.getChCc(e,32),t.dispatchEvent("voice",{part:e})}getChCvnBuffer(e,t=y.cvn){if(t>y.cvn||t<1)throw new RangeError("Invalid custom voice name buffer length");let r=ie[e];return this.#X.subarray(r,r+t)}getChCvnRegister(e,t){if(t>=y.cvn||t<0)throw new RangeError("Invalid custom voice name register");return this.#X[ie[e]+t]}setChCvnRegister(e,t,r=32){if(t>=y.cvn||t<0)throw new RangeError("Invalid custom voice name register");this.#H[e]=1,this.#X[ie[e]+t]=Math.max(32,r&255)}resetChCvn(e){this.#X.fill(32,ie[e],ie[e]+y.cvn),this.#H[e]=0}getChCvnString(e,t){let r=sa.decode(this.getChCvnBuffer(e));return t||(r=r.trimEnd()),r}getChCvnIsWritten(e){return this.#H[e]}getChVoice(e){let t=this,r=t.getVoice(...t.getChPrimitives(e),t.getChMode(e),t.modelEx[t.getChMode(e)]?.map??0);if(t.#N[e]){let o="";switch(t.#a){case v.mt32:{t.#_.subarray(y.cmt*(e-1),y.cmt*(e-1)+10).forEach(f=>{o+=String.fromCharCode(Math.max(f,32))}),o=o.trimEnd();break}default:o=t.getChCvnString(e)}o.length&&(r.ending="~",r.name=o)}return r}getRawPitch(){return this.#R}getPitchShift(e){let t=this,r=e*y.rpn,o=t.#s[r];return t.#f[e*y.rpnt]?o>>7&&(o-=256):t.#a===v.mt32&&(o=12),t.#R[e]/8192*o+(t.#s[r+3]-64)+((t.#s[r+1]<<7)+t.#s[r+2]-8192)/8192}getEffectType(e=0){let t=3*e+1;return this.#O.subarray(t,t+2)}getPolyState(e=0){return this.#o[e]}setEffectTypeRaw(e=0,t,r){let o=3*e;this.#O[o]=1,this.#O[o+1+ +t]=r}setEffectType(e=0,t,r){this.setEffectTypeRaw(e,!1,t),this.setEffectTypeRaw(e,!0,r)}pushEffectType(e=0,t=!1){if(e<0||e>=y.efx)throw new RangeError(`Invalid EFX slot ${e}`);let r=this.getEffectType(e);t||r[0]===0&&r[1]>>4===15&&(t=!0),this.dispatchEvent(`efx${ue[e]}`,{id:r,hidden:t})}getEffectSink(){return this.#K}getChEffectSink(e){return this.#K[e]}setChEffectSink(e,t=0){let r=this;if(t<0||t>=y.efx)throw new RangeError(`Invalid EFX slot ${t}`);if(e<0||e>=y.ch)throw new RangeError(`Invalid CH${e+1}`);this.#K[e]=t,this.dispatchEvent("partefxtoggle",{part:e,active:t})}setXgChEffectSink(e,t=0){let r=this,o=r.modelEx.xg,f=t-2;if(t<0||f>=o.insPart.length)throw new RangeError(`Invalid XG insertion slot ${f}`);let p=o.insPart[f];o.insPart[f]=e,p!==y.invalidCh&&r.setChEffectSink(p,0),e===y.invalidCh?p!==y.invalidCh&&r.setChEffectSink(p,0):r.setChEffectSink(e,t)}setLetterDisplay(e,t,r=0,o=3200){let f=this,p;f.#q=" ".repeat(r),e.forEach(g=>{f.#q+=String.fromCharCode(g>31?g:32),g<32&&(p=p||new Set,p.add(g))}),f.#re=f.clockSource.now(),f.#G=f.clockSource.now()+o,f.dispatchEvent("letter"),p&&(p=Array.from(p),p.forEach((g,b,k)=>{k[b]=g.toString(16).padStart(2,"0")}),console.warn(`${t}${t?" ":""}invalid code point${p.length>1?"s":""}: 0x${p.join(", 0x")}`))}setDetectionTargets(e="?",t=0){let r=this,o=-1;switch(e.replaceAll(", ",",").split(",").forEach(f=>{f=f.toLowerCase();let p=L.indexOf(Jt[f]||f);T()&&console.debug(`Mapped mode "${f}" to ID "${p}".`),p>-1&&(o=p)}),T()&&console.debug(`Set detection target to ID "${o}".`),o>0&&(r.#r.x5=82,r.#r.ds=v.krs,r.#r.gm=v.gm,r.#r.g2=v.g2),o){case v["05rw"]:{r.#r.x5=81;break}case v.s90es:{r.#r.ds=v.s90es,r.#r.smotif=v.s90es;break}case v.motif:{r.#r.ds=v.motif,r.#r.smotif=v.motif;break}case v.sd:{r.#r.g2=v.sd;break}case v.pa:{r.#r.g2=v.pa;break}}}setGsTargets(e=!1,t=4){if(!t)t=e?3:4;else{if(t>4||t<0)throw new Error(`Invalid GS level ${t}`);if(e&&t>>1!==1)throw new Error(`Invalid SC level ${t}`)}let r=this;r.#r[e?"sc":"gs"]=t,r.#l[v[e?"sc":"gs"]][1]=t,r.forceVoiceRefresh()}getConfigs(){return this.#te}setDumpLimit(e){if(e>2||e<0)throw new RangeError("Invalid dump limit.");this.#A.dumpLimit=e}allocateAce(e=0,t){let r=this;if(!t||t<128&&t>95){console.warn(`cc${t} cannot be allocated as an active custom effect.`);return}let o=!0,f=0,p=y.ace*e;for(;o&&f<y.ace;)r.#b[f+p]===t?o=!1:r.#b[f+p]||(o=!1,r.#b[f+p]=t,console.debug(`Allocated cc${t} to ACE slot ${f} in CH${e+1}.`)),f++;f>=y.ace&&console.warn(`ACE slots are full in CH${e+1}.`)}allocateAceAll(e){let t=this;if(!e||e<128&&e>95){console.warn(`cc${e} cannot be allocated as an active custom effect.`);return}for(let r=0;r<y.ch;r++){let o=!0,f=0,p=y.ace*r;for(;o&&f<y.ace;)t.#b[f+p]===e?o=!1:t.#b[f+p]||(o=!1,t.#b[f+p]=e),f++;f>=y.ace&&console.warn(`ACE slots are full in CH${r+1}.`)}}resetAce(){this.#b.fill(0),console.info("All ACE slots have been reset.")}resetChAceAll(e=0){this.#b.subarray(ke[e],ke[e]+y.ace).fill(0)}resetChAce(e=0,t){let r=!0,o=ke[e],f=o+y.ace;for(;r&&o<f;)this.#b[o]===t&&(this.#b[o]=0,r=!1),o++;r&&T()&&console.debug(`No ACE slot was allocated to cc${t} in CH${e+1}.`)}getAce(){return this.#b}getChAce(e=0,t=0){if(t<0||t>=y.ace)throw new RangeError("No such ACE slot");let r=this.#b[y.ace*e+t];if(r){if(te.indexOf(r)>=0)return this.getChCc(e,r);throw new Error(`Invalid ACE source in CH${e+1}: ${r}`)}else return 0}initDrums(){let e=this;e.#D.fill(64);for(let t=0;t<y.drm;t++){let r=t*y.dpn;for(let o in ht){let f=ht[o],p=(r+X[o])*y.dnc;e.#D.subarray(p,p+y.dnc).fill(f)}}}init(e=0){let t=this;t.#j=0,t.#l[v.xg][1]=0,t.modelEx.xg.map=0,t.dispatchEvent("banklevel",{mode:"xg",data:t.modelEx.xg.map}),t.#P.fill(0),t.#e.fill(0),t.#b.fill(0),t.#n.fill(0),t.#m.fill(0),t.#c.fill(0),t.#o.fill(0),t.#u.fill(0),t.#T.fill(0),t.#R.fill(0),t.#J.fill(0),t.#f.fill(0),t.#y.fill(0),t.#g.fill(0),t.#E.fill(0),t.#Y.fill(0),t.#Z.fill(0),t.#p=100,t.#F=[],t.#ae=500,t.modelEx.sg.convLastSyll=0,t.modelEx.sg.runLineLen=0,t.modelEx.sg.splitMask=!1,t.#C=0,t.#h=0,t.lcdContrast=16,t.lcdHideBankInfo=!1;for(let r=0;r<t.#v.length;r++)t.#k.fill(0);t.#w=t.KARAOKE_NONE,t.#pe=0,t.#W=!0,t.#M=!1,t.#me=0,t.initDrums(),t.polyIndexLatest=0,t.polyIndexLast=0,t.#d.forEach(function(r,o,f){f[o]=o}),e===0&&(t.dispatchEvent("mode","?"),t.#a=0,t.#ee.fill(0),t.#se.fill(0),t.#G=0,t.#q=""),jt.forEach(r=>{t.setChCc(r,0,t.#l[t.getChModeId(r)][2])}),t.#i.fill(t.CH_MELODIC),t.#i[9]=t.CH_DRUM1,t.#i[25]=t.CH_DRUM3,t.#i[41]=t.CH_DRUMS,t.#i[57]=t.CH_DRUMS,t.#i[73]=t.CH_DRUM5,t.#i[89]=t.CH_DRUM7,t.#i[105]=t.CH_DRUMS,t.#i[121]=t.CH_DRUMS;for(let r=0;r<y.drm;r++)t.#B[r<<1]=0,t.#B[r<<1|1]=y.invalidCh;t.#t.fill(0),t.#L.fill(0),t.#$.fill(0),t.#_.fill(0),t.#N.fill(0),t.#O.fill(0),t.#K.fill(0),t.aiEfxName="",t.userBank.clearRange({msb:0,lsb:127,prg:[0,127]}),t.modelEx.xg.varSys=!1,t.modelEx.xg.insPart.fill(y.invalidCh);for(let r=0;r<F.length;r++){let o=t.modelEx.yPlg[r];o.fill(0,0,F[r][2]),o.fill(y.invalidCh,F[r][2])}t.modelEx.sc.showBar=!0,t.modelEx.sc.invBar=!1,t.modelEx.sc.invDisp=!1,t.modelEx.sc.peakHold=1,t.modelEx.cs1x.perfCh=0;for(let r=0;r<y.ch;r++){t.resetChCvn(r);let o=R[r];t.#e[o+x[7]]=100,t.#e[o+x[11]]=127,t.#e[o+x[2]]=127,t.#e[o+x[10]]=64,t.#e.subarray(o+x[71],o+x[71]+8).fill(64),t.#e[o+x[128]]=127,t.#e.subarray(o+x[130],o+x[157]+1).fill(64),t.#e[o+x[91]]=40,t.#e[o+x[101]]=127,t.#e[o+x[100]]=127,t.#e[o+x[99]]=127,t.#e[o+x[98]]=127;let f=r*y.rpn;t.#s[f]=2,t.#s[f+1]=64,t.#s[f+2]=0,t.#s[f+3]=64,t.#s[f+4]=0,t.#s[f+5]=0;let p=r*y.ext;t.#y[p+1]=t.VLBC_BRTHEXPR;let g=r*y.redir;t.#Z[g+8]=13}t.switchMode("?",3),t.buildRchTree(),t.buildRccMap(),t.dispatchEvent("mastervolume",t.#p);for(let r=0;r<ue.length;r++)t.pushEffectType(r);t.dispatchEvent("reset")}setChMode(e,t){let r=this;if(typeof e!="number"||e<0||e>=y.ch)throw new RangeError(`Invalid part number: CH${e+1}`);if(e<0||t>=L.length)throw new RangeError(`Invalid mode ID ${t}`);r.#Y[e]=t,r.dispatchEvent("chmode",{part:e,id:t,mode:L[t]}),r.pushChPrimitives(e)}getChMode(e,t){return L[this.getChModeId(e,t)]}getChModeId(e,t){return t?this.#Y[e]||this.#g[e>>4]:this.#Y[e]||this.#g[e>>4]||this.#a}getPortMode(e,t){return L[this.getPortModeId(e,t)]}getPortModeId(e,t){return t?this.#g[e]:this.#g[e]||this.#a}setPortMode(e,t,r){let o=this;if(e<0||e>=y.ch>>4)throw new RangeError(`Invalid port ${e+1}`);if(t<1)throw new RangeError("Range must be a positive integer");if(e+t>=y.ch>>4)throw new RangeError("Range must be in bound");if(e<0||r>=L.length)throw new RangeError(`Invalid mode ID ${r}`);o.#E[e]=r;for(let f=e;f<e+t;f++){let p=o.#E[f];if(t>1&&p!==0&&p!==r)break;o.#g[f]=r;for(let g=f<<4;g<f+1<<4;g++)o.dispatchEvent("chmode",{part:g,id:r,mode:L[r]}),o.pushChPrimitives(g)}}copyChSetup(e,t,r){if(e===t){console.warn(`Failed attempt at overwriting CH${e+1} with its own data.`);return}let o=this;if(r&&o.#P[t]){console.warn(`Failed attempt at copying setup data from CH${e+1} to CH${t+1}.`);return}let f=R[e],p=R[t];o.#n[t]=o.#n[e],o.#e.set(o.#e.subarray(f,f+y.cc),p),o.pushChPrimitives(t)}setDrumFirstWrite(e,t){let r=this,o=r.#i[e];if(o<2)return;let f=o-2;if(r.#B[f<<1])if(t)r.#B[f<<1]=0,T()&&console.debug(`First write part for drum set ${f+1} has been reset.`);else return;else t?console.warn(`First write part for drum set ${f+1} is already blank.`):(r.#B[f<<1]=1,r.#B[f<<1|1]=e,console.debug(`First write part for drum set ${f+1} is set to CH${e+1}.`))}getChDrumFirstWrite(e){let t=this,r=t.#i[e];if(r<2)return;let o=r-2;return t.#B.subarray(o<<1,o+1<<1)}getDrumFirstWrite(e){if(e>=0&&e<y.drm)return this.#B.subarray(e<<1,e+1<<1)}switchMode(e,t=0,r=!1){T()&&console.debug(`Requested level ${t} mode change to "${e}".`);let o=this,f=v[e];if(f>-1){if(o.#a===0&&t!==3||t){if(o.initOnReset)switch(t){case 1:{o.#a===0&&o.init(1);break}case 2:{o.init(1);break}}switch(o.#h=0,f){case v.gm:{f=o.#r.gm;break}case v.g2:{f=o.#r.g2;break}}switch(o.#a=f,f){case v.gs:case v.sc:{o.#l[v[e]][1]=o.#r[e];break}}for(let b=0;b<y.ch;b++){let k=o.getChModeId(b,!0);o.#i[b]>0&&k===v["?"]&&(o.setChCc(b,0,o.#l[f][2]),T()&&console.debug(`CH${b+1} (${o.#i[b]}) (${o.getChMode(b)}), ${L[k]} (${o.#l[k][2]}) -> ${L[f]} (${o.#l[f][2]})`),o.pushChPrimitives(b))}switch(f){case v.mt32:{De.forEach((b,k)=>{let C=k+1;o.#P[C]||(o.#n[C]=b,o.setChCc(C,91,127),o.pushChPrimitives(C))});for(let b=1;b<10;b++)o.pushChPrimitives(b);break}}let p,g;switch(f){case v["?"]:case v.g2:{p=[52,4,52,18,0,255,0,255,0,255,0,255,0,255,0,255];break}case v.xg:case v.cs1x:{p=[1,0,65,0,5,0,64,0,64,0,64,0,64,0,0,255],g=[64,0];break}case v.gm:case v.gs:case v.sc:{p=[40,4,40,18,40,32,32,0,0,255,0,255,0,255,0,255],g=[32,0];break}case v.sd:{p=[58,0,60,0,61,0,61,0],g=[61,0];break}case v["05rw"]:case v.x5d:case v.ns5r:{p=[44,1,44,19,0,255,0,255,0,255,0,255,0,255,0,255];break}case v.k11:case v.sg:{p=[24,0,0,255,0,255,0,255,0,255,0,255,0,255,0,255];break}case v.mt32:{p=[40,4,0,255,0,255,0,255,0,255,0,255,0,255,0,255];break}case v.doc:{p=[24,16,0,255,0,255,0,255,0,255,0,255,0,255,0,255];break}case v.motif:case v.s90es:case v.cs6x:{p=[129,0,133,0,130,0,128,0,128,0,0,255,0,255,0,255],g=[128,0];break}case v.pa:{p=[28,52,28,16,28,0,28,0,0,255,0,255,0,255,0,255],g=[28,0];break}case v.krs:{p=[45,0,45,0,0,255,45,0,45,0,45,0,45,0,45,0],g=[45,0];break}default:p=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}for(let b=0;b<y.efx;b++)if(!o.#O[3*b]&&typeof p[b<<1]=="number"){o.#O[3*b+1]=p[b<<1],o.#O[3*b+2]=p[b<<1|1];let k=!1;g?.length>0&&p[b<<1]===g[0]&&p[b<<1|1]===g[1]&&(k=!0),o.pushEffectType(b,k)}r&&o.setDetectionTargets(e),o.dispatchEvent("mode",L[f]),o.forceVoiceRefresh()}}else throw new Error(`Unknown mode ${e}`)}getRawStrength(){let e=this;return this.#c.forEach(function(t){let r=t>>7;e.#m[t]>e.#T[r]&&(e.#T[r]=e.#m[t])}),this.#T}getStrength(){let e=[],t=this;return this.getRawStrength().forEach(function(r,o){e[o]=Math.floor(r*t.getChCc(o,7)*t.getChCc(o,11)*t.#p/803288)}),e}newStrength(){this.#T.fill(0)}runJson(e){if(e==null){console.warn(new Error("Invalid JSON data provided."));return}if(e.type>14)return e.type===15&&e.data.constructor!==Uint8Array&&(e.data=Uint8Array.from(e.data)),this.#Ee[e.type].call(this,e);{let t=this.chRedir(e.part,e.track),r=!1;this.#ye[t]?.forEach(o=>{e.channel=o,r=!0,this.#Ee[e.type].call(this,e)}),r||console.warn(`${ct[e.type]?ct[e.type]:e.type}${[11,12].includes(e.type)?(e.data[0]!==void 0?e.data[0]:e.data).toString():""} event sent to CH${t+1} without any recipient.`)}this.#F.length>100&&this.#F.splice(100,this.#F.length-99)}runRaw(e){}async loadBank(e,t){let r=this;switch(e=e.toLowerCase(),e){case"s7e":{r.userBank.clearRange({msb:63,lsb:[21,22]}),r.userBank.clearRange({msb:63,lsb:[24,27]});break}case"pcg":{r.userBank.clearRange({msb:63,lsb:[6,9]}),r.userBank.clearRange({msb:63,lsb:[13,16]});break}default:throw new Error(`Unknown bank format ${e}`)}switch(e){case"s7e":case"pcg":{le.context=this,await r.userBank.load(await le.read(e,t),!1);break}}r.forceVoiceRefresh()}constructor(){super();let e=this;for(let a=0;a<10;a++)e.#v[a]=new Uint8Array(256);e.#v[10]=new Uint8Array(512),e.#le=new H,e.#r={x5:82,ds:v.krs,smotif:v.s90es,gs:4,sc:3,gm:v.gm,g2:v.g2},e.#A={dumpLimit:e.DUMP_MODE},e.#te=new Proxy(e.#A,{set:()=>{}});for(let a in he){let s=v[a];s===void 0?console.debug(`SubDB build error: "${a}" does not exist`):e.#l[s]=new Uint8Array(he[a])}for(let a of F)e.modelEx.yPlg.push(new Uint8Array(a[1]));e.userBank.strictMode=!0,e.userBank.load(`MSB	PRG	LSB	NME
062	000	000	
122	000	000	
122	001	000	
122	002	000	
122	003	000	
122	004	000	
122	005	000	
122	006	000	`),e.addEventListener("metacommit",function(a){let{data:s}=a;e.#F[0]?.type===s.type&&e.#F[0]?.amend?(e.#F[0].amend=s.amend,e.#F[0].data+=s.data):e.#F.unshift(s)}),e.#V[1]=function(a){switch(a=a.replaceAll(`\r
`,`
`).replaceAll("\r",`
`),a.substring(0,2)){case"@I":{e.#w=e.KARAOKE_TEXT,e.dispatchEvent("metacommit",{type:"Kar.Info",data:a.substring(2)?.trimStart()});break}case"@K":{e.#w=e.KARAOKE_TEXT;let s=a.substring(2);s!=="MIDI KARAOKE FILE"&&e.dispatchEvent("metacommit",{type:"Kar.Mode",data:s?.trimStart()}),console.debug(`Karaoke mode active: ${s}`);break}case"@L":{e.#w=e.KARAOKE_TEXT,e.dispatchEvent("metacommit",{type:"Kar.Lang",data:a.substring(2)?.trimStart()});break}case"@T":{e.#w=e.KARAOKE_TEXT,e.dispatchEvent("metacommit",{type:"KarTitle",data:a.substring(2)?.trimStart()});break}case"@V":{e.#w=e.KARAOKE_TEXT,e.dispatchEvent("metacommit",{type:"Kar.Ver.",data:a.substring(2)?.trimStart()});break}case"Mi":{if(a.substring(2,16)==="dStamp-1.00: 0"){let s=a.length;for(let i=a.length;i>0;i--)if((a.charCodeAt(i-1)>>5)+1>>1===1){s=i;break}let c=a.substring(16,s);e.dispatchEvent("metacommit",{type:"MidStamp",data:ot(c)})}else a.split(`
`).forEach((s,c)=>{e.dispatchEvent("metacommit",{type:"Cmn.Text",data:s,mask:c!==0})});break}case"XF":{let s=a.slice(2).split(":");switch(s[0]){case"hd":{s.slice(1).forEach((c,i)=>{c.length&&e.dispatchEvent("metacommit",{type:["XfSngDte","XfSngRgn","XfSngCat","XfSongBt","XfSngIns","XfSngVoc","XfSngCmp","XfSngLrc","XfSngArr","XfSngPer","XfSngPrg","XfSngTag"][i],data:c})});break}case"ln":{s.slice(1).forEach((c,i)=>{c.length&&e.dispatchEvent("metacommit",{type:["XfKarLng","XfKarNme","XfKarCmp","XfKarLrc","XfKarArr","XfKarPer","XfKarPrg"][i],data:c})});break}default:e.dispatchEvent("metacommit",{type:"XfUnData",data:a})}break}default:switch(e.#w){case e.KARAOKE_TEXT:{switch(a[0]){case"\\":{e.dispatchEvent("metacommit",{type:"KarLyric",data:"",amend:!1}),e.dispatchEvent("metacommit",{type:"KarLyric",data:a.substring(1),amend:!0});break}case"/":{e.dispatchEvent("metacommit",{type:"KarLyric",data:"",mask:!0,amend:!1}),e.dispatchEvent("metacommit",{type:"KarLyric",data:a.substring(1),mask:!0,amend:!0});break}default:e.dispatchEvent("metacommit",{type:"KarLyric",data:a,amend:!0})}break}default:a.split(`
`).forEach((s,c)=>{e.dispatchEvent("metacommit",{type:"Cmn.Text",data:s,mask:c!==0})})}}},e.#V[2]=function(a){e.dispatchEvent("metacommit",{type:"Copyrite",data:a})},e.#V[3]=function(a,s){s<1&&e.#j<1&&e.dispatchEvent("metacommit",{type:"TrkTitle",data:a})},e.#V[4]=function(a,s){e.dispatchEvent("metacommit",{type:"Instrmnt",data:a})},e.#V[5]=function(a){switch(e.#w){case e.KARAOKE_XF:{let s="";for(let c of a)switch(c){case"^":case"%":{s+=" ";break}case">":{s+="	";break}case"<":{e.dispatchEvent("metacommit",{type:"KarLyric",data:s,mask:e.#M,amend:!1}),s="",e.#M=!1;break}case"/":{e.dispatchEvent("metacommit",{type:"KarLyric",data:s,mask:!1,amend:!1}),s="",e.#M=!0;break}default:s+=c}s.length>0&&(e.dispatchEvent("metacommit",{type:"KarLyric",data:s,mask:e.#M,amend:!0}),e.#M=!1);break}default:{let s=0,c=!0,i=a.length-1;for(;c&&s<8;)switch(a.charCodeAt(s)){case 32:{s++;break}default:c=!1}switch(s>0&&(e.dispatchEvent("metacommit",{type:"C.Lyrics",data:a.substring(0,s),amend:!0,mask:e.#M,untimed:!0}),e.#M=!1),a.charCodeAt(i)){case 10:{e.dispatchEvent("metacommit",{type:"C.Lyrics",data:a.substring(s,i),amend:!1,mask:e.#M}),e.#M=!1;break}case 11:case 13:{e.dispatchEvent("metacommit",{type:"C.Lyrics",data:a.substring(s,i),amend:!1,mask:e.#M}),e.#M=!0;break}case 32:{e.dispatchEvent("metacommit",{type:"C.Lyrics",data:a.substring(s,i),amend:!0,mask:e.#M}),e.dispatchEvent("metacommit",{type:"C.Lyrics",data:" ",amend:!0,mask:!1,untimed:!0}),e.#M=!1;break}default:a.trim()===""?console.info("Blank line? Shouldn't happen."):e.dispatchEvent("metacommit",{type:"C.Lyrics",data:a,amend:!0,mask:e.#M}),e.#M=!1}break}}},e.#V[6]=function(a){e.dispatchEvent("metacommit",{type:"C.Marker",data:a})},e.#V[7]=function(a){switch(a[0]){case"$":{if(a.substring(1,5)==="Lyrc"){e.#w=e.KARAOKE_XF;let s=a.substring(6).split(":"),c=s[0].replaceAll(" ","").split(",");c.forEach((d,l,h)=>{h[l]=parseInt(d)-1});let i=et[s[2].substring(0,2).toLowerCase()];e.dispatchEvent("metacommit",{type:"XfMeloCh",data:`CH${s[0].replaceAll(" ","").split(",").join(", CH")}`,parsed:c}),e.dispatchEvent("metacommit",{type:"XfLyrOff",data:s[1],parsed:parseInt(s[1])}),e.dispatchEvent("metacommit",{type:"XfLyrEnc",data:i[1],parsed:i[0]}),e.#M=!1}else e.dispatchEvent("metacommit",{type:"CuePoint",data:a});break}case"#":{e.dispatchEvent("metacommit",{type:"XfScneNo",data:a.substring(1)});break}case"&":{a.length===2?(e.dispatchEvent("metacommit",{type:"XfSngPrt",data:tt[a[1]]||`Unknown "${a[1]}"`}),e.#M=!1):e.dispatchEvent("metacommit",{type:"CuePoint",data:a});break}default:e.dispatchEvent("metacommit",{type:"CuePoint",data:a})}},e.#V[32]=function(a){e.#j=a[0]+1},e.#V[33]=function(a,s){T()&&console.debug(`Track ${s} requests assigning to port ${a}.`),e.#se[s]=a+1},e.#V[81]=function(a,s){e.#ae=a/1e3},e.#V[127]=function(a,s){e.#le.run(a,s)},e.#le.default=function(a){let s=[];for(let c=0;c<8&&c<a.length;c++)s.push(a[c].toString(16).padStart(2,"0").toUpperCase());console.warn(`Unrecognized implementation-specific byte sequence: ${s.join(" ")}${a.length>8?" ...":""}
%o`,a)},e.#le.add([67,0,1],(a,s)=>{T()&&console.debug(`XGworks requests assigning track ${s} to port ${a[0]}.`),e.#se[s]=a[0]+1}).add([67,123,1],(a,s)=>{let c=[];for(let i=0;i<a.length;i+=2){let d=a[i]>>4,l=a[i]&15;if(d<7&&l&&l<8){let h=new Uint8Array(5);h[0]=l-1,h[1]=d-3<<2,h[2]=a[i|1],c.push(h)}}e.dispatchEvent("metacommit",{type:"ChordCtl",src:"yxf",data:c}),console.debug("Yamaha XF chord data: %o",c)}).add([67,123,2],(a,s)=>{let c=new Uint8Array(2);c[0]=a[0]&15,c[1]=a[0]>>4,e.dispatchEvent("metacommit",{type:"RhrslMrk",src:"yxf",data:c}),console.debug(`Yamaha XF rehearsal mark: ${["Intro","Ending","Fill-in"][c[0]]??String.fromCharCode(62+c[0])}${"'".repeat(c[1])} %o`,c)}).add([67,123,96],(a,s)=>{let c=[0,0];a.subarray(1,3).forEach(i=>{c[0]=c[0]<<7,c[0]|=i&127}),a.subarray(3,5).forEach(i=>{c[1]=c[1]<<7,c[1]|=i&127}),e.dispatchEvent("metacommit",{type:"YStyleId",data:c}),console.debug(`Yamaha style ID: model ${c[0].toString(16)}, style ${c[1]+1}`)}),e.#oe=new H("universal non-realtime"),e.#ce=new H("universal realtime"),e.#U=new H("Yamaha"),e.#z=new H("Roland"),e.#Q=new H("Korg"),e.#de=new H("Kawai"),e.#fe=new H("Akai"),e.#he=new H("Casio");let t=new H("DX7+ Dump"),r=function(a){let s=[];for(let c=0;c<8&&c<a.length;c++)s.push(a[c].toString(16).padStart(2,"0").toUpperCase());console.info(`Unrecognized SysEx in "${this.name}" set: ${s.join(" ")}${a.length>8?" ...":""}
%o`,a)};e.#oe.default=r,e.#ce.default=r,e.#U.default=r,e.#z.default=r,e.#Q.default=r,e.#de.default=r,e.#fe.default=r,e.#he.default=r,t.default=r,e.#oe.add([9],(a,s,c)=>{e.switchMode(["gm","?","g2"][a[0]-1],2),e.setPortMode(e.getTrackPort(s),1,[v.gm,v["?"],e.#r.g2][a[0]-1]),e.#w=e.#w||e.KARAOKE_NONE,console.info(`MIDI reset: ${["GM","Init","GM2"][a[0]-1]}`),a[0]===2&&e.init()}),e.#ce.add([4,1],(a,s,c)=>{e.invokeSysExIndicator(),e.#p=((a[1]<<7)+a[0])/16383*100,e.dispatchEvent("mastervolume",e.#p)}).add([4,3],(a,s,c)=>((a[1]<<7)+a[0]-8192)/8192).add([4,4],(a,s,c)=>a[1]-64).add([4,5],(a,s,c)=>{e.invokeSysExIndicator();let i=a[0],d=a[1],l=a[2],h=3,m=h+(i<<1),u=m+d;if(i!==1){console.error(`Unsupported GM2 global parameter set: slotpath length too long (${i})!
`,a);return}let E=0,w=0,$=0;switch(a.subarray(h,m).forEach(M=>{E=E<<7,E|=M}),T()&&console.debug(`GM2 global parameter: (${a.subarray(3,m)}; p: ${w}, v: ${$})`),E){case 129:{w===0&&(e.setEffectType(0,52,$),e.pushEffectType(0));break}case 130:{w===0&&(e.setEffectType(1,52,$|16),e.pushEffectType(1));break}default:T()&&console.debug("GM2 global paramater slot path unknown.")}}),this.#U.add([76,0,0],(a,s,c)=>{switch(a[0]){case 125:{e.initDrums(),console.info(`XG drum setup reset on drum kit ${a[1]}.`);break}case 126:{e.switchMode("xg",2),e.setPortMode(e.getTrackPort(s),4,v.xg),e.modelEx.vl.module=0,e.#w=e.#w||e.KARAOKE_NONE,console.info("MIDI reset: XG");break}default:{e.invokeSysExIndicator();let i=[0,0,0,0],d=(l,h)=>{i[h]=l};if(a.subarray(1).forEach((l,h)=>{let m=h+a[0];([d,d,d,d,u=>{this.#p=u*129/16383*100,e.dispatchEvent("mastervolume",e.#p)},u=>{},u=>{}][m]||(()=>{}))(l,h)}),a[0]<4){let l=0;i.forEach(h=>{l=l<<4,l+=h}),l-=1024,console.debug(`Master tune: ${l}`)}}}}).add([76,2,1],(a,s,c)=>{e.invokeSysExIndicator();let i="XG ";a[0]<32?(i+="reverb ",a.subarray(1).forEach((d,l)=>{([h=>{e.setEffectTypeRaw(0,!1,h),console.info(`${i}main type: ${oe[h]}`),e.pushEffectType(0)},h=>{e.setEffectTypeRaw(0,!0,h),console.debug(`${i}sub type: ${h+1}`),e.pushEffectType(0)},h=>{console.debug(`${i}time: ${qe(h)}s`)},h=>{console.debug(`${i}diffusion: ${h}`)},h=>{console.debug(`${i}initial delay: ${h}`)},h=>{console.debug(`${i}HPF cutoff: ${ae[h]}Hz`)},h=>{console.debug(`${i}LPF cutoff: ${ae[h]}Hz`)},h=>{console.debug(`${i}width: ${h}`)},h=>{console.debug(`${i}height: ${h}`)},h=>{console.debug(`${i}depth: ${h}`)},h=>{console.debug(`${i}wall type: ${h}`)},h=>{console.debug(`${i}dry/wet: ${h}`)},h=>{console.debug(`${i}send: ${_(h)}dB`)},h=>{console.debug(`${i}pan: ${h-64}`)},!1,!1,h=>{console.debug(`${i}delay: ${h}`)},h=>{console.debug(`${i}density: ${h}`)},h=>{console.debug(`${i}balance: ${h}`)},h=>{},h=>{console.debug(`${i}feedback: ${h}`)},h=>{}][a[0]+l]||function(){console.warn(`Unknown XG reverb address: ${a[0]}.`)})(d)})):a[0]<64?(i+="chorus ",a.subarray(1).forEach((d,l)=>{([h=>{e.setEffectTypeRaw(1,!1,h),console.info(`${i}main type: ${oe[h]}`),e.pushEffectType(1)},h=>{e.setEffectTypeRaw(1,!0,h),console.debug(`${i}sub type: ${h+1}`),e.pushEffectType(1)},h=>{console.debug(`${i}LFO: ${ze[h]}Hz`)},h=>{},h=>{console.debug(`${i}feedback: ${h}`)},h=>{console.debug(`${i}delay offset: ${Qe(h)}ms`)},h=>{},h=>{console.debug(`${i}low: ${ae[h]}Hz`)},h=>{console.debug(`${i}low: ${h-64}dB`)},h=>{console.debug(`${i}high: ${ae[h]}Hz`)},h=>{console.debug(`${i}high: ${h-64}dB`)},h=>{console.debug(`${i}dry/wet: ${h}`)},h=>{console.debug(`${i}send: ${_(h)}dB`)},h=>{console.debug(`${i}pan: ${h-64}`)},h=>{console.debug(`${i}to reverb: ${_(h)}dB`)},!1,h=>{},h=>{},h=>{},h=>{console.debug(`${i}LFO phase diff: ${(h-64)*3}deg`)},h=>{console.debug(`${i}input mode: ${h?"stereo":"mono"}`)},h=>{}][a[0]-32+l]||function(){console.warn(`Unknown XG chorus address: ${a[0]}.`)})(d)})):a[0]<86?(i+="variation ",a.subarray(1).forEach((d,l)=>{([h=>{e.setEffectTypeRaw(2,!1,h),console.info(`${i}main type: ${oe[h]}`),e.pushEffectType(2)},h=>{e.setEffectTypeRaw(2,!0,h),console.debug(`${i}sub type: ${h+1}`),e.pushEffectType(2)}][a[0]-64+l]||function(){})(d)})):a[0]<97?(i+="variation ",a.subarray(1).forEach((d,l)=>{[h=>{console.debug(`${i}send: ${_(h)}dB`)},h=>{console.debug(`${i}pan: ${h-64}`)},h=>{console.debug(`${i}to reverb: ${_(h)}dB`)},h=>{console.debug(`${i}to chorus: ${_(h)}dB`)},h=>{e.modelEx.xg.varSys=!!h,console.debug(`${i}connection: ${h?"system":"insertion"}`)},h=>{if(e.modelEx.xg.varSys){console.warn(`${i}effect is applied system-wide. Setting its effective channel to CH${h+1} will not have any effect.`);return}if(h<64){let m=e.chRedir(h,s,!0);e.setXgChEffectSink(m,2),console.debug(`${i}channel: CH${h+1} (CH${m+1})`)}else e.setXgChEffectSink(y.invalidCh,2),console.info(`${i}channel: CH${h+1} (unsupported)`)},h=>{console.debug(`${i}mod wheel: ${h-64}`)},h=>{console.debug(`${i}bend wheel: ${h-64}`)},h=>{console.debug(`${i}channel after touch: ${h-64}`)},h=>{console.debug(`${i}AC1: ${h-64}`)},h=>{console.debug(`${i}AC2: ${h-64}`)}][a[0]-86+l](d)})):a[0]>111&&a[0]<118?i+="variation ":console.warn(`Unknown XG variation address: ${a[0]}`)}).add([76,2,64],(a,s,c)=>{a.subarray(1).forEach((i,d)=>{let l=d+a[0];if(l===0)console.debug(`XG EQ preset: ${["flat","jazz","pop","rock","classic"][i]}`);else{let h=l-1>>2,m=l-1&3,u=`XG EQ ${h} ${["gain","freq","Q","shape"][m]}: `;[()=>{console.debug(`${u}${i-64}dB`)},()=>{console.debug(`${u}${i} (raw)`)},()=>{console.debug(`${u}${i/10}`)},()=>{console.debug(`${u}${["shelf","peak"][+!!i]}`)}][m]()}})}).add([76,3],(a,s,c)=>{e.invokeSysExIndicator();let i=a[0],d=a[1],l=`XG Insertion ${a[0]+1} `;a.subarray(2).forEach((h,m)=>{([()=>{e.setEffectTypeRaw(3+i,!1,h),console.info(`${l}main type: ${oe[h]}`),e.pushEffectType(3+i)},()=>{e.setEffectTypeRaw(3+i,!0,h),console.debug(`${l}sub type: ${h+1}`),e.pushEffectType(3+i)},!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,()=>{if(h<64){let u=e.chRedir(h,s,!0);e.setXgChEffectSink(u,3+i),console.debug(`${l}channel: CH${h+1} (CH${u+1})`)}else e.setXgChEffectSink(y.invalidCh,3+i),console.info(`${l}channel: CH${h+1} (unsupported)`)}][d+m]||function(){})(h)})}).add([76,6,0],(a,s,c)=>{let i=a[0];i<64?e.setLetterDisplay(a.subarray(1),"XG letter display",i):e.#G=e.clockSource.now()}).add([76,7,0],(a,s,c)=>{let i=a[0];e.#h=0,e.#C=e.clockSource.now()+3200,a.subarray(1).forEach(function(l,h){let m=h+i,u=m>>4,E=m&15,w=(E*3+u)*7,$=7,M=0;for(w-=E*5,u===2&&($=2);M<$;)e.#k[w+M]=l>>6-M&1,M++})}).add([76,8],(a,s)=>{e.invokeSysExIndicator();let c=e.chRedir(a[0],s,!0),i=a[1],d=R[c],l=`XG CH${c+1} `,h=`Unknown XG part address ${i}.`,m=!0;a.subarray(2).forEach((u,E)=>{m=!0,i<1?console.debug(h):i<41?([()=>{e.setChCc(c,0,u),e.pushChPrimitives(c)},()=>{e.setChCc(c,32,u),e.pushChPrimitives(c)},()=>{e.#n[c]=u,e.pushChPrimitives(c)},()=>{m=!1;let w=e.chRedir(u,s,!0),$=e.#d[c];e.#d[c]=w,(c!==w||w!==$)&&(e.buildRchTree(),console.info(`${l}receives from CH${w+1}`)),e.#P[c]||(e.copyChSetup(w,c,!0),console.debug(`${l}copied from CH${w+1}.`),e.setChActive(c,1),e.pushChPrimitives(c))},()=>{e.#u[c]=+!u},()=>{},()=>{m=!1,e.setChType(c,u,v.xg),console.debug(`${l}type: ${ce[u]||u}`),e.pushChPrimitives(c)},()=>{e.#s[y.rpn*c+3]=u,e.#f[y.rpnt*c+2]=1,e.dispatchEvent("pitch",{part:c,pitch:e.getPitchShift(c)})},!1,!1,()=>{e.setChCc(c,7,u)},!1,!1,()=>{e.setChCc(c,10,u||128)},!1,!1,()=>{e.setChCc(c,128,u),e.allocateAce(c,128)},()=>{e.setChCc(c,93,u)},()=>{e.setChCc(c,91,u)},()=>{e.setChCc(c,94,u)},()=>{e.setChCc(c,76,u)},()=>{e.setChCc(c,77,u)},()=>{e.setChCc(c,78,u)},()=>{e.setChCc(c,74,u)},()=>{e.setChCc(c,71,u)},()=>{e.setChCc(c,73,u)},()=>{e.setChCc(c,75,u)},()=>{e.setChCc(c,72,u)}][i+E-1]||(()=>{}))():i<48?console.debug(h):i<111?i>102&&i<105&&e.setChCc(c,[5,65][i&1],u):i<114?console.debug(h):i<116?console.debug(`${l}EQ ${["bass","treble"][i&1]} gain: ${u-64}dB`):i<118?console.debug(h):i<120?console.debug(`${l}EQ ${["bass","treble"][i&1]} freq: ${u}`):console.debug(h)}),m&&e.#i[c]>1&&e.setDrumFirstWrite(c)}).add([76,9],(a,s)=>{let c=e.chRedir(a[0],s,!0),i=a[1],d=R[c],l=`PLG-VL CH${c+1} `;a.subarray(2).forEach((h,m)=>{let u=m+i;switch(u){case 1:{console.info(`${l}breath mode: ${["system","breath","velocity","touch EG"][h]}`);break}case 0:case 27:case 28:break;default:if(u<27){let E=u-3>>1,w=["pressure","embouchure","tonguing","scream","breath noise","growl","throat formant","harmonic enhancer","damping","absorption","amplification","brightness"][E];u&1?u<23?(console.debug(`${l}${w} control source: ${je(h)}`),h&&h<96&&e.allocateAce(c,130+E),e.#Z[y.redir*c+E+2]=h,e.buildRccMap()):console.debug(`${l}${w} scale break point: ${h}`):(console.debug(`${l}${w} depth: ${h-64}`),e.setChCc(c,130+E,h))}}})}).add([76,10],(a,s,c)=>{}).add([76,16],(a,s,c)=>{}).add([76,17,0,0],(a,s,c)=>{}).add([76,112],(a,s,c)=>{if(a[0]>=F.length){console.error(`Supplied invalid plugin board ID: ${a[0]}`);return}if(a[1]>=F[a[0]][1]){console.error(`Supplied invalid slot ID for board type "${F[a[0]][0]}" (${a[0]}): ${a[1]} (#${a[1]+1}))`);return}switch(a[1]>=F[a[0]][2]?console.warn(`While enabled in Octavia, slot #${a[1]+1} for board type "${F[a[0]][0]}" (${a[0]}) may not function outside software recreation.`):a[2]>63?console.debug(`XG disable PLG-${F[a[0]][0]} (${a[0]}) slot #${a[1]+1} as it's set to CH${a[2]+1}.`):console.debug(`XG enable PLG-${F[a[0]][0]} (${a[0]}) slot #${a[1]+1} for CH${a[2]+1}.`),e.modelEx.yPlg[a[0]][a[1]]=a[2]<64?e.chRedir(a[2],s,!0):y.invalidCh,a[0]){case 0:{e.#y[y.ext*a[2]]=e.EXT_VL;break}case 2:{e.#y[y.ext*a[2]]=e.EXT_DX;break}default:e.#y[y.ext*a[2]]=e.EXT_NONE}}).add([73,0,0],(a,s)=>{let c=a[0],i="MU System - ";a.subarray(1).forEach((d,l)=>{let h=c+l;h===8?(e.lcdContrast=Math.max(0,Math.min(8,9-d))<<2,console.debug(`${i}LCD contrast: ${d}.`)):h===18?(e.#l[v.xg][1]=[0,126,152][d]??127,console.debug(`${i}default bank: ${["MU Basic","MU100 Native","PSR/LE"][d]??d}.`),e.modelEx.xg.map=d,e.dispatchEvent("banklevel",{mode:"xg",data:d}),e.forceVoiceRefresh()):h>=64&&h<69&&[()=>{e.dispatchEvent("channelactive",d)},()=>{d<8?(e.dispatchEvent("channelmin",d<<4),console.debug(`Octavia System: Minimum CH${(d<<4)+1}`)):(e.dispatchEvent("channelreset"),console.info("Octavia System: Clear channel ranges"))},()=>{d<8?(e.dispatchEvent("channelmax",(d<<4)+15),console.debug(`Octavia System: Maximum CH${(d<<4)+16}`)):(e.dispatchEvent("channelreset"),console.info("Octavia System: Clear channel ranges"))},()=>{e.dispatchEvent("channelreset"),console.info("Octavia System: Clear channel ranges")},()=>{e.#W=!!d,console.info(`Octavia System: RS receiving ${["dis","en"][d]}abled.`)}][h-64]()})}).add([73,10,0],(a,s)=>{let c=a[0],i=`MU RS${e.#W?"":" (ignored)"}: `;if(a[1]!==0){console.info(`${i}button ${c} pressed.`);return}if(c<16)switch(c){case 0:{e.#W&&e.dispatchEvent("portrange",1),console.info(`${i}Show single port.`),e.lcdHideBankInfo=!1;break}case 1:{let d=e.chRedir(0,s,!0);e.#W&&(e.dispatchEvent("portrange",2),e.dispatchEvent("portstart",d)),console.info(`${i}Show CH${d+1}~CH${d+32}.`),e.lcdHideBankInfo=!1;break}case 2:{let d=e.chRedir(0,s,!0);e.#W&&(e.dispatchEvent("portrange",4),e.dispatchEvent("portstart",d)),console.info(`${i}Show CH${d+1}~CH${d+64}.`),e.lcdHideBankInfo=!1;break}case 3:{let d=e.chRedir(0,s,!0);e.#W&&(e.dispatchEvent("portrange",2),e.dispatchEvent("portstart",d)),console.info(`${i}Show CH${d+1}~CH${d+32}, hide info.`),e.lcdHideBankInfo=!0;break}default:c>=4&&c<12?(e.lcdContrast=12-c<<1,console.debug(`${i}LCD contrast set to ${c-3}.`)):console.debug(`${i}unknown switch ${c} invoked.`)}else if(c<32){if(e.#W){let d=e.chRedir(c-16+(e.#pe<<4),s,!0);e.dispatchEvent("channelactive",d)}}else if(c<36){let d=e.chRedir(c-32<<4,s,!0);e.#W&&(e.dispatchEvent("portrange",1),e.dispatchEvent("portstart",d>>4),e.#pe=c-32),console.info(`${i}Show CH${d+1}~CH${d+16}.`)}}).add([73,11,0],(a,s)=>{let c="MU1000 System - channel ",i="Octavia System - channel ",d=a[0];a.subarray(1).forEach((l,h)=>{let m=d+h;([()=>{e.setChActive(l,1),e.dispatchEvent("channelactive",l),T()&&console.debug(`${c}current part: CH${l+1}`)},()=>{l<5?(e.dispatchEvent("portrange",1<<l),console.debug(`${c}port range: ${1<<l} port(s)`)):(e.dispatchEvent("portrange",0),console.debug(`${c}port range: reset`))},()=>{l<16?(e.dispatchEvent("portstart",l),console.debug(`${i}start port: ${"ABCDEFGHIJKLMNOP"[l]}`)):(e.dispatchEvent("portstart",255),console.debug(`${i}start port: reset`))}][m]||(()=>{console.debug(`${c}unknown address: ${m}`)}))()})}).add([87,0,0],(a,s)=>{let c="VL70-m sound module ";switch(a[0]){case 126:{console.info(`${c}mode set to: ${["VL-XG","VL70-m voice"][a[1]]??`invalid (${a[1]})`}`),e.switchMode("xg",1),a[1]<2&&(e.modelEx.vl.module=a[1]+1),e.setPortMode(e.getTrackPort(s),1,v.xg);break}default:console.info(`Unknown ${c}address: ${a[0]}`)}}).add([93,3],(a,s)=>{let c=e.chRedir(a[0],s,!0),i=`PLG-SG CH${c+1} `,d=e.clockSource.now(),l=e.modelEx.sg;if(a[1]===0){let h="",m=0;a.subarray(2).forEach((u,E)=>{E%2===0?h+=Je[u]||u.toString().padStart("0"):m+=u*13}),(d>=l.convLastSyll||l.runLineLen>=l.maxLineLen)&&(e.dispatchEvent("metacommit",{type:"SGLyrics",data:"",amend:!1}),l.splitMask=d<l.convLastSyll,l.runLineLen=0),e.dispatchEvent("metacommit",{type:"SGLyrics",data:`${Ze(h)}`,amend:!0,mask:l.splitMask}),l.runLineLen++,l.splitMask=!1,l.convLastSyll=d+Math.ceil(m/2)+e.#ae,T()&&console.debug(`${i}vocals: ${h}`)}else console.warn(`Unknown PLG-SG data: ${a}`)}).add([98,96],(a,s,c,i)=>{let d=e.chRedir(a[0],s,!0),l=R[d],h=a[1];a.subarray(2).forEach((m,u)=>{let E=h+u;if(!(E<10)){if(E===10)e.resetAce();else if(E<27){let w=E+131;e.setChCc(d,w,m),!i?.noAce&&m>0&&m!==64&&e.allocateAce(d,w),e.dispatchEvent("cc",{part:d,cc:w,data:m})}}})}).add([1,20],(a,s,c)=>{c===115?(e.switchMode("doc",2),e.setPortMode(e.getTrackPort(s),1,v.doc),console.info("MIDI reset: DOC")):console.debug(`Unknown Yamaha SysEx: 67, ${c}, ${a.join(", ")}`)}).add([1,17,15,89],(a,s,c)=>{c===115?(e.setEffectType(0,24,a[0]|16),e.pushEffectType(0)):console.debug(`Unknown Yamaha SysEx: 67, ${c}, ${a.join(", ")}`)}).add([1,24],(a,s,c)=>{if(c===115){for(let i=0;i<16;i++){let d=e.chRedir(i,s,!0);e.setChCc(d,91,127)}console.info("DOC Global Reverb: on")}else console.debug(`Unknown Yamaha SysEx: 67, ${c}, ${a.join(", ")}`)}).add([126,0],(a,s,c)=>{switch(a[1]){case 0:{e.dispatchEvent("metacommit",{type:"YMCSSect",data:"Disabled",raw:"Intro "}),console.debug("Yamaha Section Control is off.");break}case 127:{e.dispatchEvent("metacommit",{type:"YMCSSect",data:["Intro","Main A","Main B","Fill-in AB","Fill-in BA","Ending","Blank"][a[0]-8]??`invalid section ${a[0]}`,raw:["Intro ","Main A","Main B","FillAB","FillBA","Ending","Blank "][a[0]-8]??`ID: ${a[0]}`}),console.debug(`Yamaha Section Control switches to "${["intro","main A","main B","fill-in AB","fill-in BA","ending","blank"][a[0]-8]??`Invalid section ${a[0]}`}".`);break}default:console.debug(`Unknown YMCS section control: ${a[1]}`)}}).add([126,2],(a,s,c)=>{let i=[];for(let d=0;d<a.length;d+=2){let l=a[d]>>4,h=a[d]&15;if(l<7&&h&&h<8){let m=new Uint8Array(5);m[0]=h-1,m[1]=l-3<<2,m[2]=a[d|1],i.push(m)}}e.dispatchEvent("metacommit",{type:"ChordCtl",src:"ymcs",data:i}),console.debug("YMCS chord data: %o",i)});let o=function(a,s,c,i){},f=function(a,s){e.invokeSysExIndicator();let c=a*y.dpn,i=s[0],d=s[1];s.subarray(2).forEach((l,h)=>{let m=h+d,u=-1;m<16?([()=>{u=24},()=>{u=25},()=>{u=26},()=>{},()=>{u=28},()=>{u=29},()=>{u=30},()=>{u=31},()=>{},()=>{},()=>{},()=>{u=20},()=>{u=21},()=>{u=22},()=>{u=23},()=>{}][m]||(()=>{console.debug(`Unknown XG-style drum param ${m} on set ${a+1}.`)}))():m<32||(m<40?([()=>{u=48},()=>{u=49},!1,!1,()=>{u=52},()=>{u=53}][m-32]||(()=>{console.debug(`Unknown XG-style drum param ${m} on set ${a+1}.`)}))():m<80||([()=>{u=36}][m-80]||(()=>{console.debug(`Unknown XG-style drum param ${m} on set ${a+1}.`)}))()),u>=0?(T()&&console.debug(c,u,i,l),e.#D[(c+X[u])*y.dnc+i]=l):T()&&console.debug(`XG-style drum param ${m} has no writes.`)})},p=function(a,s,c){e.invokeSysExIndicator();let i=a*y.dpn,d=(s<<7)+c[0];c.subarray(1).forEach((l,h)=>{let m=h+d,u=m&127,E=m>>7,w=-1;E>1&&([()=>{w=26},()=>{},()=>{w=28},()=>{w=29},()=>{w=30},()=>{},()=>{},()=>{w=31}][E-2]||(()=>{console.debug(`Unknown GS-style drum param ${E} on set ${a+1}.`)}))(),w>-1?(T()&&console.debug(i,w,u,l),e.#D[(i+X[w])*y.dnc+u]=l):T()&&console.debug(`GS-style drum param ${E} has no writes.`)})};this.#U.add([76,48],(a,s,c)=>{f(0,a)}).add([76,49],(a,s,c)=>{f(1,a)}).add([76,50],(a,s,c)=>{f(2,a)}).add([76,51],(a,s,c)=>{f(3,a)}).add([76,52],(a,s,c)=>{f(4,a)}).add([76,53],(a,s,c)=>{f(5,a)}).add([76,54],(a,s,c)=>{f(6,a)}).add([76,55],(a,s,c)=>{f(7,a)}),this.#U.add([89,0],(a,s,c)=>{if(e.eprom){let i=a[0],d=(a[1]<<14)+(a[2]<<7)+a[3]+(e.eprom.offset||0);T()&&console.debug(`MU1000 EPROM trail to 0x${d.toString(16).padStart(6,"0")}, ${i} bytes.`);let l=e.eprom.data;a.subarray(4).forEach((h,m)=>{let u=m>>3,E=m&7;if(E===7)for(let w=0;w<7;w++)l[d+7*u+w]+=(h>>6-w&1)<<7;else l[d+7*u+E]=h})}}).add([89,1],(a,s,c)=>{let i=(a[0]<<21)+(a[1]<<14)+(a[2]<<7)+a[3];T()&&console.debug(`MU1000 EPROM jump to 0x${i.toString(16).padStart(6,"0")}.`),e.eprom&&(e.eprom.offset=i)}).add([89,2],(a,s,c)=>{if(e.eprom){let i=(a[0]<<21)+(a[1]<<14)+(a[2]<<7)+a[3]+(e.eprom.offset||0);T()&&console.debug(`MU1000 EPROM write to 0x${i.toString(16).padStart(6,"0")}.`);let d=e.eprom.data;a.subarray(4).forEach((l,h)=>{let m=h>>3,u=h&7;if(u===7)for(let E=0;E<7;E++)d[i+7*m+E]+=(l>>6-E&1)<<7;else d[i+7*m+u]=l})}}).add([89,3],(a,s,c)=>{}),this.#U.add([39,48],(a,s,c)=>{}).add([43,0,0],(a,s,c)=>{e.invokeSysExIndicator();let i=[0,0,0,0],d=(l,h)=>{i[h]=l};if(a.subarray(1).forEach((l,h)=>{let m=h+a[0];[d,d,d,d,()=>{this.#p=l*129/16383*100,e.dispatchEvent("mastervolume",e.#p)},()=>l-64,()=>l||128,()=>l,()=>l,()=>{console.debug(`TG300 variation on cc${l}.`)}][m](l,m)}),a[0]<4){let l=0;i.forEach(h=>{l=l<<4,l+=h}),l-=1024,console.debug(`Master tune: ${l}`)}}).add([43,1,0],(a,s,c)=>{e.invokeSysExIndicator()}).add([43,2],(a,s,c)=>{e.invokeSysExIndicator();let i=e.chRedir(a[0],s,!0),d=a[1],l=R[i],h=`TG300 CH${i+1} `;a.subarray(2).forEach((m,u)=>{u<5?([()=>{},()=>{e.setChCc(i,0,m),e.pushChPrimitives(i)},()=>{e.setChCc(i,32,m),e.pushChPrimitives(i)},()=>{e.#n[i]=m,e.pushChPrimitives(i)},()=>{let E=e.chRedir(m,s,!0),w=e.#d[i];e.#d[i]=E,(i!==E||E!==w)&&(e.buildRchTree(),console.info(`${h}receives from CH${E+1}`))}][u+d]||(()=>{}))(m,u+d):u<21||(u<47?([()=>{e.#u[i]=+!m},()=>{},()=>{},()=>{e.#s[y.rpn*i+3]=m,e.#f[y.rpnt*i+2]=1,e.dispatchEvent("pitch",{part:i,pitch:e.getPitchShift(i)})},()=>{},()=>{e.setChCc(i,7,m)},!1,!1,()=>{e.setChCc(i,10,m||128)},!1,!1,()=>{console.debug(`${h} AC1 at cc${m}`)},()=>{console.debug(`${h} AC2 at cc${m}`)},()=>{e.#e[l+x[128]]=m,e.allocateAce(i,128)},()=>{e.#e[l+x[93]]=m},()=>{e.#e[l+x[91]]=m},()=>{e.#e[l+x[94]]=m},()=>{e.#e[l+x[76]]=m},()=>{e.#e[l+x[77]]=m},()=>{e.#e[l+x[74]]=m},()=>{e.#e[l+x[71]]=m},()=>{e.#e[l+x[73]]=m},()=>{e.#e[l+x[75]]=m},()=>{e.#e[l+x[72]]=m},()=>{e.#e[l+x[78]]=m}][u+d-21]||(()=>{}))(m,u+d):u<95||([()=>{e.#e[l+x[65]]=m},()=>{e.#e[l+x[5]]=m}][u+d-95]||(()=>{}))(m,u+d))})}).add([43,7,0],(a,s,c)=>{let i=a[0];e.setLetterDisplay(a.subarray(1),"TG300 letter display",i)}).add([43,7,1],(a,s,c)=>{e.#h=0,e.#C=e.clockSource.now()+3200,a.forEach(function(i,d){let l=d>>4,h=d&15,m=(h*3+l)*7,u=7,E=0;for(m-=h*5,l===2&&(u=2);E<u;)e.#k[m+E]=i>>6-E&1,E++})}),this.#z.add([66,18,0,0,127],(a,s,c)=>{e.switchMode("sc",2),e.setPortMode(e.getTrackPort(s),2,v.sc),e.#w=e.KARAOKE_NONE,e.#ee.fill(0),console.info(`GS system to ${["single","dual"][a[0]]} mode.`)}).add([66,18,64,0],(a,s,c)=>{switch(a[0]){case 127:{e.switchMode("gs",2),e.setPortMode(e.getTrackPort(s),4,v.gs),e.#w=e.KARAOKE_NONE,e.#ee.fill(0),console.info("MIDI reset: GS");break}default:{e.invokeSysExIndicator();let i=[0,0,0,0],d=(l,h)=>{i[h]=l};if(a.subarray(1).forEach((l,h)=>{let m=h+a[0];[d,d,d,d,u=>{this.#p=u*129/16383*100,e.dispatchEvent("mastervolume",e.#p)},u=>{},u=>{}][m](l,h)}),a[0]<4){let l=0;i.forEach(h=>{l=l<<4,l+=h}),l-=1024,console.debug(`Master tune: ${l}`)}}}}).add([66,18,64,1],(a,s,c)=>{e.invokeSysExIndicator();let i=a[0];if(i<16){let d="".padStart(i," ");a.subarray(1).forEach((l,h)=>{d+=String.fromCharCode(Math.max(32,l))}),d=d.padEnd(16," "),console.debug(`GS patch name: ${d}`)}else i<48||(i<65?a.subarray(1).forEach((d,l)=>{let h=`GS ${i+l>55?"chorus":"reverb"} `;([()=>{console.info(`${h}type: ${Le[d]}`),e.setEffectType(0,40,d),e.pushEffectType(0)},()=>{},()=>{},()=>{},()=>{},()=>{},!1,()=>{console.debug(`${h}predelay: ${d}ms`)},()=>{console.info(`${h}type: ${at[d]}`),e.setEffectType(1,40,16+d),e.pushEffectType(1)},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{console.debug(`${h}to reverb: ${_(d)}`)},()=>{console.debug(`${h}to delay: ${_(d)}`)}][i+l-48]||(()=>{}))()}):i<80?console.debug(`Unknown GS patch address: ${i}`):i<91?a.subarray(1).forEach((d,l)=>{let h="GS delay ";([()=>{console.info(`${h}type: ${rt[d]}`),e.setEffectType(2,40,32+d),e.pushEffectType(2)},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{console.debug(`${h}to reverb: ${_(d)}`)}][i+l-80]||(()=>{}))()}):console.debug(`Unknown GS patch address: ${i}`))}).add([66,18,64,2],(a,s,c)=>{let i="GS EQ ";a.subarray(1).forEach((d,l)=>{([()=>{console.debug(`${i}low freq: ${[200,400][d]}Hz`)},()=>{console.debug(`${i}low gain: ${d-64}dB`)},()=>{console.debug(`${i}high freq: ${[3e3,6e3][d]}Hz`)},()=>{console.debug(`${i}high gain: ${d-64}dB`)}][a[0]+l]||function(){console.warn(`Unknown GS EQ address: ${a[0]+l}`)})()})}).add([66,18,64,3],(a,s,c)=>{e.invokeSysExIndicator();let i="GS EFX ",d=function(l,h){let m=it(e.#O.subarray(10,12),h,l);m&&console.debug(`${i}${Ie(e.#O.subarray(10,12))} ${m}`)};a.subarray(1).forEach((l,h)=>{([()=>{e.setEffectTypeRaw(3,!1,32+l),e.pushEffectType(3)},()=>{e.setEffectTypeRaw(3,!0,l),console.info(`${i}type: ${Ie(e.#O.subarray(10,12))}`),e.pushEffectType(3)},!1,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,()=>{console.debug(`${i}to reverb: ${_(l)}dB`)},()=>{console.debug(`${i}to chorus: ${_(l)}dB`)},()=>{console.debug(`${i}to delay: ${_(l)}dB`)},!1,()=>{console.debug(`${i}1 source: ${l}`),l&&l<96&&e.allocateAceAll(l)},()=>{console.debug(`${i}1 depth: ${l-64}`)},()=>{console.debug(`${i}2 source: ${l}`),l&&l<96&&e.allocateAceAll(l)},()=>{console.debug(`${i}2 depth: ${l-64}`)},()=>{console.debug(`${i}to EQ: ${l?"ON":"OFF"}`)}][a[0]+h]||function(m,u){console.warn(`Unknown GS EFX address: ${u}`)})(l,a[0]+h)})}).add([66,18,65],(a,s,c)=>{p((a[0]>>4)+1<<1,a[0]&15,a.subarray(1))}).add([66,18,72],(a,s,c)=>{let i=(a[0]&127)<<7|a[1]&127;console.debug(i,lt(a.subarray(2)))}).add([69,18,16],(a,s,c)=>{switch(a[0]){case 0:{let i=a[1];e.setLetterDisplay(a.subarray(2),"GS display text",i);break}case 8:{let i=a[1],d=e.modelEx.sc;a.subarray(2).forEach((l,h)=>{([()=>{d.showBar=!(l&1),d.invBar=l>>1&1,d.invDisp=l>>2&1},()=>{d.peakHold=l<4?l:1}][h+i]||(()=>{console.debug("Unsupported GS display type SysEx.")}))()});break}case 32:{e.#C=e.clockSource.now()+3200,a[1]===0&&(a[2]?(e.#h=Math.max(Math.min(a[2]-1,9),0),T()&&console.debug(`GS switch display page ${a[2]-1}.`)):(e.#h=0,e.#C=e.clockSource.now(),T()&&console.debug("GS disable display page.")));break}default:if(a[0]<6){e.#h>9&&(e.#h=0);let i=a[0]-1<<1|a[1]>>6;e.#h===i&&(e.#C=e.clockSource.now()+3200),e.#v[i]?.length||(e.#v[i]=new Uint8Array(256));let d=e.#v[i];T()&&console.debug(`GS frame draw page ${i}.`);let l=a[1]&63;a.subarray(2).forEach(function(m,u){let E=u+l,w=E>>4,$=E&15,M=($*4+w)*5,B=5,P=0;for(M-=$*4,w===3&&(B=1);P<B;)d[M+P]=m>>4-P&1,P++})}else console.warn(`Unknown GS display section: ${a[0]}`)}}).add([69,18,32],(a,s,c)=>{let i=a[0],d=a[1],l=a.subarray(2);if(i>>4){console.warn(`SC-8850 partial screen dump out of bounds: invalid bundle.
`,a);return}let h=d+l.length,m=d*6-(d*2428>>16<<1),u=h*6-(h*2428>>16<<1);if(m>640){console.warn(`SC-8850 partial screen dump out of bounds: invalid buffer range.
`,a);return}u>640&&(console.info(`SC-8850 partial screen dump out of bounds: invalid buffer end, automatically restricted.
`,a),u=640);let E=new Uint8Array(u-m);l.forEach((M,B)=>{let P=B+d,Y=(P*2428&65535)*27>>16===26,Rt=P*6-(P*2428>>16<<1),me=Y?2:0;for(;me<6;)E[Rt+(5-me)]=M>>me&1,me++});let w=i*108+d,$=w*6-(w*2428>>16<<1);e.dispatchEvent("screen",{type:"sc8850",offset:$,data:E}),T()&&console.debug(`SC-8850 screen dump: bundle ${i+1}, range ${m}~${u}`)});let g=function(a,s,c){e.invokeSysExIndicator();let i=a[0],d=R[s],l=re[s],h=`GS CH${s+1} `;i<3?(a.subarray(1).forEach((m,u)=>{[()=>{e.#e[d+x[0]]=m,e.pushChPrimitives(s)},()=>{e.#n[s]=m},()=>{let E=0;m<16?E=e.chRedir(m,c,!0):E=y.ch;let w=e.#d[s];e.#d[s]=E,(s!==E||E!==w)&&(e.buildRchTree(),console.info(`${h}receives from CH${E+1}`))}][i+u]()}),e.pushChPrimitives(s)):i<19||(i<44?a.subarray(1).forEach((m,u)=>{([()=>{e.#u[s]=+!m},!1,()=>{e.setChType(s,m<<1,v.gs),console.debug(`${h}type: ${m?"drum ":"melodic"}${m||""}`)},()=>{e.#s[l+3]=m,e.#f[y.rpnt*s+2]=1,e.dispatchEvent("pitch",{part:s,pitch:e.getPitchShift(s)})},!1,!1,()=>{e.#e[d+x[7]]=m},!1,!1,()=>{e.setChCc(s,10,m||128)},!1,!1,()=>{console.debug(`${h}CC 1: cc${m}`)},()=>{console.debug(`${h}CC 2: cc${m}`)},()=>{e.#e[d+x[93]]=m},()=>{e.#e[d+x[91]]=m},!1,!1,()=>{e.#s[l+1]=m,e.#f[y.rpnt*s+1]=1,e.dispatchEvent("pitch",{part:s,pitch:e.getPitchShift(s)})},()=>{e.#s[l+2]=m,e.#f[y.rpnt*s+1]=1,e.dispatchEvent("pitch",{part:s,pitch:e.getPitchShift(s)})},()=>{e.#e[d+x[94]]=m}][i+u-19]||(()=>{}))()}):i<76||console.debug(`Unknown GS part address: ${i}`))},b=function(a,s){let c=a[0],i=`GS CH${s+1} `;c<2?a.subarray(1).forEach((d,l)=>{[()=>{e.setChCc(s,32,d)},()=>{}][c+l]()}):c<32?console.warn(`Unknown GS misc address: ${c}`):c<35?a.subarray(1).forEach((d,l)=>{[()=>{console.debug(`${i}EQ: o${["ff","n"][d]}`)},()=>{},()=>{console.debug(`${i}EFX: o${["ff","n"][d]}`),e.setChEffectSink(s,d?3:0)}][c+l-32]()}):console.warn(`Unknown GS misc address: ${c}`)};this.#z.add([66,18,64,16],(a,s)=>{g(a,e.chRedir(9,s,!0),s)}).add([66,18,64,17],(a,s)=>{g(a,e.chRedir(0,s,!0),s)}).add([66,18,64,18],(a,s)=>{g(a,e.chRedir(1,s,!0),s)}).add([66,18,64,19],(a,s)=>{g(a,e.chRedir(2,s,!0),s)}).add([66,18,64,20],(a,s)=>{g(a,e.chRedir(3,s,!0),s)}).add([66,18,64,21],(a,s)=>{g(a,e.chRedir(4,s,!0),s)}).add([66,18,64,22],(a,s)=>{g(a,e.chRedir(5,s,!0),s)}).add([66,18,64,23],(a,s)=>{g(a,e.chRedir(6,s,!0),s)}).add([66,18,64,24],(a,s)=>{g(a,e.chRedir(7,s,!0),s)}).add([66,18,64,25],(a,s)=>{g(a,e.chRedir(8,s,!0),s)}).add([66,18,64,26],(a,s)=>{g(a,e.chRedir(10,s,!0),s)}).add([66,18,64,27],(a,s)=>{g(a,e.chRedir(11,s,!0),s)}).add([66,18,64,28],(a,s)=>{g(a,e.chRedir(12,s,!0),s)}).add([66,18,64,29],(a,s)=>{g(a,e.chRedir(13,s,!0),s)}).add([66,18,64,30],(a,s)=>{g(a,e.chRedir(14,s,!0),s)}).add([66,18,64,31],(a,s)=>{g(a,e.chRedir(15,s,!0),s)}).add([66,18,64,64],(a,s)=>{b(a,e.chRedir(9,s,!0))}).add([66,18,64,65],(a,s)=>{b(a,e.chRedir(0,s,!0))}).add([66,18,64,66],(a,s)=>{b(a,e.chRedir(1,s,!0))}).add([66,18,64,67],(a,s)=>{b(a,e.chRedir(2,s,!0))}).add([66,18,64,68],(a,s)=>{b(a,e.chRedir(3,s,!0))}).add([66,18,64,69],(a,s)=>{b(a,e.chRedir(4,s,!0))}).add([66,18,64,70],(a,s)=>{b(a,e.chRedir(5,s,!0))}).add([66,18,64,71],(a,s)=>{b(a,e.chRedir(6,s,!0))}).add([66,18,64,72],(a,s)=>{b(a,e.chRedir(7,s,!0))}).add([66,18,64,73],(a,s)=>{b(a,e.chRedir(8,s,!0))}).add([66,18,64,74],(a,s)=>{b(a,e.chRedir(10,s,!0))}).add([66,18,64,75],(a,s)=>{b(a,e.chRedir(11,s,!0))}).add([66,18,64,76],(a,s)=>{b(a,e.chRedir(12,s,!0))}).add([66,18,64,77],(a,s)=>{b(a,e.chRedir(13,s,!0))}).add([66,18,64,78],(a,s)=>{b(a,e.chRedir(14,s,!0))}).add([66,18,64,79],(a,s)=>{b(a,e.chRedir(15,s,!0))}),this.#Q.add([54,65],(a,s)=>{let c=e.#r.x5===81?"05rw":"x5d";e.switchMode(c,1),e.setPortMode(e.getTrackPort(s),1,v[c]);let i=a[a.length-1],d=a.subarray(0,a.length-1),l=ee(d);l!==i&&(console.info(`X5D multi parameters checksum mismatch! Expected ${l}, got ${i}.`),console.debug(a));let h=(a[1]<<7)+a[0],m=(a[3]<<7)+a[2],u=e.chRedir(h&15,s,!0),E=R[u];[()=>{m<1||(m<101?(e.setChType(u,e.CH_MELODIC,v.x5d),e.#n[u]=m-1,e.#e[E+x[0]]=e.#r.x5):m<229?(e.setChType(u,e.CH_MELODIC,v.x5d),e.#n[u]=m-101,e.#e[E+x[0]]=56):(e.setChType(u,e.CH_DRUMS,v.x5d),e.#n[u]=ut[m-229]||0,e.#e[E+x[0]]=62)),e.pushChPrimitives(u)},()=>{e.#e[E+x[7]]=m},()=>{m<31&&(e.#e[E+x[10]]=Math.round((m-15)*4.2+64))},()=>{e.#e[E+x[93]]=de(m)},()=>{e.#e[E+x[91]]=de(m)},()=>{e.#s[u*y.rpn+3]=m>8191?m-16320:64+m,e.#f[y.rpnt*u+2]=1,e.dispatchEvent("pitch",{part:u,pitch:e.getPitchShift(u)})},()=>{e.#s[u*y.rpn+1]=m>8191?m-16320:64+m,e.#f[y.rpnt*u+1]=1,e.dispatchEvent("pitch",{part:u,pitch:e.getPitchShift(u)})},()=>{m>0&&(e.#s[u*y.rpn]=m,e.#f[y.rpnt*u]=1,e.dispatchEvent("pitch",{part:u,pitch:e.getPitchShift(u)}))},()=>{}][h>>4]()}).add([54,76,0],(a,s)=>{e.invokeSysExIndicator();let c=e.#r.x5===81?"05rw":"x5d";e.switchMode(c,1),e.setPortMode(e.getTrackPort(s),1,v[c]);let i="",d=e.#r.x5,l=0,h=0,m="MSB	PRG	LSB	NME";G(a,function(u,E){if(E<16400){let w=E%164;switch(!0){case w<10:{u>31&&(i+=String.fromCharCode(u));break}case w===10:break;case w===11:{m+=`
${d}	${l}	${h}	${i.trim().replace("Init Voice","")}`,l++,i="";break}}l>99&&(d=90,l=0)}}),e.userBank.clearRange({msb:e.#r.x5,prg:[0,99],lsb:0}),e.userBank.load(m),T()&&console.debug(m),e.forceVoiceRefresh()}).add([54,77,0],(a,s)=>{e.invokeSysExIndicator();let c=e.#r.x5===81?"05rw":"x5d";e.switchMode(c,1),e.setPortMode(e.getTrackPort(s),1,v[c]);let i="",d=90,l=0,h=0,m="MSB	PRG	LSB	NME";G(a,function(u,E){if(E<13600){let w=E%136;switch(!0){case w<10:{u>31&&(i+=String.fromCharCode(u));break}case w===11:{m+=`
${d}	${l}	${h}	${i.trim().replace("Init Combi","")}`,l++,i="";break}}}}),e.userBank.clearRange({msb:90,prg:[0,99],lsb:0}),e.userBank.load(m),T()&&console.debug(m),e.forceVoiceRefresh()}).add([54,78],(a,s)=>{let c=e.#r.x5===81?"05rw":"x5d";e.switchMode(c,0),e.setPortMode(e.getTrackPort(s),1,v[c]),console.debug(`X5D mode switch requested: ${["combi","combi edit","prog","prog edit","multi","global"][a[0]]} mode.`)}).add([54,85],(a,s)=>{e.invokeSysExIndicator();let c=e.#r.x5===81?"05rw":"x5d";e.switchMode(c,1),e.setPortMode(e.getTrackPort(s),1,v[c]),G(a,(i,d)=>{d>0&&d<3&&(e.setEffectType(d-1,44,i),e.pushEffectType(d-1))})}).add([54,104],(a,s)=>{e.invokeSysExIndicator();let c=e.#r.x5===81?"05rw":"x5d";e.switchMode(c,1);let i=e.getTrackPort(s);if(e.#g[i]&&e.#g[i]!==v[c])if(e.#A.dumpLimit===e.DUMP_MODE){console.warn(`Dump cancelled for track ${s}. Port ${String.fromCharCode(65+i)} mode "${L[e.#g[i]]}" mismatch, should be "${c}".`);return}else console.info(`Track ${s} is trying to perform a mismached mode dump on port ${String.fromCharCode(65+i)}.`);e.setPortMode(i,1,v[c]),G(a,function(d,l,h,m){if(l<192){let u=e.chRedir(Math.floor(l/12),s,!0),E=R[u];switch(l%12){case 0:{d<128?(e.setChType(u,e.CH_MELODIC,v.x5d),e.#e[E+x[0]]=e.#r.x5,e.#n[u]=d):(e.setChType(u,e.CH_DRUMS,v.x5d),e.#e[E+x[0]]=62,e.#n[u]=ut[d-128]),d>0&&e.setChActive(u,1),e.pushChPrimitives(u);break}case 1:{e.#e[E+x[7]]=d;break}case 2:{e.#s[u*y.rpn+3]=d>127?d-192:64+d,e.#f[y.rpnt*u+2]=1,e.dispatchEvent("pitch",{part:u,pitch:e.getPitchShift(u)});break}case 3:{e.#s[u*y.rpn+1]=d>127?d-192:64+d,e.#f[y.rpnt*u+1]=1,e.dispatchEvent("pitch",{part:u,pitch:e.getPitchShift(u)});break}case 4:{d<31&&(e.#e[E+x[10]]=Math.round((d-15)*4.2+64));break}case 5:{let w=d>>4,$=d&15;e.#e[E+x[91]]=de($),e.#e[E+x[93]]=de(w);break}case 10:{e.#i[u]||(e.#e[E+x[0]]=d>>6?56:e.#r.x5,e.pushChPrimitives(u));break}case 11:{let w=e.chRedir(d&15,s,!0),$=d>>4;e.#d[u]=d,(w!==u||$)&&console.info(`X5D Part CH${u+1} receives from CH${w+1}.`)}}}else{let u=e.chRedir(l-192,s,!0)}}),e.buildRchTree()}),this.#z.add([22,18,127],(a,s,c)=>{e.switchMode("mt32",2),e.setPortMode(e.getTrackPort(s),1,v.mt32),e.#w=e.KARAOKE_NONE,e.userBank.clearRange({msb:0,lsb:127,prg:[0,127]}),console.info("MIDI reset: MT-32")}).add([22,18,0],(a,s,c)=>{e.switchMode("mt32",1);let i=e.chRedir(c,s,!0),d=a[1];a.subarray(2).forEach((l,h)=>{let m=h+d;e.#$[m+(i-1)*16]=l,([!1,()=>{let u=e.#$[i-1<<4];if(u<3){if(e.#N[i]=1,u===2)for(let E=0;E<name.length;E++)e.#_[(i-1)*y.cmt+E]=e.#L[l*y.cmt+E];else{let E=e.baseBank.get(0,l+(u<<6),127,"mt32").name;for(let w=0;w<E.length;w++)e.#_[(i-1)*y.cmt+w]=E.charCodeAt(w)}e.pushChPrimitives(i)}},()=>{e.#s[i*y.rpn+3]=l+40,e.#f[y.rpnt*i+2]=1},()=>{e.#s[i*y.rpn+1]=l+14,e.#f[y.rpnt*i+1]=1},()=>{e.#s[i*y.rpn]=l,e.#f[y.rpnt*i]=1},!1,()=>{e.setChCc(i,91,l?127:0)},!1,()=>{e.setChCc(i,7,l)},()=>{e.setChCc(i,10,Math.ceil(l*9.05))}][m]||(()=>{}))()})}).add([22,18,1],(a,s,c)=>{e.switchMode("mt32",1);let i=c&7;console.debug(`MT-32 slot #${c+1} Drum: ${a}`);let d=a[0]<<7|a[1];a.subarray(2).forEach((l,h)=>{let m=h+d,u=(m>>2)+24,E=m&3,w=i*y.dpn;if(T()&&console.debug(`MT-32 temp drum note ${u} param ${E}: ${l}`),u<24){console.warn(`MT-32 dev drum write attempted on an OOB note: ${u}`);return}[()=>{},()=>{e.#D[(w+X[26])*y.dnc+u]=Math.round(l*1.27)},()=>{e.#D[(w+X[26])*y.dnc+u]=l*9+1&127},()=>{e.#D[(w+X[26])*y.dnc+u]=l?127:0}][E]()})}).add([22,18,2],(a,s,c)=>{e.switchMode("mt32",1);let i=e.chRedir(c,s,!0),d=a[1]+(a[0]<<7);d<10&&(e.#N[i]=1),a.subarray(2).forEach((l,h)=>{let m=h+d;m<14&&(e.#_[(i-1)*y.cmt+m]=l)}),e.pushChPrimitives(i)}).add([22,18,3],(a,s,c)=>{e.switchMode("mt32",1);let i=c&7;if(a[0]){let d=(a[0]-1<<7)+a[1]-16;a.subarray(2).forEach((l,h)=>{let m=h+d,u=(m>>2)+24,E=m&3,w=i*y.dpn;if(T()&&console.debug(`MT-32 dev drum note ${u} param ${E}: ${l}`),u<24){console.warn(`MT-32 dev drum write attempted on an OOB note: ${u}`);return}[()=>{},()=>{e.#D[(w+X[26])*y.dnc+u]=Math.round(l*1.27)},()=>{e.#D[(w+X[26])*y.dnc+u]=l*9+1&127},()=>{e.#D[(w+X[26])*y.dnc+u]=l?127:0}][E]()})}else{let d=a[1];a.subarray(2).forEach((l,h)=>{let m=h+d;e.#$[m]=l;let u=e.chRedir(1+(m>>4),s,!0),E=m&15;([!1,()=>{let w=e.#$[u-1<<4];if(w<3)if(e.#N[u]=1,w===2)for(let $=0;$<name.length;$++)e.#_[(u-1)*y.cmt+$]=e.#L[l*y.cmt+$];else{let $=e.baseBank.get(0,l+(w<<6),127,"mt32").name;for(let M=0;M<$.length;M++)e.#_[(u-1)*y.cmt+M]=$.charCodeAt(M)}e.pushChPrimitives(u)},()=>{e.#s[u*y.rpn+3]=l+40,e.#f[y.rpnt*u+2]=1},()=>{e.#s[u*y.rpn+1]=l+14,e.#f[y.rpnt*u+1]=1},()=>{e.#s[u*y.rpn]=l,e.#f[y.rpnt*u]=1},!1,()=>{e.setChCc(u,91,l?127:0)},!1,()=>{e.setChCc(u,7,l)},()=>{e.setChCc(u,10,Math.ceil(l*9.05))}][E]||(()=>{}))()})}}).add([22,18,4],(a,s,c)=>{e.switchMode("mt32",1);let i=a[1]+(a[0]<<7),d=[];a.subarray(2).forEach((l,h)=>{let m=h+i,u=e.chRedir(Math.floor(m/246+1),s,!0),E=m%246;E<14&&(e.#_[(u-1)*y.cmt+E]=l),E<10&&(e.#N[u]=1),d.indexOf(u)<0&&d.push(u)}),d.forEach(l=>{e.pushChPrimitives(l)})}).add([22,18,5],(a,s,c)=>{e.switchMode("mt32",1);let i=(a[0]<<7)+a[1];a.subarray(2).forEach((d,l)=>{let h=i+l,m=Math.floor(h/8),u=h&7,E=m*8;e.#t[h]=d,([!1,()=>{let w=e.#t[E];if(w<3){let $="";if(w===2){let B=y.cmt*m;$=`MT-m:${d.toString().padStart(3,"0")}`}else $=e.baseBank.get(0,d+(w<<6),127,"mt32").name;e.userBank.clearRange({msb:0,lsb:127,prg:m});let M=`MSB	LSB	PRG	NME
49	127	${m}	${$}`;e.userBank.load(M,!0)}}][u]||(()=>{}))()}),e.forceVoiceRefresh()}).add([22,18,8],(a,s,c)=>{e.switchMode("mt32",1);let i=((a[0]&1)<<7)+a[1],d=a[0]>>1,l=!1;if(a.subarray(2).forEach((h,m)=>{let u=i+m;u<y.cmt&&(e.#L[d*y.cmt+u]=h,l=!0)}),l){e.userBank.clearRange({msb:0,lsb:127,prg:d});let h=`MSB	LSB	PRG	NME
49	127	${d}	MT-m:${d}`;e.userBank.load(h,!0)}e.forceVoiceRefresh()}).add([22,18,16],(a,s,c)=>{e.switchMode("mt32",1);let i=a[1],d=!1,l=function(h,m){e.#d[m-12]=h,d=!0};a.subarray(2).forEach((h,m)=>{let u=m+i;([!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,l,l,l,l,l,l,l,l,l,()=>{e.#p=h,e.dispatchEvent("mastervolume",e.#p)}][u]||(()=>{}))(h,m)}),d&&e.buildRchTree()}).add([22,18,32],(a,s,c)=>{e.switchMode("mt32",1);let i=a[1],d=" ".repeat(i);a.subarray(2).forEach(l=>{l>31?d+=String.fromCharCode(l):d+=" "}),e.#q=d.padStart(20," "),e.#G=e.clockSource.now()+3200}).add([22,18,82],(a,s)=>{let c=e.chRedir(0,s,!0);for(let i=0;i<16;i++)e.#I.ano(c+i),i&&i<10&&(e.#n[c+i]=De[i-1]);console.info("MT-32 alt reset complete.")}),this.#Q.add([66,0],(a,s)=>{e.switchMode("ns5r",1),e.setPortMode(e.getTrackPort(s),2,v.ns5r),e.#w=e.KARAOKE_NONE,console.debug(`NS5R mode switch requested: ${["global","multi","prog edit","comb edit","drum edit","effect edit"][a[0]]} mode.`)}).add([66,1],(a,s)=>{let c=["ns5r","05rw"][a[0]];e.switchMode(c,1),e.setPortMode(e.getTrackPort(s),2,v[c]),e.#w=e.KARAOKE_NONE}).add([66,18,0,0],(a,s)=>{let c=a[0];switch(c){case 124:case 126:case 127:{e.switchMode("ns5r",2),e.setPortMode(e.getTrackPort(s),2,v.ns5r),e.#w=e.KARAOKE_NONE;break}case 125:{e.initDrums(),console.info(`NS5R drum setup reset on drum kit ${a[1]}.`);break}default:if(c<10){let i=[0,0,0,0],d=(l,h)=>{i[h]=l};if(a.subarray(1).forEach((l,h)=>{[d,d,d,d,()=>{e.#p=l*129/16383*100,e.dispatchEvent("mastervolume",e.#p)},()=>l-64,()=>l-64,()=>{},()=>{},()=>{}][c+h]()}),a[0]<4){let l=0;i.forEach(h=>{l=l<<4,l+=h}),l-=1024,console.debug(`Master tune: ${l}`)}}}}).add([66,18,0,1],(a,s)=>{}).add([66,18,0,2],(a,s)=>{}).add([66,18,1],(a,s)=>{e.invokeSysExIndicator();let c=e.chRedir(a[0],s,!0),i=R[c],d=a[1],l=`NS5R CH${c+1} `;a.subarray(2).forEach((h,m)=>{let u=d+m;u<3?([()=>{e.#e[i+x[0]]=h||K.bank0,e.pushChPrimitives(c)},()=>{e.#e[i+x[32]]=h,e.pushChPrimitives(c)},()=>{e.#n[c]=h}][u](),e.pushChPrimitives(c)):u<8||(u<14?[()=>{let E=e.chRedir(h,s,!0),w=e.#d[c];e.#d[c]=E,(c!==E||E!==w)&&(e.buildRchTree(),console.info(`${l}receives from CH${E+1}`))},()=>{e.#u[c]=+!h},()=>{e.setChType(c,h,v.ns5r),console.debug(`${l}type: ${ce[h]}`)},()=>{e.#s[y.rpn*c+3]=h,e.#f[y.rpnt*c+2]=1,e.dispatchEvent("pitch",{part:c,pitch:e.getPitchShift(c)})},()=>{},()=>{}][u-8]():u<16||(u<33?[()=>{e.#e[i+x[7]]=h},()=>{e.#e[i+x[11]]=h},()=>{},()=>{},()=>{e.#e[i+x[10]]=h||128},()=>{},()=>{},()=>{e.#e[i+x[93]]=h},()=>{e.#e[i+x[91]]=h},()=>{e.#e[i+x[76]]=h},()=>{e.#e[i+x[77]]=h},()=>{e.#e[i+x[78]]=h},()=>{e.#e[i+x[74]]=h},()=>{e.#e[i+x[71]]=h},()=>{e.#e[i+x[73]]=h},()=>{e.#e[i+x[75]]=h},()=>{e.#e[i+x[72]]=h}][u-16]():u<112||u<114&&[()=>{e.#e[i+x[5]]=h},()=>{e.#e[i+x[65]]=h}][u-112]()))})}).add([66,18,8,0],(a,s)=>{let c=a[0];if(c<32)e.setLetterDisplay(a.subarray(1,33),"NS5R letter display");else{let i=c-32;e.#C=e.clockSource.now()+3200,e.#h=10;let d=a.subarray(1),l=4;d.forEach(function(h,m){let u=m+i,E=u>>4,w=u&15;if(u<80){let $=E<l?h:h>>3,M=0,B=E<l?6:3;for(;$>0;)e.#k[w*32+E*7+(B-M)]=$&1,$=$>>1,M++}})}}).add([66,18,48],(a,s,c)=>{f(0,a)}).add([66,18,49],(a,s,c)=>{f(1,a)}).add([66,18,50],(a,s,c)=>{f(2,a)}).add([66,18,51],(a,s,c)=>{f(3,a)}).add([66,18,52],(a,s,c)=>{f(4,a)}).add([66,18,53],(a,s,c)=>{f(5,a)}).add([66,18,54],(a,s,c)=>{f(6,a)}).add([66,18,55],(a,s,c)=>{f(7,a)}).add([66,52],(a,s)=>{e.switchMode("ns5r",1),e.#w=e.KARAOKE_NONE;let c="";G(a,(i,d)=>{d<8?(i>31&&(c+=String.fromCharCode(i)),d===7&&(e.aiEfxName=c)):d<10&&(e.setEffectType(d-8,44,i),e.pushEffectType(d-8))})}).add([66,53],(a,s)=>{e.invokeSysExIndicator(),e.switchMode("ns5r",1),e.#w=e.KARAOKE_NONE;let c="",i=a[a.length-1],d=a.subarray(0,a.length-1),l=ee(d);l!==i&&(console.info(`NS5R current multi dump checksum mismatch! Expected ${l}, got ${i}.`),console.debug(a));let h=e.getTrackPort(s);if(e.#g[h]&&e.#g[h]!==v.ns5r)if(e.#A.dumpLimit===e.DUMP_MODE){console.warn(`Dump cancelled for track ${s}. Port ${String.fromCharCode(65+h)} mode "${L[e.#g[h]]}" mismatch, should be "ns5r".`);return}else console.info(`Track ${s} is trying to perform a mismached mode dump on port ${String.fromCharCode(65+h)}.`);e.setPortMode(h,2,v.ns5r),G(d,function(m,u){switch(!0){case u<2944:{let E=e.chRedir(Math.floor(u/92),s,!0),w=R[E];switch(u%92){case 0:{e.#e[w+x[0]]=m,e.pushChPrimitives(E),e.pushChPrimitives(E);break}case 1:{e.#e[w+x[32]]=m,!m&&!e.#e[w+x[0]]&&(e.#e[w+x[0]]=K.bank0),e.pushChPrimitives(E);break}case 2:{e.#n[E]=m,m>0&&e.setChActive(E,1);break}case 3:{let $=e.chRedir(m,s,!0);e.#d[E]=$,E!==$&&console.info(`NS5R CH${E+1} receives from CH${$+1}.`);break}case 7:{e.#i[E]=m,e.pushChPrimitives(E);break}case 8:{e.#s[E*y.rpn+3]=m<40||m>88?m+(m>63?-192:64):m,e.#f[y.rpnt*E+2]=1,e.dispatchEvent("pitch",{part:E,pitch:e.getPitchShift(E)});break}case 9:case 10:{e.#e[w+x[7]]=m;break}case 11:{e.#e[w+x[11]]=m;break}case 14:{e.#e[w+x[10]]=m||128;break}case 19:{e.#e[w+x[93]]=m;break}case 20:{e.#e[w+x[91]]=m;break}case 84:{e.#e[w+x[65]]=m;break}case 85:{e.#e[w+x[5]]=m;break}}break}case u<3096:break;case u<3134:{let E=u-3096;E<8?(m>31&&(c+=String.fromCharCode(m)),E===7&&(e.aiEfxName=c)):E<10&&(e.setEffectType(E-8,44,m),e.pushEffectType(E-8));break}case u<8566:break}}),e.buildRchTree()}).add([66,54],(a,s)=>{e.invokeSysExIndicator(),e.switchMode("ns5r",1);let c="",i=80,d=0,l=0,h="MSB	PRG	LSB	NME";G(a,function(m,u){let E=u%158;switch(!0){case E<10:{m>31&&(c+=String.fromCharCode(m));break}case E===10:break;case E===11:{i=m&127;break}case E===12:{l=m&127;break}case E===13:{h+=`
${i}	${d}	${l}	${c.trim().replace("Init Voice","")}`,d++,c="";break}}}),e.userBank.clearRange({msb:80,lsb:0}),e.userBank.load(h),T()&&console.debug(h),e.forceVoiceRefresh()}).add([66,55],(a,s)=>{e.invokeSysExIndicator(),e.switchMode("ns5r",1);let c="",i=88,d=0,l=0,h="MSB	PRG	LSB	NME";G(a,function(m,u){let E=u%126;switch(!0){case E<10:{m>31&&(c+=String.fromCharCode(m));break}case E===11:break;case E===12:break;case E===13:{h+=`
${i}	${d}	${l}	${c.trim().replace("Init Combi","")}`,d++,c="";break}}}),e.userBank.clearRange({msb:88,lsb:0}),e.userBank.load(h),T()&&console.debug(h),e.forceVoiceRefresh()}).add([66,125],(a,s,c)=>{e.dispatchEvent("backlight",["green","orange","red",!1,"yellow","blue","purple"][a[0]]||"white")}).add([66,127],(a,s,c)=>{let i=a[a.length-1],d=a.subarray(0,a.length-1),l=ee(d);l!==i&&(console.info(`NS5R screen dump checksum mismatch! Expected ${l}, got ${i}.`),console.debug(a));let h=new Uint8Array(5760);G(a,(m,u,E)=>{if(u<720)for(let w=0;w<8;w++)h[u*8+w]=m>>7-w&1}),e.dispatchEvent("screen",{type:"ns5r",data:h})}).add([76],(a,s,c)=>{e.#Q.run([66,...a],s,c)}),e.#de.add([16,0,8,0],(a,s,c)=>{let i=(a[2]<<4)+a[3],d="K11 ";([()=>{e.switchMode("k11",2),e.setPortMode(e.getTrackPort(s),2,v.k11),e.#w=e.KARAOKE_NONE,e.#l[v.k11][1]=i?4:0,console.info("MIDI reset: GMega/K11")},()=>{e.setEffectType(0,24,i),console.debug(`${d}reverb type: ${i}`),e.pushEffectType(0)},()=>{console.debug(`${d}reverb time: ${i}`)},()=>{console.debug(`${d}reverb time: ${i}`)},()=>{console.debug(`${d}reverb predelay: ${i}`)},()=>{console.debug(`${d}reverb predelay: ${i}`)},()=>{console.debug(`${d}depth high: ${i}`)},()=>{console.debug(`${d}depth high: ${i}`)},()=>{console.debug(`${d}depth low: ${i}`)},()=>{console.debug(`${d}depth low: ${i}`)}][a[0]]||(()=>{}))()}).add([16,0,8,1],(a,s,c)=>{e.invokeSysExIndicator();let i=e.chRedir(a[1],s,!0),d=R[i],l=re[i],h=(a[3]<<4)+a[4],m=`GMega CH${i+1} `;([()=>{h<128?(e.setChType(i,e.CH_MELODIC,v.k11),e.#e[d+x[0]]=0,e.#n[i]=h):(e.setChType(i,e.CH_DRUMS,v.k11),e.#n[i]=h-128),e.pushChPrimitives(i)},()=>{let u=e.chRedir(h,s,!0),E=e.#d[i];e.#d[i]=u,(i!==u||u!==E)&&(e.buildRchTree(),console.info(`${m}receives from CH${u+1}`))},()=>{e.#e[d+x[7]]=h},()=>{uupThis.setChActive(i,h)},()=>{e.#e[d+x[10]]=h},()=>{e.#s[l+3]=h+40,e.#f[y.rpnt*i+2]=1,e.dispatchEvent("pitch",{part:i,pitch:e.getPitchShift(i)})},()=>{e.#s[l+1]=h>>1,e.#s[l+2]=h&1,e.#f[y.rpnt*i+1]=1,e.dispatchEvent("pitch",{part:i,pitch:e.getPitchShift(i)})},()=>{e.#e[d+x[91]]=h?127:0},()=>{},()=>{e.#e[d+x[74]]=h},()=>{e.#e[d+x[73]]=h},()=>{e.#e[d+x[72]]=h}][a[0]]||(()=>{}))()}).add([16,0,9,0],(a,s,c)=>{e.invokeSysExIndicator();let i=(a[2]<<4)+a[3],d="GMLX ";([()=>{console.debug(`${d}reverb type: ${i}`)},()=>{console.debug(`${d}reverb time: ${i}`)},()=>{console.debug(`${d}reverb predelay: ${i}`)},()=>{console.debug(`${d}depth high: ${i}`)},()=>{console.debug(`${d}depth low: ${i}`)}][a[0]]||(()=>{}))()}).add([16,0,9,3],(a,s,c)=>{e.invokeSysExIndicator();let i=(a[2]<<4)+a[3],d=e.chRedir(a[1],s,!0),l=R[d],h=`GMLX CH${d+1} `;[()=>{i<128?(e.setChType(d,e.CH_MELODIC,v.k11),e.#e[l+x[0]]=0,e.#e[l+x[32]]=0,e.#n[d]=i):i<160?(e.setChType(d,e.CH_MELODIC,v.k11),e.#e[l+x[0]]=0,e.#e[l+x[32]]=7,e.#n[d]=i-100):(e.setChType(d,e.CH_DRUMS,v.k11),e.#e[l+x[0]]=122,e.#e[l+x[32]]=0,e.#n[d]=i-160),e.pushChPrimitives(d)},()=>{let m=e.chRedir(i,s,!0),u=e.#d[d];e.#d[d]=m,(d!==m||m!==u)&&(e.buildRchTree(),console.info(`${h}receives from CH${m+1}`))}][a[0]]()}).add([16,0,9,4],(a,s,c)=>{e.invokeSysExIndicator();let i=(a[2]<<4)+a[3],d=e.chRedir(a[1],s,!0),l=R[d],h=re[d];[()=>{e.setChActive(d,i)},()=>{e.#e[l+x[7]]=i},()=>{e.#e[l+x[10]]=i},()=>{e.#e[l+x[91]]=i?127:0},()=>{e.#s[h+3]=i+40,e.#f[y.rpnt*d+2]=1,e.dispatchEvent("pitch",{part:d,pitch:e.getPitchShift(d)})},()=>{e.#s[h+1]=i,e.#f[y.rpnt*d+1]=1,e.dispatchEvent("pitch",{part:d,pitch:e.getPitchShift(d)})},()=>{e.#s[h]=i,e.#f[y.rpnt*d]=1,e.dispatchEvent("pitch",{part:d,pitch:e.getPitchShift(d)})},()=>{}][a[0]]()}),this.#fe.add([66,93,64],(a,s,c)=>{let i=a[2];switch(a[0]){case 0:{switch(a[1]){case 4:{e.invokeSysExIndicator(),e.#p=i*129/16383*100,e.dispatchEvent("mastervolume",e.#p);break}case 5:{e.invokeSysExIndicator(),i-64;break}case 6:{e.invokeSysExIndicator(),console.debug(`SG global reverb: ${i?"on":"off"}`);break}case 127:{e.switchMode("sg",2),e.setPortMode(e.getTrackPort(s),1,v.sg);break}}break}case 1:{switch(a[1]){case 48:{e.invokeSysExIndicator(),console.debug(`SG reverb type: ${Le[i]}`);break}}break}default:if(a[0]>>4===1){e.invokeSysExIndicator();let d=e.chRedir(a[0]&15,s,!0);if(a[1]===2){let l=e.chRedir(i,s,!0),h=e.#d[d];e.#d[d]=l,(d!==l||l!==h)&&(e.buildRchTree(),console.info(`SG CH${d+1} receives from CH${l+1}`))}else a[1]===19&&e.setChCc(d,7,i)}else console.warn(`Unknown AKAI SG SysEx: ${a}`)}}),this.#he.add([9],(a,s,c)=>{e.invokeSysExIndicator(),console.debug(`GZ set effect: ${["stage reverb","hall reverb","room reverb","chorus","tremolo","phaser","rotary speaker","enhancer","flanger","EQ"][a[0]]||"off"}`)}),this.#U.add([127,0],(a,s,c)=>{e.switchMode("motif",1);let i=new Uint8Array([127,1,...a]);e.#U.run(i,s,c)}).add([127,1,0,0],(a,s,c)=>{e.switchMode("s90es");let i="S90/Motif ES system ",d=a[0];a.subarray(1).forEach((l,h)=>{([()=>{e.#p=l*12900/16383,e.dispatchEvent("mastervolume",e.#p)}][d+h]||(()=>{console.info(`Unrecognized ${i}ID: ${d+h}`)}))()})}).add([127,1,14],(a,s,c)=>{e.switchMode("s90es");let i="S90/Motif ES bulk header ",d=[];d[95]=(l,h,m)=>{console.debug(`${i}multi edit buffer: ${l[1]}`)},(d[a[0]]||(()=>{console.info(`Unrecognized ${i}ID: ${a[0]}.`)}))(a.subarray(1))}).add([127,1,15],(a,s,c)=>{e.switchMode("s90es");let i="S90/Motif ES bulk footer ",d=[];d[95]=(l,h,m)=>{console.debug(`${i}multi edit buffer: ${l[1]}`)},(d[a[0]]||(()=>{console.info(`Unrecognized ${i}ID: ${a[0]}.`)}))(a.subarray(1))}).add([127,1,54,1],(a,s,c)=>{e.switchMode("s90es");let i="S90/Motif ES reverb ",d=a[0];a.subarray(1).forEach((l,h)=>{([()=>{e.setEffectTypeRaw(0,!1,l&15|128)},()=>{e.setEffectTypeRaw(0,!0,l)}][d+h]||(()=>{}))()}),e.pushEffectType(0)}).add([127,1,54,2],(a,s,c)=>{e.switchMode("s90es");let i="S90/Motif ES chorus ",d=a[0];a.subarray(1).forEach((l,h)=>{([()=>{e.setEffectTypeRaw(1,!1,l&15|128)},()=>{e.setEffectTypeRaw(1,!0,l)}][d+h]||(()=>{}))()}),e.pushEffectType(1)}).add([127,1,54,3],(a,s,c)=>{e.switchMode("s90es");let i="S90/Motif ES insert 1 ",d=a[0];a.subarray(1).forEach((l,h)=>{([()=>{e.setEffectTypeRaw(3,!1,l&15|128)},()=>{e.setEffectTypeRaw(3,!0,l)}][d+h]||(()=>{}))()}),e.pushEffectType(3)}).add([127,1,54,4],(a,s,c)=>{e.switchMode("s90es");let i="S90/Motif ES insert 2 ",d=a[0];a.subarray(1).forEach((l,h)=>{([()=>{e.setEffectTypeRaw(4,!1,l&15|128)},()=>{e.setEffectTypeRaw(4,!0,l)}][d+h]||(()=>{}))()}),e.pushEffectType(4)}).add([127,1,54,16],(a,s,c)=>{e.switchMode("s90es");let i=a[0];a.subarray(1).forEach((d,l)=>{let m=`S90/Motif ES EQ${(l>>2)+1} `;([()=>{let u=d-64},()=>{let u=ae[d]},()=>{let u=d/10},()=>{let u=d}][i+l&3]||(()=>{}))()})}).add([127,1,54,17],(a,s,c)=>{e.switchMode("s90es");let i="S90/Motif ES variation ",d=a[0];a.subarray(1).forEach((l,h)=>{([()=>{e.setEffectTypeRaw(2,!1,l&15|128)},()=>{e.setEffectTypeRaw(2,!0,l)}][d+h]||(()=>{}))()}),e.pushEffectType(2)}).add([127,1,55],(a,s,c)=>{e.invokeSysExIndicator(),e.switchMode("s90es");let i=e.getTrackPort(s);if(e.#g[i]&&e.#g[i]!==e.#r.smotif)if(e.#A.dumpLimit===e.DUMP_MODE){console.warn(`Dump cancelled for track ${s}. Port ${String.fromCharCode(65+i)} mode "${L[e.#g[i]]}" mismatch, should be "${L[e.#r.smotif]}".`);return}else console.info(`Track ${s} is trying to perform a mismached mode dump on port ${String.fromCharCode(65+i)}.`);let d=e.chRedir(a[0],s,!0),l=R[d],h=a[1];a[0]>15&&(d=a[0]+32);let m=`Track ${s} S90/Motif ES bulk CH${d<128?d+1:"U"+(d-127)} `;console.debug(m,a),!(a[0]>15)&&a.subarray(2).forEach((u,E)=>{([()=>{e.setChCc(d,0,u),e.pushChPrimitives(d)},()=>{u&&e.setChActive(d,1),e.setChCc(d,32,u),e.getChPrimitive(d,1)===63&&e.setChType(d,[32,40].indexOf(u)>-1?e.CH_DRUMS:e.CH_MELODIC,e.#a,!0),e.pushChPrimitives(d)},()=>{u&&e.setChActive(d,1),e.#n[d]=u,e.pushChPrimitives(d)},()=>{let w=e.chRedir(u,s,!0),$=e.#d[d];e.#d[d]=w,(d!==w||w!==$)&&(e.buildRchTree(),console.info(`${m}receives from CH${w+1}`))},()=>{e.#u[d]=u?0:1},!1,!1,!1,!1,!1,!1,!1,!1,()=>{u!==100&&e.setChActive(d,1),e.#e[l+x[7]]=u},()=>{u!==64&&e.setChActive(d,1),e.#e[l+x[10]]=u},!1,!1,!1,()=>{e.#e[l+x[91]]=u},()=>{u&&e.setChActive(d,1),e.#e[l+x[93]]=u},()=>{u&&e.setChActive(d,1),e.#e[l+x[94]]=u},()=>{e.setChCc(d,128,u),u!==127&&(e.setChActive(d,1),e.allocateAce(d,128))},()=>{},()=>{u!==64&&e.setChActive(d,1),e.#e[l+x[74]]=u},()=>{u!==64&&e.setChActive(d,1),e.#e[l+x[71]]=u},!1,()=>{e.#e[l+x[65]]=u},()=>{e.#e[l+x[5]]=u},()=>{}][h+E]||(()=>{}))()})}),e.#U.add([100,14],(a,s,c)=>{e.switchMode("cs6x"),e.setPortMode(e.getTrackPort(s),1,v.cs6x);let i=["normal voice","plugin voice PLG","drums",,"performance",,"phrase clip"][a[0]>>4]??"invalid";a[0]&!0?i+=" edit buffer":a[0]>>4==1?i+=`${(a[0]&1)+1}`:i+=` ${["INT","EXT"][a[0]&1]}`,console.debug(`CS6x bulk dump for ${i} started.`)}).add([100,15],(a,s,c)=>{e.switchMode("cs6x");let i=["normal voice","plugin voice PLG","drums",,"performance",,"phrase clip"][a[0]>>4]??"invalid";a[0]&!0?i+=" edit buffer":a[0]>>4==1?i+=`${(a[0]&1)+1}`:i+=` ${["INT","EXT"][a[0]&1]}`,console.debug(`CS6x bulk dump for ${i} ended.`)}).add([100,76,112],(a,s,c)=>{e.switchMode("cs6x");let i=0,d=a[0];a.subarray(1).forEach((l,h)=>{let m=h+d;m<10?(e.setChCvnRegister(i,h,l&127),e.#N[i]=1):m<12||m<13&&console.debug(`Plugin voice type: ${l}`)}),e.pushChPrimitives(i)}).add([100,76,0],(a,s,c)=>{e.switchMode("cs6x"),e.setPortMode(e.getTrackPort(s),1,v.cs6x);let i=0,d=a[0];a.subarray(1).forEach((l,h)=>{let m=h+d;([()=>{e.setChCc(i,7,l),l!==100&&e.setChActive(i,1)},,,()=>{e.#u[i]=l==0,e.setChCc(i,64,0),e.#I.ano(i),e.resetChAceAll(i)},,()=>{},,,()=>{e.setChCc(i,65,l?127:0)},()=>{e.setChCc(i,5,l)},,()=>{e.setChCc(i,91,l),l!==40&&e.setChActive(i,1)},()=>{e.setChCc(i,93,l),l&&e.setChActive(i,1)}][m]||(()=>{}))()})}).add([100,76,1],(a,s,c)=>{e.switchMode("cs6x");let i=0,d=a[0],l=!1;a.subarray(1).forEach((h,m)=>{let u=m+d;([()=>{e.setEffectTypeRaw(0,!1,h&15|128),l=!0},()=>{e.setEffectTypeRaw(0,!0,h),l=!0}][u]||(()=>{}))()}),l&&e.pushEffectType(0)}).add([100,76,2],(a,s,c)=>{e.switchMode("cs6x");let i=0,d=a[0],l=!1;a.subarray(1).forEach((h,m)=>{let u=m+d;([()=>{e.setEffectTypeRaw(1,!1,h&15|128),l=!0},()=>{e.setEffectTypeRaw(1,!0,h),l=!0}][u]||(()=>{}))()}),l&&e.pushEffectType(1)}).add([100,76,3],(a,s,c)=>{e.switchMode("cs6x");let i=0,d=a[0],l=!1;a.subarray(1).forEach((h,m)=>{let u=m+d;([()=>{e.setEffectTypeRaw(2,!1,h&15|128),l=!0},()=>{e.setEffectTypeRaw(2,!0,h),l=!0}][u]||(()=>{}))()}),l&&e.pushEffectType(2)}).add([100,76,5],(a,s,c)=>{e.switchMode("cs6x")}).add([100,76,16],(a,s,c)=>{e.switchMode("cs6x");let i=0,d=a[0],l=!1;if(a.subarray(1).forEach((h,m)=>{let u=m+d;([()=>{e.setChCc(i,0,h),l=!0},()=>{e.setChCc(i,32,h),l=!0,h&&e.setChActive(i,1)},()=>{e.#n[i]=h,l=!0,h&&e.setChActive(i,1)},()=>{e.#f[re[i]+we[2]]=1,e.#s[re[i]+we[2]]=h,h&&e.setChActive(i,1)}][u]||(()=>{}))()}),l){switch(e.pushChPrimitives(i),e.getChVoice(i).standard){case"DX":{e.#y[i]=e.EXT_DX;break}case"VL":{e.#y[i]=e.EXT_VL;break}}e.dispatchEvent("metacommit",{type:"OSysMeta",msg:"part.rename",data:{part:i}})}}).add([100,76,32],(a,s,c)=>{e.switchMode("cs6x");let i=0,d=a[0],l=e.#y[i];switch(l){case e.EXT_DX:{a.length>2&&console.debug(a),a.subarray(1).forEach((h,m)=>{let u=m+d;if(u<6){let E=u+142;e.setChCc(i,E,h),h!==64&&e.allocateAce(i,E)}else if(u<12){let E=u+144;e.setChCc(i,E,h),h!==64&&e.allocateAce(i,E)}else([()=>{},()=>{},()=>{},()=>{}][u]||(()=>{}))()});break}case e.EXT_VL:{console.info(`Support for Modular System Plug-in writes is not yet present for plugin type ${l}.`);break}default:console.warn(`Unsupported plug-in type: ${l}`)}}),this.#z.add([0,72,18,0,0,0,0],(a,s,c)=>{e.switchMode("sd",2),e.setPortMode(e.getTrackPort(s),2,v.sd),console.info("MIDI reset: SD")}).add([0,72,18,16,0],(a,s,c)=>{e.invokeSysExIndicator();let i=a[0]>>5,d=a[0]&31;switch(i){case 0:{let l=a[0]>>1,h=a[1];switch(l){case 1:{a.subarray(2).forEach((m,u,E)=>{let w=u+h;switch(w){case 0:{m&&(e.setEffectType(1,60,m-1),e.pushEffectType(1),console.debug(`SD MFX Cho: ${w} - ${m}`));break}}});break}case 2:{a.subarray(2).forEach((m,u)=>{let E=u+h;switch(E){case 0:{m&&(e.setEffectType(0,55+m,0),e.pushEffectType(0),console.debug(`SD MFX Rev: ${E} - ${m}`));break}}});break}case 3:case 4:case 5:{let m=l-1;a.subarray(2).forEach((u,E)=>{let w=E+h;switch(console.debug(`SD MFX ${m-2}: ${w} - ${u}`),w){case 0:{e.setEffectTypeRaw(m,62,u),e.pushEffectType(m);break}}}),console.debug(`SD MFX message:
%o`,a);break}default:console.debug(`Unknown SD-90 global effects message:
%o`,a)}break}case 1:{let l=e.chRedir(d,s,!0),h=a[1],m=R[l];a.subarray(2).forEach((u,E)=>{let w=h+E;w<37?([()=>{},()=>{},0,()=>{},()=>{switch(u){case 104:case 105:case 106:case 107:case 120:case 128:{e.#i[l]||e.setChType(l,e.CH_DRUMS);break}default:e.#i[l]&&e.setChType(l,e.CH_MELODIC)}e.setChCc(l,0,u),e.pushChPrimitives(l)},()=>{e.setChCc(l,32,u),e.pushChPrimitives(l)},()=>{e.#n[l]=u},()=>{e.#e[m+x[7]]=u},()=>{e.#e[m+x[10]]=u},()=>{},()=>{},()=>{u<2&&(e.#u[l]=u)},()=>{u<2&&(e.#e[m+x[68]]=u?127:0)},()=>{},()=>{u<2&&(e.#e[m+x[65]]=u?127:0)},()=>{e.#e[m+x[5]]=u&15<<4|e.#e[m+x[5]]&15},()=>{e.#e[m+x[5]]=u&15|(e.#e[m+x[5]]&240)>>4},()=>{e.#e[m+x[74]]=u},()=>{e.#e[m+x[71]]=u},()=>{e.#e[m+x[73]]=u},()=>{e.#e[m+x[72]]=u},0,0,0,0,0,0,0,()=>{e.#e[m+x[128]]=u,e.allocateAce(128)},()=>{e.#e[m+x[93]]=u},()=>{e.#e[m+x[91]]=u},0,0,()=>{e.#e[m+x[75]]=u},()=>{e.#e[m+x[76]]=u},()=>{e.#e[m+x[77]]=u},()=>{e.#e[m+x[78]]=u}][w]||(()=>{}))():w<63||(w<64?(e.#i[l]?(e.setChCc(l,0,104|u),e.pushChPrimitives(l)):(e.setChCc(l,0,96|u),e.pushChPrimitives(l)),e.pushChPrimitives(l)):console.debug(`Unknown SD-90 global CH${l+1} param setup message:
%o`,a))});break}case 2:{let l=e.chRedir(d,s,!0),h=a[1];console.debug(`Unknown SD-90 global CH${l+1} MIDI setup message:
%o`,a.subarray(2));break}default:console.warn(`Unknown SD-90 global part setup message:
%o`,a)}}),e.#Q.add([0,1,73,78],(a,s,c)=>{e.switchMode("krs",1),e.setPortMode(e.getTrackPort(s),1,v.krs),console.debug("Might be KORG KROSS 2 mode reset... Not sure.")}).add([0,1,73,117,2,37],(a,s,c)=>{e.switchMode("krs",1);let i=e.getTrackPort(s);if(e.#g[i]&&e.#g[i]!==v.krs)if(e.#A.dumpLimit===e.DUMP_MODE){console.warn(`Dump cancelled. Port ${String.fromCharCode(65+i)} mode "${L[e.#g[i]]}" mismatch, should be "krs".`);return}else console.info(`Track ${s} is trying to perform a mismached mode dump on port ${String.fromCharCode(65+i)}.`);e.setPortMode(e.getTrackPort(s),1,v.krs);let d="KROSS 2 BMT1 ",l="";G(a,(h,m)=>{if(m<24)l+=String.fromCharCode(Math.max(32,h));else if(!(m<88)){if(m<468){let u=m-88,E=u*863>>16,w=u-E*76;([()=>{e.setEffectType(E+3,45,h),e.pushEffectType(E+3)},!1,()=>{console.debug(`${d}IFX${E+1} sends to ${h<=5&&h>0?`IFX${h}`:"direct out"}.`)}][w]||(()=>{}))()}else if(m<604){let u=m-468,E=u*964>>16,w=u-E*68;([()=>{e.setEffectType(1-E,45,h),e.dispatchEvent(["efxreverb","efxchorus"][1-E],{id:e.getEffectType(1-E)})},!1][w]||(()=>{}))()}else if(!(m<1276)){let u=m-1276,E=u*1490>>16,w=e.chRedir(E,s,!0),$=u-E*44;$<22?([()=>{h&&e.setChActive(w,1),e.#n[w]=h,e.pushChPrimitives(w)},()=>{h&&e.setChActive(w,1),h<10?(e.setChCc(w,0,63),e.setChCc(w,32,h)):h<20?(e.setChCc(w,0,121),e.setChCc(w,32,h-10)):h<24&&(e.setChCc(w,0,[120,0,56,62][h-20]),e.setChCc(w,32,0)),e.pushChPrimitives(w)},()=>{let M=e.chRedir(h&15,s,!0);e.#d[w]=M,M!==w&&console.info(`${d}CH${w+1} receives from CH${M+1}`);let B=h>>5&1;e.modelEx.kross.chToggle&&(e.setChActive(w,B),B||console.debug(`KORG KROSS 2 CH${w+1} is disabled.`))},!1,!1,()=>{e.setChCc(w,7,h)},!1,()=>{},()=>{},!1,!1,!1,!1,!1,()=>{e.setChCc(w,10,h||128)}][$]||(()=>{}))():$<36?([()=>{let M=h&7;h&8&&(M=1),M>1&&console.debug(`${d}CH${w+1} sends to ${M>1?`IFX${M-1}`:"direct out"} (${h.toString(16)}).`),e.setChEffectSink(w,h>1&&h<7?h+1:0)}][$-22]||(()=>{}))():([()=>{e.setChCc(w,74,(h+128&255)-64)},()=>{e.setChCc(w,71,(h+128&255)-64)},!1,!1,()=>{e.setChCc(w,73,(h+128&255)-64)},()=>{e.setChCc(w,75,(h+128&255)-64)},!1,()=>{e.setChCc(w,72,(h+128&255)-64)}][$-36]||(()=>{}))()}}}),l=l.trimEnd(),e.dispatchEvent("metacommit",{type:"EORTitle",data:l})});let k=function(a,s,c){let i=e.chRedir(a,s,!0);e.setChMode(i,v.an1x),e.pushChPrimitives(i),console.debug(`Yamaha AN1x slot ${c+1} receives from CH${i+1}(${a+1}).`),e.modelEx.yPlg[3][c]=i};e.#U.add([92,0,0],(a,s,c)=>{let i=a[0];a.subarray(1).forEach((d,l)=>{let h=l+i;h<2||([!1,!1,!1,!1,!1,!1,()=>{k(d,s,0)},()=>{k(d,s,1)}][h-2]||(()=>{}))()})}),e.#U.add([75,80,0],(a,s,c)=>{let i=a[0];a.subarray(1).forEach((d,l)=>{let h=l+i;([()=>{e.modelEx.cs1x.perfCh=d,e.pushChPrimitives(d),console.debug(`Yamaha CS1x performance on CH${d+1}.`)},!1,!1,!1,()=>{},!1,()=>{switch(d){case 1:{e.switchMode("xg",2),e.setPortMode(e.getTrackPort(s),1,v.xg),console.debug("Yamaha CS1x set to XG mode.");break}case 3:{e.switchMode("cs1x",2),e.setPortMode(e.getTrackPort(s),1,v.cs1x),console.debug("Yamaha CS1x set to performance mode.");break}default:console.warn(`Unknown Yamaha CS1x mode: ${d}`)}},()=>{}][h]||(()=>{}))()})}).add([75,96,0],(a,s,c)=>{let i=a[0],d=!1,l=e.modelEx.cs1x.perfCh;a.subarray(1).forEach((h,m)=>{let u=m+i;u<8?(d=!0,e.#N[l]=1,e.setChCvnRegister(l,u,h)):u<48?([!1,()=>{e.setChCc(l,7,h)}][u]||(()=>{}))():u<80?([()=>{e.setEffectTypeRaw(0,!1,h)},()=>{e.setEffectTypeRaw(0,!0,h),e.pushEffectType(0)},()=>{e.setEffectTypeRaw(1,!1,h)},()=>{e.setEffectTypeRaw(1,!0,h),e.pushEffectType(1)},()=>{e.setEffectTypeRaw(2,!1,h)},()=>{e.setEffectTypeRaw(2,!0,h),e.pushEffectType(2)}][u-48]||(()=>{}))():T()&&console.debug(`Unknown CS1x effect register: ${u}.`)}),d&&(e.setChActive(l,1),e.pushChPrimitives(l))});let C=(a,s,c)=>{let i=0;c.forEach((d,l)=>{([()=>{i=(d&1)<<7|i&127,e.setEffectTypeRaw(a,!1,28),e.setEffectTypeRaw(a,!0,i)},()=>{i=i&128|d&127,e.setEffectTypeRaw(a,!1,28),e.setEffectTypeRaw(a,!0,i),e.pushEffectType(a)}][l+s]||(()=>{}))()})};e.#Q.add([96,0,1],(a,s,c)=>{let i=a[0];switch(a[1]){case 0:{C(0,a[2],a.subarray(3)),console.debug(`Partially parsed KORG PA EFX SysEX:
`,a);break}case 1:{C(1,a[2],a.subarray(3)),console.debug(`Partially parsed KORG PA EFX SysEX:
`,a);break}case 2:{C(2,a[2],a.subarray(3)),console.debug(`Partially parsed KORG PA EFX SysEX:
`,a);break}case 3:{C(3,a[2],a.subarray(3)),console.debug(`Partially parsed KORG PA EFX SysEX:
`,a);break}default:console.debug(`Unparsed KORG PA SysEX:
`,a)}})}};let He=_t(gt(),1);let bt=class{#a=!1;constructor(n,e,t,r){this.#a=n,this.start=e,this.end=t,this.data=r}get duration(){return this.ranged?this.end-this.start:0}get ranged(){return this.#a}},Ne=class extends bt{constructor(n,e,t){super(!0,n,e,t)}},yt=class extends bt{constructor(n,e){super(!1,n,n,e)}},_e=class extends Array{#a=-1;constructor(){super(...arguments)}resetIndex(n){this.#a=-1}fresh(){this.sort(function(n,e){return n.start==e.start?0:(+(n.start>e.start)<<1)-1}),this.forEach(function(n,e){n.index=e})}step(n,e=!1){let t=[];if(e)for(let r=0;r<this.length&&!(this[r].start>n);r++){if(this[r].end<n)continue;t.push(this[r])}else{let r=this.getRange(this.#a==-1?0:n-1,n),o=this;r.forEach(function(f){f.index>o.#a&&(t.push(f),o.#a=f.index)})}return t}getRange(n,e){n>e&&([n,e]=[e,n]);let t=[],r=-1,o=Math.ceil(Math.sqrt(this.length)),f=!0;for(let p=0;p<this.length;p+=o)this[p+o]?r<0&&this[p+o].start>=n&&(r=p):r=r<0?p:r;for(;f;)this[r]?.end<e?this[r].start>=n&&t.push(this[r]):f=!1,r++;return t}};let ca=0xffffffffffff,Et=function(n){let e=new _e,t=this,r=n.timeDivision,o=120,f=new _e,p=0,g=0;f.push(new Ne(0,ca,[120,0])),n.track.forEach(function(a){p=0,a.event.forEach(function(s){p+=s.deltaTime,s.type===255&&s?.metaType===81&&(o=6e7/s.data,f[f.length-1]&&f.push(new Ne(p,0xffffffffffff,[o,0])))})}),f.fresh(),f.forEach(function(a,s,c){s>0&&(c[s-1].end=a.start)});let b=120;f.forEach(function(a,s,c){s>0&&(a.end===a.start?c.splice(c.indexOf(a),1):b===a.data[0]&&(c[s-1].end=a.end,c.splice(c.indexOf(a),1)),b=a.data[0])});let k=0,C=120;return f.forEach(function(a){let s=a.start,c=s/C/r*60+k;C=a.data[0],k=c-s/C/r*60,a.data[1]=k}),console.debug("All tempo changes: ",f),o=120,p=0,g=0,n.track.forEach(function(a,s){p=0,g=0;let c=s+1;a.event.forEach(function(i,d){p+=i.deltaTime;let l=f.step(p,!0)[0];l&&(o=l.data[0],g=l.data[1]);let h={type:i.type,data:i.data,track:c,part:0};i.type>14?h.meta=i.metaType:h.part=i.channel,e.push(new yt(p/o/r*60+g,h))})}),e.fresh(),self.midiEvents=e,console.debug(`Parsed a type ${n.formatType} MIDI sequence.`),e};let da={866:"cp866","utf-8":"utf-8",utf8:"utf-8","utf-16":"utf-16",utf16:"utf-16","utf-16le":"utf-16",utf16le:"utf-16",unicode:"utf-16",unicodefeff:"utf-16","ucs-2":"utf-16","utf-16be":"utf-16be",utf16be:"utf-16be","utf-24":"utf-24",utf24:"utf-24","utf-24le":"utf-24",utf24le:"utf-24","utf-24be":"utf-24be",utf24be:"utf-24be","utf-32":"utf-32",utf32:"utf-32","utf-32le":"utf-32",utf32le:"utf-32","utf-32be":"utf-32be",utf32be:"utf-32be",latin1:"latin1",l1:"latin1",ascii:"latin1","us-ascii":"latin1","iso-8859-1":"latin1","iso8859-1":"latin1",cp1252:"latin1","windows-1252":"latin1",cp819:"latin1",ibm819:"latin1",latin2:"latin2",l2:"latin2","iso-8859-2":"latin2","iso8859-2":"latin2",latin3:"latin3",l3:"latin3","iso-8859-3":"latin3","iso8859-3":"latin3",latin4:"latin4",l4:"latin4","iso-8859-4":"latin4","iso8859-4":"latin4",latin5:"latin5",l5:"latin5","iso-8859-9":"latin5","iso8859-9":"latin5",cp1254:"latin5","windows-1254":"latin5",latin6:"latin6",l6:"latin6","iso-8859-10":"latin6","iso8859-10":"latin6",latin9:"latin9",l9:"latin9","iso-8859-15":"latin9","iso8859-15":"latin9","iso-8859-5":"iso-8859-5","iso8859-5":"iso-8859-5",cyrillic:"iso-8859-5","iso-8859-6":"iso-8859-6","iso8859-6":"iso-8859-6","iso-8859-6-e":"iso-8859-6","iso8859-6e":"iso-8859-6","iso-8859-6-i":"iso-8859-6","iso8859-6i":"iso-8859-6","asmo-708":"iso-8859-6","ecma-114":"iso-8859-6",arabic:"iso-8859-6","iso-8859-7":"iso-8859-7","iso8859-7":"iso-8859-7","ecma-118":"iso-8859-7",greek:"iso-8859-7",greek8:"iso-8859-7","iso-8859-8":"iso-8859-8","iso8859-8":"iso-8859-8","iso-8859-8-e":"iso-8859-8","iso8859-8e":"iso-8859-8",hebrew:"iso-8859-8",visual:"iso-8859-8","iso-8859-8-i":"iso-8859-8-i","iso8859-8i":"iso-8859-8-i",logical:"iso-8859-8-i","iso-8859-11":"iso-8859-11","iso8859-11":"iso-8859-11","windows-874":"iso-8859-11","dos-874":"iso-8859-11",cp874:"iso-8859-11","tis-620":"iso-8859-11","iso-8859-13":"iso-8859-13","iso8859-13":"iso-8859-13",latin7:"iso-8859-13",l7:"iso-8859-13","iso-8859-14":"iso-8859-14","iso8859-14":"iso-8859-14",latin8:"iso-8859-14",l8:"iso-8859-14","iso-8859-16":"iso-8859-16","iso8859-16":"iso-8859-16",cp866:"cp866",ibm866:"cp866",cp1250:"cp1250","windows-1250":"cp1250",cp1251:"cp1251","windows-1251":"cp1251",cp1253:"cp1253","windows-1253":"cp1253",cp1255:"cp1255","windows-1255":"cp1255",cp1256:"cp1256","windows-1256":"cp1256",cp1257:"cp1257","windows-1257":"cp1257",cp1258:"cp1258","windows-1258":"cp1258","euc-jp":"euc-jp",cp954:"euc-jp","euc-kr":"euc-kr",koi8:"koi8",koi:"koi8","koi8-r":"koi8","koi8-u":"koi8-u","koi8-ru":"koi8-u",mac:"mac",macintosh:"mac","mac-cyrillic":"x-mac-cyrillic","x-mac-cyrillic":"x-mac-cyrillic","x-mac-ukrainian":"x-mac-cyrillic",gbk:"gbk",gb2312:"gbk",chinese:"gbk","euc-cn":"gbk",gb18030:"gb18030",big5:"big5","big5-hkscs":"big5",sjis:"sjis","shift-jis":"sjis",ms932:"sjis","windows-31j":"sjis"},fa={"utf-8":1,"utf-16":2,"utf-16be":3,"utf-24":4,"utf-24be":5,"utf-32":6,"utf-32be":7,latin1:0,latin2:0,latin3:0,latin4:0,latin5:0,latin6:0,latin9:0,"iso-8859-5":0,"iso-8859-6":0,"iso-8859-7":0,"iso-8859-8":0,"iso-8859-8-i":0,"iso-8859-11":0,"iso-8859-13":0,"iso-8859-14":0,"iso-8859-16":0,cp866:0,cp1250:0,cp1251:0,cp1253:0,cp1255:0,cp1256:0,cp1257:0,cp1258:0,"euc-jp":1,"euc-kr":1,koi8:0,"koi8-u":0,mac:0,"x-mac-cyrillic":0,gbk:1,gb18030:1,big5:1,sjis:1},q,J=(q=class{static getUnitSize(n){if(n>7)throw new RangeError("Cannot decode encodings with more than 4 bits per unit.");return(n>>1)+1}static isBigEndian(n){return(n&1)===1}static collapse(n){let e=da[n];if(typeof e!="string")throw new TypeError(`Provided label "${n}" is not supported.`);return e}static indicator(n){let e=fa[n];if(typeof e!="number")throw new TypeError(`Provided collapsed label "${n}" is not supported.`);return e}},O(q,"BYTE_1",0),O(q,"BYTE_1_VL",1),O(q,"BYTE_2_LE",2),O(q,"BYTE_2_BE",3),O(q,"BYTE_3_LE",4),O(q,"BYTE_3_BE",5),O(q,"BYTE_4_LE",6),O(q,"BYTE_4_BE",7),q),U=(n,e)=>{n.unsent=!1,n.enqueue(e)},ve=(n,e,t=1,r=!0)=>{if(typeof t!="number"||t<=0||t>4)throw new RangeError(`Invalid byte size ${t}.`);if(!(n instanceof Uint8Array||n instanceof Uint8ClampedArray))throw new TypeError("Input buffer is not Uint8Array.");if(typeof e!="number"||e<0||e>=n.length)throw new RangeError(`Provided offset ${e} is out of buffer range.`);if(t===1)return n[e];{let o=0;if(r)for(let f=0;f<t;f++)o<<=8,o|=n[e+f];else for(let f=0;f<t;f++)o|=n[e+f]<<(f<<3);return o<0?o+4294967296:o}},ha=class{static lineRaw(n,e=0){if(typeof e!="number"||e<0||e>7)throw new TypeError("Invalid split mode.");if(!n||n?.constructor!==ReadableStream)throw new TypeError("Not a readable stream.");let t=J.getUnitSize(e),r=J.isBigEndian(e),o=n.getReader(),f,p=!1,g=[],b=0,k=0,C=0;return new ReadableStream({pull:async a=>{for(a.unsent=!0;a.unsent;){if(!f||b>=f.length){b>k&&(g.push(f.subarray(k)),k=0);let s=await o.read();f=s.value,p=s.done,b=0}if(f){let s=0;if(t===1)s=f[b];else if(r)for(let i=0;i<t;i++)s<<=8,s|=f[b+i];else for(let i=0;i<t;i++)s|=f[b+i]<<(i<<3);let c=!1;switch(s){case 10:{C===13?k+=t:c=!0;break}case 13:{c=!0;break}}if(c){if(g.length){g.push(f.subarray(k,b));let i=0;for(let h=0;h<g.length;h++)i+=g[h].length;let d=new Uint8Array(i),l=0;for(let h=0;h<g.length;h++)d.set(g[h],l),l+=g[h].length;U(a,d),g=[]}else U(a,f.subarray(k,b));k=b+=t}C=s}if(p){if(k!==b&&f&&g.push(f.subarray(k,b)),g.length){let s=0;for(let d=0;d<g.length;d++)s+=g[d].length;let c=new Uint8Array(s),i=0;for(let d=0;d<g.length;d++)c.set(g[d],i),i+=g[d].length;U(a,c)}a.unsent=!1,a.close()}b+=t}}},new ByteLengthQueuingStrategy({highWaterMark:256}))}static chunkRaw(n,e="utf-8"){if(!n||n?.constructor!==ReadableStream)throw new TypeError("Not a readable stream.");let t=J.indicator(e),r=J.getUnitSize(t),o=J.isBigEndian(t),f=n.getReader(),p;return new ReadableStream({pull:async g=>{g.unsent=!0;let{value:b,done:k}=await f.read();if(b){let C=0,a=b.length;if(t!==0&&typeof p?.length=="number"){let s=!1;switch(e){case"big5":case"gbk":case"sjis":case"euc-kr":{C=1;let c=new Uint8Array(2);c[0]=p[0],c[1]=b[0],U(g,c);break}case"euc-jp":{let c=3;p[0]===143?C=3-p.length:p[0]>127?(C=1,c=2):c=p.length;let i=new Uint8Array(3);i.set(p),i.set(b.subarray(0,C),p.length),U(g,i.subarray(0,c));break}case"gb18030":{let c=new Uint8Array(4),i=4;c.set(p),c.set(b.subarray(0,4-p.length),p.length),c[0]<128?i=p.length:c[1]>=64?(C=1,i=2):C=4-p.length,U(g,c.subarray(0,i));break}case"utf-8":{let c=4;p[0]>=240?C=4-p.length:p[0]>=224?(C=3-p.length,c=3):p[0]>=192?(C=1,c=2):c=p.length;let i=new Uint8Array(4);i.set(p),i.set(b.subarray(0,C),p.length),U(g,i.subarray(0,c));break}case"utf-16":case"utf-16be":{let c=new Uint8Array(4);c.set(p),c.set(b.subarray(0,4-p.length)),C=4-p.length,ve(transientSize,0,2,o)>=55296&&ve(transientSize,2,2,o)>=55296?U(g,c):(U(g,c.subarray(0,2)),U(g,c.subarray(2)));break}default:{let c=new Uint8Array(r);c.set(p),c.set(b.subarray(0,r-p.length),p.length),U(g,c)}}}if(p=void 0,t===0)U(g,b.subarray(C));else{switch(e){case"utf-24":case"utf-24be":{a=Math.floor((b.length-C)/r)*r+C;break}case"utf-32":case"utf-32be":{a=(b.length-C>>2<<2)+C;break}case"utf-8":{if(b[b.length-1]>127){let s=!0,c=b.length,i=b.length-8;for(;s&&c>i;)c--,b[c]<128?a=c+1:b[c]>192&&(a=c)}break}case"utf-16":case"utf-16be":{if(a=(b.length-C>>1<<1)+C,ve(b,a-2,2,o)>=55296){let s=!0,c=a,i=a-6;for(;s&&c>i;)c-=2,ve(b,c,2,o)>>10===54&&(a=c)}break}default:throw new TypeError("Maybe someday the rest of the decoders will be implemented")}U(g,b.subarray(C,a))}a<b.length&&(p=b.subarray(a))}k&&(typeof p?.length=="number"&&U(g,p),g.unsent=!1,g.close())}},new ByteLengthQueuingStrategy({highWaterMark:256}))}static line(n,e="utf-8",t){let r=J.collapse(e),o=J.indicator(r),f=this.lineRaw(n,o).getReader(),p=new TextDecoder(r,onlostpointercapture);return new ReadableStream({pull:async g=>{let{value:b,done:k}=await f.read();b&&g.enqueue(p.decode(b)),k&&g.close()}})}static chunk(n,e="utf-8",t){let r=J.collapse(e);if(self.TextDecoderStream){let o=new TextDecoderStream(r,t);return n.pipeTo(o.writable),o.readable}else{let o=this.chunkRaw(n,r).getReader(),f=new TextDecoder(r);return new ReadableStream({pull:async p=>{let{value:g,done:b}=await o.read();g&&(console.debug(g),p.enqueue(f.decode(g))),b&&p.close()}})}}},wt=ha;let Ve={0:"\0",a:"\x07",b:"\b",e:"\x1B",f:"\f",n:`
`,r:"\r",t:"	",v:"\v","\\":"\\","'":"'",'"':'"'},Xe=new Uint8Array(128);Xe.fill(1,48,58);Xe.fill(1,65,71);Xe.fill(1,97,103);let se=new Uint8Array(256);se.fill(1,0,32);se.fill(1,128,160);se[127]=1;let ua={};for(let n in Ve){let e=Ve[n];ua[e]=`\\${n}`,se[e.charCodeAt(0)]=2}se[34]=3;se[39]=3;let kt=n=>{let e="",t=!1;for(let r=0;r<n.length;r++){let o=n[r];if(t){let f=0;switch(o){case"x":{f=2;break}case"u":{f=4;break}case"U":{f=8;break}default:{let p=Ve[o];if(typeof p=="string")e+=p;else throw new Error(`Invalid escape identifier "${o}" at index ${r}`);t=!1;continue}}if(f>0){let p=r+1,g=n.substring(p,p+f);if(g.length<f)throw new RangeError(`Insufficient code point buffer "${g}" at index ${p}`);let b=parseInt(g,16);if(Number.isNaN(b))throw new RangeError(`Malformed code point representation "${g}" at index ${p}`);if(b>=1114112)throw new RangeError(`Code point "${g}" exceeds 0x10ffff at index ${p}`);e+=String.fromCodePoint(b),t=!1,r+=f}}else o==="\\"?t=!0:e+=o}return e},pa=(n,e=0)=>{};self.TextEscape=pa;let Z,xe=(Z=class{static parse(n,e){let t=n&this.MASK_TYPE,r=n&this.MASK_DATA,o=0,f=0,p,g=0,b,k=e.getReader();return new ReadableStream({pull:async C=>{let{value:a,done:s}=await k.read();if(typeof a=="string"){switch(t){case this.TYPE_TSV:{p=[];try{for(let c of a.split("	"))switch(r){case this.DATA_TEXT:{p.push(kt(c));break}case this.DATA_JSON:{p.push(o===0?kt(c):JSON.parse(c));break}default:throw new TypeError(`Unknown DSV value type ${t}`)}}catch(c){console.debug(`The following error appeared when parsing on line ${o+1}.`),console.error(c)}break}case this.TYPE_CSV:{if(r!==this.DATA_TEXT)throw new TypeError(`Invalid type ${t} for CSV, only plain text is allowed`);break}default:throw new TypeError(`Unknown DSV type ${t}`)}C.enqueue(p),o++}s&&C.close()}})}static parseObjects(n,e){let t=0,r=this.parse(n,e).getReader(),o;return new ReadableStream({start:async f=>{let{value:p,done:g}=await r.read();typeof p?.length=="number"&&(o=p),g&&f.close()},pull:async f=>{let{value:p,done:g}=await r.read();if(typeof p?.length=="number"){let b={};for(let k=0;k<p.length;k++)p[k]&&(b[o[k]]=p[k]);f.enqueue(b)}g&&f.close()}})}},O(Z,"MASK_TYPE",3),O(Z,"MASK_DATA",12),O(Z,"TYPE_TSV",0),O(Z,"TYPE_CSV",1),O(Z,"DATA_TEXT",0),O(Z,"DATA_JSON",4),Z);He.default.customInterpreter=nt;let A=(n,e,t)=>{n.addEventListener(t,r=>{e.dispatchEvent(t,r.data)})},Ct=n=>{let e=n.split("/");return e[e.length-1]||e[e.length-2]||"(remote)"};if(typeof self?.require<"u")throw new Error("Environments supporting CommonJS is not supported.");let vt=class extends ge{BM_UNIVERSAL=0;BM_YAMAHA_MU=1;device;#a;#h={};#C=[];#v=new Map;#k="";#x=[];#P=[];#d=new Uint8ClampedArray(y.ch);#i=new Uint8ClampedArray(y.ch);#e=new Uint32Array(y.ch);#b=new Uint32Array(y.ch);#n=.5;#m=120;#u=4;#c=4;#o=0;#R=0;#T=new Array(y.ch);#S=new Uint8Array(y.ch);#y=0;dState;msActive=200;msFrame=100;msExhaust=300;smoothAttack=0;smoothDecay=0;get clockSource(){return this.device?.clockSource}set clockSource(n){if(this.device)this.device.clockSource=n;else throw new Error("OctaviaDevice is not ready.")}reset(){let n=this;n.dispatchEvent("reset"),n.#a?.resetIndex(),n.device.init(),n.#k="",n.#n=.5,n.#m=120,n.#u=4,n.#c=4,n.#o=0,n.#R=0,n.dispatchEvent("tempo",n.#m),n.dispatchEvent("title",n.#k),n.dispatchEvent("tsig",n.getTimeSig())}init(){this.reset(),this.#a=void 0}async loadFile(n){this.#a=Et(He.default.parse(new Uint8Array(await n.arrayBuffer())))}async loadMap(n,e,t,r="(internal)"){let o=this,f=0,p=0,g=0,b=0,k,C;n.split(`
`).forEach((a,s)=>{if(!a)return;let c=a.split("	");if(s){if(!b)return;let i="",d="";c.forEach((h,m)=>{switch(m){case k:{i=h;break}case C:{d=h;break}}});let l=!1;o.#h[i]?.priority>t&&(l=!0,g++),!o.#h[i]||l||e?(o.#h[i]={name:d,priority:t},f++):self.debugMode&&console.debug(`Voice "${d}" (${i}) seems to be in conflict with (${o.#h[i]}).`),p++}else c.forEach((i,d)=>{switch(i){case"ID":{k=d,b++;break}case"Name":{C=d,b++;break}default:console.debug(`Unknown map field: ${i}`)}})}),console.debug(`Voice names: From "${r}", ${p} total, ${f} loaded (${f-g} + ${g}).`),o?.device.forceVoiceRefresh()}async loadMapPaths(n){let e=this;n.forEach(async(t,r)=>{e.loadMap(await(await fetch(t)).text(),0,r,Ct(t))})}async loadEfx(n,e){let t=this,r=0,o=0,f,p,g;n.split(`
`).forEach((b,k)=>{if(b)if(k){let C=0,a;b.split("	").forEach((s,c)=>{switch(c){case f:{C|=(parseInt(s,16)&255)<<8;break}case p:{C|=parseInt(s,16)&255;break}case g:{a=s;break}}}),!t.#C[C]||e?(t.#C[C]=a,r++):self.debugMode&&console.debug(`EFX ID 0x${C.toString(16).padStart(4,"0")} (${a}) seems to be in conflict.`),o++}else b.split("	").forEach((C,a)=>{switch(C){case"MSB":{f=a;break}case"LSB":{p=a;break}case"Name":{g=a;break}default:console.debug(`Unknown EFX field: ${C}`)}})}),console.debug(`EFX: ${o} total, ${r} loaded.`);for(let b=0;b<ue.length;b++){let k=!1,C=t.device.getEffectType(b);C[0]===0&&C[1]>>4===15&&(k=!0),t.dispatchEvent(`efx${ue[b]}`,{id:C,hidden:k})}}async loadModels(n,e){let t=this,r=0,o=0}async loadStyles(n,e){let t=this,r=0,o=0}async loadProps(n,e,t=0,r="(internal)"){let o=this,f=0,p=0,g=0;for await(let b of xe.parseObjects(xe.DATA_TEXT|xe.TYPE_TSV,wt.line(n)))if(typeof b?.voiceId=="string")if(p++,!(o.#v.has(b.voiceId)||o.#v.get(b.voiceId)?.priority<=t)||e){if(Object.keys(b).length<2)continue;o.#v.get(b.voiceId)?.priority>t&&g++,b.priority=t,o.handleProp&&await o.handleProp(b),o.#v.set(b.voiceId,b),f++}else console.debug(`Tried to write a pre-existing entry "${b.voiceId}" on entry ${p}.`);console.debug(`Voice properties: From "${r}", ${p} total, ${f} loaded (${f-g} + ${g}).`)}async loadPropsPaths(n){let e=this;n.forEach(async(t,r)=>{let o=t.split("/");e.loadProps((await fetch(t)).body,0,r,Ct(t))})}switchMode(n,e=!1){this.device.switchMode(n,e)}getMode(){return this.device.getMode()}getVoice(){return this.device.getVoice(...arguments)}getChVoice(n){return this.device.getChVoice(n)}refreshCachedChVoice(n,e){let t=this,r=e??t.device.getChVoice(n),o=t.#T[n],f=!0;if(t.#y++,!e)switch(t.device.getChMode(n)){case"xg":{if(t.device.getChType(n)>0&&t.device.getChPrimitive(n,1)!==126)switch(r.ending){case"!":case"?":{f=!1,o.refreshFailure=!0,console.debug("Cached voice persisted due to invalid drum kit.");break}}break}case"gs":case"sc":{r.ending!==" "&&(r.sid[2]===1?(r.name="Silence",r.refreshFailure=!0,console.debug("Cached voice nullified due to invalid SC-55 voice.")):(f=!1,o.refreshFailure=!0,console.debug("Cached voice persisted due to invalid GS voice.")));break}}return f?(t.#T[n]=r,t.#S[n]=r.poly??1,t.#y>1?console.debug(`Bubbling prevented at instance #${t.#y}.`):t.dispatchEvent("cachedvoice",{part:n}),t.#y--,r):(t.#y--,o)}getCachedChVoice(n){let e=this,t=e.#T[n],r=e.device?.getChPrimitives(n,!0);if(t&&e.device?.getChCvnIsWritten(n)===0)switch(t.ending){case"?":case"!":return e.refreshCachedChVoice(n,void 0);default:return st(t.sid,r)[1]!==0||t.name==="Unloaded"?e.refreshCachedChVoice(n):t}else return e.refreshCachedChVoice(n)}getChPrimitive(n,e,t){return this.device.getChPrimitive(n,e,t)}getChPrimitives(n,e){return this.device.getChPrimitives(n,e)}getMapped(n){return this.#h[n]?.name||n}getEfx(n){let[e,t]=n,r=e<<8|t;return this.#C[r]||`0x${r.toString(16).padStart(4,"0")}`}getVoxBm(n,e=this.BM_UNIVERSAL){if(!n)throw new Error("Voice object must be valid");let t=this;if(!t.voxBm)throw new Error("Voice bitmap repository isn't yet initialized");let r=t.voxBm.getBm(n.name);if(!r){switch(n.mode){case"xg":{switch(n.sid[0]){case 0:case 80:case 81:case 83:case 84:case 96:case 97:case 99:case 100:{r=t.voxBm.getBm(t.getVoice(K.bank0,n.sid[1],K.bank0,n.mode).name);break}}break}case"g2":case"sd":{switch(n.sid[0]){case 96:case 97:case 98:case 99:{r=t.voxBm.getBm(t.getVoice(K.bank0,n.sid[1],K.bank0,n.mode).name);break}case 104:case 105:case 106:case 107:{r=t.voxBm.getBm(t.getVoice(120,n.sid[1],K.bank0,n.mode).name);break}}break}case"gs":case"sc":case"k11":case"sg":case"gm":{switch(n.sid[0]){case 120:break;case 122:case 127:{r=t.voxBm.getBm(t.getVoice(120,n.sid[1],0,n.mode).name);break}default:r=t.voxBm.getBm(t.getVoice(0,n.sid[1],0,n.mode).name)}break}case"05rw":case"x5d":case"ns5r":{switch(n.sid[0]){case 56:{r=t.voxBm.getBm(t.getVoice(0,n.sid[1],0,"gm").name);break}}break}default:}switch(e){case t.BM_UNIVERSAL:break;case t.BM_YAMAHA_MU:{let o=n.standard.toLowerCase();if(o!==n.mode&&j.xg.has(o))switch(n.sid[0]>>4){case 2:{r=t.sysBm?.getBm(`ext_${o}I`);break}case 3:{n.sid[0]===48&&(r=t.sysBm?.getBm("boot_3"));break}case 6:{r=t.sysBm.getBm(`ext_${o}P`);break}default:{r=t.sysBm.getBm(`ext_${o}`);break}}else["es"].indexOf(o)>-1?r=t.sysBm.getBm("boot_3"):o==="kr"&&(r=t.sysBm.getBm("st_korg"));break}}}return r||(r=t.voxBm.getBm(t.getVoice(n.sid[0],n.sid[1],0,n.mode).name)),r}getChBm(n,e=this.BM_UNIVERSAL,t){let r=this;t=t??r.getChVoice(n);let o=r?.device.getChType(n),f;switch(e){case r.BM_UNIVERSAL:break;case r.BM_YAMAHA_MU:{let p=t.standard.toLowerCase();if(p!==t.mode&&j.xg.has(p))switch(t.sid[0]>>4){case 1:{t.sid[0]===16&&(f=r.sysBm.getBm("cat_svox"));break}case 2:{f=r.sysBm?.getBm(`ext_${p}I`);break}case 3:{t.sid[0]===48&&(f=r.sysBm?.getBm("boot_3"));break}case 6:{f=r.sysBm.getBm(`ext_${p}P`);break}default:{f=r.sysBm.getBm(`ext_${p}`);break}}else if(["es"].indexOf(p)>-1)f=r.sysBm.getBm("boot_3");else if(p==="kr")f=r.sysBm.getBm("st_korg");else if(p==="xg")switch(t.sid[0]){case 126:{t.sid[1]>>2===28&&(f=r.sysBm.getBm("cat_smpl"));break}}if(!f&&o)switch(t.ending){case"!":case"?":case"*":{f=r.sysBm.getBm(o>1&&o<6?`cat_dS${o-1}`:"cat_drS");break}default:f=r.sysBm.getBm(o>1&&o<10?`cat_dr${o-1}`:"cat_drm")}break}}if(f=f||r.getVoxBm(t,e),!f){if(!r.sysBm)return;switch(t.mode){case"xg":{switch(t.sid[0]){case 126:{t.sid[1]>>2===28&&(f=r.sysBm.getBm("cat_smpl"));break}case 16:{f=r.sysBm.getBm("cat_smpl");break}case 64:case 67:{f=r.sysBm.getBm("cat_sfx");break}case 32:case 33:case 34:case 35:case 36:case 48:case 82:{f=r.sysBm.getBm("cat_xg");break}}break}default:switch(t.sid[0]){case 63:case 32:case 33:case 34:case 35:case 36:case 48:case 82:{f=r.sysBm.getBm("cat_mex");break}}}}if(f)switch(t.ending){case"!":case"?":case"*":{f=r.sysBm.getBm(o?"cat_drS":"no_vox");break}}else o?f=r.sysBm.getBm("cat_drS"):f=r.sysBm.getBm("no_vox");return f}getChBmState(n,e=1){let t=this,r=Math.floor(t.#R*1e3)-t.getChLastNoteExhausted(n);return t.getChLastNoteExhausted(n)<=0?0:r<t.msActive?(e-=1,e<1?0:Math.floor(r/t.msFrame)%e+1):0}detachState(n){let e=this;if(e.dState){let t=e.dState;switch(n){case"mu":{e.removeEventListener("mupromptex",t.muScheduleSysEx),e.removeEventListener("mode",t.muModeFunc),delete t.muModeFunc,delete t.muModeBm,delete t.muExhaustEx,delete t.muDurationEx,delete t.muBlinkSpeedEx,delete t.muPromptEx,delete t.muScheduledEx,delete t.muUnresolvedEx,delete t.muDisableExBlink,delete t.muUseVoiceBm,delete t.muTempWindow,delete t.muBlinkSpeedMode,delete t.muBmex,delete t.muBmst,delete t.isMu;break}}return!0}else return!1}attachState(n){let e=this;e.dState=e.dState??{};let t=e.dState,r=!1;switch(n){case"mu":{t.isMu=!0,t.muBmst=0,t.muBmex=0,t.muBlinkSpeedMode=400,t.muTempWindow=new Uint8Array(256),t.muUseVoiceBm=!0,t.muDisableExBlink=!1,t.muUnresolvedEx=0,t.muScheduledEx=0,t.muPromptEx=0,t.muBlinkSpeedEx=200,t.muDurationEx=t.muBlinkSpeedEx*5,t.muExhaustEx=t.muBlinkSpeedEx<<1,t.muModeFunc=function(o){let f=e.sysBm.getBm(`st_${{gm:"gm1",g2:"gm2","?":"gm1",ns5r:"korg",ag10:"korg",x5d:"korg","05rw":"korg",krs:"korg",sg:"gm1",k11:"gm1",sd:"gm2",sc:"gs"}[o.data]||o.data}`);f&&(t.muModeBm=f.getFrame(0)),t.muBmst=2,t.muBmex=e.clockSource.now()+(t.muBlinkSpeedMode<<2)},e.addEventListener("mode",t.muModeFunc),t.muScheduleSysEx=function(o){t.muDisableExBlink?(t.muScheduledEx=0,T()&&console.debug("SysEx blinking cancelled due to disabled feature.")):(t.muScheduledEx+=o.data,T()&&console.debug(`Scheduled a SysEx prompt at ${o.data} B. Remaining ${t.muScheduledEx} B unfulfilled prompts.`))},e.device?.addEventListener("mupromptex",t.muScheduleSysEx);break}default:r=!0}return!r}muWriteBm(n,e,t){if(n?.BYTES_PER_ELEMENT!==1)throw new TypeError("Buffer must be Uint8Array.");let r=this,o=n.length>>8||1;if(!r.dState.isMu)throw new Error("Device state for MU is not yet attached.");let f=r.dState,p=r.clockSource.now(),g=r.device?.getBitmap(),b=f.muTempWindow,k=!1,C=!1;if(f.muScheduledEx>0){let a=f.muScheduledEx*85+4095>>12;p-f.muPromptEx>f.muBlinkSpeedEx?(f.muUnresolvedEx+=a*204+4095>>12,T()&&console.debug(`SysEx blinking submitted, now at ${f.muUnresolvedEx}.`)):((p-f.muPromptEx)*41>>12&1&&f.muUnresolvedEx<8&&f.muUnresolvedEx==8,f.muUnresolvedEx+=a+1>>1,T()&&console.debug(`SysEx blinking too busy, now at ${f.muUnresolvedEx}.`)),f.muScheduledEx=0}if(p<g.expire)f.muUnresolvedEx>0&&(f.muUnresolvedEx=0,T()&&console.debug("SysEx blinking cancelled by bitmap.")),g.bitmap.length<=256?(b=g.bitmap,k=!0):(n.set(g.bitmap.subarray(0,n.length)),C=!0);else if(p<f.muBmex){if(f.muBmst===2){k=!0,f.muUnresolvedEx>0&&(f.muUnresolvedEx=0,T()&&console.debug("SysEx blinking cancelled by mode set."));let a=Math.floor((f.muBmex-p)/f.muBlinkSpeedMode)&1;f.muModeBm?f.muModeBm?.forEach((s,c)=>{b[c]=a===s}):b.fill(a?0:1)}}else if(f.muUseVoiceBm){k=!0,f.muUnresolvedEx>0&&p-f.muPromptEx>=f.muExhaustEx?(f.muUnresolvedEx<16?f.muUnresolvedEx=0:f.muUnresolvedEx-=16,f.muPromptEx=p,T()&&console.debug(`SysEx blinking resolved to ${f.muUnresolvedEx}.`)):f.muUnresolvedEx<0&&(f.muUnresolvedEx=0),f.muBmst=0;let a=r.getChBm(e,r.BM_YAMAHA_MU,t),s=r.getChBmState(e,a?.frames||1);a&&b.set(a.getFrame(s));let c=p-f.muPromptEx;c<=f.muDurationEx&&(r.sysBm.getBm("sysex_m")?.getFrame(0).forEach((i,d)=>{i&&(b[d]=0)}),r.sysBm.getBm(`sysex_${Math.floor(c/f.muDurationEx*5)&1}`)?.getFrame(0).forEach((i,d)=>{i&&(b[d]=1)}))}if(k){let a=0;for(let s=0;s<b.length;s++){let c=b[s];n[a]=c?255:0,o===2&&(n[a+1]=c?255:0),a+=o}}return k||C}getProps(n){let e=this,t,r,o=0,f=n;for(;o<8&&t==null&&(!r?.constructor||r instanceof Array&&(r[1]!==n.eid[1]||r[2]!==n.eid[2]));)r=n.eid,typeof n.voice=="string"&&(e.#v.has(n.voice)?t=e.#v.get(n.voice):n=e.getVoice(r[0],r[2]===0?0:r[1],r[2]===0?0:r[2]-1));return!t&&o===8&&console.info(`Voice property fetching failed for "${n.name}" (${n.eid.join(" ")}).`),t}get noteProgress(){return this.#R/this.#n}get noteOverall(){return(this.noteProgress-this.#o)*this.#c/4}get noteBar(){return Math.floor(this.noteOverall/this.#u)}get noteBeat(){let n=this.noteOverall%this.#u;return n<0&&(n+=this.#u),n}get noteOffset(){return this.#o}getTimeSig(){return[this.#u,this.#c]}getTempo(){return this.#m}getPool(){return this.#a}getChCachedVoiceRaw(n){return this.#T[n]}getChLastNoteAt(n){return this.#e[n]}getChLastNoteExhausted(n){return this.#b[n]}eachVoice(n,e=!1){let t=this;for(let r=0;r<t.#T.length;r++)(e||t.device?.getChActive(r))&&n(t.#T[r],r,t.#T)}sendCmd(n){this.device.runJson(n)}render(n){n>this.#R&&(this.#R=n);let e=this.#a?.step(n)||[],t=0,r=0,o=new Set,f={},p=[],g=this,b=[];for(g.device.getStrength().forEach((d,l)=>{g.#i[l]=d}),g.device.newStrength(),e.forEach(function(d){let l=d.data,h=g.device.runJson(l);switch(h?.reply){case"meta":{b.push(h);break}}h?.reply&&delete h.reply});g.#P.length>0;){let d=g.#P.shift(),l=d.part<<7|d.note;d.state?(o.add(l),f[l]=d.velo):o.has(l)&&(p.push({part:d.part,note:d.note,velo:f[l],state:g.device.NOTE_SUSTAIN}),t++,r+=g.#S[d.part])}b?.length>0&&g.dispatchEvent("meta",b);let k=[],C=[],a=g.device.getStrength();a.forEach(function(d,l,h){h[l]=Math.max(g.#i[l],d);let m=h[l]-g.#d[l];if(m>=0){let u=4*.25**(g.device.getChCc(l,73)/64);g.#d[l]+=Math.ceil(m-m*g.smoothAttack**u)}else{let u=4*.25**(g.device.getChCc(l,72)/64);g.#d[l]+=Math.floor(m-m*g.smoothDecay**u)}});let s=0,c=0;return g.device?.getActive()?.forEach(function(d,l){d&&(k[l]=g.device.getVel(l),C[l]=g.device.getExt(l),s+=k[l].size,c+=k[l].size*g.#S[l])}),{extraPoly:t,extraPolyEC:r,extraNotes:p,curPoly:s,curPolyEC:c,chKeyPr:k,chExt:C,eventCount:e.length,title:g.#k,texts:g.device.getTexts(),master:g.device.getMaster(),strength:g.#d,velo:a,rpn:g.device.getRpn(),tSig:g.getTimeSig(),tempo:g.getTempo(),noteBar:g.noteBar,noteBeat:g.noteBeat,ace:g.device.getAce(),rawVelo:g.device.getStrength(),rawStrength:g.device.getRawStrength(),rawPitch:g.device.getRawPitch(),efxSink:g.device.getEffectSink()}}constructor(n,e=.5,t=.5){super();let r=this;r.smoothAttack=e,r.smoothDecay=t,r.device=n,r.addEventListener("meta",function(o){o?.data?.forEach(function(f){(r.#x[f.meta]||console.debug).call(r,f.meta,f.data)})}),A(r.device,r,"mode"),A(r.device,r,"mastervolume"),A(r.device,r,"channelactive"),A(r.device,r,"channelmin"),A(r.device,r,"channelmax"),A(r.device,r,"portrange"),A(r.device,r,"portstart"),A(r.device,r,"channelreset"),A(r.device,r,"channeltoggle"),A(r.device,r,"screen"),A(r.device,r,"metacommit"),A(r.device,r,"voice"),A(r.device,r,"pitch"),A(r.device,r,"note"),A(r.device,r,"reset"),A(r.device,r,"banklevel"),A(r.device,r,"efxreverb"),A(r.device,r,"efxchorus"),A(r.device,r,"efxdelay"),A(r.device,r,"efxinsert0"),A(r.device,r,"efxinsert1"),A(r.device,r,"efxinsert2"),A(r.device,r,"efxinsert3"),A(r.device,r,"efxinsert4"),A(r.device,r,"partefxtoggle"),A(r.device,r,"chmode"),r.addEventListener("note",function({data:o}){if(r.#P.push(o),o.state===3){let f=Math.floor(r.#R*1e3);r.#e[o.part]=f,f-r.#b[o.part]>=r.msExhaust&&(r.#b[o.part]=f)}}),r.addEventListener("voice",({data:o})=>{r.refreshCachedChVoice(o.part)}),r.addEventListener("reset",({data:o})=>{r.#S.fill(1),r.#e.fill(0),r.#b.fill(0)}),r.#S.fill(1),r.#x[3]=function(o,f){r.#k?.length<1&&(r.#k=f,r.dispatchEvent("title",r.#k))},r.#x[81]=function(o,f){let p=r.noteProgress,g=r.#n||.5;r.#m=6e7/f,r.#n=f/1e6,r.#o+=p*(g/r.#n)-p,r.dispatchEvent("tempo",r.#m)},r.#x[88]=function(o,f){let p=r.noteBar,g=r.noteBeat,b=r.#u,k=r.#c;r.#u=f[0],r.#c=1<<f[1];let C=Math.round(p+g/b);b!==r.#u&&(r.#o-=C*(r.#u-b)*(4/r.#c)),k!==r.#c&&(console.debug(`${p}/${g}`),k<r.#c?r.#o+=C*(r.#c-k)*(k/r.#c):r.#o+=C*(r.#c-k)*(r.#c/k)),r.dispatchEvent("tsig",r.getTimeSig())},r.addEventListener("metacommit",({data:o})=>{switch(o.type){case"KarTitle":case"EORTitle":{r.#k?.length<1&&(r.#k=o.data,r.dispatchEvent("title",r.#k));break}}})}};let ma=class extends EventTarget{static sleep(n){return new Promise(e=>{self.AbortSignal?AbortSignal.timeout(n).addEventListener("abort",e):setTimeout(e,n)})}#a;#h;#C=!1;get finished(){return this.#C}finish(){this.#C=!0,this.#h&&this.#h()}wait(){if(!this.#C)return this.#a}constructor(){super(),this.#a=new Promise(n=>{this.#h=()=>{this.#C=!0,n()}})}},xt=ma;let Ge=new Uint8Array(40),pe=0,Fe,Kr=setInterval(()=>{Fe&&(Ge[pe]=!Ge[pe],pe++,pe>34&&(pe=0))},1e3/50);Uint8Array.prototype.render=function(n){let e=0,t=0,r=this.width||5,o=this.height||8;for(let f=0;f<this.length;f++)n(this[f],e,t,this),e++,e>=r&&(e=0,t++)};let St=class{#a=[];loaded=new xt;async load(e,t=!1,r="(internal)"){let o=this,f=0,p=0;console.debug(`Font "${r||"(internal)"}": loading started.`),e.split(`
`).forEach(function(g,b){if(b>0&&g?.length>0){let k=g.split("	"),C=parseInt(k[0],16);if(p++,o.#a[C]&&!t)return;let a=new Uint8Array(40);Array.from(k[1]).forEach(async function(s,c){let i=c&1?4:0,d=c>>1,l=parseInt(s,16),h=3;for(;l>0||h>=0;){let m=(i+h)*5+d;a[m]=l&1,l=l>>1,h--}}),a.width=5,a.height=8,o.#a[C]=a,f++}}),o.loaded.finished||o.loaded.finish(),console.debug(`Font "${r||"(internal)"}": ${p} total, ${f} loaded.`)}async loadFile(e,t=!1){let r=this;console.debug(`Requested font file from "${e}".`),await r.load(await(await fetch(e)).text(),t,e),Fe=!1}constructor(...e){Fe=!0,(async()=>{for(let t=0;t<e.length;t++)await this.loadFile(e[t])})()}getCP(e){return this.#a[e]}getStr(e){let t=[],r=this;return Array.from(e).forEach(function(o){t.push(r.#a[o.charCodeAt(0)]||r.#a[32]||Ge)}),t}keys(){return Object.keys(this.#a)}data(e){return this.#a[e]}};let Se=16/9,$e=64,Q=new Float64Array(49),ga="Vx,Dr,D1,D2,D3,D4,D5,D6,D7,D8".split(","),ba=[1,3,6,8,10],$t=[0,.5,1,1.5,2,3,3.5,4,4.5,5,5.5,6],ya=2*Math.PI,Ea={"?":"Unset",gm:"General MIDI",g2:"General MIDI 2",xg:"Yamaha XG",gs:"Roland GS",sc:"Roland GS",mt32:"Roland MT-32",doc:"Yamaha DOC",qy10:"Yamaha QY10",qy20:"Yamaha QY20",sd:"Roland SD",x5d:"Korg X5D","05rw":"Korg 05R/W",ns5r:"Korg NS5R",k11:"Kawai K11",sg:"Akai SG",trin:"Korg Trinity",krs:"Korg KROSS 2",s90es:"Yamaha S90 ES",cs6x:"Yamaha CS6x",cs1x:"Yamaha CS1x",motif:"Yamaha Motif ES",pa:"Korg PA"},wa={"C.Lyrics":"Lyrics","C.Marker":"Marker","Cmn.Text":"Text",Copyrite:"Copyright",CuePoint:"Cue Point",EORTitle:"Real Title",Instrmnt:"Instrument","Kar.Info":"Kar. Info","Kar.Lang":"Language","Kar.Mode":"Karaoke","Kar.Ver.":"Kar. Version",KarLyric:"Kar. Lyrics",KarTitle:"Kar. Title",MidStamp:"MIDI Stamp",OSysMeta:"Octavia Sys.",SGLyrics:"SG Lyrics",TrkTitle:"Title",XfSngDte:"XF Date",XfSngRgn:"XF Region",XfSngCat:"XF Category",XfSongBt:"XF Beat",XfSngIns:"XF Instr.",XfSngVoc:"XF Vocalist",XfSngCmp:"XF Compose",XfSngLrc:"XF Lyricist",XfSngArr:"XF Arranger",XfSngPer:"XF Perform.",XfSngPrg:"XF Program.",XfSngTag:"XF Tags",XfKarLng:"XF Lang.",XfKarNme:"XF Name",XfKarCmp:"XK Compo.",XfKarLrc:"XK Lyricist",XfKarArr:"XK Arranger",XfKarPer:"XK Perform.",XfKarPrg:"XK Progr.",XfScneNo:"XF Scene #",XfMeloCh:"XF Melody",XfLyrOff:"XL Offset",XfLyrEnc:"XL Lang.",XfSngPrt:"XL Part",YMCSSect:"Section Ctrl.",YStyleId:"Active Style"},ka=["ChordCtl","MidStamp","RhrslMrk","XfSngRgn","XfSongBt","XfSngIns","XfSngVoc","XfKarLng","XfKarNme","XfMeloCh","XfLyrOff","XfLyrEnc"],Ke=[[],[4,2],[3,2]],Ca=[{l:0,t:0},{l:0,t:416},{l:960,t:0},{l:960,t:416}],Tt={none:{font4:[0,0],cfont4:[0,0],font7:[0,0]},macos:{font4:[2,0],cfont4:[1,0],font7:[0,0]},chromium:{font4:[1,0],cfont4:[0,0],font7:[1,0]}},Te={xg:["9efaa0","006415","9efaa0"],doc:["9efaa0","006415","9efaa0"],qy10:["9efaa0","006415","9efaa0"],qy20:["9efaa0","006415","9efaa0"],ns5r:["9efaa0","006415","9efaa0"],x5d:["9efaa0","006415","9efaa0"],"05rw":["9efaa0","006415","9efaa0"],trin:["9efaa0","006415","9efaa0"],k11:["9efaa0","006415","9efaa0"],s90es:["9efaa0","006415","9efaa0"],motif:["9efaa0","006415","9efaa0"],cs6x:["9efaa0","006415","9efaa0"],an1x:["9efaa0","006415","9efaa0"],cs1x:["9efaa0","006415","9efaa0"],gm:["a1f3ff","005e88","a1f3ff"],g2:["a1f3ff","005e88","a1f3ff"],pa:["a1f3ff","005e88","a1f3ff"],krs:["a1f3ff","005e88","a1f3ff"],gs:["ffe1a5","804e00","ffe1a5"],sc:["ffe1a5","804e00","ffe1a5"],mt32:["ffe1a5","804e00","ffe1a5"],sd:["ffe1a5","804e00","ffe1a5"],sg:["ffdddd","990022","ffdddd"]};Q.forEach((n,e,t)=>{t[e]=Math.PI*e/12});let S=function(n,e,t={}){let r=document.createElement(n);e?.forEach(C=>{r.classList.add(C)});let{t:o,l:f,w:p,h:g,i:b,a:k}=t;return o?.constructor&&(r.style.top=o?.length?o:`${o}px`),f?.constructor&&(r.style.left=f?.length?f:`${f}px`),p?.constructor&&(r.style.width=p?.length?p:`${p}px`),g?.constructor&&(r.style.height=g?.length?g:`${g}px`),b?.constructor&&r.appendChild(document.createTextNode(b)),k?.constructor&&(r.style.textAlign=k),r};let I=function(n,e){e?.forEach(t=>{n.appendChild(t)})},D=function(n,e){e.forEach(t=>{n.classList.contains(t)&&n.classList.remove(t)})},V=function(n,e){e.forEach(t=>{n.classList.contains(t)||n.classList.add(t)})},va=new Array(128).fill(0);va.forEach((n,e,t)=>{t[e]=Math.floor(24*e/12.7)/10});let xa=new Array(128).fill(0);xa.forEach((n,e,t)=>{t[e]=Math.abs(Math.round(48*(e-64)/12.7)/10)});let Pt=new Array(11).fill(null);Pt.forEach((n,e,t)=>{t[e]=`${Math.round(e*12/.0128)/100}%`});let Sa=new Array(128).fill(null);Sa.forEach((n,e,t)=>{t[e]=`${Math.round(e/1.27)/100}`});let Mt=function(n,e,t){n.innerText=e,n.rNew=!0;let r=n.font.substring(0,6)==="italic";t&&!r?n.font=`italic ${n.font}`:!t&&r&&(n.font=n.font.substring(7));let o=n.measureText(e);n.rWidth=o.width};HTMLElement.prototype.setTextRaw=function(n){let e;this.childNodes[0]?.nodeType===3?(e=this.childNodes[0],e.data=n):(e=document.createTextNode(n),this.prepend(e))};if(typeof self?.require<"u")throw new Error("Environments supporting CommonJS is not supported.");let Jr=class extends vt{#a=16;#h=32;#C=128;#v=!1;#k="";#x;#P=0;#d=0;#i=0;#e=0;#b=0;#n;#m=0;#u=!1;#c=y.invalidCh;#o=1;#R=0;#T=0;#S=0;#y=new Uint8Array(1280);#s=new Uint8Array(1280);#f=new Uint8Array(1280);#J=new Uint8Array(512);#D=new Uint8Array(512);#B=new Uint8Array(512);#O=new Uint8Array(y.ch);#K;#Z;#g;#E;#Y;#N="fcdaff";#X=new Array(y.ch);#H=new Array(y.ch);#$="ffffff";#_="?";#t={};#L={};#l=[];#r={};#A={};eventViewMode=0;useElementCount=!0;#te=[];#p="comb";glyphs=new St;panStyle=11;pixelMin=12;pixelMax=255;#j(n,e,t,r=0,o=0,f){let p=this,{width:g,height:b}=n.canvas,k,C,a,s,c=p.#o,i=0,d=ba.indexOf(e%12)>-1;switch(r){case p.device.NOTE_HELD:case p.device.NOTE_SOSTENUTO_SUSTAIN:case p.device.NOTE_SOSTENUTO_HELD:{i=1;break}case p.device.NOTE_MUTED_RECOVERABLE:{i=2;break}}switch(p.#p){case"block":case"comb":{k=Math.round(e*g/128),C=Math.round((e+1)*g/128),a=C-k,s=c===1?2:1;break}case"piano":{k=Math.round((Math.floor(e/12)*7+$t[e%12])*g/75*1.0044642857142856),C=Math.round((Math.floor(e/12)*7+$t[e%12]+1)*g/75*1.0044642857142856)-1,a=C-k,s=c===1?3:1;break}case"line":{let l=e-o;Math.abs(o)>2&&(l=e-Math.sign(o)*2),C=Math.round((e+.5)*g/128),k=Math.round((l+.5)*g/128)}default:}switch(n.fillStyle=`#${d?p.getChAccent(f):p.#$}${(t<<1|t>>6).toString(16).padStart(2,"0")}`,n.strokeStyle=n.fillStyle,n.lineWidth=c===1?4:2,n.lineDashOffset=0,p.#p){case"block":{let l=n.canvas.height-1;n.fillRect(k,0,a,l),i>0&&n.clearRect(k+s,s,a-(s<<1),l-(s<<1)),i===2&&n.clearRect(k,s<<1,a,l-(s<<2));break}case"comb":{let l=(d?Math.round((n.canvas.height<<1)/3):n.canvas.height)-1;n.fillRect(k,0,a,l),i>0&&n.clearRect(k+s,s,a-(s<<1),l-(s<<1)),i===2&&n.clearRect(k,s<<1,a,l-(s<<2));break}case"piano":{let l=d?0:n.canvas.height>>1,h=(n.canvas.height>>1)-1;n.fillRect(k,l,a,h),i>0&&n.clearRect(k+s,l+s,a-(s<<1),h-(s<<1)),i===2&&n.clearRect(k,l+(s<<1),a,h-(s<<2));break}case"line":{if(i===1)switch(c){case 4:{n.setLineDash(Ke[2]);break}default:n.setLineDash(Ke[1])}else n.setLineDash(Ke[0]),c!==4&&self?.document?.mozFullScreen&&(k+=.5,C+=.5);n.beginPath(),n.moveTo(k,(c===4||!i)&&self?.document?.mozFullScreen?1:0),n.lineTo(C,(b>>1)+1),n.lineTo(k,b),n.stroke();break}default:}}#ae(n,e){let t=this;(t.device?.getActive()||e).forEach((r,o)=>{if(r){let f=t.#l[o>>4][o&15].cxt;f.clearRect(0,0,f.canvas.width,f.canvas.height),n.chKeyPr[o].forEach(({v:p,s:g},b)=>{t.#j(f,b,p,g,t.device.getPitchShift(o),o)})}})}#ue(n){let e=this;e.clockSource.now()-e.#P>4e3&&(e.#d=0,e.#i=142-e.#r.view.clientHeight,(e.#x?.clientWidth||0)>840&&(e.#d=840-e.#x.clientWidth),e.#r.view.style.transform=`translateX(${e.#d}px) translateY(${e.#i}px)`,n&&(e.#P=0))}#ge(){let n=self.innerWidth/self.innerHeight,e=1,t=self.innerWidth,r=self.innerHeight;n>=Se?(e=Math.min(Math.round(self.innerHeight/1080*1e4)/1e4,100),t=Math.ceil(self.innerHeight*Se)):n<Se&&(e=Math.min(Math.round(self.innerWidth/1920*1e4)/1e4,100),r=Math.ceil(self.innerWidth/Se)),this.#g.style.width=`${t}px`,this.#g.style.height=`${r}px`,this.#E.style.transform=`scale(${e})`}#ie;#be(){let n=this,e=n.#K?.currentTime||0,t=n.render(e),r=n.clockSource.now(),o=t.curPoly+t.extraPoly,f=t.curPolyEC+t.extraPolyEC;n.#e<o&&(n.#e=o),n.#b<f&&(n.#b=f),n.#t.curPoly.setTextRaw(`${n.useElementCount?f:o}`.padStart(3,"0")),n.#t.maxPoly.setTextRaw(`${n.useElementCount?n.#b:n.#e}`.padStart(3,"0")),n.#K?.realtime?(n.#t.barCount.setTextRaw("LINE"),n.#t.barDelim.style.display="none",n.#t.barNote.setTextRaw("IN")):(n.#t.barCount.setTextRaw(t.noteBar+1),n.#t.barDelim.style.display="",n.#t.barNote.setTextRaw(Math.floor(t.noteBeat)+1));let p=[7,11,1,91,93,94,74,5,256,256],g=n.#R+n.#o;for(let c=0;c<y.ch;c++){let i=c>>4,d=c*y.ace,l=n.#l[i][c&15];if(n.device.getActive()[c]&&i>=n.#R&&i<g){p[8]=t.ace[d+0]||256,p[9]=t.ace[d+1]||256,l.ccVis.clearRect(0,0,109,25),l.ccVis.fillStyle=`#${n.getChAccent(c)}`,l.ccVis.strokeStyle=`#${n.getChAccent(c)}`,l.ccVis.lineWidth=2;for(let m=0;m<p.length;m++){let u=p[m];if(u<256){let E=n.device?.getChCc(c,u),w=E*24/127;if(w>0){let $=24-w;l.ccVis.fillRect(m*6,$,4,w)}}}let h=n.device?.getChCc(c,10)||1;switch(n.panStyle){case 7:case 6:case 5:case 3:case 2:case 1:{let m=(h+125)*.024933275,u=(h-64)*.024933275;l.ccVis.beginPath(),h>127?n.panStyle>>1&1&&(l.ccVis.arc(84.5,22.5,21.5,0,Q[12],!0),l.ccVis.stroke()):(n.panStyle>>1&1&&(h<64?(l.ccVis.arc(84.5,22.5,21.5,Q[18],m,!0),l.ccVis.stroke()):h>64&&(l.ccVis.arc(84.5,22.5,21.5,Q[18],m),l.ccVis.stroke())),n.panStyle&1&&(l.ccVis.strokeStyle=`#${n.#$}`,l.ccVis.lineWidth=n.panStyle>>2?1:3,l.ccVis.beginPath(),l.ccVis.moveTo(84.5,22.5),h===64?l.ccVis.lineTo(84.5,4):l.ccVis.lineTo(84.5+18*Math.sin(u),22.5-18.5*Math.cos(u)),l.ccVis.stroke())),n.panStyle>>2&1&&(l.ccVis.fillStyle=`#${n.#$}`,l.ccVis.beginPath(),l.ccVis.arc(84.5,22.5,2.5,0,Q[4]),l.ccVis.fill());break}case 11:case 10:case 9:{let m=(h+77)*.033244367,u=(h-64)*.033244367;l.ccVis.beginPath(),h>127?n.panStyle>>1&1&&(l.ccVis.arc(84.5,16.5,15.5,Q[26],Q[34],!0),l.ccVis.stroke()):(n.panStyle>>1&1&&(h<64?(l.ccVis.arc(84.5,16.5,15.5,Q[18],m,!0),l.ccVis.stroke()):h>64&&(l.ccVis.arc(84.5,16.5,15.5,Q[18],m),l.ccVis.stroke())),n.panStyle&1&&(l.ccVis.strokeStyle=`#${n.#$}`,l.ccVis.lineWidth=3,l.ccVis.beginPath(),l.ccVis.moveTo(84.5,16.5),h===64?l.ccVis.lineTo(84.5,4):l.ccVis.lineTo(84.5+11.5*Math.sin(u),16.5-11.5*Math.cos(u)),l.ccVis.stroke())),(!(n.panStyle&1)||h>>7)&&(l.ccVis.fillStyle=`#${n.#$}`,l.ccVis.beginPath(),l.ccVis.arc(84.5,16.5,2.5,0,Q[24]),l.ccVis.fill());break}default:{let m=Math.abs(h-64)/2.625;h<64?l.ccVis.fillRect(84-m,0,m,24):h>127?(l.ccVis.fillRect(60,0,49,24),l.ccVis.clearRect(61,1,47,22)):l.ccVis.fillRect(85,0,m,24),l.ccVis.fillStyle=`#${n.#$}`,l.ccVis.fillRect(84,0,1,24)}}if(l.metre.clearRect(0,0,121,25),l.metre.fillStyle=`#${n.#$}`,l.metre.globalCompositeOperation="source-over",l.metre.rWidth>l.metre.canvas.width){l.metre.rNew&&(l.metre.rNew=!1,l.metre.rOffset=e);let m=e-(l.metre.rOffset||0),u=32,E=l.metre.rWidth-l.metre.canvas.width+u,w=m*-25%(l.metre.rWidth+u+48)+48;w>0&&(w=0),l.metre.fillText(l.metre.innerText,w,3+n.#Y.cfont4[0]),Math.abs(w)>E&&l.metre.fillText(l.metre.innerText,w+l.metre.rWidth+u,3+n.#Y.cfont4[0])}else l.metre.fillText(l.metre.innerText,0,3+n.#Y.cfont4[0]);switch(l.metre.globalCompositeOperation="xor",l.metre.fillRect(0,0,t.strength[c]*121/255,25),l.extVis.clearRect(0,0,47,25),l.extVis.fillStyle=`#${n.#$}`,t.chExt[c][0]){case n.device.EXT_VL:{let m=(n.device?.getChCc(c,136)-64)/64||t.rawPitch[c]/8192;m=m*-4+4;let u=+(t.rawVelo[c]>0||n.device?.getChCc(c,1)>0)*(n.device?.getChCc(c,129)*n.device?.getChCc(c,11)/16129);!u&&t.rawStrength[c]&&(u=t.rawStrength[c]*n.device?.getChCc(c,11)/16129),u*=32;let E=n.device?.getChCc(c,1)/127*8;l.extVis.beginPath(),l.extVis.moveTo(0,12-m-3),l.extVis.lineTo(7+u,12),l.extVis.lineTo(0,12+m+3),l.extVis.fill(),l.extVis.fillStyle=`#${n.getChAccent(c)}`,l.extVis.beginPath(),l.extVis.ellipse(43,12,4,4+E,0,0,ya),l.extVis.fill();break}case n.device.EXT_DX:{for(let m=0;m<16;m++){let u=m+142,E=n.device?.getChCc(c,u);m>=8&&(l.extVis.fillStyle=`#${n.getChAccent(c)}`);let w=m*3,$=(E-64)/5.82;$>=0?l.extVis.fillRect(w,12-$,2,$+1):l.extVis.fillRect(w,12,2,1-$)}break}}}}let b=new Array(y.ch);if(n.#l.forEach((c,i)=>{c.forEach((d,l)=>{d.refresh&&(d.refresh=!1,b[i<<7|l]=!0)})}),["line"].indexOf(n.#p)>-1)for(;n.#te.length>0;){let c=n.#te.shift();b[c.part]=!0}n.#ae(t,b),t.extraNotes.forEach(c=>{let{part:i,note:d,velo:l,state:h}=c,m=n.#l[i>>4][i&15].cxt;n.#j(m,d,l,h,n.device.getPitchShift(i),i)});let k=n.device?.getBitmap(),C=n.#A.cxt;r>k.expire?n.#B.fill(0):k.bitmap.length>256?k.bitmap.forEach((c,i)=>{n.#B[i]=c?n.pixelMax:n.pixelMin}):k.bitmap.forEach((c,i)=>{n.#B[i<<1]=c?n.pixelMax:n.pixelMin,n.#B[i<<1|1]=c?n.pixelMax:n.pixelMin}),n.#f.fill(0);let a=n.device?.getLetter();if(r<=a.expire&&n.glyphs.getStr(a.text.padEnd(32," ")).forEach((c,i)=>{let d=(i&15)*5,l=i>>4<<3;c.forEach((h,m)=>{let u=d+m%5,E=l+Math.floor(m/5);n.#f[E*80+u]=h?n.pixelMax:n.pixelMin})}),n.#J.forEach((c,i,d)=>{let l=n.#B[i];l>c?d[i]+=Math.min(l-c,$e):l<c&&(d[i]-=Math.min(c-l,$e))}),n.#y.forEach((c,i,d)=>{let l=n.#f[i];l>c?d[i]+=Math.min(l-c,$e):l<c&&(d[i]-=Math.min(c-l,$e))}),n.#J.forEach((c,i)=>{let d=i>>5,l=i&31;n.#D[i]!==c?(C.clearRect(252+(l<<2),d<<2,3,3),c&&(C.fillStyle=`#${n.#$}${c.toString(16).padStart(2,"0")}`,C.fillRect(252+(l<<2),d<<2,3,3))):T()&&(C.clearRect(252+(l<<2),d<<2,3,3),c&&(C.fillStyle=`#ff0000${c.toString(16).padStart(2,"0")}`,C.fillRect(252+(l<<2),d<<2,3,3)))}),n.#y.forEach((c,i)=>{let d=Math.floor(i/80),l=i%80;l+=Math.floor(l/5),n.#s[i]!==c?(C.clearRect(l<<2,(d|16)<<2,3,3),c&&(C.fillStyle=`#${n.#$}${c.toString(16).padStart(2,"0")}`,C.fillRect(l<<2,(d|16)<<2,3,3))):T()&&(C.clearRect(l<<2,(d|16)<<2,3,3),c&&(C.fillStyle=`#ff0000${c.toString(16).padStart(2,"0")}`,C.fillRect(l<<2,(d|16)<<2,3,3)))}),n.#D.forEach((c,i,d)=>{d[i]=n.#J[i]}),n.#s.forEach((c,i,d)=>{d[i]=n.#y[i]}),T()){C.clearRect(0,0,251,63);for(let c=0;c<=n.device.polyIndexLast;c++){let i=c&31,d=c>>5;if(c+1===n.device.polyIndexLatest)C.fillStyle="#ff0";else switch(n.device.getPolyState(c)){case n.device.NOTE_SUSTAIN:{C.fillStyle="#0f0";break}case n.device.NOTE_HELD:case n.device.NOTE_SOSTENUTO_HELD:{C.fillStyle="#0f7";break}case n.device.NOTE_SOSTENUTO_SUSTAIN:{C.fillStyle="#70f";break}case n.device.NOTE_MUTED_RECOVERABLE:{C.fillStyle="#f70";break}default:C.fillStyle="#f00"}C.fillRect(i<<2,d<<2,3,3)}}let s=(self.performance||self.Date).now();switch(n.eventViewMode){case 0:{n.#t.events.setTextRaw(`${t.eventCount}`.padStart(3,"0"));break}case 1:{let c=1e3/(s-n.#T);c>99?(c=Math.round(c),n.#t.events.setTextRaw(`${c}`)):c>9?(c=Math.round(c*10)/10,n.#t.events.setTextRaw(`${Math.floor(c)}.${Math.floor(c*10%10)}`)):(c=Math.round(c*100)/100,n.#t.events.setTextRaw(`${Math.floor(c)}.${Math.floor(c*100%100)}`));break}case 2:{n.#t.events.setTextRaw(`${n.device.polyIndexLatest}`.padStart(3,"0"));break}default:n.#t.events.setTextRaw("???")}n.#T=s}#q;#G;get style(){return this.#p}set style(n){let e=this;e.#p=n,e.#ae(e.render(e.#K?.currentTime||0)),D(e.#E,["cambiare-style-block","cambiare-style-comb","cambiare-style-piano","cambiare-style-line"]),V(e.#E,[`cambiare-style-${n}`])}getChMode(n=0,e){if(n>=y.ch)throw new RangeError("Invalid part number");let t=this;return e?t.#H[n]:t.#H[n]??t.#_}getChAccent(n=0){if(n>=y.ch)throw new RangeError("Invalid part number");let e=this;return e.#X[n]??e.#N}setClockSource(n){this.#K=n}setPixelProfile(n){let e=this;if(Tt[n]){let t=Tt[n];e.#Y=t,e.#E&&(e.#E.style.setProperty("--pcp-font4",`translate(${t.font4[1]}px, ${t.font4[0]}px)`),e.#E.style.setProperty("--pcp-font7",`translate(${t.font7[1]}px, ${t.font7[0]}px)`))}else throw new Error(`"${n}" is not a valid pixel correction profile`)}setMode(n){let e=this;e.#_=n,e.#N=(Te[n]||["fcdaff","742b81","fcdaff"])[e.#S];for(let t of e.#E.classList)t.substring(0,14)==="cambiare-mode-"&&e.#E.classList.remove(t);n!=="?"&&e.#E.classList.add(`cambiare-mode-${n}`)}setChMode(n,e){let t=this;t.#H[n]=e;let r=t.#l[n>>4][n&15];for(let o of r.root.classList)o.substring(0,10)==="part-mode-"&&r.root.classList.remove(o);e!=="?"&&r.root.classList.add(`part-mode-${e}`)}setScheme(n=0){let e=this;e.#S=n>=0&&n<3?n:0,e.#$=["ffffff","000000","ffffff"][e.#S],D(e.#E,["cambiare-scheme-light","cambiare-scheme-luma"]),e.#S&&V(e.#E,[[null,"cambiare-scheme-light","cambiare-scheme-luma"][e.#S]]),e.#N=(Te[e.#_]||["fcdaff","742b81","fcdaff"])[e.#S];for(let t=0;t<y.ch;t++)if(e.device.getChActive(t)!==0&&e.#X[t]){let r=Te[e.#H[t]];r&&(e.#X[t]=r[e.#S])}}#re(n){let e=this,t=e.#o,r=e.#R;e.#l.forEach((o,f)=>{if(f>=r&&f<r+t){V(o.root,["port-active"]);let p=f-r,{l:g,t:b}=Ca[p*(4/t)];o.root.style.top=`${b}px`,o.root.style.left=`${g}px`,o.forEach((k,C)=>{k.root.style.top=`${C*(t>2?26:52)}px`})}else D(o.root,["port-active"]),o.root.style.top="",o.root.style.left="",o.forEach((p,g)=>{p.root.style.top=""});n&&o.forEach((p,g)=>{p.cxt.canvas.width=e.#o===1?1193:495,p.cxt.canvas.height=e.#o===4?26:52})})}setPort(n){let e=this;D(e.#E,["cambiare-start0","cambiare-start1","cambiare-start2","cambiare-start3","cambiare-start4","cambiare-start5","cambiare-start6","cambiare-start7"]),V(e.#E,[`cambiare-start${n}`]),e.#R=n,e.#re(!1)}setRange(n){let e=this;D(e.#E,["cambiare-port1","cambiare-port2","cambiare-port4","cambiare-compact"]),V(e.#E,[`cambiare-${n}`]),e.#o=parseInt(n.slice(4))||1,e.#re(!0)}setFrameTime(n=20){let e=this;e.#G?.constructor&&clearInterval(e.#G),n<5?n=5:n>500&&(n=500),e.#G=setInterval(e.#q,n),e.smoothingAtk=Math.pow(.1,n/20),e.smoothingDcy=Math.pow(.75,n/20)}attach(n){let e=this;e.#Z=n;let t=S("div",["cambiare-container"]);n.appendChild(t),e.#g=t;let r=S("div",["cambiare-canvas","cambiare-port1","cambiare-start0","cambiare-style-comb"]);t.appendChild(r),e.#E=r,self.addEventListener("resize",e.#ie),e.#ie(),e.setFrameTime(20),e.#t.root=S("div",["sect-info"]),e.#t.events=S("span",["field","pcp-font4"],{t:1,l:0,w:35,h:33}),e.#t.curPoly=S("span",["field","pcp-font4"],{t:1,l:52,w:35,h:33}),e.#t.maxPoly=S("span",["field","pcp-font4"],{t:1,l:98,w:35,h:33}),e.#t.sigN=S("span",["field","pcp-font4"],{t:1,l:194,w:23,h:33,a:"right"}),e.#t.sigD=S("span",["field","pcp-font4"],{t:1,l:232,w:23,h:33}),e.#t.barCount=S("span",["field","pcp-font4"],{t:1,l:304,w:35,h:33,a:"right"}),e.#t.barDelim=S("span",["field","field-label","pcp-font4"],{t:0,l:343,w:8,h:33,i:"/"}),e.#t.barNote=S("span",["field","pcp-font4"],{t:1,l:354,w:23,h:33}),e.#t.tempo=S("span",["field","pcp-font4"],{t:1,l:454,w:64,h:33,a:"right"}),e.#t.volume=S("span",["field","pcp-font4"],{t:1,l:562,w:63,h:33,a:"right"}),e.#t.mode=S("span",["field","pcp-font4"],{t:1,l:708,w:152,h:33}),e.#t.reverb=S("span",["field","pcp-font4"],{t:1,l:1e3,w:190,h:33}),e.#t.chorus=S("span",["field","pcp-font4"],{t:1,l:1235,w:190,h:33}),e.#t.delay=S("span",["field","pcp-font4"],{t:1,l:1471,w:190,h:33}),e.#t.insert=S("span",["field","pcp-font4"],{t:1,l:1706,w:190,h:33}),e.#t.title=S("span",["field","pcp-font4"],{t:35,l:50,w:810,h:33}),e.#t.insert1=S("span",["field","pcp-font4"],{t:0,l:40,w:190,h:33}),e.#t.insert2=S("span",["field","pcp-font4"],{t:0,l:40,w:190,h:33}),e.#t.insert3=S("span",["field","pcp-font4"],{t:0,l:40,w:190,h:33}),e.#t.insert4=S("span",["field","pcp-font4"],{t:0,l:40,w:190,h:33}),e.#t.inscon1=S("span",["field","field-collapsive"],{t:35,l:960,w:230,h:33}),e.#t.inscon2=S("span",["field","field-collapsive"],{t:35,l:1195,w:230,h:33}),e.#t.inscon3=S("span",["field","field-collapsive"],{t:35,l:1431,w:230,h:33}),e.#t.inscon4=S("span",["field","field-collapsive"],{t:35,l:1666,w:230,h:33}),I(e.#t.inscon1,[S("span",["field","field-key","pcp-font7"],{t:0,l:0,w:36,h:33,i:"In2",a:"right"}),e.#t.insert1]),I(e.#t.inscon2,[S("span",["field","field-key","pcp-font7"],{t:0,l:0,w:36,h:33,i:"In3",a:"right"}),e.#t.insert2]),I(e.#t.inscon3,[S("span",["field","field-key","pcp-font7"],{t:0,l:0,w:36,h:33,i:"In4",a:"right"}),e.#t.insert3]),I(e.#t.inscon4,[S("span",["field","field-key","pcp-font7"],{t:0,l:0,w:36,h:33,i:"In5",a:"right"}),e.#t.insert4]),r.appendChild(e.#t.root),I(e.#t.root,[e.#t.events,e.#t.curPoly,S("span",["field","field-label","pcp-font4"],{t:1,l:89,w:5,h:33,i:":"}),e.#t.maxPoly,S("span",["field","field-key","pcp-font7"],{t:1,l:148,w:41,h:33,i:"TSig"}),e.#t.sigN,S("span",["field","field-label","pcp-font4"],{t:0,l:221,w:8,h:33,i:"/"}),e.#t.sigD,S("span",["field","field-key","pcp-font7"],{t:1,l:268,w:30,h:33,i:"Bar"}),e.#t.barCount,e.#t.barDelim,e.#t.barNote,S("span",["field","field-key","pcp-font7"],{t:1,l:390,w:61,h:33,i:"Tempo",a:"right"}),e.#t.tempo,S("span",["field","field-key","pcp-font7"],{t:1,l:528,w:29,h:33,i:"Vol"}),e.#t.volume,S("span",["field","field-label","pcp-font4"],{t:1,l:626,w:17,h:33,i:"%"}),S("span",["field","field-key","pcp-font7"],{t:1,l:652,w:52,h:33,i:"Mode"}),e.#t.mode,S("span",["field","field-key","pcp-font7"],{t:1,l:960,w:36,h:33,i:"Rev",a:"right"}),e.#t.reverb,S("span",["field","field-key","pcp-font7"],{t:1,l:1195,w:36,h:33,i:"Cho",a:"right"}),e.#t.chorus,S("span",["field","field-key","pcp-font7"],{t:1,l:1431,w:36,h:33,i:"Var",a:"right"}),e.#t.delay,S("span",["field","field-key","pcp-font7"],{t:1,l:1666,w:36,h:33,i:"In1",a:"right"}),e.#t.insert,e.#t.inscon1,e.#t.inscon2,e.#t.inscon3,e.#t.inscon4,S("span",["field","field-key","pcp-font7"],{t:35,l:0,w:44,h:33,i:"Title"}),e.#t.title]),e.#L.root=S("div",["sect-mark"]),e.#L.left=S("div",["sect-mark-left","boundary"],{t:0,l:0}),e.#L.right=S("div",["sect-mark-right","boundary"],{t:0,l:960}),r.appendChild(e.#L.root),I(e.#L.root,[e.#L.left,e.#L.right]),I(e.#L.left,[S("span",["field","field-key"],{t:0,l:0,w:26,h:33,i:"CH"}),S("span",["field","field-key"],{t:0,l:30,w:49,h:33,i:"Voice"}),S("span",["field","field-key","mark-send-title"],{t:2,l:164,w:25,h:18,i:"Send"}),S("span",["field","field-label","mark-send-param"],{t:16,l:146,w:58,h:16,i:"VEMRCDBP12",a:"center"}),S("span",["field","field-key"],{t:0,l:212,w:35,h:33,i:"Pan"}),S("span",["field","field-key"],{t:0,l:256,w:45,h:33,i:"Note"})]),I(e.#L.right,[S("span",["field","field-key"],{t:0,l:0,w:26,h:33,i:"CH"}),S("span",["field","field-key"],{t:0,l:30,w:49,h:33,i:"Voice"}),S("span",["field","field-key","mark-send-title"],{t:2,l:164,w:25,h:18,i:"Send"}),S("span",["field","field-label","mark-send-param"],{t:16,l:146,w:58,h:16,i:"VEMRCDBP12",a:"center"}),S("span",["field","field-key"],{t:0,l:212,w:35,h:33,i:"Pan"}),S("span",["field","field-key"],{t:0,l:256,w:45,h:33,i:"Note"})]),e.#l.root=S("div",["sect-part"]);for(let o=0;o<y.ch>>4;o++){let f=o<<4;e.#l[o]=[],e.#l[o].root=S("div",["boundary",`part-port-${o}`]);for(let p=0;p<16;p++){let g=(f|p)+1;g>=100?g=`${Math.floor(g/10).toString(16)}${g%10}`:g=`${g}`.padStart(2,"0"),e.#l[o][p]={root:S("div",["boundary","part-channel"]),major:S("div",["boundary","part-info-major"]),minor:S("div",["boundary","part-info-minor"],{t:26}),keys:S("div",["boundary","part-keys"]),notes:S("div",["boundary","part-keyboard"]),cxt:S("canvas",["field"]).getContext("2d"),number:S("span",["field","field-label","pcp-font4"],{t:1,w:18,h:25,i:g}),voice:S("span",["field"],{l:22,t:1,w:121,h:25}),metre:S("canvas",["field"]).getContext("2d"),type:S("span",["field","field-label","pcp-font4"],{t:1,w:18,h:25}),std:S("span",["field","pcp-font4"],{l:22,t:1,w:20,h:25,a:"center"}),msb:S("span",["field","pcp-font4"],{l:48,t:1,w:27,h:25}),prg:S("span",["field","pcp-font4"],{l:81,t:1,w:27,h:25}),lsb:S("span",["field","pcp-font4"],{l:114,t:1,w:27,h:25}),ccVis:S("canvas",["field"],{l:145,t:1}).getContext("2d"),extVis:S("canvas",["field"],{l:207,t:1}).getContext("2d"),ccUpdate:!1};let b=e.#l[o][p];Pt.forEach(k=>{b.notes.appendChild(S("span",["field","part-csplit"],{l:k}))}),b.notes.appendChild(S("span",["field","part-csplit","part-cdive"],{l:0,w:"100%",h:1})),b.metre.canvas.width=121,b.metre.canvas.height=25,b.metre.textBaseline="top",b.metre.font="20px 'PT Sans Narrow'",b.ccVis.canvas.width=109,b.ccVis.canvas.height=25,b.ccVis.fillStyle=`#${e.#$}`,b.extVis.canvas.width=47,b.extVis.canvas.height=25,b.extVis.fillStyle=`#${e.#$}`,I(b.notes,[b.cxt.canvas]),I(b.keys,[b.notes]),I(b.voice,[b.metre.canvas]),I(b.major,[b.number,b.voice,b.ccVis.canvas]),I(b.minor,[b.type,b.std,b.msb,b.prg,b.lsb,b.extVis.canvas]),I(b.root,[b.major,b.minor,b.keys]),I(e.#l[o].root,[b.root]),b.number.addEventListener("contextmenu",k=>{k.preventDefault(),k.stopImmediatePropagation();let C=o<<4|p;e.#O[C]=+!e.#O[C],[D,V][e.#O[C]](b.root,["part-hidden"])})}e.#l.root.appendChild(e.#l[o].root)}r.appendChild(e.#l.root),e.#r.root=S("div",["sect-meta"]),e.#r.view=S("div",["boundary"]),r.appendChild(e.#r.root),I(e.#r.root,[e.#r.view]),e.#A.root=S("div",["sect-pix","boundary"],{l:1529,t:950,w:379,h:127}),e.#A.cxt=S("canvas",["field"]).getContext("2d"),e.#A.fps=S("span",["field","field-key"],{l:0,w:"100%",h:1}),e.#A.cxt.canvas.width=379,e.#A.cxt.canvas.height=127,I(e.#A.root,[e.#A.cxt.canvas]),r.appendChild(e.#A.root),e.addEventListener("mode",o=>{e.#t.mode.setTextRaw(`${Ea[o.data]}`),e.setMode(o.data)}),e.addEventListener("mastervolume",o=>{let f=Math.round(o.data*100)/100;e.#t.volume.setTextRaw(`${Math.floor(f)}.${`${Math.floor(f%1*100)}`.padStart(2,"0")}`)}),e.addEventListener("tempo",o=>{let f=Math.round(o.data*100);e.#t.tempo.setTextRaw(`${Math.floor(f/100)}.${`${Math.floor(f%100)}`.padStart(2,"0")}`)}),e.addEventListener("tsig",o=>{[e.#t.sigN.innerText,e.#t.sigD.innerText]=o.data}),e.addEventListener("title",o=>{e.#t.title.setTextRaw(o.data||"No Title")}),e.addEventListener("voice",({data:o})=>{let f=e.getCachedChVoice(o.part,!0),p=e.getChPrimitives(o.part,!0),g=e.#l[o.part>>4][o.part&15];Mt(g.metre,e.getMapped(f.name),f.refreshFailure||f.ending!==" "),g.type.setTextRaw(ga[e.device.getChType(o.part)]),g.std.setTextRaw(f.standard),g.msb.setTextRaw(`${p[0]}`.padStart(3,"0")),g.prg.setTextRaw(`${p[1]}`.padStart(3,"0")),g.lsb.setTextRaw(`${p[2]}`.padStart(3,"0"))}),e.addEventListener("pitch",o=>{let{part:f,pitch:p}=o.data;e.#l[f>>4][f&15].notes.style.transform=`translateX(${p/1.28}%)`}),e.addEventListener("efxreverb",o=>{if(!o.data?.id)debugger;e.#t.reverb.setTextRaw(e.getEfx(o.data.id))}),e.addEventListener("efxchorus",o=>{if(!o.data?.id)debugger;e.#t.chorus.setTextRaw(e.getEfx(o.data.id))}),e.addEventListener("efxdelay",o=>{if(!o.data?.id)debugger;e.#t.delay.setTextRaw(e.getEfx(o.data.id))}),e.addEventListener("efxinsert0",o=>{if(!o.data?.id)debugger;e.#t.insert.setTextRaw(e.getEfx(o.data.id))}),e.addEventListener("efxinsert1",o=>{if(!o.data?.id)debugger;e.#t.insert1.setTextRaw(e.getEfx(o.data.id)),o.data?.hidden?D(e.#t.inscon1,["field-active"]):V(e.#t.inscon1,["field-active"])}),e.addEventListener("efxinsert2",o=>{if(!o.data?.id)debugger;e.#t.insert2.setTextRaw(e.getEfx(o.data.id)),o.data?.hidden?D(e.#t.inscon2,["field-active"]):V(e.#t.inscon2,["field-active"])}),e.addEventListener("efxinsert3",o=>{if(!o.data?.id)debugger;e.#t.insert3.setTextRaw(e.getEfx(o.data.id)),o.data?.hidden?D(e.#t.inscon3,["field-active"]):V(e.#t.inscon3,["field-active"])}),e.addEventListener("efxinsert4",o=>{if(!o.data?.id)debugger;e.#t.insert4.setTextRaw(e.getEfx(o.data.id)),o.data?.hidden?D(e.#t.inscon4,["field-active"]):V(e.#t.inscon4,["field-active"])}),e.addEventListener("partefxtoggle",o=>{let{part:f,active:p}=o.data;if(f>=y.ch)throw new Error("HORNI");[D,V][p?1:0](e.#l[f>>4][f&15].number,["part-efx"])}),e.addEventListener("channeltoggle",o=>{let{part:f,active:p}=o.data;[D,V][p?1:0](e.#l[f>>4][f&15].root,["part-active"])}),e.addEventListener("channelactive",o=>{if(e.#c<y.ch){let p=e.#l[e.#c>>4][e.#c&15].number;D(p,["part-focus"])}let f=o.data;if(f<y.ch){let p=e.#l[f>>4][f&15].number;V(p,["part-focus"]),e.#c=f}}),e.addEventListener("metacommit",o=>{let f=o.data,p=!1;if(e.#v&&f.type===e.#k&&e.#x){switch(f.type){case"C.Lyrics":case"KarLyric":case"SGLyrics":{I(e.#x,[S("span",["meta-slice"],{i:f.data})]);break}default:e.#x.childNodes[0].data+=f.data}p=!0}else if((f.data?.length||typeof f.data=="object")&&ka.indexOf(f.type)===-1){let g=S("div",["meta-line"]),b=S("span",["field","field-key","meta-type"],{i:wa[f.type]||f.type});switch(f.mask&&(b.style.display="none"),f.type){case"C.Lyrics":case"KarLyric":case"SGLyrics":{e.#x=S("span",["field","meta-data"]),I(e.#x,[S("span",["meta-slice"],{i:f.data})]);break}case"OSysMeta":{let k=f?.data,C;switch(f?.msg){case"part.rename":{let a=e.device?.getVoice(...e.getCachedChVoice(k.part).sid,e.device?.getChMode(0)).name;C=`CH${k.part+1} was renamed from "${e.getMapped(a)}" (${a}) to "${visualizer.device?.getChCvnString(0)}".`;break}default:console.debug(`Unhandled Octavia system meta event "${f.msg}":
%o`,f.data)}e.#x=S("span",["field","meta-data"],{i:C??`${f.data?.msg}`});break}default:e.#x=S("span",["field","meta-data"],{i:f.data})}for(e.#r.view.appendChild(g),I(g,[b,e.#x]),e.#r.view.children.length>e.#h&&(e.#m=e.clockSource.now()+500,e.#u===0&&console.debug("Meta event garbage collector triggered."),e.#u=1);e.#r.view.children.length>e.#C;)e.#r.view.children[0].remove();p=!0}p&&(e.#v=f.amend??!1,e.#k=f.type??""),e.#ue()}),e.#r.view.style.transform="translateX(0px) translateY(140px)",e.#n=setInterval(async()=>{let o=e.clockSource.now();if(e.#u!==0)switch(e.#u){case 1:{if(o<e.#m)break;e.#r.view.style.transition="none";let f=0;for(;e.#r.view.children.length>e.#a;)e.#r.view.children[0].remove(),f++;e.#ue(),console.debug(`Meta event garbage collector removed ${f} events.`),e.#u=2;break}case 2:{if(o<e.#m+100)break;e.#r.view.style.transition="",T()&&console.debug("Meta event garbage collector restored meta animation."),e.#u=0;break}}},40),e.dispatchEvent("mode","?"),e.dispatchEvent("mastervolume",100),e.dispatchEvent("tempo",120),e.dispatchEvent("tsig",[4,4]),e.dispatchEvent("title",""),e.dispatchEvent("efxreverb",{id:e.device.getEffectType(0)}),e.dispatchEvent("efxchorus",{id:e.device.getEffectType(1)}),e.dispatchEvent("efxdelay",{id:e.device.getEffectType(2)}),e.dispatchEvent("efxinsert0",{id:e.device.getEffectType(3)}),e.#re(!0)}detach(n){let e=this;self.removeEventListener("resize",e.#ie),e.#E.remove(),e.#E=void 0,e.#g.remove(),e.#g=void 0,e.#Z=void 0,clearInterval(e.#G),clearInterval(e.#n)}constructor(n,e){super(new mt,.1,.75);let t=this;t.#ie=t.#ge.bind(this),t.#q=t.#be.bind(this),t.#X.fill(null),t.#H.fill(null),n&&t.attach(n),e&&t.setClockSource(e),t.setPixelProfile("none"),t.addEventListener("reset",()=>{t.#e=0,t.#b=0,t.#v=!1,t.#k="",t.#x=null,t.#c=y.invalidCh,t.#X.fill(null),t.#H.fill(null),D(t.#t.inscon1,["field-active"]),D(t.#t.inscon2,["field-active"]),D(t.#t.inscon3,["field-active"]),D(t.#t.inscon4,["field-active"]);try{let r=t.#r.view.children;for(let o=r.length-1;o>=0;o--)r[o].remove();t.#r.view.style.transform="translateX(0px) translateY(140px)";for(let o=0;o<y.ch;o++){let f=t.#l[o>>4][o&15];D(f.root,["part-active"]),D(f.number,["part-efx","part-focus"]);for(let p of f.root.classList)p.substring(0,10)==="part-mode-"&&f.root.classList.remove(p);Mt(f.metre,""),f.type.setTextRaw(""),f.std.setTextRaw(""),f.msb.setTextRaw(""),f.prg.setTextRaw(""),f.lsb.setTextRaw(""),f.notes.style.transform="",f.ccUpdate=!0}}catch{}}),t.addEventListener("chmode",({data:r})=>{let{part:o,mode:f}=r;t.setChMode(o,f);let p=Te[f];p&&(t.#X[o]=p[t.#S])}),t.addEventListener("pitch",({data:r})=>{t.#te.push(r)})}};export{Jr as Cambiare};
