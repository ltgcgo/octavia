var et=Object.create;var Ee=Object.defineProperty;var tt=Object.getOwnPropertyDescriptor;var at=Object.getOwnPropertyNames;var rt=Object.getPrototypeOf,it=Object.prototype.hasOwnProperty;var st=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var nt=(e,t,i,o)=>{if(t&&typeof t=="object"||typeof t=="function")for(let f of at(t))!it.call(e,f)&&f!==i&&Ee(e,f,{get:()=>t[f],enumerable:!(o=tt(t,f))||o.enumerable});return e};var ct=(e,t,i)=>(i=e!=null?et(rt(e)):{},nt(t||!e||!e.__esModule?Ee(i,"default",{value:e,enumerable:!0}):i,e));var _e=st((ha,ue)=>{(function(){"use strict";let e={fatal:!0},t=[new TextDecoder("iso-8859-15",e),new TextDecoder("sjis",e),new TextDecoder("euc-jp",e),new TextDecoder("utf-8",e),new TextDecoder("utf-16",e),new TextDecoder("ascii")],i={debug:!1,parse:function(o,f){if(o instanceof Uint8Array)return i.Uint8(o);if(typeof o=="string")return i.Base64(o);if(o instanceof HTMLElement&&o.type==="file")return i.addListener(o,f);throw new Error("MidiParser.parse() : Invalid input provided")},addListener:function(o,f){if(!File||!FileReader)throw new Error("The File|FileReader APIs are not supported in this browser. Use instead MidiParser.Base64() or MidiParser.Uint8()");if(o===void 0||!(o instanceof HTMLElement)||o.tagName!=="INPUT"||o.type.toLowerCase()!=="file")return console.warn("MidiParser.addListener() : Provided element is not a valid FILE INPUT element"),!1;f=f||function(){},o.addEventListener("change",function(p){if(!p.target.files.length)return!1;console.log("MidiParser.addListener() : File detected in INPUT ELEMENT processing data..");let m=new FileReader;m.readAsArrayBuffer(p.target.files[0]),m.onload=function(y){f(i.Uint8(new Uint8Array(y.target.result)))}})},Base64:function(o){let f=function(y){var r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";if(y=y.replace(/^.*?base64,/,""),y=String(y).replace(/[\t\n\f\r ]+/g,""),!/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/.test(y))throw new TypeError("Failed to execute _atob() : The string to be decoded is not correctly encoded.");y+="==".slice(2-(3&y.length));let l,u="",a,s,n=0;for(;n<y.length;)l=r.indexOf(y.charAt(n++))<<18|r.indexOf(y.charAt(n++))<<12|(a=r.indexOf(y.charAt(n++)))<<6|(s=r.indexOf(y.charAt(n++))),u+=a===64?String.fromCharCode(l>>16&255):s===64?String.fromCharCode(l>>16&255,l>>8&255):String.fromCharCode(l>>16&255,l>>8&255,255&l);return u}(o=String(o));var p=f.length;let m=new Uint8Array(new ArrayBuffer(p));for(let y=0;y<p;y++)m[y]=f.charCodeAt(y);return i.Uint8(m)},Uint8:function(m){let f={data:null,pointer:0,movePointer:function(a){return this.pointer+=a,this.pointer},readInt:function(a){if((a=Math.min(a,this.data.byteLength-this.pointer))<1)return-1;let s=0;if(1<a)for(let n=1;n<=a-1;n++)s+=this.data.getUint8(this.pointer)*Math.pow(256,a-n),this.pointer++;return s+=this.data.getUint8(this.pointer),this.pointer++,s},readStr:function(a){let s=new Uint8Array(a),n=!1,c;s.forEach((d,h)=>{s[h]=this.readInt(1)});for(let d=0;d<t.length;d++)if(!n)try{if(c=t[d].decode(s),d==0)for(let h=0;h<c.length;h++){let g=c.charCodeAt(h);if(g>191||g>127&&g<160)throw new RangeError(`Invalid code point: ${g}`)}n=!0,console.debug(`String byte sequence in ${t[d].encoding}`)}catch(h){console.debug(`SMF string ${h}`)}return c||"String byte sequence read failed."},backOne:function(){this.pointer--},readIntVLV:function(){let a=0;if(this.pointer>=this.data.byteLength)return-1;if(this.data.getUint8(this.pointer)<128)a=this.readInt(1);else{let n=[];for(;128<=this.data.getUint8(this.pointer);)n.push(this.readInt(1)-128);var s=this.readInt(1);for(let c=1;c<=n.length;c++)a+=n[n.length-c]*Math.pow(128,c);a+=s}return a}};if(f.data=new DataView(m.buffer,m.byteOffset,m.byteLength),f.readInt(4)!==1297377380)return console.warn("Header validation failed (not MIDI standard or file corrupt.)"),!1;f.readInt(4);let p={};p.formatType=f.readInt(2),p.tracks=f.readInt(2),p.track=[];var m=f.readInt(1),y=f.readInt(1);128<=m?(p.timeDivision=[],p.timeDivision[0]=m-128,p.timeDivision[1]=y):p.timeDivision=256*m+y;for(let a=1;a<=p.tracks;a++){p.track[a-1]={event:[]};var r,l=f.readInt(4);if(l===-1)break;if(l!==1297379947)return!1;f.readInt(4);let s=0,n=!1,c,d;for(;!n&&(s++,p.track[a-1].event[s-1]={},p.track[a-1].event[s-1].deltaTime=f.readIntVLV(),(c=f.readInt(1))!==-1);)if(128<=c?d=c:(c=d,f.movePointer(-1)),c===255){p.track[a-1].event[s-1].type=255,p.track[a-1].event[s-1].metaType=f.readInt(1);var u=f.readIntVLV();switch(p.track[a-1].event[s-1].metaType){case 47:case-1:n=!0;break;case 1:case 2:case 3:case 4:case 5:case 7:case 6:p.track[a-1].event[s-1].data=f.readStr(u);break;case 33:case 89:case 81:p.track[a-1].event[s-1].data=f.readInt(u);break;case 84:p.track[a-1].event[s-1].data=[],p.track[a-1].event[s-1].data[0]=f.readInt(1),p.track[a-1].event[s-1].data[1]=f.readInt(1),p.track[a-1].event[s-1].data[2]=f.readInt(1),p.track[a-1].event[s-1].data[3]=f.readInt(1),p.track[a-1].event[s-1].data[4]=f.readInt(1);break;case 88:p.track[a-1].event[s-1].data=[],p.track[a-1].event[s-1].data[0]=f.readInt(1),p.track[a-1].event[s-1].data[1]=f.readInt(1),p.track[a-1].event[s-1].data[2]=f.readInt(1),p.track[a-1].event[s-1].data[3]=f.readInt(1);break;default:this.customInterpreter!==null&&(p.track[a-1].event[s-1].data=this.customInterpreter(p.track[a-1].event[s-1].metaType,f,u)),this.customInterpreter!==null&&p.track[a-1].event[s-1].data!==!1||(f.readInt(u),p.track[a-1].event[s-1].data=f.readInt(u),this.debug&&console.info("Unimplemented 0xFF meta event! data block readed as Integer"))}}else switch((c=c.toString(16).split(""))[1]||c.unshift("0"),p.track[a-1].event[s-1].type=parseInt(c[0],16),p.track[a-1].event[s-1].channel=parseInt(c[1],16),p.track[a-1].event[s-1].type){case 15:this.customInterpreter!==null&&(p.track[a-1].event[s-1].data=this.customInterpreter(p.track[a-1].event[s-1].type,f,!1)),this.customInterpreter!==null&&p.track[a-1].event[s-1].data!==!1||(r=f.readIntVLV(),p.track[a-1].event[s-1].data=f.readInt(r),this.debug&&console.info("Unimplemented 0xF exclusive events! data block readed as Integer"));break;case 10:case 11:case 14:case 8:case 9:p.track[a-1].event[s-1].data=[],p.track[a-1].event[s-1].data[0]=f.readInt(1),p.track[a-1].event[s-1].data[1]=f.readInt(1);break;case 12:case 13:p.track[a-1].event[s-1].data=f.readInt(1);break;case-1:n=!0;break;default:if(this.customInterpreter!==null&&(p.track[a-1].event[s-1].data=this.customInterpreter(p.track[a-1].event[s-1].metaType,f,!1)),this.customInterpreter===null||p.track[a-1].event[s-1].data===!1)return console.log("Unknown EVENT detected... reading cancelled!"),!1}}return p},customInterpreter:null};if(typeof ue<"u")ue.exports=i;else{let o=typeof window=="object"&&window.self===window&&window||typeof self=="object"&&self.self===self&&self||typeof global=="object"&&global.global===global&&global;o.MidiParser=i}})()});var we=function(e,t){let i=Math.min(e.length,t.length),o=e.slice(0,i),f=t.slice(0,i),p=0,m=0;for(;m<i&&p==0;)p=Math.sign(o[m]-f[m]),m++;return p},I=function(e=""){this.name=e,this.pool=[],this.point=function(t,i=!1){if(this.pool.length>0){let o=this.pool.length,f=1<<Math.floor(Math.log2(o)),p=f,m=64;for(;f>=1&&m>=0;){if(m<=0)throw new Error("TTL reached.");if(p==o)p-=f;else{let r=we(t,this.pool[p]);switch(r){case 0:{m=0;break}case 1:{p+f<=o&&(p+=f);break}case-1:{p!=0&&(p-=f);break}default:console.warn(`Unexpected result ${r}.`)}}f=f>>1,m--}let y=!0;if(p>=this.pool.length)y=!1;else{let r=this;this.pool[p].forEach(function(l,u,a){y&&l!=t[u]&&(y=!1)}),!y&&we(t,this.pool[p])>0&&p++}return y||i?p:-1}else return i?0:-1},this.add=function(t,i){return t.data=i,this.pool.splice(this.point(t,!0),0,t),this},this.default=function(t){console.warn(`No match in "${this.name||"(unknown)"}" for "${t}". Default action not defined.`)},this.get=function(t){let i=this.point(t);if(i>-1)return this.pool[i].data;this.default(t)},this.run=function(t,...i){let o=this.point(t);o>-1?t.subarray?this.pool[o].data(t.subarray(this.pool[o].length),...i):this.pool[o].data(t.slice(this.pool[o].length),...i):this.default(t,...i)}};var j=class{#a={};addEventListener(e,t){this.#a[e]||(this.#a[e]=[]),this.#a[e].unshift(t)}removeEventListener(e,t){if(this.#a[e]){let i=this.#a[e].indexOf(t);i>-1&&this.#a[e].splice(i,1),this.#a[e].length<1&&delete this.#a[e]}}dispatchEvent(e,t){let i=new Event(e),o=this;i.data=t,this.#a[e]?.length>0&&this.#a[e].forEach(function(f){try{f?.call(o,i)}catch(p){console.error(p)}}),this[`on${e}`]&&this[`on${e}`](i)}};var ot=["MSB","PRG","LSB","NME","ELC","DRM","LVL"],lt={krs:"KR",s90es:"ES",motif:"ES"},dt={krs:"Kr",s90es:"SE",motif:"ME"},se=function(e){let t=Math.floor(e/10),i=e%10;return`${t.toString(16)}${i}`},ne=class{#a;get bankInfo(){return this.#a}strictMode=!1;get(e=0,t=0,i=0,o,f=0){let p=[e,t,i],m,y=1,r=0,l,u,a=Array.from(arguments);switch(o){case"xg":{switch(e){case 0:{i==126?a[2]=125:i==127&&(a[2]=0);break}case 16:{i==126&&(a[2]=0);break}case 32:{i>125&&(a[2]=0),a[2]+=4;break}case 33:{(i>125||i==3)&&(a[2]=0),a[2]+=5;break}case 34:case 35:case 36:{i>125&&(a[2]=0),a[2]+=5;break}case 79:case 80:case 81:case 82:case 83:case 84:a[0]+=16;case 95:case 96:case 97:case 98:case 99:case 100:{i==126&&(a[2]=0);break}case 48:case 64:case 126:case 127:{i==126&&(e==127&&t==0||(a[2]=0));break}}break}case"gs":case"sc":{e==0&&i<5?a[0]=49:e>125&&i<5&&i!=2&&(a[2]=e,a[0]=49);break}case"mt32":{e==0&&(a[0]=49);break}case"sd":{switch(e){case 121:{a[0]=96;break}case 120:{a[0]=104;break}}a[0]>>1==40?a[2]|=16:a[0]>95&&a[0]<100&&(a[2]|=16,t>>4==7&&(a[0]=96));break}case"g2":{e>>1==40?a[2]|=16:e>95&&e<100&&(a[2]|=16,t>>4==7&&(a[0]=96));break}case"sg":{e==8&&i==0&&(a[2]=5);break}case"05rw":case"x5d":{e&&e<56&&(a[0]=56);break}case"s90es":{if(e==0)break;i<8?a[2]+=17:i<32?a[2]+=13:a[2]=(a[2]>>3)+19;break}case"motif":{if(e==0)break;i<8?a[2]+=28:i<32?a[2]+=13:a[2]=(a[2]>>3)+19;break}}let s=" ",n="M",c="",d=0,h=0;switch(a[0]){case 0:{switch(a[2]){case 127:{n="GM-a";break}case 126:{n="GM-n";break}case 7:{n="GM-k",c="GLX";break}case 5:{n="SG-a",c="000";break}case 4:{o=="gs"||o=="sc"?(n="GM-a",c="000"):(n="SP-l",c="C/M");break}case 3:case 2:case 1:{(o=="gs"||o=="sc")&&(n="GM-a",c="000");break}case 0:{n="GM-a";break}default:n="y",d=3}break}case 8:{o=="sg"?n="GM-s":n="r:";break}case 32:case 33:case 34:case 35:case 36:{o=="xg"&&(n=`${["AP","VL","PF","DX","AN"][e&7]}-${"abcdefgh"[i]}`,d=3);break}case 48:{c=`M${(a[2]>>3).toString().padStart(2,"0")}`,n=`y${c}`,d=1;break}case 49:{a[2]>>1==63?(n=`MT-${"ba"[a[2]&1]}`,c=`C${"-/"[a[2]&1]}M`):(n="GM-a",c="000");break}case 56:{n="GM-b";break}case 57:n=["yDOC","QY10","QY20"][a[2]-112]||"yMxv",c=["DOC","QY1","QY2"][a[2]-112]||"057";case 61:case 120:{n="rDrm";break}case 62:{n="kDrm";break}case 63:{if(a[2]<17){let $=a[2];n=$<10?"kP:":"kC:",n+=$%10}else a[2]<34?n=["Pre1","Pre2","Pre3","Pre4","Usr1","Usr2","DrmP","DrmU","Plg1","Plg2","Plg3","Pre1","Pre2","Pre3","Pre4","Pre5","Pre6"][a[2]-17]:n="Ds";d=1;break}case 64:{n="ySFX",c="SFX";break}case 67:{n="DX:S";break}case 80:case 81:case 82:case 83:{n=`Prg${"UABC"[a[0]-80]}`;break}case 88:case 89:case 90:case 91:{n=`Cmb${"UABC"[a[0]-88]}`;break}case 95:{n=`${["DR","PC"][a[2]]}-d`;break}case 96:{n=a[2]==106?"AP-a":a[2]>>4==1?"SDg":"PF",a[2]>63?h=63:a[2]>>4==1&&(h=16),d=3;break}case 97:{n=a[2]>>4==1?"SDa":"VL:",d=3,a[2]>>4==1?h=16:h=112;break}case 98:{n=a[2]>>4==1?"SDb":"SG-a",d=3,h=16;break}case 99:{n=a[2]>>4==1?"SDc":"DX",a[2]>63?h=63:a[2]>>4==1&&(h=16),d=3;break}case 100:{n="AN",a[2]>63?h=63:a[2]>>4==1&&(h=16),d=3;break}case 104:case 105:case 106:case 107:{n="SDd",h=104;break}case 121:{n=`GM-${a[2]?"":"a"}`,d=3;break}case 122:{n="lDrm";break}case 126:{n="yDrS";break}case 127:{a[2]==127?n="rDrm":n="yDrm";break}default:a[0]<48?n="r:":n="M"}n.length<4&&(n+=`${[e,i,a[0],a[2]][d]-h}`.padStart(4-n.length,"0")),c.length<3&&(c+=`${[e,i,e,i][d]}`.padStart(3-c.length,"0")),o=="xg"&&(e==0?a[2]<100?n=n.replace("y0","y:"):a[2]==125&&(n="y126"):e==16?(m=`Voice${((a[2]<<7)+a[1]+1).toString().padStart(3,"0")}`,s=" "):e==35&&i>>1==2&&(m=`DXCH_${(((a[2]&1)<<7)+t+1).toString().padStart(3,"0")}`,s=" "));let g=[a[0],a[1],a[2]];for(;!(m?.length>=0);)if(m=this.#a[a[1]||0][(a[0]<<8)+a[2]]?.name,m){let $=this.#a[a[1]||0][(a[0]<<8)+a[2]];y=$?.poly||y,r=$?.type||r,l=$?.drum,u=$?.level}else if(this.strictMode)m="",s="?";else if(a[0]==0&&a[1]==0&&a[2]==0)m="Unloaded";else if(this.#a[a[1]||0][a[0]<<8])a[0]==0?(a[2]=0,s="^"):a[2]<1?(a[0]=0,s="*"):(a[2]--,s="^");else if(e==48)a[0]=0,a[2]=0,s="!";else if(e==62)a[1]--,s=" ",a[1]<1&&!m?.length&&(a[0]=0,s="!");else if(e<63)a[0]==0?(a[2]=0,s="^"):a[2]<1?(a[0]=0,s="*"):a[2]--;else if(e==80)m=`PrgU:${t.toString().padStart(3,"0")}`,s="!";else if(e==88)m=`CmbU:${t.toString().padStart(3,"0")}`,s="!";else if(e==121)m=`GM2Vox0${i}`,s="#";else if(e==122)if(a[1]==32?a[1]==0:a[1]%=7,m=this.#a[a[1]||0][(a[0]<<8)+a[2]]?.name,m){s=" ";let $=this.#a[a[1]||0][(a[0]<<8)+a[2]];y=$?.poly||y,r=$?.type||r,l=$?.drum,u=$?.level}else m="",s="*";else a[1]==0?(m=`${e.toString().padStart(3,"0")} ${t.toString().padStart(3,"0")} ${i.toString().padStart(3,"0")}`,s="!"):a[0]==0?(a[2]=0,s="^"):a[2]>0?a[2]--:a[1]>0?(a[1]=0,s="!"):(a[0]=0,s="?");let E=[a[0],a[1],a[2]];switch(s){case"^":{switch(o){case"gs":case"sc":case"ns5r":{s=" ";break}}e==127&&s=="^"&&(s=" ");break}}let C="??";switch(a[0]){case 0:{a[2]==0?C="GM":a[2]==5||a[2]==7?C="KG":a[2]<126&&(C="XG");break}case 32:case 33:case 35:case 36:{a[2]>4?C=["AP","VL","PF","DX","AN"][a[0]-32]:C="GS";break}case 48:{C="MU";break}case 49:{a[2]>>1==63?C="MT":a[2]<5&&(C="GM");break}case 56:{C="AG";break}case 61:case 80:case 83:case 88:case 89:case 91:{C="AI";break}case 62:case 82:case 90:{C="XD";break}case 63:{a[2]<17?C="KR":a[2]<34?C="ES":C="DS";break}case 64:case 126:{C="XG";break}case 67:case 99:{C=a[2]>>4==1?"SD":"DX";break}case 81:{C="RW";break}case 95:{C=["DR","PC"][a[2]];break}case 96:{C=a[2]==106?"AP":a[2]>>4==1?"SD":"PF";break}case 97:{C=a[2]>>4==1?"SD":"VL";break}case 98:{C=a[2]>>4==1?"SD":"SG";break}case 100:{C="AN";break}case 104:case 105:case 106:case 107:{C="SD";break}case 120:{C="GS";break}case 121:{C=a[2]?"G2":"GM";break}case 122:{C="KG";break}case 127:{C=a[2]==127?"MT":t==0?"GM":"XG";break}default:a[0]<48&&(a[0]==16&&o=="xg"?C="XG":C="GS")}if(s!=" ")switch(o){case"krs":case"s90es":case"motif":{m="",C=lt[o];break}default:self.debugMode&&(m="")}return{name:m||`${dt[o]||o.toUpperCase()}${se(e||0)}${se(t||0)}${se(i||0)}`,poly:y,type:r,drum:l,level:u,iid:g,eid:E,sid:p,ending:s,sect:n,bank:c,standard:C,mode:o}}async load(e,t,i="(internal)",o){let f=this,p=[],m=0,y=0,r=0;e.split(`
`).forEach(function(l,u){let a=l.split("	"),s=[];if(u==0){if(a.forEach(function(n,c){p[ot.indexOf(n)]=c}),p.length<4){console.debug("Debugger launched.");debugger}}else{let n=0,c=0,d=0,h,g=1,E=0,C,$;a.forEach(function(D,H){switch(H){case p[0]:{n=parseInt(D);break}case p[1]:{c=parseInt(D);break}case p[2]:{d=parseInt(D);break}case p[3]:{h=D;break}case p[4]:{D=parseInt(D),D<16?g=D+1:(E=(D&15)+1,g=E);break}case p[5]:{$=D;break}case p[6]:{D?.constructor&&(C=parseInt(D));break}}}),f.#a[c]=f.#a[c]||[];let x=f.#a[c],R={msb:n,prg:c,lsb:d,name:h,poly:g,type:E,drum:$,level:C,priority:o},N=!1;o<x[n<<8|d]?.priority&&(N=!0,r++),(!x[n<<8|d]||N||t)&&(x[n<<8|d]=R,m++),y++}}),t||console.debug(`Map "${i}": ${y} total, ${m} loaded (${m-r} + ${r}).`)}clearRange(e){let t=e.prg!=null?e.prg.constructor==Array?e.prg:[e.prg,e.prg]:[0,127],i=e.msb!=null?e.msb.constructor==Array?e.msb:[e.msb,e.msb]:[0,127],o=e.lsb!=null?e.lsb.constructor==Array?e.lsb:[e.lsb,e.lsb]:[0,127];for(let f=i[0];f<=i[1];f++){let p=f<<8;for(let m=o[0];m<=o[1];m++){let y=p+m;for(let r=t[0];r<=t[1];r++)delete this.#a[r][y]}}}init(){this.#a=[];for(let e=0;e<128;e++)this.#a.push([""])}async loadFiles(...e){this.init();let t=this;e.forEach(async function(i,o){try{t.load(await(await fetch(`./data/bank/${i}.tsv`)).text(),!1,i,o)}catch{console.error(`Failed loading "${i}.tsv".`)}})}constructor(...e){this.loadFiles(...e)}};var Ce=class{#a={};context;set(e,t){this.#a[e]=t}has(e){return!!this.#a[e]}async read(e,t){if(!this.has(e))throw new Error(`No decoder registered for "${e}"`);return await this.#a[e].call(this.context||this,t)}};var ht=function(e,t){let i=!0;return t.forEach((o,f)=>{i=i&&e[f]==o}),i},W=function(e){let t=0;return e.forEach(i=>{t*=256,t+=i}),t},X=new TextDecoder,q=new Ce;q.set("s7e",async function(e){let t=new Uint8Array(await e.slice(0,65536).arrayBuffer()),i="MSB	LSB	PRG	NME",o=[0,0,0,0],f=32,p=0,m=0,y=!0,r=[],l=0;for(;y;){let u=t.subarray(p);([()=>{X.decode(u.subarray(0,4))=="YSFC"?(p+=80,m=1):p++},()=>{if(ht(u.subarray(0,4),o))r.forEach((a,s,n)=>{let c=W(t.subarray(a.start+4,a.start+8));a.length=c}),m=2;else{let a=X.decode(u.subarray(0,4)),s=W(u.subarray(4,8));r.push({type:a,start:s}),p+=8}},()=>{let a=r[l],s=t.subarray(a.start,a.start+a.length),n=32;switch(a.type){case"ENVC":{let c=f;for(;c<s.length;){let d=s.subarray(c,c+n),h=X.decode(d.subarray(0,10)).trimEnd();h.slice(0,5)=="Init "&&(h=""),h&&(i+=`
063	${(d[17]+13).toString().padStart(3,"0")}	${d[19].toString().padStart(3,"0")}	${h}`),c+=n}break}case"EDVC":{let c=f;for(;c<s.length;){let d=s.subarray(c,c+n),h=X.decode(d.subarray(0,10)).trimEnd();h.slice(0,5)=="Init "&&(h=""),h&&(i+=`
063	024	${d[19].toString().padStart(3,"0")}	${h}`),c+=n}break}case"EPVC":{let c=32,d=f;for(;d<s.length;){let h=s.subarray(d,d+c),g=X.decode(h.subarray(0,10)).trimEnd();g=="----------"&&(g=""),g&&(i+=`
063	${(h[17]+1).toString().padStart(3,"0")}	${h[19].toString().padStart(3,"0")}	${g}`),d+=c}break}}l++,l>=r.length&&(m=3,y=!1)}][m]||(()=>{y=!1}))()}return i});q.set("pcg",async function(e){let t=new Uint8Array(await e.arrayBuffer()),i="MSB	LSB	PRG	NME",o=100,f=0,p=0,m=!0,y=[],r=0;for(;m;){let l=t.subarray(o);([()=>{m=X.decode(l.subarray(0,4))=="INI2",p=l[15],o+=16,f=1},()=>{let u=X.decode(l.subarray(0,4)),a=l[5],s=l[7],n=l[11],c=W(l.subarray(12,16)),d=W(l.subarray(16,20)),h=W(l.subarray(36,40)),g=X.decode(l.subarray(44,44+n));y.push({type:u,tipMsb:a,tipLsb:s,nameLen:n,length:c,start:d,entryLen:h,name:g}),o+=64,p--,p<1&&(f=2)},()=>{let u=y[r],a=t.subarray(u.start,u.start+u.length);switch(u.type){case"PRG1":break;case"PBK1":{let s=63,n=(u.tipMsb?6:0)+u.tipLsb;for(let c=0;c<128;c++){let d=c*u.entryLen,h=a.subarray(d,d+u.entryLen),g=X.decode(h.subarray(0,24)).trimEnd().replace("InitProg","");g.length&&n>5&&(i+=`
${s.toString().padStart(3,"0")}	${n.toString().padStart(3,"0")}	${c.toString().padStart(3,"0")}	${g}`)}break}case"CBK1":{let s=63,n=(u.tipMsb?3:0)+u.tipLsb+10;for(let c=0;c<128;c++){let d=c*u.entryLen,h=a.subarray(d,d+u.entryLen),g=X.decode(h.subarray(0,24)).trimEnd().replace("InitCombi","");g.length&&n>12&&(i+=`
${s.toString().padStart(3,"0")}	${n.toString().padStart(3,"0")}	${c.toString().padStart(3,"0")}	${g}`)}break}}r++,r>=y.length&&(f=3,m=!1)}][f]||(()=>{m=!1}))()}return i});var Y=["off","hall","room","stage","plate","delay LCR","delay LR","echo","cross delay","early reflections","gate reverb","reverse gate"].concat(new Array(4),["white room","tunnel","canyon","basement","karaoke"],new Array(43),["pass through","chorus","celeste","flanger","symphonic","rotary speaker","tremelo","auto pan","phaser","distortion","overdrive","amplifier","3-band EQ","2-band EQ","auto wah"],new Array(1),["pitch change","harmonic","touch wah","compressor","noise gate","voice channel","2-way rotary speaker","ensemble detune","ambience"],new Array(4),["talking mod","Lo-Fi","dist + delay","comp + dist + delay","wah + dist + delay","V dist","dual rotor speaker"]),Q=["melodic","drums","drum set 1","drum set 2","drum set 3","drum set 4","drum set 5","drum set 6","drum set 7","drum set 8"],ft=[17.1,18.6,20.2,21.8,23.3,24.9,26.5,28,29.6,31.2,32.8,34.3,35.9,37.5,39,40.6,42.2,43.7,45.3,46.9,48.4,50],z=[20,22,25,28,32,36,40,45,50,56,63,70,80,90,100,110,125,140,160,180,200,225,250,280,315,355,400,450,500,560,630,700,800,900,1e3,1100,1200,1400,1600,1800,2e3,2200,2500,2800,3200,3600,4e3,4500,5e3,5600,6300,7e3,8e3,9e3,1e4,11e3,12e3,14e3,16e3,18e3,2e4],ke=[0,.04,.08,.13,.17,.21,.25,.29,.34,.38,.42,.46,.51,.55,.59,.63,.67,.72,.76,.8,.84,.88,.93,.97,1.01,1.05,1.09,1.14,1.18,1.22,1.26,1.3,1.35,1.39,1.43,1.47,1.51,1.56,1.6,1.64,1.68,1.72,1.77,1.81,1.85,1.89,1.94,1.98,2.02,2.06,2.1,2.15,2.19,2.23,2.27,2.31,2.36,2.4,2.44,2.48,2.52,2.57,2.61,2.65,2.69,2.78,2.86,2.94,3.03,3.11,3.2,3.28,3.37,3.45,3.53,3.62,3.7,3.87,4.04,4.21,4,37,4.54,4.71,4.88,5.05,5.22,5.38,5.55,5.72,6.06,6.39,6.73,7.07,7.4,7.74,8.08,8.41,8.75,9.08,9.42,9.76,10.1,10.8,11.4,12.1,12.8,13.5,14.1,14.8,15.5,16.2,16.8,17.5,18.2,19.5,20.9,22.2,23.6,24.9,26.2,27.6,28.9,30.3,31.6,33,34.3,37,39.7],$e=function(e){let t=.1,i=-.3;return e>66?(t=5,i=315):e>56?(t=1,i=47):e>46&&(t=.5,i=18.5),t*e-i},xe=function(e){return e>105?ft[e-106]:e>100?e*1.1-100:e/10},Te=",a,i,u,e,o,ka,ki,ku,ke,ko,ky,kw,sa,si,su,se,so,sh,ta,ti,tu,te,to,t,ch,t,s,na,ni,nu,ne,no,ny,nn,ha,hi,hu,he,ho,hy,fa,fi,fu,fe,fo,ma,mi,mu,me,mo,my,mm,ya,yu,ye,yo,ra,ri,ru,re,ro,ry,wa,wi,we,wo,ga,gi,gu,ge,go,gy,gw,za,zi,zu,ze,zo,ja,ji,ju,je,jo,jy,da,di,du,de,do,dy,ba,bi,bu,be,bo,by,va,vi,vu,ve,vo,pa,pi,pu,pe,po,py,nga,ngi,ngu,nge,ngo,ngy,ng,hha,hhi,hhu,hhe,hho,hhy,hhw,*,_,,,~,.".split(","),ce={};`hi*,
ka,ã‹
ki,ã
ku,ã
ke,ã‘
ko,ã“
ky,ã!
kw,ãl
tsu,ã¤
ts,ã¤l
sa,ã•
si,ã™ãƒ
su,ã™
se,ã›
so,ã
shi,ã—
sh,ã—!
ta,ãŸ
ti,ã¦ãƒ
tu,ã¨ã…
te,ã¦
to,ã¨
tchy,ã¡!
tchi,ã¡
na,ãª
ni,ã«
nu,ã¬
ne,ã­
no,ã®
ny,ã«!
nn,ã‚“
ha,ã¯
hi,ã²
hu,ã»ã…
he,ã¸
ho,ã»
hy,ã²!
fa,ãµã
fi,ãµãƒ
fu,ãµ
fe,ãµã‡
fo,ãµã‰
ma,ã¾
mi,ã¿
mu,ã‚€
me,ã‚
mo,ã‚‚
my,ã¿!
mm,ã‡º
ra,ã‚‰
ri,ã‚Š
ru,ã‚‹
re,ã‚Œ
ro,ã‚
ry,ã‚Š!
wa,ã‚
wi,ã‚
we,ã‚‘
wo,ã‚’
nga,ã‹ã‚š
ngi,ãã‚š
ngu,ãã‚š
nge,ã‘ã‚š
ngo,ã“ã‚š
ngy,ãã‚š!
ng,ãƒ³
ga,ãŒ
gi,ãŽ
gu,ã
ge,ã’
go,ã”
gy,ãŽ!
gw,ãl
za,ã–
zi,ãšãƒ
zu,ãš
ze,ãœ
zo,ãž
ja,ã˜ã‚ƒ
ji,ã˜
ju,ã˜ã‚…
je,ã˜ã‡
jo,ã˜ã‚‡
jy,ã˜!
da,ã 
di,ã§ãƒ
du,ã©ã…
de,ã§
do,ã©
dy,ã§!
ba,ã°
bi,ã³
bu,ã¶
be,ã¹
bo,ã¼
by,ã³!
va,ã‚”ã
vi,ã‚”ãƒ
vu,ã‚”
ve,ã‚”ã‡
vo,ã‚”ã‰
pa,ã±
pi,ã´
pu,ã·
pe,ãƒš
po,ã½
py,ã´!
!ya,ã‚ƒ
!yu,ã‚…
!ye,ã‡
!yo,ã‚‡
ya,ã‚„
yu,ã‚†
ye,ð›€
yo,ã‚ˆ
!a,ã‚ƒ
!u,ã‚…
!e,ã‡
!o,ã‚‡
!a,ã‚ƒ
!u,ã‚…
!e,ã‡
!o,ã‚‡
la,ã
li,ãƒ
lu,ã…
le,ã‡
lo,ã‰
a,ã‚
i,ã„
u,ã†
e,ãˆ
o,ãŠ
*,ã£
~,
^,
_,`.split(`
`).forEach(e=>{let t=e.split(",");ce[t[0]]=t[1]});var Se=function(e){let t=e;e[0]=="*"&&(t=t.slice(1)),["aa","ii","uu","ee","oo"].forEach(o=>{for(;t.indexOf(o)>-1;)t=t.replace(o,o[0])});for(let o in ce)t=t.replaceAll(o,ce[o]);t.indexOf("ã‚“")==0&&t.length>1&&(t=t.slice(1));let i=t.indexOf("!");return i>-1&&t.length>1&&(t=t.slice(i+1)),t},Me=function(e){return e?e<96?`cc${e}`:["aftertouch","velocity","pitch bend"][e-96]:"off"};var oe=["room 1","room 2","room 3","hall 1","hall 2","plate","delay","panning delay"],Pe=["chorus 1","chorus 2","chorus 3","chorus 4","feedback","flanger","short delay","short delay feedback"],Re=["delay 1","delay 2","delay 3","delay 4","pan delay 1","pan delay 2","pan delay 3","pan delay 4","delay to reverb","pan repeat"];var ut={0:"thru",256:"stereo EQ",257:"spectrum",258:"enhancer",259:"humanizer",272:"overdrive",273:"distortion",288:"phaser",289:"auto wah",290:"rotary",291:"stereo flanger",292:"step flanger",293:"tremelo",294:"auto pan",304:"compressor",305:"limiter",320:"hexa chorus",321:"tremelo chorus",322:"stereo chorus",323:"space D",324:"3D chorus",336:"stereo delay",337:"modulated delay",338:"3-tap delay",339:"4-tap delay",340:"tremelo control delay",341:"reverb",342:"gate reverb",343:"3D delay",352:"2-pitch shifter",353:"feedback pitch shifter",368:"3D auto",369:"3D manual",370:"Lo-Fi 1",371:"Lo-Fi 2",512:"overdrive - chorus",513:"overdrive - flanger",514:"overdrive - delay",515:"distortion - chorus",516:"distortion - flanger",517:"distortion - delay",518:"enhancer - chorus",519:"enhancer - flanger",520:"enhancer - delay",521:"chorus - delay",522:"flanger - delay",523:"chorus - flanger",524:"rotary multi",1024:"guitar multi 1",1025:"guitar multi 2",1026:"guitar multi 3",1027:"clean guitar multi 1",1028:"clean guitar multi 2",1029:"bass multi",1030:"rhodes multi",1280:"keyboard multi",4352:"chorus / delay",4353:"flanger / delay",4354:"chorus / flanger",4355:"overdrive / distortion",4356:"overdrive / rotary",4357:"overdrive / phaser",4358:"overdrive / auto wah",4359:"phaser / rotary",4360:"phaser / auto wah"},pt={66307:["drive"],66309:["vowel",e=>"aiueo"[e]],94723:["pre-filter"],94724:["Lo-Fi type"],94725:["post-filter"],94979:["Lo-Fi type"],94980:["fill type",e=>["off","LPF","HPF"][e]],94984:["noise type",e=>["white","pink"][e]],94987:["disc type",e=>["LP","SP","EP","RND"]],94990:["hum type",e=>`${e+5}0Hz`],94993:["M/S",e=>["mono","stereo"][e]]},le=function(e){return ut[(e[0]-32<<8)+e[1]]||`0x${e[0].toString(16).padStart(2,"0")}${e[1].toString(16).padStart(2,"0")}`},De=function(e,t,i){let o=(e[0]-32<<16)+(e[1]<<8)+t,f=pt[o]||{},p=f[0];if(p?.length)return p+=`: ${(f[1]||function(){})(i)||i}`,p},de=[68,48,95,78,41,3,110,122,0];var L=function(e=64){return Math.round(2e3*Math.log10(e/64))/100},Ae=function(e,t,i){let o=[],f=i==!1?t.readIntVLV():i;e==0||e==127;for(let p=0;p<f;p++){let m=t.readInt(1);if(o.push(m),m!=247){if(m!=240){if(m>127)return console.debug(`Early termination: ${o}`),o.pop(),t.backOne(),t.backOne(),new Uint8Array(o)}}}return new Uint8Array(o)},F=function(e){let t=0;return e.forEach(i=>{t+=i,t=t&127}),~t+1&127},B=function(e,t){let i=0,o=0;for(let f=0;f<e.length;f++){let p=f%8-1,m=(o>>p&1)<<7,y=e[f];y+=m,f%8!=0?(t(y,i,e),i++):o=e[f]}};var Z=function(e){let t=Math.floor(e*14.2);return t<128?t:0},T=function(){return!!self.Bun||self.debugMode||!1};var P=["?","gm","gs","sc","xg","g2","mt32","doc","qy10","qy20","ns5r","x5d","05rw","k11","sg","sd","pa","krs","s90es","motif","trin"],gt={gm2:"g2","mt-32":"mt32","c/m":"mt32",ag10:"05rw","ag-10":"05rw","05r/w":"05rw",x5:"05rw",x5dr:"x5d",gmega:"k11","kross 2":"krs","motif es":"motif","s90 es":"s90es",trinity:"trin","tr-rack":"trin"},mt=["melodic","drum","menu"],Le={"?":[0,0,120,0,0],gm:[0,0,127,0,0],gs:[0,0,120,0,0],sc:[0,0,120,0,0],xg:[0,0,127,0,0],g2:[0,0,120,0,0],mt32:[0,127,127,0,127],doc:[57,112,127,57,112],qy10:[57,113,127,57,113],qy20:[57,114,127,57,114],ns5r:[0,0,61,0,0],x5d:[82,0,62,56,0],"05rw":[81,0,62,56,0],k11:[0,0,122,0,0],sg:[0,0,122,0,0],sd:[97,0,105,0,0],krs:[121,0,120,0,0],s90es:[0,0,127,0,0],motif:[0,0,127,0,0],trin:[0,0,127,0,0]},bt=[9,25,41,57,73,89,105,121],yt=[0,3,81,84,88],Oe={8:"Off",9:"On",10:"Note aftertouch",11:"cc",12:"pc",13:"Channel aftertouch",14:"Pitch"},Ie={0:0,1:1,2:3,5:4},Be={0:0,1:1,2:2,5:3},Ue=[[0,24],[0,127],[0,127],[40,88],[0,127],[0,127]],fe=[36,37,48,49,52,53],te=[20,21,22,23,24,25,26,28,29,30,31,36,37,48,49,52,53,64,65],Ve={26:127,29:0,30:0,31:0,52:12,53:54},K=[0,1,2,4,5,6,7,8,10,11,32,38,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,84,91,92,93,94,95,98,99,100,101,128,12,13,16,17,18,19,14,15,20,21,26,28,22,80,81,82,83,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157],vt=[2,4,12,13,14,15,16,17,18,19,20,21,80,81,83,136,130,131,132,133,134,135,137,138,139,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157],Et=[33,102,99,32,100,8,9,10],Ne=[0,16,25,40,32,64,24,48],w={};P.forEach((e,t)=>{w[e]=t});var v={length:K.length};K.forEach((e,t)=>{v[e]=t});var O={length:te.length};te.forEach((e,t)=>{O[e]=t});var wt={};mt.forEach((e,t)=>{wt[e]=t});var Ct=function(e){let t=[],i=0;return e?.forEach(function(o,f){o==247?t.push(e.subarray(i,f)):o==240&&(i=f+1)}),t.length||t.push(e.subarray(0)),T()&&console.debug(t),t};var he=8,b={port:he,ch:he<<4,chShift:Math.ceil(Math.log2(he))+4,cc:K.length,nn:128,pl:512,tr:256,cmt:14,rpn:6,rpnt:4,nrpn:fe.length,ace:8,drm:8,dpn:te.length,dnc:128,ext:3,efx:7,cvn:12,redir:32,vxPrim:3,invalidCh:255};b.chcc=b.cc*b.ch;var U={bank0:128},S=new Uint16Array(b.ch),ee=new Uint16Array(b.ch),kt=new Uint16Array(b.ch),$t=new Uint16Array(b.ch),Xe=new Uint16Array(b.ch),He=new Array(b.drm);for(let e=0;e<b.ch;e++)S[e]=e*b.cc,ee[e]=e*b.rpn,kt[e]=e*b.nrpn,$t[e]=e*b.ace,Xe[e]=e*b.ext;for(let e=0;e<b.drm;e++){He[e]=new Uint16Array(b.dpn);let t=e*b.dpn*b.dnc;for(let i=0;i<b.dpn;i++)He[e][i]=t+i*b.dnc}var Ge=class extends j{NOTE_IDLE=0;NOTE_ATTACK=1;NOTE_DECAY=2;NOTE_SUSTAIN=3;NOTE_HELD=4;NOTE_RELEASE=5;NOTE_SOSTENUTO_ATTACK=8;NOTE_SOSTENUTO_DECAY=9;NOTE_SOSTENUTO_SUSTAIN=10;NOTE_SOSTENUTO_HELD=11;CH_MELODIC=0;CH_DRUMS=1;CH_DRUM1=2;CH_DRUM2=3;CH_DRUM3=4;CH_DRUM4=5;CH_DRUM5=6;CH_DRUM6=7;CH_DRUM7=8;CH_DRUM8=9;DUMP_ALL=0;DUMP_ONCE=1;DUMP_MODE=2;EXT_NONE=0;EXT_VL=1;EXT_DX=3;VLBC_BRTHEXPR=1;VLBC_VELOINIT=2;VLBC_VELOALL=3;CH_INACTIVE=0;CH_ACTIVE=1;CH_DISABLED=2;#a=0;#f=0;#E=0;#T=new Array(11);get#w(){return this.#T[this.#f]}set#w(e){this.#T[this.#f]=e}#d=new Uint8Array(b.ch);#u=new Uint8Array(b.ch);#i=new Uint8Array(b.ch);#e=new Uint8Array(b.chcc<<1);#p=new Uint8Array(b.ch*b.ace);#r=new Uint8Array(b.ch*b.vxPrim);#g=new Uint8Array(b.ch*b.nn);#m=new Uint8Array(b.ch);#o=new Uint16Array(b.pl);#b=new Uint8Array(b.pl);#C=new Int16Array(b.ch);#L=new Uint8Array(b.ch);#q=new Uint8Array(b.ch);#x=new Uint8Array(b.ch*b.ext);#s=new Uint8Array(b.ch*b.rpn);#c=new Uint8Array(b.ch*b.rpnt);#Y=new Int8Array(b.ch*fe.length);#R=new Uint8Array(b.drm*b.dpn*b.dnc);#B=new Uint8Array(b.drm*2);#M=new Uint8Array(b.efx*3);#Q=new Uint8Array(b.ch);#X=new Uint8Array(b.ch*b.redir);#k=new Uint8Array(b.port);#U=new Uint8Array(b.ch);#l=new Uint8Array(b.ch);#Z=new Uint8Array(b.ch*b.cvn);#G=new Uint8Array(128);#D=new Uint8Array(b.cmt*8);#V=new Uint8Array(1024);#$=new Uint8Array(b.cmt*64);#v={};modelEx={sc:{showBar:!0,invBar:!1,invDisp:!1,peakHold:1}};#t;#S;#h;#n=100;#A=0;#J=500;#_=0;#K="";#z=0;#ae=0;#re=0;#O=!0;#y=!1;#se=1;#j;#W=new Array(b.ch);#N=[];#te=new Uint8Array(b.ch);#ie=new Uint8Array(b.tr);baseBank=new ne("gm2","ns5r","xg","gs","sd","gmega","plg-vl","plg-pf","plg-dx","plg-an","plg-dr","plg-sg","kross","s90es");userBank=new ne("gm");initOnReset=!1;aiEfxName="";chRedir(e,t,i){let o=this;if(o.#ie[t])return(o.#ie[t]-1)*16+e;if(o.#a==w.sc||o.#a==w.sd){if(i==1)return e;let f=0,p=!0;for(;p;)o.#te[e+f]==0?(o.#te[e+f]=t,console.debug(`Assign track ${t} to channel ${e+f+1}.`),p=!1):this.#te[e+f]==t?p=!1:(f+=16,f>=128&&(f=0,p=!1));return e+f}else return e}getTrackPort(e){return this.chRedir(0,e,!0)>>4}forceVoiceRefresh(){for(let e=0;e<b.ch;e++)this.#d[e]&&this.dispatchEvent("voice",{part:e})}#I=[];#ne;#P={nOff:(e,t)=>{let i=e*128+t,o=this.#o.lastIndexOf(i);if(o>-1)if(this.getChCc(e,64)>>6)this.#b[o]=this.NOTE_HELD,this.dispatchEvent("note",{part:e,note:t,velo:this.#g[i],state:this.NOTE_HELD});else if(this.getChCc(e,66)>>6&&this.#b[o]==this.NOTE_SOSTENUTO_SUSTAIN)this.#b[o]=this.NOTE_SOSTENUTO_HELD,this.dispatchEvent("note",{part:e,note:t,velo:this.#g[i],state:this.NOTE_SOSTENUTO_HELD});else{this.#o[o]=0,this.#g[i]=0,this.#b[o]=this.NOTE_IDLE;let f=this.getExt(e)[1];(f==this.VLBC_VELOINIT||f==this.VLBC_VELOALL)&&this.setChCc(e,129,0),this.dispatchEvent("note",{part:e,note:t,velo:0,state:this.NOTE_IDLE})}},nOn:(e,t,i)=>{let o=e*128+t,f=0;for(this.#m[e]&&this.#P.ano(e);this.#b[f]>0&&this.#o[f]!=o;)f++;if(f<b.pl){this.#o[f]=o,this.#g[o]=i,this.#b[f]=this.NOTE_SUSTAIN,this.#L[e]<i&&(this.#L[e]=i);let p=this.getExt(e)[1];(p==this.VLBC_VELOINIT||p==this.VLBC_VELOALL)&&this.setChCc(e,129,i),this.dispatchEvent("note",{part:e,note:t,velo:i,state:this.NOTE_SUSTAIN})}else console.error("Polyphony exceeded.")},nAt:(e,t,i)=>{},cAt:(e,t)=>{},hoOf:e=>{this.#b.forEach((t,i)=>{if(t==this.NOTE_HELD){let o=this.#o[i],f=o>>7;e==f&&(this.#b[i]=this.NOTE_IDLE,this.#o[i]=0,this.#g[o]=0,this.dispatchEvent("note",{part:e,note:o&127,velo:0,state:this.NOTE_IDLE}))}})},soOn:e=>{this.#b.forEach((t,i)=>{let o;switch(t){case this.NOTE_ATTACK:{o=this.NOTE_SOSTENUTO_ATTACK;break}case this.NOTE_DECAY:{o=this.NOTE_SOSTENUTO_DECAY;break}case this.NOTE_SUSTAIN:{o=this.NOTE_SOSTENUTO_SUSTAIN;break}}if(o){this.#b[i]=o;let f=this.#o[i];this.dispatchEvent("note",{part:e,note:f&127,velo:this.#g[f],state:o})}})},soOf:e=>{this.#b.forEach((t,i)=>{if(t==this.NOTE_SOSTENUTO_HELD){let o=this.#o[i],f=o>>7;e==f&&(this.#b[i]=this.NOTE_IDLE,this.#o[i]=0,this.#g[o]=0,this.dispatchEvent("note",{part:e,note:o&127,velo:0,state:this.NOTE_IDLE}))}})},ano:e=>{this.#o.forEach((t,i,o)=>{let f=t>>7,p=t&127;t==0&&this.#g[0]==0||f==e&&this.#P.nOff(f,p)})}};#fe={8:function(e){let t=e.channel,i=e.data[0];this.#P.nOff(t,i)},9:function(e){let t=e.channel,i=this;if(i.getChModeId(t)==w.xg&&i.#i[t]>1){let p=i.getChDrumFirstWrite(t);p[0]&&p[1]!=b.invalidCh&&!i.#d[t]&&(i.copyChSetup(p[1],t),i.dispatchEvent("voice",{part:t}),console.debug(`Part CH${t+1} copied from CH${p[1]}.`))}i.setChActive(t,1);let o=e.data[0],f=e.data[1];f>0?i.#P.nOn(t,o,f):i.#P.nOff(t,o)},10:function(e){let t=e.channel,i=t*128+e.data[0];this.#o.indexOf(i)>-1&&(this.#g[i]=data[1],this.getExt(t)[1]==this.VLBC_VELOALL&&this.setChCc(t,129,data[1]),this.dispatchEvent("note",{part:t,note:e.data[0],velo:e.data[1],state:this.NOTE_SUSTAIN}))},11:function(e){let t=e.channel,i=this,o=this.#W[t],f=o[e.data[0]];f&&(e.data[0]=f),[0,32].indexOf(e.data[0])>-1&&(()=>{switch(this.#a){case w.s90es:case w.motif:{if(e.data[0]==0){[0,63].indexOf(e.data[1])>-1&&this.setChActive(t,1);break}e.data[1]&&this.setChActive(t,1);break}default:{this.setChActive(t,1);break}}})();let p=t*b.ext,m=this.getChModeId(t);switch(e.data[0]){case 96:return;case 97:return;case 120:return;case 121:{this.#P.ano(t),this.#C[t]=0,i.resetChCc(t,1,0),i.resetChCc(t,5,0),i.resetChCc(t,64,0),i.resetChCc(t,65,0),i.resetChCc(t,66,0),i.resetChCc(t,67,0),i.resetChCc(t,11,127),i.resetChCc(t,101,127),i.resetChCc(t,100,127),i.resetChCc(t,99,127),i.resetChCc(t,98,127);return}case 123:{this.#P.ano(t);return}case 124:{this.#P.ano(t);return}case 125:{this.#P.ano(t);return}case 126:{this.#m[t]=1,this.#P.ano(t);return}case 127:{this.#m[t]=0,this.#P.ano(t);return}}if(v[e.data[0]]==null)console.warn(`cc${e.data[0]} is not accepted.`);else{switch(vt.indexOf(e.data[0])>-1&&this.allocateAce(t,e.data[0]),e.data[0]){case 0:{switch(T()&&console.debug(`${P[this.#a]}, CH${t+1}: ${e.data[1]}`),this.#a==0?e.data[1]<48?(this.#i[t]>0&&(e.data[1]=this.getChPrimitive(t,1,!1),e.data[1]=120,console.debug(`Forced channel ${t+1} to stay drums.`)),e.data[1]>0&&(console.debug(`Roland GS detected with MSB: ${e.data[1]}`),this.switchMode("gs"))):e.data[1]==56?this.switchMode(this.#t.x5==82?"x5d":"05rw"):e.data[1]==62?this.switchMode(this.#t.x5==82?"x5d":"05rw"):e.data[1]==63?this.switchMode(P[this.#t.ds]):(e.data[1]==64||e.data[1]==127)&&this.switchMode("xg"):this.#a==w.gs||this.#a==w.sc?e.data[1]<56&&this.#i[t]>0&&(e.data[1]=this.getChPrimitive(t,1,!1),e.data[1]=120,console.debug(`Forced channel ${t+1} to stay drums.`)):this.#a==w.gm&&(e.data[1]<48?this.#i[t]>0&&(e.data[1]=120,this.switchMode("gs",!0),console.debug(`Forced channel ${t+1} to stay drums.`)):(e.data[1]==64||e.data[1]==127)&&this.switchMode("xg",!0)),this.#a){case w.xg:{[79,95,126,127].indexOf(e.data[1])>-1?this.#i[t]==0&&(this.setChType(t,this.CH_DRUM2),console.debug(`CH${t+1} set to drums by MSB.`)):this.#i[t]>0&&(this.setChType(t,this.CH_MELODIC),console.debug(`CH${t+1} set to melodic by MSB.`)),[33,81,97].indexOf(e.data[1])>-1?this.#x[p]=this.EXT_VL:[35,67,83,99].indexOf(e.data[1])>-1?this.#x[p]=this.EXT_DX:this.#x[p]=this.EXT_NONE;break}case w["05rw"]:case w.x5d:case w.ns5r:{[61,62,126,127].indexOf(e.data[1])>-1?this.#i[t]==this.CH_MELODIC&&(this.setChType(t,this.CH_DRUM2),console.debug(`CH${t+1} set to drums by MSB.`)):[80,81,82,83].indexOf(e.data[1])>-1||this.#i[t]!=this.CH_MELODIC&&(this.setChType(t,this.CH_MELODIC),console.debug(`CH${t+1} set to melodic by MSB.`));break}case w.sd:{[104,105,106,107].indexOf(e.data[1])>-1?this.#i[t]==0&&(this.setChType(t,this.CH_DRUM2),console.debug(`CH${t+1} set to drums by MSB.`)):this.#i[t]>0&&(this.setChType(t,this.CH_MELODIC),console.debug(`CH${t+1} set to melodic by MSB.`));break}case w.g2:{e.data[1]==120?this.#i[t]==0&&(this.setChType(t,this.CH_DRUMS),console.debug(`CH${t+1} set to drums by MSB.`)):this.#i[t]>0&&(this.setChType(t,this.CH_MELODIC),console.debug(`CH${t+1} set to melodic by MSB.`));break}}break}case 2:{this.getExt(t)[1]==this.VLBC_BRTHEXPR&&this.setChCc(t,129,e.data[1]);break}case 6:{if(this.#q[t]){[w.xg,w.gs,w.sc,w.ns5r].indexOf(this.#a)<0&&console.warn(`NRPN commits are not available under "${P[this.#a]}" mode, even when they are supported in Octavia.`);let y=this.getChCc(t,99),r=this.getChCc(t,98);if(y==1){let l=Et.indexOf(r);if(l>-1)this.setChCc(t,71+l,e.data[1]),T()&&console.debug(`Redirected NRPN 1 ${r} to cc${71+l}.`),this.dispatchEvent("cc",{part:t,cc:71+l,data:e.data[1]});else{let u=fe.indexOf(r);u>-1?this.#Y[t*10+u]=e.data[1]-64:console.warn(`NRPN 0x01${r.toString(16).padStart(2,"0")} is not supported.`),T()&&console.debug(`CH${t+1} voice NRPN ${r} commit`)}}else{if(te.indexOf(y)<0){let u=`NRPN 0x${y.toString(16).padStart(2,"0")}${r.toString(16).padStart(2,"0")} `;y==127?console.warn(`${u}is not necessary. Consider removing it.`):console.warn(`${u}is not supported.`)}else{let u=this.#i[t]-2;u<0?console.warn(`CH${t+1} cannot accept drum NRPN as type ${Q[this.#i[t]]}.`):this.#R[(u*b.dpn+O[y])*b.dnc+r]=e.data[1]}T()&&console.debug(`CH${t+1} (${Q[this.#i[t]]}) drum NRPN ${y} commit`)}}else{let y=Ie[this.getChCc(t,100)],r=Be[this.getChCc(t,100)];if(this.getChCc(t,101)==0&&y!=null)switch(T()&&console.debug(`CH${t+1} RPN 0 ${this.getChCc(t,100)} commit: ${e.data[1]}`),e.data[1]=Math.min(Math.max(e.data[1],Ue[y][0]),Ue[y][1]),this.#s[t*b.rpn+y]=e.data[1],this.#c[t*b.rpnt+r]=1,m){case w.xg:case w.gs:case w.sc:case w.mt32:case w.s90es:case w.motif:{switch(this.getChCc(t,100)){case 1:case 2:{this.dispatchEvent("pitch",{part:t,pitch:this.getPitchShift(t)});break}}break}default:this.dispatchEvent("pitch",{part:t,pitch:this.getPitchShift(t)})}}break}case 32:{switch(T()&&console.debug(`${P[this.#a]}, CH${t+1} LSB: ${e.data[1]}`),this.#a){case w.s90es:case w.motif:{this.setChType(t,[32,40].indexOf(e.data[1])>-1?this.CH_DRUMS:this.CH_MELODIC,this.#a,!0);break}}this.getExt(t)[0]==this.EXT_DX;break}case 38:{if(!this.#q[t]){let y=Ie[this.getChCc(t,100)],r=Be[this.getChCc(t,100)];this.getChCc(t,101)==0&&y!=null&&(this.#s[t*b.rpn+y+1]=e.data[1],this.#c[t*b.rpnt+r]=1)}break}case 64:{e.data[1]<64&&this.#P.hoOf(t);break}case 66:{e.data[1]>>6?this.#P.soOn(t):this.#P.soOf(t);break}case 98:case 99:{this.#q[t]=1;break}case 100:case 101:{this.#q[t]=0;break}}this.setChCc(t,e.data[0],e.data[1]),this.dispatchEvent("cc",{part:t,cc:e.data[0],data:e.data[1]})}i.getChModeId(t)==w.xg&&i.#i[t]&&i.setDrumFirstWrite(t)},12:function(e){let t=e.channel,i=this;switch(i.#a){case w.s90es:case w.motif:{e.data&&i.setChActive(t,1);break}default:i.setChActive(t,1)}let o=S[t];switch(i.getExt(t)[0]){case i.EXT_VL:break}i.#r[t]=e.data,i.#l[t]=0,i.pushChPrimitives(t),T()&&console.debug(`T:${e.track} C:${t} P:${e.data}`),i.dispatchEvent("voice",{part:t}),i.getChModeId(t)==w.xg&&i.#i[t]&&i.setDrumFirstWrite(t)},13:function(e){let t=this,i=e.channel;this.#o.forEach(function(o){let f=o>>7;i==f&&(t.#g[o]=e.data,t.dispatchEvent("note",{part:i,note:o&127,velo:e.data,state:t.NOTE_SUSTAIN}))})},14:function(e){let t=e.channel;this.#C[t]=e.data[1]*128+e.data[0]-8192,this.dispatchEvent("pitch",{part:t,pitch:this.getPitchShift(t)})},15:function(e){Ct(e.data).forEach(t=>{let i=t[0],o=t[1];(this.#ue[i]||function(){console.debug(`Unknown manufacturer ${i}.`)})(o,t.subarray(2),e.track)})},248:function(e){},250:function(e){},251:function(e){},252:function(e){},254:function(e){},255:function(e){(this.#I[e.meta]||function(i,o,f){}).call(this,e.data,e.track,e.meta),e.meta!=32&&(this.#A=0);let t=yt.indexOf(e.meta)>-1;if(T()&&console.debug(e),t)return e.reply="meta",e}};#ue={64:(e,t,i)=>{this.#le.run(t,i,e)},65:(e,t,i)=>{if(t[0]<16)if(t[1]==72){let o=t[t.length-1],f=F(t.subarray(3,t.length-1));o==f?this.#F.run(t.subarray(0,t.length-1),i,e):console.warn(`Bad SD checksum ${o} - should be ${f}.`)}else this.#F.run(t,i,e);else{let o=t[t.length-1],f=F(t.subarray(2,t.length-1));o==f?this.#F.run(t.subarray(0,t.length-1),i,e):console.warn(`Bad GS checksum ${o} - should be ${f}.`)}},66:(e,t,i)=>{this.#ee.run(t,i,e)},67:(e,t,i)=>{this.#H.run(t,i,e)},68:(e,t,i)=>{this.#he.run(t,i,e)},71:(e,t,i)=>{this.#de.run(t,i,e)},126:(e,t,i)=>{this.#ce.run(t,i,e)},127:(e,t,i)=>{this.switchMode("gm"),this.#oe.run(t,i,e)}};#ce;#oe;#H;#F;#ee;#le;#de;#he;buildRchTree(){let e=[];this.#u.forEach((t,i)=>{t<b.ch&&(e[t]?.constructor||(e[t]=[]),e[t].push(i))}),this.#j=e}buildRccMap(){let e=this;for(let t=0;t<b.ch;t++)e.#W[t]={};e.#X.forEach((t,i)=>{t&&(e.#W[Math.floor(i/b.redir)][t]=i%b.redir|128)}),T()&&console.debug(e.#W)}getActive(){return this.#d}getChActive(e){return this.#d[e]}getCc(e){if(typeof e!="number"||e<0||e>=b.ch)throw new RangeError(`Invalid part number: CH${e+1}`);let t=this,i=S[e];return t.#e.subarray(i,i+b.cc)}getChCc(e,t){let i=this;if(K.indexOf(t)<0)throw new Error("CC number not accepted");return i.#e[S[e]+v[t]]}setChCc(e=0,t,i){let o=this;if(K.indexOf(t)<0)throw new Error("CC number not accepted");if(i?.constructor!=Number)throw new TypeError("Expected numbers for value");let f=i&255,p=S[e]+v[t];o.#e[p]=f,o.#e[p+b.chcc]=1,o.dispatchEvent("cc",{part:e,cc:t,data:f})}getCcAll(){return this.#e.slice()}resetCc(e){}resetChCc(e,t,i){let o=this;i?.constructor&&o.setChCc(e,t,i),o.#e[S[e]+v[t]+b.chcc]=0}resetCcAll(){}isChCcWritten(e,t){if(K.indexOf(t)<0)throw new Error("CC number not accepted");return upThis.#e[S[e]+v[t]+b.chcc]}getChSource(){return this.#u}getChType(){return this.#i}setChType(e,t,i=0,o=!1){t&=15;let f=this;i=i||f.getChModeId(e),f.#i[e]=t,t>0&&!o&&(f.setChCc(e,0,f.#v[i][2]),f.pushChPrimitives(e))}setChActive(e,t=0){this.#d[e]!=t&&this.dispatchEvent("channeltoggle",{part:e,active:t}),this.#d[e]=t}getExt(e){let t=b.ext*e,i=this.#x.subarray(t,t+b.ext),o=new Uint8Array(i.length);return o.set(i),o[1]=o[1]||this.#se,o}getPitch(){return this.#C}getProgram(){return this.#r}getTexts(){return this.#N.slice()}getVel(e){let t=new Map,i=this;return i.#o.forEach(function(o,f){let p=o>>7,m=o&127;e==p&&i.#g[o]>0&&t.set(m,{v:i.#g[o],s:i.#b[f]})}),t}getBitmap(){return{bitmap:this.#w,expire:this.#E}}getLetter(){return{text:this.#K,set:this.#ae,expire:this.#z}}getMode(){return P[this.#a]}getMaster(){return{volume:this.#n}}getRawStrength(){let e=this;return this.#o.forEach(function(t){let i=t>>7;e.#g[t]>e.#L[i]&&(e.#L[i]=e.#g[t])}),this.#L}getStrength(){let e=[],t=this;return this.getRawStrength().forEach(function(i,o){e[o]=Math.floor(i*t.getChCc(o,7)*t.getChCc(o,11)*t.#n/803288)}),e}getRpn(){return this.#s}getNrpn(){return this.#Y}getSubDb(){return self?.structuredClone(this.#v)}getDetect(){return self?.structuredClone(this.#t)}getVoice(e,t,i,o="?"){let f=this;w[o]?.constructor||(o="?");let p=w[o],m=e||f.#v[p][0],y=t,r=i||f.#v[p][1];m==U.bank0&&(m=0),r==U.bank0&&(r=0),o=="ns5r"&&m>0&&m<56&&(r=3);let l=f.userBank.get(m,y,r,o);if(o=="mt32"&&l.name.indexOf("MT-m:")==0){let u=parseInt(l.name.slice(5)),a=u*b.cmt,s="";f.#$.subarray(a,a+10).forEach(c=>{c>31&&(s+=String.fromCharCode(c))});let n=`MSB	LSB	PRG	NME
49	127	${y}	${s}`;f.userBank.load(n,!0),l.name=s,l.ending=" "}return(l.ending!=" "||!l.name.length)&&(l=f.baseBank.get(m,y,r,o)),l}getChPrimitive(e,t,i){if(t>=b.vxPrim||t?.constructor!=Number)throw new RangeError(`Invalid voice primitive component "${t}"`);if(typeof e!="number"||e<0||e>=b.ch)throw new RangeError(`Invalid part number: CH${e+1}`);let o=this,f=o.#r[t<<b.chShift|e];switch(t){case 1:case 2:{i&&(f=f||o.#v[o.getChModeId(e)][t-1]),f==U.bank0&&(f=0);break}}return f}getChPrimitives(e,t){let i=this,o=new Uint8Array(3);return o[1]=i.#r[e],o[0]=i.getChPrimitive(e,1,t),o[2]=i.getChPrimitive(e,2,t),o}pushChPrimitives(e){let t=this;t.#r[1<<b.chShift|e]=t.getChCc(e,0),t.#r[2<<b.chShift|e]=t.getChCc(e,32),t.dispatchEvent("voice",{part:e})}getChVoice(e){let t=this,i=t.getVoice(...t.getChPrimitives(e),t.getChMode(e));if(t.#l[e]){let o="";switch(t.#a){case w.mt32:{t.#D.subarray(b.cmt*(e-1),b.cmt*(e-1)+10).forEach(f=>{o+=String.fromCharCode(Math.max(f,32))}),o=o.trimRight();break}default:{let f=b.cvn*e;t.#Z.subarray(f,f+b.cvn).forEach(p=>{o+=String.fromCharCode(Math.max(p,32))}),o=o.trimRight()}}o.length&&(i.ending="~",i.name=o)}return i}getRawPitch(){return this.#C}getPitchShift(e){let t=this,i=e*b.rpn,o=t.#s[i];return t.#c[e*b.rpnt]||t.#a==w.mt32&&(o=12),t.#C[e]/8192*o+(t.#s[i+3]-64)+((t.#s[i+1]<<7)+t.#s[i+2]-8192)/8192}getEffectType(e=0){let t=3*e+1;return this.#M.subarray(t,t+2)}setEffectTypeRaw(e=0,t,i){let o=3*e;this.#M[o]=1,this.#M[o+1+ +t]=i}setEffectType(e=0,t,i){this.setEffectTypeRaw(e,!1,t),this.setEffectTypeRaw(e,!0,i)}getEffectSink(){return this.#Q}setLetterDisplay(e,t,i=0,o=3200){let f=this,p;f.#K=" ".repeat(i),e.forEach(m=>{f.#K+=String.fromCharCode(m>31?m:32),m<32&&(p=p||new Set,p.add(m))}),f.#ae=Date.now(),f.#z=Date.now()+o,f.dispatchEvent("letter"),p&&(p=Array.from(p),p.forEach((m,y,r)=>{r[y]=m.toString(16).padStart(2,"0")}),console.warn(`${t}${t?" ":""}invalid code point${p.length>1?"s":""}: 0x${p.join(", 0x")}`))}setDetectionTargets(e="?",t=0){let i=this,o=-1;switch(e.replaceAll(", ",",").split(",").forEach(f=>{f=f.toLowerCase();let p=P.indexOf(gt[f]||f);T()&&console.debug(`Mapped mode "${f}" to ID "${p}".`),p>-1&&(o=p)}),T()&&console.debug(`Set detection target to ID "${o}".`),o>0&&(i.#t.x5=82,i.#t.ds=w.krs),o){case w["05rw"]:{i.#t.x5=81;break}case w.s90es:i.#t.ds=w.s90es,i.#t.smotif=w.s90es;case w.motif:i.#t.ds=w.motif,i.#t.smotif=w.motif}}setGsTargets(e=!1,t=4){if(!t)t=e?3:4;else{if(t>4||t<0)throw new Error(`Invalid GS level ${t}`);if(e&&t>>1!=1)throw new Error(`Invalid SC level ${t}`)}let i=this;i.#t[e?"sc":"gs"]=t,i.#v[w[e?"sc":"gs"]][1]=t,i.forceVoiceRefresh()}getConfigs(){return this.#h}setDumpLimit(e){if(e>2||e<0)throw new RangeError("Invalid dump limit.");this.#S.dumpLimit=e}allocateAce(e=0,t){let i=this;if(!t||t<128&&t>95){console.warn(`cc${t} cannot be allocated as an active custom effect.`);return}let o=!0,f=0,p=b.ace*e;for(;o&&f<b.ace;)i.#p[f+p]==t?o=!1:i.#p[f+p]||(o=!1,i.#p[f+p]=t,console.info(`Allocated cc${t} to ACE slot ${f} in CH${e+1}.`)),f++;f>=b.ace&&console.warn(`ACE slots are full in CH${e+1}.`)}allocateAceAll(e){let t=this;if(!e||e<128&&e>95){console.warn(`cc${e} cannot be allocated as an active custom effect.`);return}for(let i=0;i<b.ch;i++){let o=!0,f=0,p=b.ace*i;for(;o&&f<b.ace;)t.#p[f+p]==e?o=!1:t.#p[f+p]||(o=!1,t.#p[f+p]=e),f++;f>=b.ace&&console.warn(`ACE slots are full in CH${i+1}.`)}}releaseAce(e=0,t){let i=!0,o=b.ace*e,f=o+b.ace;for(;i&&o<f;)this.#p[o]==t&&(this.#p[o]=0,i=!1),o++;i&&T()&&console.debug(`No ACE slot was allocated to cc${t} in CH${e+1}.`)}resetAce(){this.#p.fill(0),console.info("All ACE slots have been reset.")}getAce(){return this.#p}getChAce(e=0,t=0){if(t<0||t>=b.ace)throw new RangeError("No such ACE slot");let i=this.#p[b.ace*e+t];if(i){if(K.indexOf(i)>=0)return this.getChCc(e,i);throw new Error(`Invalid ACE source in CH${e+1}: ${i}`)}else return 0}initDrums(){let e=this;e.#R.fill(64);for(let t=0;t<b.drm;t++){let i=t*b.dpn;for(let o in Ve){let f=Ve[o],p=(i+O[o])*b.dnc;e.#R.subarray(p,p+b.dnc).fill(f)}}}init(e=0){let t=this;t.#A=0,t.#v[w.xg][1]=0,t.dispatchEvent("banklevel",{mode:"xg",data:0}),t.#d.fill(0),t.#e.fill(0),t.#p.fill(0),t.#r.fill(0),t.#g.fill(0),t.#o.fill(0),t.#m.fill(0),t.#L.fill(0),t.#C.fill(0),t.#Y.fill(0),t.#c.fill(0),t.#x.fill(0),t.#k.fill(0),t.#U.fill(0),t.#X.fill(0),t.#n=100,t.#N=[],t.#J=500,t.#_=0,t.#E=0,t.#f=0,t.#w.fill(0),t.#y=!1,t.#re=0,t.#O=!0,t.initDrums(),t.#u.forEach(function(i,o,f){f[o]=o}),e==0&&(t.dispatchEvent("mode","?"),t.#a=0,t.#te.fill(0),t.#ie.fill(0),t.#z=0,t.#K=""),bt.forEach(i=>{t.setChCc(i,0,t.#v[t.getChModeId(i)][2])}),t.#i.fill(t.CH_MELODIC),t.#i[9]=t.CH_DRUM1,t.#i[25]=t.CH_DRUM3,t.#i[41]=t.CH_DRUMS,t.#i[57]=t.CH_DRUMS,t.#i[73]=t.CH_DRUM5,t.#i[89]=t.CH_DRUM7,t.#i[105]=t.CH_DRUMS,t.#i[121]=t.CH_DRUMS;for(let i=0;i<b.drm;i++)t.#B[i<<1]=0,t.#B[i<<1|1]=b.invalidCh;t.#V.fill(0),t.#$.fill(0),t.#G.fill(0),t.#D.fill(0),t.#l.fill(0),t.#M.fill(0),t.#Q.fill(0),t.aiEfxName="",t.userBank.clearRange({msb:0,lsb:127,prg:[0,127]}),t.modelEx.sc.showBar=!0,t.modelEx.sc.invBar=!1,t.modelEx.sc.invDisp=!1,t.modelEx.sc.peakHold=1;for(let i=0;i<b.ch;i++){let o=S[i];t.#e[o+v[7]]=100,t.#e[o+v[11]]=127,t.#e[o+v[2]]=127,t.#e[o+v[10]]=64,t.#e.subarray(o+v[71],o+v[71]+8).fill(64),t.#e[o+v[128]]=127,t.#e.subarray(o+v[130],o+v[157]+1).fill(64),t.#e[o+v[91]]=40,t.#e[o+v[101]]=127,t.#e[o+v[100]]=127,t.#e[o+v[99]]=127,t.#e[o+v[98]]=127;let f=i*b.rpn;t.#s[f]=2,t.#s[f+1]=64,t.#s[f+2]=0,t.#s[f+3]=64,t.#s[f+4]=0,t.#s[f+5]=0;let p=i*b.ext;t.#x[p+1]=t.VLBC_BRTHEXPR;let m=i*b.redir;t.#X[m+8]=13}t.buildRchTree(),t.buildRccMap(),t.dispatchEvent("mastervolume",t.#n),t.dispatchEvent("efxreverb",t.getEffectType(0)),t.dispatchEvent("efxchorus",t.getEffectType(1)),t.dispatchEvent("efxdelay",t.getEffectType(2)),t.dispatchEvent("efxinsert0",t.getEffectType(3)),t.dispatchEvent("efxinsert1",t.getEffectType(4)),t.dispatchEvent("efxinsert2",t.getEffectType(5)),t.dispatchEvent("efxinsert3",t.getEffectType(6)),t.dispatchEvent("reset"),t.switchMode("?")}setChMode(e,t){let i=this;if(typeof e!="number"||e<0||e>=b.ch)throw new RangeError(`Invalid part number: CH${e+1}`);if(port<0||t>=P.length)throw new RangeError(`Invalid mode ID ${t}`);i.#U[e]=t,i.dispatchEvent("chmode",{part:e,id:t,mode:P[t]}),i.dispatchEvent("voice",{part:e})}getChMode(e,t){return P[this.getChModeId(e,t)]}getChModeId(e,t){return t?this.#U[e]||this.#k[e>>4]:this.#U[e]||this.#k[e>>4]||this.#a}setPortMode(e,t,i){let o=this;if(e<0||e>=b.ch>>4)throw new RangeError(`Invalid port ${e+1}`);if(t<1)throw new RangeError("Range must be a positive integer");if(e+t>=b.ch>>4)throw new RangeError("Range must be in bound");if(e<0||i>=P.length)throw new RangeError(`Invalid mode ID ${i}`);for(let f=e;f<e+t;f++){o.#k[f]=i;for(let p=f<<4;p<f+1<<4;p++)o.dispatchEvent("chmode",{part:p,id:i,mode:P[i]}),o.dispatchEvent("voice",{part:p})}}copyChSetup(e,t,i){if(e==t){console.warn(`Failed attempt at overwriting CH${e+1} with its own data.`);return}let o=this;if(i&&o.#d[t]){console.warn(`Failed attempt at copying setup data from CH${e+1} to CH${t+1}.`);return}let f=S[e],p=S[t];o.#r[t]=o.#r[e],o.#e.set(o.#e.subarray(f,f+b.cc),p),o.pushChPrimitives(t)}setDrumFirstWrite(e,t){let i=this,o=i.#i[e];if(o<2)return;let f=o-2;if(i.#B[f<<1])if(t)i.#B[f<<1]=0,T()&&console.debug(`First write part for drum set ${f+1} has been reset.`);else return;else t?console.warn(`First write part for drum set ${f+1} is already blank.`):(i.#B[f<<1]=1,i.#B[f<<1|1]=e,console.debug(`First write part for drum set ${f+1} is set to CH${e+1}.`))}getChDrumFirstWrite(e){let t=this,i=t.#i[e];if(i<2)return;let o=i-2;return t.#B.subarray(o<<1,o+1<<1)}getDrumFirstWrite(e){if(e>=0&&e<b.drm)return this.#B.subarray(e<<1,e+1<<1)}switchMode(e,t=!1,i=!1){let o=this,f=w[e];if(f>-1){if(o.#a==0||t){o.initOnReset&&t&&this.init(1),o.#a=f,o.#f=0;for(let m=0;m<b.ch;m++){let y=o.getChModeId(m,!0);o.#i[m]>0&&y==w["?"]&&(o.setChCc(m,0,o.#v[f][2]),T()&&console.debug(`CH${m+1} (${o.#i[m]}) (${o.getChMode(m)}), ${P[y]} (${o.#v[y][2]}) -> ${P[f]} (${o.#v[f][2]})`),o.pushChPrimitives(m))}switch(f){case w.mt32:{de.forEach((m,y)=>{let r=y+1;o.#d[r]||(o.#r[r]=m,o.setChCc(r,91,127),o.pushChPrimitives(r))});for(let m=1;m<10;m++)o.dispatchEvent("voice",{part:m});break}}let p;switch(f){case w["?"]:case w.g2:{p=[52,4,52,18,0,0,0,0];break}case w.xg:{p=[1,0,65,0,5,0,0,0];break}case w.gm:case w.gs:case w.sc:{p=[40,4,40,18,40,32,32,0];break}case w.sd:{p=[58,0,60,0,61,0,61,0];break}case w["05rw"]:case w.x5d:case w.ns5r:{p=[44,1,44,19,44,0,44,0];break}case w.k11:case w.sg:{p=[24,0,0,0,0,0,0,0];break}case w.mt32:{p=[40,4,0,0,0,0,0,0];break}case w.doc:{p=[24,16,0,0,0,0,0,0];break}case w.motif:case w.s90es:{p=[113,0,117,0,114,0,0,0];break}default:p=[0,0,0,0,0,0,0,0]}for(let m=0;m<b.efx;m++)!o.#M[3*m]&&p[m<<1]?.constructor&&(o.#M[3*m+1]=p[2*m],o.#M[3*m+2]=p[2*m+1],o.dispatchEvent(`efx${["reverb","chorus","delay","insert0"][m]}`,o.getEffectType(m)));i&&o.setDetectionTargets(e),o.dispatchEvent("mode",e),o.forceVoiceRefresh()}}else throw new Error(`Unknown mode ${e}`)}newStrength(){this.#L.fill(0)}runJson(e){if(e.type>14)return e.type==15&&e.data.constructor!=Uint8Array&&(e.data=Uint8Array.from(e.data)),this.#fe[e.type].call(this,e);{let t=this.chRedir(e.part,e.track),i=!1;this.#j[t]?.forEach(o=>{e.channel=o,i=!0,this.#fe[e.type].call(this,e)}),i||console.warn(`${Oe[e.type]?Oe[e.type]:e.type}${[11,12].includes(e.type)?(e.data[0]!=null?e.data[0]:e.data).toString():""} event sent to CH${t+1} without any recipient.`)}this.#N.length>100&&this.#N.splice(100,this.#N.length-99)}runRaw(e){}async loadBank(e,t){let i=this;switch(e=e.toLowerCase(),e){case"s7e":{i.userBank.clearRange({msb:63,lsb:[21,22]}),i.userBank.clearRange({msb:63,lsb:[24,27]});break}case"pcg":{i.userBank.clearRange({msb:63,lsb:[6,9]}),i.userBank.clearRange({msb:63,lsb:[13,16]});break}default:throw new Error(`Unknown bank format ${e}`)}switch(e){case"s7e":case"pcg":{q.context=this,await i.userBank.load(await q.read(e,t),!1);break}}i.forceVoiceRefresh()}constructor(){super();let e=this;e.#w=new Uint8Array(256),e.#T[10]=new Uint8Array(512),e.#ne=new I,e.#t={x5:82,ds:w.krs,smotif:w.s90es,gs:4,sc:3},e.#S={dumpLimit:e.DUMP_MODE},e.#h=new Proxy(e.#S,{set:()=>{}});for(let r in Le){let l=w[r];l==null?console.debug(`SubDB build error: "${r}" does not exist`):e.#v[l]=new Uint8Array(Le[r])}e.userBank.strictMode=!0,e.userBank.load(`MSB	PRG	LSB	NME
062	000	000	
122	000	000	
122	001	000	
122	002	000	
122	003	000	
122	004	000	
122	005	000	
122	006	000	`),e.addEventListener("metacommit",function(r){let{data:l}=r;e.#N[0]?.type==l.type&&e.#N[0]?.amend?(e.#N[0].amend=l.amend,e.#N[0].data+=l.data):e.#N.unshift(l)}),e.#I[1]=function(r){switch(r=r.replaceAll(`\r
`,`
`).replaceAll("\r",`
`),r.slice(0,2)){case"@I":{this.#y=!0,this.dispatchEvent("metacommit",{type:"Kar.Info",data:r.slice(2)?.trimLeft()});break}case"@K":{this.#y=!0,this.dispatchEvent("metacommit",{type:"Kar.Mode",data:r.slice(2)?.trimLeft()}),console.debug(`Karaoke mode active: ${r.slice(2)}`);break}case"@L":{this.#y=!0,this.dispatchEvent("metacommit",{type:"Kar.Lang",data:r.slice(2)?.trimLeft()});break}case"@T":{this.#y=!0,this.dispatchEvent("metacommit",{type:"KarTitle",data:r.slice(2)?.trimLeft()});break}case"@V":{this.#y=!0,this.dispatchEvent("metacommit",{type:"Kar.Ver.",data:r.slice(2)?.trimLeft()});break}case"XF":{let l=r.slice(2).split(":");switch(l[0]){case"hd":{l.slice(1).forEach((u,a)=>{u.length&&this.dispatchEvent("metacommit",{type:["XfSngDte","XfSngRgn","XfSngCat","XfSongBt","XfSngIns","XfSngVoc","XfSngCmp","XfSngLrc","XfSngArr","XfSngPer","XfSngPrg","XfSngTag"][a],data:u})});break}case"ln":{l.slice(1).forEach((u,a)=>{u.length&&this.dispatchEvent("metacommit",{type:["XfKarLng","XfKarNme","XfKarCmp","XfKarLrc","XfKarArr","XfKarPer","XfKarPrg"][a],data:u})});break}default:this.dispatchEvent("metacommit",{type:"XfUnData",data:r})}break}default:this.#y?r[0]=="\\"?(this.dispatchEvent("metacommit",{type:"KarLyric",data:"",amend:!1}),this.dispatchEvent("metacommit",{type:"KarLyric",data:r.slice(1),amend:!0})):r[0]=="/"?(this.dispatchEvent("metacommit",{type:"KarLyric",data:"",mask:!0,amend:!1}),this.dispatchEvent("metacommit",{type:"KarLyric",data:r.slice(1),mask:!0,amend:!0})):this.dispatchEvent("metacommit",{type:"KarLyric",data:r,amend:!0}):r.split(`
`).forEach((l,u)=>{this.dispatchEvent("metacommit",{type:"Cmn.Text",data:l,mask:u!=0})})}},e.#I[2]=function(r){this.dispatchEvent("metacommit",{type:"Copyrite",data:r})},e.#I[3]=function(r,l){l<1&&this.#A<1&&this.dispatchEvent("metacommit",{type:"TrkTitle",data:r})},e.#I[4]=function(r,l){this.dispatchEvent("metacommit",{type:"Instrmnt",data:r})},e.#I[5]=function(r){r.trim()==""?this.dispatchEvent("metacommit",{type:"C.Lyrics",data:"",amend:!1}):this.dispatchEvent("metacommit",{type:"C.Lyrics",data:r,amend:!0})},e.#I[6]=function(r){this.dispatchEvent("metacommit",{type:"C.Marker",data:r})},e.#I[7]=function(r){this.dispatchEvent("metacommit",{type:"CuePoint",data:r})},e.#I[32]=function(r){this.#A=r[0]+1},e.#I[33]=function(r,l){T()&&console.debug(`Track ${l} requests to get assigned to output ${r}.`),e.#ie[l]=r+1},e.#I[81]=function(r,l){e.#J=r/1e3},e.#I[127]=function(r,l){e.#ne.run(r,l)},e.#ne.default=function(r){console.warn(`Unrecognized sequencer-specific byte sequence: ${r}`)},e.#ne.add([67,0,1],function(r,l){T()&&console.debug(`XGworks requests assigning track ${l} to output ${r[0]}.`),e.#ie[l]=r[0]+1}),e.#ce=new I("universal non-realtime"),e.#oe=new I("universal realtime"),e.#H=new I("Yamaha"),e.#F=new I("Roland"),e.#ee=new I("Korg"),e.#le=new I("Kawai"),e.#de=new I("Akai"),e.#he=new I("Casio");let t=new I("DX7+ Dump"),i=function(r){console.info(`Unrecognized SysEx in "${this.name}" set.
%o`,r)};e.#ce.default=i,e.#oe.default=i,e.#H.default=i,e.#F.default=i,e.#ee.default=i,e.#le.default=i,e.#de.default=i,e.#he.default=i,t.default=i,e.#ce.add([9],(r,l,u)=>{e.switchMode(["gm","?","g2"][r[0]-1],!0),e.setPortMode(e.getTrackPort(l),1,w[["gm","?","g2"][r[0]-1]]),e.#y=e.#y||!1,console.info(`MIDI reset: ${["GM","Init","GM2"][r[0]-1]}`),r[0]==2&&e.init()}),e.#oe.add([4,1],(r,l,u)=>{e.dispatchEvent("mupromptex"),e.#n=((r[1]<<7)+r[0])/16383*100,e.dispatchEvent("mastervolume",e.#n)}).add([4,3],(r,l,u)=>((r[1]<<7)+r[0]-8192)/8192).add([4,4],(r,l,u)=>r[1]-64).add([4,5],(r,l,u)=>{e.dispatchEvent("mupromptex");let a=r[0],s=r[1],n=r[2],c=3,d=c+(a<<1),h=d+s;if(a!=1){console.error(`Unsupported GM2 global parameter set: slotpath length too long (${a})!
`,r);return}let g=0,E=0,C=0;switch(r.subarray(c,d).forEach($=>{g=g<<7,g|=$}),r.subarray(d,h).forEach(($,x)=>{E|=$<<x*7}),r.subarray(h).forEach(($,x)=>{C|=$<<x*7}),T()&&console.debug(`GM2 global parameter: (${r.subarray(3,d)}; p: ${E}, v: ${C})`),g){case 129:{E==0&&(e.setEffectType(0,52,C),e.dispatchEvent("efxreverb",e.getEffectType(0)));break}case 130:{E==0&&(e.setEffectType(1,52,C|16),e.dispatchEvent("efxchorus",e.getEffectType(1)));break}default:T()&&console.debug("GM2 global paramater slot path unknown.")}}),this.#H.add([76,0,0],(r,l,u)=>{switch(r[0]){case 125:{e.initDrums(),console.info(`XG drum setup reset: ${r}`);break}case 126:{e.switchMode("xg",!0),e.setPortMode(e.getTrackPort(l),4,w.xg),e.#y=!1,console.info("MIDI reset: XG");break}default:{e.dispatchEvent("mupromptex");let a=[0,0,0,0],s=(n,c)=>{a[c]=n};if(r.subarray(1).forEach((n,c)=>{let d=c+r[0];([s,s,s,s,h=>{this.#n=h*129/16383*100,e.dispatchEvent("mastervolume",e.#n)},h=>{},h=>{}][d]||(()=>{}))(n,c)}),r[0]<4){let n=0;a.forEach(c=>{n=n<<4,n+=c}),n-=1024}}}}).add([76,2,1],(r,l,u)=>{e.dispatchEvent("mupromptex");let a="XG ";r[0]<32?(a+="reverb ",r.subarray(1).forEach((s,n)=>{([c=>{e.setEffectTypeRaw(0,!1,c),console.info(`${a}main type: ${Y[c]}`),e.dispatchEvent("efxreverb",e.getEffectType(0))},c=>{e.setEffectTypeRaw(0,!0,c),console.debug(`${a}sub type: ${c+1}`),e.dispatchEvent("efxreverb",e.getEffectType(0))},c=>{console.debug(`${a}time: ${$e(c)}s`)},c=>{console.debug(`${a}diffusion: ${c}`)},c=>{console.debug(`${a}initial delay: ${c}`)},c=>{console.debug(`${a}HPF cutoff: ${z[c]}Hz`)},c=>{console.debug(`${a}LPF cutoff: ${z[c]}Hz`)},c=>{console.debug(`${a}width: ${c}`)},c=>{console.debug(`${a}height: ${c}`)},c=>{console.debug(`${a}depth: ${c}`)},c=>{console.debug(`${a}wall type: ${c}`)},c=>{console.debug(`${a}dry/wet: ${c}`)},c=>{console.debug(`${a}send: ${L(c)}dB`)},c=>{console.debug(`${a}pan: ${c-64}`)},!1,!1,c=>{console.debug(`${a}delay: ${c}`)},c=>{console.debug(`${a}density: ${c}`)},c=>{console.debug(`${a}balance: ${c}`)},c=>{},c=>{console.debug(`${a}feedback: ${c}`)},c=>{}][r[0]+n]||function(){console.warn(`Unknown XG reverb address: ${r[0]}.`)})(s)})):r[0]<64?(a+="chorus ",r.subarray(1).forEach((s,n)=>{([c=>{e.setEffectTypeRaw(1,!1,c),console.info(`${a}main type: ${Y[c]}`),e.dispatchEvent("efxchorus",e.getEffectType(1))},c=>{e.setEffectTypeRaw(1,!0,c),console.debug(`${a}sub type: ${c+1}`),e.dispatchEvent("efxchorus",e.getEffectType(1))},c=>{console.debug(`${a}LFO: ${ke[c]}Hz`)},c=>{},c=>{console.debug(`${a}feedback: ${c}`)},c=>{console.debug(`${a}delay offset: ${xe(c)}ms`)},c=>{},c=>{console.debug(`${a}low: ${z[c]}Hz`)},c=>{console.debug(`${a}low: ${c-64}dB`)},c=>{console.debug(`${a}high: ${z[c]}Hz`)},c=>{console.debug(`${a}high: ${c-64}dB`)},c=>{console.debug(`${a}dry/wet: ${c}`)},c=>{console.debug(`${a}send: ${L(c)}dB`)},c=>{console.debug(`${a}pan: ${c-64}`)},c=>{console.debug(`${a}to reverb: ${L(c)}dB`)},!1,c=>{},c=>{},c=>{},c=>{console.debug(`${a}LFO phase diff: ${(c-64)*3}deg`)},c=>{console.debug(`${a}input mode: ${c?"stereo":"mono"}`)},c=>{}][r[0]-32+n]||function(){console.warn(`Unknown XG chorus address: ${r[0]}.`)})(s)})):r[0]<86?(a+="variation ",r.subarray(1).forEach((s,n)=>{([c=>{e.setEffectTypeRaw(2,!1,c),console.info(`${a}main type: ${Y[c]}`),e.dispatchEvent("efxdelay",e.getEffectType(2))},c=>{e.setEffectTypeRaw(2,!0,c),console.debug(`${a}sub type: ${c+1}`),e.dispatchEvent("efxdelay",e.getEffectType(2))}][r[0]-64+n]||function(){})(s)})):r[0]<97?(a+="variation ",r.subarray(1).forEach((s,n)=>{[c=>{console.debug(`${a}send: ${L(c)}dB`)},c=>{console.debug(`${a}pan: ${c-64}`)},c=>{console.debug(`${a}to reverb: ${L(c)}dB`)},c=>{console.debug(`${a}to chorus: ${L(c)}dB`)},c=>{console.debug(`${a}connection: ${c?"system":"insertion"}`)},c=>{console.debug(`${a}channel: CH${c+1}`)},c=>{console.debug(`${a}mod wheel: ${c-64}`)},c=>{console.debug(`${a}bend wheel: ${c-64}`)},c=>{console.debug(`${a}channel after touch: ${c-64}`)},c=>{console.debug(`${a}AC1: ${c-64}`)},c=>{console.debug(`${a}AC2: ${c-64}`)}][r[0]-86+n](s)})):r[0]>111&&r[0]<118?a+="variation ":console.warn(`Unknown XG variation address: ${r[0]}`)}).add([76,2,64],(r,l,u)=>{r.subarray(1).forEach((a,s)=>{let n=s+r[0];if(n==0)console.debug(`XG EQ preset: ${["flat","jazz","pop","rock","classic"][a]}`);else{let c=n-1>>2,d=n-1&3,h=`XG EQ ${c} ${["gain","freq","Q","shape"][d]}: `;[()=>{console.debug(`${h}${a-64}dB`)},()=>{console.debug(`${h}${a} (raw)`)},()=>{console.debug(`${h}${a/10}`)},()=>{console.debug(`${h}${["shelf","peak"][+!!a]}`)}][d]()}})}).add([76,3],(r,l,u)=>{e.dispatchEvent("mupromptex");let a=r[0],s=r[1],n=`XG Insertion ${r[0]+1} `;r.subarray(2).forEach((c,d)=>{([h=>{e.setEffectTypeRaw(3+a,!1,h),console.info(`${n}main type: ${Y[h]}`),e.dispatchEvent(`efxinsert${a}`,e.getEffectType(3+a))},h=>{e.setEffectTypeRaw(3+a,!0,h),console.debug(`${n}sub type: ${h+1}`),e.dispatchEvent(`efxinsert${a}`,e.getEffectType(3+a))}][s+d]||function(){})(c)})}).add([76,6,0],(r,l,u)=>{let a=r[0];a<64?e.setLetterDisplay(r.subarray(1),"XG letter display",a):e.#z=Date.now()}).add([76,7,0],(r,l,u)=>{let a=r[0];e.#f=0,e.#E=Date.now()+3200,e.#w.fill(0);let s=r.subarray(1);for(let n=0;n<a;n++)s.unshift(0);s.forEach(function(n,c){let d=Math.floor(c/16),h=c%16,g=(h*3+d)*7,E=7,C=0;for(g-=h*5,d==2&&(E=2);C<E;)e.#w[g+C]=n>>6-C&1,C++})}).add([76,8],(r,l)=>{e.dispatchEvent("mupromptex");let u=e.chRedir(r[0],l,!0),a=r[1],s=S[u],n=`XG CH${u+1} `,c=`Unknown XG part address ${a}.`,d=!0;r.subarray(2).forEach((h,g)=>{d=!0,a<1?console.debug(c):a<41?([()=>{e.setChCc(u,0,h),e.pushChPrimitives(u),e.dispatchEvent("voice",{part:u})},()=>{e.setChCc(u,32,h),e.pushChPrimitives(u),e.dispatchEvent("voice",{part:u})},()=>{e.#r[u]=h,e.dispatchEvent("voice",{part:u})},()=>{d=!1;let E=e.chRedir(h,l,!0);e.#u[u]=E,u!=E&&(e.buildRchTree(),console.info(`${n}receives from CH${E+1}`)),e.#d[u]||(e.copyChSetup(E,u,!0),console.debug(`${n}copied from CH${E+1}.`),e.setChActive(u,1),e.dispatchEvent("voice",{part:u}))},()=>{e.#m[u]=+!h},()=>{},()=>{d=!1,e.setChType(u,h,w.xg),console.debug(`${n}type: ${Q[h]||h}`),e.dispatchEvent("voice",{part:u})},()=>{e.#s[b.rpn*u+3]=h,e.#c[b.rpnt*u+2]=1,e.dispatchEvent("pitch",{part:u,pitch:e.getPitchShift(u)})},!1,!1,()=>{e.setChCc(u,7,h)},!1,!1,()=>{e.setChCc(u,10,h||128)},!1,!1,()=>{e.setChCc(u,128,h),e.allocateAce(u,128)},()=>{e.setChCc(u,93,h)},()=>{e.setChCc(u,91,h)},()=>{e.setChCc(u,94,h)},()=>{e.setChCc(u,76,h)},()=>{e.setChCc(u,77,h)},()=>{e.setChCc(u,78,h)},()=>{e.setChCc(u,74,h)},()=>{e.setChCc(u,71,h)},()=>{e.setChCc(u,73,h)},()=>{e.setChCc(u,75,h)},()=>{e.setChCc(u,72,h)}][a+g-1]||(()=>{}))():a<48?console.debug(c):a<111?a>102&&a<105&&e.setChCc(u,[5,65][a&1],h):a<114?console.debug(c):a<116?console.debug(`${n}EQ ${["bass","treble"][a&1]} gain: ${h-64}dB`):a<118?console.debug(c):a<120?console.debug(`${n}EQ ${["bass","treble"][a&1]} freq: ${h}`):console.debug(c)}),d&&e.#i[u]>1&&e.setDrumFirstWrite(u)}).add([76,9],(r,l)=>{let u=e.chRedir(r[0],l,!0),a=r[1],s=S[u],n=`PLG-VL CH${u+1} `;r.subarray(2).forEach((c,d)=>{let h=d+a;switch(h){case 1:{console.info(`${n}breath mode: ${["system","breath","velocity","touch EG"][c]}`);break}case 0:case 27:case 28:break;default:if(h<27){let g=h-3>>1,E=["pressure","embouchure","tonguing","scream","breath noise","growl","throat formant","harmonic enhancer","damping","absorption","amplification","brightness"][g];h&1?h<23?(console.debug(`${n}${E} control source: ${Me(c)}`),c&&c<96&&e.allocateAce(u,130+g),e.#X[b.redir*u+g+2]=c,e.buildRccMap()):console.debug(`${n}${E} scale break point: ${c}`):(console.debug(`${n}${E} depth: ${c-64}`),e.setChCc(u,130+g,c))}}})}).add([76,10],(r,l,u)=>{}).add([76,16],(r,l,u)=>{}).add([76,17,0,0],(r,l,u)=>{}).add([76,112],(r,l,u)=>{switch(console.debug(`XG enable PLG-${["VL","SG","DX","AN","PF","DR","PC","AP"][r[0]]} for CH${r[2]+1}.`),r[0]){case 0:{e.#x[b.ext*r[2]]=e.EXT_VL;break}case 2:{e.#x[b.ext*r[2]]=e.EXT_DX;break}default:e.#x[b.ext*r[2]]=e.EXT_NONE}}).add([73,0,0],(r,l)=>{let u=r[0],a="MU1000 System - ";r.subarray(1).forEach((s,n)=>{let c=u+n;c==8?console.debug(`${a}LCD contrast: ${s}.`):c==18?(e.#v[w.xg][1]=s?126:0,console.debug(`${a}default bank: ${s?"MU100 Native":"MU Basic"}.`),e.dispatchEvent("banklevel",{mode:"xg",data:+!!s}),e.forceVoiceRefresh()):c>=64&&c<69&&[()=>{e.dispatchEvent("channelactive",s)},()=>{s<8?(e.dispatchEvent("channelmin",s<<4),console.debug(`Octavia System: Minimum CH${(s<<4)+1}`)):(e.dispatchEvent("channelreset"),console.info("Octavia System: Clear channel ranges"))},()=>{s<8?(e.dispatchEvent("channelmax",(s<<4)+15),console.debug(`Octavia System: Maximum CH${(s<<4)+16}`)):(e.dispatchEvent("channelreset"),console.info("Octavia System: Clear channel ranges"))},()=>{e.dispatchEvent("channelreset"),console.info("Octavia System: Clear channel ranges")},()=>{e.#O=!!s,console.info(`Octavia System: RS receiving ${["dis","en"][s]}abled.`)}][c-64]()})}).add([73,10,0],(r,l)=>{let u=r[0],a=`MU1000 RS${e.#O?"":" (ignored)"}: `;if(u<16)switch(u){case 2:{let s=e.chRedir(0,l,!0);e.#O&&(e.dispatchEvent("portrange",4),e.dispatchEvent("portstart",s)),console.info(`${a}Show CH${s+1}~CH${s+64}`);break}case 3:{let s=e.chRedir(r[1]<<5,l,!0);e.#O&&(e.dispatchEvent("portrange",2),e.dispatchEvent("portstart",s)),console.info(`${a}Show CH${s+1}~CH${s+32}`);break}default:console.debug(`${a}unknown switch ${u} invoked.`)}else if(u<32){if(e.#O){let s=e.chRedir(u-16+(e.#re<<4),l,!0);e.dispatchEvent("channelactive",s)}}else if(u<36){let s=e.chRedir(u-32<<4,l,!0);e.#O&&(e.dispatchEvent("portrange",1),e.dispatchEvent("portstart",s>>4),e.#re=u-32),console.info(`${a}Show CH${s+1}~CH${s+16}`)}}).add([73,11,0],(r,l)=>{let u="MU1000 System - channel ",a="Octavia System - channel ",s=r[0];r.subarray(1).forEach((n,c)=>{let d=s+c;([()=>{e.setChActive(n,1),e.dispatchEvent("channelactive",n),T()&&console.debug(`${u}current part: CH${n+1}`)},()=>{n<5?(e.dispatchEvent("portrange",1<<n),console.debug(`${u}port range: ${1<<n} port(s)`)):(e.dispatchEvent("portrange",0),console.debug(`${u}port range: reset`))},()=>{n<16?(e.dispatchEvent("portstart",n),console.debug(`${a}start port: ${"ABCDEFGHIJKLMNOP"[n]}`)):(e.dispatchEvent("portstart",255),console.debug(`${a}start port: reset`))}][d]||(()=>{console.debug(`${u}unknown address: ${d}`)}))()})}).add([93,3],(r,l)=>{let u=e.chRedir(r[0],l,!0),a=`PLG-SG CH${u+1} `,s=Date.now();if(r[1]==0){let n="",c=0;r.subarray(2).forEach((d,h)=>{h%2==0?n+=Te[d]||d.toString().padStart("0"):c+=d*13}),s>=e.#_&&this.dispatchEvent("metacommit",{type:"SGLyrics",data:"",amend:!1}),this.dispatchEvent("metacommit",{type:"SGLyrics",data:`${Se(n)}`,amend:!0}),e.#_=s+Math.ceil(c/2)+e.#J,T()&&console.debug(`${a}vocals: ${n}`)}else console.warn(`Unknown PLG-SG data: ${r}`)}).add([98,0],(r,l,u)=>{e.dispatchEvent("mupromptex");let a=r[0],s=r.length-5,n=r.length-1;if(a!=s){console.info(`PLG-DX native dump size mismatch! Gave ${a} instead of ${r.length-5}.`);return}let c=F(r.subarray(4,n));if(c!=r[n]){console.info(`Bad PLG-DX checksum ${r[n]} - should be ${c}.`);return}r[0]=98,e.#H.run(r.subarray(0,n),l,u,{noAce:!0})}).add([98,96],(r,l,u,a)=>{let s=e.chRedir(r[0],l,!0),n=S[s],c=r[1];r.subarray(2).forEach((d,h)=>{let g=c+h;if(!(g<10)){if(g==10)e.resetAce();else if(g<27){let E=g+131;a?.noAce||e.allocateAce(s,E),e.setChCc(s,E,d),e.dispatchEvent("cc",{part:s,cc:E,data:d})}}})}).add([100,0],(r,l,u)=>{let a=r.subarray(0,r.length-1);if(r[0]+5!=r.length){console.warn(`Yamaha DX7+ dump SysEx size mismatch! Expected ${r.length}, but got ${r[0]}:
`,r);return}let s=F(a),n=r[r.length-1];if(s!=n){console.warn(`Yamaha DX7+ dump SysEx checksum mismatch! Expected ${s}, but got ${n}:
`,r);return}t.run(a.subarray(1))}).add([100,76],(r,l,u)=>{let a=r[0]>>4,s=r[0]&15,n=r[1];switch(a){case 2:{let c=e.chRedir(s,l,!0),d=S[c];r.subarray(2).forEach((h,g)=>{let E=g+n;if(!(E<7)){if(E<23){let C=E+135;e.allocateAce(c,C),e.setChCc(c,C,h),e.dispatchEvent("cc",{part:c,cc:C,data:h})}}});break}default:console.info("Unknown DX7+ multipart: %o",r)}}).add([1,20],(r,l,u)=>{u==115?(e.switchMode("doc",!0),e.setPortMode(e.getTrackPort(l),1,w.doc),console.info("MIDI reset: DOC")):console.debug(`Unknown Yamaha SysEx: 67, ${u}, ${r.join(", ")}`)}).add([1,17,15,89],(r,l,u)=>{u==115?(e.setEffectType(0,24,r[0]|16),e.dispatchEvent("efxreverb",e.getEffectType(0))):console.debug(`Unknown Yamaha SysEx: 67, ${u}, ${r.join(", ")}`)}).add([1,24],(r,l,u)=>{if(u==115){for(let a=0;a<16;a++){let s=e.chRedir(a,l,!0);e.setChCc(s,91,127)}console.info("DOC Global Reverb: on")}else console.debug(`Unknown Yamaha SysEx: 67, ${u}, ${r.join(", ")}`)}),t.add([14,31],(r,l,u)=>{e.setChCc(r[0],64,0),e.#P.ano(r[0]),e.switchMode("xg"),e.setPortMode(e.getTrackPort(l),1,w.xg),e.resetAce(),console.debug(`Yamaha DX7+ reset CH${r[0]+1}.`)}).add([76,112],async r=>{let l=r[0],u=S[l],a=Xe[l],s=b.cvn*l;e.#x[a]=e.EXT_DX,e.#l[l]=1;let n=e.#Z.subarray(s,s+b.cvn);n.fill(32),r.subarray(1).forEach((c,d)=>{if(d<10)n[d]=Math.max(c,32);else if(!(d<40)){if(d<56){let h=d+102;e.setChCc(l,h,c),e.dispatchEvent("cc",{part:l,cc:h,data:c})}}}),e.#r[l]=l&127,e.setChCc(l,0,35),e.setChCc(l,32,l>>7|4),e.pushChPrimitives(l),e.dispatchEvent("voice",{part:l}),console.debug(`DX7+ CH${l+1} dump: %o`,r)});let o=function(r,l,u,a){},f=function(r,l){e.dispatchEvent("mupromptex");let u=r*b.dpn,a=l[0],s=l[1];l.subarray(2).forEach((n,c)=>{let d=c+s,h=-1;d<16?([()=>{h=24},()=>{h=25},()=>{h=26},()=>{},()=>{h=28},()=>{h=29},()=>{h=30},()=>{h=31},()=>{},()=>{},()=>{},()=>{h=20},()=>{h=21},()=>{h=22},()=>{h=23},()=>{}][d]||(()=>{console.debug(`Unknown XG-style drum param ${d} on set ${r+1}.`)}))():d<32||(d<40?([()=>{h=48},()=>{h=49},!1,!1,()=>{h=52},()=>{h=53}][d-32]||(()=>{console.debug(`Unknown XG-style drum param ${d} on set ${r+1}.`)}))():d<80||([()=>{h=36}][d-80]||(()=>{console.debug(`Unknown XG-style drum param ${d} on set ${r+1}.`)}))()),h>=0?(T()&&console.debug(u,h,a,n),e.#R[(u+O[h])*b.dnc+a]=n):T()&&console.debug(`XG-style drum param ${d} has no writes.`)})},p=function(r,l,u){e.dispatchEvent("mupromptex");let a=r*b.dpn,s=(l<<7)+u[0];u.subarray(1).forEach((n,c)=>{let d=c+s,h=d&127,g=d>>7,E=-1;g>1&&([()=>{E=26},()=>{},()=>{E=28},()=>{E=29},()=>{E=30},()=>{},()=>{},()=>{E=31}][g-2]||(()=>{console.debug(`Unknown GS-style drum param ${g} on set ${r+1}.`)}))(),E>-1?(T()&&console.debug(a,E,h,n),e.#R[(a+O[E])*b.dnc+h]=n):T()&&console.debug(`GS-style drum param ${g} has no writes.`)})};this.#H.add([76,48],(r,l,u)=>{f(0,r)}).add([76,49],(r,l,u)=>{f(1,r)}).add([76,50],(r,l,u)=>{f(2,r)}).add([76,51],(r,l,u)=>{f(3,r)}).add([76,52],(r,l,u)=>{f(4,r)}).add([76,53],(r,l,u)=>{f(5,r)}).add([76,54],(r,l,u)=>{f(6,r)}).add([76,55],(r,l,u)=>{f(7,r)}),this.#H.add([89,0],(r,l,u)=>{if(e.eprom){let a=r[0],s=(r[1]<<14)+(r[2]<<7)+r[3]+(e.eprom.offset||0);T()&&console.debug(`MU1000 EPROM trail to 0x${s.toString(16).padStart(6,"0")}, ${a} bytes.`);let n=e.eprom.data;r.subarray(4).forEach((c,d)=>{let h=d>>3,g=d&7;if(g==7)for(let E=0;E<7;E++)n[s+7*h+E]+=(c>>6-E&1)<<7;else n[s+7*h+g]=c})}}).add([89,1],(r,l,u)=>{let a=(r[0]<<21)+(r[1]<<14)+(r[2]<<7)+r[3];T()&&console.debug(`MU1000 EPROM jump to 0x${a.toString(16).padStart(6,"0")}.`),e.eprom&&(e.eprom.offset=a)}).add([89,2],(r,l,u)=>{if(e.eprom){let a=(r[0]<<21)+(r[1]<<14)+(r[2]<<7)+r[3]+(e.eprom.offset||0);T()&&console.debug(`MU1000 EPROM write to 0x${a.toString(16).padStart(6,"0")}.`);let s=e.eprom.data;r.subarray(4).forEach((n,c)=>{let d=c>>3,h=c&7;if(h==7)for(let g=0;g<7;g++)s[a+7*d+g]+=(n>>6-g&1)<<7;else s[a+7*d+h]=n})}}).add([89,3],(r,l,u)=>{}),this.#H.add([39,48],(r,l,u)=>{}).add([43,0,0],(r,l,u)=>{e.dispatchEvent("mupromptex");let a=[0,0,0,0],s=(n,c)=>{a[c]=n};if(r.subarray(1).forEach((n,c)=>{let d=c+r[0];[s,s,s,s,()=>{this.#n=n*129/16383*100,e.dispatchEvent("mastervolume",e.#n)},()=>n-64,()=>n||128,()=>n,()=>n,()=>{console.debug(`TG300 variation on cc${n}.`)}][d](n,d)}),r[0]<4){let n=0;a.forEach(c=>{n=n<<4,n+=c}),n-=1024}}).add([43,1,0],(r,l,u)=>{e.dispatchEvent("mupromptex")}).add([43,2],(r,l,u)=>{e.dispatchEvent("mupromptex");let a=e.chRedir(r[0],l,!0),s=r[1],n=S[a],c=`TG300 CH${a+1} `;r.subarray(2).forEach((d,h)=>{h<5?([()=>{},()=>{e.setChCc(a,0,d),e.pushChPrimitives(a),e.dispatchEvent("voice",{part:a})},()=>{e.setChCc(a,32,d),e.pushChPrimitives(a),e.dispatchEvent("voice",{part:a})},()=>{e.#r[a]=d,e.dispatchEvent("voice",{part:a})},()=>{let g=e.chRedir(d,l,!0);e.#u[a]=g,a!=g&&(e.buildRchTree(),console.info(`${c}receives from CH${g+1}`))}][h+s]||(()=>{}))(d,h+s):h<21||(h<47?([()=>{e.#m[a]=+!d},()=>{},()=>{},()=>{e.#s[b.rpn*a+3]=d,e.#c[b.rpnt*a+2]=1,e.dispatchEvent("pitch",{part:a,pitch:e.getPitchShift(a)})},()=>{},()=>{e.setChCc(a,7,d)},!1,!1,()=>{e.setChCc(a,10,d||128)},!1,!1,()=>{console.debug(`${c} AC1 at cc${d}`)},()=>{console.debug(`${c} AC2 at cc${d}`)},()=>{e.#e[n+v[128]]=d,e.allocateAce(a,128)},()=>{e.#e[n+v[93]]=d},()=>{e.#e[n+v[91]]=d},()=>{e.#e[n+v[94]]=d},()=>{e.#e[n+v[76]]=d},()=>{e.#e[n+v[77]]=d},()=>{e.#e[n+v[74]]=d},()=>{e.#e[n+v[71]]=d},()=>{e.#e[n+v[73]]=d},()=>{e.#e[n+v[75]]=d},()=>{e.#e[n+v[72]]=d},()=>{e.#e[n+v[78]]=d}][h+s-21]||(()=>{}))(d,h+s):h<95||([()=>{e.#e[n+v[65]]=d},()=>{e.#e[n+v[5]]=d}][h+s-95]||(()=>{}))(d,h+s))})}).add([43,7,0],(r,l,u)=>{let a=r[0];e.setLetterDisplay(r.subarray(1),"TG300 letter display",a)}).add([43,7,1],(r,l,u)=>{e.#f=0,e.#E=Date.now()+3200,e.#w.fill(0),r.forEach(function(a,s){let n=Math.floor(s/16),c=s%16,d=(c*3+n)*7,h=7,g=0;for(d-=c*5,n==2&&(h=2);g<h;)e.#w[d+g]=a>>6-g&1,g++})}),this.#F.add([66,18,0,0,127],(r,l,u)=>{e.switchMode("sc",!0),e.setPortMode(e.getTrackPort(l),2,w.sc),e.#v[w.sc][1]=e.#t.sc,e.#y=!1,e.#te.fill(0),console.info(`GS system to ${["single","dual"][r[0]]} mode.`)}).add([66,18,64,0],(r,l,u)=>{switch(r[0]){case 127:{e.switchMode("gs",!0),e.setPortMode(e.getTrackPort(l),2,w.gs),e.#v[w.gs][1]=e.#t.gs,e.#y=!1,e.#te.fill(0),console.info("MIDI reset: GS");break}default:{e.dispatchEvent("mupromptex");let a=[0,0,0,0],s=(n,c)=>{a[c]=n};if(r.subarray(1).forEach((n,c)=>{let d=c+r[0];[s,s,s,s,h=>{this.#n=h*129/16383*100,e.dispatchEvent("mastervolume",e.#n)},h=>{},h=>{}][d](n,c)}),r[0]<4){let n=0;a.forEach(c=>{n=n<<4,n+=c}),n-=1024}}}}).add([66,18,64,1],(r,l,u)=>{e.dispatchEvent("mupromptex");let a=r[0];if(a<16){let s="".padStart(a," ");r.subarray(1).forEach((n,c)=>{s+=String.fromCharCode(Math.max(32,n))}),s=s.padEnd(16," "),console.debug(`GS patch name: ${s}`)}else a<48||(a<65?r.subarray(1).forEach((s,n)=>{let c=`GS ${a+n>55?"chorus":"reverb"} `;([()=>{console.info(`${c}type: ${oe[s]}`),e.setEffectType(0,40,s),e.dispatchEvent("efxreverb",e.getEffectType(0))},()=>{},()=>{},()=>{},()=>{},()=>{},!1,()=>{console.debug(`${c}predelay: ${s}ms`)},()=>{console.info(`${c}type: ${Pe[s]}`),e.setEffectType(1,40,16+s),e.dispatchEvent("efxchorus",e.getEffectType(1))},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{console.debug(`${c}to reverb: ${L(s)}`)},()=>{console.debug(`${c}to delay: ${L(s)}`)}][a+n-48]||(()=>{}))()}):a<80?console.debug(`Unknown GS patch address: ${a}`):a<91?r.subarray(1).forEach((s,n)=>{let c="GS delay ";([()=>{console.info(`${c}type: ${Re[s]}`),e.setEffectType(2,40,32+s),e.dispatchEvent("efxdelay",e.getEffectType(2))},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{console.debug(`${c}to reverb: ${L(s)}`)}][a+n-80]||(()=>{}))()}):console.debug(`Unknown GS patch address: ${a}`))}).add([66,18,64,2],(r,l,u)=>{let a="GS EQ ";r.subarray(1).forEach((s,n)=>{([()=>{console.debug(`${a}low freq: ${[200,400][s]}Hz`)},()=>{console.debug(`${a}low gain: ${s-64}dB`)},()=>{console.debug(`${a}high freq: ${[3e3,6e3][s]}Hz`)},()=>{console.debug(`${a}high gain: ${s-64}dB`)}][r[0]+n]||function(){console.warn(`Unknown GS EQ address: ${r[0]+n}`)})()})}).add([66,18,64,3],(r,l,u)=>{e.dispatchEvent("mupromptex");let a="GS EFX ",s=function(n,c){let d=De(e.#M.subarray(10,12),c,n);d&&console.debug(`${a}${le(e.#M.subarray(10,12))} ${d}`)};r.subarray(1).forEach((n,c)=>{([()=>{e.setEffectTypeRaw(3,!1,32+n),e.dispatchEvent("efxinsert0",e.getEffectType(3))},()=>{e.setEffectTypeRaw(3,!0,n),console.info(`${a}type: ${le(e.#M.subarray(10,12))}`),e.dispatchEvent("efxinsert0",e.getEffectType(3))},!1,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,()=>{console.debug(`${a}to reverb: ${L(n)}dB`)},()=>{console.debug(`${a}to chorus: ${L(n)}dB`)},()=>{console.debug(`${a}to delay: ${L(n)}dB`)},!1,()=>{console.debug(`${a}1 source: ${n}`),n&&n<96&&e.allocateAceAll(n)},()=>{console.debug(`${a}1 depth: ${n-64}`)},()=>{console.debug(`${a}2 source: ${n}`),n&&n<96&&e.allocateAceAll(n)},()=>{console.debug(`${a}2 depth: ${n-64}`)},()=>{console.debug(`${a}to EQ: ${n?"ON":"OFF"}`)}][r[0]+c]||function(d,h){console.warn(`Unknown GS EFX address: ${h}`)})(n,r[0]+c)})}).add([66,18,65],(r,l,u)=>{p((r[0]>>4)+1<<1,r[0]&15,r.subarray(1))}).add([69,18,16],(r,l,u)=>{switch(r[0]){case 0:{let a=r[1];e.setLetterDisplay(r.subarray(2),"GS display text",a);break}case 8:{let a=r[1],s=e.modelEx.sc;r.subarray(2).forEach((n,c)=>{([()=>{s.showBar=!(n&1),s.invBar=n>>1&1,s.invDisp=n>>2&1},()=>{s.peakHold=n<4?n:1}][c+a]||(()=>{console.debug("Unsupported GS display type SysEx.")}))()});break}case 32:{e.#E=Date.now()+3200,r[1]==0&&(r[2]?(e.#f=Math.max(Math.min(r[2]-1,9),0),T()&&console.debug(`GS switch display page ${r[2]-1}.`)):(e.#f=0,e.#E=Date.now(),T()&&console.debug("GS disable display page.")));break}default:if(r[0]<6){e.#f>9&&(e.#f=0);let a=r[0]-1<<1|r[1]>>6;e.#f==a&&(e.#E=Date.now()+3200),e.#T[a]?.length||(e.#T[a]=new Uint8Array(256));let s=e.#T[a];T()&&console.debug(`GS frame draw page ${a}.`);let n=r[1]&63;s.fill(0),r.subarray(2).forEach(function(d,h){let g=h+n,E=Math.floor(g/16),C=g%16,$=(C*4+E)*5,x=5,R=0;for($-=C*4,E==3&&(x=1);R<x;)s[$+R]=d>>4-R&1,R++})}else console.warn(`Unknown GS display section: ${r[0]}`)}}).add([69,18,32],(r,l,u)=>{let a=r[0],s=r[1],n=r.subarray(2);if(a>>4){console.warn(`SC-8850 partial screen dump out of bounds: invalid bundle.
`,r);return}let c=s+n.length,d=s*6-(s*2428>>16<<1),h=c*6-(c*2428>>16<<1);if(d>640){console.warn(`SC-8850 partial screen dump out of bounds: invalid buffer range.
`,r);return}h>640&&(console.info(`SC-8850 partial screen dump out of bounds: invalid buffer end, automatically restricted.
`,r),h=640);let g=new Uint8Array(h-d);n.forEach(($,x)=>{let R=x+s,N=(R*2428&65535)*27>>16==26,D=R*6-(R*2428>>16<<1),H=N?2:0;for(;H<6;)g[D+(5-H)]=$>>H&1,H++});let E=a*108+s,C=E*6-(E*2428>>16<<1);e.dispatchEvent("screen",{type:"sc8850",offset:C,data:g}),T()&&console.debug(`SC-8850 screen dump: bundle ${a+1}, range ${d}~${h}`)});let m=function(r,l,u){e.dispatchEvent("mupromptex");let a=r[0],s=S[l],n=ee[l],c=`GS CH${l+1} `;a<3?(r.subarray(1).forEach((d,h)=>{[()=>{e.#e[s+v[0]]=d,e.pushChPrimitives(l)},()=>{e.#r[l]=d},()=>{let g=0;d<16?g=e.chRedir(d,u,!0):g=b.ch,e.#u[l]=g,l!=g&&(e.buildRchTree(),console.info(`${c}receives from CH${g+1}`))}][a+h]()}),e.dispatchEvent("voice",{part:l})):a<19||(a<44?r.subarray(1).forEach((d,h)=>{([()=>{e.#m[l]=+!d},!1,()=>{e.setChType(l,d<<1,w.gs),console.debug(`${c}type: ${d?"drum ":"melodic"}${d||""}`)},()=>{e.#s[n+3]=d,e.#c[b.rpnt*l+2]=1,e.dispatchEvent("pitch",{part:l,pitch:e.getPitchShift(l)})},!1,()=>{e.#e[s+v[7]]=d},!1,!1,()=>{e.#e[s+v[10]]=d||128},!1,!1,()=>{console.debug(`${c}CC 1: cc${d}`)},()=>{console.debug(`${c}CC 2: cc${d}`)},()=>{e.#e[s+v[93]]=d},()=>{e.#e[s+v[91]]=d},!1,!1,()=>{e.#s[n+1]=d,e.#c[b.rpnt*l+1]=1,e.dispatchEvent("pitch",{part:l,pitch:e.getPitchShift(l)})},()=>{e.#s[n+2]=d,e.#c[b.rpnt*l+1]=1,e.dispatchEvent("pitch",{part:l,pitch:e.getPitchShift(l)})},()=>{e.#e[s+v[94]]=d}][a+h-19]||(()=>{}))()}):a<76||console.debug(`Unknown GS part address: ${a}`))},y=function(r,l){let u=r[0],a=`GS CH${l+1} `;u<2?r.subarray(1).forEach((s,n)=>{[()=>{e.setChCc(l,32,s)},()=>{}][u+n]()}):u<32?console.warn(`Unknown GS misc address: ${u}`):u<35?r.subarray(1).forEach((s,n)=>{[()=>{console.debug(`${a}EQ: o${["ff","n"][s]}`)},()=>{},()=>{console.debug(`${a}EFX: o${["ff","n"][s]}`),e.#Q[l]=s,e.dispatchEvent("partefxtoggle",{part:l,active:s})}][u+n-32]()}):console.warn(`Unknown GS misc address: ${u}`)};this.#F.add([66,18,64,16],(r,l)=>{m(r,e.chRedir(9,l,!0),l)}).add([66,18,64,17],(r,l)=>{m(r,e.chRedir(0,l,!0),l)}).add([66,18,64,18],(r,l)=>{m(r,e.chRedir(1,l,!0),l)}).add([66,18,64,19],(r,l)=>{m(r,e.chRedir(2,l,!0),l)}).add([66,18,64,20],(r,l)=>{m(r,e.chRedir(3,l,!0),l)}).add([66,18,64,21],(r,l)=>{m(r,e.chRedir(4,l,!0),l)}).add([66,18,64,22],(r,l)=>{m(r,e.chRedir(5,l,!0),l)}).add([66,18,64,23],(r,l)=>{m(r,e.chRedir(6,l,!0),l)}).add([66,18,64,24],(r,l)=>{m(r,e.chRedir(7,l,!0),l)}).add([66,18,64,25],(r,l)=>{m(r,e.chRedir(8,l,!0),l)}).add([66,18,64,26],(r,l)=>{m(r,e.chRedir(10,l,!0),l)}).add([66,18,64,27],(r,l)=>{m(r,e.chRedir(11,l,!0),l)}).add([66,18,64,28],(r,l)=>{m(r,e.chRedir(12,l,!0),l)}).add([66,18,64,29],(r,l)=>{m(r,e.chRedir(13,l,!0),l)}).add([66,18,64,30],(r,l)=>{m(r,e.chRedir(14,l,!0),l)}).add([66,18,64,31],(r,l)=>{m(r,e.chRedir(15,l,!0),l)}).add([66,18,64,64],(r,l)=>{y(r,e.chRedir(9,l,!0))}).add([66,18,64,65],(r,l)=>{y(r,e.chRedir(0,l,!0))}).add([66,18,64,66],(r,l)=>{y(r,e.chRedir(1,l,!0))}).add([66,18,64,67],(r,l)=>{y(r,e.chRedir(2,l,!0))}).add([66,18,64,68],(r,l)=>{y(r,e.chRedir(3,l,!0))}).add([66,18,64,69],(r,l)=>{y(r,e.chRedir(4,l,!0))}).add([66,18,64,70],(r,l)=>{y(r,e.chRedir(5,l,!0))}).add([66,18,64,71],(r,l)=>{y(r,e.chRedir(6,l,!0))}).add([66,18,64,72],(r,l)=>{y(r,e.chRedir(7,l,!0))}).add([66,18,64,73],(r,l)=>{y(r,e.chRedir(8,l,!0))}).add([66,18,64,74],(r,l)=>{y(r,e.chRedir(10,l,!0))}).add([66,18,64,75],(r,l)=>{y(r,e.chRedir(11,l,!0))}).add([66,18,64,76],(r,l)=>{y(r,e.chRedir(12,l,!0))}).add([66,18,64,77],(r,l)=>{y(r,e.chRedir(13,l,!0))}).add([66,18,64,78],(r,l)=>{y(r,e.chRedir(14,l,!0))}).add([66,18,64,79],(r,l)=>{y(r,e.chRedir(15,l,!0))}),this.#ee.add([54,65],(r,l)=>{let u=e.#t.x5=="81"?"05rw":"x5d";e.switchMode(u,!0),e.setPortMode(e.getTrackPort(l),1,w[u]);let a=r[r.length-1],s=r.subarray(0,r.length-1),n=F(s);n!=a&&(console.info(`X5D multi parameters checksum mismatch! Expected ${n}, got ${a}.`),console.debug(r));let c=(r[1]<<7)+r[0],d=(r[3]<<7)+r[2],h=e.chRedir(c&15,l,!0),g=S[h];[()=>{d<1||(d<101?(e.setChType(h,e.CH_MELODIC,w.x5d),e.#r[h]=d-1,e.#e[g+v[0]]=e.#t.x5):d<229?(e.setChType(h,e.CH_MELODIC,w.x5d),e.#r[h]=d-101,e.#e[g+v[0]]=56):(e.setChType(h,e.CH_DRUMS,w.x5d),e.#r[h]=Ne[d-229]||0,e.#e[g+v[0]]=62)),e.pushChPrimitives(h),e.dispatchEvent("voice",{part:h})},()=>{e.#e[g+v[7]]=d},()=>{d<31&&(e.#e[g+v[10]]=Math.round((d-15)*4.2+64))},()=>{e.#e[g+v[93]]=Z(d)},()=>{e.#e[g+v[91]]=Z(d)},()=>{e.#s[h*b.rpn+3]=d>8191?d-16320:64+d,e.#c[b.rpnt*h+2]=1,e.dispatchEvent("pitch",{part:h,pitch:e.getPitchShift(h)})},()=>{e.#s[h*b.rpn+1]=d>8191?d-16320:64+d,e.#c[b.rpnt*h+1]=1,e.dispatchEvent("pitch",{part:h,pitch:e.getPitchShift(h)})},()=>{d>0&&(e.#s[h*b.rpn]=d,e.#c[b.rpnt*h]=1,e.dispatchEvent("pitch",{part:h,pitch:e.getPitchShift(h)}))},()=>{}][c>>4]()}).add([54,76,0],(r,l)=>{e.dispatchEvent("mupromptex");let u=e.#t.x5=="81"?"05rw":"x5d";e.switchMode(u),e.setPortMode(e.getTrackPort(l),1,w[u]);let a="",s=e.#t.x5,n=0,c=0,d="MSB	PRG	LSB	NME";B(r,function(h,g){if(g<16400){let E=g%164;switch(!0){case E<10:{h>31&&(a+=String.fromCharCode(h));break}case E==10:break;case E==11:{d+=`
${s}	${n}	${c}	${a.trim().replace("Init Voice","")}`,n++,a="";break}}n>99&&(s=90,n=0)}}),e.userBank.clearRange({msb:e.#t.x5,prg:[0,99],lsb:0}),e.userBank.load(d),T()&&console.debug(d),e.forceVoiceRefresh()}).add([54,77,0],(r,l)=>{e.dispatchEvent("mupromptex");let u=e.#t.x5=="81"?"05rw":"x5d";e.switchMode(u),e.setPortMode(e.getTrackPort(l),1,w[u]);let a="",s=90,n=0,c=0,d="MSB	PRG	LSB	NME";B(r,function(h,g){if(g<13600){let E=g%136;switch(!0){case E<10:{h>31&&(a+=String.fromCharCode(h));break}case E==11:{d+=`
${s}	${n}	${c}	${a.trim().replace("Init Combi","")}`,n++,a="";break}}}}),e.userBank.clearRange({msb:90,prg:[0,99],lsb:0}),e.userBank.load(d),T()&&console.debug(d),e.forceVoiceRefresh()}).add([54,78],(r,l)=>{let u=e.#t.x5=="81"?"05rw":"x5d";e.switchMode(u),e.setPortMode(e.getTrackPort(l),1,w[u]),console.debug(`X5D mode switch requested: ${["combi","combi edit","prog","prog edit","multi","global"][r[0]]} mode.`)}).add([54,85],(r,l)=>{e.dispatchEvent("mupromptex");let u=e.#t.x5=="81"?"05rw":"x5d";e.switchMode(u),e.setPortMode(e.getTrackPort(l),1,w[u]),B(r,(a,s)=>{s>0&&s<3&&(e.setEffectType(s-1,44,a),e.dispatchEvent(`efx${["reverb","chorus"][s-1]}`,e.getEffectType(s-1)))})}).add([54,104],(r,l)=>{e.dispatchEvent("mupromptex");let u=e.#t.x5=="81"?"05rw":"x5d";e.switchMode(u,!0);let a=e.getTrackPort(l);if(e.#k[a]&&e.#k[a]!=w[u])if(e.#S.dumpLimit==e.DUMP_MODE){console.warn(`Dump cancelled for track ${l}. Port ${String.fromCharCode(65+a)} mode "${P[e.#k[a]]}" mismatch, should be "${u}".`);return}else console.info(`Track ${l} is trying to perform a mismached mode dump on port ${String.fromCharCode(65+a)}.`);e.setPortMode(a,1,w[u]),B(r,function(s,n,c,d){if(n<192){let h=e.chRedir(Math.floor(n/12),l,!0),g=S[h];switch(n%12){case 0:{s<128?(e.setChType(h,e.CH_MELODIC,w.x5d),e.#e[g+v[0]]=e.#t.x5,e.#r[h]=s):(e.setChType(h,e.CH_DRUMS,w.x5d),e.#e[g+v[0]]=62,e.#r[h]=Ne[s-128]),s>0&&e.setChActive(h,1),e.pushChPrimitives(h),e.dispatchEvent("voice",{part:h});break}case 1:{e.#e[g+v[7]]=s;break}case 2:{e.#s[h*b.rpn+3]=s>127?s-192:64+s,e.#c[b.rpnt*h+2]=1,e.dispatchEvent("pitch",{part:h,pitch:e.getPitchShift(h)});break}case 3:{e.#s[h*b.rpn+1]=s>127?s-192:64+s,e.#c[b.rpnt*h+1]=1,e.dispatchEvent("pitch",{part:h,pitch:e.getPitchShift(h)});break}case 4:{s<31&&(e.#e[g+v[10]]=Math.round((s-15)*4.2+64));break}case 5:{let E=s>>4,C=s&15;e.#e[g+v[91]]=Z(C),e.#e[g+v[93]]=Z(E);break}case 10:{e.#i[h]||(e.#e[g+v[0]]=s>>6?56:e.#t.x5,e.pushChPrimitives(h),e.dispatchEvent("voice",{part:h}));break}case 11:{let E=e.chRedir(s&15,l,!0),C=s>>4;e.#u[h]=s,(E!=h||C)&&(console.info(`X5D Part CH${h+1} receives from CH${E+1}.`),e.buildRchTree())}}}else{let h=e.chRedir(n-192,l,!0)}})}),this.#F.add([22,18,127],(r,l,u)=>{e.switchMode("mt32",!0),e.setPortMode(e.getTrackPort(l),1,w.mt32),e.#y=!1,e.userBank.clearRange({msb:0,lsb:127,prg:[0,127]}),console.info("MIDI reset: MT-32")}).add([22,18,0],(r,l,u)=>{e.switchMode("mt32");let a=e.chRedir(u,l,!0),s=r[1];r.subarray(2).forEach((n,c)=>{let d=c+s;e.#G[d+(a-1)*16]=n,([!1,()=>{let h=e.#G[a-1<<4];if(h<3){if(e.#l[a]=1,h==2)for(let g=0;g<name.length;g++)e.#D[(a-1)*b.cmt+g]=e.#$[n*b.cmt+g];else{let g=e.baseBank.get(0,n+(h<<6),127,"mt32").name;for(let E=0;E<g.length;E++)e.#D[(a-1)*b.cmt+E]=g.charCodeAt(E)}e.dispatchEvent("voice",{part:a})}},()=>{e.#s[a*b.rpn+3]=n+40,e.#c[b.rpnt*a+2]=1},()=>{e.#s[a*b.rpn+1]=n+14,e.#c[b.rpnt*a+1]=1},()=>{e.#s[a*b.rpn]=n,e.#c[b.rpnt*a]=1},!1,()=>{e.setChCc(a,91,n?127:0)},!1,()=>{e.setChCc(a,7,n)},()=>{e.setChCc(a,10,Math.ceil(n*9.05))}][d]||(()=>{}))()})}).add([22,18,1],(r,l,u)=>{e.switchMode("mt32");let a=u&7;console.debug(`MT-32 slot #${u+1} Drum: ${r}`);let s=r[0]<<7|r[1];r.subarray(2).forEach((n,c)=>{let d=c+s,h=(d>>2)+24,g=d&3,E=a*b.dpn;if(T()&&console.debug(`MT-32 temp drum note ${h} param ${g}: ${n}`),h<24){console.warn(`MT-32 dev drum write attempted on an OOB note: ${h}`);return}[()=>{},()=>{e.#R[(E+O[26])*b.dnc+h]=Math.round(n*1.27)},()=>{e.#R[(E+O[26])*b.dnc+h]=n*9+1&127},()=>{e.#R[(E+O[26])*b.dnc+h]=n?127:0}][g]()})}).add([22,18,2],(r,l,u)=>{e.switchMode("mt32");let a=e.chRedir(u,l,!0),s=r[1]+(r[0]<<7);s<10&&(e.#l[a]=1),r.subarray(2).forEach((n,c)=>{let d=c+s;d<14&&(e.#D[(a-1)*b.cmt+d]=n)}),e.dispatchEvent("voice",{part:a})}).add([22,18,3],(r,l,u)=>{e.switchMode("mt32");let a=u&7;if(r[0]){let s=(r[0]-1<<7)+r[1]-16;r.subarray(2).forEach((n,c)=>{let d=c+s,h=(d>>2)+24,g=d&3,E=a*b.dpn;if(T()&&console.debug(`MT-32 dev drum note ${h} param ${g}: ${n}`),h<24){console.warn(`MT-32 dev drum write attempted on an OOB note: ${h}`);return}[()=>{},()=>{e.#R[(E+O[26])*b.dnc+h]=Math.round(n*1.27)},()=>{e.#R[(E+O[26])*b.dnc+h]=n*9+1&127},()=>{e.#R[(E+O[26])*b.dnc+h]=n?127:0}][g]()})}else{let s=r[1];r.subarray(2).forEach((n,c)=>{let d=c+s;e.#G[d]=n;let h=e.chRedir(1+(d>>4),l,!0),g=d&15;([!1,()=>{let E=e.#G[h-1<<4];if(E<3)if(e.#l[h]=1,E==2)for(let C=0;C<name.length;C++)e.#D[(h-1)*b.cmt+C]=e.#$[n*b.cmt+C];else{let C=e.baseBank.get(0,n+(E<<6),127,"mt32").name;for(let $=0;$<C.length;$++)e.#D[(h-1)*b.cmt+$]=C.charCodeAt($)}e.dispatchEvent("voice",{part:h})},()=>{e.#s[h*b.rpn+3]=n+40,e.#c[b.rpnt*h+2]=1},()=>{e.#s[h*b.rpn+1]=n+14,e.#c[b.rpnt*h+1]=1},()=>{e.#s[h*b.rpn]=n,e.#c[b.rpnt*h]=1},!1,()=>{e.setChCc(h,91,n?127:0)},!1,()=>{e.setChCc(h,7,n)},()=>{e.setChCc(h,10,Math.ceil(n*9.05))}][g]||(()=>{}))()})}}).add([22,18,4],(r,l,u)=>{e.switchMode("mt32");let a=r[1]+(r[0]<<7),s=[];r.subarray(2).forEach((n,c)=>{let d=c+a,h=e.chRedir(Math.floor(d/246+1),l,!0),g=d%246;g<14&&(e.#D[(h-1)*b.cmt+g]=n),g<10&&(e.#l[h]=1),s.indexOf(h)<0&&s.push(h)}),s.forEach(n=>{e.dispatchEvent("voice",{part:n})})}).add([22,18,5],(r,l,u)=>{e.switchMode("mt32");let a=(r[0]<<7)+r[1];r.subarray(2).forEach((s,n)=>{let c=a+n,d=Math.floor(c/8),h=c&7,g=d*8;e.#V[c]=s,([!1,()=>{let E=e.#V[g];if(E<3){let C="";if(E==2){let x=b.cmt*d;C=`MT-m:${s.toString().padStart(3,"0")}`}else C=e.baseBank.get(0,s+(E<<6),127,"mt32").name;e.userBank.clearRange({msb:0,lsb:127,prg:d});let $=`MSB	LSB	PRG	NME
49	127	${d}	${C}`;e.userBank.load($,!0)}}][h]||(()=>{}))()}),e.forceVoiceRefresh()}).add([22,18,8],(r,l,u)=>{e.switchMode("mt32");let a=((r[0]&1)<<7)+r[1],s=r[0]>>1,n=!1;if(r.subarray(2).forEach((c,d)=>{let h=a+d;h<b.cmt&&(e.#$[s*b.cmt+h]=c,n=!0)}),n){e.userBank.clearRange({msb:0,lsb:127,prg:s});let c=`MSB	LSB	PRG	NME
49	127	${s}	MT-m:${s}`;e.userBank.load(c,!0)}e.forceVoiceRefresh()}).add([22,18,16],(r,l,u)=>{e.switchMode("mt32");let a=r[1],s=!1,n=function(c,d){e.#u[d-12]=c,s=!0};r.subarray(2).forEach((c,d)=>{let h=d+a;([!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,n,n,n,n,n,n,n,n,n,()=>{e.#n=c,e.dispatchEvent("mastervolume",e.#n)}][h]||(()=>{}))(c,d)}),s&&e.buildRchTree()}).add([22,18,32],(r,l,u)=>{e.switchMode("mt32");let a=r[1],s=" ".repeat(a);r.subarray(2).forEach(n=>{n>31?s+=String.fromCharCode(n):s+=" "}),e.#K=s.padStart(20," "),e.#z=Date.now()+3200}).add([22,18,82],(r,l)=>{let u=e.chRedir(0,l,!0);for(let a=0;a<16;a++)e.#P.ano(u+a),a&&a<10&&(e.#r[u+a]=de[a-1]);console.info("MT-32 alt reset complete.")}),this.#ee.add([66,0],(r,l)=>{e.switchMode("ns5r",!0),e.setPortMode(e.getTrackPort(l),2,w.ns5r),e.#y=!1,console.debug(`NS5R mode switch requested: ${["global","multi","prog edit","comb edit","drum edit","effect edit"][r[0]]} mode.`)}).add([66,1],(r,l)=>{let u=["ns5r","05rw"][r[0]];e.switchMode(u,!0),e.setPortMode(e.getTrackPort(l),2,w[u]),e.#y=!1}).add([66,18,0,0],(r,l)=>{let u=r[0];switch(u){case 124:case 126:case 127:{e.switchMode("ns5r",!0),e.setPortMode(e.getTrackPort(l),2,w.ns5r),e.#y=!1;break}case 125:{e.initDrums(),console.info(`NS5R drum setup reset: ${r}`);break}default:if(u<10){let a=[0,0,0,0],s=(n,c)=>{a[c]=n};if(r.subarray(1).forEach((n,c)=>{[s,s,s,s,()=>{e.#n=n*129/16383*100,e.dispatchEvent("mastervolume",e.#n)},()=>n-64,()=>n-64,()=>{},()=>{},()=>{}][u+c]()}),r[0]<4){let n=0;a.forEach(c=>{n=n<<4,n+=c}),n-=1024}}}}).add([66,18,0,1],(r,l)=>{}).add([66,18,0,2],(r,l)=>{}).add([66,18,1],(r,l)=>{e.dispatchEvent("mupromptex");let u=e.chRedir(r[0],l,!0),a=S[u],s=r[1],n=`NS5R CH${u+1} `;r.subarray(2).forEach((c,d)=>{let h=s+d;h<3?([()=>{e.#e[a+v[0]]=c||U.bank0,e.pushChPrimitives(u)},()=>{e.#e[a+v[32]]=c,e.pushChPrimitives(u)},()=>{e.#r[u]=c}][h](),e.dispatchEvent("voice",{part:u})):h<8||(h<14?[()=>{let g=e.chRedir(c,l,!0);e.#u[u]=g,u!=g&&(e.buildRchTree(),console.info(`${n}receives from CH${g+1}`))},()=>{e.#m[u]=+!c},()=>{e.setChType(u,c,w.ns5r),console.debug(`${n}type: ${Q[c]}`)},()=>{e.#s[b.rpn*u+3]=c,e.#c[b.rpnt*u+2]=1,e.dispatchEvent("pitch",{part:u,pitch:e.getPitchShift(u)})},()=>{},()=>{}][h-8]():h<16||(h<33?[()=>{e.#e[a+v[7]]=c},()=>{e.#e[a+v[11]]=c},()=>{},()=>{},()=>{e.#e[a+v[10]]=c||128},()=>{},()=>{},()=>{e.#e[a+v[93]]=c},()=>{e.#e[a+v[91]]=c},()=>{e.#e[a+v[76]]=c},()=>{e.#e[a+v[77]]=c},()=>{e.#e[a+v[78]]=c},()=>{e.#e[a+v[74]]=c},()=>{e.#e[a+v[71]]=c},()=>{e.#e[a+v[73]]=c},()=>{e.#e[a+v[75]]=c},()=>{e.#e[a+v[72]]=c}][h-16]():h<112||h<114&&[()=>{e.#e[a+v[5]]=c},()=>{e.#e[a+v[65]]=c}][h-112]()))})}).add([66,18,8,0],(r,l)=>{let u=r[0];if(u<32)e.setLetterDisplay(r.subarray(1,33),"NS5R letter display");else{let a=u-32;e.#E=Date.now()+3200,e.#f=10,e.#w.fill(0);let s=r.subarray(1),n=4;s.forEach(function(c,d){let h=d+a,g=h>>4,E=h&15;if(h<80){let C=g<n?c:c>>3,$=0,x=g<n?6:3;for(;C>0;)e.#w[E*32+g*7+(x-$)]=C&1,C=C>>1,$++}})}}).add([66,18,48],(r,l,u)=>{f(0,r)}).add([66,18,49],(r,l,u)=>{f(1,r)}).add([66,18,50],(r,l,u)=>{f(2,r)}).add([66,18,51],(r,l,u)=>{f(3,r)}).add([66,18,52],(r,l,u)=>{f(4,r)}).add([66,18,53],(r,l,u)=>{f(5,r)}).add([66,18,54],(r,l,u)=>{f(6,r)}).add([66,18,55],(r,l,u)=>{f(7,r)}).add([66,52],(r,l)=>{e.switchMode("ns5r"),e.#y=!1;let u="";B(r,(a,s)=>{s<8?(a>31&&(u+=String.fromCharCode(a)),s==7&&(e.aiEfxName=u)):s<10&&(e.setEffectType(s-8,44,a),e.dispatchEvent(`efx${["reverb","chorus"][s-8]}`,e.getEffectType(s-8)))})}).add([66,53],(r,l)=>{e.dispatchEvent("mupromptex"),e.switchMode("ns5r"),e.#y=!1;let u="",a=r[r.length-1],s=r.subarray(0,r.length-1),n=F(s);n!=a&&(console.info(`NS5R current multi dump checksum mismatch! Expected ${n}, got ${a}.`),console.debug(r));let c=e.getTrackPort(l);if(e.#k[c]&&e.#k[c]!=w.ns5r)if(e.#S.dumpLimit==e.DUMP_MODE){console.warn(`Dump cancelled for track ${l}. Port ${String.fromCharCode(65+c)} mode "${P[e.#k[c]]}" mismatch, should be "ns5r".`);return}else console.info(`Track ${l} is trying to perform a mismached mode dump on port ${String.fromCharCode(65+c)}.`);e.setPortMode(c,2,w.ns5r),B(s,function(d,h){switch(!0){case h<2944:{let g=e.chRedir(Math.floor(h/92),l,!0),E=S[g];switch(h%92){case 0:{e.#e[E+v[0]]=d,e.pushChPrimitives(g),e.dispatchEvent("voice",{part:g});break}case 1:{e.#e[E+v[32]]=d,!d&&!e.#e[E+v[0]]&&(e.#e[E+v[0]]=U.bank0),e.pushChPrimitives(g),e.dispatchEvent("voice",{part:g});break}case 2:{e.#r[g]=d,d>0&&e.setChActive(g,1),e.dispatchEvent("voice",{part:g});break}case 3:{let C=e.chRedir(d,l,!0);e.#u[g]=C,g!=C&&(console.info(`NS5R CH${g+1} receives from CH${C+1}.`),e.buildRchTree());break}case 7:{e.#i[g]=d,e.dispatchEvent("voice",{part:g});break}case 8:{e.#s[g*b.rpn+3]=d<40||d>88?d+(d>63?-192:64):d,e.#c[b.rpnt*g+2]=1,e.dispatchEvent("pitch",{part:g,pitch:e.getPitchShift(g)});break}case 9:case 10:{e.#e[E+v[7]]=d;break}case 11:{e.#e[E+v[11]]=d;break}case 14:{e.#e[E+v[10]]=d||128;break}case 19:{e.#e[E+v[93]]=d;break}case 20:{e.#e[E+v[91]]=d;break}case 84:{e.#e[E+v[65]]=d;break}case 85:{e.#e[E+v[5]]=d;break}}break}case h<3096:break;case h<3134:{let g=h-3096;g<8?(d>31&&(u+=String.fromCharCode(d)),g==7&&(e.aiEfxName=u)):g<10&&(e.setEffectType(g-8,44,d),e.dispatchEvent(`efx${["reverb","chorus"][g-8]}`,e.getEffectType(g-8)));break}case h<8566:break}})}).add([66,54],(r,l)=>{e.dispatchEvent("mupromptex"),e.switchMode("ns5r");let u="",a=80,s=0,n=0,c="MSB	PRG	LSB	NME";B(r,function(d,h){let g=h%158;switch(!0){case g<10:{d>31&&(u+=String.fromCharCode(d));break}case g==10:break;case g==11:{a=d&127;break}case g==12:{n=d&127;break}case g==13:{c+=`
${a}	${s}	${n}	${u.trim().replace("Init Voice","")}`,s++,u="";break}}}),e.userBank.clearRange({msb:80,lsb:0}),e.userBank.load(c),T()&&console.debug(c),e.forceVoiceRefresh()}).add([66,55],(r,l)=>{e.dispatchEvent("mupromptex"),e.switchMode("ns5r");let u="",a=88,s=0,n=0,c="MSB	PRG	LSB	NME";B(r,function(d,h){let g=h%126;switch(!0){case g<10:{d>31&&(u+=String.fromCharCode(d));break}case g==11:break;case g==12:break;case g==13:{c+=`
${a}	${s}	${n}	${u.trim().replace("Init Combi","")}`,s++,u="";break}}}),e.userBank.clearRange({msb:88,lsb:0}),e.userBank.load(c),T()&&console.debug(c),e.forceVoiceRefresh()}).add([66,125],(r,l,u)=>{e.dispatchEvent("backlight",["green","orange","red",!1,"yellow","blue","purple"][r[0]]||"white")}).add([66,127],(r,l,u)=>{let a=r[r.length-1],s=r.subarray(0,r.length-1),n=F(s);n!=a&&(console.info(`NS5R screen dump checksum mismatch! Expected ${n}, got ${a}.`),console.debug(r));let c=new Uint8Array(5760);B(r,(d,h,g)=>{if(h<720)for(let E=0;E<8;E++)c[h*8+E]=d>>7-E&1}),e.dispatchEvent("screen",{type:"ns5r",data:c})}).add([76],(r,l,u)=>{e.#ee.run([66,...r],l,u)}),this.#le.add([16,0,8,0],(r,l,u)=>{let a=(r[2]<<4)+r[3],s="K11 ";([()=>{e.switchMode("k11",!0),e.setPortMode(e.getTrackPort(l),2,w.k11),e.#y=!1,e.#v[w.k11][1]=a?4:0,console.info("MIDI reset: GMega/K11")},()=>{e.setEffectType(0,24,a),console.debug(`${s}reverb type: ${a}`),e.dispatchEvent("efxreverb",e.getEffectType(0))},()=>{console.debug(`${s}reverb time: ${a}`)},()=>{console.debug(`${s}reverb time: ${a}`)},()=>{console.debug(`${s}reverb predelay: ${a}`)},()=>{console.debug(`${s}reverb predelay: ${a}`)},()=>{console.debug(`${s}depth high: ${a}`)},()=>{console.debug(`${s}depth high: ${a}`)},()=>{console.debug(`${s}depth low: ${a}`)},()=>{console.debug(`${s}depth low: ${a}`)}][r[0]]||(()=>{}))()}).add([16,0,8,1],(r,l,u)=>{e.dispatchEvent("mupromptex");let a=e.chRedir(r[1],l,!0),s=S[a],n=ee[a],c=(r[3]<<4)+r[4],d=`K11 CH${a+1} `;([()=>{c<128?(e.setChType(a,e.CH_MELODIC,w.k11),e.#e[s+v[0]]=0,e.#r[a]=c):(e.setChType(a,e.CH_DRUMS,w.k11),e.#r[a]=c-128),e.pushChPrimitives(a),e.dispatchEvent("voice",{part:a})},()=>{let h=e.chRedir(c,l,!0);e.#u[a]=h,a!=h&&(e.buildRchTree(),console.info(`${d}receives from CH${h+1}`))},()=>{e.#e[s+v[7]]=c},()=>{uupThis.setChActive(a,c)},()=>{e.#e[s+v[10]]=c},()=>{e.#s[n+3]=c+40,e.#c[b.rpnt*a+2]=1,e.dispatchEvent("pitch",{part:a,pitch:e.getPitchShift(a)})},()=>{e.#s[n+1]=c>>1,e.#s[n+2]=c&1,e.#c[b.rpnt*a+1]=1,e.dispatchEvent("pitch",{part:a,pitch:e.getPitchShift(a)})},()=>{e.#e[s+v[91]]=c?127:0},()=>{},()=>{e.#e[s+v[74]]=c},()=>{e.#e[s+v[73]]=c},()=>{e.#e[s+v[72]]=c}][r[0]]||(()=>{}))()}).add([16,0,9,0],(r,l,u)=>{e.dispatchEvent("mupromptex");let a=(r[2]<<4)+r[3],s="GMLX ";([()=>{console.debug(`${s}reverb type: ${a}`)},()=>{console.debug(`${s}reverb time: ${a}`)},()=>{console.debug(`${s}reverb predelay: ${a}`)},()=>{console.debug(`${s}depth high: ${a}`)},()=>{console.debug(`${s}depth low: ${a}`)}][r[0]]||(()=>{}))()}).add([16,0,9,3],(r,l,u)=>{e.dispatchEvent("mupromptex");let a=(r[2]<<4)+r[3],s=e.chRedir(r[1],l,!0),n=S[s];[()=>{a<128?(e.setChType(s,e.CH_MELODIC,w.k11),e.#e[n+v[0]]=0,e.#e[n+v[32]]=0,e.#r[s]=a):a<160?(e.setChType(s,e.CH_MELODIC,w.k11),e.#e[n+v[0]]=0,e.#e[n+v[32]]=7,e.#r[s]=a-100):(e.setChType(s,e.CH_DRUMS,w.k11),e.#e[n+v[0]]=122,e.#e[n+v[32]]=0,e.#r[s]=a-160),e.pushChPrimitives(s),e.dispatchEvent("voice",{part:s})},()=>{let c=e.chRedir(a,l,!0);e.#u[s]=c,s!=c&&(e.buildRchTree(),console.info(`GMLX CH${s+1} receives from CH${c+1}`))}][r[0]]()}).add([16,0,9,4],(r,l,u)=>{e.dispatchEvent("mupromptex");let a=(r[2]<<4)+r[3],s=e.chRedir(r[1],l,!0),n=S[s],c=ee[s],d=`GMLX CH${s+1} `;[()=>{e.setChActive(s,a)},()=>{e.#e[n+v[7]]=a},()=>{e.#e[n+v[10]]=a},()=>{e.#e[n+v[91]]=a?127:0},()=>{e.#s[c+3]=a+40,e.#c[b.rpnt*s+2]=1,e.dispatchEvent("pitch",{part:s,pitch:e.getPitchShift(s)})},()=>{e.#s[c+1]=a,e.#c[b.rpnt*s+1]=1,e.dispatchEvent("pitch",{part:s,pitch:e.getPitchShift(s)})},()=>{e.#s[c]=a,e.#c[b.rpnt*s]=1,e.dispatchEvent("pitch",{part:s,pitch:e.getPitchShift(s)})},()=>{}][r[0]]()}),this.#de.add([66,93,64],(r,l,u)=>{let a=r[2];switch(r[0]){case 0:{switch(r[1]){case 4:{e.dispatchEvent("mupromptex"),e.#n=a*129/16383*100,e.dispatchEvent("mastervolume",e.#n);break}case 5:{e.dispatchEvent("mupromptex"),a-64;break}case 6:{e.dispatchEvent("mupromptex"),console.debug(`SG global reverb: ${a?"on":"off"}`);break}case 127:{e.switchMode("sg",!0),e.setPortMode(e.getTrackPort(l),1,w.sg);break}}break}case 1:{switch(r[1]){case 48:{e.dispatchEvent("mupromptex"),console.debug(`SG reverb type: ${oe[a]}`);break}}break}default:if(r[0]>>4==1){e.dispatchEvent("mupromptex");let s=e.chRedir(r[0]&15,l,!0);if(r[1]==2){let n=e.chRedir(a,l,!0);e.#u[s]=n,s!=n&&(e.buildRchTree(),console.info(`SG CH${s+1} receives from CH${n+1}`))}else r[1]==19&&e.setChCc(s,7,a)}else console.warn(`Unknown AKAI SG SysEx: ${r}`)}}),this.#he.add([9],(r,l,u)=>{e.dispatchEvent("mupromptex"),console.debug(`GZ set effect: ${["stage reverb","hall reverb","room reverb","chorus","tremolo","phaser","rotary speaker","enhancer","flanger","EQ"][r[0]]||"off"}`)}),this.#H.add([127,0],(r,l,u)=>{e.switchMode("motif");let a=new Uint8Array([127,1,...r]);e.#H.run(a,l,u)}).add([127,1,0,0],(r,l,u)=>{e.switchMode("s90es");let a="S90/Motif ES system ",s=r[0];r.subarray(1).forEach((n,c)=>{([()=>{e.#n=n*12900/16383,e.dispatchEvent("mastervolume",e.#n)}][s+c]||(()=>{console.info(`Unrecognized ${a}ID: ${s+c}`)}))()})}).add([127,1,0,36,54,1],(r,l,u)=>{e.switchMode("s90es");let a="S90/Motif ES reverb ",s=r[0];r.subarray(1).forEach((n,c)=>{([()=>{e.setEffectTypeRaw(0,!1,n&15|112)},()=>{e.setEffectTypeRaw(0,!0,n)}][s+c]||(()=>{}))()}),e.dispatchEvent("efxreverb",e.getEffectType(0))}).add([127,1,0,37,54,2],(r,l,u)=>{e.switchMode("s90es");let a="S90/Motif ES chorus ",s=r[0];r.subarray(1).forEach((n,c)=>{([()=>{e.setEffectTypeRaw(1,!1,n&15|112)},()=>{e.setEffectTypeRaw(1,!0,n)}][s+c]||(()=>{}))()}),e.dispatchEvent("efxchorus",e.getEffectType(1))}).add([127,1,0,34,54,3],(r,l,u)=>{e.switchMode("s90es");let a="S90/Motif ES insert 1 ",s=r[0];r.subarray(1).forEach((n,c)=>{([()=>{e.setEffectTypeRaw(3,!1,n&15|112)},()=>{e.setEffectTypeRaw(3,!0,n)}][s+c]||(()=>{}))()}),e.dispatchEvent("efxinsert0",e.getEffectType(3))}).add([127,1,0,34,54,4],(r,l,u)=>{e.switchMode("s90es");let a="S90/Motif ES insert 2 ",s=r[0];r.subarray(1).forEach((n,c)=>{([()=>{e.setEffectTypeRaw(4,!1,n&15|112)},()=>{e.setEffectTypeRaw(4,!0,n)}][s+c]||(()=>{}))()}),e.dispatchEvent("efxinsert1",e.getEffectType(4))}).add([127,1,0,35,54,17],(r,l,u)=>{e.switchMode("s90es");let a="S90/Motif ES variation ",s=r[0];r.subarray(1).forEach((n,c)=>{([()=>{e.setEffectTypeRaw(2,!1,n&15|112)},()=>{e.setEffectTypeRaw(2,!0,n)}][s+c]||(()=>{}))()}),e.dispatchEvent("efxdelay",e.getEffectType(2))}).add([127,1,0,58,55],(r,l,u)=>{e.dispatchEvent("mupromptex"),e.switchMode("s90es");let a=e.getTrackPort(l);if(e.#k[a]&&e.#k[a]!=e.#t.smotif)if(e.#S.dumpLimit==e.DUMP_MODE){console.warn(`Dump cancelled for track ${l}. Port ${String.fromCharCode(65+a)} mode "${P[e.#k[a]]}" mismatch, should be "${P[e.#t.smotif]}".`);return}else console.info(`Track ${l} is trying to perform a mismached mode dump on port ${String.fromCharCode(65+a)}.`);let s=e.chRedir(r[0],l,!0),n=S[s],c=r[1];r[0]>15&&(s=r[0]+32);let d=`Track ${l} S90/Motif ES bulk CH${s<128?s+1:"U"+(s-127)} `;console.debug(d,r),!(r[0]>15)&&r.subarray(2).forEach((h,g)=>{([()=>{e.#e[n+v[0]]=h,e.pushChPrimitives(s),e.dispatchEvent("voice",{part:s})},()=>{h&&e.setChActive(s,1),e.#e[n+v[32]]=h,e.getChPrimitive(s,1)==63&&e.setChType(s,[32,40].indexOf(h)>-1?e.CH_DRUMS:e.CH_MELODIC,e.#a,!0),e.pushChPrimitives(s),e.dispatchEvent("voice",{part:s})},()=>{h&&e.setChActive(s,1),e.#r[s]=h,e.dispatchEvent("voice",{part:s})},()=>{let E=e.chRedir(h,l,!0);e.#u[s]=E,s!=E&&(e.buildRchTree(),console.info(`${d}receives from CH${E+1}`))},()=>{e.#m[s]=h?0:1},!1,!1,!1,!1,!1,!1,!1,!1,()=>{h!=100&&e.setChActive(s,1),e.#e[n+v[7]]=h},()=>{h!=64&&e.setChActive(s,1),e.#e[n+v[10]]=h},!1,!1,!1,()=>{e.#e[n+v[91]]=h},()=>{h&&e.setChActive(s,1),e.#e[n+v[93]]=h},()=>{h&&e.setChActive(s,1),e.#e[n+v[94]]=h},()=>{h!=127&&e.setChActive(s,1),e.#e[n+v[128]]=h,e.allocateAce(s,128)},()=>{},()=>{h!=64&&e.setChActive(s,1),e.#e[n+v[74]]=h},()=>{h!=64&&e.setChActive(s,1),e.#e[n+v[71]]=h},!1,()=>{e.#e[n+v[65]]=h},()=>{e.#e[n+v[5]]=h},()=>{}][c+g]||(()=>{}))()})}).add([127,1,54,16],(r,l,u)=>{e.switchMode("s90es");let a=r[0];r.subarray(1).forEach((s,n)=>{let d=`S90/Motif ES EQ${(n>>2)+1} `;([()=>{let h=s-64},()=>{let h=z[s]},()=>{let h=s/10},()=>{let h=s}][a+n&3]||(()=>{}))()})}),this.#F.add([0,72,18,0,0,0,0],(r,l,u)=>{e.switchMode("sd",!0),e.setPortMode(e.getTrackPort(l),2,w.sd),console.info("MIDI reset: SD")}).add([0,72,18,16,0],(r,l,u)=>{e.dispatchEvent("mupromptex");let a=r[0]>>5,s=r[0]&31;switch(a){case 0:{let n=r[0]>>1,c=r[1];switch(n){case 1:{r.subarray(2).forEach((d,h,g)=>{let E=h+c;switch(E){case 0:{d&&(e.setEffectType(1,60,d-1),e.dispatchEvent("efxchorus",e.getEffectType(1)),console.debug(`SD MFX Cho: ${E} - ${d}`));break}}});break}case 2:{r.subarray(2).forEach((d,h)=>{let g=h+c;switch(g){case 0:{d&&(e.setEffectType(0,55+d,0),e.dispatchEvent("efxreverb",e.getEffectType(0)),console.debug(`SD MFX Rev: ${g} - ${d}`));break}}});break}case 3:case 4:case 5:{let d=n-1;r.subarray(2).forEach((h,g)=>{let E=g+c;switch(console.debug(`SD MFX ${d-2}: ${E} - ${h}`),E){case 0:{e.setEffectTypeRaw(d,62,h),e.dispatchEvent(`efx${d>2?"delay":"insert"+(d-4)}`,e.getEffectType(d));break}}}),console.debug(`SD MFX message:
%o`,r);break}default:console.debug(`Unknown SD-90 global effects message:
%o`,r)}break}case 1:{let n=e.chRedir(s,l,!0),c=r[1],d=S[n];r.subarray(2).forEach((h,g)=>{let E=c+g;E<37?([()=>{},()=>{},0,()=>{},()=>{switch(e.#e[d+v[0]]=h,h){case 104:case 105:case 106:case 107:case 120:{e.#i[n]||e.setChType(n,e.CH_DRUMS);break}default:e.#i[n]&&e.setChType(n,e.CH_MELODIC)}e.pushChPrimitives(n),e.dispatchEvent("voice",{part:n})},()=>{e.#e[d+v[32]]=h,e.pushChPrimitives(n),e.dispatchEvent("voice",{part:n})},()=>{e.#r[n]=h,e.dispatchEvent("voice",{part:n})},()=>{e.#e[d+v[7]]=h},()=>{e.#e[d+v[10]]=h},()=>{},()=>{},()=>{h<2&&(e.#m[n]=h)},()=>{h<2&&(e.#e[d+v[68]]=h?127:0)},()=>{},()=>{h<2&&(e.#e[d+v[65]]=h?127:0)},()=>{e.#e[d+v[5]]=h&15<<4|e.#e[d+v[5]]&15},()=>{e.#e[d+v[5]]=h&15|(e.#e[d+v[5]]&240)>>4},()=>{e.#e[d+v[74]]=h},()=>{e.#e[d+v[71]]=h},()=>{e.#e[d+v[73]]=h},()=>{e.#e[d+v[72]]=h},0,0,0,0,0,0,0,()=>{e.#e[d+v[128]]=h,e.allocateAce(128)},()=>{e.#e[d+v[93]]=h},()=>{e.#e[d+v[91]]=h},0,0,()=>{e.#e[d+v[75]]=h},()=>{e.#e[d+v[76]]=h},()=>{e.#e[d+v[77]]=h},()=>{e.#e[d+v[78]]=h}][E]||(()=>{}))():E<63||(E<64?(e.#i[n]?(e.#e[d+v[0]]=104|h,e.pushChPrimitives(n),e.dispatchEvent("voice",{part:n})):(e.#e[d+v[0]]=96|h,e.pushChPrimitives(n),e.dispatchEvent("voice",{part:n})),e.dispatchEvent("voice",{part:n})):console.debug(`Unknown SD-90 global CH${n+1} param setup message:
%o`,r))});break}case 2:{let n=e.chRedir(s,l,!0),c=r[1];console.debug(`Unknown SD-90 global CH${n+1} MIDI setup message:
%o`,r.subarray(2));break}default:console.warn(`Unknown SD-90 global part setup message:
%o`,r)}}),e.#ee.add([0,1,73,78],(r,l,u)=>{e.switchMode("krs"),e.setPortMode(e.getTrackPort(l),1,w.krs),console.debug("Might be KORG KROSS 2 mode reset... Not sure.")}).add([0,1,73,117,2,37],(r,l,u)=>{e.switchMode("krs");let a=e.getTrackPort(l);if(e.#k[a]&&e.#k[a]!=w.krs)if(e.#S.dumpLimit==e.DUMP_MODE){console.warn(`Dump cancelled. Port ${String.fromCharCode(65+a)} mode "${P[e.#k[a]]}" mismatch, should be "krs".`);return}else console.info(`Track ${l} is trying to perform a mismached mode dump on port ${String.fromCharCode(65+a)}.`);e.setPortMode(e.getTrackPort(l),1,w.krs);let s="KROSS 2 BMT1 ",n="";B(r,(c,d)=>{if(d<24)n+=String.fromCharCode(Math.max(32,c));else if(!(d<1276)){let h=d-1276,g=e.chRedir(Math.floor(h/44),l,!0),E=h%44,C=S[g];E<15?([()=>{c&&e.setChActive(g,1),e.#r[g]=c,e.dispatchEvent("voice",{part:g})},()=>{c&&e.setChActive(g,1),c<10?(e.#e[C+v[0]]=63,e.#e[C+v[32]]=c):c<20?(e.#e[C+v[0]]=121,e.#e[C+v[32]]=c-10):c<24&&(e.#e[C+v[0]]=[120,0,56,62][c-20],e.#e[C+v[32]]=0),e.pushChPrimitives(g),e.dispatchEvent("voice",{part:g})},()=>{let $=e.chRedir(c&15,l,!0);e.#u[g]=$,console.info(`${s}CH${g+1} receives from CH${$+1}`)},!1,!1,()=>{e.#e[C+v[7]]=c},!1,()=>{},()=>{},!1,!1,!1,!1,!1,()=>{e.#e[C+v[10]]=c||128}][E]||(()=>{}))():E<36||([()=>{e.#e[C+v[74]]=(c+128&255)-64},()=>{e.#e[C+v[71]]=(c+128&255)-64},!1,!1,()=>{e.#e[C+v[73]]=(c+128&255)-64},()=>{e.#e[C+v[75]]=(c+128&255)-64},!1,()=>{e.#e[C+v[72]]=(c+128&255)-64}][E]||(()=>{}))()}}),n=n.trimRight(),e.dispatchEvent("metacommit",{type:"EORTitle",data:n})})}};var me=ct(_e(),1);var Fe=class{#a=!1;constructor(e,t,i,o){this.#a=e,this.start=t,this.end=i,this.data=o}get duration(){return this.ranged?this.end-this.start:0}get ranged(){return this.#a}},pe=class extends Fe{constructor(e,t,i){super(!0,e,t,i)}},Ke=class extends Fe{constructor(e,t){super(!1,e,e,t)}},ge=class extends Array{#a=-1;constructor(){super(...arguments)}resetIndex(e){this.#a=-1}fresh(){this.sort(function(e,t){return e.start==t.start?0:(+(e.start>t.start)<<1)-1}),this.forEach(function(e,t){e.index=t})}step(e,t=!1){let i=[];if(t)for(let o=0;o<this.length&&!(this[o].start>e);o++){if(this[o].end<e)continue;i.push(this[o])}else{let o=this.getRange(this.#a==-1?0:e-1,e),f=this;o.forEach(function(p){p.index>f.#a&&(i.push(p),f.#a=p.index)})}return i}getRange(e,t){e>t&&([e,t]=[t,e]);let i=[],o=-1,f=Math.ceil(Math.sqrt(this.length)),p=!0;for(let m=0;m<this.length;m+=f)this[m+f]?o<0&&this[m+f].start>=e&&(o=m):o=o<0?m:o;for(;p;)this[o]?.end<t?this[o].start>=e&&i.push(this[o]):p=!1,o++;return i}};var xt=0xffffffffffff,ze=function(e){let t=new ge,i=this,o=e.timeDivision,f=120,p=new ge,m=0,y=0;p.push(new pe(0,xt,[120,0])),e.track.forEach(function(a){m=0,a.event.forEach(function(s){m+=s.deltaTime,s.type==255&&s?.metaType==81&&(f=6e7/s.data,p[p.length-1]&&p.push(new pe(m,0xffffffffffff,[f,0])))})}),p.fresh(),p.forEach(function(a,s,n){s>0&&(n[s-1].end=a.start)});let r=120;p.forEach(function(a,s,n){s>0&&(a.end==a.start?n.splice(n.indexOf(a),1):r==a.data[0]&&(n[s-1].end=a.end,n.splice(n.indexOf(a),1)),r=a.data[0])});let l=0,u=120;return p.forEach(function(a){let s=a.start,n=s/u/o*60+l;u=a.data[0],l=n-s/u/o*60,a.data[1]=l}),console.debug("All tempo changes: ",p),f=120,m=0,y=0,e.track.forEach(function(a,s){m=0,y=0;let n=s+1;a.event.forEach(function(c,d){m+=c.deltaTime;let h=p.step(m,!0)[0];h&&(f=h.data[0],y=h.data[1]);let g={type:c.type,data:c.data,track:n,part:0};c.type>14?g.meta=c.metaType:g.part=c.channel,t.push(new Ke(m/f/o*60+y,g))})}),t.fresh(),self.midiEvents=t,console.debug(`Parsed a type ${e.formatType} MIDI sequence.`),t};me.default.customInterpreter=Ae;var M=function(e,t,i){e.addEventListener(i,o=>{t.dispatchEvent(i,o.data)})},We=class extends j{device;#a;#f={};#E=[];#T="";#w=[];#d=[];#u=new Uint8ClampedArray(128);#i=new Uint8ClampedArray(128);#e=.5;#p=120;#r=4;#g=4;#m=0;#o=0;#b=new Array(b.ch);#C=new Uint8Array(b.ch);smoothingAtk=0;smoothingDcy=0;reset(){let e=this;e.dispatchEvent("reset"),e.#a?.resetIndex(),e.device.init(),e.#T="",e.#e=.5,e.#p=120,e.#r=4,e.#g=4,e.#m=0,e.#o=0,e.dispatchEvent("tempo",e.#p),e.dispatchEvent("title",e.#T)}init(){this.reset(),this.#a=void 0}async loadFile(e){this.#a=ze(me.default.parse(new Uint8Array(await e.arrayBuffer())))}async loadMap(e,t,i){let o=this,f=0,p=0,m=0,y=0,r,l;e.split(`
`).forEach((u,a)=>{if(!u)return;let s=u.split("	");if(a){if(!y)return;let n="",c="";s.forEach((h,g)=>{switch(g){case r:{n=h;break}case l:{c=h;break}}});let d=!1;o.#f[n]?.priority>i&&(d=!0,m++),!o.#f[n]||d||t?(o.#f[n]={name:c,priority:i},f++):self.debugMode&&console.debug(`Voice "${c}" (${n}) seems to be in conflict with (${o.#f[n]}).`),p++}else s.forEach((n,c)=>{switch(n){case"ID":{r=c,y++;break}case"Name":{l=c,y++;break}default:console.debug(`Unknown map field: ${n}`)}})}),console.debug(`Voice names: ${p} total, ${f} loaded (${f-m} + ${m}).`),o?.device.forceVoiceRefresh()}async loadMapPaths(e){let t=this;e.forEach(async(i,o)=>{t.loadMap(await(await fetch(i)).text(),0,o)})}async loadEfx(e,t){let i=this,o=0,f=0,p,m,y;e.split(`
`).forEach((r,l)=>{if(r)if(l){let u=0,a;r.split("	").forEach((s,n)=>{switch(n){case p:{u|=parseInt(s,16)<<8;break}case m:{u|=parseInt(s,16);break}case y:{a=s;break}}}),!i.#E[u]||t?(i.#E[u]=a,o++):self.debugMode&&console.debug(`EFX ID 0x${u.toString(16).padStart(4,"0")} (${a}) seems to be in conflict.`),f++}else r.split("	").forEach((u,a)=>{switch(u){case"MSB":{p=a;break}case"LSB":{m=a;break}case"Name":{y=a;break}default:console.debug(`Unknown EFX field: ${u}`)}})}),console.debug(`EFX: ${f} total, ${o} loaded.`),i.dispatchEvent("efxreverb",i.device.getEffectType(0)),i.dispatchEvent("efxchorus",i.device.getEffectType(1)),i.dispatchEvent("efxdelay",i.device.getEffectType(2)),i.dispatchEvent("efxinsert0",i.device.getEffectType(3)),i.dispatchEvent("efxinsert1",i.device.getEffectType(4)),i.dispatchEvent("efxinsert2",i.device.getEffectType(5)),i.dispatchEvent("efxinsert3",i.device.getEffectType(6))}switchMode(e,t=!1){this.device.switchMode(e,t)}getMode(){return this.device.getMode()}getVoice(){return this.device.getVoice(...arguments)}getChVoice(e){return this.device.getChVoice(e)}getChPrimitive(e,t,i){return this.device.getChPrimitive(e,t,i)}getChPrimitives(e,t){return this.device.getChPrimitives(e,t)}getMapped(e){return this.#f[e]?.name||e}getEfx([e,t]){let i=e<<8|t;return this.#E[i]||`0x${i.toString(16).padStart(4,"0")}`}getVoxBm(e){if(!e)throw new Error("Voice object must be valid");let t=this;if(!t.voxBm)throw new Error("Voice bitmap repository isn't yet initialized");let i=t.voxBm.getBm(e.name);if(!i)switch(e.mode){case"xg":{switch(e.sid[0]){case 0:case 80:case 81:case 83:case 84:case 96:case 97:case 99:case 100:{i=t.voxBm.getBm(t.getVoice(U.bank0,e.sid[1],U.bank0,e.mode).name);break}}break}case"g2":case"sd":{switch(e.sid[0]){case 96:case 97:case 98:case 99:{i=t.voxBm.getBm(t.getVoice(U.bank0,e.sid[1],U.bank0,e.mode).name);break}case 104:case 105:case 106:case 107:{i=t.voxBm.getBm(t.getVoice(120,e.sid[1],U.bank0,e.mode).name);break}}break}case"gs":case"sc":case"k11":case"sg":case"gm":{switch(e.sid[0]){case 120:break;case 122:case 127:{i=t.voxBm.getBm(t.getVoice(120,e.sid[1],0,e.mode).name);break}default:i=t.voxBm.getBm(t.getVoice(0,e.sid[1],0,e.mode).name)}break}default:switch(e.sid[0]){case 56:{i=t.voxBm.getBm(t.getVoice(0,e.sid[1],0,e.mode).name);break}}}return i||(i=t.voxBm.getBm(t.getVoice(e.sid[0],e.sid[1],0,e.mode).name)),i}getChBm(e,t){let i=this;t=t||i.getChVoice(e);let o=i.getVoxBm(t);if(!o){if(!i.sysBm)return;switch(t.mode){case"xg":{switch(t.sid[0]){case 126:{t.sid[1]>>1==56&&(o=i.sysBm.getBm("cat_smpl"));break}case 16:{o=i.sysBm.getBm("cat_smpl");break}case 64:case 67:{o=i.sysBm.getBm("cat_sfx");break}case 32:case 33:case 34:case 35:case 36:case 48:case 82:{o=i.sysBm.getBm("cat_xg");break}}break}default:switch(t.sid[0]){case 63:case 32:case 33:case 34:case 35:case 36:case 48:case 82:{o=i.sysBm.getBm("cat_mex");break}}}}return o||(i.device.getChType()[e]?o=i.sysBm.getBm("cat_drm"):o=i.sysBm.getBm("no_vox")),o}get noteProgress(){return this.#o/this.#e}get noteOverall(){return this.noteProgress-this.#m}get noteBar(){return Math.floor(this.noteOverall/this.#r)}get noteBeat(){let e=this.noteOverall%this.#r;return e<0&&(e+=this.#r),e}get noteOffset(){return this.#m}getTimeSig(){return[this.#r,this.#g]}getTempo(){return this.#p}eachVoice(e){this.#b.forEach(e)}sendCmd(e){this.device.runJson(e)}render(e){e>this.#o&&(this.#o=e);let t=this.#a?.step(e)||[],i=0,o=0,f=new Set,p={},m=[],y=this,r=[];for(y.device.getStrength().forEach(($,x)=>{y.#i[x]=$}),y.device.newStrength(),t.forEach(function($){let x=$.data,R=y.device.runJson(x);switch(R?.reply){case"meta":{r.push(R);break}}R?.reply&&delete R.reply});y.#d.length>0;){let $=y.#d.shift(),x=$.part<<7|$.note;$.state?(f.add(x),p[x]=$.velo):f.has(x)&&(m.push({part:$.part,note:$.note,velo:p[x],state:y.device.NOTE_SUSTAIN}),i++,o+=y.#C[$.part])}r?.length>0&&y.dispatchEvent("meta",r);let l=y.device.getActive(),u=[],a=y.device.getPitch(),s=y.device.getCcAll(),n=y.device.getProgram(),c=y.device.getChType(),d=[],h=y.device.getStrength();h.forEach(function($,x,R){R[x]=Math.max(y.#i[x],$);let N=R[x]-y.#u[x],D=v.length*x;if(N>=0){let H=4*.25**(s[D+v[73]]/64);y.#u[x]+=Math.ceil(N-N*y.smoothingAtk**H)}else{let H=4*.25**(s[D+v[72]]/64);y.#u[x]+=Math.floor(N-N*y.smoothingDcy**H)}});let g=0,E=0;return l.forEach(function($,x){$&&(u[x]=y.device.getVel(x),d[x]=y.device.getExt(x),g+=u[x].size,E+=u[x].size*y.#C[x])}),{extraPoly:i,extraPolyEC:o,extraNotes:m,curPoly:g,curPolyEC:E,chInUse:l,chKeyPr:u,chPitch:a,chProgr:n,chContr:s,chType:c,chExt:d,eventCount:t.length,title:y.#T,bitmap:y.device.getBitmap(),letter:y.device.getLetter(),texts:y.device.getTexts(),master:y.device.getMaster(),mode:y.device.getMode(),strength:y.#u.slice(),velo:h,rpn:y.device.getRpn(),tSig:y.getTimeSig(),tempo:y.getTempo(),noteBar:y.noteBar,noteBeat:y.noteBeat,ace:y.device.getAce(),rawVelo:y.device.getStrength(),rawStrength:y.device.getRawStrength(),rawPitch:y.device.getRawPitch(),efxSink:y.device.getEffectSink()}}constructor(e,t=.5,i=.5){super();let o=this;o.smoothingAtk=t,o.smoothingDcy=i,o.device=e,o.addEventListener("meta",function(f){f?.data?.forEach(function(p){(o.#w[p.meta]||console.debug).call(o,p.meta,p.data)})}),M(o.device,o,"mode"),M(o.device,o,"mastervolume"),M(o.device,o,"channelactive"),M(o.device,o,"channelmin"),M(o.device,o,"channelmax"),M(o.device,o,"portrange"),M(o.device,o,"portstart"),M(o.device,o,"channelreset"),M(o.device,o,"channeltoggle"),M(o.device,o,"screen"),M(o.device,o,"metacommit"),M(o.device,o,"voice"),M(o.device,o,"pitch"),M(o.device,o,"note"),M(o.device,o,"reset"),M(o.device,o,"banklevel"),M(o.device,o,"efxreverb"),M(o.device,o,"efxchorus"),M(o.device,o,"efxdelay"),M(o.device,o,"efxinsert0"),M(o.device,o,"efxinsert1"),M(o.device,o,"efxinsert2"),M(o.device,o,"efxinsert3"),M(o.device,o,"partefxtoggle"),M(o.device,o,"chmode"),o.addEventListener("note",function({data:f}){o.#d.push(f)}),o.addEventListener("voice",({data:f})=>{let p=o.getChVoice(f.part);o.#b[f.part]=p,o.#C[f.part]=p.poly??1}),o.addEventListener("reset",({data:f})=>{o.#C.fill(1)}),o.#C.fill(1),o.#w[3]=function(f,p){o.#T?.length<1&&(o.#T=p,o.dispatchEvent("title",o.#T))},o.#w[81]=function(f,p){let m=o.noteProgress,y=o.#e||.5;o.#p=6e7/p,o.#e=p/1e6,o.#m+=m*(y/o.#e)-m,o.dispatchEvent("tempo",o.#p)},o.#w[88]=function(f,p){let m=o.noteProgress,y=o.noteOverall,r=o.noteBar,l=o.noteBeat,u=o.#r,a=o.#g;o.#r=p[0],o.#g=1<<p[1];let s=24*(32/p[3])/p[2];if(u!=o.#r){let n=r;o.#m-=n*(o.#r-u),l+1>=u&&(u<o.#r?o.#m-=Math.ceil(o.#r-l-1):o.#m+=o.#r)}o.dispatchEvent("tsig",o.getTimeSig())}}};var Tt=class extends EventTarget{static sleep(e){return new Promise(t=>{self.AbortSignal?AbortSignal.timeout(e).addEventListener("abort",t):setTimeout(t,e)})}#a;#f;#E=!1;get finished(){return this.#E}finish(){this.#E=!0,this.#f&&this.#f()}wait(){if(!this.#E)return this.#a}constructor(){super(),this.#a=new Promise(e=>{this.#f=()=>{this.#E=!0,e()}})}},qe=Tt;var be=new Uint8Array(40),J=0,ye,Ma=setInterval(()=>{ye&&(be[J]=!be[J],J++,J>34&&(J=0))},1e3/50);Uint8Array.prototype.render=function(e){let t=0,i=0,o=this.width||5,f=this.height||8;for(let p=0;p<this.length;p++)e(this[p],t,i,this),t++,t>=o&&(t=0,i++)};var Ye=class{#a=[];loaded=new qe;async load(e,t=!1,i="(internal)"){let o=this,f=0,p=0;console.debug(`Font "${i||"(internal)"}": loading started.`),e.split(`
`).forEach(function(m,y){if(y>0&&m?.length>0){let r=m.split("	"),l=parseInt(r[0],16);if(p++,o.#a[l]&&!t)return;let u=new Uint8Array(40);Array.from(r[1]).forEach(async function(a,s){let n=s&1?4:0,c=s>>1,d=parseInt(a,16),h=3;for(;d>0||h>=0;){let g=(n+h)*5+c;u[g]=d&1,d=d>>1,h--}}),u.width=5,u.height=8,o.#a[l]=u,f++}}),o.loaded.finished||o.loaded.finish(),console.debug(`Font "${i||"(internal)"}": ${p} total, ${f} loaded.`)}async loadFile(e,t=!1){let i=this;console.debug(`Requested font file from "${e}".`),await i.load(await(await fetch(e)).text(),t,e),ye=!1}constructor(...e){ye=!0,(async()=>{for(let t=0;t<e.length;t++)await this.loadFile(e[t])})()}getCP(e){return this.#a[e]}getStr(e){let t=[],i=this;return Array.from(e).forEach(function(o){t.push(i.#a[o.charCodeAt(0)]||i.#a[32]||be)}),t}keys(){return Object.keys(this.#a)}data(e){return this.#a[e]}};var ae=16/9,re=64,G=new Float64Array(49),St="Vx,Dr,D1,D2,D3,D4,D5,D6,D7,D8".split(","),Mt=[1,3,6,8,10],Qe=[0,.5,1,1.5,2,3,3.5,4,4.5,5,5.5,6],Pt=2*Math.PI,Rt={"?":"Unset",gm:"General MIDI",g2:"General MIDI 2",xg:"Yamaha XG",gs:"Roland GS",sc:"Roland GS",mt32:"Roland MT-32",doc:"Yamaha DOC",qy10:"YAMAHA QY10",qy20:"YAMAHA QY20",sd:"Roland SD",x5d:"Korg X5D","05rw":"Korg 05R/W",ns5r:"Korg NS5R",k11:"Kawai K11",sg:"Akai SG",krs:"Korg KROSS 2",s90es:"Yamaha S90 ES",motif:"Yamaha Motif ES"},Dt={Copyrite:"Copyright","Cmn.Text":"Text","C.Lyrics":"Lyrics","C.Marker":"Marker",CuePoint:"Cue Point",Instrmnt:"Instrument","Kar.Info":"Kar Info","Kar.Mode":"Karaoke","Kar.Lang":"Language",KarTitle:"Kar Title",KarLyric:"Kar Lyrics","Kar.Ver.":"Kar Version",SGLyrics:"SG Lyrics",TrkTitle:"Title",EORTitle:"Real Title",XfSngDte:"XF Date",XfSngRgn:"XF Region",XfSngCat:"XF Category",XfSongBt:"XF Beat",XfSngIns:"XF Instr.",XfSngVoc:"XF Vocalist",XfSngCmp:"XF Composer",XfSngLrc:"XF Lyricist",XfSngArr:"XF Arranger",XfSngPer:"XF Perform.",XfSngPrg:"XF Program.",XfSngTag:"XF Tags",XfKarLng:"XF Lang.",XfKarNme:"XF Name",XfKarCmp:"XK Composer",XfKarLrc:"XK Lyricist",XfKarArr:"XK Arranger",XfKarPer:"XK Perform.",XfKarPrg:"XK Program."},At=["XfSongBt","XfSngIns"],ve=[[],[4,2],[3,2]],Lt=[{l:0,t:0},{l:0,t:416},{l:960,t:0},{l:960,t:416}],Ze={none:{font4:[0,0],cfont4:[0,0],font7:[0,0]},macos:{font4:[2,0],cfont4:[1,0],font7:[0,0]},chromium:{font4:[1,0],cfont4:[0,0],font7:[1,0]}},ie={xg:["9efaa0","006415"],doc:["9efaa0","006415"],qy10:["9efaa0","006415"],qy20:["9efaa0","006415"],ns5r:["9efaa0","006415"],x5d:["9efaa0","006415"],"05rw":["9efaa0","006415"],k11:["9efaa0","006415"],s90es:["9efaa0","006415"],motif:["9efaa0","006415"],gm:["a1f3ff","005e88"],g2:["a1f3ff","005e88"],krs:["a1f3ff","005e88"],gs:["ffe1a5","804e00"],sc:["ffe1a5","804e00"],mt32:["ffe1a5","804e00"],sd:["ffe1a5","804e00"],sg:["ffdddd","990022"]};G.forEach((e,t,i)=>{i[t]=Math.PI*t/12});var k=function(e,t,i={}){let o=document.createElement(e);t?.forEach(u=>{o.classList.add(u)});let{t:f,l:p,w:m,h:y,i:r,a:l}=i;return f?.constructor&&(o.style.top=f?.length?f:`${f}px`),p?.constructor&&(o.style.left=p?.length?p:`${p}px`),m?.constructor&&(o.style.width=m?.length?m:`${m}px`),y?.constructor&&(o.style.height=y?.length?y:`${y}px`),r?.constructor&&o.appendChild(document.createTextNode(r)),l?.constructor&&(o.style.textAlign=l),o};var A=function(e,t){t?.forEach(i=>{e.appendChild(i)})},V=function(e,t){t.forEach(i=>{e.classList.contains(i)&&e.classList.remove(i)})},_=function(e,t){t.forEach(i=>{e.classList.contains(i)||e.classList.add(i)})},Ot=new Array(128).fill(0);Ot.forEach((e,t,i)=>{i[t]=Math.floor(24*t/12.7)/10});var It=new Array(128).fill(0);It.forEach((e,t,i)=>{i[t]=Math.abs(Math.round(48*(t-64)/12.7)/10)});var je=new Array(11).fill(null);je.forEach((e,t,i)=>{i[t]=`${Math.round(t*12/.0128)/100}%`});var Bt=new Array(128).fill(null);Bt.forEach((e,t,i)=>{i[t]=`${Math.round(t/1.27)/100}`});var Je=function(e,t){e.innerText=t,e.rNew=!0;let i=e.measureText(t);e.rWidth=i.width};HTMLElement.prototype.setTextRaw=function(e){let t;this.childNodes[0]?.nodeType==3?(t=this.childNodes[0],t.data=e):(t=document.createTextNode(e),this.prepend(t))};var Oa=class extends We{#a=16;#f=32;#E=128;#T=!1;#w="";#d;#u=0;#i=0;#e=0;#p=0;#r=0;#g;#m=0;#o=!1;#b=b.invalidCh;#C=1;#L=0;#q=0;#x=0;#s=new Uint8Array(1280);#c=new Uint8Array(1280);#Y=new Uint8Array(1280);#R=new Uint8Array(512);#B=new Uint8Array(512);#M=new Uint8Array(512);#Q=new Uint8Array(b.ch);#X;#k;#U;#l;#Z;#G="fcdaff";#D=new Array(b.ch);#V=new Array(b.ch);#$="ffffff";#v="?";#t={};#S={};#h=[];#n={};#A={};eventViewMode=0;useElementCount=!0;#J=[];#_="comb";glyphs=new Ye;panStyle=11;#K(e,t,i,o=0,f=0,p){let m=this,{width:y,height:r}=e.canvas,l,u,a,s,n=m.#C,c=o>3,d=Mt.indexOf(t%12)>-1;switch(m.#_){case"block":case"comb":{l=Math.round(t*y/128),u=Math.round((t+1)*y/128),a=u-l,s=n==1?2:1;break}case"piano":{l=Math.round((Math.floor(t/12)*7+Qe[t%12])*y/75*1.0044642857142856),u=Math.round((Math.floor(t/12)*7+Qe[t%12]+1)*y/75*1.0044642857142856)-1,a=u-l,s=n==1?3:1;break}case"line":{let h=t-f;Math.abs(f)>2&&(h=t-Math.sign(f)*2),u=Math.round((t+.5)*y/128),l=Math.round((h+.5)*y/128)}default:}switch(e.fillStyle=`#${d?m.getChAccent(p):m.#$}${(i<<1|i>>6).toString(16).padStart(2,"0")}`,e.strokeStyle=e.fillStyle,e.lineWidth=n==1?4:2,e.lineDashOffset=0,m.#_){case"block":{let h=e.canvas.height-1;e.fillRect(l,0,a,h),c&&e.clearRect(l+s,s,a-(s<<1),h-(s<<1));break}case"comb":{let h=(d?Math.round((e.canvas.height<<1)/3):e.canvas.height)-1;e.fillRect(l,0,a,h),c&&e.clearRect(l+s,s,a-(s<<1),h-(s<<1));break}case"piano":{let h=d?0:e.canvas.height>>1,g=(e.canvas.height>>1)-1;e.fillRect(l,h,a,g),c&&e.clearRect(l+s,h+s,a-(s<<1),g-(s<<1));break}case"line":{if(c)switch(n){case 4:{e.setLineDash(ve[2]);break}default:e.setLineDash(ve[1])}else e.setLineDash(ve[0]),n!=4&&self?.document?.mozFullScreen&&(l+=.5,u+=.5);e.beginPath(),e.moveTo(l,(n==4||!c)&&self?.document?.mozFullScreen?1:0),e.lineTo(u,(r>>1)+1),e.lineTo(l,r),e.stroke();break}default:}}#z(e,t){let i=this;(e?.chInUse||t).forEach((o,f)=>{if(o){let p=i.#h[f>>4][f&15].cxt;p.clearRect(0,0,p.canvas.width,p.canvas.height),e.chKeyPr[f].forEach(({v:m,s:y},r)=>{i.#K(p,r,m,y,i.device.getPitchShift(f),f)})}})}#ae(e){let t=this;Date.now()-t.#u>4e3&&(t.#i=0,t.#e=142-t.#n.view.clientHeight,(t.#d?.clientWidth||0)>840&&(t.#i=840-t.#d.clientWidth),t.#n.view.style.transform=`translateX(${t.#i}px) translateY(${t.#e}px)`,e&&(t.#u=0))}#re(){let e=self.innerWidth/self.innerHeight,t=1,i=self.innerWidth,o=self.innerHeight;e>=ae?(t=Math.min(Math.round(self.innerHeight/1080*1e4)/1e4,100),i=Math.ceil(self.innerHeight*ae)):e<ae&&(t=Math.min(Math.round(self.innerWidth/1920*1e4)/1e4,100),o=Math.ceil(self.innerWidth/ae)),this.#U.style.width=`${i}px`,this.#U.style.height=`${o}px`,this.#l.style.transform=`scale(${t})`}#O;#y(){let e=this,t=e.#X?.currentTime||0,i=e.render(t),o=Date.now(),f=i.curPoly+i.extraPoly,p=i.curPolyEC+i.extraPolyEC;e.#p<f&&(e.#p=f),e.#r<p&&(e.#r=p),e.#t.curPoly.setTextRaw(`${e.useElementCount?p:f}`.padStart(3,"0")),e.#t.maxPoly.setTextRaw(`${e.useElementCount?e.#r:e.#p}`.padStart(3,"0")),e.#X?.realtime?(e.#t.barCount.setTextRaw("LINE"),e.#t.barDelim.style.display="none",e.#t.barNote.setTextRaw("IN")):(e.#t.barCount.setTextRaw(i.noteBar+1),e.#t.barDelim.style.display="",e.#t.barNote.setTextRaw(Math.floor(i.noteBeat)+1));let m=[7,11,1,91,93,94,74,5,256,256],y=e.#L+e.#C;for(let a=0;a<b.ch;a++){let s=a>>4,n=a*b.cc,c=a*b.ace,d=e.#h[s][a&15];if(visualizer.device.getActive()[a]&&s>=e.#L&&s<y){m[8]=i.ace[c+0]||256,m[9]=i.ace[c+1]||256,d.ccVis.clearRect(0,0,109,25),d.ccVis.fillStyle=`#${e.getChAccent(a)}`,d.ccVis.strokeStyle=`#${e.getChAccent(a)}`,d.ccVis.lineWidth=2;for(let g=0;g<m.length;g++){let E=m[g];if(E<256){let C=i.chContr[n+v[E]],$=C*24/127;if($>0){let x=24-$;d.ccVis.fillRect(g*6,x,4,$)}}}let h=i.chContr[n+v[10]]||1;switch(e.panStyle){case 7:case 6:case 5:case 3:case 2:case 1:{let g=(h+125)*.024933275,E=(h-64)*.024933275;d.ccVis.beginPath(),h>127?e.panStyle>>1&1&&(d.ccVis.arc(84.5,22.5,21.5,0,G[12],!0),d.ccVis.stroke()):(e.panStyle>>1&1&&(h<64?(d.ccVis.arc(84.5,22.5,21.5,G[18],g,!0),d.ccVis.stroke()):h>64&&(d.ccVis.arc(84.5,22.5,21.5,G[18],g),d.ccVis.stroke())),e.panStyle&1&&(d.ccVis.strokeStyle=`#${e.#$}`,d.ccVis.lineWidth=e.panStyle>>2?1:3,d.ccVis.beginPath(),d.ccVis.moveTo(84.5,22.5),h==64?d.ccVis.lineTo(84.5,4):d.ccVis.lineTo(84.5+18*Math.sin(E),22.5-18.5*Math.cos(E)),d.ccVis.stroke())),e.panStyle>>2&1&&(d.ccVis.fillStyle=`#${e.#$}`,d.ccVis.beginPath(),d.ccVis.arc(84.5,22.5,2.5,0,G[4]),d.ccVis.fill());break}case 11:case 10:case 9:{let g=(h+77)*.033244367,E=(h-64)*.033244367;d.ccVis.beginPath(),h>127?e.panStyle>>1&1&&(d.ccVis.arc(84.5,16.5,15.5,G[26],G[34],!0),d.ccVis.stroke()):(e.panStyle>>1&1&&(h<64?(d.ccVis.arc(84.5,16.5,15.5,G[18],g,!0),d.ccVis.stroke()):h>64&&(d.ccVis.arc(84.5,16.5,15.5,G[18],g),d.ccVis.stroke())),e.panStyle&1&&(d.ccVis.strokeStyle=`#${e.#$}`,d.ccVis.lineWidth=3,d.ccVis.beginPath(),d.ccVis.moveTo(84.5,16.5),h==64?d.ccVis.lineTo(84.5,4):d.ccVis.lineTo(84.5+11.5*Math.sin(E),16.5-11.5*Math.cos(E)),d.ccVis.stroke())),(!(e.panStyle&1)||h>>7)&&(d.ccVis.fillStyle=`#${e.#$}`,d.ccVis.beginPath(),d.ccVis.arc(84.5,16.5,2.5,0,G[24]),d.ccVis.fill());break}default:{let g=Math.abs(h-64)/2.625;h<64?d.ccVis.fillRect(84-g,0,g,24):h>127?(d.ccVis.fillRect(60,0,49,24),d.ccVis.clearRect(61,1,47,22)):d.ccVis.fillRect(85,0,g,24),d.ccVis.fillStyle=`#${e.#$}`,d.ccVis.fillRect(84,0,1,24)}}if(d.metre.clearRect(0,0,121,25),d.metre.fillStyle=`#${e.#$}`,d.metre.globalCompositeOperation="source-over",d.metre.rWidth>d.metre.canvas.width){d.metre.rNew&&(d.metre.rNew=!1,d.metre.rOffset=t);let g=t-(d.metre.rOffset||0),E=32,C=d.metre.rWidth-d.metre.canvas.width+E,$=g*-25%(d.metre.rWidth+E+48)+48;$>0&&($=0),d.metre.fillText(d.metre.innerText,$,3+e.#Z.cfont4[0]),Math.abs($)>C&&d.metre.fillText(d.metre.innerText,$+d.metre.rWidth+E,3+e.#Z.cfont4[0])}else d.metre.fillText(d.metre.innerText,0,3+e.#Z.cfont4[0]);switch(d.metre.globalCompositeOperation="xor",d.metre.fillRect(0,0,i.strength[a]*121/255,25),d.extVis.clearRect(0,0,47,25),d.extVis.fillStyle=`#${e.#$}`,i.chExt[a][0]){case e.device.EXT_VL:{let g=(i.chContr[n+v[136]]-64)/64||i.rawPitch[a]/8192;g=g*-4+4;let E=+(i.rawVelo[a]>0||i.chContr[n+v[1]]>0)*(i.chContr[n+v[129]]*i.chContr[n+v[11]]/16129);!E&&i.rawStrength[a]&&(E=i.rawStrength[a]*i.chContr[n+v[11]]/16129),E*=32;let C=i.chContr[n+v[1]]/127*8;d.extVis.beginPath(),d.extVis.moveTo(0,12-g-3),d.extVis.lineTo(7+E,12),d.extVis.lineTo(0,12+g+3),d.extVis.fill(),d.extVis.fillStyle=`#${e.getChAccent(a)}`,d.extVis.beginPath(),d.extVis.ellipse(43,12,4,4+C,0,0,Pt),d.extVis.fill();break}case e.device.EXT_DX:{i.chContr.subarray(n+v[142],n+v[157]+1).forEach((E,C)=>{C>=8&&(d.extVis.fillStyle=`#${e.getChAccent(a)}`);let $=C*3,x=(E-64)/5.82;x>=0?d.extVis.fillRect($,12-x,2,x+1):d.extVis.fillRect($,12,2,1-x)});break}}}}let r=new Array(b.ch);if(e.#h.forEach((a,s)=>{a.forEach((n,c)=>{n.refresh&&(n.refresh=!1,r[s<<7|c]=!0)})}),["line"].indexOf(e.#_)>-1)for(;e.#J.length>0;){let a=e.#J.shift();r[a.part]=!0}e.#z(i,r),i.extraNotes.forEach(a=>{let{part:s,note:n,velo:c,state:d}=a,h=e.#h[s>>4][s&15].cxt;e.#K(h,n,c,d,e.device.getPitchShift(s),s)});let l=e.#A.cxt;o>i.bitmap.expire?e.#M.fill(0):i.bitmap.bitmap.length>256?i.bitmap.bitmap.forEach((a,s)=>{e.#M[s]=a?255:0}):i.bitmap.bitmap.forEach((a,s)=>{e.#M[s<<1]=a?255:0,e.#M[s<<1|1]=a?255:0}),e.#Y.fill(0),o<=i.letter.expire&&e.glyphs.getStr(i.letter.text).forEach((a,s)=>{let n=(s&15)*5,c=s>>4<<3;a.forEach((d,h)=>{let g=n+h%5,E=c+Math.floor(h/5);e.#Y[E*80+g]=d?255:0})}),e.#R.forEach((a,s,n)=>{let c=e.#M[s];c>a?n[s]+=Math.min(c-a,re):c<a&&(n[s]-=Math.min(a-c,re))}),e.#s.forEach((a,s,n)=>{let c=e.#Y[s];c>a?n[s]+=Math.min(c-a,re):c<a&&(n[s]-=Math.min(a-c,re))}),e.#R.forEach((a,s)=>{let n=s>>5,c=s&31;e.#B[s]!=a?(l.clearRect(252+(c<<2),n<<2,3,3),a&&(l.fillStyle=`#${e.#$}${a.toString(16).padStart(2,"0")}`,l.fillRect(252+(c<<2),n<<2,3,3))):T()&&(l.clearRect(252+(c<<2),n<<2,3,3),a&&(l.fillStyle=`#ff0000${a.toString(16).padStart(2,"0")}`,l.fillRect(252+(c<<2),n<<2,3,3)))}),e.#s.forEach((a,s)=>{let n=Math.floor(s/80),c=s%80;c+=Math.floor(c/5),e.#c[s]!=a?(l.clearRect(c<<2,(n|16)<<2,3,3),a&&(l.fillStyle=`#${e.#$}${a.toString(16).padStart(2,"0")}`,l.fillRect(c<<2,(n|16)<<2,3,3))):T()&&(l.clearRect(c<<2,(n|16)<<2,3,3),a&&(l.fillStyle=`#ff0000${a.toString(16).padStart(2,"0")}`,l.fillRect(c<<2,(n|16)<<2,3,3)))}),e.#B.forEach((a,s,n)=>{n[s]=e.#R[s]}),e.#c.forEach((a,s,n)=>{n[s]=e.#s[s]});let u=(self.performance||self.Date).now();switch(e.eventViewMode){case 0:{e.#t.events.setTextRaw(`${i.eventCount}`.padStart(3,"0"));break}case 1:{let a=1e3/(u-e.#q);a>99?(a=Math.round(a),e.#t.events.setTextRaw(`${a}`)):a>9?(a=Math.round(a*10)/10,e.#t.events.setTextRaw(`${Math.floor(a)}.${Math.floor(a*10%10)}`)):(a=Math.round(a*100)/100,e.#t.events.setTextRaw(`${Math.floor(a)}.${Math.floor(a*100%100)}`));break}default:e.#t.events.setTextRaw("")}e.#q=u}#se;#j;get style(){return this.#_}set style(e){let t=this;t.#_=e,t.#z(t.render(t.#X?.currentTime||0)),V(t.#l,["cambiare-style-block","cambiare-style-comb","cambiare-style-piano","cambiare-style-line"]),_(t.#l,[`cambiare-style-${e}`])}getChMode(e=0,t){if(e>=b.ch)throw new RangeError("Invalid part number");let i=this;return t?i.#V[e]:i.#V[e]??i.#v}getChAccent(e=0){if(e>=b.ch)throw new RangeError("Invalid part number");let t=this;return t.#D[e]??t.#G}setClockSource(e){this.#X=e}setPixelProfile(e){let t=this;if(Ze[e]){let i=Ze[e];t.#Z=i,t.#l&&(t.#l.style.setProperty("--pcp-font4",`translate(${i.font4[1]}px, ${i.font4[0]}px)`),t.#l.style.setProperty("--pcp-font7",`translate(${i.font7[1]}px, ${i.font7[0]}px)`))}else throw new Error(`"${e}" is not a valid pixel correction profile`)}setMode(e){let t=this;t.#v=e,t.#G=(ie[e]||["fcdaff","742b81"])[t.#x];for(let i of t.#l.classList)i.substring(0,14)==="cambiare-mode-"&&t.#l.classList.remove(i);e!="?"&&t.#l.classList.add(`cambiare-mode-${e}`)}setChMode(e,t){let i=this;i.#V[e]=t;let o=i.#h[e>>4][e&15];for(let f of o.root.classList)f.substring(0,10)=="part-mode-"&&o.root.classList.remove(f);t!="?"&&o.root.classList.add(`part-mode-${t}`)}setScheme(e=0){let t=this;t.#x=e?1:0,t.#$=["ffffff","000000"][t.#x],[V,_][t.#x](t.#l,["cambiare-scheme-light"]),t.#G=(ie[t.#v]||["fcdaff","742b81"])[t.#x];for(let i=0;i<b.ch;i++)if(t.device.getChActive(i)!==0&&t.#D[i]){let o=ie[t.#V[i]];o&&(t.#D[i]=o[t.#x])}}#W(e){let t=this,i=t.#C,o=t.#L;t.#h.forEach((f,p)=>{if(p>=o&&p<o+i){_(f.root,["port-active"]);let m=p-o,{l:y,t:r}=Lt[m*(4/i)];f.root.style.top=`${r}px`,f.root.style.left=`${y}px`,f.forEach((l,u)=>{l.root.style.top=`${u*(i>2?26:52)}px`})}else V(f.root,["port-active"]),f.root.style.top="",f.root.style.left="",f.forEach((m,y)=>{m.root.style.top=""});e&&f.forEach((m,y)=>{m.cxt.canvas.width=t.#C==1?1193:495,m.cxt.canvas.height=t.#C==4?26:52})})}setPort(e){let t=this;V(t.#l,["cambiare-start0","cambiare-start1","cambiare-start2","cambiare-start3","cambiare-start4","cambiare-start5","cambiare-start6","cambiare-start7"]),_(t.#l,[`cambiare-start${e}`]),t.#L=e,t.#W(!1)}setRange(e){let t=this;V(t.#l,["cambiare-port1","cambiare-port2","cambiare-port4","cambiare-compact"]),_(t.#l,[`cambiare-${e}`]),t.#C=parseInt(e.slice(4))||1,t.#W(!0)}setFrameTime(e=20){let t=this;t.#j?.constructor&&clearInterval(t.#j),e<5?e=5:e>500&&(e=500),t.#j=setInterval(t.#se,e),t.smoothingAtk=Math.pow(.1,e/20),t.smoothingDcy=Math.pow(.75,e/20)}attach(e){let t=this;t.#k=e;let i=k("div",["cambiare-container"]);e.appendChild(i),t.#U=i;let o=k("div",["cambiare-canvas","cambiare-port1","cambiare-start0","cambiare-style-block"]);i.appendChild(o),t.#l=o,self.addEventListener("resize",t.#O),t.#O(),t.setFrameTime(20),t.#t.root=k("div",["sect-info"]),t.#t.events=k("span",["field","pcp-font4"],{t:1,l:0,w:35,h:33}),t.#t.curPoly=k("span",["field","pcp-font4"],{t:1,l:52,w:35,h:33}),t.#t.maxPoly=k("span",["field","pcp-font4"],{t:1,l:98,w:35,h:33}),t.#t.sigN=k("span",["field","pcp-font4"],{t:1,l:194,w:23,h:33,a:"right"}),t.#t.sigD=k("span",["field","pcp-font4"],{t:1,l:232,w:23,h:33}),t.#t.barCount=k("span",["field","pcp-font4"],{t:1,l:304,w:35,h:33,a:"right"}),t.#t.barDelim=k("span",["field","field-label","pcp-font4"],{t:0,l:343,w:8,h:33,i:"/"}),t.#t.barNote=k("span",["field","pcp-font4"],{t:1,l:354,w:23,h:33}),t.#t.tempo=k("span",["field","pcp-font4"],{t:1,l:454,w:64,h:33,a:"right"}),t.#t.volume=k("span",["field","pcp-font4"],{t:1,l:562,w:63,h:33,a:"right"}),t.#t.mode=k("span",["field","pcp-font4"],{t:1,l:708,w:152,h:33}),t.#t.reverb=k("span",["field","pcp-font4"],{t:1,l:1e3,w:190,h:33}),t.#t.chorus=k("span",["field","pcp-font4"],{t:1,l:1240,w:190,h:33}),t.#t.delay=k("span",["field","pcp-font4"],{t:1,l:1475,w:190,h:33}),t.#t.insert=k("span",["field","pcp-font4"],{t:1,l:1706,w:190,h:33}),t.#t.title=k("span",["field","pcp-font4"],{t:35,l:50,w:810,h:33}),o.appendChild(t.#t.root),A(t.#t.root,[t.#t.events,t.#t.curPoly,k("span",["field","field-label","pcp-font4"],{t:1,l:89,w:5,h:33,i:":"}),t.#t.maxPoly,k("span",["field","field-key","pcp-font7"],{t:1,l:148,w:41,h:33,i:"TSig"}),t.#t.sigN,k("span",["field","field-label","pcp-font4"],{t:0,l:221,w:8,h:33,i:"/"}),t.#t.sigD,k("span",["field","field-key","pcp-font7"],{t:1,l:268,w:30,h:33,i:"Bar"}),t.#t.barCount,t.#t.barDelim,t.#t.barNote,k("span",["field","field-key","pcp-font7"],{t:1,l:390,w:61,h:33,i:"Tempo",a:"right"}),t.#t.tempo,k("span",["field","field-key","pcp-font7"],{t:1,l:528,w:29,h:33,i:"Vol"}),t.#t.volume,k("span",["field","field-label","pcp-font4"],{t:1,l:626,w:17,h:33,i:"%"}),k("span",["field","field-key","pcp-font7"],{t:1,l:652,w:52,h:33,i:"Mode"}),t.#t.mode,k("span",["field","field-key","pcp-font7"],{t:1,l:960,w:34,h:33,i:"Rev"}),t.#t.reverb,k("span",["field","field-key","pcp-font7"],{t:1,l:1198,w:36,h:33,i:"Cho"}),t.#t.chorus,k("span",["field","field-key","pcp-font7"],{t:1,l:1438,w:31,h:33,i:"Var"}),t.#t.delay,k("span",["field","field-key","pcp-font7"],{t:1,l:1673,w:27,h:33,i:"Ins"}),t.#t.insert,k("span",["field","field-key","pcp-font7"],{t:35,l:0,w:44,h:33,i:"Title"}),t.#t.title]),t.#S.root=k("div",["sect-mark"]),t.#S.left=k("div",["sect-mark-left","boundary"],{t:0,l:0}),t.#S.right=k("div",["sect-mark-right","boundary"],{t:0,l:960}),o.appendChild(t.#S.root),A(t.#S.root,[t.#S.left,t.#S.right]),A(t.#S.left,[k("span",["field","field-key"],{t:0,l:0,w:26,h:33,i:"CH"}),k("span",["field","field-key"],{t:0,l:30,w:49,h:33,i:"Voice"}),k("span",["field","field-key","mark-send-title"],{t:2,l:164,w:25,h:18,i:"Send"}),k("span",["field","field-label","mark-send-param"],{t:16,l:146,w:58,h:16,i:"VEMRCDBP12",a:"center"}),k("span",["field","field-key"],{t:0,l:212,w:35,h:33,i:"Pan"}),k("span",["field","field-key"],{t:0,l:256,w:45,h:33,i:"Note"})]),A(t.#S.right,[k("span",["field","field-key"],{t:0,l:0,w:26,h:33,i:"CH"}),k("span",["field","field-key"],{t:0,l:30,w:49,h:33,i:"Voice"}),k("span",["field","field-key","mark-send-title"],{t:2,l:164,w:25,h:18,i:"Send"}),k("span",["field","field-label","mark-send-param"],{t:16,l:146,w:58,h:16,i:"VEMRCDBP12",a:"center"}),k("span",["field","field-key"],{t:0,l:212,w:35,h:33,i:"Pan"}),k("span",["field","field-key"],{t:0,l:256,w:45,h:33,i:"Note"})]),t.#h.root=k("div",["sect-part"]);for(let f=0;f<b.ch>>4;f++){let p=f<<4;t.#h[f]=[],t.#h[f].root=k("div",["boundary",`part-port-${f}`]);for(let m=0;m<16;m++){let y=(p|m)+1;y>=100?y=`${Math.floor(y/10).toString(16)}${y%10}`:y=`${y}`.padStart(2,"0"),t.#h[f][m]={root:k("div",["boundary","part-channel"]),major:k("div",["boundary","part-info-major"]),minor:k("div",["boundary","part-info-minor"],{t:26}),keys:k("div",["boundary","part-keys"]),notes:k("div",["boundary","part-keyboard"]),cxt:k("canvas",["field"]).getContext("2d"),number:k("span",["field","field-label","pcp-font4"],{t:1,w:18,h:25,i:y}),voice:k("span",["field"],{l:22,t:1,w:121,h:25}),metre:k("canvas",["field"]).getContext("2d"),type:k("span",["field","field-label","pcp-font4"],{t:1,w:18,h:25}),std:k("span",["field","pcp-font4"],{l:22,t:1,w:20,h:25,a:"center"}),msb:k("span",["field","pcp-font4"],{l:48,t:1,w:27,h:25}),prg:k("span",["field","pcp-font4"],{l:81,t:1,w:27,h:25}),lsb:k("span",["field","pcp-font4"],{l:114,t:1,w:27,h:25}),ccVis:k("canvas",["field"],{l:145,t:1}).getContext("2d"),extVis:k("canvas",["field"],{l:207,t:1}).getContext("2d"),ccUpdate:!1};let r=t.#h[f][m];je.forEach(l=>{r.notes.appendChild(k("span",["field","part-csplit"],{l}))}),r.notes.appendChild(k("span",["field","part-csplit","part-cdive"],{l:0,w:"100%",h:1})),r.metre.canvas.width=121,r.metre.canvas.height=25,r.metre.textBaseline="top",r.metre.font="20px 'PT Sans Narrow'",r.ccVis.canvas.width=109,r.ccVis.canvas.height=25,r.ccVis.fillStyle=`#${t.#$}`,r.extVis.canvas.width=47,r.extVis.canvas.height=25,r.extVis.fillStyle=`#${t.#$}`,A(r.notes,[r.cxt.canvas]),A(r.keys,[r.notes]),A(r.voice,[r.metre.canvas]),A(r.major,[r.number,r.voice,r.ccVis.canvas]),A(r.minor,[r.type,r.std,r.msb,r.prg,r.lsb,r.extVis.canvas]),A(r.root,[r.major,r.minor,r.keys]),A(t.#h[f].root,[r.root]),r.number.addEventListener("contextmenu",l=>{l.preventDefault(),l.stopImmediatePropagation();let u=f<<4|m;t.#Q[u]=+!t.#Q[u],[V,_][t.#Q[u]](r.root,["part-hidden"])})}t.#h.root.appendChild(t.#h[f].root)}o.appendChild(t.#h.root),t.#n.root=k("div",["sect-meta"]),t.#n.view=k("div",["boundary"]),o.appendChild(t.#n.root),A(t.#n.root,[t.#n.view]),t.#A.root=k("div",["sect-pix","boundary"],{l:1529,t:950,w:379,h:127}),t.#A.cxt=k("canvas",["field"]).getContext("2d"),t.#A.fps=k("span",["field","field-key"],{l:0,w:"100%",h:1}),t.#A.cxt.canvas.width=379,t.#A.cxt.canvas.height=127,A(t.#A.root,[t.#A.cxt.canvas]),o.appendChild(t.#A.root),t.addEventListener("mode",f=>{t.#t.mode.setTextRaw(`${Rt[f.data]}`),t.setMode(f.data)}),t.addEventListener("mastervolume",f=>{let p=Math.round(f.data*100)/100;t.#t.volume.setTextRaw(`${Math.floor(p)}.${`${Math.floor(p%1*100)}`.padStart(2,"0")}`)}),t.addEventListener("tempo",f=>{let p=Math.round(f.data*100);t.#t.tempo.setTextRaw(`${Math.floor(p/100)}.${`${Math.floor(p%100)}`.padStart(2,"0")}`)}),t.addEventListener("tsig",f=>{[t.#t.sigN.innerText,t.#t.sigD.innerText]=f.data}),t.addEventListener("title",f=>{t.#t.title.setTextRaw(f.data||"No Title")}),t.addEventListener("voice",({data:f})=>{let p=t.getChVoice(f.part),m=t.#h[f.part>>4][f.part&15];Je(m.metre,t.getMapped(p.name)),m.type.setTextRaw(St[t.device.getChType()[f.part]]),m.std.setTextRaw(p.standard),m.msb.setTextRaw(`${p.sid[0]}`.padStart(3,"0")),m.prg.setTextRaw(`${p.sid[1]}`.padStart(3,"0")),m.lsb.setTextRaw(`${p.sid[2]}`.padStart(3,"0"))}),t.addEventListener("pitch",f=>{let{part:p,pitch:m}=f.data;t.#h[p>>4][p&15].notes.style.transform=`translateX(${m/1.28}%)`}),t.addEventListener("efxreverb",f=>{t.#t.reverb.setTextRaw(t.getEfx(f.data))}),t.addEventListener("efxchorus",f=>{t.#t.chorus.setTextRaw(t.getEfx(f.data))}),t.addEventListener("efxdelay",f=>{t.#t.delay.setTextRaw(t.getEfx(f.data))}),t.addEventListener("efxinsert0",f=>{t.#t.insert.setTextRaw(t.getEfx(f.data))}),t.addEventListener("partefxtoggle",f=>{let{part:p,active:m}=f.data;[V,_][m](t.#h[p>>4][p&15].number,["part-efx"])}),t.addEventListener("channeltoggle",f=>{let{part:p,active:m}=f.data;[V,_][m](t.#h[p>>4][p&15].root,["part-active"])}),t.addEventListener("channelactive",f=>{if(t.#b<b.ch){let m=t.#h[t.#b>>4][t.#b&15].number;V(m,["part-focus"])}let p=f.data;if(p<b.ch){let m=t.#h[p>>4][p&15].number;_(m,["part-focus"]),t.#b=p}}),t.addEventListener("metacommit",f=>{let p=f.data;if(t.#T&&p.type==t.#w&&t.#d)switch(p.type){case"C.Lyrics":case"KarLyric":case"SGLyrics":{A(t.#d,[k("span",["meta-slice"],{i:p.data})]);break}default:t.#d.childNodes[0].data+=p.data}else if(p.data?.length&&At.indexOf(p.type)==-1){let m=k("div",["meta-line"]),y=k("span",["field","field-key","meta-type"],{i:Dt[p.type]||p.type});switch(p.mask&&(y.style.display="none"),p.type){case"C.Lyrics":case"KarLyric":case"SGLyrics":{t.#d=k("span",["field","meta-data"]),A(t.#d,[k("span",["meta-slice"],{i:p.data})]);break}default:t.#d=k("span",["field","meta-data"],{i:p.data})}for(t.#n.view.appendChild(m),A(m,[y,t.#d]),t.#n.view.children.length>t.#f&&(t.#m=Date.now()+500,t.#o==0&&console.debug("Meta event garbage collector triggered."),t.#o=1);t.#n.view.children.length>t.#E;)t.#n.view.children[0].remove()}t.#T=p.amend||!1,t.#w=p.type||"",t.#ae()}),t.#n.view.style.transform="translateX(0px) translateY(140px)",t.#g=setInterval(async()=>{let f=Date.now();if(t.#o!=0)switch(t.#o){case 1:{if(f<t.#m)break;t.#n.view.style.transition="none";let p=0;for(;t.#n.view.children.length>t.#a;)t.#n.view.children[0].remove(),p++;t.#ae(),console.debug(`Meta event garbage collector removed ${p} events.`),t.#o=2;break}case 2:{if(f<t.#m+100)break;t.#n.view.style.transition="",T()&&console.debug("Meta event garbage collector restored meta animation."),t.#o=0;break}}},40),t.dispatchEvent("mode","?"),t.dispatchEvent("mastervolume",100),t.dispatchEvent("tempo",120),t.dispatchEvent("tsig",[4,4]),t.dispatchEvent("title",""),t.dispatchEvent("efxreverb",t.device.getEffectType(0)),t.dispatchEvent("efxchorus",t.device.getEffectType(1)),t.dispatchEvent("efxdelay",t.device.getEffectType(2)),t.dispatchEvent("efxinsert0",t.device.getEffectType(3)),t.#W(!0)}detach(e){let t=this;self.removeEventListener("resize",t.#O),t.#l.remove(),t.#l=void 0,t.#U.remove(),t.#U=void 0,t.#k=void 0,clearInterval(t.#j),clearInterval(t.#g)}constructor(e,t){super(new Ge,.1,.75);let i=this;i.#O=i.#re.bind(this),i.#se=i.#y.bind(this),i.#D.fill(null),i.#V.fill(null),e&&i.attach(e),t&&i.setClockSource(t),i.setPixelProfile("none"),i.addEventListener("reset",()=>{i.#p=0,i.#r=0,i.#T=!1,i.#w="",i.#d=null,i.#b=b.invalidCh,i.#D.fill(null),i.#V.fill(null);try{let o=i.#n.view.children;for(let f=o.length-1;f>=0;f--)o[f].remove();i.#n.view.style.transform="translateX(0px) translateY(140px)";for(let f=0;f<b.ch;f++){let p=i.#h[f>>4][f&15];V(p.root,["part-active"]),V(p.number,["part-efx","part-focus"]),Je(p.metre,""),p.type.setTextRaw(""),p.std.setTextRaw(""),p.msb.setTextRaw(""),p.prg.setTextRaw(""),p.lsb.setTextRaw(""),p.notes.style.transform="",p.ccUpdate=!0}}catch{}}),i.addEventListener("chmode",({data:o})=>{let{part:f,mode:p}=o;i.setChMode(f,p);let m=ie[p];m&&(i.#D[f]=m[i.#x])}),i.addEventListener("pitch",({data:o})=>{i.#J.push(o)})}};export{Oa as Cambiare};
