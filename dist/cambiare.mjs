var At=Object.create;var Me=Object.defineProperty;var Lt=Object.getOwnPropertyDescriptor;var It=Object.getOwnPropertyNames;var Dt=Object.getPrototypeOf,Bt=Object.prototype.hasOwnProperty;var Ot=(n,e,t)=>e in n?Me(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var Ut=(n,e)=>()=>(e||n((e={exports:{}}).exports,e),e.exports);var Nt=(n,e,t,i)=>{if(e&&typeof e=="object"||typeof e=="function")for(let l of It(e))!Bt.call(n,l)&&l!==t&&Me(n,l,{get:()=>e[l],enumerable:!(i=Lt(e,l))||i.enumerable});return n};var Vt=(n,e,t)=>(t=n!=null?At(Dt(n)):{},Nt(e||!n||!n.__esModule?Me(t,"default",{value:n,enumerable:!0}):t,n));var O=(n,e,t)=>(Ot(n,typeof e!="symbol"?e+"":e,t),t);var mt=Ut((pr,Ue)=>{(function(){"use strict";let n={fatal:!0},e=[new TextDecoder("iso-8859-15",n),new TextDecoder("utf-8",n),new TextDecoder("sjis",n),new TextDecoder("euc-jp",n),new TextDecoder("ascii")],t={debug:!1,parse:function(i,l){if(i instanceof Uint8Array)return t.Uint8(i);if(typeof i=="string")return t.Base64(i);if(i instanceof HTMLElement&&i.type==="file")return t.addListener(i,l);throw new Error("MidiParser.parse() : Invalid input provided")},addListener:function(i,l){if(!File||!FileReader)throw new Error("The File|FileReader APIs are not supported in this browser. Use instead MidiParser.Base64() or MidiParser.Uint8()");if(i===void 0||!(i instanceof HTMLElement)||i.tagName!=="INPUT"||i.type.toLowerCase()!=="file")return console.warn("MidiParser.addListener() : Provided element is not a valid FILE INPUT element"),!1;l=l||function(){},i.addEventListener("change",function(h){if(!h.target.files.length)return!1;console.log("MidiParser.addListener() : File detected in INPUT ELEMENT processing data..");let p=new FileReader;p.readAsArrayBuffer(h.target.files[0]),p.onload=function(m){l(t.Uint8(new Uint8Array(m.target.result)))}})},Base64:function(i){let l=function(m){var b="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";if(m=m.replace(/^.*?base64,/,""),m=String(m).replace(/[\t\n\f\r ]+/g,""),!/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/.test(m))throw new TypeError("Failed to execute _atob() : The string to be decoded is not correctly encoded.");m+="==".slice(2-(3&m.length));let E,C="",a,s,c=0;for(;c<m.length;)E=b.indexOf(m.charAt(c++))<<18|b.indexOf(m.charAt(c++))<<12|(a=b.indexOf(m.charAt(c++)))<<6|(s=b.indexOf(m.charAt(c++))),C+=a===64?String.fromCharCode(E>>16&255):s===64?String.fromCharCode(E>>16&255,E>>8&255):String.fromCharCode(E>>16&255,E>>8&255,255&E);return C}(i=String(i));var h=l.length;let p=new Uint8Array(new ArrayBuffer(h));for(let m=0;m<h;m++)p[m]=l.charCodeAt(m);return t.Uint8(p)},Uint8:function(p){let l={data:null,pointer:0,movePointer:function(a){return this.pointer+=a,this.pointer},readInt:function(a){if((a=Math.min(a,this.data.byteLength-this.pointer))<1)return-1;let s=0;if(1<a)for(let c=1;c<=a-1;c++)s+=this.data.getUint8(this.pointer)*Math.pow(256,a-c),this.pointer++;return s+=this.data.getUint8(this.pointer),this.pointer++,s},readStr:function(a){let s=new Uint8Array(a),c=!1,r;s.forEach((d,o)=>{s[o]=this.readInt(1)});for(let d=0;d<e.length;d++)if(!c)try{if(r=e[d].decode(s),d===0)for(let o=0;o<r.length;o++){let f=r.charCodeAt(o);if(f>191||f>127&&f<160)throw new RangeError(`Invalid code point: ${f}`)}c=!0,console.debug(`String byte sequence in ${e[d].encoding}`)}catch(o){console.debug(`SMF string ${o}`)}return r||"String byte sequence read failed."},backOne:function(){this.pointer--},readIntVLV:function(){let a=0;if(this.pointer>=this.data.byteLength)return-1;if(this.data.getUint8(this.pointer)<128)a=this.readInt(1);else{let c=[];for(;128<=this.data.getUint8(this.pointer);)c.push(this.readInt(1)-128);var s=this.readInt(1);for(let r=1;r<=c.length;r++)a+=c[c.length-r]*Math.pow(128,r);a+=s}return a}};if(l.data=new DataView(p.buffer,p.byteOffset,p.byteLength),l.readInt(4)!==1297377380)return console.warn("Header validation failed (not MIDI standard or file corrupt.)"),!1;l.readInt(4);let h={};h.formatType=l.readInt(2),h.tracks=l.readInt(2),h.track=[];var p=l.readInt(1),m=l.readInt(1);128<=p?(h.timeDivision=[],h.timeDivision[0]=p-128,h.timeDivision[1]=m):h.timeDivision=256*p+m;for(let a=1;a<=h.tracks;a++){h.track[a-1]={event:[]};var b,E=l.readInt(4);if(E===-1)break;if(E!==1297379947)return!1;l.readInt(4);let s=0,c=!1,r,d;for(;!c&&(s++,h.track[a-1].event[s-1]={},h.track[a-1].event[s-1].deltaTime=l.readIntVLV(),(r=l.readInt(1))!==-1);)if(128<=r?d=r:(r=d,l.movePointer(-1)),r===255){h.track[a-1].event[s-1].type=255,h.track[a-1].event[s-1].metaType=l.readInt(1);var C=l.readIntVLV();switch(h.track[a-1].event[s-1].metaType){case 47:case-1:c=!0;break;case 1:case 2:case 3:case 4:case 5:case 7:case 6:h.track[a-1].event[s-1].data=l.readStr(C);break;case 33:case 89:case 81:h.track[a-1].event[s-1].data=l.readInt(C);break;case 84:h.track[a-1].event[s-1].data=[],h.track[a-1].event[s-1].data[0]=l.readInt(1),h.track[a-1].event[s-1].data[1]=l.readInt(1),h.track[a-1].event[s-1].data[2]=l.readInt(1),h.track[a-1].event[s-1].data[3]=l.readInt(1),h.track[a-1].event[s-1].data[4]=l.readInt(1);break;case 88:h.track[a-1].event[s-1].data=[],h.track[a-1].event[s-1].data[0]=l.readInt(1),h.track[a-1].event[s-1].data[1]=l.readInt(1),h.track[a-1].event[s-1].data[2]=l.readInt(1),h.track[a-1].event[s-1].data[3]=l.readInt(1);break;default:this.customInterpreter!==null&&(h.track[a-1].event[s-1].data=this.customInterpreter(h.track[a-1].event[s-1].metaType,l,C)),this.customInterpreter!==null&&h.track[a-1].event[s-1].data!==!1||(l.readInt(C),h.track[a-1].event[s-1].data=l.readInt(C),this.debug&&console.info("Unimplemented 0xFF meta event! data block readed as Integer"))}}else switch((r=r.toString(16).split(""))[1]||r.unshift("0"),h.track[a-1].event[s-1].type=parseInt(r[0],16),h.track[a-1].event[s-1].channel=parseInt(r[1],16),h.track[a-1].event[s-1].type){case 15:this.customInterpreter!==null&&(h.track[a-1].event[s-1].data=this.customInterpreter(h.track[a-1].event[s-1].type,l,!1)),this.customInterpreter!==null&&h.track[a-1].event[s-1].data!==!1||(b=l.readIntVLV(),h.track[a-1].event[s-1].data=l.readInt(b),this.debug&&console.info("Unimplemented 0xF exclusive events! data block readed as Integer"));break;case 10:case 11:case 14:case 8:case 9:h.track[a-1].event[s-1].data=[],h.track[a-1].event[s-1].data[0]=l.readInt(1),h.track[a-1].event[s-1].data[1]=l.readInt(1);break;case 12:case 13:h.track[a-1].event[s-1].data=l.readInt(1);break;case-1:c=!0;break;default:if(this.customInterpreter!==null&&(h.track[a-1].event[s-1].data=this.customInterpreter(h.track[a-1].event[s-1].metaType,l,!1)),this.customInterpreter===null||h.track[a-1].event[s-1].data===!1)return console.log("Unknown EVENT detected... reading cancelled!"),!1}}return h},customInterpreter:null};if(typeof Ue<"u")Ue.exports=t;else{let i=typeof window=="object"&&window.self===window&&window||typeof self=="object"&&self.self===self&&self||typeof global=="object"&&global.global===global&&global;i.MidiParser=t}})()});var Ye=function(n,e){let t=Math.min(n.length,e.length),i=n.slice(0,t),l=e.slice(0,t),h=0,p=0;for(;p<t&&h==0;)h=Math.sign(i[p]-l[p]),p++;return h},H=function(n=""){this.name=n,this.pool=[],this.point=function(e,t=!1){if(this.pool.length>0){let i=this.pool.length,l=1<<Math.floor(Math.log2(i)),h=l,p=64;for(;l>=1&&p>=0;){if(p<=0)throw new Error("TTL reached.");if(h==i)h-=l;else{let b=Ye(e,this.pool[h]);switch(b){case 0:{p=0;break}case 1:{h+l<=i&&(h+=l);break}case-1:{h!=0&&(h-=l);break}default:console.warn(`Unexpected result ${b}.`)}}l=l>>1,p--}let m=!0;if(h>=this.pool.length)m=!1;else{let b=this;this.pool[h].forEach(function(E,C,a){m&&E!=e[C]&&(m=!1)}),!m&&Ye(e,this.pool[h])>0&&h++}return m||t?h:-1}else return t?0:-1},this.add=function(e,t){return e.data=t,this.pool.splice(this.point(e,!0),0,e),this},this.default=function(e){console.warn(`No match in "${this.name||"(unknown)"}" for "${e}". Default action not defined.`)},this.get=function(e){let t=this.point(e);if(t>-1)return this.pool[t].data;this.default(e)},this.run=function(e,...t){let i=this.point(e);i>-1?e.subarray?this.pool[i].data(e.subarray(this.pool[i].length),...t):this.pool[i].data(e.slice(this.pool[i].length),...t):this.default(e,...t)}};var me=class{#a={};addEventListener(n,e){this.#a[n]||(this.#a[n]=[]),this.#a[n].unshift(e)}removeEventListener(n,e){if(this.#a[n]){let t=this.#a[n].indexOf(e);t>-1&&this.#a[n].splice(t,1),this.#a[n].length<1&&delete this.#a[n]}}dispatchEvent(n,e){let t=new Event(n),i=this;t.data=e,this.#a[n]?.length>0&&this.#a[n].forEach(function(l){try{l?.call(i,t)}catch(h){console.error(h)}}),this[`on${n}`]&&this[`on${n}`](t)}};var _t=["MSB","PRG","LSB","NME","ELC","DRM","LVL","VXP"],Xt={krs:"KR",s90es:"ES",motif:"ES"},Ht={krs:"Kr",s90es:"SE",motif:"ME"},j={g2:new Set("gm,GM,g2,G2".split(",")),xg:new Set};for(let n of"XG,MU,AN,AP,DR,DX,PC,PF,SG,VL".split(","))j.xg.add(n),j.xg.add(n.toLowerCase());var Pe=function(n){let e=Math.floor(n/10),t=n%10;return`${e.toString(16)}${t}`},Re=class{HINT_XG_MUBASIC=0;HINT_XG_MU100=1;HINT_XG_PSR=2;#a;get bankInfo(){return this.#a}strictMode=!1;get(n=0,e=0,t=0,i,l=0){let h=[n,e,t],p,m=1,b=0,E,C,a,s=Array.from(arguments);switch(i){case"xg":{switch(n){case 0:{if(l===2)t>>4===7?s[2]+=16:t>>3===13&&(s[2]+=40);else switch(t){case 127:{s[2]=0;break}}break}case 16:{t===126&&(s[2]=0);break}case 32:{t>125&&(s[2]=0),s[2]+=4;break}case 33:{(t>125||t===3)&&(s[2]=0),s[2]+=5;break}case 34:case 35:case 36:{t>125&&(s[2]=0),s[2]+=5;break}case 79:case 80:case 81:case 82:case 83:case 84:s[0]+=16;case 95:case 96:case 97:case 98:case 99:case 100:{t===126&&(s[2]=0);break}case 48:case 64:case 126:case 127:{t===126&&(n===127&&e===0||(s[2]=0));break}case 121:{switch(t){case 126:{s[2]=0;break}case 16:{s[2]=15;break}default:s[2]=s[2]&15}break}}break}case"gs":case"sc":{n===0&&t<5?s[0]=49:n<128&&n>125&&t<5&&t!==2&&(s[2]=n,s[0]=49);break}case"mt32":{n===0&&(s[0]=49);break}case"sd":{switch(n){case 121:{s[0]=96;break}case 120:{s[0]=104;break}}s[0]>>1===40?s[2]|=16:s[0]>95&&s[0]<100&&(s[2]|=16,e>>4===7&&(s[0]=96));break}case"pa":{switch(n){case 120:{t==64?s[2]=2:s[2]=1;break}case 121:{switch(t){case 127:{s[2]=79;break}default:s[2]=(s[2]&63)+32}break}}break}case"g2":{n>>1===40?s[2]|=16:n>95&&n<100&&(s[2]|=16,e>>4===7&&(s[0]=96));break}case"sg":{n===8&&t===0&&(s[2]=5);break}case"05rw":case"x5d":{n&&n<56&&(s[0]=56);break}case"s90es":case"motif":case"an1x":case"cs1x":case"cs6x":{if(n===0)break;switch(n){case 63:{switch(i){case"s90es":{t<8?s[2]+=17:t<32?s[2]+=13:s[2]=(s[2]>>3)+19;break}case"motif":{t<8?s[2]+=28:t<32?s[2]+=13:s[2]=(s[2]>>3)+19;break}case"cs1x":{switch(t>>1){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:case 10:{s[2]+=34;break}case 32:{s[2]=34+((t&1)<<2);break}case 33:{s[2]=47+((t&1)<<2);break}case 61:{s[2]=34+((t&1)<<2);break}case 62:{s[2]=47+((t&1)<<2);break}}break}}break}case 32:{t>125&&(s[2]=0),s[2]+=4;break}case 33:{(t>125||t===3)&&(s[2]=0),s[2]+=5;break}case 34:case 35:case 36:{t>125&&(s[2]=0),s[2]+=5;break}case 79:case 80:case 81:case 82:case 83:case 84:s[0]+=16;case 95:case 96:case 97:case 98:case 99:case 100:{t===126&&(s[2]=0);break}}break}}let c=" ",r="M",d="",o=0,f=0;switch(s[0]){case 0:{switch(s[2]){case 127:{r="GM-a";break}case 126:{r="GM-n";break}case 7:{r="GM-k",d="GLX";break}case 5:{r="SG-a",d="000";break}case 4:{i==="gs"||i==="sc"?(r="GM-a",d="000"):(r="SP-l",d="C/M");break}case 3:case 2:case 1:{(i==="gs"||i==="sc")&&(r="GM-a",d="000");break}case 0:{r="GM-a";break}default:r="y",o=3}break}case 8:{i==="sg"?r="GM-s":r="r:";break}case 32:case 33:case 34:case 35:case 36:{i==="xg"&&(r=`${["AP","VL","PF","DX","AN"][n&7]}-${"abcdefgh"[t]}`,o=3);break}case 48:{d=`M${(s[2]>>3).toString().padStart(2,"0")}`,r=`y${d}`,o=1;break}case 49:{s[2]>>1===63?(r=`MT-${"ba"[s[2]&1]}`,d=`C${"-/"[s[2]&1]}M`):(r="GM-a",d="000");break}case 56:{r="GM-b";break}case 57:r=["yDOC","QY10","QY20"][s[2]-112]||"yMxv",d=["DOC","QY1","QY2"][s[2]-112]||"057";case 61:case 128:{r="rDrm";break}case 120:{r="gDrm";break}case 62:{r="kDrm";break}case 63:{if(s[2]<17){let k=s[2];r=k<10?"kP:":"kC:",r+=k%10}else if(s[2]<34)r=["Pre1","Pre2","Pre3","Pre4","Usr1","Usr2","DrmP","DrmU","Plg1","Plg2","Plg3","Pre1","Pre2","Pre3","Pre4","Pre5","Pre6"][s[2]-17];else if(s[2]<55){let k=s[2]-34;switch(k>12&&k--,t>>1){case 32:case 33:{r=`Pr${t-63}U`;break}case 61:case 62:{r=`Pr${t-121}U`;break}default:r=s[2]===46?"PrDr":`Pr${(k>>2)+1}${String.fromCharCode(65+(k&3))}`}}else r="Ds";o=1;break}case 64:{r="ySFX",d="SFX";break}case 67:{r="DX:S";break}case 80:case 81:case 82:case 83:{r=`Prg${"UABC"[s[0]-80]}`;break}case 88:case 89:case 90:case 91:{r=`Cmb${"UABC"[s[0]-88]}`;break}case 95:{r=`${["DR","PC"][s[2]]}-d`;break}case 96:{r=s[2]===106?"AP-a":s[2]>>4===1?"SDg":"PF",s[2]>63?f=63:s[2]>>4===1&&(f=16),o=3;break}case 97:{r=s[2]>>4===1?"SDa":"VL:",o=3,s[2]>>4===1?f=16:f=112;break}case 98:{r=s[2]>>4===1?"SDb":"SG-a",o=3,f=16;break}case 99:{r=s[2]>>4===1?"SDc":"DX",s[2]>63?f=63:s[2]>>4===1&&(f=16),o=3;break}case 100:{r="AN",s[2]>63?f=63:s[2]>>4===1&&(f=16),o=3;break}case 104:case 105:case 106:case 107:{r="SDd",f=104;break}case 121:{r=`GM${s[2]?"":"-a"}`,o=1;break}case 122:{r="lDrm";break}case 126:{r="yDrS";break}case 127:{s[2]===127?r="rDrm":r="yDrm";break}default:s[0]<48?r="r:":r="M"}r.length<4&&(r+=`${[n,t,s[0],s[2]][o]-f}`.padStart(4-r.length,"0")),d.length<3&&(d+=`${[n,t,n,t][o]}`.padStart(3-d.length,"0")),i==="xg"&&(n===0?s[2]<100?r=r.replace("y0","y:"):s[2]===125&&(r="y126"):n===16?(p=`Voice${((s[2]<<7)+s[1]+1).toString().padStart(3,"0")}`,c=" "):n===35&&t>>1===2&&(p=`DXCH_${(((s[2]&1)<<7)+e+1).toString().padStart(3,"0")}`,c=" "));let g=[s[0],s[1],s[2]];for(;!(p?.length>=0);)if(p=this.#a[s[1]||0][(s[0]<<8)+s[2]]?.name,p){let k=this.#a[s[1]||0][(s[0]<<8)+s[2]];m=k?.poly||m,b=k?.type||b,E=k?.drum,C=k?.level,a=k?.voice}else if(this.strictMode)p="",c="?";else if(s[0]===0&&s[1]===0&&s[2]===0)p="Unloaded";else if(this.#a[s[1]||0][s[0]<<8])s[0]===0?(s[2]=0,c="^"):s[2]<1?(s[0]=0,c="*"):(s[2]--,c="^");else if(n===48)s[0]=0,s[2]=0,c="!";else if(n===62)s[1]--,c=" ",s[1]<1&&!p?.length&&(s[0]=0,c="!");else if(n<63)s[0]===0?(s[2]=0,c="^"):s[2]<1?(s[0]=0,c="*"):s[2]--;else if(n===80)p=`PrgU:${e.toString().padStart(3,"0")}`,c="!";else if(n===88)p=`CmbU:${e.toString().padStart(3,"0")}`,c="!";else if(n===121)p=`GM2Vox0${t}`,c="#";else if(n===122)if(s[1]===32?s[1]:s[1]%=7,p=this.#a[s[1]||0][(s[0]<<8)+s[2]]?.name,p){c=" ";let k=this.#a[s[1]||0][(s[0]<<8)+s[2]];m=k?.poly||m,b=k?.type||b,E=k?.drum,C=k?.level}else p="",c="*";else s[1]===0?(p=`${n.toString().padStart(3,"0")} ${e.toString().padStart(3,"0")} ${t.toString().padStart(3,"0")}`,c="!"):s[0]===0?(s[2]=0,c="^"):s[2]>0?s[2]--:s[1]>0?(s[1]=0,c="!"):(s[0]=0,c="?");let u=[s[0],s[1],s[2]];switch(c){case"^":{switch(i){case"gs":case"sc":case"ns5r":{c=" ";break}case"xg":{(t===126||t===152)&&(c=" ");break}}n===127&&(c=" ");break}case"*":break;case"!":break;case"?":break}let w="??";switch(s[0]){case 0:{s[2]===0?w="GM":s[2]===5||s[2]===7?w="KG":s[2]<154&&(w="XG");break}case 32:case 33:case 35:case 36:{s[2]>4?w=["AP","VL","PF","DX","AN"][s[0]-32]:w="GS";break}case 48:{w="MU";break}case 49:{s[2]>>1===63?w="MT":s[2]<5&&(w="GM");break}case 56:case 62:{w="AG";break}case 61:case 80:case 83:case 88:case 89:case 91:{w="AI";break}case 82:case 90:{w="XD";break}case 63:{s[2]<17?w="KR":s[2]<34?w="ES":s[2]<55?w="CS":w="DS";break}case 64:case 126:{w="XG";break}case 67:case 99:{w=s[2]>>4===1?"SD":"DX";break}case 81:{w="RW";break}case 95:{w=["DR","PC"][s[2]];break}case 96:{w=s[2]===106?"AP":s[2]>>4===1?"SD":"PF";break}case 97:{w=s[2]>>4===1?"SD":"VL";break}case 98:{w=s[2]>>4===1?"SD":"SG";break}case 100:{w="AN";break}case 104:case 105:case 106:case 107:{w="SD";break}case 120:{w=e===0?"GM":["G2","PA","PA"][s[2]]??"G2";break}case 128:{w=e===0?"GM":"GS";break}case 121:{w=s[2]?["G2","XG","PA","PA","PA"][s[2]>>4]:"GM";break}case 122:{w="KG";break}case 127:{w=s[2]===127?"MT":e===0?"GM":"XG";break}default:s[0]<48&&(s[0]===16&&i==="xg"?w="XG":w="GS")}switch(i){case"xg":{let k=0,S=0,M="GM",B=!1,P=!1;if(j.xg.has(w)||j.g2.has(w)?c!==" "?n>>4===6?P=!0:n!==0&&(B=!0):g[2]!==u[2]&&(n===81?t>>3===14?(k=97,S=112,P=!0,M="VL"):t>>3===15&&(B=!0):n===97&&(P=!0)):n>>4===6?P=!0:B=!0,P&&n===0&&t===0&&(S=[0,126,152][l]),B)p="Silence",c="?",w="??";else if(P){let Y=this.#a[e][k<<8|S];w=M,p=Y?.name,m=Y?.poly||m,b=Y?.type||b,E=Y?.drum,C=Y?.level,a=Y?.voice,c="^"}break}}if(c!==" ")switch(i){case"krs":case"s90es":case"motif":{p="",w=Xt[i],c="?";break}case"g2":{p="GM2 Ext?",c="?";break}case"pa":{c==="^"&&(p="Unknown",c="?");break}case"xg":{if(c!=="^"){switch(n){case 120:case 127:case 126:{p="SilntKit";break}default:p="Silence"}c="?"}break}default:self.debugMode&&(p="",c="?")}return c==="?"&&(m=0),{name:p||`${Ht[i]||i.toUpperCase()}${Pe(n||0)}${Pe(e||0)}${Pe(t||0)}`,poly:m,type:b,drum:E,level:C,voice:a,iid:g,eid:u,sid:h,hint:l,ending:c,sect:r,bank:d,standard:w,mode:i}}async load(n,e,t="(internal)",i){let l=this,h=[],p=0,m=0,b=0;n.split(`
`).forEach(function(E,C){let a=E.split("	"),s=[];if(C===0){if(a.forEach(function(c,r){h[_t.indexOf(c)]=r}),h.length<4){console.debug("Debugger launched.");debugger}}else{let c=0,r=0,d=0,o,f=1,g=0,u,w,k;a.forEach(function(P,Y){switch(Y){case h[0]:{c=parseInt(P);break}case h[1]:{r=parseInt(P);break}case h[2]:{d=parseInt(P);break}case h[3]:{o=P;break}case h[4]:{P=parseInt(P),P<16?f=P+1:(g=(P&15)+1,f=g);break}case h[5]:{w=P;break}case h[6]:{typeof P=="string"&&(u=parseInt(P));break}case h[7]:{k=P;break}}}),l.#a[r]=l.#a[r]||[];let S=l.#a[r],M={msb:c,prg:r,lsb:d,name:o,poly:f,type:g,drum:w,level:u,voice:k,priority:i},B=!1;i<S[c<<8|d]?.priority&&(B=!0,b++),(!S[c<<8|d]||B||e)&&(S[c<<8|d]=M,p++),m++}}),e||console.debug(`Map: From "${t}", ${m} total, ${p} loaded (${p-b} + ${b}).`)}clearRange(n){let e=n.prg!==void 0?n.prg.constructor===Array?n.prg:[n.prg,n.prg]:[0,127],t=n.msb!==void 0?n.msb.constructor===Array?n.msb:[n.msb,n.msb]:[0,127],i=n.lsb!==void 0?n.lsb.constructor===Array?n.lsb:[n.lsb,n.lsb]:[0,127];for(let l=t[0];l<=t[1];l++){let h=l<<8;for(let p=i[0];p<=i[1];p++){let m=h+p;for(let b=e[0];b<=e[1];b++)delete this.#a[b][m]}}}init(){this.#a=[];for(let n=0;n<128;n++)this.#a.push([""])}async loadFiles(...n){this.init();let e=this;n.forEach(async function(t,i){try{e.load(await(await fetch(`./data/bank/${t}.tsv`)).text(),!1,t,i)}catch{console.error(`Failed loading "${t}.tsv".`)}})}constructor(...n){this.loadFiles(...n)}};var We=class{#a={};context;set(n,e){this.#a[n]=e}has(n){return!!this.#a[n]}async read(n,e){if(!this.has(n))throw new Error(`No decoder registered for "${n}"`);return await this.#a[n].call(this.context||this,e)}};var Gt=function(n,e){let t=!0;return e.forEach((i,l)=>{t=t&&n[l]===i}),t},ne=function(n){let e=0;return n.forEach(t=>{e*=256,e+=t}),e},W=new TextDecoder,le=new We;le.set("s7e",async function(n){let e=new Uint8Array(await n.slice(0,65536).arrayBuffer()),t="MSB	LSB	PRG	NME",i=[0,0,0,0],l=32,h=0,p=0,m=!0,b=[],E=0;for(;m;){let C=e.subarray(h);([()=>{W.decode(C.subarray(0,4))==="YSFC"?(h+=80,p=1):h++},()=>{if(Gt(C.subarray(0,4),i))b.forEach((a,s,c)=>{let r=ne(e.subarray(a.start+4,a.start+8));a.length=r}),p=2;else{let a=W.decode(C.subarray(0,4)),s=ne(C.subarray(4,8));b.push({type:a,start:s}),h+=8}},()=>{let a=b[E],s=e.subarray(a.start,a.start+a.length),c=32;switch(a.type){case"ENVC":{let r=l;for(;r<s.length;){let d=s.subarray(r,r+c),o=W.decode(d.subarray(0,10)).trimEnd();o.slice(0,5)==="Init "&&(o=""),o&&(t+=`
063	${(d[17]+13).toString().padStart(3,"0")}	${d[19].toString().padStart(3,"0")}	${o}`),r+=c}break}case"EDVC":{let r=l;for(;r<s.length;){let d=s.subarray(r,r+c),o=W.decode(d.subarray(0,10)).trimEnd();o.slice(0,5)==="Init "&&(o=""),o&&(t+=`
063	024	${d[19].toString().padStart(3,"0")}	${o}`),r+=c}break}case"EPVC":{let r=32,d=l;for(;d<s.length;){let o=s.subarray(d,d+r),f=W.decode(o.subarray(0,10)).trimEnd();f==="----------"&&(f=""),f&&(t+=`
063	${(o[17]+1).toString().padStart(3,"0")}	${o[19].toString().padStart(3,"0")}	${f}`),d+=r}break}}E++,E>=b.length&&(p=3,m=!1)}][p]||(()=>{m=!1}))()}return t});le.set("pcg",async function(n){let e=new Uint8Array(await n.arrayBuffer()),t="MSB	LSB	PRG	NME",i=100,l=0,h=0,p=!0,m=[],b=0;for(;p;){let E=e.subarray(i);([()=>{p=W.decode(E.subarray(0,4))==="INI2",h=E[15],i+=16,l=1},()=>{let C=W.decode(E.subarray(0,4)),a=E[5],s=E[7],c=E[11],r=ne(E.subarray(12,16)),d=ne(E.subarray(16,20)),o=ne(E.subarray(36,40)),f=W.decode(E.subarray(44,44+c));m.push({type:C,tipMsb:a,tipLsb:s,nameLen:c,length:r,start:d,entryLen:o,name:f}),i+=64,h--,h<1&&(l=2)},()=>{let C=m[b],a=e.subarray(C.start,C.start+C.length);switch(C.type){case"PRG1":break;case"PBK1":{let s=63,c=(C.tipMsb?6:0)+C.tipLsb;for(let r=0;r<128;r++){let d=r*C.entryLen,o=a.subarray(d,d+C.entryLen),f=W.decode(o.subarray(0,24)).trimEnd().replace("InitProg","");f.length&&c>5&&(t+=`
${s.toString().padStart(3,"0")}	${c.toString().padStart(3,"0")}	${r.toString().padStart(3,"0")}	${f}`)}break}case"CBK1":{let s=63,c=(C.tipMsb?3:0)+C.tipLsb+10;for(let r=0;r<128;r++){let d=r*C.entryLen,o=a.subarray(d,d+C.entryLen),f=W.decode(o.subarray(0,24)).trimEnd().replace("InitCombi","");f.length&&c>12&&(t+=`
${s.toString().padStart(3,"0")}	${c.toString().padStart(3,"0")}	${r.toString().padStart(3,"0")}	${f}`)}break}}b++,b>=m.length&&(l=3,p=!1)}][l]||(()=>{p=!1}))()}return t});var oe=["off","hall","room","stage","plate","delay LCR","delay LR","echo","cross delay","early reflections","gate reverb","reverse gate"].concat(new Array(4),["white room","tunnel","canyon","basement","karaoke"],new Array(43),["pass through","chorus","celeste","flanger","symphonic","rotary speaker","tremelo","auto pan","phaser","distortion","overdrive","amplifier","3-band EQ","2-band EQ","auto wah"],new Array(1),["pitch change","harmonic","touch wah","compressor","noise gate","voice channel","2-way rotary speaker","ensemble detune","ambience"],new Array(4),["talking mod","Lo-Fi","dist + delay","comp + dist + delay","wah + dist + delay","V dist","dual rotor speaker"]),ce=["melodic","drums","drum set 1","drum set 2","drum set 3","drum set 4","drum set 5","drum set 6","drum set 7","drum set 8"],Ft=[17.1,18.6,20.2,21.8,23.3,24.9,26.5,28,29.6,31.2,32.8,34.3,35.9,37.5,39,40.6,42.2,43.7,45.3,46.9,48.4,50],ae=[20,22,25,28,32,36,40,45,50,56,63,70,80,90,100,110,125,140,160,180,200,225,250,280,315,355,400,450,500,560,630,700,800,900,1e3,1100,1200,1400,1600,1800,2e3,2200,2500,2800,3200,3600,4e3,4500,5e3,5600,6300,7e3,8e3,9e3,1e4,11e3,12e3,14e3,16e3,18e3,2e4],ze=[0,.04,.08,.13,.17,.21,.25,.29,.34,.38,.42,.46,.51,.55,.59,.63,.67,.72,.76,.8,.84,.88,.93,.97,1.01,1.05,1.09,1.14,1.18,1.22,1.26,1.3,1.35,1.39,1.43,1.47,1.51,1.56,1.6,1.64,1.68,1.72,1.77,1.81,1.85,1.89,1.94,1.98,2.02,2.06,2.1,2.15,2.19,2.23,2.27,2.31,2.36,2.4,2.44,2.48,2.52,2.57,2.61,2.65,2.69,2.78,2.86,2.94,3.03,3.11,3.2,3.28,3.37,3.45,3.53,3.62,3.7,3.87,4.04,4.21,4,37,4.54,4.71,4.88,5.05,5.22,5.38,5.55,5.72,6.06,6.39,6.73,7.07,7.4,7.74,8.08,8.41,8.75,9.08,9.42,9.76,10.1,10.8,11.4,12.1,12.8,13.5,14.1,14.8,15.5,16.2,16.8,17.5,18.2,19.5,20.9,22.2,23.6,24.9,26.2,27.6,28.9,30.3,31.6,33,34.3,37,39.7],qe=function(n){let e=.1,t=-.3;return n>66?(e=5,t=315):n>56?(e=1,t=47):n>46&&(e=.5,t=18.5),e*n-t},Qe=function(n){return n>105?Ft[n-106]:n>100?n*1.1-100:n/10},Je=",a,i,u,e,o,ka,ki,ku,ke,ko,ky,kw,sa,si,su,se,so,sh,ta,ti,tu,te,to,t,ch,t,s,na,ni,nu,ne,no,ny,nn,ha,hi,hu,he,ho,hy,fa,fi,fu,fe,fo,ma,mi,mu,me,mo,my,mm,ya,yu,ye,yo,ra,ri,ru,re,ro,ry,wa,wi,we,wo,ga,gi,gu,ge,go,gy,gw,za,zi,zu,ze,zo,ja,ji,ju,je,jo,jy,da,di,du,de,do,dy,ba,bi,bu,be,bo,by,va,vi,vu,ve,vo,pa,pi,pu,pe,po,py,nga,ngi,ngu,nge,ngo,ngy,ng,hha,hhi,hhu,hhe,hho,hhy,hhw,*,_,,,~,.".split(","),Ae={};`hi*,
ka,„Åã
ki,„Åç
ku,„Åè
ke,„Åë
ko,„Åì
ky,„Åç!
kw,„Åèl
tsu,„Å§
ts,„Å§l
sa,„Åï
si,„Åô„ÅÉ
su,„Åô
se,„Åõ
so,„Åù
shi,„Åó
sh,„Åó!
ta,„Åü
ti,„Å¶„ÅÉ
tu,„Å®„ÅÖ
te,„Å¶
to,„Å®
tchy,„Å°!
tchi,„Å°
na,„Å™
ni,„Å´
nu,„Å¨
ne,„Å≠
no,„ÅÆ
ny,„Å´!
nn,„Çì
ha,„ÅØ
hi,„Å≤
hu,„Åª„ÅÖ
he,„Å∏
ho,„Åª
hy,„Å≤!
fa,„Åµ„ÅÅ
fi,„Åµ„ÅÉ
fu,„Åµ
fe,„Åµ„Åá
fo,„Åµ„Åâ
ma,„Åæ
mi,„Åø
mu,„ÇÄ
me,„ÇÅ
mo,„ÇÇ
my,„Åø!
mm,„á∫
ra,„Çâ
ri,„Çä
ru,„Çã
re,„Çå
ro,„Çç
ry,„Çä!
wa,„Çè
wi,„Çê
we,„Çë
wo,„Çí
nga,„Åã„Çö
ngi,„Åç„Çö
ngu,„Åè„Çö
nge,„Åë„Çö
ngo,„Åì„Çö
ngy,„Åç„Çö!
ng,„É≥
ga,„Åå
gi,„Åé
gu,„Åê
ge,„Åí
go,„Åî
gy,„Åé!
gw,„Åêl
za,„Åñ
zi,„Åö„ÅÉ
zu,„Åö
ze,„Åú
zo,„Åû
ja,„Åò„ÇÉ
ji,„Åò
ju,„Åò„ÇÖ
je,„Åò„Åá
jo,„Åò„Çá
jy,„Åò!
da,„Å†
di,„Åß„ÅÉ
du,„Å©„ÅÖ
de,„Åß
do,„Å©
dy,„Åß!
ba,„Å∞
bi,„Å≥
bu,„Å∂
be,„Åπ
bo,„Åº
by,„Å≥!
va,„Çî„ÅÅ
vi,„Çî„ÅÉ
vu,„Çî
ve,„Çî„Åá
vo,„Çî„Åâ
pa,„Å±
pi,„Å¥
pu,„Å∑
pe,„Éö
po,„ÅΩ
py,„Å¥!
!ya,„ÇÉ
!yu,„ÇÖ
!ye,„Åá
!yo,„Çá
ya,„ÇÑ
yu,„ÇÜ
ye,õÄÅ
yo,„Çà
!a,„ÇÉ
!u,„ÇÖ
!e,„Åá
!o,„Çá
!a,„ÇÉ
!u,„ÇÖ
!e,„Åá
!o,„Çá
la,„ÅÅ
li,„ÅÉ
lu,„ÅÖ
le,„Åá
lo,„Åâ
a,„ÅÇ
i,„ÅÑ
u,„ÅÜ
e,„Åà
o,„Åä
*,„Å£
~,
^,
_,`.split(`
`).forEach(n=>{let e=n.split(",");Ae[e[0]]=e[1]});var Ze=function(n){let e=n;n[0]=="*"&&(e=e.slice(1)),["aa","ii","uu","ee","oo"].forEach(i=>{for(;e.indexOf(i)>-1;)e=e.replace(i,i[0])});for(let i in Ae)e=e.replaceAll(i,Ae[i]);e.indexOf("„Çì")==0&&e.length>1&&(e=e.slice(1));let t=e.indexOf("!");return t>-1&&e.length>1&&(e=e.slice(t+1)),e},je=function(n){return n?n<96?`cc${n}`:["aftertouch","velocity","pitch bend"][n-96]:"off"},et={"":["l9","Undefined fallback"],u8:["utf-8","Unicode"],l1:["l9","Pan-Latin"],jp:["sjis","Japanese"],kr:["iso-2022-kr","Korean"],hz:["gb18030","Simplified Chinese"],b5:["big5","Traditional Chinese"],cy:["koi8-ru","Cyrillic"],vn:["tcvn-5773-1993","Vietnamese"]},tt={m:"Male",f:"Female",c:"Chorus",s:"Solo",p:"Plural",w:"Words",x:"Non-vocal"};var Le=["room 1","room 2","room 3","hall 1","hall 2","plate","delay","panning delay"],at=["chorus 1","chorus 2","chorus 3","chorus 4","feedback","flanger","short delay","short delay feedback"],rt=["delay 1","delay 2","delay 3","delay 4","pan delay 1","pan delay 2","pan delay 3","pan delay 4","delay to reverb","pan repeat"];var Kt={0:"thru",256:"stereo EQ",257:"spectrum",258:"enhancer",259:"humanizer",272:"overdrive",273:"distortion",288:"phaser",289:"auto wah",290:"rotary",291:"stereo flanger",292:"step flanger",293:"tremelo",294:"auto pan",304:"compressor",305:"limiter",320:"hexa chorus",321:"tremelo chorus",322:"stereo chorus",323:"space D",324:"3D chorus",336:"stereo delay",337:"modulated delay",338:"3-tap delay",339:"4-tap delay",340:"tremelo control delay",341:"reverb",342:"gate reverb",343:"3D delay",352:"2-pitch shifter",353:"feedback pitch shifter",368:"3D auto",369:"3D manual",370:"Lo-Fi 1",371:"Lo-Fi 2",512:"overdrive - chorus",513:"overdrive - flanger",514:"overdrive - delay",515:"distortion - chorus",516:"distortion - flanger",517:"distortion - delay",518:"enhancer - chorus",519:"enhancer - flanger",520:"enhancer - delay",521:"chorus - delay",522:"flanger - delay",523:"chorus - flanger",524:"rotary multi",1024:"guitar multi 1",1025:"guitar multi 2",1026:"guitar multi 3",1027:"clean guitar multi 1",1028:"clean guitar multi 2",1029:"bass multi",1030:"rhodes multi",1280:"keyboard multi",4352:"chorus / delay",4353:"flanger / delay",4354:"chorus / flanger",4355:"overdrive / distortion",4356:"overdrive / rotary",4357:"overdrive / phaser",4358:"overdrive / auto wah",4359:"phaser / rotary",4360:"phaser / auto wah"},Yt={66307:["drive"],66309:["vowel",n=>"aiueo"[n]],94723:["pre-filter"],94724:["Lo-Fi type"],94725:["post-filter"],94979:["Lo-Fi type"],94980:["fill type",n=>["off","LPF","HPF"][n]],94984:["noise type",n=>["white","pink"][n]],94987:["disc type",n=>["LP","SP","EP","RND"]],94990:["hum type",n=>`${n+5}0Hz`],94993:["M/S",n=>["mono","stereo"][n]]},Ie=function(n){return Kt[(n[0]-32<<8)+n[1]]||`0x${n[0].toString(16).padStart(2,"0")}${n[1].toString(16).padStart(2,"0")}`},it=function(n,e,t){let i=(n[0]-32<<16)+(n[1]<<8)+e,l=Yt[i]||{},h=l[0];if(h?.length)return h+=`: ${(l[1]||function(){})(t)||t}`,h},De=[68,48,95,78,41,3,110,122,0];var z=new TextEncoder,st=(n,e)=>{let t=Math.min(n.length,e.length),i=0;for(let l=0;l<t;l++)if(i=n[l]-e[l],i!==0)return[l,i];return n.length!==e.length?[t,n.length-e.length]:[0,0]},V=function(n=64){return Math.round(2e3*Math.log10(n/64))/100},nt=function(n,e,t){let i=[],l=t==!1?e.readIntVLV():t;n==0||n==127;for(let h=0;h<l;h++){let p=e.readInt(1);if(i.push(p),p!=247){if(p!=240){if(p>127)return console.debug(`Early termination: ${i}`),i.pop(),e.backOne(),e.backOne(),new Uint8Array(i)}}}return new Uint8Array(i)},ee=function(n){let e=0;return n.forEach(t=>{e+=t,e=e&127}),~e+1&127},G=function(n,e){let t=0,i=0;for(let l=0;l<n.length;l++){let h=(l&7)-1,p=(i>>h&1)<<7,m=n[l];m+=p,l&7?(e(m,t,n),t++):i=n[l]}};var Wt=function(n,e){let t=0;for(let i=0;i<n.length;i++)if(i&1){t=t<<4|n[i]&15;let l=i>>1;e(t,l,n)}else t=n[i]&15},lt=function(n){let e=n.length>>1,t=new Uint8Array(e);return Wt(n,(i,l)=>{t[l]=i}),t},de=function(n){let e=Math.floor(n*14.2);return e<128?e:0},T=function(){return self?.debugMode??!1},ot=function(n){let e=(n.length+1)*3>>2,t=new Uint8Array(e),i=n.length+3>>2;for(let l=0;l<i;l++){let h=l<<2,p=l*3,m=0;for(let b=0;b<4;b++)m<<=6,m|=n.charCodeAt(h+b)-32&63;t[p]=m>>16,t[p+1]=m>>8&255,t[p+2]=m&255}return t};var _a="‚ô≠ùÑ´,ùÑ´,‚ô≠,,‚ôØ,ùÑ™,ùÑ™‚ôØ".split(",");var N=[new Map,new Map];N[0].set("base64",z.encode("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"));N[0].set("base64url",z.encode("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"));N[0].set("hex",z.encode("0123456789abcdef"));N[0].set("ovm43",z.encode("0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_"));N[0].set("radix64",z.encode("0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz+/"));N[0].set("radix64url",z.encode("0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_"));N[0].set("xx",z.encode("+-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz"));N[0].set("xxurl",z.encode("_-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz"));N[0].set("z64",z.encode("0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ+/"));N[0].set("z64url",z.encode("0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ-_"));for(let[n,e]of N[0]){let t=new Uint8Array(128).fill(255);for(let i=0;i<e.length;i++)t[e[i]]=i;switch(n){case"hex":{for(let i=10;i<16;i++)t[i+55]=i;break}default:t[9]=254,t[10]=254,t[12]=254,t[13]=254,t[32]=254,t[61]=254}N[1].set(n,t)}console.debug(N);var zt=(n="base64",e,t=!1)=>{};self.bufferTo=zt;var ye={red:"#ff7986",orange:"#fca022",grYellow:"#c9e10a",green:"#c1ff0a",white:"#b7e5e3",blue:"#2280ff"},be={black:"#000000",blue:"#0516bb",purple:"#48009a",inactive:22,medium:59,active:170,range:148},qt=[[6,26],[7,35],[8,44],[9,53],[10,62],[11,71],[12,80],[13,89],[14,98],[15,107],[16,116],[17,125],[18,134],[19,143],[20,152],[21,161],[22,170]],fe={},Qt="06,68,2a,16,aa,3b".split(",");for(let n in be)fe[n]=[],Qt.forEach(e=>{fe[n].push(`${be[n]}${e}`)});var we=[];for(let n of qt)we.push([`${be.black}${n[0].toString(16).padStart(2,"0")}`,`${be.black}${n[1].toString(16).padStart(2,"0")}`]),n.push(n[1]-n[0]);var Ha=`${ye.orange}64`,Ga=`${ye.green}64`,Fa=`${ye.white}64`,Ka=`${ye.red}64`,Ya=fe.black[0],Wa=fe.black[2],za=fe.black[1];var L=["?","gm","gs","sc","xg","g2","mt32","doc","qy10","qy20","ns5r","x5d","05rw","k11","sg","sd","pa","krs","s90es","motif","cs6x","trin","an1x","cs1x"],Jt={gm2:"g2","mt-32":"mt32","c/m":"mt32",ag10:"05rw","ag-10":"05rw","05r/w":"05rw",x5:"05rw",x5dr:"x5d",gmega:"k11","kross 2":"krs","motif es":"motif","s90 es":"s90es",trinity:"trin","tr-rack":"trin"},Zt=["melodic","drum","menu"],he={"?":[0,0,120,0,0],gm:[0,0,120,0,0],gs:[0,0,128,0,0],sc:[0,0,128,0,0],xg:[0,0,127,0,0],g2:[0,0,120,0,0],mt32:[0,127,127,0,127],doc:[57,112,127,57,112],qy10:[57,113,127,57,113],qy20:[57,114,127,57,114],ns5r:[0,0,61,0,0],x5d:[82,0,62,56,0],"05rw":[81,0,62,56,0],k11:[0,0,122,0,0],sg:[0,0,122,0,0],sd:[97,0,105,0,0],pa:[0,0,120,121,0],krs:[121,0,120,0,0],s90es:[0,0,127,0,0],motif:[0,0,127,0,0],cs6x:[0,0,127,0,0],trin:[0,0,61,0,0],an1x:[36,3,127,0,0],cs1x:[0,0,127,63,0],cs2x:[0,0,127,63,0]},jt=[9,25,41,57,73,89,105,121],ea=[0,3,81,84,88],ct={8:"Off",9:"On",10:"Note aftertouch",11:"cc",12:"pc",13:"Channel aftertouch",14:"Pitch"},Ee={0:0,1:1,2:3,5:4},dt={0:0,1:1,2:2,5:3},ft=[[0,24],[0,127],[0,127],[40,88],[0,127],[0,127]],Oe=[36,37,48,49,52,53],Ce=[20,21,22,23,24,25,26,28,29,30,31,36,37,48,49,52,53,64,65],ht={26:127,29:0,30:0,31:0,52:12,53:54},te=[0,1,2,4,5,6,7,8,10,11,12,13,14,15,16,17,18,19,20,21,22,26,28,32,38,40,41,42,43,44,45,46,47,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,80,81,82,83,84,91,92,93,94,95,98,99,100,101,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157],ta=[2,4,12,13,14,15,16,17,18,19,20,21,40,41,42,43,44,45,46,47,80,81,83,136,130,131,132,133,134,135,137,138,139,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157],aa=[33,102,99,32,100,8,9,10],ut=[0,16,25,40,32,64,24,48],ue="reverb,chorus,delay,insert0,insert1,insert2,insert3,insert4".split(","),F=[["VL",32,8,1],["SG",8,1,1],["DX",16,1,16],["AN",16,2,5],["PF",2,1,64],["DR",2,1,32],["PC",2,1,32],["AP",2,1,64]],v={};L.forEach((n,e)=>{v[n]=e});var x=[];te.forEach((n,e)=>{x[n]=e});var X={length:Ce.length};Ce.forEach((n,e)=>{X[n]=e});var ra={};Zt.forEach((n,e)=>{ra[n]=e});var ia=function(n){let e=[],t=0;return n?.forEach(function(i,l){i===247?e.push(n.subarray(t,l)):i===240&&(t=l+1)}),e.length||e.push(n.subarray(0)),T()&&console.debug(e),e};var Be=8,y={port:Be,ch:Be<<4,chShift:Math.ceil(Math.log2(Be))+4,cc:te.length,nn:128,pl:512,tr:256,cmt:14,rpn:6,rpnt:4,nrpn:Oe.length,ace:8,drm:8,dpn:Ce.length,dnc:128,ext:3,efx:8,cvn:12,redir:32,vxPrim:3,invalidCh:255};y.chcc=y.cc*y.ch;var K={bank0:255},sa=new TextDecoder("l9"),R=new Uint16Array(y.ch),re=new Uint16Array(y.ch),na=new Uint16Array(y.ch),ke=new Uint16Array(y.ch),la=new Uint16Array(y.ch),ie=new Uint16Array(y.ch),pt=new Array(y.drm);for(let n=0;n<y.ch;n++)R[n]=n*y.cc,re[n]=n*y.rpn,na[n]=n*y.nrpn,ke[n]=n*y.ace,la[n]=n*y.ext,ie[n]=n*y.cvn;for(let n=0;n<y.drm;n++){pt[n]=new Uint16Array(y.dpn);let e=n*y.dpn*y.dnc;for(let t=0;t<y.dpn;t++)pt[n][t]=e+t*y.dnc}if(typeof self?.require<"u")throw new Error("Environments supporting CommonJS is not supported.");var oa=class{#a;#h=!0;autoRealtime=!1;detach(){this.#a=void 0,this.#h=!0,this.autoRealtime=!1}attach(e,t){if(typeof e<"u"&&typeof e.currentTime=="number")this.#a=e,this.#h=!1,this.autoRealtime=!0;else throw new TypeError("Not a valid time source.")}timeMs(){return typeof performance?.now=="function"?performance.now():Object.hasOwn(self,"Temporal")?Temporal.Now.instant().epochMilliseconds:Date.now()}get realtime(){return this.#h||typeof this.#a>"u"}set realtime(e){if(e)this.#h=!0;else{if(typeof this.#a>"u")throw new TypeError("No attached time source is present.");this.#h=!1}}get currentTime(){return this.realtime||!this.#a?this.timeMs()*.001:this.#a.currentTime}now(){return this.realtime||!this.#a?Math.floor(this.timeMs()):Math.round(this.#a.currentTime*1e3)}constructor(e){e&&this.attach(e)}},gt=class extends me{NOTE_IDLE=0;NOTE_ATTACK=1;NOTE_DECAY=2;NOTE_SUSTAIN=3;NOTE_HELD=4;NOTE_RELEASE=5;NOTE_SOSTENUTO_ATTACK=8;NOTE_SOSTENUTO_DECAY=9;NOTE_SOSTENUTO_SUSTAIN=10;NOTE_SOSTENUTO_HELD=11;NOTE_MUTED_RECOVERABLE=16;CH_MELODIC=0;CH_DRUMS=1;CH_DRUM1=2;CH_DRUM2=3;CH_DRUM3=4;CH_DRUM4=5;CH_DRUM5=6;CH_DRUM6=7;CH_DRUM7=8;CH_DRUM8=9;DUMP_ALL=0;DUMP_ONCE=1;DUMP_MODE=2;EXT_NONE=0;EXT_VL=1;EXT_DX=3;VLBC_SYSTEM=0;VLBC_BRTHEXPR=1;VLBC_VELOINIT=2;VLBC_VELOALL=3;CH_INACTIVE=0;CH_ACTIVE=1;CH_DISABLED=2;KARAOKE_NONE=0;KARAOKE_TEXT=1;KARAOKE_XF=2;#a=0;#h=0;#C=0;#v=new Array(11);get#k(){return this.#v[this.#h]}set#k(e){this.#v[this.#h]=e}#x=16;get lcdContrast(){return this.#x}set lcdContrast(e){(e<0||e>=we.length)&&(e=we.length-1),this.#x=e,this.dispatchEvent("lcdcontrast",e)}#P=new Uint8Array(y.ch);#d=new Uint8Array(y.ch);#i=new Uint8Array(y.ch);#e=new Uint8Array(y.chcc<<1);#b=new Uint8Array(y.ch*y.ace);#n=new Uint8Array(y.ch*y.vxPrim);#g=new Uint8Array(y.ch*y.nn);#u=new Uint8Array(y.ch);#c=new Uint16Array(y.pl);#o=new Uint8Array(y.pl);#R=new Int16Array(y.ch);#T=new Uint8Array(y.ch);#$=new Uint8Array(y.ch);#y=new Uint8Array(y.ch*y.ext);#s=new Uint8Array(y.ch*y.rpn);#f=new Uint8Array(y.ch*y.rpnt);#J=new Int8Array(y.ch*Oe.length);#D=new Uint8Array(y.drm*y.dpn*y.dnc);#B=new Uint8Array(y.drm*2);#O=new Uint8Array(y.efx*3);#K=new Uint8Array(y.ch);#Z=new Uint8Array(y.ch*y.redir);#m=new Uint8Array(y.port);#w=new Uint8Array(y.port);#Y=new Uint8Array(y.ch);#N=new Uint8Array(y.ch);#X=new Uint8Array(y.ch*y.cvn);#H=new Uint8Array(y.ch);#S=new Uint8Array(128);#V=new Uint8Array(y.cmt*8);#t=new Uint8Array(1024);#L=new Uint8Array(y.cmt*64);#l={};clockSource=new oa;modelEx={xg:{map:0,varSys:!1,insPart:new Uint8Array(5)},yPlg:[],vl:{module:0,breath:1,voiceCh:y.invalidCh},sc:{showBar:!0,invBar:!1,invDisp:!1,peakHold:1},cs1x:{perfCh:0},kross:{chToggle:!1},sg:{convLastSyll:0,runLineLen:0,maxLineLen:32,splitMask:!1}};#r;get detect(){return structuredClone(this.#r)}#A;#te;#p=100;#j=0;#ae=500;#ue=0;#me=0;#ie=32;#be=!1;#q="";#G=0;#re=0;#pe=0;#W=!0;#E=0;#ye;#M=!1;#ge=0;#ne=new Array(y.ch);#F=[];#ee=new Uint8Array(y.ch);#se=new Uint8Array(y.tr);baseBank=new Re("gm2","ns5r","xg","gs","sd","gmega","plg-vl","plg-pf","plg-dx","plg-an","plg-dr","plg-sg","kross","s90es","cs2x","pa");userBank=new Re("gm2");initOnReset=!1;aiEfxName="";polyIndexShrink=!0;polyIndexLatest=0;polyIndexLast=0;lcdHideBankInfo=!1;chRedir(e,t,i){let l=this;if(l.#se[t])return(l.#se[t]-1)*16+e;if(l.#a===v.sc||l.#a===v.sd){if(i===1)return e;for(let m=0;m<y.ch;m++)if(l.#ee[m]===t)return m&112|e&15;let h=0,p=!0;for(;p;)l.#ee[e+h]===0?(l.#ee[e+h]=t,console.info(`Allocated track ${t} to channel ${e+h+1}.`),p=!1):this.#ee[e+h]===t?p=!1:(h+=16,h>=128&&(h=0,p=!1));return e+h}else return e}getTrackPort(e){return this.chRedir(0,e,!0)>>4}forceVoiceRefresh(){for(let e=0;e<y.ch;e++)this.#P[e]&&this.dispatchEvent("voice",{part:e})}#_=[];#le;#I={nOff:(e,t)=>{let i=e*128+t,l=this.#c.lastIndexOf(i);if(l>-1)if(this.getChCc(e,64)>>6)this.#o[l]=this.NOTE_HELD,this.dispatchEvent("note",{part:e,note:t,velo:this.#g[i],state:this.NOTE_HELD});else if(this.getChCc(e,66)>>6&&this.#o[l]===this.NOTE_SOSTENUTO_SUSTAIN)this.#o[l]=this.NOTE_SOSTENUTO_HELD,this.dispatchEvent("note",{part:e,note:t,velo:this.#g[i],state:this.NOTE_SOSTENUTO_HELD});else{this.#c[l]=0,this.#g[i]=0,this.#o[l]=this.NOTE_IDLE;let h=this.getExt(e)[1];(h===this.VLBC_VELOINIT||h===this.VLBC_VELOALL)&&this.setChCc(e,129,0),this.dispatchEvent("note",{part:e,note:t,velo:0,state:this.NOTE_IDLE})}if(this.#u[e]){for(let h=this.polyIndexLast;h>=0;h--)if(this.#c[h]>>7===e&&this.#o[h]!==0){this.#o[h]===this.NOTE_MUTED_RECOVERABLE&&(this.#o[h]=this.NOTE_SUSTAIN);break}}if(this.polyIndexShrink&&this.polyIndexLast>0){let p=!1,m=this.polyIndexLast-8,b=this.polyIndexLast;for(;b>m&&this.#o[b]===0;b--)p=!0;p&&(this.polyIndexLast=b,this.#o[b+1]!==0&&console.error("Polyphonic slot shrinking edge case."))}},nOn:(e,t,i)=>{let l=e*128+t,h=0;if(this.#u[e])for(let p=0;p<=this.polyIndexLast;p++)this.#c[p]>>7===e&&this.#o[p]!==0&&(this.#o[p]=this.NOTE_MUTED_RECOVERABLE);for(;this.#o[h]>0&&this.#c[h]!==l;)h++;if(h<y.pl){this.#c[h]=l,this.#g[l]=i,this.#o[h]=this.NOTE_SUSTAIN,this.#T[e]<i&&(this.#T[e]=i);let p=this.getExt(e)[1];(p===this.VLBC_VELOINIT||p===this.VLBC_VELOALL)&&this.setChCc(e,129,i),this.dispatchEvent("note",{part:e,note:t,velo:i,state:this.NOTE_SUSTAIN}),this.polyIndexLatest=h+1,h>this.polyIndexLast&&(this.polyIndexLast=h)}else console.error("Polyphony exceeded.")},nAt:(e,t,i)=>{},cAt:(e,t)=>{},hoOf:e=>{this.#o.forEach((t,i)=>{if(t===this.NOTE_HELD){let l=this.#c[i],h=l>>7;e===h&&(this.#o[i]=this.NOTE_IDLE,this.#c[i]=0,this.#g[l]=0,this.dispatchEvent("note",{part:e,note:l&127,velo:0,state:this.NOTE_IDLE}))}})},soOn:e=>{this.#o.forEach((t,i)=>{let l;switch(t){case this.NOTE_ATTACK:{l=this.NOTE_SOSTENUTO_ATTACK;break}case this.NOTE_DECAY:{l=this.NOTE_SOSTENUTO_DECAY;break}case this.NOTE_SUSTAIN:{l=this.NOTE_SOSTENUTO_SUSTAIN;break}}if(l){this.#o[i]=l;let h=this.#c[i];this.dispatchEvent("note",{part:e,note:h&127,velo:this.#g[h],state:l})}})},soOf:e=>{this.#o.forEach((t,i)=>{if(t===this.NOTE_SOSTENUTO_HELD){let l=this.#c[i],h=l>>7;e===h&&(this.#o[i]=this.NOTE_IDLE,this.#c[i]=0,this.#g[l]=0,this.dispatchEvent("note",{part:e,note:l&127,velo:0,state:this.NOTE_IDLE}))}})},ano:e=>{this.#c.forEach(t=>{let i=t>>7,l=t&127;t===0&&this.#g[0]===0||i===e&&this.#I.nOff(i,l)})}};#we={8:function(e){let t=e.channel,i=e.data[0];this.#I.nOff(t,i)},9:function(e){let t=e.channel,i=this;if(i.getChModeId(t)===v.xg&&i.#i[t]>1){let p=i.getChDrumFirstWrite(t);p[0]&&p[1]!==y.invalidCh&&!i.#P[t]&&(i.copyChSetup(p[1],t),i.pushChPrimitives(t),console.debug(`Part CH${t+1} copied from CH${p[1]+1}.`))}i.setChActive(t,1);let l=e.data[0],h=e.data[1];h>0?i.#I.nOn(t,l,h):i.#I.nOff(t,l)},10:function(e){let t=e.channel,i=t*128+e.data[0];this.#c.indexOf(i)>-1&&(this.#g[i]=data[1],this.getExt(t)[1]===this.VLBC_VELOALL&&this.setChCc(t,129,data[1]),this.dispatchEvent("note",{part:t,note:e.data[0],velo:e.data[1],state:this.NOTE_SUSTAIN}))},11:function(e){let t=e.channel,i=this,l=i.#ne[t],h=l[e.data[0]];h&&(e.data[0]=h),[0,32].indexOf(e.data[0])>-1&&(()=>{switch(this.#a){case v.s90es:case v.motif:{if(e.data[0]===0){[0,63].indexOf(e.data[1])>-1&&i.setChActive(t,1);break}e.data[1]&&i.setChActive(t,1);break}default:break}})();let p=t*y.ext,m=i.getChModeId(t);switch(e.data[0]){case 96:return;case 97:return;case 120:return;case 121:{this.#I.ano(t),this.#R[t]=0,i.resetChCc(t,1,0),i.resetChCc(t,5,0),i.resetChCc(t,64,0),i.resetChCc(t,65,0),i.resetChCc(t,66,0),i.resetChCc(t,67,0),i.resetChCc(t,11,127),i.resetChCc(t,101,127),i.resetChCc(t,100,127),i.resetChCc(t,99,127),i.resetChCc(t,98,127);return}case 123:{this.#I.ano(t);return}case 124:{this.#I.ano(t);return}case 125:{this.#I.ano(t);return}case 126:{this.#u[t]=1,this.#I.ano(t);return}case 127:{this.#u[t]=0,this.#I.ano(t);return}}if(x[e.data[0]]===void 0)console.warn(`cc${e.data[0]} is not accepted.`);else{switch(ta.indexOf(e.data[0])>-1&&this.allocateAce(t,e.data[0]),e.data[0]){case 0:{switch(T()&&console.debug(`${L[i.#a]}, CH${t+1}: ${e.data[1]}`),this.#a===0?e.data[1]<48?(i.#i[t]>0&&(e.data[1]=i.getChPrimitive(t,1,!1),e.data[1]=he.gs[2],console.debug(`Forced channel ${t+1} to stay drums.`)),e.data[1]>0&&(console.debug(`Roland GS detected with MSB: ${e.data[1]}`),i.switchMode("gs",0))):e.data[1]===56?i.switchMode(i.#r.x5===82?"x5d":"05rw",0):e.data[1]===62?i.switchMode(i.#r.x5===82?"x5d":"05rw",0):e.data[1]===63?i.switchMode(L[i.#r.ds],0):e.data[1]===64||e.data[1]===127?i.switchMode("xg",0):(e.data[1]===120||e.data[1]===121)&&i.switchMode("g2",0):i.#a===v.gs||i.#a===v.sc?e.data[1]<56&&this.#i[t]>0&&(e.data[1]=this.getChPrimitive(t,1,!1),e.data[1]=he.gs[2],console.debug(`Forced channel ${t+1} to stay drums.`)):this.#a===v.gm&&(e.data[1]<48?this.#i[t]>0&&(e.data[1]=he.gs[2],this.switchMode("gs",1),console.debug(`Forced channel ${t+1} to stay drums.`)):(e.data[1]===64||e.data[1]===127)&&this.switchMode("xg",1)),this.#a){case v.xg:{[79,95,120,126,127].indexOf(e.data[1])>-1?this.#i[t]===0&&(this.setChType(t,this.CH_DRUM2),console.debug(`CH${t+1} set to drums by MSB.`)):this.#i[t]>0&&(this.setChType(t,this.CH_MELODIC),console.debug(`CH${t+1} set to melodic by MSB.`)),[33,81,97].indexOf(e.data[1])>-1?this.#y[p]=this.EXT_VL:[35,67,83,99].indexOf(e.data[1])>-1?this.#y[p]=this.EXT_DX:this.#y[p]=this.EXT_NONE;break}case v["05rw"]:case v.x5d:case v.ns5r:{[61,62,126,127].indexOf(e.data[1])>-1?this.#i[t]===this.CH_MELODIC&&(this.setChType(t,this.CH_DRUM2),console.debug(`CH${t+1} set to drums by MSB.`)):this.#i[t]!==this.CH_MELODIC&&(this.setChType(t,this.CH_MELODIC),console.debug(`CH${t+1} set to melodic by MSB.`));break}case v.sd:{[104,105,106,107,120].indexOf(e.data[1])>-1?this.#i[t]===0&&(this.setChType(t,this.CH_DRUM2),console.debug(`CH${t+1} set to drums by MSB.`)):this.#i[t]>0&&(this.setChType(t,this.CH_MELODIC),console.debug(`CH${t+1} set to melodic by MSB.`));break}case v.g2:{e.data[1]===120?this.#i[t]===0&&(this.setChType(t,this.CH_DRUMS),console.debug(`CH${t+1} set to drums by MSB.`)):this.#i[t]>0&&(this.setChType(t,this.CH_MELODIC),console.debug(`CH${t+1} set to melodic by MSB.`));break}}break}case 2:{this.getExt(t)[1]===this.VLBC_BRTHEXPR&&this.setChCc(t,129,e.data[1]);break}case 6:{if(this.#$[t]){[v.xg,v.gs,v.sc,v.ns5r].indexOf(this.#a)<0&&console.warn(`NRPN commits are not available under "${L[this.#a]}" mode, even when they are supported in Octavia.`);let b=this.getChCc(t,99),E=this.getChCc(t,98);if(b===1){let C=aa.indexOf(E);if(C>-1)this.setChCc(t,71+C,e.data[1]),T()&&console.debug(`Redirected NRPN 1 ${E} to cc${71+C}.`),this.dispatchEvent("cc",{part:t,cc:71+C,data:e.data[1]});else{let a=Oe.indexOf(E);a>-1?this.#J[t*10+a]=e.data[1]-64:console.warn(`NRPN 0x01${E.toString(16).padStart(2,"0")} is not supported.`),T()&&console.debug(`CH${t+1} voice NRPN ${E} commit`)}}else{if(Ce.indexOf(b)<0){let a=`NRPN 0x${b.toString(16).padStart(2,"0")}${E.toString(16).padStart(2,"0")} `;console.warn(b===127?`${a}is not necessary. Consider removing it.`:`${a}is not supported.`)}else{let a=this.#i[t]-2;a<0?console.warn(`CH${t+1} cannot accept drum NRPN as type ${ce[this.#i[t]]}.`):this.#D[(a*y.dpn+X[b])*y.dnc+E]=e.data[1]}T()&&console.debug(`CH${t+1} (${ce[this.#i[t]]}) drum NRPN ${b} commit`)}}else{let b=Ee[this.getChCc(t,100)],E=dt[this.getChCc(t,100)];if(this.getChCc(t,101)===0&&b!==void 0)switch(T()&&console.debug(`CH${t+1} RPN 0 ${this.getChCc(t,100)} commit: ${e.data[1]}`),e.data[1]=Math.min(Math.max(e.data[1],ft[b][0]),ft[b][1]),this.#s[t*y.rpn+b]=e.data[1],this.#f[t*y.rpnt+E]=1,m){case v.xg:case v.gs:case v.sc:case v.mt32:case v.s90es:case v.motif:case v.cs1x:case v.cs6x:{switch(this.getChCc(t,100)){case 1:case 2:{this.dispatchEvent("pitch",{part:t,pitch:this.getPitchShift(t)});break}}break}default:this.dispatchEvent("pitch",{part:t,pitch:this.getPitchShift(t)})}}break}case 32:{switch(T()&&console.debug(`${L[this.#a]}, CH${t+1} LSB: ${e.data[1]}`),this.#a){case v.s90es:case v.motif:{this.setChType(t,[32,40].indexOf(e.data[1])>-1?this.CH_DRUMS:this.CH_MELODIC,this.#a,!0);break}}this.getExt(t)[0],this.EXT_DX;break}case 38:{if(!this.#$[t]){let b=Ee[this.getChCc(t,100)],E=dt[this.getChCc(t,100)];this.getChCc(t,101)===0&&b!==void 0&&(this.#s[t*y.rpn+b+1]=e.data[1],this.#f[t*y.rpnt+E]=1)}break}case 64:{e.data[1]<64&&this.#I.hoOf(t);break}case 66:{e.data[1]>>6?this.#I.soOn(t):this.#I.soOf(t);break}case 98:case 99:{this.#$[t]=1;break}case 100:case 101:{this.#$[t]=0;break}}this.setChCc(t,e.data[0],e.data[1]),this.dispatchEvent("cc",{part:t,cc:e.data[0],data:e.data[1]})}i.getChModeId(t)===v.xg&&i.#i[t]&&i.setDrumFirstWrite(t)},12:function(e){let t=e.channel,i=this;switch(i.#a){case v.s90es:case v.motif:{e.data&&i.setChActive(t,1);break}default:i.setChActive(t,1)}let l=R[t];switch(i.getExt(t)[0]){case i.EXT_VL:break}i.#n[t]=e.data,i.#N[t]=0,i.pushChPrimitives(t),T()&&console.debug(`T:${e.track} C:${t} P:${e.data}`),i.getChModeId(t)===v.xg&&i.#i[t]&&i.setDrumFirstWrite(t)},13:function(e){let t=this,i=e.channel;this.#c.forEach(function(l){let h=l>>7;i===h&&(t.#g[l]=e.data,t.dispatchEvent("note",{part:i,note:l&127,velo:e.data,state:t.NOTE_SUSTAIN}))})},14:function(e){let t=e.channel;this.#R[t]=e.data[1]*128+e.data[0]-8192,this.dispatchEvent("pitch",{part:t,pitch:this.getPitchShift(t)})},15:function(e){ia(e.data).forEach(t=>{let i=t[0],l=t[1];this.#ge=t.length,(this.#Ee[i]||function(){console.debug(`Unknown manufacturer ${i}.`)})(l,t.subarray(2),e.track)})},248:function(e){},250:function(e){},251:function(e){},252:function(e){},254:function(e){},255:function(e){(this.#_[e.meta]||function(i,l,h){}).call(this,e.data,e.track,e.meta),e.meta!==32&&(this.#j=0);let t=ea.indexOf(e.meta)>-1;if(T()&&console.debug(e),t)return e.reply="meta",e}};#Ee={64:(e,t,i)=>{this.#de.run(t,i,e)},65:(e,t,i)=>{if(t[0]<16)if(t[1]===72){let l=t[t.length-1],h=ee(t.subarray(3,t.length-1));l===h?this.#z.run(t.subarray(0,t.length-1),i,e):console.warn(`Bad SD checksum ${l} - should be ${h}.`)}else this.#z.run(t,i,e);else{let l=t[t.length-1],h=ee(t.subarray(2,t.length-1));l===h?this.#z.run(t.subarray(0,t.length-1),i,e):console.warn(`Bad GS checksum ${l} - should be ${h}.`)}},66:(e,t,i)=>{this.#Q.run(t,i,e)},67:(e,t,i)=>{switch(e>>4){case 0:{let l=0;for(;t[l]===127&&l<4;)l++;let h=t[1+l]<<7|t[2+l];if(h+7+l!==t.length){console.warn(`Yamaha bulk dump length mismatch! Expected ${t.length-7-l}, received ${h}.`),console.debug(t);break}let p=ee(t.subarray(1+l,t.length-1)),m=t[t.length-1];if(t[t.length-1]>>7)console.warn(`Yamaha bulk dump checksum invalid! Expected ${p}, received ${m}:
`),console.debug(t);else if(p!==m)console.warn(`Yamaha bulk dump checksum mismatch! Expected ${p}, received ${m}:
`),console.debug(t);else{let b=t.slice(2,t.length-1);for(let E=0;E<=l;E++)b[E]=t[E];this.#U.run(b,i,e&15)}break}case 1:{this.#U.run(t,i,e&15);break}case 2:{console.warn("Octavia doesn't yet support Yamaha bulk dump requests.");break}case 3:{console.warn("Octavia doesn't yet support Yamaha parameter requests.");break}case 7:{switch(e&15){case 14:{let l=new Uint8Array(t.length+1);l[0]=126,l.set(t,1),this.#U.run(l,i,0);break}default:console.warn(`Unknown Yamaha special SysEx type: ${e}.`)}break}default:console.warn(`Unknown Yamaha SysEx type: ${e>>4}.`)}},68:(e,t,i)=>{this.#he.run(t,i,e)},71:(e,t,i)=>{this.#fe.run(t,i,e)},126:(e,t,i)=>{this.#oe.run(t,i,e)},127:(e,t,i)=>{this.switchMode("gm",0),this.#ce.run(t,i,e)}};#oe;#ce;#U;#z;#Q;#de;#fe;#he;buildRchTree(){let e=[];this.#d.forEach((t,i)=>{t<y.ch&&(e[t]?.constructor||(e[t]=[]),e[t].push(i))}),this.#ye=e}buildRccMap(){let e=this;for(let t=0;t<y.ch;t++)e.#ne[t]={};e.#Z.forEach((t,i)=>{t&&(e.#ne[Math.floor(i/y.redir)][t]=i%y.redir|128)}),T()&&console.debug(e.#ne)}invokeSysExIndicator(){this.dispatchEvent("mupromptex",this.#ge)}getActive(){return this.#P}getChActive(e){return this.#P[e]}getCc(e){if(typeof e!="number"||e<0||e>=y.ch)throw new RangeError(`Invalid part number: CH${e+1}`);let t=this,i=R[e];return t.#e.subarray(i,i+y.cc)}getChCc(e,t){let i=this;if(te.indexOf(t)<0)throw new Error("CC number not accepted");return i.#e[R[e]+x[t]]}getChCcWritten(e,t){let i=this;if(te.indexOf(t)<0)throw new Error("CC number not accepted");return i.#e[y.chcc+R[e]+x[t]]}setChCc(e=0,t,i){let l=this;if(te.indexOf(t)<0)throw new Error("CC number not accepted");if(i?.constructor!==Number)throw new TypeError("Expected numbers for value");let h=i&255,p=R[e]+x[t];l.#e[p]=h,l.#e[p+y.chcc]=1,l.dispatchEvent("cc",{part:e,cc:t,data:h})}getCcAll(){return this.#e.slice()}resetCc(e){let t=this,i=R[e]+y.chcc;t.#e.fill(0,i,i+y.cc)}resetChCc(e,t,i){let l=this;i?.constructor&&l.setChCc(e,t,i),l.#e[R[e]+x[t]+y.chcc]=0}resetCcAll(){this.#e.fill(0,y.chcc,y.chcc<<1)}isChCcWritten(e,t){if(te.indexOf(t)<0)throw new Error("CC number not accepted");return upThis.#e[R[e]+x[t]+y.chcc]}getChSource(){return this.#d}getChType(e=0){return this.#i[e]}getChTypes(){return this.#i}setChType(e,t,i=0,l=!1){t&=15;let h=this;i=i||h.getChModeId(e),h.#i[e]=t,t>0&&!l&&(h.setChCc(e,0,h.#l[i][2]),h.pushChPrimitives(e))}setChActive(e,t=0){this.#P[e]!==t&&this.dispatchEvent("channeltoggle",{part:e,active:t}),this.#P[e]=t}getExt(e){let t=y.ext*e,i=this.#y.subarray(t,t+y.ext),l=new Uint8Array(i.length);switch(l.set(i),l[0]){case this.EXT_VL:{l[1]=l[1]||this.modelEx.vl.breath;break}}return l}getProgram(){return this.#n}getTexts(){return this.#F.slice()}getVel(e){let t=new Map,i=this;return i.#c.forEach(function(l,h){let p=l>>7,m=l&127;e===p&&i.#g[l]>0&&t.set(m,{v:i.#g[l],s:i.#o[h]})}),t}getBitmap(){return{bitmap:this.#k,expire:this.#C}}getLetter(){return{text:this.#q,set:this.#re,expire:this.#G}}getMode(){return L[this.#a]}getMaster(){return{volume:this.#p}}getRpn(){return this.#s}getNrpn(){return this.#J}getSubDb(){return self?.structuredClone(this.#l)}getDetect(){return self?.structuredClone(this.#r)}getVoice(e,t,i,l="?",h=0){let p=this;v[l]?.constructor||(l="?");let m=v[l],b=e||p.#l[m][0],E=t,C=i||p.#l[m][1];b===K.bank0&&(b=0),C===K.bank0&&(C=0),l==="ns5r"&&b>0&&b<56&&(C=3);let a=p.userBank.get(b,E,C,l,h);if(l==="mt32"&&a.name.indexOf("MT-m:")===0){let s=parseInt(a.name.slice(5)),c=s*y.cmt,r="";p.#L.subarray(c,c+10).forEach(o=>{o>31&&(r+=String.fromCharCode(o))});let d=`MSB	LSB	PRG	NME
49	127	${E}	${r}`;p.userBank.load(d,!0),a.name=r,a.ending=" "}return(a.ending!==" "||!a.name.length)&&(a=p.baseBank.get(b,E,C,l,h)),a}getChPrimitive(e,t,i){if(t>=y.vxPrim||t?.constructor!==Number)throw new RangeError(`Invalid voice primitive component "${t}"`);if(typeof e!="number"||e<0||e>=y.ch)throw new RangeError(`Invalid part number: CH${e+1}`);let l=this,h=l.#n[t<<y.chShift|e];switch(t){case 1:case 2:{l.getChCcWritten(e,[255,0,32][t])||(h=h||l.#l[l.getChModeId(e)][t+2]),i&&(h=h||l.#l[l.getChModeId(e)][t-1]),h===K.bank0&&(h=0);break}}return h}getChPrimitives(e,t){let i=this,l=new Uint8Array(3);return l[1]=i.#n[e],l[0]=i.getChPrimitive(e,1,t),l[2]=i.getChPrimitive(e,2,t),l}pushChPrimitives(e){let t=this;t.#n[1<<y.chShift|e]=t.getChCc(e,0),t.#n[2<<y.chShift|e]=t.getChCc(e,32),t.dispatchEvent("voice",{part:e})}getChCvnBuffer(e,t=y.cvn){if(t>y.cvn||t<1)throw new RangeError("Invalid custom voice name buffer length");let i=ie[e];return this.#X.subarray(i,i+t)}getChCvnRegister(e,t){if(t>=y.cvn||t<0)throw new RangeError("Invalid custom voice name register");return this.#X[ie[e]+t]}setChCvnRegister(e,t,i=32){if(t>=y.cvn||t<0)throw new RangeError("Invalid custom voice name register");this.#H[e]=1,this.#X[ie[e]+t]=Math.max(32,i&255)}resetChCvn(e){this.#X.fill(32,ie[e],ie[e]+y.cvn),this.#H[e]=0}getChCvnString(e,t){let i=sa.decode(this.getChCvnBuffer(e));return t||(i=i.trimEnd()),i}getChCvnIsWritten(e){return this.#H[e]}getChVoice(e){let t=this,i=t.getVoice(...t.getChPrimitives(e),t.getChMode(e),t.modelEx[t.getChMode(e)]?.map??0);if(t.#N[e]){let l="";switch(t.#a){case v.mt32:{t.#V.subarray(y.cmt*(e-1),y.cmt*(e-1)+10).forEach(h=>{l+=String.fromCharCode(Math.max(h,32))}),l=l.trimEnd();break}default:l=t.getChCvnString(e)}l.length&&(i.ending="~",i.name=l)}return i}getRawPitch(){return this.#R}getPitchShift(e){let t=this,i=e*y.rpn,l=t.#s[i];return t.#f[e*y.rpnt]?l>>7&&(l-=256):t.#a===v.mt32&&(l=12),t.#R[e]/8192*l+(t.#s[i+3]-64)+((t.#s[i+1]<<7)+t.#s[i+2]-8192)/8192}getEffectType(e=0){let t=3*e+1;return this.#O.subarray(t,t+2)}getPolyState(e=0){return this.#o[e]}setEffectTypeRaw(e=0,t,i){let l=3*e;this.#O[l]=1,this.#O[l+1+ +t]=i}setEffectType(e=0,t,i){this.setEffectTypeRaw(e,!1,t),this.setEffectTypeRaw(e,!0,i)}pushEffectType(e=0,t=!1){if(e<0||e>=y.efx)throw new RangeError(`Invalid EFX slot ${e}`);let i=this.getEffectType(e);t||i[0]===0&&i[1]>>4===15&&(t=!0),this.dispatchEvent(`efx${ue[e]}`,{id:i,hidden:t})}getEffectSink(){return this.#K}getChEffectSink(e){return this.#K[e]}setChEffectSink(e,t=0){let i=this;if(t<0||t>=y.efx)throw new RangeError(`Invalid EFX slot ${t}`);if(e<0||e>=y.ch)throw new RangeError(`Invalid CH${e+1}`);this.#K[e]=t,this.dispatchEvent("partefxtoggle",{part:e,active:t})}setXgChEffectSink(e,t=0){let i=this,l=i.modelEx.xg,h=t-2;if(t<0||h>=l.insPart.length)throw new RangeError(`Invalid XG insertion slot ${h}`);let p=l.insPart[h];l.insPart[h]=e,p!==y.invalidCh&&i.setChEffectSink(p,0),e===y.invalidCh?p!==y.invalidCh&&i.setChEffectSink(p,0):i.setChEffectSink(e,t)}setLetterDisplay(e,t,i=0,l=3200){let h=this,p;h.#q=" ".repeat(i),e.forEach(m=>{h.#q+=String.fromCharCode(m>31?m:32),m<32&&(p=p||new Set,p.add(m))}),h.#re=h.clockSource.now(),h.#G=h.clockSource.now()+l,h.dispatchEvent("letter"),p&&(p=Array.from(p),p.forEach((m,b,E)=>{E[b]=m.toString(16).padStart(2,"0")}),console.warn(`${t}${t?" ":""}invalid code point${p.length>1?"s":""}: 0x${p.join(", 0x")}`))}setDetectionTargets(e="?",t=0){let i=this,l=-1;switch(e.replaceAll(", ",",").split(",").forEach(h=>{h=h.toLowerCase();let p=L.indexOf(Jt[h]||h);T()&&console.debug(`Mapped mode "${h}" to ID "${p}".`),p>-1&&(l=p)}),T()&&console.debug(`Set detection target to ID "${l}".`),l>0&&(i.#r.x5=82,i.#r.ds=v.krs,i.#r.gm=v.gm,i.#r.g2=v.g2),l){case v["05rw"]:{i.#r.x5=81;break}case v.s90es:{i.#r.ds=v.s90es,i.#r.smotif=v.s90es;break}case v.motif:{i.#r.ds=v.motif,i.#r.smotif=v.motif;break}case v.sd:{i.#r.g2=v.sd;break}case v.pa:{i.#r.g2=v.pa;break}}}setGsTargets(e=!1,t=4){if(!t)t=e?3:4;else{if(t>4||t<0)throw new Error(`Invalid GS level ${t}`);if(e&&t>>1!==1)throw new Error(`Invalid SC level ${t}`)}let i=this;i.#r[e?"sc":"gs"]=t,i.#l[v[e?"sc":"gs"]][1]=t,i.forceVoiceRefresh()}getConfigs(){return this.#te}setDumpLimit(e){if(e>2||e<0)throw new RangeError("Invalid dump limit.");this.#A.dumpLimit=e}allocateAce(e=0,t){let i=this;if(!t||t<128&&t>95){console.warn(`cc${t} cannot be allocated as an active custom effect.`);return}let l=!0,h=0,p=y.ace*e;for(;l&&h<y.ace;)i.#b[h+p]===t?l=!1:i.#b[h+p]||(l=!1,i.#b[h+p]=t,console.debug(`Allocated cc${t} to ACE slot ${h} in CH${e+1}.`)),h++;h>=y.ace&&console.warn(`ACE slots are full in CH${e+1}.`)}allocateAceAll(e){let t=this;if(!e||e<128&&e>95){console.warn(`cc${e} cannot be allocated as an active custom effect.`);return}for(let i=0;i<y.ch;i++){let l=!0,h=0,p=y.ace*i;for(;l&&h<y.ace;)t.#b[h+p]===e?l=!1:t.#b[h+p]||(l=!1,t.#b[h+p]=e),h++;h>=y.ace&&console.warn(`ACE slots are full in CH${i+1}.`)}}resetAce(){this.#b.fill(0),console.info("All ACE slots have been reset.")}resetChAceAll(e=0){this.#b.subarray(ke[e],ke[e]+y.ace).fill(0)}resetChAce(e=0,t){let i=!0,l=ke[e],h=l+y.ace;for(;i&&l<h;)this.#b[l]===t&&(this.#b[l]=0,i=!1),l++;i&&T()&&console.debug(`No ACE slot was allocated to cc${t} in CH${e+1}.`)}getAce(){return this.#b}getChAce(e=0,t=0){if(t<0||t>=y.ace)throw new RangeError("No such ACE slot");let i=this.#b[y.ace*e+t];if(i){if(te.indexOf(i)>=0)return this.getChCc(e,i);throw new Error(`Invalid ACE source in CH${e+1}: ${i}`)}else return 0}initDrums(){let e=this;e.#D.fill(64);for(let t=0;t<y.drm;t++){let i=t*y.dpn;for(let l in ht){let h=ht[l],p=(i+X[l])*y.dnc;e.#D.subarray(p,p+y.dnc).fill(h)}}}init(e=0){let t=this;t.#j=0,t.#l[v.xg][1]=0,t.modelEx.xg.map=0,t.dispatchEvent("banklevel",{mode:"xg",data:t.modelEx.xg.map}),t.#P.fill(0),t.#e.fill(0),t.#b.fill(0),t.#n.fill(0),t.#g.fill(0),t.#c.fill(0),t.#o.fill(0),t.#u.fill(0),t.#T.fill(0),t.#R.fill(0),t.#J.fill(0),t.#f.fill(0),t.#y.fill(0),t.#m.fill(0),t.#w.fill(0),t.#Y.fill(0),t.#Z.fill(0),t.#p=100,t.#F=[],t.#ae=500,t.modelEx.sg.convLastSyll=0,t.modelEx.sg.runLineLen=0,t.modelEx.sg.splitMask=!1,t.#C=0,t.#h=0,t.lcdContrast=16,t.lcdHideBankInfo=!1;for(let i=0;i<t.#v.length;i++)t.#k.fill(0);t.#E=t.KARAOKE_NONE,t.#pe=0,t.#W=!0,t.#M=!1,t.#ge=0,t.initDrums(),t.polyIndexLatest=0,t.polyIndexLast=0,t.#d.forEach(function(i,l,h){h[l]=l}),e===0&&(t.dispatchEvent("mode","?"),t.#a=0,t.#ee.fill(0),t.#se.fill(0),t.#G=0,t.#q=""),jt.forEach(i=>{t.setChCc(i,0,t.#l[t.getChModeId(i)][2])}),t.#i.fill(t.CH_MELODIC),t.#i[9]=t.CH_DRUM1,t.#i[25]=t.CH_DRUM3,t.#i[41]=t.CH_DRUMS,t.#i[57]=t.CH_DRUMS,t.#i[73]=t.CH_DRUM5,t.#i[89]=t.CH_DRUM7,t.#i[105]=t.CH_DRUMS,t.#i[121]=t.CH_DRUMS;for(let i=0;i<y.drm;i++)t.#B[i<<1]=0,t.#B[i<<1|1]=y.invalidCh;t.#t.fill(0),t.#L.fill(0),t.#S.fill(0),t.#V.fill(0),t.#N.fill(0),t.#O.fill(0),t.#K.fill(0),t.aiEfxName="",t.userBank.clearRange({msb:0,lsb:127,prg:[0,127]}),t.modelEx.xg.varSys=!1,t.modelEx.xg.insPart.fill(y.invalidCh);for(let i=0;i<F.length;i++){let l=t.modelEx.yPlg[i];l.fill(0,0,F[i][2]),l.fill(y.invalidCh,F[i][2])}t.modelEx.sc.showBar=!0,t.modelEx.sc.invBar=!1,t.modelEx.sc.invDisp=!1,t.modelEx.sc.peakHold=1,t.modelEx.cs1x.perfCh=0;for(let i=0;i<y.ch;i++){t.resetChCvn(i);let l=R[i];t.#e[l+x[7]]=100,t.#e[l+x[11]]=127,t.#e[l+x[2]]=127,t.#e[l+x[10]]=64,t.#e.subarray(l+x[71],l+x[71]+8).fill(64),t.#e[l+x[128]]=127,t.#e.subarray(l+x[130],l+x[157]+1).fill(64),t.#e[l+x[91]]=40,t.#e[l+x[101]]=127,t.#e[l+x[100]]=127,t.#e[l+x[99]]=127,t.#e[l+x[98]]=127;let h=i*y.rpn;t.#s[h]=2,t.#s[h+1]=64,t.#s[h+2]=0,t.#s[h+3]=64,t.#s[h+4]=0,t.#s[h+5]=0;let p=i*y.ext;t.#y[p+1]=t.VLBC_BRTHEXPR;let m=i*y.redir;t.#Z[m+8]=13}t.switchMode("?",3),t.buildRchTree(),t.buildRccMap(),t.dispatchEvent("mastervolume",t.#p);for(let i=0;i<ue.length;i++)t.pushEffectType(i);t.dispatchEvent("reset")}setChMode(e,t){let i=this;if(typeof e!="number"||e<0||e>=y.ch)throw new RangeError(`Invalid part number: CH${e+1}`);if(e<0||t>=L.length)throw new RangeError(`Invalid mode ID ${t}`);i.#Y[e]=t,i.dispatchEvent("chmode",{part:e,id:t,mode:L[t]}),i.pushChPrimitives(e)}getChMode(e,t){return L[this.getChModeId(e,t)]}getChModeId(e,t){return t?this.#Y[e]||this.#m[e>>4]:this.#Y[e]||this.#m[e>>4]||this.#a}getPortMode(e,t){return L[this.getPortModeId(e,t)]}getPortModeId(e,t){return t?this.#m[e]:this.#m[e]||this.#a}setPortMode(e,t,i){let l=this;if(e<0||e>=y.ch>>4)throw new RangeError(`Invalid port ${e+1}`);if(t<1)throw new RangeError("Range must be a positive integer");if(e+t>=y.ch>>4)throw new RangeError("Range must be in bound");if(e<0||i>=L.length)throw new RangeError(`Invalid mode ID ${i}`);l.#w[e]=i;for(let h=e;h<e+t;h++){let p=l.#w[h];if(t>1&&p!==0&&p!==i)break;l.#m[h]=i;for(let m=h<<4;m<h+1<<4;m++)l.dispatchEvent("chmode",{part:m,id:i,mode:L[i]}),l.pushChPrimitives(m)}}copyChSetup(e,t,i){if(e===t){console.warn(`Failed attempt at overwriting CH${e+1} with its own data.`);return}let l=this;if(i&&l.#P[t]){console.warn(`Failed attempt at copying setup data from CH${e+1} to CH${t+1}.`);return}let h=R[e],p=R[t];l.#n[t]=l.#n[e],l.#e.set(l.#e.subarray(h,h+y.cc),p),l.pushChPrimitives(t)}setDrumFirstWrite(e,t){let i=this,l=i.#i[e];if(l<2)return;let h=l-2;if(i.#B[h<<1])if(t)i.#B[h<<1]=0,T()&&console.debug(`First write part for drum set ${h+1} has been reset.`);else return;else t?console.warn(`First write part for drum set ${h+1} is already blank.`):(i.#B[h<<1]=1,i.#B[h<<1|1]=e,console.debug(`First write part for drum set ${h+1} is set to CH${e+1}.`))}getChDrumFirstWrite(e){let t=this,i=t.#i[e];if(i<2)return;let l=i-2;return t.#B.subarray(l<<1,l+1<<1)}getDrumFirstWrite(e){if(e>=0&&e<y.drm)return this.#B.subarray(e<<1,e+1<<1)}switchMode(e,t=0,i=!1){T()&&console.debug(`Requested level ${t} mode change to "${e}".`);let l=this,h=v[e];if(h>-1){if(l.#a===0&&t!==3||t){if(l.initOnReset)switch(t){case 1:{l.#a===0&&l.init(1);break}case 2:{l.init(1);break}}switch(l.#h=0,h){case v.gm:{h=l.#r.gm;break}case v.g2:{h=l.#r.g2;break}}switch(l.#a=h,h){case v.gs:case v.sc:{l.#l[v[e]][1]=l.#r[e];break}}for(let b=0;b<y.ch;b++){let E=l.getChModeId(b,!0);l.#i[b]>0&&E===v["?"]&&(l.setChCc(b,0,l.#l[h][2]),T()&&console.debug(`CH${b+1} (${l.#i[b]}) (${l.getChMode(b)}), ${L[E]} (${l.#l[E][2]}) -> ${L[h]} (${l.#l[h][2]})`),l.pushChPrimitives(b))}switch(h){case v.mt32:{De.forEach((b,E)=>{let C=E+1;l.#P[C]||(l.#n[C]=b,l.setChCc(C,91,127),l.pushChPrimitives(C))});for(let b=1;b<10;b++)l.pushChPrimitives(b);break}}let p,m;switch(h){case v["?"]:case v.g2:{p=[52,4,52,18,0,255,0,255,0,255,0,255,0,255,0,255];break}case v.xg:case v.cs1x:{p=[1,0,65,0,5,0,64,0,64,0,64,0,64,0,0,255],m=[64,0];break}case v.gm:case v.gs:case v.sc:{p=[40,4,40,18,40,32,32,0,0,255,0,255,0,255,0,255],m=[32,0];break}case v.sd:{p=[58,0,60,0,61,0,61,0],m=[61,0];break}case v["05rw"]:case v.x5d:case v.ns5r:{p=[44,1,44,19,0,255,0,255,0,255,0,255,0,255,0,255];break}case v.k11:case v.sg:{p=[24,0,0,255,0,255,0,255,0,255,0,255,0,255,0,255];break}case v.mt32:{p=[40,4,0,255,0,255,0,255,0,255,0,255,0,255,0,255];break}case v.doc:{p=[24,16,0,255,0,255,0,255,0,255,0,255,0,255,0,255];break}case v.motif:case v.s90es:case v.cs6x:{p=[129,0,133,0,130,0,128,0,128,0,0,255,0,255,0,255],m=[128,0];break}case v.pa:{p=[28,52,28,16,28,0,28,0,0,255,0,255,0,255,0,255],m=[28,0];break}case v.krs:{p=[45,0,45,0,0,255,45,0,45,0,45,0,45,0,45,0],m=[45,0];break}default:p=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}for(let b=0;b<y.efx;b++)if(!l.#O[3*b]&&typeof p[b<<1]=="number"){l.#O[3*b+1]=p[b<<1],l.#O[3*b+2]=p[b<<1|1];let E=!1;m?.length>0&&p[b<<1]===m[0]&&p[b<<1|1]===m[1]&&(E=!0),l.pushEffectType(b,E)}i&&l.setDetectionTargets(e),l.dispatchEvent("mode",L[h]),l.forceVoiceRefresh()}}else throw new Error(`Unknown mode ${e}`)}getRawStrength(){let e=this;return this.#c.forEach(function(t){let i=t>>7;e.#g[t]>e.#T[i]&&(e.#T[i]=e.#g[t])}),this.#T}getStrength(){let e=[],t=this;return this.getRawStrength().forEach(function(i,l){e[l]=Math.floor(i*t.getChCc(l,7)*t.getChCc(l,11)*t.#p/803288)}),e}newStrength(){this.#T.fill(0)}runJson(e){if(e==null){console.warn(new Error("Invalid JSON data provided."));return}if(e.type>14)return e.type===15&&e.data.constructor!==Uint8Array&&(e.data=Uint8Array.from(e.data)),this.#we[e.type].call(this,e);{let t=this.chRedir(e.part,e.track),i=!1;this.#ye[t]?.forEach(l=>{e.channel=l,i=!0,this.#we[e.type].call(this,e)}),i||console.warn(`${ct[e.type]?ct[e.type]:e.type}${[11,12].includes(e.type)?(e.data[0]!==void 0?e.data[0]:e.data).toString():""} event sent to CH${t+1} without any recipient.`)}this.#F.length>100&&this.#F.splice(100,this.#F.length-99)}runRaw(e){}async loadBank(e,t){let i=this;switch(e=e.toLowerCase(),e){case"s7e":{i.userBank.clearRange({msb:63,lsb:[21,22]}),i.userBank.clearRange({msb:63,lsb:[24,27]});break}case"pcg":{i.userBank.clearRange({msb:63,lsb:[6,9]}),i.userBank.clearRange({msb:63,lsb:[13,16]});break}default:throw new Error(`Unknown bank format ${e}`)}switch(e){case"s7e":case"pcg":{le.context=this,await i.userBank.load(await le.read(e,t),!1);break}}i.forceVoiceRefresh()}constructor(){super();let e=this;for(let a=0;a<10;a++)e.#v[a]=new Uint8Array(256);e.#v[10]=new Uint8Array(512),e.#le=new H,e.#r={x5:82,ds:v.krs,smotif:v.s90es,gs:4,sc:3,gm:v.gm,g2:v.g2},e.#A={dumpLimit:e.DUMP_MODE},e.#te=new Proxy(e.#A,{set:()=>{}});for(let a in he){let s=v[a];s===void 0?console.debug(`SubDB build error: "${a}" does not exist`):e.#l[s]=new Uint8Array(he[a])}for(let a of F)e.modelEx.yPlg.push(new Uint8Array(a[1]));e.userBank.strictMode=!0,e.userBank.load(`MSB	PRG	LSB	NME
062	000	000	
122	000	000	
122	001	000	
122	002	000	
122	003	000	
122	004	000	
122	005	000	
122	006	000	`),e.addEventListener("metacommit",function(a){let{data:s}=a;e.#F[0]?.type===s.type&&e.#F[0]?.amend?(e.#F[0].amend=s.amend,e.#F[0].data+=s.data):e.#F.unshift(s)}),e.#_[1]=function(a){switch(a=a.replaceAll(`\r
`,`
`).replaceAll("\r",`
`),a.substring(0,2)){case"@I":{e.#E=e.KARAOKE_TEXT,e.dispatchEvent("metacommit",{type:"Kar.Info",data:a.substring(2)?.trimStart()});break}case"@K":{e.#E=e.KARAOKE_TEXT;let s=a.substring(2);s!=="MIDI KARAOKE FILE"&&e.dispatchEvent("metacommit",{type:"Kar.Mode",data:s?.trimStart()}),console.debug(`Karaoke mode active: ${s}`);break}case"@L":{e.#E=e.KARAOKE_TEXT,e.dispatchEvent("metacommit",{type:"Kar.Lang",data:a.substring(2)?.trimStart()});break}case"@T":{e.#E=e.KARAOKE_TEXT,e.dispatchEvent("metacommit",{type:"KarTitle",data:a.substring(2)?.trimStart()});break}case"@V":{e.#E=e.KARAOKE_TEXT,e.dispatchEvent("metacommit",{type:"Kar.Ver.",data:a.substring(2)?.trimStart()});break}case"Mi":{if(a.substring(2,16)==="dStamp-1.00: 0"){let s=a.length;for(let r=a.length;r>0;r--)if((a.charCodeAt(r-1)>>5)+1>>1===1){s=r;break}let c=a.substring(16,s);e.dispatchEvent("metacommit",{type:"MidStamp",data:ot(c)})}else a.split(`
`).forEach((s,c)=>{e.dispatchEvent("metacommit",{type:"Cmn.Text",data:s,mask:c!==0})});break}case"XF":{let s=a.slice(2).split(":");switch(s[0]){case"hd":{s.slice(1).forEach((c,r)=>{c.length&&e.dispatchEvent("metacommit",{type:["XfSngDte","XfSngRgn","XfSngCat","XfSongBt","XfSngIns","XfSngVoc","XfSngCmp","XfSngLrc","XfSngArr","XfSngPer","XfSngPrg","XfSngTag"][r],data:c})});break}case"ln":{s.slice(1).forEach((c,r)=>{c.length&&e.dispatchEvent("metacommit",{type:["XfKarLng","XfKarNme","XfKarCmp","XfKarLrc","XfKarArr","XfKarPer","XfKarPrg"][r],data:c})});break}default:e.dispatchEvent("metacommit",{type:"XfUnData",data:a})}break}default:switch(e.#E){case e.KARAOKE_TEXT:{switch(a[0]){case"\\":{e.dispatchEvent("metacommit",{type:"KarLyric",data:"",amend:!1}),e.dispatchEvent("metacommit",{type:"KarLyric",data:a.substring(1),amend:!0});break}case"/":{e.dispatchEvent("metacommit",{type:"KarLyric",data:"",mask:!0,amend:!1}),e.dispatchEvent("metacommit",{type:"KarLyric",data:a.substring(1),mask:!0,amend:!0});break}default:e.dispatchEvent("metacommit",{type:"KarLyric",data:a,amend:!0})}break}default:a.split(`
`).forEach((s,c)=>{e.dispatchEvent("metacommit",{type:"Cmn.Text",data:s,mask:c!==0})})}}},e.#_[2]=function(a){e.dispatchEvent("metacommit",{type:"Copyrite",data:a})},e.#_[3]=function(a,s){s<1&&e.#j<1&&e.dispatchEvent("metacommit",{type:"TrkTitle",data:a})},e.#_[4]=function(a,s){e.dispatchEvent("metacommit",{type:"Instrmnt",data:a})},e.#_[5]=function(a){switch(e.#E){case e.KARAOKE_XF:{let s="";for(let c of a)switch(c){case"^":case"%":{s+=" ";break}case">":{s+="	";break}case"<":{e.dispatchEvent("metacommit",{type:"KarLyric",data:s,mask:e.#M,amend:!1}),s="",e.#M=!1;break}case"/":{e.dispatchEvent("metacommit",{type:"KarLyric",data:s,mask:!1,amend:!1}),s="",e.#M=!0;break}default:s+=c}s.length>0&&(e.dispatchEvent("metacommit",{type:"KarLyric",data:s,mask:e.#M,amend:!0}),e.#M=!1);break}default:{let s=0,c=!0,r=a.length-1;for(;c&&s<8;)switch(a.charCodeAt(s)){case 32:{s++;break}default:c=!1}switch(s>0&&(e.dispatchEvent("metacommit",{type:"C.Lyrics",data:a.substring(0,s),amend:!0,mask:e.#M,untimed:!0}),e.#M=!1),a.charCodeAt(r)){case 10:{e.dispatchEvent("metacommit",{type:"C.Lyrics",data:a.substring(s,r),amend:!1,mask:e.#M}),e.#M=!1;break}case 11:case 13:{e.dispatchEvent("metacommit",{type:"C.Lyrics",data:a.substring(s,r),amend:!1,mask:e.#M}),e.#M=!0;break}case 32:{e.dispatchEvent("metacommit",{type:"C.Lyrics",data:a.substring(s,r),amend:!0,mask:e.#M}),e.dispatchEvent("metacommit",{type:"C.Lyrics",data:" ",amend:!0,mask:!1,untimed:!0}),e.#M=!1;break}default:a.trim()===""?console.info("Blank line? Shouldn't happen."):e.dispatchEvent("metacommit",{type:"C.Lyrics",data:a,amend:!0,mask:e.#M}),e.#M=!1}break}}},e.#_[6]=function(a){e.dispatchEvent("metacommit",{type:"C.Marker",data:a})},e.#_[7]=function(a){switch(a[0]){case"$":{if(a.substring(1,5)==="Lyrc"){e.#E=e.KARAOKE_XF;let s=a.substring(6).split(":"),c=s[0].replaceAll(" ","").split(",");c.forEach((d,o,f)=>{f[o]=parseInt(d)-1});let r=et[s[2].substring(0,2).toLowerCase()];e.dispatchEvent("metacommit",{type:"XfMeloCh",data:`CH${s[0].replaceAll(" ","").split(",").join(", CH")}`,parsed:c}),e.dispatchEvent("metacommit",{type:"XfLyrOff",data:s[1],parsed:parseInt(s[1])}),e.dispatchEvent("metacommit",{type:"XfLyrEnc",data:r[1],parsed:r[0]}),e.#M=!1}else e.dispatchEvent("metacommit",{type:"CuePoint",data:a});break}case"#":{e.dispatchEvent("metacommit",{type:"XfScneNo",data:a.substring(1)});break}case"&":{a.length===2?(e.dispatchEvent("metacommit",{type:"XfSngPrt",data:tt[a[1]]||`Unknown "${a[1]}"`}),e.#M=!1):e.dispatchEvent("metacommit",{type:"CuePoint",data:a});break}default:e.dispatchEvent("metacommit",{type:"CuePoint",data:a})}},e.#_[32]=function(a){e.#j=a[0]+1},e.#_[33]=function(a,s){T()&&console.debug(`Track ${s} requests assigning to port ${a}.`),e.#se[s]=a+1},e.#_[81]=function(a,s){e.#ae=a/1e3},e.#_[127]=function(a,s){e.#le.run(a,s)},e.#le.default=function(a){let s=[];for(let c=0;c<8&&c<a.length;c++)s.push(a[c].toString(16).padStart(2,"0").toUpperCase());console.warn(`Unrecognized implementation-specific byte sequence: ${s.join(" ")}${a.length>8?" ...":""}
%o`,a)},e.#le.add([67,0,1],(a,s)=>{T()&&console.debug(`XGworks requests assigning track ${s} to port ${a[0]}.`),e.#se[s]=a[0]+1}).add([67,123,1],(a,s)=>{let c=[];for(let r=0;r<a.length;r+=2){let d=a[r]>>4,o=a[r]&15;if(d<7&&o&&o<8){let f=new Uint8Array(5);f[0]=o-1,f[1]=d-3<<2,f[2]=a[r|1],c.push(f)}}e.dispatchEvent("metacommit",{type:"ChordCtl",src:"yxf",data:c}),console.debug("Yamaha XF chord data: %o",c)}).add([67,123,2],(a,s)=>{let c=new Uint8Array(2);c[0]=a[0]&15,c[1]=a[0]>>4,e.dispatchEvent("metacommit",{type:"RhrslMrk",src:"yxf",data:c}),console.debug(`Yamaha XF rehearsal mark: ${["Intro","Ending","Fill-in"][c[0]]??String.fromCharCode(62+c[0])}${"'".repeat(c[1])} %o`,c)}).add([67,123,96],(a,s)=>{let c=[0,0];a.subarray(1,3).forEach(r=>{c[0]=c[0]<<7,c[0]|=r&127}),a.subarray(3,5).forEach(r=>{c[1]=c[1]<<7,c[1]|=r&127}),e.dispatchEvent("metacommit",{type:"YStyleId",data:c}),console.debug(`Yamaha style ID: model ${c[0].toString(16)}, style ${c[1]+1}`)}),e.#oe=new H("universal non-realtime"),e.#ce=new H("universal realtime"),e.#U=new H("Yamaha"),e.#z=new H("Roland"),e.#Q=new H("Korg"),e.#de=new H("Kawai"),e.#fe=new H("Akai"),e.#he=new H("Casio");let t=new H("DX7+ Dump"),i=function(a){let s=[];for(let c=0;c<8&&c<a.length;c++)s.push(a[c].toString(16).padStart(2,"0").toUpperCase());console.info(`Unrecognized SysEx in "${this.name}" set: ${s.join(" ")}${a.length>8?" ...":""}
%o`,a)};e.#oe.default=i,e.#ce.default=i,e.#U.default=i,e.#z.default=i,e.#Q.default=i,e.#de.default=i,e.#fe.default=i,e.#he.default=i,t.default=i,e.#oe.add([9],(a,s,c)=>{e.switchMode(["gm","?","g2"][a[0]-1],2),e.setPortMode(e.getTrackPort(s),1,[v.gm,v["?"],e.#r.g2][a[0]-1]),e.#E=e.#E||e.KARAOKE_NONE,console.info(`MIDI reset: ${["GM","Init","GM2"][a[0]-1]}`),a[0]===2&&e.init()}),e.#ce.add([4,1],(a,s,c)=>{e.invokeSysExIndicator(),e.#p=((a[1]<<7)+a[0])/16383*100,e.dispatchEvent("mastervolume",e.#p)}).add([4,3],(a,s,c)=>((a[1]<<7)+a[0]-8192)/8192).add([4,4],(a,s,c)=>a[1]-64).add([4,5],(a,s,c)=>{e.invokeSysExIndicator();let r=a[0],d=a[1],o=a[2],f=3,g=f+(r<<1),u=g+d;if(r!==1){console.error(`Unsupported GM2 global parameter set: slotpath length too long (${r})!
`,a);return}let w=0,k=0,S=0;switch(a.subarray(f,g).forEach(M=>{w=w<<7,w|=M}),T()&&console.debug(`GM2 global parameter: (${a.subarray(3,g)}; p: ${k}, v: ${S})`),w){case 129:{k===0&&(e.setEffectType(0,52,S),e.pushEffectType(0));break}case 130:{k===0&&(e.setEffectType(1,52,S|16),e.pushEffectType(1));break}default:T()&&console.debug("GM2 global paramater slot path unknown.")}}),this.#U.add([76,0,0],(a,s,c)=>{switch(a[0]){case 125:{e.initDrums(),console.info(`XG drum setup reset on drum kit ${a[1]}.`);break}case 126:{e.switchMode("xg",2),e.setPortMode(e.getTrackPort(s),4,v.xg),e.modelEx.vl.module=0,e.#E=e.#E||e.KARAOKE_NONE,console.info("MIDI reset: XG");break}default:{e.invokeSysExIndicator();let r=[0,0,0,0],d=(o,f)=>{r[f]=o};if(a.subarray(1).forEach((o,f)=>{let g=f+a[0];([d,d,d,d,u=>{this.#p=u*129/16383*100,e.dispatchEvent("mastervolume",e.#p)},u=>{},u=>{}][g]||(()=>{}))(o,f)}),a[0]<4){let o=0;r.forEach(f=>{o=o<<4,o+=f}),o-=1024,console.debug(`Master tune: ${o}`)}}}}).add([76,2,1],(a,s,c)=>{e.invokeSysExIndicator();let r="XG ";a[0]<32?(r+="reverb ",a.subarray(1).forEach((d,o)=>{([f=>{e.setEffectTypeRaw(0,!1,f),console.info(`${r}main type: ${oe[f]}`),e.pushEffectType(0)},f=>{e.setEffectTypeRaw(0,!0,f),console.debug(`${r}sub type: ${f+1}`),e.pushEffectType(0)},f=>{console.debug(`${r}time: ${qe(f)}s`)},f=>{console.debug(`${r}diffusion: ${f}`)},f=>{console.debug(`${r}initial delay: ${f}`)},f=>{console.debug(`${r}HPF cutoff: ${ae[f]}Hz`)},f=>{console.debug(`${r}LPF cutoff: ${ae[f]}Hz`)},f=>{console.debug(`${r}width: ${f}`)},f=>{console.debug(`${r}height: ${f}`)},f=>{console.debug(`${r}depth: ${f}`)},f=>{console.debug(`${r}wall type: ${f}`)},f=>{console.debug(`${r}dry/wet: ${f}`)},f=>{console.debug(`${r}send: ${V(f)}dB`)},f=>{console.debug(`${r}pan: ${f-64}`)},!1,!1,f=>{console.debug(`${r}delay: ${f}`)},f=>{console.debug(`${r}density: ${f}`)},f=>{console.debug(`${r}balance: ${f}`)},f=>{},f=>{console.debug(`${r}feedback: ${f}`)},f=>{}][a[0]+o]||function(){console.warn(`Unknown XG reverb address: ${a[0]}.`)})(d)})):a[0]<64?(r+="chorus ",a.subarray(1).forEach((d,o)=>{([f=>{e.setEffectTypeRaw(1,!1,f),console.info(`${r}main type: ${oe[f]}`),e.pushEffectType(1)},f=>{e.setEffectTypeRaw(1,!0,f),console.debug(`${r}sub type: ${f+1}`),e.pushEffectType(1)},f=>{console.debug(`${r}LFO: ${ze[f]}Hz`)},f=>{},f=>{console.debug(`${r}feedback: ${f}`)},f=>{console.debug(`${r}delay offset: ${Qe(f)}ms`)},f=>{},f=>{console.debug(`${r}low: ${ae[f]}Hz`)},f=>{console.debug(`${r}low: ${f-64}dB`)},f=>{console.debug(`${r}high: ${ae[f]}Hz`)},f=>{console.debug(`${r}high: ${f-64}dB`)},f=>{console.debug(`${r}dry/wet: ${f}`)},f=>{console.debug(`${r}send: ${V(f)}dB`)},f=>{console.debug(`${r}pan: ${f-64}`)},f=>{console.debug(`${r}to reverb: ${V(f)}dB`)},!1,f=>{},f=>{},f=>{},f=>{console.debug(`${r}LFO phase diff: ${(f-64)*3}deg`)},f=>{console.debug(`${r}input mode: ${f?"stereo":"mono"}`)},f=>{}][a[0]-32+o]||function(){console.warn(`Unknown XG chorus address: ${a[0]}.`)})(d)})):a[0]<86?(r+="variation ",a.subarray(1).forEach((d,o)=>{([f=>{e.setEffectTypeRaw(2,!1,f),console.info(`${r}main type: ${oe[f]}`),e.pushEffectType(2)},f=>{e.setEffectTypeRaw(2,!0,f),console.debug(`${r}sub type: ${f+1}`),e.pushEffectType(2)}][a[0]-64+o]||function(){})(d)})):a[0]<97?(r+="variation ",a.subarray(1).forEach((d,o)=>{[f=>{console.debug(`${r}send: ${V(f)}dB`)},f=>{console.debug(`${r}pan: ${f-64}`)},f=>{console.debug(`${r}to reverb: ${V(f)}dB`)},f=>{console.debug(`${r}to chorus: ${V(f)}dB`)},f=>{e.modelEx.xg.varSys=!!f,console.debug(`${r}connection: ${f?"system":"insertion"}`)},f=>{if(e.modelEx.xg.varSys){console.warn(`${r}effect is applied system-wide. Setting its effective channel to CH${f+1} will not have any effect.`);return}if(f<64){let g=e.chRedir(f,s,!0);e.setXgChEffectSink(g,2),console.debug(`${r}channel: CH${f+1} (CH${g+1})`)}else e.setXgChEffectSink(y.invalidCh,2),console.info(`${r}channel: CH${f+1} (unsupported)`)},f=>{console.debug(`${r}mod wheel: ${f-64}`)},f=>{console.debug(`${r}bend wheel: ${f-64}`)},f=>{console.debug(`${r}channel after touch: ${f-64}`)},f=>{console.debug(`${r}AC1: ${f-64}`)},f=>{console.debug(`${r}AC2: ${f-64}`)}][a[0]-86+o](d)})):a[0]>111&&a[0]<118?r+="variation ":console.warn(`Unknown XG variation address: ${a[0]}`)}).add([76,2,64],(a,s,c)=>{a.subarray(1).forEach((r,d)=>{let o=d+a[0];if(o===0)console.debug(`XG EQ preset: ${["flat","jazz","pop","rock","classic"][r]}`);else{let f=o-1>>2,g=o-1&3,u=`XG EQ ${f} ${["gain","freq","Q","shape"][g]}: `;[()=>{console.debug(`${u}${r-64}dB`)},()=>{console.debug(`${u}${r} (raw)`)},()=>{console.debug(`${u}${r/10}`)},()=>{console.debug(`${u}${["shelf","peak"][+!!r]}`)}][g]()}})}).add([76,3],(a,s,c)=>{e.invokeSysExIndicator();let r=a[0],d=a[1],o=`XG Insertion ${a[0]+1} `;a.subarray(2).forEach((f,g)=>{([()=>{e.setEffectTypeRaw(3+r,!1,f),console.info(`${o}main type: ${oe[f]}`),e.pushEffectType(3+r)},()=>{e.setEffectTypeRaw(3+r,!0,f),console.debug(`${o}sub type: ${f+1}`),e.pushEffectType(3+r)},!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,()=>{if(f<64){let u=e.chRedir(f,s,!0);e.setXgChEffectSink(u,3+r),console.debug(`${o}channel: CH${f+1} (CH${u+1})`)}else e.setXgChEffectSink(y.invalidCh,3+r),console.info(`${o}channel: CH${f+1} (unsupported)`)}][d+g]||function(){})(f)})}).add([76,6,0],(a,s,c)=>{let r=a[0];r<64?e.setLetterDisplay(a.subarray(1),"XG letter display",r):e.#G=e.clockSource.now()}).add([76,7,0],(a,s,c)=>{let r=a[0];e.#h=0,e.#C=e.clockSource.now()+3200,a.subarray(1).forEach(function(o,f){let g=f+r,u=g>>4,w=g&15,k=(w*3+u)*7,S=7,M=0;for(k-=w*5,u===2&&(S=2);M<S;)e.#k[k+M]=o>>6-M&1,M++})}).add([76,8],(a,s)=>{e.invokeSysExIndicator();let c=e.chRedir(a[0],s,!0),r=a[1],d=R[c],o=`XG CH${c+1} `,f=`Unknown XG part address ${r}.`,g=!0;a.subarray(2).forEach((u,w)=>{g=!0,r<1?console.debug(f):r<41?([()=>{e.setChCc(c,0,u),e.pushChPrimitives(c)},()=>{e.setChCc(c,32,u),e.pushChPrimitives(c)},()=>{e.#n[c]=u,e.pushChPrimitives(c)},()=>{g=!1;let k=e.chRedir(u,s,!0),S=e.#d[c];e.#d[c]=k,(c!==k||k!==S)&&(e.buildRchTree(),console.info(`${o}receives from CH${k+1}`)),e.#P[c]||(e.copyChSetup(k,c,!0),console.debug(`${o}copied from CH${k+1}.`),e.setChActive(c,1),e.pushChPrimitives(c))},()=>{e.#u[c]=+!u},()=>{},()=>{g=!1,e.setChType(c,u,v.xg),console.debug(`${o}type: ${ce[u]||u}`),e.pushChPrimitives(c)},()=>{e.#s[y.rpn*c+3]=u,e.#f[y.rpnt*c+2]=1,e.dispatchEvent("pitch",{part:c,pitch:e.getPitchShift(c)})},!1,!1,()=>{e.setChCc(c,7,u)},!1,!1,()=>{e.setChCc(c,10,u||128)},!1,!1,()=>{e.setChCc(c,128,u),e.allocateAce(c,128)},()=>{e.setChCc(c,93,u)},()=>{e.setChCc(c,91,u)},()=>{e.setChCc(c,94,u)},()=>{e.setChCc(c,76,u)},()=>{e.setChCc(c,77,u)},()=>{e.setChCc(c,78,u)},()=>{e.setChCc(c,74,u)},()=>{e.setChCc(c,71,u)},()=>{e.setChCc(c,73,u)},()=>{e.setChCc(c,75,u)},()=>{e.setChCc(c,72,u)}][r+w-1]||(()=>{}))():r<48?console.debug(f):r<111?r>102&&r<105&&e.setChCc(c,[5,65][r&1],u):r<114?console.debug(f):r<116?console.debug(`${o}EQ ${["bass","treble"][r&1]} gain: ${u-64}dB`):r<118?console.debug(f):r<120?console.debug(`${o}EQ ${["bass","treble"][r&1]} freq: ${u}`):console.debug(f)}),g&&e.#i[c]>1&&e.setDrumFirstWrite(c)}).add([76,9],(a,s)=>{let c=e.chRedir(a[0],s,!0),r=a[1],d=R[c],o=`PLG-VL CH${c+1} `;a.subarray(2).forEach((f,g)=>{let u=g+r;switch(u){case 1:{console.info(`${o}breath mode: ${["system","breath","velocity","touch EG"][f]}`);break}case 0:case 27:case 28:break;default:if(u<27){let w=u-3>>1,k=["pressure","embouchure","tonguing","scream","breath noise","growl","throat formant","harmonic enhancer","damping","absorption","amplification","brightness"][w];u&1?u<23?(console.debug(`${o}${k} control source: ${je(f)}`),f&&f<96&&e.allocateAce(c,130+w),e.#Z[y.redir*c+w+2]=f,e.buildRccMap()):console.debug(`${o}${k} scale break point: ${f}`):(console.debug(`${o}${k} depth: ${f-64}`),e.setChCc(c,130+w,f))}}})}).add([76,10],(a,s,c)=>{}).add([76,16],(a,s,c)=>{}).add([76,17,0,0],(a,s,c)=>{}).add([76,112],(a,s,c)=>{if(a[0]>=F.length){console.error(`Supplied invalid plugin board ID: ${a[0]}`);return}if(a[1]>=F[a[0]][1]){console.error(`Supplied invalid slot ID for board type "${F[a[0]][0]}" (${a[0]}): ${a[1]} (#${a[1]+1}))`);return}switch(a[1]>=F[a[0]][2]?console.warn(`While enabled in Octavia, slot #${a[1]+1} for board type "${F[a[0]][0]}" (${a[0]}) may not function outside software recreation.`):a[2]>63?console.debug(`XG disable PLG-${F[a[0]][0]} (${a[0]}) slot #${a[1]+1} as it's set to CH${a[2]+1}.`):console.debug(`XG enable PLG-${F[a[0]][0]} (${a[0]}) slot #${a[1]+1} for CH${a[2]+1}.`),e.modelEx.yPlg[a[0]][a[1]]=a[2]<64?e.chRedir(a[2],s,!0):y.invalidCh,a[0]){case 0:{e.#y[y.ext*a[2]]=e.EXT_VL;break}case 2:{e.#y[y.ext*a[2]]=e.EXT_DX;break}default:e.#y[y.ext*a[2]]=e.EXT_NONE}}).add([73,0,0],(a,s)=>{let c=a[0],r="MU System - ";a.subarray(1).forEach((d,o)=>{let f=c+o;f===8?(e.lcdContrast=Math.max(0,Math.min(8,9-d))<<2,console.debug(`${r}LCD contrast: ${d}.`)):f===18?(e.#l[v.xg][1]=[0,126,152][d]??127,console.debug(`${r}default bank: ${["MU Basic","MU100 Native","PSR/LE"][d]??d}.`),e.modelEx.xg.map=d,e.dispatchEvent("banklevel",{mode:"xg",data:d}),e.forceVoiceRefresh()):f>=64&&f<69&&[()=>{e.dispatchEvent("channelactive",d)},()=>{d<8?(e.dispatchEvent("channelmin",d<<4),console.debug(`Octavia System: Minimum CH${(d<<4)+1}`)):(e.dispatchEvent("channelreset"),console.info("Octavia System: Clear channel ranges"))},()=>{d<8?(e.dispatchEvent("channelmax",(d<<4)+15),console.debug(`Octavia System: Maximum CH${(d<<4)+16}`)):(e.dispatchEvent("channelreset"),console.info("Octavia System: Clear channel ranges"))},()=>{e.dispatchEvent("channelreset"),console.info("Octavia System: Clear channel ranges")},()=>{e.#W=!!d,console.info(`Octavia System: RS receiving ${["dis","en"][d]}abled.`)}][f-64]()})}).add([73,10,0],(a,s)=>{let c=a[0],r=`MU RS${e.#W?"":" (ignored)"}: `;if(a[1]!==0){console.info(`${r}button ${c} pressed.`);return}if(c<16)switch(c){case 0:{e.#W&&e.dispatchEvent("portrange",1),console.info(`${r}Show single port.`),e.lcdHideBankInfo=!1;break}case 1:{let d=e.chRedir(0,s,!0);e.#W&&(e.dispatchEvent("portrange",2),e.dispatchEvent("portstart",d)),console.info(`${r}Show CH${d+1}~CH${d+32}.`),e.lcdHideBankInfo=!1;break}case 2:{let d=e.chRedir(0,s,!0);e.#W&&(e.dispatchEvent("portrange",4),e.dispatchEvent("portstart",d)),console.info(`${r}Show CH${d+1}~CH${d+64}.`),e.lcdHideBankInfo=!1;break}case 3:{let d=e.chRedir(0,s,!0);e.#W&&(e.dispatchEvent("portrange",2),e.dispatchEvent("portstart",d)),console.info(`${r}Show CH${d+1}~CH${d+32}, hide info.`),e.lcdHideBankInfo=!0;break}default:c>=4&&c<12?(e.lcdContrast=12-c<<1,console.debug(`${r}LCD contrast set to ${c-3}.`)):console.debug(`${r}unknown switch ${c} invoked.`)}else if(c<32){if(e.#W){let d=e.chRedir(c-16+(e.#pe<<4),s,!0);e.dispatchEvent("channelactive",d)}}else if(c<36){let d=e.chRedir(c-32<<4,s,!0);e.#W&&(e.dispatchEvent("portrange",1),e.dispatchEvent("portstart",d>>4),e.#pe=c-32),console.info(`${r}Show CH${d+1}~CH${d+16}.`)}}).add([73,11,0],(a,s)=>{let c="MU1000 System - channel ",r="Octavia System - channel ",d=a[0];a.subarray(1).forEach((o,f)=>{let g=d+f;([()=>{e.setChActive(o,1),e.dispatchEvent("channelactive",o),T()&&console.debug(`${c}current part: CH${o+1}`)},()=>{o<5?(e.dispatchEvent("portrange",1<<o),console.debug(`${c}port range: ${1<<o} port(s)`)):(e.dispatchEvent("portrange",0),console.debug(`${c}port range: reset`))},()=>{o<16?(e.dispatchEvent("portstart",o),console.debug(`${r}start port: ${"ABCDEFGHIJKLMNOP"[o]}`)):(e.dispatchEvent("portstart",255),console.debug(`${r}start port: reset`))}][g]||(()=>{console.debug(`${c}unknown address: ${g}`)}))()})}).add([87,0,0],(a,s)=>{let c="VL70-m sound module ";switch(a[0]){case 126:{console.info(`${c}mode set to: ${["VL-XG","VL70-m voice"][a[1]]??`invalid (${a[1]})`}`),e.switchMode("xg",1),a[1]<2&&(e.modelEx.vl.module=a[1]+1),e.setPortMode(e.getTrackPort(s),1,v.xg);break}default:console.info(`Unknown ${c}address: ${a[0]}`)}}).add([93,3],(a,s)=>{let c=e.chRedir(a[0],s,!0),r=`PLG-SG CH${c+1} `,d=e.clockSource.now(),o=e.modelEx.sg;if(a[1]===0){let f="",g=0;a.subarray(2).forEach((u,w)=>{w%2===0?f+=Je[u]||u.toString().padStart("0"):g+=u*13}),(d>=o.convLastSyll||o.runLineLen>=o.maxLineLen)&&(e.dispatchEvent("metacommit",{type:"SGLyrics",data:"",amend:!1}),o.splitMask=d<o.convLastSyll,o.runLineLen=0),e.dispatchEvent("metacommit",{type:"SGLyrics",data:`${Ze(f)}`,amend:!0,mask:o.splitMask}),o.runLineLen++,o.splitMask=!1,o.convLastSyll=d+Math.ceil(g/2)+e.#ae,T()&&console.debug(`${r}vocals: ${f}`)}else console.warn(`Unknown PLG-SG data: ${a}`)}).add([98,96],(a,s,c,r)=>{let d=e.chRedir(a[0],s,!0),o=R[d],f=a[1];a.subarray(2).forEach((g,u)=>{let w=f+u;if(!(w<10)){if(w===10)e.resetAce();else if(w<27){let k=w+131;e.setChCc(d,k,g),!r?.noAce&&g>0&&g!==64&&e.allocateAce(d,k),e.dispatchEvent("cc",{part:d,cc:k,data:g})}}})}).add([1,20],(a,s,c)=>{c===115?(e.switchMode("doc",2),e.setPortMode(e.getTrackPort(s),1,v.doc),console.info("MIDI reset: DOC")):console.debug(`Unknown Yamaha SysEx: 67, ${c}, ${a.join(", ")}`)}).add([1,17,15,89],(a,s,c)=>{c===115?(e.setEffectType(0,24,a[0]|16),e.pushEffectType(0)):console.debug(`Unknown Yamaha SysEx: 67, ${c}, ${a.join(", ")}`)}).add([1,24],(a,s,c)=>{if(c===115){for(let r=0;r<16;r++){let d=e.chRedir(r,s,!0);e.setChCc(d,91,127)}console.info("DOC Global Reverb: on")}else console.debug(`Unknown Yamaha SysEx: 67, ${c}, ${a.join(", ")}`)}).add([126,0],(a,s,c)=>{switch(a[1]){case 0:{e.dispatchEvent("metacommit",{type:"YMCSSect",data:"Disabled",raw:"Intro "}),console.debug("Yamaha Section Control is off.");break}case 127:{e.dispatchEvent("metacommit",{type:"YMCSSect",data:["Intro","Main A","Main B","Fill-in AB","Fill-in BA","Ending","Blank"][a[0]-8]??`invalid section ${a[0]}`,raw:["Intro ","Main A","Main B","FillAB","FillBA","Ending","Blank "][a[0]-8]??`ID: ${a[0]}`}),console.debug(`Yamaha Section Control switches to "${["intro","main A","main B","fill-in AB","fill-in BA","ending","blank"][a[0]-8]??`Invalid section ${a[0]}`}".`);break}default:console.debug(`Unknown YMCS section control: ${a[1]}`)}}).add([126,2],(a,s,c)=>{let r=[];for(let d=0;d<a.length;d+=2){let o=a[d]>>4,f=a[d]&15;if(o<7&&f&&f<8){let g=new Uint8Array(5);g[0]=f-1,g[1]=o-3<<2,g[2]=a[d|1],r.push(g)}}e.dispatchEvent("metacommit",{type:"ChordCtl",src:"ymcs",data:r}),console.debug("YMCS chord data: %o",r)});let l=function(a,s,c,r){},h=function(a,s){e.invokeSysExIndicator();let c=a*y.dpn,r=s[0],d=s[1];s.subarray(2).forEach((o,f)=>{let g=f+d,u=-1;g<16?([()=>{u=24},()=>{u=25},()=>{u=26},()=>{},()=>{u=28},()=>{u=29},()=>{u=30},()=>{u=31},()=>{},()=>{},()=>{},()=>{u=20},()=>{u=21},()=>{u=22},()=>{u=23},()=>{}][g]||(()=>{console.debug(`Unknown XG-style drum param ${g} on set ${a+1}.`)}))():g<32||(g<40?([()=>{u=48},()=>{u=49},!1,!1,()=>{u=52},()=>{u=53}][g-32]||(()=>{console.debug(`Unknown XG-style drum param ${g} on set ${a+1}.`)}))():g<80||([()=>{u=36}][g-80]||(()=>{console.debug(`Unknown XG-style drum param ${g} on set ${a+1}.`)}))()),u>=0?(T()&&console.debug(c,u,r,o),e.#D[(c+X[u])*y.dnc+r]=o):T()&&console.debug(`XG-style drum param ${g} has no writes.`)})},p=function(a,s,c){e.invokeSysExIndicator();let r=a*y.dpn,d=(s<<7)+c[0];c.subarray(1).forEach((o,f)=>{let g=f+d,u=g&127,w=g>>7,k=-1;w>1&&([()=>{k=26},()=>{},()=>{k=28},()=>{k=29},()=>{k=30},()=>{},()=>{},()=>{k=31}][w-2]||(()=>{console.debug(`Unknown GS-style drum param ${w} on set ${a+1}.`)}))(),k>-1?(T()&&console.debug(r,k,u,o),e.#D[(r+X[k])*y.dnc+u]=o):T()&&console.debug(`GS-style drum param ${w} has no writes.`)})};this.#U.add([76,48],(a,s,c)=>{h(0,a)}).add([76,49],(a,s,c)=>{h(1,a)}).add([76,50],(a,s,c)=>{h(2,a)}).add([76,51],(a,s,c)=>{h(3,a)}).add([76,52],(a,s,c)=>{h(4,a)}).add([76,53],(a,s,c)=>{h(5,a)}).add([76,54],(a,s,c)=>{h(6,a)}).add([76,55],(a,s,c)=>{h(7,a)}),this.#U.add([89,0],(a,s,c)=>{if(e.eprom){let r=a[0],d=(a[1]<<14)+(a[2]<<7)+a[3]+(e.eprom.offset||0);T()&&console.debug(`MU1000 EPROM trail to 0x${d.toString(16).padStart(6,"0")}, ${r} bytes.`);let o=e.eprom.data;a.subarray(4).forEach((f,g)=>{let u=g>>3,w=g&7;if(w===7)for(let k=0;k<7;k++)o[d+7*u+k]+=(f>>6-k&1)<<7;else o[d+7*u+w]=f})}}).add([89,1],(a,s,c)=>{let r=(a[0]<<21)+(a[1]<<14)+(a[2]<<7)+a[3];T()&&console.debug(`MU1000 EPROM jump to 0x${r.toString(16).padStart(6,"0")}.`),e.eprom&&(e.eprom.offset=r)}).add([89,2],(a,s,c)=>{if(e.eprom){let r=(a[0]<<21)+(a[1]<<14)+(a[2]<<7)+a[3]+(e.eprom.offset||0);T()&&console.debug(`MU1000 EPROM write to 0x${r.toString(16).padStart(6,"0")}.`);let d=e.eprom.data;a.subarray(4).forEach((o,f)=>{let g=f>>3,u=f&7;if(u===7)for(let w=0;w<7;w++)d[r+7*g+w]+=(o>>6-w&1)<<7;else d[r+7*g+u]=o})}}).add([89,3],(a,s,c)=>{}),this.#U.add([39,48],(a,s,c)=>{}).add([43,0,0],(a,s,c)=>{e.invokeSysExIndicator();let r=[0,0,0,0],d=(o,f)=>{r[f]=o};if(a.subarray(1).forEach((o,f)=>{let g=f+a[0];[d,d,d,d,()=>{this.#p=o*129/16383*100,e.dispatchEvent("mastervolume",e.#p)},()=>o-64,()=>o||128,()=>o,()=>o,()=>{console.debug(`TG300 variation on cc${o}.`)}][g](o,g)}),a[0]<4){let o=0;r.forEach(f=>{o=o<<4,o+=f}),o-=1024,console.debug(`Master tune: ${o}`)}}).add([43,1,0],(a,s,c)=>{e.invokeSysExIndicator()}).add([43,2],(a,s,c)=>{e.invokeSysExIndicator();let r=e.chRedir(a[0],s,!0),d=a[1],o=R[r],f=`TG300 CH${r+1} `;a.subarray(2).forEach((g,u)=>{u<5?([()=>{},()=>{e.setChCc(r,0,g),e.pushChPrimitives(r)},()=>{e.setChCc(r,32,g),e.pushChPrimitives(r)},()=>{e.#n[r]=g,e.pushChPrimitives(r)},()=>{let w=e.chRedir(g,s,!0),k=e.#d[r];e.#d[r]=w,(r!==w||w!==k)&&(e.buildRchTree(),console.info(`${f}receives from CH${w+1}`))}][u+d]||(()=>{}))(g,u+d):u<21||(u<47?([()=>{e.#u[r]=+!g},()=>{},()=>{},()=>{e.#s[y.rpn*r+3]=g,e.#f[y.rpnt*r+2]=1,e.dispatchEvent("pitch",{part:r,pitch:e.getPitchShift(r)})},()=>{},()=>{e.setChCc(r,7,g)},!1,!1,()=>{e.setChCc(r,10,g||128)},!1,!1,()=>{console.debug(`${f} AC1 at cc${g}`)},()=>{console.debug(`${f} AC2 at cc${g}`)},()=>{e.#e[o+x[128]]=g,e.allocateAce(r,128)},()=>{e.#e[o+x[93]]=g},()=>{e.#e[o+x[91]]=g},()=>{e.#e[o+x[94]]=g},()=>{e.#e[o+x[76]]=g},()=>{e.#e[o+x[77]]=g},()=>{e.#e[o+x[74]]=g},()=>{e.#e[o+x[71]]=g},()=>{e.#e[o+x[73]]=g},()=>{e.#e[o+x[75]]=g},()=>{e.#e[o+x[72]]=g},()=>{e.#e[o+x[78]]=g}][u+d-21]||(()=>{}))(g,u+d):u<95||([()=>{e.#e[o+x[65]]=g},()=>{e.#e[o+x[5]]=g}][u+d-95]||(()=>{}))(g,u+d))})}).add([43,7,0],(a,s,c)=>{let r=a[0];e.setLetterDisplay(a.subarray(1),"TG300 letter display",r)}).add([43,7,1],(a,s,c)=>{e.#h=0,e.#C=e.clockSource.now()+3200,a.forEach(function(r,d){let o=d>>4,f=d&15,g=(f*3+o)*7,u=7,w=0;for(g-=f*5,o===2&&(u=2);w<u;)e.#k[g+w]=r>>6-w&1,w++})}),this.#z.add([66,18,0,0,127],(a,s,c)=>{e.switchMode("sc",2),e.setPortMode(e.getTrackPort(s),2,v.sc),e.#E=e.KARAOKE_NONE,e.#ee.fill(0),console.info(`GS system to ${["single","dual"][a[0]]} mode.`)}).add([66,18,64,0],(a,s,c)=>{switch(a[0]){case 127:{e.switchMode("gs",2),e.setPortMode(e.getTrackPort(s),4,v.gs),e.#E=e.KARAOKE_NONE,e.#ee.fill(0),console.info("MIDI reset: GS");break}default:{e.invokeSysExIndicator();let r=[0,0,0,0],d=(o,f)=>{r[f]=o};if(a.subarray(1).forEach((o,f)=>{let g=f+a[0];[d,d,d,d,u=>{this.#p=u*129/16383*100,e.dispatchEvent("mastervolume",e.#p)},u=>{},u=>{}][g](o,f)}),a[0]<4){let o=0;r.forEach(f=>{o=o<<4,o+=f}),o-=1024,console.debug(`Master tune: ${o}`)}}}}).add([66,18,64,1],(a,s,c)=>{e.invokeSysExIndicator();let r=a[0];if(r<16){let d="".padStart(r," ");a.subarray(1).forEach((o,f)=>{d+=String.fromCharCode(Math.max(32,o))}),d=d.padEnd(16," "),console.debug(`GS patch name: ${d}`)}else r<48||(r<65?a.subarray(1).forEach((d,o)=>{let f=`GS ${r+o>55?"chorus":"reverb"} `;([()=>{console.info(`${f}type: ${Le[d]}`),e.setEffectType(0,40,d),e.pushEffectType(0)},()=>{},()=>{},()=>{},()=>{},()=>{},!1,()=>{console.debug(`${f}predelay: ${d}ms`)},()=>{console.info(`${f}type: ${at[d]}`),e.setEffectType(1,40,16+d),e.pushEffectType(1)},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{console.debug(`${f}to reverb: ${V(d)}`)},()=>{console.debug(`${f}to delay: ${V(d)}`)}][r+o-48]||(()=>{}))()}):r<80?console.debug(`Unknown GS patch address: ${r}`):r<91?a.subarray(1).forEach((d,o)=>{let f="GS delay ";([()=>{console.info(`${f}type: ${rt[d]}`),e.setEffectType(2,40,32+d),e.pushEffectType(2)},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{console.debug(`${f}to reverb: ${V(d)}`)}][r+o-80]||(()=>{}))()}):console.debug(`Unknown GS patch address: ${r}`))}).add([66,18,64,2],(a,s,c)=>{let r="GS EQ ";a.subarray(1).forEach((d,o)=>{([()=>{console.debug(`${r}low freq: ${[200,400][d]}Hz`)},()=>{console.debug(`${r}low gain: ${d-64}dB`)},()=>{console.debug(`${r}high freq: ${[3e3,6e3][d]}Hz`)},()=>{console.debug(`${r}high gain: ${d-64}dB`)}][a[0]+o]||function(){console.warn(`Unknown GS EQ address: ${a[0]+o}`)})()})}).add([66,18,64,3],(a,s,c)=>{e.invokeSysExIndicator();let r="GS EFX ",d=function(o,f){let g=it(e.#O.subarray(10,12),f,o);g&&console.debug(`${r}${Ie(e.#O.subarray(10,12))} ${g}`)};a.subarray(1).forEach((o,f)=>{([()=>{e.setEffectTypeRaw(3,!1,32+o),e.pushEffectType(3)},()=>{e.setEffectTypeRaw(3,!0,o),console.info(`${r}type: ${Ie(e.#O.subarray(10,12))}`),e.pushEffectType(3)},!1,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,()=>{console.debug(`${r}to reverb: ${V(o)}dB`)},()=>{console.debug(`${r}to chorus: ${V(o)}dB`)},()=>{console.debug(`${r}to delay: ${V(o)}dB`)},!1,()=>{console.debug(`${r}1 source: ${o}`),o&&o<96&&e.allocateAceAll(o)},()=>{console.debug(`${r}1 depth: ${o-64}`)},()=>{console.debug(`${r}2 source: ${o}`),o&&o<96&&e.allocateAceAll(o)},()=>{console.debug(`${r}2 depth: ${o-64}`)},()=>{console.debug(`${r}to EQ: ${o?"ON":"OFF"}`)}][a[0]+f]||function(g,u){console.warn(`Unknown GS EFX address: ${u}`)})(o,a[0]+f)})}).add([66,18,65],(a,s,c)=>{p((a[0]>>4)+1<<1,a[0]&15,a.subarray(1))}).add([66,18,72],(a,s,c)=>{let r=(a[0]&127)<<7|a[1]&127;console.debug(r,lt(a.subarray(2)))}).add([69,18,16],(a,s,c)=>{switch(a[0]){case 0:{let r=a[1];e.setLetterDisplay(a.subarray(2),"GS display text",r);break}case 8:{let r=a[1],d=e.modelEx.sc;a.subarray(2).forEach((o,f)=>{([()=>{d.showBar=!(o&1),d.invBar=o>>1&1,d.invDisp=o>>2&1},()=>{d.peakHold=o<4?o:1}][f+r]||(()=>{console.debug("Unsupported GS display type SysEx.")}))()});break}case 32:{e.#C=e.clockSource.now()+3200,a[1]===0&&(a[2]?(e.#h=Math.max(Math.min(a[2]-1,9),0),T()&&console.debug(`GS switch display page ${a[2]-1}.`)):(e.#h=0,e.#C=e.clockSource.now(),T()&&console.debug("GS disable display page.")));break}default:if(a[0]<6){e.#h>9&&(e.#h=0);let r=a[0]-1<<1|a[1]>>6;e.#h===r&&(e.#C=e.clockSource.now()+3200),e.#v[r]?.length||(e.#v[r]=new Uint8Array(256));let d=e.#v[r];T()&&console.debug(`GS frame draw page ${r}.`);let o=a[1]&63;a.subarray(2).forEach(function(g,u){let w=u+o,k=w>>4,S=w&15,M=(S*4+k)*5,B=5,P=0;for(M-=S*4,k===3&&(B=1);P<B;)d[M+P]=g>>4-P&1,P++})}else console.warn(`Unknown GS display section: ${a[0]}`)}}).add([69,18,32],(a,s,c)=>{let r=a[0],d=a[1],o=a.subarray(2);if(r>>4){console.warn(`SC-8850 partial screen dump out of bounds: invalid bundle.
`,a);return}let f=d+o.length,g=d*6-(d*2428>>16<<1),u=f*6-(f*2428>>16<<1);if(g>640){console.warn(`SC-8850 partial screen dump out of bounds: invalid buffer range.
`,a);return}u>640&&(console.info(`SC-8850 partial screen dump out of bounds: invalid buffer end, automatically restricted.
`,a),u=640);let w=new Uint8Array(u-g);o.forEach((M,B)=>{let P=B+d,Y=(P*2428&65535)*27>>16===26,Rt=P*6-(P*2428>>16<<1),ge=Y?2:0;for(;ge<6;)w[Rt+(5-ge)]=M>>ge&1,ge++});let k=r*108+d,S=k*6-(k*2428>>16<<1);e.dispatchEvent("screen",{type:"sc8850",offset:S,data:w}),T()&&console.debug(`SC-8850 screen dump: bundle ${r+1}, range ${g}~${u}`)});let m=function(a,s,c){e.invokeSysExIndicator();let r=a[0],d=R[s],o=re[s],f=`GS CH${s+1} `;r<3?(a.subarray(1).forEach((g,u)=>{[()=>{e.#e[d+x[0]]=g,e.pushChPrimitives(s)},()=>{e.#n[s]=g},()=>{let w=0;g<16?w=e.chRedir(g,c,!0):w=y.ch;let k=e.#d[s];e.#d[s]=w,(s!==w||w!==k)&&(e.buildRchTree(),console.info(`${f}receives from CH${w+1}`))}][r+u]()}),e.pushChPrimitives(s)):r<19||(r<44?a.subarray(1).forEach((g,u)=>{([()=>{e.#u[s]=+!g},!1,()=>{e.setChType(s,g<<1,v.gs),console.debug(`${f}type: ${g?"drum ":"melodic"}${g||""}`)},()=>{e.#s[o+3]=g,e.#f[y.rpnt*s+2]=1,e.dispatchEvent("pitch",{part:s,pitch:e.getPitchShift(s)})},!1,!1,()=>{e.#e[d+x[7]]=g},!1,!1,()=>{e.setChCc(s,10,g||128)},!1,!1,()=>{console.debug(`${f}CC 1: cc${g}`)},()=>{console.debug(`${f}CC 2: cc${g}`)},()=>{e.#e[d+x[93]]=g},()=>{e.#e[d+x[91]]=g},!1,!1,()=>{e.#s[o+1]=g,e.#f[y.rpnt*s+1]=1,e.dispatchEvent("pitch",{part:s,pitch:e.getPitchShift(s)})},()=>{e.#s[o+2]=g,e.#f[y.rpnt*s+1]=1,e.dispatchEvent("pitch",{part:s,pitch:e.getPitchShift(s)})},()=>{e.#e[d+x[94]]=g}][r+u-19]||(()=>{}))()}):r<76||console.debug(`Unknown GS part address: ${r}`))},b=function(a,s){let c=a[0],r=`GS CH${s+1} `;c<2?a.subarray(1).forEach((d,o)=>{[()=>{e.setChCc(s,32,d)},()=>{}][c+o]()}):c<32?console.warn(`Unknown GS misc address: ${c}`):c<35?a.subarray(1).forEach((d,o)=>{[()=>{console.debug(`${r}EQ: o${["ff","n"][d]}`)},()=>{},()=>{console.debug(`${r}EFX: o${["ff","n"][d]}`),e.setChEffectSink(s,d?3:0)}][c+o-32]()}):console.warn(`Unknown GS misc address: ${c}`)};this.#z.add([66,18,64,16],(a,s)=>{m(a,e.chRedir(9,s,!0),s)}).add([66,18,64,17],(a,s)=>{m(a,e.chRedir(0,s,!0),s)}).add([66,18,64,18],(a,s)=>{m(a,e.chRedir(1,s,!0),s)}).add([66,18,64,19],(a,s)=>{m(a,e.chRedir(2,s,!0),s)}).add([66,18,64,20],(a,s)=>{m(a,e.chRedir(3,s,!0),s)}).add([66,18,64,21],(a,s)=>{m(a,e.chRedir(4,s,!0),s)}).add([66,18,64,22],(a,s)=>{m(a,e.chRedir(5,s,!0),s)}).add([66,18,64,23],(a,s)=>{m(a,e.chRedir(6,s,!0),s)}).add([66,18,64,24],(a,s)=>{m(a,e.chRedir(7,s,!0),s)}).add([66,18,64,25],(a,s)=>{m(a,e.chRedir(8,s,!0),s)}).add([66,18,64,26],(a,s)=>{m(a,e.chRedir(10,s,!0),s)}).add([66,18,64,27],(a,s)=>{m(a,e.chRedir(11,s,!0),s)}).add([66,18,64,28],(a,s)=>{m(a,e.chRedir(12,s,!0),s)}).add([66,18,64,29],(a,s)=>{m(a,e.chRedir(13,s,!0),s)}).add([66,18,64,30],(a,s)=>{m(a,e.chRedir(14,s,!0),s)}).add([66,18,64,31],(a,s)=>{m(a,e.chRedir(15,s,!0),s)}).add([66,18,64,64],(a,s)=>{b(a,e.chRedir(9,s,!0))}).add([66,18,64,65],(a,s)=>{b(a,e.chRedir(0,s,!0))}).add([66,18,64,66],(a,s)=>{b(a,e.chRedir(1,s,!0))}).add([66,18,64,67],(a,s)=>{b(a,e.chRedir(2,s,!0))}).add([66,18,64,68],(a,s)=>{b(a,e.chRedir(3,s,!0))}).add([66,18,64,69],(a,s)=>{b(a,e.chRedir(4,s,!0))}).add([66,18,64,70],(a,s)=>{b(a,e.chRedir(5,s,!0))}).add([66,18,64,71],(a,s)=>{b(a,e.chRedir(6,s,!0))}).add([66,18,64,72],(a,s)=>{b(a,e.chRedir(7,s,!0))}).add([66,18,64,73],(a,s)=>{b(a,e.chRedir(8,s,!0))}).add([66,18,64,74],(a,s)=>{b(a,e.chRedir(10,s,!0))}).add([66,18,64,75],(a,s)=>{b(a,e.chRedir(11,s,!0))}).add([66,18,64,76],(a,s)=>{b(a,e.chRedir(12,s,!0))}).add([66,18,64,77],(a,s)=>{b(a,e.chRedir(13,s,!0))}).add([66,18,64,78],(a,s)=>{b(a,e.chRedir(14,s,!0))}).add([66,18,64,79],(a,s)=>{b(a,e.chRedir(15,s,!0))}),this.#Q.add([54,65],(a,s)=>{let c=e.#r.x5===81?"05rw":"x5d";e.switchMode(c,1),e.setPortMode(e.getTrackPort(s),1,v[c]);let r=a[a.length-1],d=a.subarray(0,a.length-1),o=ee(d);o!==r&&(console.info(`X5D multi parameters checksum mismatch! Expected ${o}, got ${r}.`),console.debug(a));let f=(a[1]<<7)+a[0],g=(a[3]<<7)+a[2],u=e.chRedir(f&15,s,!0),w=R[u];[()=>{g<1||(g<101?(e.setChType(u,e.CH_MELODIC,v.x5d),e.#n[u]=g-1,e.#e[w+x[0]]=e.#r.x5):g<229?(e.setChType(u,e.CH_MELODIC,v.x5d),e.#n[u]=g-101,e.#e[w+x[0]]=56):(e.setChType(u,e.CH_DRUMS,v.x5d),e.#n[u]=ut[g-229]||0,e.#e[w+x[0]]=62)),e.pushChPrimitives(u)},()=>{e.#e[w+x[7]]=g},()=>{g<31&&(e.#e[w+x[10]]=Math.round((g-15)*4.2+64))},()=>{e.#e[w+x[93]]=de(g)},()=>{e.#e[w+x[91]]=de(g)},()=>{e.#s[u*y.rpn+3]=g>8191?g-16320:64+g,e.#f[y.rpnt*u+2]=1,e.dispatchEvent("pitch",{part:u,pitch:e.getPitchShift(u)})},()=>{e.#s[u*y.rpn+1]=g>8191?g-16320:64+g,e.#f[y.rpnt*u+1]=1,e.dispatchEvent("pitch",{part:u,pitch:e.getPitchShift(u)})},()=>{g>0&&(e.#s[u*y.rpn]=g,e.#f[y.rpnt*u]=1,e.dispatchEvent("pitch",{part:u,pitch:e.getPitchShift(u)}))},()=>{}][f>>4]()}).add([54,76,0],(a,s)=>{e.invokeSysExIndicator();let c=e.#r.x5===81?"05rw":"x5d";e.switchMode(c,1),e.setPortMode(e.getTrackPort(s),1,v[c]);let r="",d=e.#r.x5,o=0,f=0,g="MSB	PRG	LSB	NME";G(a,function(u,w){if(w<16400){let k=w%164;switch(!0){case k<10:{u>31&&(r+=String.fromCharCode(u));break}case k===10:break;case k===11:{g+=`
${d}	${o}	${f}	${r.trim().replace("Init Voice","")}`,o++,r="";break}}o>99&&(d=90,o=0)}}),e.userBank.clearRange({msb:e.#r.x5,prg:[0,99],lsb:0}),e.userBank.load(g),T()&&console.debug(g),e.forceVoiceRefresh()}).add([54,77,0],(a,s)=>{e.invokeSysExIndicator();let c=e.#r.x5===81?"05rw":"x5d";e.switchMode(c,1),e.setPortMode(e.getTrackPort(s),1,v[c]);let r="",d=90,o=0,f=0,g="MSB	PRG	LSB	NME";G(a,function(u,w){if(w<13600){let k=w%136;switch(!0){case k<10:{u>31&&(r+=String.fromCharCode(u));break}case k===11:{g+=`
${d}	${o}	${f}	${r.trim().replace("Init Combi","")}`,o++,r="";break}}}}),e.userBank.clearRange({msb:90,prg:[0,99],lsb:0}),e.userBank.load(g),T()&&console.debug(g),e.forceVoiceRefresh()}).add([54,78],(a,s)=>{let c=e.#r.x5===81?"05rw":"x5d";e.switchMode(c,0),e.setPortMode(e.getTrackPort(s),1,v[c]),console.debug(`X5D mode switch requested: ${["combi","combi edit","prog","prog edit","multi","global"][a[0]]} mode.`)}).add([54,85],(a,s)=>{e.invokeSysExIndicator();let c=e.#r.x5===81?"05rw":"x5d";e.switchMode(c,1),e.setPortMode(e.getTrackPort(s),1,v[c]),G(a,(r,d)=>{d>0&&d<3&&(e.setEffectType(d-1,44,r),e.pushEffectType(d-1))})}).add([54,104],(a,s)=>{e.invokeSysExIndicator();let c=e.#r.x5===81?"05rw":"x5d";e.switchMode(c,1);let r=e.getTrackPort(s);if(e.#m[r]&&e.#m[r]!==v[c])if(e.#A.dumpLimit===e.DUMP_MODE){console.warn(`Dump cancelled for track ${s}. Port ${String.fromCharCode(65+r)} mode "${L[e.#m[r]]}" mismatch, should be "${c}".`);return}else console.info(`Track ${s} is trying to perform a mismached mode dump on port ${String.fromCharCode(65+r)}.`);e.setPortMode(r,1,v[c]),G(a,function(d,o,f,g){if(o<192){let u=e.chRedir(Math.floor(o/12),s,!0),w=R[u];switch(o%12){case 0:{d<128?(e.setChType(u,e.CH_MELODIC,v.x5d),e.#e[w+x[0]]=e.#r.x5,e.#n[u]=d):(e.setChType(u,e.CH_DRUMS,v.x5d),e.#e[w+x[0]]=62,e.#n[u]=ut[d-128]),d>0&&e.setChActive(u,1),e.pushChPrimitives(u);break}case 1:{e.#e[w+x[7]]=d;break}case 2:{e.#s[u*y.rpn+3]=d>127?d-192:64+d,e.#f[y.rpnt*u+2]=1,e.dispatchEvent("pitch",{part:u,pitch:e.getPitchShift(u)});break}case 3:{e.#s[u*y.rpn+1]=d>127?d-192:64+d,e.#f[y.rpnt*u+1]=1,e.dispatchEvent("pitch",{part:u,pitch:e.getPitchShift(u)});break}case 4:{d<31&&(e.#e[w+x[10]]=Math.round((d-15)*4.2+64));break}case 5:{let k=d>>4,S=d&15;e.#e[w+x[91]]=de(S),e.#e[w+x[93]]=de(k);break}case 10:{e.#i[u]||(e.#e[w+x[0]]=d>>6?56:e.#r.x5,e.pushChPrimitives(u));break}case 11:{let k=e.chRedir(d&15,s,!0),S=d>>4;e.#d[u]=d,(k!==u||S)&&console.info(`X5D Part CH${u+1} receives from CH${k+1}.`)}}}else{let u=e.chRedir(o-192,s,!0)}}),e.buildRchTree()}),this.#z.add([22,18,127],(a,s,c)=>{e.switchMode("mt32",2),e.setPortMode(e.getTrackPort(s),1,v.mt32),e.#E=e.KARAOKE_NONE,e.userBank.clearRange({msb:0,lsb:127,prg:[0,127]}),console.info("MIDI reset: MT-32")}).add([22,18,0],(a,s,c)=>{e.switchMode("mt32",1);let r=e.chRedir(c,s,!0),d=a[1];a.subarray(2).forEach((o,f)=>{let g=f+d;e.#S[g+(r-1)*16]=o,([!1,()=>{let u=e.#S[r-1<<4];if(u<3){if(e.#N[r]=1,u===2)for(let w=0;w<name.length;w++)e.#V[(r-1)*y.cmt+w]=e.#L[o*y.cmt+w];else{let w=e.baseBank.get(0,o+(u<<6),127,"mt32").name;for(let k=0;k<w.length;k++)e.#V[(r-1)*y.cmt+k]=w.charCodeAt(k)}e.pushChPrimitives(r)}},()=>{e.#s[r*y.rpn+3]=o+40,e.#f[y.rpnt*r+2]=1},()=>{e.#s[r*y.rpn+1]=o+14,e.#f[y.rpnt*r+1]=1},()=>{e.#s[r*y.rpn]=o,e.#f[y.rpnt*r]=1},!1,()=>{e.setChCc(r,91,o?127:0)},!1,()=>{e.setChCc(r,7,o)},()=>{e.setChCc(r,10,Math.ceil(o*9.05))}][g]||(()=>{}))()})}).add([22,18,1],(a,s,c)=>{e.switchMode("mt32",1);let r=c&7;console.debug(`MT-32 slot #${c+1} Drum: ${a}`);let d=a[0]<<7|a[1];a.subarray(2).forEach((o,f)=>{let g=f+d,u=(g>>2)+24,w=g&3,k=r*y.dpn;if(T()&&console.debug(`MT-32 temp drum note ${u} param ${w}: ${o}`),u<24){console.warn(`MT-32 dev drum write attempted on an OOB note: ${u}`);return}[()=>{},()=>{e.#D[(k+X[26])*y.dnc+u]=Math.round(o*1.27)},()=>{e.#D[(k+X[26])*y.dnc+u]=o*9+1&127},()=>{e.#D[(k+X[26])*y.dnc+u]=o?127:0}][w]()})}).add([22,18,2],(a,s,c)=>{e.switchMode("mt32",1);let r=e.chRedir(c,s,!0),d=a[1]+(a[0]<<7);d<10&&(e.#N[r]=1),a.subarray(2).forEach((o,f)=>{let g=f+d;g<14&&(e.#V[(r-1)*y.cmt+g]=o)}),e.pushChPrimitives(r)}).add([22,18,3],(a,s,c)=>{e.switchMode("mt32",1);let r=c&7;if(a[0]){let d=(a[0]-1<<7)+a[1]-16;a.subarray(2).forEach((o,f)=>{let g=f+d,u=(g>>2)+24,w=g&3,k=r*y.dpn;if(T()&&console.debug(`MT-32 dev drum note ${u} param ${w}: ${o}`),u<24){console.warn(`MT-32 dev drum write attempted on an OOB note: ${u}`);return}[()=>{},()=>{e.#D[(k+X[26])*y.dnc+u]=Math.round(o*1.27)},()=>{e.#D[(k+X[26])*y.dnc+u]=o*9+1&127},()=>{e.#D[(k+X[26])*y.dnc+u]=o?127:0}][w]()})}else{let d=a[1];a.subarray(2).forEach((o,f)=>{let g=f+d;e.#S[g]=o;let u=e.chRedir(1+(g>>4),s,!0),w=g&15;([!1,()=>{let k=e.#S[u-1<<4];if(k<3)if(e.#N[u]=1,k===2)for(let S=0;S<name.length;S++)e.#V[(u-1)*y.cmt+S]=e.#L[o*y.cmt+S];else{let S=e.baseBank.get(0,o+(k<<6),127,"mt32").name;for(let M=0;M<S.length;M++)e.#V[(u-1)*y.cmt+M]=S.charCodeAt(M)}e.pushChPrimitives(u)},()=>{e.#s[u*y.rpn+3]=o+40,e.#f[y.rpnt*u+2]=1},()=>{e.#s[u*y.rpn+1]=o+14,e.#f[y.rpnt*u+1]=1},()=>{e.#s[u*y.rpn]=o,e.#f[y.rpnt*u]=1},!1,()=>{e.setChCc(u,91,o?127:0)},!1,()=>{e.setChCc(u,7,o)},()=>{e.setChCc(u,10,Math.ceil(o*9.05))}][w]||(()=>{}))()})}}).add([22,18,4],(a,s,c)=>{e.switchMode("mt32",1);let r=a[1]+(a[0]<<7),d=[];a.subarray(2).forEach((o,f)=>{let g=f+r,u=e.chRedir(Math.floor(g/246+1),s,!0),w=g%246;w<14&&(e.#V[(u-1)*y.cmt+w]=o),w<10&&(e.#N[u]=1),d.indexOf(u)<0&&d.push(u)}),d.forEach(o=>{e.pushChPrimitives(o)})}).add([22,18,5],(a,s,c)=>{e.switchMode("mt32",1);let r=(a[0]<<7)+a[1];a.subarray(2).forEach((d,o)=>{let f=r+o,g=Math.floor(f/8),u=f&7,w=g*8;e.#t[f]=d,([!1,()=>{let k=e.#t[w];if(k<3){let S="";if(k===2){let B=y.cmt*g;S=`MT-m:${d.toString().padStart(3,"0")}`}else S=e.baseBank.get(0,d+(k<<6),127,"mt32").name;e.userBank.clearRange({msb:0,lsb:127,prg:g});let M=`MSB	LSB	PRG	NME
49	127	${g}	${S}`;e.userBank.load(M,!0)}}][u]||(()=>{}))()}),e.forceVoiceRefresh()}).add([22,18,8],(a,s,c)=>{e.switchMode("mt32",1);let r=((a[0]&1)<<7)+a[1],d=a[0]>>1,o=!1;if(a.subarray(2).forEach((f,g)=>{let u=r+g;u<y.cmt&&(e.#L[d*y.cmt+u]=f,o=!0)}),o){e.userBank.clearRange({msb:0,lsb:127,prg:d});let f=`MSB	LSB	PRG	NME
49	127	${d}	MT-m:${d}`;e.userBank.load(f,!0)}e.forceVoiceRefresh()}).add([22,18,16],(a,s,c)=>{e.switchMode("mt32",1);let r=a[1],d=!1,o=function(f,g){e.#d[g-12]=f,d=!0};a.subarray(2).forEach((f,g)=>{let u=g+r;([!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,o,o,o,o,o,o,o,o,o,()=>{e.#p=f,e.dispatchEvent("mastervolume",e.#p)}][u]||(()=>{}))(f,g)}),d&&e.buildRchTree()}).add([22,18,32],(a,s,c)=>{e.switchMode("mt32",1);let r=a[1],d=" ".repeat(r);a.subarray(2).forEach(o=>{o>31?d+=String.fromCharCode(o):d+=" "}),e.#q=d.padStart(20," "),e.#G=e.clockSource.now()+3200}).add([22,18,82],(a,s)=>{let c=e.chRedir(0,s,!0);for(let r=0;r<16;r++)e.#I.ano(c+r),r&&r<10&&(e.#n[c+r]=De[r-1]);console.info("MT-32 alt reset complete.")}),this.#Q.add([66,0],(a,s)=>{e.switchMode("ns5r",1),e.setPortMode(e.getTrackPort(s),2,v.ns5r),e.#E=e.KARAOKE_NONE,console.debug(`NS5R mode switch requested: ${["global","multi","prog edit","comb edit","drum edit","effect edit"][a[0]]} mode.`)}).add([66,1],(a,s)=>{let c=["ns5r","05rw"][a[0]];e.switchMode(c,1),e.setPortMode(e.getTrackPort(s),2,v[c]),e.#E=e.KARAOKE_NONE}).add([66,18,0,0],(a,s)=>{let c=a[0];switch(c){case 124:case 126:case 127:{e.switchMode("ns5r",2),e.setPortMode(e.getTrackPort(s),2,v.ns5r),e.#E=e.KARAOKE_NONE;break}case 125:{e.initDrums(),console.info(`NS5R drum setup reset on drum kit ${a[1]}.`);break}default:if(c<10){let r=[0,0,0,0],d=(o,f)=>{r[f]=o};if(a.subarray(1).forEach((o,f)=>{[d,d,d,d,()=>{e.#p=o*129/16383*100,e.dispatchEvent("mastervolume",e.#p)},()=>o-64,()=>o-64,()=>{},()=>{},()=>{}][c+f]()}),a[0]<4){let o=0;r.forEach(f=>{o=o<<4,o+=f}),o-=1024,console.debug(`Master tune: ${o}`)}}}}).add([66,18,0,1],(a,s)=>{}).add([66,18,0,2],(a,s)=>{}).add([66,18,1],(a,s)=>{e.invokeSysExIndicator();let c=e.chRedir(a[0],s,!0),r=R[c],d=a[1],o=`NS5R CH${c+1} `;a.subarray(2).forEach((f,g)=>{let u=d+g;u<3?([()=>{e.#e[r+x[0]]=f||K.bank0,e.pushChPrimitives(c)},()=>{e.#e[r+x[32]]=f,e.pushChPrimitives(c)},()=>{e.#n[c]=f}][u](),e.pushChPrimitives(c)):u<8||(u<14?[()=>{let w=e.chRedir(f,s,!0),k=e.#d[c];e.#d[c]=w,(c!==w||w!==k)&&(e.buildRchTree(),console.info(`${o}receives from CH${w+1}`))},()=>{e.#u[c]=+!f},()=>{e.setChType(c,f,v.ns5r),console.debug(`${o}type: ${ce[f]}`)},()=>{e.#s[y.rpn*c+3]=f,e.#f[y.rpnt*c+2]=1,e.dispatchEvent("pitch",{part:c,pitch:e.getPitchShift(c)})},()=>{},()=>{}][u-8]():u<16||(u<33?[()=>{e.#e[r+x[7]]=f},()=>{e.#e[r+x[11]]=f},()=>{},()=>{},()=>{e.#e[r+x[10]]=f||128},()=>{},()=>{},()=>{e.#e[r+x[93]]=f},()=>{e.#e[r+x[91]]=f},()=>{e.#e[r+x[76]]=f},()=>{e.#e[r+x[77]]=f},()=>{e.#e[r+x[78]]=f},()=>{e.#e[r+x[74]]=f},()=>{e.#e[r+x[71]]=f},()=>{e.#e[r+x[73]]=f},()=>{e.#e[r+x[75]]=f},()=>{e.#e[r+x[72]]=f}][u-16]():u<112||u<114&&[()=>{e.#e[r+x[5]]=f},()=>{e.#e[r+x[65]]=f}][u-112]()))})}).add([66,18,8,0],(a,s)=>{let c=a[0];if(c<32)e.setLetterDisplay(a.subarray(1,33),"NS5R letter display");else{let r=c-32;e.#C=e.clockSource.now()+3200,e.#h=10;let d=a.subarray(1),o=4;d.forEach(function(f,g){let u=g+r,w=u>>4,k=u&15;if(u<80){let S=w<o?f:f>>3,M=0,B=w<o?6:3;for(;S>0;)e.#k[k*32+w*7+(B-M)]=S&1,S=S>>1,M++}})}}).add([66,18,48],(a,s,c)=>{h(0,a)}).add([66,18,49],(a,s,c)=>{h(1,a)}).add([66,18,50],(a,s,c)=>{h(2,a)}).add([66,18,51],(a,s,c)=>{h(3,a)}).add([66,18,52],(a,s,c)=>{h(4,a)}).add([66,18,53],(a,s,c)=>{h(5,a)}).add([66,18,54],(a,s,c)=>{h(6,a)}).add([66,18,55],(a,s,c)=>{h(7,a)}).add([66,52],(a,s)=>{e.switchMode("ns5r",1),e.#E=e.KARAOKE_NONE;let c="";G(a,(r,d)=>{d<8?(r>31&&(c+=String.fromCharCode(r)),d===7&&(e.aiEfxName=c)):d<10&&(e.setEffectType(d-8,44,r),e.pushEffectType(d-8))})}).add([66,53],(a,s)=>{e.invokeSysExIndicator(),e.switchMode("ns5r",1),e.#E=e.KARAOKE_NONE;let c="",r=a[a.length-1],d=a.subarray(0,a.length-1),o=ee(d);o!==r&&(console.info(`NS5R current multi dump checksum mismatch! Expected ${o}, got ${r}.`),console.debug(a));let f=e.getTrackPort(s);if(e.#m[f]&&e.#m[f]!==v.ns5r)if(e.#A.dumpLimit===e.DUMP_MODE){console.warn(`Dump cancelled for track ${s}. Port ${String.fromCharCode(65+f)} mode "${L[e.#m[f]]}" mismatch, should be "ns5r".`);return}else console.info(`Track ${s} is trying to perform a mismached mode dump on port ${String.fromCharCode(65+f)}.`);e.setPortMode(f,2,v.ns5r),G(d,function(g,u){switch(!0){case u<2944:{let w=e.chRedir(Math.floor(u/92),s,!0),k=R[w];switch(u%92){case 0:{e.#e[k+x[0]]=g,e.pushChPrimitives(w),e.pushChPrimitives(w);break}case 1:{e.#e[k+x[32]]=g,!g&&!e.#e[k+x[0]]&&(e.#e[k+x[0]]=K.bank0),e.pushChPrimitives(w);break}case 2:{e.#n[w]=g,g>0&&e.setChActive(w,1);break}case 3:{let S=e.chRedir(g,s,!0);e.#d[w]=S,w!==S&&console.info(`NS5R CH${w+1} receives from CH${S+1}.`);break}case 7:{e.#i[w]=g,e.pushChPrimitives(w);break}case 8:{e.#s[w*y.rpn+3]=g<40||g>88?g+(g>63?-192:64):g,e.#f[y.rpnt*w+2]=1,e.dispatchEvent("pitch",{part:w,pitch:e.getPitchShift(w)});break}case 9:case 10:{e.#e[k+x[7]]=g;break}case 11:{e.#e[k+x[11]]=g;break}case 14:{e.#e[k+x[10]]=g||128;break}case 19:{e.#e[k+x[93]]=g;break}case 20:{e.#e[k+x[91]]=g;break}case 84:{e.#e[k+x[65]]=g;break}case 85:{e.#e[k+x[5]]=g;break}}break}case u<3096:break;case u<3134:{let w=u-3096;w<8?(g>31&&(c+=String.fromCharCode(g)),w===7&&(e.aiEfxName=c)):w<10&&(e.setEffectType(w-8,44,g),e.pushEffectType(w-8));break}case u<8566:break}}),e.buildRchTree()}).add([66,54],(a,s)=>{e.invokeSysExIndicator(),e.switchMode("ns5r",1);let c="",r=80,d=0,o=0,f="MSB	PRG	LSB	NME";G(a,function(g,u){let w=u%158;switch(!0){case w<10:{g>31&&(c+=String.fromCharCode(g));break}case w===10:break;case w===11:{r=g&127;break}case w===12:{o=g&127;break}case w===13:{f+=`
${r}	${d}	${o}	${c.trim().replace("Init Voice","")}`,d++,c="";break}}}),e.userBank.clearRange({msb:80,lsb:0}),e.userBank.load(f),T()&&console.debug(f),e.forceVoiceRefresh()}).add([66,55],(a,s)=>{e.invokeSysExIndicator(),e.switchMode("ns5r",1);let c="",r=88,d=0,o=0,f="MSB	PRG	LSB	NME";G(a,function(g,u){let w=u%126;switch(!0){case w<10:{g>31&&(c+=String.fromCharCode(g));break}case w===11:break;case w===12:break;case w===13:{f+=`
${r}	${d}	${o}	${c.trim().replace("Init Combi","")}`,d++,c="";break}}}),e.userBank.clearRange({msb:88,lsb:0}),e.userBank.load(f),T()&&console.debug(f),e.forceVoiceRefresh()}).add([66,125],(a,s,c)=>{e.dispatchEvent("backlight",["green","orange","red",!1,"yellow","blue","purple"][a[0]]||"white")}).add([66,127],(a,s,c)=>{let r=a[a.length-1],d=a.subarray(0,a.length-1),o=ee(d);o!==r&&(console.info(`NS5R screen dump checksum mismatch! Expected ${o}, got ${r}.`),console.debug(a));let f=new Uint8Array(5760);G(a,(g,u,w)=>{if(u<720)for(let k=0;k<8;k++)f[u*8+k]=g>>7-k&1}),e.dispatchEvent("screen",{type:"ns5r",data:f})}).add([76],(a,s,c)=>{e.#Q.run([66,...a],s,c)}),e.#de.add([16,0,8,0],(a,s,c)=>{let r=(a[2]<<4)+a[3],d="K11 ";([()=>{e.switchMode("k11",2),e.setPortMode(e.getTrackPort(s),2,v.k11),e.#E=e.KARAOKE_NONE,e.#l[v.k11][1]=r?4:0,console.info("MIDI reset: GMega/K11")},()=>{e.setEffectType(0,24,r),console.debug(`${d}reverb type: ${r}`),e.pushEffectType(0)},()=>{console.debug(`${d}reverb time: ${r}`)},()=>{console.debug(`${d}reverb time: ${r}`)},()=>{console.debug(`${d}reverb predelay: ${r}`)},()=>{console.debug(`${d}reverb predelay: ${r}`)},()=>{console.debug(`${d}depth high: ${r}`)},()=>{console.debug(`${d}depth high: ${r}`)},()=>{console.debug(`${d}depth low: ${r}`)},()=>{console.debug(`${d}depth low: ${r}`)}][a[0]]||(()=>{}))()}).add([16,0,8,1],(a,s,c)=>{e.invokeSysExIndicator();let r=e.chRedir(a[1],s,!0),d=R[r],o=re[r],f=(a[3]<<4)+a[4],g=`GMega CH${r+1} `;([()=>{f<128?(e.setChType(r,e.CH_MELODIC,v.k11),e.#e[d+x[0]]=0,e.#n[r]=f):(e.setChType(r,e.CH_DRUMS,v.k11),e.#n[r]=f-128),e.pushChPrimitives(r)},()=>{let u=e.chRedir(f,s,!0),w=e.#d[r];e.#d[r]=u,(r!==u||u!==w)&&(e.buildRchTree(),console.info(`${g}receives from CH${u+1}`))},()=>{e.#e[d+x[7]]=f},()=>{uupThis.setChActive(r,f)},()=>{e.#e[d+x[10]]=f},()=>{e.#s[o+3]=f+40,e.#f[y.rpnt*r+2]=1,e.dispatchEvent("pitch",{part:r,pitch:e.getPitchShift(r)})},()=>{e.#s[o+1]=f>>1,e.#s[o+2]=f&1,e.#f[y.rpnt*r+1]=1,e.dispatchEvent("pitch",{part:r,pitch:e.getPitchShift(r)})},()=>{e.#e[d+x[91]]=f?127:0},()=>{},()=>{e.#e[d+x[74]]=f},()=>{e.#e[d+x[73]]=f},()=>{e.#e[d+x[72]]=f}][a[0]]||(()=>{}))()}).add([16,0,9,0],(a,s,c)=>{e.invokeSysExIndicator();let r=(a[2]<<4)+a[3],d="GMLX ";([()=>{console.debug(`${d}reverb type: ${r}`)},()=>{console.debug(`${d}reverb time: ${r}`)},()=>{console.debug(`${d}reverb predelay: ${r}`)},()=>{console.debug(`${d}depth high: ${r}`)},()=>{console.debug(`${d}depth low: ${r}`)}][a[0]]||(()=>{}))()}).add([16,0,9,3],(a,s,c)=>{e.invokeSysExIndicator();let r=(a[2]<<4)+a[3],d=e.chRedir(a[1],s,!0),o=R[d],f=`GMLX CH${d+1} `;[()=>{r<128?(e.setChType(d,e.CH_MELODIC,v.k11),e.#e[o+x[0]]=0,e.#e[o+x[32]]=0,e.#n[d]=r):r<160?(e.setChType(d,e.CH_MELODIC,v.k11),e.#e[o+x[0]]=0,e.#e[o+x[32]]=7,e.#n[d]=r-100):(e.setChType(d,e.CH_DRUMS,v.k11),e.#e[o+x[0]]=122,e.#e[o+x[32]]=0,e.#n[d]=r-160),e.pushChPrimitives(d)},()=>{let g=e.chRedir(r,s,!0),u=e.#d[d];e.#d[d]=g,(d!==g||g!==u)&&(e.buildRchTree(),console.info(`${f}receives from CH${g+1}`))}][a[0]]()}).add([16,0,9,4],(a,s,c)=>{e.invokeSysExIndicator();let r=(a[2]<<4)+a[3],d=e.chRedir(a[1],s,!0),o=R[d],f=re[d];[()=>{e.setChActive(d,r)},()=>{e.#e[o+x[7]]=r},()=>{e.#e[o+x[10]]=r},()=>{e.#e[o+x[91]]=r?127:0},()=>{e.#s[f+3]=r+40,e.#f[y.rpnt*d+2]=1,e.dispatchEvent("pitch",{part:d,pitch:e.getPitchShift(d)})},()=>{e.#s[f+1]=r,e.#f[y.rpnt*d+1]=1,e.dispatchEvent("pitch",{part:d,pitch:e.getPitchShift(d)})},()=>{e.#s[f]=r,e.#f[y.rpnt*d]=1,e.dispatchEvent("pitch",{part:d,pitch:e.getPitchShift(d)})},()=>{}][a[0]]()}),this.#fe.add([66,93,64],(a,s,c)=>{let r=a[2];switch(a[0]){case 0:{switch(a[1]){case 4:{e.invokeSysExIndicator(),e.#p=r*129/16383*100,e.dispatchEvent("mastervolume",e.#p);break}case 5:{e.invokeSysExIndicator(),r-64;break}case 6:{e.invokeSysExIndicator(),console.debug(`SG global reverb: ${r?"on":"off"}`);break}case 127:{e.switchMode("sg",2),e.setPortMode(e.getTrackPort(s),1,v.sg);break}}break}case 1:{switch(a[1]){case 48:{e.invokeSysExIndicator(),console.debug(`SG reverb type: ${Le[r]}`);break}}break}default:if(a[0]>>4===1){e.invokeSysExIndicator();let d=e.chRedir(a[0]&15,s,!0);if(a[1]===2){let o=e.chRedir(r,s,!0),f=e.#d[d];e.#d[d]=o,(d!==o||o!==f)&&(e.buildRchTree(),console.info(`SG CH${d+1} receives from CH${o+1}`))}else a[1]===19&&e.setChCc(d,7,r)}else console.warn(`Unknown AKAI SG SysEx: ${a}`)}}),this.#he.add([9],(a,s,c)=>{e.invokeSysExIndicator(),console.debug(`GZ set effect: ${["stage reverb","hall reverb","room reverb","chorus","tremolo","phaser","rotary speaker","enhancer","flanger","EQ"][a[0]]||"off"}`)}),this.#U.add([127,0],(a,s,c)=>{e.switchMode("motif",1);let r=new Uint8Array([127,1,...a]);e.#U.run(r,s,c)}).add([127,1,0,0],(a,s,c)=>{e.switchMode("s90es");let r="S90/Motif ES system ",d=a[0];a.subarray(1).forEach((o,f)=>{([()=>{e.#p=o*12900/16383,e.dispatchEvent("mastervolume",e.#p)}][d+f]||(()=>{console.info(`Unrecognized ${r}ID: ${d+f}`)}))()})}).add([127,1,14],(a,s,c)=>{e.switchMode("s90es");let r="S90/Motif ES bulk header ",d=[];d[95]=(o,f,g)=>{console.debug(`${r}multi edit buffer: ${o[1]}`)},(d[a[0]]||(()=>{console.info(`Unrecognized ${r}ID: ${a[0]}.`)}))(a.subarray(1))}).add([127,1,15],(a,s,c)=>{e.switchMode("s90es");let r="S90/Motif ES bulk footer ",d=[];d[95]=(o,f,g)=>{console.debug(`${r}multi edit buffer: ${o[1]}`)},(d[a[0]]||(()=>{console.info(`Unrecognized ${r}ID: ${a[0]}.`)}))(a.subarray(1))}).add([127,1,54,1],(a,s,c)=>{e.switchMode("s90es");let r="S90/Motif ES reverb ",d=a[0];a.subarray(1).forEach((o,f)=>{([()=>{e.setEffectTypeRaw(0,!1,o&15|128)},()=>{e.setEffectTypeRaw(0,!0,o)}][d+f]||(()=>{}))()}),e.pushEffectType(0)}).add([127,1,54,2],(a,s,c)=>{e.switchMode("s90es");let r="S90/Motif ES chorus ",d=a[0];a.subarray(1).forEach((o,f)=>{([()=>{e.setEffectTypeRaw(1,!1,o&15|128)},()=>{e.setEffectTypeRaw(1,!0,o)}][d+f]||(()=>{}))()}),e.pushEffectType(1)}).add([127,1,54,3],(a,s,c)=>{e.switchMode("s90es");let r="S90/Motif ES insert 1 ",d=a[0];a.subarray(1).forEach((o,f)=>{([()=>{e.setEffectTypeRaw(3,!1,o&15|128)},()=>{e.setEffectTypeRaw(3,!0,o)}][d+f]||(()=>{}))()}),e.pushEffectType(3)}).add([127,1,54,4],(a,s,c)=>{e.switchMode("s90es");let r="S90/Motif ES insert 2 ",d=a[0];a.subarray(1).forEach((o,f)=>{([()=>{e.setEffectTypeRaw(4,!1,o&15|128)},()=>{e.setEffectTypeRaw(4,!0,o)}][d+f]||(()=>{}))()}),e.pushEffectType(4)}).add([127,1,54,16],(a,s,c)=>{e.switchMode("s90es");let r=a[0];a.subarray(1).forEach((d,o)=>{let g=`S90/Motif ES EQ${(o>>2)+1} `;([()=>{let u=d-64},()=>{let u=ae[d]},()=>{let u=d/10},()=>{let u=d}][r+o&3]||(()=>{}))()})}).add([127,1,54,17],(a,s,c)=>{e.switchMode("s90es");let r="S90/Motif ES variation ",d=a[0];a.subarray(1).forEach((o,f)=>{([()=>{e.setEffectTypeRaw(2,!1,o&15|128)},()=>{e.setEffectTypeRaw(2,!0,o)}][d+f]||(()=>{}))()}),e.pushEffectType(2)}).add([127,1,55],(a,s,c)=>{e.invokeSysExIndicator(),e.switchMode("s90es");let r=e.getTrackPort(s);if(e.#m[r]&&e.#m[r]!==e.#r.smotif)if(e.#A.dumpLimit===e.DUMP_MODE){console.warn(`Dump cancelled for track ${s}. Port ${String.fromCharCode(65+r)} mode "${L[e.#m[r]]}" mismatch, should be "${L[e.#r.smotif]}".`);return}else console.info(`Track ${s} is trying to perform a mismached mode dump on port ${String.fromCharCode(65+r)}.`);let d=e.chRedir(a[0],s,!0),o=R[d],f=a[1];a[0]>15&&(d=a[0]+32);let g=`Track ${s} S90/Motif ES bulk CH${d<128?d+1:"U"+(d-127)} `;console.debug(g,a),!(a[0]>15)&&a.subarray(2).forEach((u,w)=>{([()=>{e.setChCc(d,0,u),e.pushChPrimitives(d)},()=>{u&&e.setChActive(d,1),e.setChCc(d,32,u),e.getChPrimitive(d,1)===63&&e.setChType(d,[32,40].indexOf(u)>-1?e.CH_DRUMS:e.CH_MELODIC,e.#a,!0),e.pushChPrimitives(d)},()=>{u&&e.setChActive(d,1),e.#n[d]=u,e.pushChPrimitives(d)},()=>{let k=e.chRedir(u,s,!0),S=e.#d[d];e.#d[d]=k,(d!==k||k!==S)&&(e.buildRchTree(),console.info(`${g}receives from CH${k+1}`))},()=>{e.#u[d]=u?0:1},!1,!1,!1,!1,!1,!1,!1,!1,()=>{u!==100&&e.setChActive(d,1),e.#e[o+x[7]]=u},()=>{u!==64&&e.setChActive(d,1),e.#e[o+x[10]]=u},!1,!1,!1,()=>{e.#e[o+x[91]]=u},()=>{u&&e.setChActive(d,1),e.#e[o+x[93]]=u},()=>{u&&e.setChActive(d,1),e.#e[o+x[94]]=u},()=>{e.setChCc(d,128,u),u!==127&&(e.setChActive(d,1),e.allocateAce(d,128))},()=>{},()=>{u!==64&&e.setChActive(d,1),e.#e[o+x[74]]=u},()=>{u!==64&&e.setChActive(d,1),e.#e[o+x[71]]=u},!1,()=>{e.#e[o+x[65]]=u},()=>{e.#e[o+x[5]]=u},()=>{}][f+w]||(()=>{}))()})}),e.#U.add([100,14],(a,s,c)=>{e.switchMode("cs6x"),e.setPortMode(e.getTrackPort(s),1,v.cs6x);let r=["normal voice","plugin voice PLG","drums",,"performance",,"phrase clip"][a[0]>>4]??"invalid";a[0]&!0?r+=" edit buffer":a[0]>>4==1?r+=`${(a[0]&1)+1}`:r+=` ${["INT","EXT"][a[0]&1]}`,console.debug(`CS6x bulk dump for ${r} started.`)}).add([100,15],(a,s,c)=>{e.switchMode("cs6x");let r=["normal voice","plugin voice PLG","drums",,"performance",,"phrase clip"][a[0]>>4]??"invalid";a[0]&!0?r+=" edit buffer":a[0]>>4==1?r+=`${(a[0]&1)+1}`:r+=` ${["INT","EXT"][a[0]&1]}`,console.debug(`CS6x bulk dump for ${r} ended.`)}).add([100,76,112],(a,s,c)=>{e.switchMode("cs6x");let r=0,d=a[0];a.subarray(1).forEach((o,f)=>{let g=f+d;g<10?(e.setChCvnRegister(r,f,o&127),e.#N[r]=1):g<12||g<13&&console.debug(`Plugin voice type: ${o}`)}),e.pushChPrimitives(r)}).add([100,76,0],(a,s,c)=>{e.switchMode("cs6x"),e.setPortMode(e.getTrackPort(s),1,v.cs6x);let r=0,d=a[0];a.subarray(1).forEach((o,f)=>{let g=f+d;([()=>{e.setChCc(r,7,o),o!==100&&e.setChActive(r,1)},,,()=>{e.#u[r]=o==0,e.setChCc(r,64,0),e.#I.ano(r),e.resetChAceAll(r)},,()=>{},,,()=>{e.setChCc(r,65,o?127:0)},()=>{e.setChCc(r,5,o)},,()=>{e.setChCc(r,91,o),o!==40&&e.setChActive(r,1)},()=>{e.setChCc(r,93,o),o&&e.setChActive(r,1)}][g]||(()=>{}))()})}).add([100,76,1],(a,s,c)=>{e.switchMode("cs6x");let r=0,d=a[0],o=!1;a.subarray(1).forEach((f,g)=>{let u=g+d;([()=>{e.setEffectTypeRaw(0,!1,f&15|128),o=!0},()=>{e.setEffectTypeRaw(0,!0,f),o=!0}][u]||(()=>{}))()}),o&&e.pushEffectType(0)}).add([100,76,2],(a,s,c)=>{e.switchMode("cs6x");let r=0,d=a[0],o=!1;a.subarray(1).forEach((f,g)=>{let u=g+d;([()=>{e.setEffectTypeRaw(1,!1,f&15|128),o=!0},()=>{e.setEffectTypeRaw(1,!0,f),o=!0}][u]||(()=>{}))()}),o&&e.pushEffectType(1)}).add([100,76,3],(a,s,c)=>{e.switchMode("cs6x");let r=0,d=a[0],o=!1;a.subarray(1).forEach((f,g)=>{let u=g+d;([()=>{e.setEffectTypeRaw(2,!1,f&15|128),o=!0},()=>{e.setEffectTypeRaw(2,!0,f),o=!0}][u]||(()=>{}))()}),o&&e.pushEffectType(2)}).add([100,76,5],(a,s,c)=>{e.switchMode("cs6x")}).add([100,76,16],(a,s,c)=>{e.switchMode("cs6x");let r=0,d=a[0],o=!1;if(a.subarray(1).forEach((f,g)=>{let u=g+d;([()=>{e.setChCc(r,0,f),o=!0},()=>{e.setChCc(r,32,f),o=!0,f&&e.setChActive(r,1)},()=>{e.#n[r]=f,o=!0,f&&e.setChActive(r,1)},()=>{e.#f[re[r]+Ee[2]]=1,e.#s[re[r]+Ee[2]]=f,f&&e.setChActive(r,1)}][u]||(()=>{}))()}),o){switch(e.pushChPrimitives(r),e.getChVoice(r).standard){case"DX":{e.#y[r]=e.EXT_DX;break}case"VL":{e.#y[r]=e.EXT_VL;break}}e.dispatchEvent("metacommit",{type:"OSysMeta",msg:"part.rename",data:{part:r}})}}).add([100,76,32],(a,s,c)=>{e.switchMode("cs6x");let r=0,d=a[0],o=e.#y[r];switch(o){case e.EXT_DX:{a.length>2&&console.debug(a),a.subarray(1).forEach((f,g)=>{let u=g+d;if(u<6){let w=u+142;e.setChCc(r,w,f),f!==64&&e.allocateAce(r,w)}else if(u<12){let w=u+144;e.setChCc(r,w,f),f!==64&&e.allocateAce(r,w)}else([()=>{},()=>{},()=>{},()=>{}][u]||(()=>{}))()});break}case e.EXT_VL:{console.info(`Support for Modular System Plug-in writes is not yet present for plugin type ${o}.`);break}default:console.warn(`Unsupported plug-in type: ${o}`)}}),this.#z.add([0,72,18,0,0,0,0],(a,s,c)=>{e.switchMode("sd",2),e.setPortMode(e.getTrackPort(s),2,v.sd),console.info("MIDI reset: SD")}).add([0,72,18,16,0],(a,s,c)=>{e.invokeSysExIndicator();let r=a[0]>>5,d=a[0]&31;switch(r){case 0:{let o=a[0]>>1,f=a[1];switch(o){case 1:{a.subarray(2).forEach((g,u,w)=>{let k=u+f;switch(k){case 0:{g&&(e.setEffectType(1,60,g-1),e.pushEffectType(1),console.debug(`SD MFX Cho: ${k} - ${g}`));break}}});break}case 2:{a.subarray(2).forEach((g,u)=>{let w=u+f;switch(w){case 0:{g&&(e.setEffectType(0,55+g,0),e.pushEffectType(0),console.debug(`SD MFX Rev: ${w} - ${g}`));break}}});break}case 3:case 4:case 5:{let g=o-1;a.subarray(2).forEach((u,w)=>{let k=w+f;switch(console.debug(`SD MFX ${g-2}: ${k} - ${u}`),k){case 0:{e.setEffectTypeRaw(g,62,u),e.pushEffectType(g);break}}}),console.debug(`SD MFX message:
%o`,a);break}default:console.debug(`Unknown SD-90 global effects message:
%o`,a)}break}case 1:{let o=e.chRedir(d,s,!0),f=a[1],g=R[o];a.subarray(2).forEach((u,w)=>{let k=f+w;k<37?([()=>{},()=>{},0,()=>{},()=>{switch(u){case 104:case 105:case 106:case 107:case 120:case 128:{e.#i[o]||e.setChType(o,e.CH_DRUMS);break}default:e.#i[o]&&e.setChType(o,e.CH_MELODIC)}e.setChCc(o,0,u),e.pushChPrimitives(o)},()=>{e.setChCc(o,32,u),e.pushChPrimitives(o)},()=>{e.#n[o]=u},()=>{e.#e[g+x[7]]=u},()=>{e.#e[g+x[10]]=u},()=>{},()=>{},()=>{u<2&&(e.#u[o]=u)},()=>{u<2&&(e.#e[g+x[68]]=u?127:0)},()=>{},()=>{u<2&&(e.#e[g+x[65]]=u?127:0)},()=>{e.#e[g+x[5]]=u&15<<4|e.#e[g+x[5]]&15},()=>{e.#e[g+x[5]]=u&15|(e.#e[g+x[5]]&240)>>4},()=>{e.#e[g+x[74]]=u},()=>{e.#e[g+x[71]]=u},()=>{e.#e[g+x[73]]=u},()=>{e.#e[g+x[72]]=u},0,0,0,0,0,0,0,()=>{e.#e[g+x[128]]=u,e.allocateAce(128)},()=>{e.#e[g+x[93]]=u},()=>{e.#e[g+x[91]]=u},0,0,()=>{e.#e[g+x[75]]=u},()=>{e.#e[g+x[76]]=u},()=>{e.#e[g+x[77]]=u},()=>{e.#e[g+x[78]]=u}][k]||(()=>{}))():k<63||(k<64?(e.#i[o]?(e.setChCc(o,0,104|u),e.pushChPrimitives(o)):(e.setChCc(o,0,96|u),e.pushChPrimitives(o)),e.pushChPrimitives(o)):console.debug(`Unknown SD-90 global CH${o+1} param setup message:
%o`,a))});break}case 2:{let o=e.chRedir(d,s,!0),f=a[1];console.debug(`Unknown SD-90 global CH${o+1} MIDI setup message:
%o`,a.subarray(2));break}default:console.warn(`Unknown SD-90 global part setup message:
%o`,a)}}),e.#Q.add([0,1,73,78],(a,s,c)=>{e.switchMode("krs",1),e.setPortMode(e.getTrackPort(s),1,v.krs),console.debug("Might be KORG KROSS 2 mode reset... Not sure.")}).add([0,1,73,117,2,37],(a,s,c)=>{e.switchMode("krs",1);let r=e.getTrackPort(s);if(e.#m[r]&&e.#m[r]!==v.krs)if(e.#A.dumpLimit===e.DUMP_MODE){console.warn(`Dump cancelled. Port ${String.fromCharCode(65+r)} mode "${L[e.#m[r]]}" mismatch, should be "krs".`);return}else console.info(`Track ${s} is trying to perform a mismached mode dump on port ${String.fromCharCode(65+r)}.`);e.setPortMode(e.getTrackPort(s),1,v.krs);let d="KROSS 2 BMT1 ",o="";G(a,(f,g)=>{if(g<24)o+=String.fromCharCode(Math.max(32,f));else if(!(g<88)){if(g<468){let u=g-88,w=u*863>>16,k=u-w*76;([()=>{e.setEffectType(w+3,45,f),e.pushEffectType(w+3)},!1,()=>{console.debug(`${d}IFX${w+1} sends to ${f<=5&&f>0?`IFX${f}`:"direct out"}.`)}][k]||(()=>{}))()}else if(g<604){let u=g-468,w=u*964>>16,k=u-w*68;([()=>{e.setEffectType(1-w,45,f),e.dispatchEvent(["efxreverb","efxchorus"][1-w],{id:e.getEffectType(1-w)})},!1][k]||(()=>{}))()}else if(!(g<1276)){let u=g-1276,w=u*1490>>16,k=e.chRedir(w,s,!0),S=u-w*44;S<22?([()=>{f&&e.setChActive(k,1),e.#n[k]=f,e.pushChPrimitives(k)},()=>{f&&e.setChActive(k,1),f<10?(e.setChCc(k,0,63),e.setChCc(k,32,f)):f<20?(e.setChCc(k,0,121),e.setChCc(k,32,f-10)):f<24&&(e.setChCc(k,0,[120,0,56,62][f-20]),e.setChCc(k,32,0)),e.pushChPrimitives(k)},()=>{let M=e.chRedir(f&15,s,!0);e.#d[k]=M,M!==k&&console.info(`${d}CH${k+1} receives from CH${M+1}`);let B=f>>5&1;e.modelEx.kross.chToggle&&(e.setChActive(k,B),B||console.debug(`KORG KROSS 2 CH${k+1} is disabled.`))},!1,!1,()=>{e.setChCc(k,7,f)},!1,()=>{},()=>{},!1,!1,!1,!1,!1,()=>{e.setChCc(k,10,f||128)}][S]||(()=>{}))():S<36?([()=>{let M=f&7;f&8&&(M=1),M>1&&console.debug(`${d}CH${k+1} sends to ${M>1?`IFX${M-1}`:"direct out"} (${f.toString(16)}).`),e.setChEffectSink(k,f>1&&f<7?f+1:0)}][S-22]||(()=>{}))():([()=>{e.setChCc(k,74,(f+128&255)-64)},()=>{e.setChCc(k,71,(f+128&255)-64)},!1,!1,()=>{e.setChCc(k,73,(f+128&255)-64)},()=>{e.setChCc(k,75,(f+128&255)-64)},!1,()=>{e.setChCc(k,72,(f+128&255)-64)}][S-36]||(()=>{}))()}}}),o=o.trimEnd(),e.dispatchEvent("metacommit",{type:"EORTitle",data:o})});let E=function(a,s,c){let r=e.chRedir(a,s,!0);e.setChMode(r,v.an1x),e.pushChPrimitives(r),console.debug(`Yamaha AN1x slot ${c+1} receives from CH${r+1}(${a+1}).`),e.modelEx.yPlg[3][c]=r};e.#U.add([92,0,0],(a,s,c)=>{let r=a[0];a.subarray(1).forEach((d,o)=>{let f=o+r;f<2||([!1,!1,!1,!1,!1,!1,()=>{E(d,s,0)},()=>{E(d,s,1)}][f-2]||(()=>{}))()})}),e.#U.add([75,80,0],(a,s,c)=>{let r=a[0];a.subarray(1).forEach((d,o)=>{let f=o+r;([()=>{e.modelEx.cs1x.perfCh=d,e.pushChPrimitives(d),console.debug(`Yamaha CS1x performance on CH${d+1}.`)},!1,!1,!1,()=>{},!1,()=>{switch(d){case 1:{e.switchMode("xg",2),e.setPortMode(e.getTrackPort(s),1,v.xg),console.debug("Yamaha CS1x set to XG mode.");break}case 3:{e.switchMode("cs1x",2),e.setPortMode(e.getTrackPort(s),1,v.cs1x),console.debug("Yamaha CS1x set to performance mode.");break}default:console.warn(`Unknown Yamaha CS1x mode: ${d}`)}},()=>{}][f]||(()=>{}))()})}).add([75,96,0],(a,s,c)=>{let r=a[0],d=!1,o=e.modelEx.cs1x.perfCh;a.subarray(1).forEach((f,g)=>{let u=g+r;u<8?(d=!0,e.#N[o]=1,e.setChCvnRegister(o,u,f)):u<48?([!1,()=>{e.setChCc(o,7,f)}][u]||(()=>{}))():u<80?([()=>{e.setEffectTypeRaw(0,!1,f)},()=>{e.setEffectTypeRaw(0,!0,f),e.pushEffectType(0)},()=>{e.setEffectTypeRaw(1,!1,f)},()=>{e.setEffectTypeRaw(1,!0,f),e.pushEffectType(1)},()=>{e.setEffectTypeRaw(2,!1,f)},()=>{e.setEffectTypeRaw(2,!0,f),e.pushEffectType(2)}][u-48]||(()=>{}))():T()&&console.debug(`Unknown CS1x effect register: ${u}.`)}),d&&(e.setChActive(o,1),e.pushChPrimitives(o))});let C=(a,s,c)=>{let r=0;c.forEach((d,o)=>{([()=>{r=(d&1)<<7|r&127,e.setEffectTypeRaw(a,!1,28),e.setEffectTypeRaw(a,!0,r)},()=>{r=r&128|d&127,e.setEffectTypeRaw(a,!1,28),e.setEffectTypeRaw(a,!0,r),e.pushEffectType(a)}][o+s]||(()=>{}))()})};e.#Q.add([96,0,1],(a,s,c)=>{let r=a[0];switch(a[1]){case 0:{C(0,a[2],a.subarray(3)),console.debug(`Partially parsed KORG PA EFX SysEX:
`,a);break}case 1:{C(1,a[2],a.subarray(3)),console.debug(`Partially parsed KORG PA EFX SysEX:
`,a);break}case 2:{C(2,a[2],a.subarray(3)),console.debug(`Partially parsed KORG PA EFX SysEX:
`,a);break}case 3:{C(3,a[2],a.subarray(3)),console.debug(`Partially parsed KORG PA EFX SysEX:
`,a);break}default:console.debug(`Unparsed KORG PA SysEX:
`,a)}})}};var He=Vt(mt(),1);var bt=class{#a=!1;constructor(n,e,t,i){this.#a=n,this.start=e,this.end=t,this.data=i}get duration(){return this.ranged?this.end-this.start:0}get ranged(){return this.#a}},Ne=class extends bt{constructor(n,e,t){super(!0,n,e,t)}},yt=class extends bt{constructor(n,e){super(!1,n,n,e)}},Ve=class extends Array{#a=-1;constructor(){super(...arguments)}resetIndex(n){this.#a=-1}fresh(){this.sort(function(n,e){return n.start==e.start?0:(+(n.start>e.start)<<1)-1}),this.forEach(function(n,e){n.index=e})}step(n,e=!1){let t=[];if(e)for(let i=0;i<this.length&&!(this[i].start>n);i++){if(this[i].end<n)continue;t.push(this[i])}else{let i=this.getRange(this.#a==-1?0:n-1,n),l=this;i.forEach(function(h){h.index>l.#a&&(t.push(h),l.#a=h.index)})}return t}getRange(n,e){n>e&&([n,e]=[e,n]);let t=[],i=-1,l=Math.ceil(Math.sqrt(this.length)),h=!0;for(let p=0;p<this.length;p+=l)this[p+l]?i<0&&this[p+l].start>=n&&(i=p):i=i<0?p:i;for(;h;)this[i]?.end<e?this[i].start>=n&&t.push(this[i]):h=!1,i++;return t}};var ca=0xffffffffffff,wt=function(n){let e=new Ve,t=this,i=n.timeDivision,l=120,h=new Ve,p=0,m=0;h.push(new Ne(0,ca,[120,0])),n.track.forEach(function(a){p=0,a.event.forEach(function(s){p+=s.deltaTime,s.type===255&&s?.metaType===81&&(l=6e7/s.data,h[h.length-1]&&h.push(new Ne(p,0xffffffffffff,[l,0])))})}),h.fresh(),h.forEach(function(a,s,c){s>0&&(c[s-1].end=a.start)});let b=120;h.forEach(function(a,s,c){s>0&&(a.end===a.start?c.splice(c.indexOf(a),1):b===a.data[0]&&(c[s-1].end=a.end,c.splice(c.indexOf(a),1)),b=a.data[0])});let E=0,C=120;return h.forEach(function(a){let s=a.start,c=s/C/i*60+E;C=a.data[0],E=c-s/C/i*60,a.data[1]=E}),console.debug("All tempo changes: ",h),l=120,p=0,m=0,n.track.forEach(function(a,s){p=0,m=0;let c=s+1;a.event.forEach(function(r,d){p+=r.deltaTime;let o=h.step(p,!0)[0];o&&(l=o.data[0],m=o.data[1]);let f={type:r.type,data:r.data,track:c,part:0};r.type>14?f.meta=r.metaType:f.part=r.channel,e.push(new yt(p/l/i*60+m,f))})}),e.fresh(),self.midiEvents=e,console.debug(`Parsed a type ${n.formatType} MIDI sequence.`),e};var da={866:"cp866","utf-8":"utf-8",utf8:"utf-8","utf-16":"utf-16",utf16:"utf-16","utf-16le":"utf-16",utf16le:"utf-16",unicode:"utf-16",unicodefeff:"utf-16","ucs-2":"utf-16","utf-16be":"utf-16be",utf16be:"utf-16be","utf-24":"utf-24",utf24:"utf-24","utf-24le":"utf-24",utf24le:"utf-24","utf-24be":"utf-24be",utf24be:"utf-24be","utf-32":"utf-32",utf32:"utf-32","utf-32le":"utf-32",utf32le:"utf-32","utf-32be":"utf-32be",utf32be:"utf-32be",latin1:"latin1",l1:"latin1",ascii:"latin1","us-ascii":"latin1","iso-8859-1":"latin1","iso8859-1":"latin1",cp1252:"latin1","windows-1252":"latin1",cp819:"latin1",ibm819:"latin1",latin2:"latin2",l2:"latin2","iso-8859-2":"latin2","iso8859-2":"latin2",latin3:"latin3",l3:"latin3","iso-8859-3":"latin3","iso8859-3":"latin3",latin4:"latin4",l4:"latin4","iso-8859-4":"latin4","iso8859-4":"latin4",latin5:"latin5",l5:"latin5","iso-8859-9":"latin5","iso8859-9":"latin5",cp1254:"latin5","windows-1254":"latin5",latin6:"latin6",l6:"latin6","iso-8859-10":"latin6","iso8859-10":"latin6",latin9:"latin9",l9:"latin9","iso-8859-15":"latin9","iso8859-15":"latin9","iso-8859-5":"iso-8859-5","iso8859-5":"iso-8859-5",cyrillic:"iso-8859-5","iso-8859-6":"iso-8859-6","iso8859-6":"iso-8859-6","iso-8859-6-e":"iso-8859-6","iso8859-6e":"iso-8859-6","iso-8859-6-i":"iso-8859-6","iso8859-6i":"iso-8859-6","asmo-708":"iso-8859-6","ecma-114":"iso-8859-6",arabic:"iso-8859-6","iso-8859-7":"iso-8859-7","iso8859-7":"iso-8859-7","ecma-118":"iso-8859-7",greek:"iso-8859-7",greek8:"iso-8859-7","iso-8859-8":"iso-8859-8","iso8859-8":"iso-8859-8","iso-8859-8-e":"iso-8859-8","iso8859-8e":"iso-8859-8",hebrew:"iso-8859-8",visual:"iso-8859-8","iso-8859-8-i":"iso-8859-8-i","iso8859-8i":"iso-8859-8-i",logical:"iso-8859-8-i","iso-8859-11":"iso-8859-11","iso8859-11":"iso-8859-11","windows-874":"iso-8859-11","dos-874":"iso-8859-11",cp874:"iso-8859-11","tis-620":"iso-8859-11","iso-8859-13":"iso-8859-13","iso8859-13":"iso-8859-13",latin7:"iso-8859-13",l7:"iso-8859-13","iso-8859-14":"iso-8859-14","iso8859-14":"iso-8859-14",latin8:"iso-8859-14",l8:"iso-8859-14","iso-8859-16":"iso-8859-16","iso8859-16":"iso-8859-16",cp866:"cp866",ibm866:"cp866",cp1250:"cp1250","windows-1250":"cp1250",cp1251:"cp1251","windows-1251":"cp1251",cp1253:"cp1253","windows-1253":"cp1253",cp1255:"cp1255","windows-1255":"cp1255",cp1256:"cp1256","windows-1256":"cp1256",cp1257:"cp1257","windows-1257":"cp1257",cp1258:"cp1258","windows-1258":"cp1258","euc-jp":"euc-jp",cp954:"euc-jp","euc-kr":"euc-kr",koi8:"koi8",koi:"koi8","koi8-r":"koi8","koi8-u":"koi8-u","koi8-ru":"koi8-u",mac:"mac",macintosh:"mac","mac-cyrillic":"x-mac-cyrillic","x-mac-cyrillic":"x-mac-cyrillic","x-mac-ukrainian":"x-mac-cyrillic",gbk:"gbk",gb2312:"gbk",chinese:"gbk","euc-cn":"gbk",gb18030:"gb18030",big5:"big5","big5-hkscs":"big5",sjis:"sjis","shift-jis":"sjis",ms932:"sjis","windows-31j":"sjis"},fa={"utf-8":1,"utf-16":2,"utf-16be":3,"utf-24":4,"utf-24be":5,"utf-32":6,"utf-32be":7,latin1:0,latin2:0,latin3:0,latin4:0,latin5:0,latin6:0,latin9:0,"iso-8859-5":0,"iso-8859-6":0,"iso-8859-7":0,"iso-8859-8":0,"iso-8859-8-i":0,"iso-8859-11":0,"iso-8859-13":0,"iso-8859-14":0,"iso-8859-16":0,cp866:0,cp1250:0,cp1251:0,cp1253:0,cp1255:0,cp1256:0,cp1257:0,cp1258:0,"euc-jp":1,"euc-kr":1,koi8:0,"koi8-u":0,mac:0,"x-mac-cyrillic":0,gbk:1,gb18030:1,big5:1,sjis:1},q,J=(q=class{static getUnitSize(n){if(n>7)throw new RangeError("Cannot decode encodings with more than 4 bits per unit.");return(n>>1)+1}static isBigEndian(n){return(n&1)===1}static collapse(n){let e=da[n];if(typeof e!="string")throw new TypeError(`Provided label "${n}" is not supported.`);return e}static indicator(n){let e=fa[n];if(typeof e!="number")throw new TypeError(`Provided collapsed label "${n}" is not supported.`);return e}},O(q,"BYTE_1",0),O(q,"BYTE_1_VL",1),O(q,"BYTE_2_LE",2),O(q,"BYTE_2_BE",3),O(q,"BYTE_3_LE",4),O(q,"BYTE_3_BE",5),O(q,"BYTE_4_LE",6),O(q,"BYTE_4_BE",7),q),U=(n,e)=>{n.unsent=!1,n.enqueue(e)},ve=(n,e,t=1,i=!0)=>{if(typeof t!="number"||t<=0||t>4)throw new RangeError(`Invalid byte size ${t}.`);if(!(n instanceof Uint8Array||n instanceof Uint8ClampedArray))throw new TypeError("Input buffer is not Uint8Array.");if(typeof e!="number"||e<0||e>=n.length)throw new RangeError(`Provided offset ${e} is out of buffer range.`);if(t===1)return n[e];{let l=0;if(i)for(let h=0;h<t;h++)l<<=8,l|=n[e+h];else for(let h=0;h<t;h++)l|=n[e+h]<<(h<<3);return l<0?l+4294967296:l}},ha=class{static lineRaw(n,e=0){if(typeof e!="number"||e<0||e>7)throw new TypeError("Invalid split mode.");if(!n||n?.constructor!==ReadableStream)throw new TypeError("Not a readable stream.");let t=J.getUnitSize(e),i=J.isBigEndian(e),l=n.getReader(),h,p=!1,m=[],b=0,E=0,C=0;return new ReadableStream({pull:async a=>{for(a.unsent=!0;a.unsent;){if(!h||b>=h.length){b>E&&(m.push(h.subarray(E)),E=0);let s=await l.read();h=s.value,p=s.done,b=0}if(h){let s=0;if(t===1)s=h[b];else if(i)for(let r=0;r<t;r++)s<<=8,s|=h[b+r];else for(let r=0;r<t;r++)s|=h[b+r]<<(r<<3);let c=!1;switch(s){case 10:{C===13?E+=t:c=!0;break}case 13:{c=!0;break}}if(c){if(m.length){m.push(h.subarray(E,b));let r=0;for(let f=0;f<m.length;f++)r+=m[f].length;let d=new Uint8Array(r),o=0;for(let f=0;f<m.length;f++)d.set(m[f],o),o+=m[f].length;U(a,d),m=[]}else U(a,h.subarray(E,b));E=b+=t}C=s}if(p){if(E!==b&&h&&m.push(h.subarray(E,b)),m.length){let s=0;for(let d=0;d<m.length;d++)s+=m[d].length;let c=new Uint8Array(s),r=0;for(let d=0;d<m.length;d++)c.set(m[d],r),r+=m[d].length;U(a,c)}a.unsent=!1,a.close()}b+=t}}},new ByteLengthQueuingStrategy({highWaterMark:256}))}static chunkRaw(n,e="utf-8"){if(!n||n?.constructor!==ReadableStream)throw new TypeError("Not a readable stream.");let t=J.indicator(e),i=J.getUnitSize(t),l=J.isBigEndian(t),h=n.getReader(),p;return new ReadableStream({pull:async m=>{m.unsent=!0;let{value:b,done:E}=await h.read();if(b){let C=0,a=b.length;if(t!==0&&typeof p?.length=="number"){let s=!1;switch(e){case"big5":case"gbk":case"sjis":case"euc-kr":{C=1;let c=new Uint8Array(2);c[0]=p[0],c[1]=b[0],U(m,c);break}case"euc-jp":{let c=3;p[0]===143?C=3-p.length:p[0]>127?(C=1,c=2):c=p.length;let r=new Uint8Array(3);r.set(p),r.set(b.subarray(0,C),p.length),U(m,r.subarray(0,c));break}case"gb18030":{let c=new Uint8Array(4),r=4;c.set(p),c.set(b.subarray(0,4-p.length),p.length),c[0]<128?r=p.length:c[1]>=64?(C=1,r=2):C=4-p.length,U(m,c.subarray(0,r));break}case"utf-8":{let c=4;p[0]>=240?C=4-p.length:p[0]>=224?(C=3-p.length,c=3):p[0]>=192?(C=1,c=2):c=p.length;let r=new Uint8Array(4);r.set(p),r.set(b.subarray(0,C),p.length),U(m,r.subarray(0,c));break}case"utf-16":case"utf-16be":{let c=new Uint8Array(4);c.set(p),c.set(b.subarray(0,4-p.length)),C=4-p.length,ve(transientSize,0,2,l)>=55296&&ve(transientSize,2,2,l)>=55296?U(m,c):(U(m,c.subarray(0,2)),U(m,c.subarray(2)));break}default:{let c=new Uint8Array(i);c.set(p),c.set(b.subarray(0,i-p.length),p.length),U(m,c)}}}if(p=void 0,t===0)U(m,b.subarray(C));else{switch(e){case"utf-24":case"utf-24be":{a=Math.floor((b.length-C)/i)*i+C;break}case"utf-32":case"utf-32be":{a=(b.length-C>>2<<2)+C;break}case"utf-8":{if(b[b.length-1]>127){let s=!0,c=b.length,r=b.length-8;for(;s&&c>r;)c--,b[c]<128?a=c+1:b[c]>192&&(a=c)}break}case"utf-16":case"utf-16be":{if(a=(b.length-C>>1<<1)+C,ve(b,a-2,2,l)>=55296){let s=!0,c=a,r=a-6;for(;s&&c>r;)c-=2,ve(b,c,2,l)>>10===54&&(a=c)}break}default:throw new TypeError("Maybe someday the rest of the decoders will be implemented")}U(m,b.subarray(C,a))}a<b.length&&(p=b.subarray(a))}E&&(typeof p?.length=="number"&&U(m,p),m.unsent=!1,m.close())}},new ByteLengthQueuingStrategy({highWaterMark:256}))}static line(n,e="utf-8",t){let i=J.collapse(e),l=J.indicator(i),h=this.lineRaw(n,l).getReader(),p=new TextDecoder(i,onlostpointercapture);return new ReadableStream({pull:async m=>{let{value:b,done:E}=await h.read();b&&m.enqueue(p.decode(b)),E&&m.close()}})}static chunk(n,e="utf-8",t){let i=J.collapse(e);if(self.TextDecoderStream){let l=new TextDecoderStream(i,t);return n.pipeTo(l.writable),l.readable}else{let l=this.chunkRaw(n,i).getReader(),h=new TextDecoder(i);return new ReadableStream({pull:async p=>{let{value:m,done:b}=await l.read();m&&(console.debug(m),p.enqueue(h.decode(m))),b&&p.close()}})}}},Et=ha;var _e={0:"\0",a:"\x07",b:"\b",e:"\x1B",f:"\f",n:`
`,r:"\r",t:"	",v:"\v","\\":"\\","'":"'",'"':'"'},Xe=new Uint8Array(128);Xe.fill(1,48,58);Xe.fill(1,65,71);Xe.fill(1,97,103);var se=new Uint8Array(256);se.fill(1,0,32);se.fill(1,128,160);se[127]=1;var ua={};for(let n in _e){let e=_e[n];ua[e]=`\\${n}`,se[e.charCodeAt(0)]=2}se[34]=3;se[39]=3;var kt=n=>{let e="",t=!1;for(let i=0;i<n.length;i++){let l=n[i];if(t){let h=0;switch(l){case"x":{h=2;break}case"u":{h=4;break}case"U":{h=8;break}default:{let p=_e[l];if(typeof p=="string")e+=p;else throw new Error(`Invalid escape identifier "${l}" at index ${i}`);t=!1;continue}}if(h>0){let p=i+1,m=n.substring(p,p+h);if(m.length<h)throw new RangeError(`Insufficient code point buffer "${m}" at index ${p}`);let b=parseInt(m,16);if(Number.isNaN(b))throw new RangeError(`Malformed code point representation "${m}" at index ${p}`);if(b>=1114112)throw new RangeError(`Code point "${m}" exceeds 0x10ffff at index ${p}`);e+=String.fromCodePoint(b),t=!1,i+=h}}else l==="\\"?t=!0:e+=l}return e},pa=(n,e=0)=>{};self.TextEscape=pa;var Z,xe=(Z=class{static parse(n,e){let t=n&this.MASK_TYPE,i=n&this.MASK_DATA,l=0,h=0,p,m=0,b,E=e.getReader();return new ReadableStream({pull:async C=>{let{value:a,done:s}=await E.read();if(typeof a=="string"){switch(t){case this.TYPE_TSV:{p=[];try{for(let c of a.split("	"))switch(i){case this.DATA_TEXT:{p.push(kt(c));break}case this.DATA_JSON:{p.push(l===0?kt(c):JSON.parse(c));break}default:throw new TypeError(`Unknown DSV value type ${t}`)}}catch(c){console.debug(`The following error appeared when parsing on line ${l+1}.`),console.error(c)}break}case this.TYPE_CSV:{if(i!==this.DATA_TEXT)throw new TypeError(`Invalid type ${t} for CSV, only plain text is allowed`);break}default:throw new TypeError(`Unknown DSV type ${t}`)}C.enqueue(p),l++}s&&C.close()}})}static parseObjects(n,e){let t=0,i=this.parse(n,e).getReader(),l;return new ReadableStream({start:async h=>{let{value:p,done:m}=await i.read();typeof p?.length=="number"&&(l=p),m&&h.close()},pull:async h=>{let{value:p,done:m}=await i.read();if(typeof p?.length=="number"){let b={};for(let E=0;E<p.length;E++)p[E]&&(b[l[E]]=p[E]);h.enqueue(b)}m&&h.close()}})}},O(Z,"MASK_TYPE",3),O(Z,"MASK_DATA",12),O(Z,"TYPE_TSV",0),O(Z,"TYPE_CSV",1),O(Z,"DATA_TEXT",0),O(Z,"DATA_JSON",4),Z);He.default.customInterpreter=nt;var A=(n,e,t)=>{n.addEventListener(t,i=>{e.dispatchEvent(t,i.data)})},Ct=n=>{let e=n.split("/");return e[e.length-1]||e[e.length-2]||"(remote)"};if(typeof self?.require<"u")throw new Error("Environments supporting CommonJS is not supported.");var vt=class extends me{BM_UNIVERSAL=0;BM_YAMAHA_MU=1;device;#a;#h={};#C=[];#v=new Map;#k="";#x=[];#P=[];#d=new Uint8ClampedArray(y.ch);#i=new Uint8ClampedArray(y.ch);#e=new Uint32Array(y.ch);#b=new Uint32Array(y.ch);#n=.5;#g=120;#u=4;#c=4;#o=0;#R=0;#T=new Array(y.ch);#$=new Uint8Array(y.ch);#y=0;dState;msActive=200;msFrame=100;msExhaust=300;smoothAttack=0;smoothDecay=0;get clockSource(){return this.device?.clockSource}set clockSource(n){if(this.device)this.device.clockSource=n;else throw new Error("OctaviaDevice is not ready.")}reset(){let n=this;n.dispatchEvent("reset"),n.#a?.resetIndex(),n.device.init(),n.#k="",n.#n=.5,n.#g=120,n.#u=4,n.#c=4,n.#o=0,n.#R=0,n.dispatchEvent("tempo",n.#g),n.dispatchEvent("title",n.#k),n.dispatchEvent("tsig",n.getTimeSig())}init(){this.reset(),this.#a=void 0}async loadFile(n){this.#a=wt(He.default.parse(new Uint8Array(await n.arrayBuffer())))}async loadMap(n,e,t,i="(internal)"){let l=this,h=0,p=0,m=0,b=0,E,C;n.split(`
`).forEach((a,s)=>{if(!a)return;let c=a.split("	");if(s){if(!b)return;let r="",d="";c.forEach((f,g)=>{switch(g){case E:{r=f;break}case C:{d=f;break}}});let o=!1;l.#h[r]?.priority>t&&(o=!0,m++),!l.#h[r]||o||e?(l.#h[r]={name:d,priority:t},h++):self.debugMode&&console.debug(`Voice "${d}" (${r}) seems to be in conflict with (${l.#h[r]}).`),p++}else c.forEach((r,d)=>{switch(r){case"ID":{E=d,b++;break}case"Name":{C=d,b++;break}default:console.debug(`Unknown map field: ${r}`)}})}),console.debug(`Voice names: From "${i}", ${p} total, ${h} loaded (${h-m} + ${m}).`),l?.device.forceVoiceRefresh()}async loadMapPaths(n){let e=this;n.forEach(async(t,i)=>{e.loadMap(await(await fetch(t)).text(),0,i,Ct(t))})}async loadEfx(n,e){let t=this,i=0,l=0,h,p,m;n.split(`
`).forEach((b,E)=>{if(b)if(E){let C=0,a;b.split("	").forEach((s,c)=>{switch(c){case h:{C|=(parseInt(s,16)&255)<<8;break}case p:{C|=parseInt(s,16)&255;break}case m:{a=s;break}}}),!t.#C[C]||e?(t.#C[C]=a,i++):self.debugMode&&console.debug(`EFX ID 0x${C.toString(16).padStart(4,"0")} (${a}) seems to be in conflict.`),l++}else b.split("	").forEach((C,a)=>{switch(C){case"MSB":{h=a;break}case"LSB":{p=a;break}case"Name":{m=a;break}default:console.debug(`Unknown EFX field: ${C}`)}})}),console.debug(`EFX: ${l} total, ${i} loaded.`);for(let b=0;b<ue.length;b++){let E=!1,C=t.device.getEffectType(b);C[0]===0&&C[1]>>4===15&&(E=!0),t.dispatchEvent(`efx${ue[b]}`,{id:C,hidden:E})}}async loadModels(n,e){let t=this,i=0,l=0}async loadStyles(n,e){let t=this,i=0,l=0}async loadProps(n,e,t=0,i="(internal)"){let l=this,h=0,p=0,m=0;for await(let b of xe.parseObjects(xe.DATA_TEXT|xe.TYPE_TSV,Et.line(n)))if(typeof b?.voiceId=="string")if(p++,!(l.#v.has(b.voiceId)||l.#v.get(b.voiceId)?.priority<=t)||e){if(Object.keys(b).length<2)continue;l.#v.get(b.voiceId)?.priority>t&&m++,b.priority=t,l.handleProp&&await l.handleProp(b),l.#v.set(b.voiceId,b),h++}else console.debug(`Tried to write a pre-existing entry "${b.voiceId}" on entry ${p}.`);console.debug(`Voice properties: From "${i}", ${p} total, ${h} loaded (${h-m} + ${m}).`)}async loadPropsPaths(n){let e=this;n.forEach(async(t,i)=>{let l=t.split("/");e.loadProps((await fetch(t)).body,0,i,Ct(t))})}switchMode(n,e=!1){this.device.switchMode(n,e)}getMode(){return this.device.getMode()}getVoice(){return this.device.getVoice(...arguments)}getChVoice(n){return this.device.getChVoice(n)}refreshCachedChVoice(n,e){let t=this,i=e??t.device.getChVoice(n),l=t.#T[n],h=!0;if(t.#y++,!e)switch(t.device.getChMode(n)){case"xg":{if(t.device.getChType(n)>0&&t.device.getChPrimitive(n,1)!==126)switch(i.ending){case"!":case"?":{h=!1,l.refreshFailure=!0,console.debug("Cached voice persisted due to invalid drum kit.");break}}break}case"gs":case"sc":{i.ending!==" "&&(i.sid[2]===1?(i.name="Silence",i.refreshFailure=!0,console.debug("Cached voice nullified due to invalid SC-55 voice.")):(h=!1,l.refreshFailure=!0,console.debug("Cached voice persisted due to invalid GS voice.")));break}}return h?(t.#T[n]=i,t.#$[n]=i.poly??1,t.#y>1?console.debug(`Bubbling prevented at instance #${t.#y}.`):t.dispatchEvent("cachedvoice",{part:n}),t.#y--,i):(t.#y--,l)}getCachedChVoice(n){let e=this,t=e.#T[n],i=e.device?.getChPrimitives(n,!0);if(t&&e.device?.getChCvnIsWritten(n)===0)switch(t.ending){case"?":case"!":return e.refreshCachedChVoice(n,void 0);default:return st(t.sid,i)[1]!==0||t.name==="Unloaded"?e.refreshCachedChVoice(n):t}else return e.refreshCachedChVoice(n)}getChPrimitive(n,e,t){return this.device.getChPrimitive(n,e,t)}getChPrimitives(n,e){return this.device.getChPrimitives(n,e)}getMapped(n){return this.#h[n]?.name||n}getEfx(n){let[e,t]=n,i=e<<8|t;return this.#C[i]||`0x${i.toString(16).padStart(4,"0")}`}getVoxBm(n,e=this.BM_UNIVERSAL){if(!n)throw new Error("Voice object must be valid");let t=this;if(!t.voxBm)throw new Error("Voice bitmap repository isn't yet initialized");let i=t.voxBm.getBm(n.name);if(!i){switch(n.mode){case"xg":{switch(n.sid[0]){case 0:case 80:case 81:case 83:case 84:case 96:case 97:case 99:case 100:{i=t.voxBm.getBm(t.getVoice(K.bank0,n.sid[1],K.bank0,n.mode).name);break}}break}case"g2":case"sd":{switch(n.sid[0]){case 96:case 97:case 98:case 99:{i=t.voxBm.getBm(t.getVoice(K.bank0,n.sid[1],K.bank0,n.mode).name);break}case 104:case 105:case 106:case 107:{i=t.voxBm.getBm(t.getVoice(120,n.sid[1],K.bank0,n.mode).name);break}}break}case"gs":case"sc":case"k11":case"sg":case"gm":{switch(n.sid[0]){case 120:break;case 122:case 127:{i=t.voxBm.getBm(t.getVoice(120,n.sid[1],0,n.mode).name);break}default:i=t.voxBm.getBm(t.getVoice(0,n.sid[1],0,n.mode).name)}break}case"05rw":case"x5d":case"ns5r":{switch(n.sid[0]){case 56:{i=t.voxBm.getBm(t.getVoice(0,n.sid[1],0,"gm").name);break}}break}default:}switch(e){case t.BM_UNIVERSAL:break;case t.BM_YAMAHA_MU:{let l=n.standard.toLowerCase();if(l!==n.mode&&j.xg.has(l))switch(n.sid[0]>>4){case 2:{i=t.sysBm?.getBm(`ext_${l}I`);break}case 3:{n.sid[0]===48&&(i=t.sysBm?.getBm("boot_3"));break}case 6:{i=t.sysBm.getBm(`ext_${l}P`);break}default:{i=t.sysBm.getBm(`ext_${l}`);break}}else["es"].indexOf(l)>-1?i=t.sysBm.getBm("boot_3"):l==="kr"&&(i=t.sysBm.getBm("st_korg"));break}}}return i||(i=t.voxBm.getBm(t.getVoice(n.sid[0],n.sid[1],0,n.mode).name)),i}getChBm(n,e=this.BM_UNIVERSAL,t){let i=this;t=t??i.getChVoice(n);let l=i?.device.getChType(n),h;switch(e){case i.BM_UNIVERSAL:break;case i.BM_YAMAHA_MU:{let p=t.standard.toLowerCase();if(p!==t.mode&&j.xg.has(p))switch(t.sid[0]>>4){case 1:{t.sid[0]===16&&(h=i.sysBm.getBm("cat_svox"));break}case 2:{h=i.sysBm?.getBm(`ext_${p}I`);break}case 3:{t.sid[0]===48&&(h=i.sysBm?.getBm("boot_3"));break}case 6:{h=i.sysBm.getBm(`ext_${p}P`);break}default:{h=i.sysBm.getBm(`ext_${p}`);break}}else if(["es"].indexOf(p)>-1)h=i.sysBm.getBm("boot_3");else if(p==="kr")h=i.sysBm.getBm("st_korg");else if(p==="xg")switch(t.sid[0]){case 126:{t.sid[1]>>2===28&&(h=i.sysBm.getBm("cat_smpl"));break}}if(!h&&l)switch(t.ending){case"!":case"?":case"*":{h=i.sysBm.getBm(l>1&&l<6?`cat_dS${l-1}`:"cat_drS");break}default:h=i.sysBm.getBm(l>1&&l<10?`cat_dr${l-1}`:"cat_drm")}break}}if(h=h||i.getVoxBm(t,e),!h){if(!i.sysBm)return;switch(t.mode){case"xg":{switch(t.sid[0]){case 126:{t.sid[1]>>2===28&&(h=i.sysBm.getBm("cat_smpl"));break}case 16:{h=i.sysBm.getBm("cat_smpl");break}case 64:case 67:{h=i.sysBm.getBm("cat_sfx");break}case 32:case 33:case 34:case 35:case 36:case 48:case 82:{h=i.sysBm.getBm("cat_xg");break}}break}default:switch(t.sid[0]){case 63:case 32:case 33:case 34:case 35:case 36:case 48:case 82:{h=i.sysBm.getBm("cat_mex");break}}}}if(h)switch(t.ending){case"!":case"?":case"*":{h=i.sysBm.getBm(l?"cat_drS":"no_vox");break}}else l?h=i.sysBm.getBm("cat_drS"):h=i.sysBm.getBm("no_vox");return h}getChBmState(n,e=1){let t=this,i=Math.floor(t.#R*1e3)-t.getChLastNoteExhausted(n);return t.getChLastNoteExhausted(n)<=0?0:i<t.msActive?(e-=1,e<1?0:Math.floor(i/t.msFrame)%e+1):0}detachState(n){let e=this;if(e.dState){let t=e.dState;switch(n){case"mu":{e.removeEventListener("mode",t.muModeFunc),delete t.muModeFunc,delete t.muModeBm,delete t.muUnresolvedEx,delete t.muUseVoiceBm,delete t.muTempWindow,delete t.muBlinkSpeedMode,delete t.muBmex,delete t.muBmst,delete t.isMu;break}}return!0}else return!1}attachState(n){let e=this;e.dState=e.dState??{};let t=e.dState,i=!1;switch(n){case"mu":{t.isMu=!0,t.muBmst=0,t.muBmex=0,t.muBlinkSpeedMode=400,t.muTempWindow=new Uint8Array(256),t.muUseVoiceBm=!0,t.muUnresolvedEx=0,t.muModeFunc=function(l){let h=e.sysBm.getBm(`st_${{gm:"gm1",g2:"gm2","?":"gm1",ns5r:"korg",ag10:"korg",x5d:"korg","05rw":"korg",krs:"korg",sg:"gm1",k11:"gm1",sd:"gm2",sc:"gs"}[l.data]||l.data}`);h&&(t.muModeBm=h.getFrame(0)),t.muBmst=2,t.muBmex=e.clockSource.now()+t.muBlinkSpeedMode*4},e.addEventListener("mode",t.muModeFunc);break}default:i=!0}return!i}muWriteBm(n,e,t){if(n?.BYTES_PER_ELEMENT!==1)throw new TypeError("Buffer must be Uint8Array.");let i=this,l=n.length>>8||1;if(!i.dState.isMu)throw new Error("Device state for MU is not yet attached.");let h=i.clockSource.now(),p=i.device?.getBitmap(),m=i.dState.muTempWindow,b=!1,E=!1;if(h<p.expire)p.bitmap.length<=256?(m=p.bitmap,b=!0):(n.set(p.bitmap.subarray(0,n.length)),E=!0);else if(h<i.dState.muBmex){if(i.dState.muBmst===2){b=!0;let C=Math.floor((i.dState.muBmex-h)/i.dState.muBlinkSpeedMode)&1;i.dState.muModeBm?i.dState.muModeBm?.forEach((a,s)=>{m[s]=C===a}):m.fill(C?0:1)}}else if(i.dState.muUseVoiceBm){b=!0,i.dState.muBmst=0;let C=i.getChBm(e,i.BM_YAMAHA_MU,t),a=i.getChBmState(e,C?.frames||1);C&&m.set(C.getFrame(a))}if(b){let C=0;for(let a=0;a<m.length;a++){let s=m[a];n[C]=s?255:0,l===2&&(n[C+1]=s?255:0),C+=l}}return b||E}getProps(n){let e=this,t,i,l=0,h=n;for(;l<8&&t==null&&(!i?.constructor||i instanceof Array&&(i[1]!==n.eid[1]||i[2]!==n.eid[2]));)i=n.eid,typeof n.voice=="string"&&(e.#v.has(n.voice)?t=e.#v.get(n.voice):n=e.getVoice(i[0],i[2]===0?0:i[1],i[2]===0?0:i[2]-1));return!t&&l===8&&console.info(`Voice property fetching failed for "${n.name}" (${n.eid.join(" ")}).`),t}get noteProgress(){return this.#R/this.#n}get noteOverall(){return(this.noteProgress-this.#o)*this.#c/4}get noteBar(){return Math.floor(this.noteOverall/this.#u)}get noteBeat(){let n=this.noteOverall%this.#u;return n<0&&(n+=this.#u),n}get noteOffset(){return this.#o}getTimeSig(){return[this.#u,this.#c]}getTempo(){return this.#g}getPool(){return this.#a}getChCachedVoiceRaw(n){return this.#T[n]}getChLastNoteAt(n){return this.#e[n]}getChLastNoteExhausted(n){return this.#b[n]}eachVoice(n,e=!1){let t=this;for(let i=0;i<t.#T.length;i++)(e||t.device?.getChActive(i))&&n(t.#T[i],i,t.#T)}sendCmd(n){this.device.runJson(n)}render(n){n>this.#R&&(this.#R=n);let e=this.#a?.step(n)||[],t=0,i=0,l=new Set,h={},p=[],m=this,b=[];for(m.device.getStrength().forEach((d,o)=>{m.#i[o]=d}),m.device.newStrength(),e.forEach(function(d){let o=d.data,f=m.device.runJson(o);switch(f?.reply){case"meta":{b.push(f);break}}f?.reply&&delete f.reply});m.#P.length>0;){let d=m.#P.shift(),o=d.part<<7|d.note;d.state?(l.add(o),h[o]=d.velo):l.has(o)&&(p.push({part:d.part,note:d.note,velo:h[o],state:m.device.NOTE_SUSTAIN}),t++,i+=m.#$[d.part])}b?.length>0&&m.dispatchEvent("meta",b);let E=[],C=[],a=m.device.getStrength();a.forEach(function(d,o,f){f[o]=Math.max(m.#i[o],d);let g=f[o]-m.#d[o];if(g>=0){let u=4*.25**(m.device.getChCc(o,73)/64);m.#d[o]+=Math.ceil(g-g*m.smoothAttack**u)}else{let u=4*.25**(m.device.getChCc(o,72)/64);m.#d[o]+=Math.floor(g-g*m.smoothDecay**u)}});let s=0,c=0;return m.device?.getActive()?.forEach(function(d,o){d&&(E[o]=m.device.getVel(o),C[o]=m.device.getExt(o),s+=E[o].size,c+=E[o].size*m.#$[o])}),{extraPoly:t,extraPolyEC:i,extraNotes:p,curPoly:s,curPolyEC:c,chKeyPr:E,chExt:C,eventCount:e.length,title:m.#k,texts:m.device.getTexts(),master:m.device.getMaster(),mode:m.device.getMode(),strength:m.#d,velo:a,rpn:m.device.getRpn(),tSig:m.getTimeSig(),tempo:m.getTempo(),noteBar:m.noteBar,noteBeat:m.noteBeat,ace:m.device.getAce(),rawVelo:m.device.getStrength(),rawStrength:m.device.getRawStrength(),rawPitch:m.device.getRawPitch(),efxSink:m.device.getEffectSink()}}constructor(n,e=.5,t=.5){super();let i=this;i.smoothAttack=e,i.smoothDecay=t,i.device=n,i.addEventListener("meta",function(l){l?.data?.forEach(function(h){(i.#x[h.meta]||console.debug).call(i,h.meta,h.data)})}),A(i.device,i,"mode"),A(i.device,i,"mastervolume"),A(i.device,i,"channelactive"),A(i.device,i,"channelmin"),A(i.device,i,"channelmax"),A(i.device,i,"portrange"),A(i.device,i,"portstart"),A(i.device,i,"channelreset"),A(i.device,i,"channeltoggle"),A(i.device,i,"screen"),A(i.device,i,"metacommit"),A(i.device,i,"voice"),A(i.device,i,"pitch"),A(i.device,i,"note"),A(i.device,i,"reset"),A(i.device,i,"banklevel"),A(i.device,i,"efxreverb"),A(i.device,i,"efxchorus"),A(i.device,i,"efxdelay"),A(i.device,i,"efxinsert0"),A(i.device,i,"efxinsert1"),A(i.device,i,"efxinsert2"),A(i.device,i,"efxinsert3"),A(i.device,i,"efxinsert4"),A(i.device,i,"partefxtoggle"),A(i.device,i,"chmode"),i.addEventListener("note",function({data:l}){if(i.#P.push(l),l.state===3){let h=Math.floor(i.#R*1e3);i.#e[l.part]=h,h-i.#b[l.part]>=i.msExhaust&&(i.#b[l.part]=h)}}),i.addEventListener("voice",({data:l})=>{i.refreshCachedChVoice(l.part)}),i.addEventListener("reset",({data:l})=>{i.#$.fill(1),i.#e.fill(0),i.#b.fill(0)}),i.#$.fill(1),i.#x[3]=function(l,h){i.#k?.length<1&&(i.#k=h,i.dispatchEvent("title",i.#k))},i.#x[81]=function(l,h){let p=i.noteProgress,m=i.#n||.5;i.#g=6e7/h,i.#n=h/1e6,i.#o+=p*(m/i.#n)-p,i.dispatchEvent("tempo",i.#g)},i.#x[88]=function(l,h){let p=i.noteBar,m=i.noteBeat,b=i.#u,E=i.#c;i.#u=h[0],i.#c=1<<h[1];let C=Math.round(p+m/b);b!==i.#u&&(i.#o-=C*(i.#u-b)*(4/i.#c)),E!==i.#c&&(console.debug(`${p}/${m}`),E<i.#c?i.#o+=C*(i.#c-E)*(E/i.#c):i.#o+=C*(i.#c-E)*(i.#c/E)),i.dispatchEvent("tsig",i.getTimeSig())},i.addEventListener("metacommit",({data:l})=>{switch(l.type){case"KarTitle":case"EORTitle":{i.#k?.length<1&&(i.#k=l.data,i.dispatchEvent("title",i.#k));break}}})}};var ga=class extends EventTarget{static sleep(n){return new Promise(e=>{self.AbortSignal?AbortSignal.timeout(n).addEventListener("abort",e):setTimeout(e,n)})}#a;#h;#C=!1;get finished(){return this.#C}finish(){this.#C=!0,this.#h&&this.#h()}wait(){if(!this.#C)return this.#a}constructor(){super(),this.#a=new Promise(n=>{this.#h=()=>{this.#C=!0,n()}})}},xt=ga;var Ge=new Uint8Array(40),pe=0,Fe,Fr=setInterval(()=>{Fe&&(Ge[pe]=!Ge[pe],pe++,pe>34&&(pe=0))},1e3/50);Uint8Array.prototype.render=function(n){let e=0,t=0,i=this.width||5,l=this.height||8;for(let h=0;h<this.length;h++)n(this[h],e,t,this),e++,e>=i&&(e=0,t++)};var $t=class{#a=[];loaded=new xt;async load(e,t=!1,i="(internal)"){let l=this,h=0,p=0;console.debug(`Font "${i||"(internal)"}": loading started.`),e.split(`
`).forEach(function(m,b){if(b>0&&m?.length>0){let E=m.split("	"),C=parseInt(E[0],16);if(p++,l.#a[C]&&!t)return;let a=new Uint8Array(40);Array.from(E[1]).forEach(async function(s,c){let r=c&1?4:0,d=c>>1,o=parseInt(s,16),f=3;for(;o>0||f>=0;){let g=(r+f)*5+d;a[g]=o&1,o=o>>1,f--}}),a.width=5,a.height=8,l.#a[C]=a,h++}}),l.loaded.finished||l.loaded.finish(),console.debug(`Font "${i||"(internal)"}": ${p} total, ${h} loaded.`)}async loadFile(e,t=!1){let i=this;console.debug(`Requested font file from "${e}".`),await i.load(await(await fetch(e)).text(),t,e),Fe=!1}constructor(...e){Fe=!0,(async()=>{for(let t=0;t<e.length;t++)await this.loadFile(e[t])})()}getCP(e){return this.#a[e]}getStr(e){let t=[],i=this;return Array.from(e).forEach(function(l){t.push(i.#a[l.charCodeAt(0)]||i.#a[32]||Ge)}),t}keys(){return Object.keys(this.#a)}data(e){return this.#a[e]}};var $e=16/9,Se=64,Q=new Float64Array(49),ma="Vx,Dr,D1,D2,D3,D4,D5,D6,D7,D8".split(","),ba=[1,3,6,8,10],St=[0,.5,1,1.5,2,3,3.5,4,4.5,5,5.5,6],ya=2*Math.PI,wa={"?":"Unset",gm:"General MIDI",g2:"General MIDI 2",xg:"Yamaha XG",gs:"Roland GS",sc:"Roland GS",mt32:"Roland MT-32",doc:"Yamaha DOC",qy10:"Yamaha QY10",qy20:"Yamaha QY20",sd:"Roland SD",x5d:"Korg X5D","05rw":"Korg 05R/W",ns5r:"Korg NS5R",k11:"Kawai K11",sg:"Akai SG",trin:"Korg Trinity",krs:"Korg KROSS 2",s90es:"Yamaha S90 ES",cs6x:"Yamaha CS6x",cs1x:"Yamaha CS1x",motif:"Yamaha Motif ES",pa:"Korg PA"},Ea={"C.Lyrics":"Lyrics","C.Marker":"Marker","Cmn.Text":"Text",Copyrite:"Copyright",CuePoint:"Cue Point",EORTitle:"Real Title",Instrmnt:"Instrument","Kar.Info":"Kar. Info","Kar.Lang":"Language","Kar.Mode":"Karaoke","Kar.Ver.":"Kar. Version",KarLyric:"Kar. Lyrics",KarTitle:"Kar. Title",MidStamp:"MIDI Stamp",OSysMeta:"Octavia Sys.",SGLyrics:"SG Lyrics",TrkTitle:"Title",XfSngDte:"XF Date",XfSngRgn:"XF Region",XfSngCat:"XF Category",XfSongBt:"XF Beat",XfSngIns:"XF Instr.",XfSngVoc:"XF Vocalist",XfSngCmp:"XF Compose",XfSngLrc:"XF Lyricist",XfSngArr:"XF Arranger",XfSngPer:"XF Perform.",XfSngPrg:"XF Program.",XfSngTag:"XF Tags",XfKarLng:"XF Lang.",XfKarNme:"XF Name",XfKarCmp:"XK Compo.",XfKarLrc:"XK Lyricist",XfKarArr:"XK Arranger",XfKarPer:"XK Perform.",XfKarPrg:"XK Progr.",XfScneNo:"XF Scene #",XfMeloCh:"XF Melody",XfLyrOff:"XL Offset",XfLyrEnc:"XL Lang.",XfSngPrt:"XL Part",YMCSSect:"Section Ctrl.",YStyleId:"Active Style"},ka=["ChordCtl","MidStamp","RhrslMrk","XfSngRgn","XfSongBt","XfSngIns","XfSngVoc","XfKarLng","XfKarNme","XfMeloCh","XfLyrOff","XfLyrEnc"],Ke=[[],[4,2],[3,2]],Ca=[{l:0,t:0},{l:0,t:416},{l:960,t:0},{l:960,t:416}],Tt={none:{font4:[0,0],cfont4:[0,0],font7:[0,0]},macos:{font4:[2,0],cfont4:[1,0],font7:[0,0]},chromium:{font4:[1,0],cfont4:[0,0],font7:[1,0]}},Te={xg:["9efaa0","006415","9efaa0"],doc:["9efaa0","006415","9efaa0"],qy10:["9efaa0","006415","9efaa0"],qy20:["9efaa0","006415","9efaa0"],ns5r:["9efaa0","006415","9efaa0"],x5d:["9efaa0","006415","9efaa0"],"05rw":["9efaa0","006415","9efaa0"],trin:["9efaa0","006415","9efaa0"],k11:["9efaa0","006415","9efaa0"],s90es:["9efaa0","006415","9efaa0"],motif:["9efaa0","006415","9efaa0"],cs6x:["9efaa0","006415","9efaa0"],an1x:["9efaa0","006415","9efaa0"],cs1x:["9efaa0","006415","9efaa0"],gm:["a1f3ff","005e88","a1f3ff"],g2:["a1f3ff","005e88","a1f3ff"],pa:["a1f3ff","005e88","a1f3ff"],krs:["a1f3ff","005e88","a1f3ff"],gs:["ffe1a5","804e00","ffe1a5"],sc:["ffe1a5","804e00","ffe1a5"],mt32:["ffe1a5","804e00","ffe1a5"],sd:["ffe1a5","804e00","ffe1a5"],sg:["ffdddd","990022","ffdddd"]};Q.forEach((n,e,t)=>{t[e]=Math.PI*e/12});var $=function(n,e,t={}){let i=document.createElement(n);e?.forEach(C=>{i.classList.add(C)});let{t:l,l:h,w:p,h:m,i:b,a:E}=t;return l?.constructor&&(i.style.top=l?.length?l:`${l}px`),h?.constructor&&(i.style.left=h?.length?h:`${h}px`),p?.constructor&&(i.style.width=p?.length?p:`${p}px`),m?.constructor&&(i.style.height=m?.length?m:`${m}px`),b?.constructor&&i.appendChild(document.createTextNode(b)),E?.constructor&&(i.style.textAlign=E),i};var I=function(n,e){e?.forEach(t=>{n.appendChild(t)})},D=function(n,e){e.forEach(t=>{n.classList.contains(t)&&n.classList.remove(t)})},_=function(n,e){e.forEach(t=>{n.classList.contains(t)||n.classList.add(t)})},va=new Array(128).fill(0);va.forEach((n,e,t)=>{t[e]=Math.floor(24*e/12.7)/10});var xa=new Array(128).fill(0);xa.forEach((n,e,t)=>{t[e]=Math.abs(Math.round(48*(e-64)/12.7)/10)});var Pt=new Array(11).fill(null);Pt.forEach((n,e,t)=>{t[e]=`${Math.round(e*12/.0128)/100}%`});var $a=new Array(128).fill(null);$a.forEach((n,e,t)=>{t[e]=`${Math.round(e/1.27)/100}`});var Mt=function(n,e,t){n.innerText=e,n.rNew=!0;let i=n.font.substring(0,6)==="italic";t&&!i?n.font=`italic ${n.font}`:!t&&i&&(n.font=n.font.substring(7));let l=n.measureText(e);n.rWidth=l.width};HTMLElement.prototype.setTextRaw=function(n){let e;this.childNodes[0]?.nodeType===3?(e=this.childNodes[0],e.data=n):(e=document.createTextNode(n),this.prepend(e))};if(typeof self?.require<"u")throw new Error("Environments supporting CommonJS is not supported.");var Qr=class extends vt{#a=16;#h=32;#C=128;#v=!1;#k="";#x;#P=0;#d=0;#i=0;#e=0;#b=0;#n;#g=0;#u=!1;#c=y.invalidCh;#o=1;#R=0;#T=0;#$=0;#y=new Uint8Array(1280);#s=new Uint8Array(1280);#f=new Uint8Array(1280);#J=new Uint8Array(512);#D=new Uint8Array(512);#B=new Uint8Array(512);#O=new Uint8Array(y.ch);#K;#Z;#m;#w;#Y;#N="fcdaff";#X=new Array(y.ch);#H=new Array(y.ch);#S="ffffff";#V="?";#t={};#L={};#l=[];#r={};#A={};eventViewMode=0;useElementCount=!0;#te=[];#p="comb";glyphs=new $t;panStyle=11;pixelMin=12;pixelMax=255;#j(n,e,t,i=0,l=0,h){let p=this,{width:m,height:b}=n.canvas,E,C,a,s,c=p.#o,r=0,d=ba.indexOf(e%12)>-1;switch(i){case p.device.NOTE_HELD:case p.device.NOTE_SOSTENUTO_SUSTAIN:case p.device.NOTE_SOSTENUTO_HELD:{r=1;break}case p.device.NOTE_MUTED_RECOVERABLE:{r=2;break}}switch(p.#p){case"block":case"comb":{E=Math.round(e*m/128),C=Math.round((e+1)*m/128),a=C-E,s=c===1?2:1;break}case"piano":{E=Math.round((Math.floor(e/12)*7+St[e%12])*m/75*1.0044642857142856),C=Math.round((Math.floor(e/12)*7+St[e%12]+1)*m/75*1.0044642857142856)-1,a=C-E,s=c===1?3:1;break}case"line":{let o=e-l;Math.abs(l)>2&&(o=e-Math.sign(l)*2),C=Math.round((e+.5)*m/128),E=Math.round((o+.5)*m/128)}default:}switch(n.fillStyle=`#${d?p.getChAccent(h):p.#S}${(t<<1|t>>6).toString(16).padStart(2,"0")}`,n.strokeStyle=n.fillStyle,n.lineWidth=c===1?4:2,n.lineDashOffset=0,p.#p){case"block":{let o=n.canvas.height-1;n.fillRect(E,0,a,o),r>0&&n.clearRect(E+s,s,a-(s<<1),o-(s<<1)),r===2&&n.clearRect(E,s<<1,a,o-(s<<2));break}case"comb":{let o=(d?Math.round((n.canvas.height<<1)/3):n.canvas.height)-1;n.fillRect(E,0,a,o),r>0&&n.clearRect(E+s,s,a-(s<<1),o-(s<<1)),r===2&&n.clearRect(E,s<<1,a,o-(s<<2));break}case"piano":{let o=d?0:n.canvas.height>>1,f=(n.canvas.height>>1)-1;n.fillRect(E,o,a,f),r>0&&n.clearRect(E+s,o+s,a-(s<<1),f-(s<<1)),r===2&&n.clearRect(E,o+(s<<1),a,f-(s<<2));break}case"line":{if(r===1)switch(c){case 4:{n.setLineDash(Ke[2]);break}default:n.setLineDash(Ke[1])}else n.setLineDash(Ke[0]),c!==4&&self?.document?.mozFullScreen&&(E+=.5,C+=.5);n.beginPath(),n.moveTo(E,(c===4||!r)&&self?.document?.mozFullScreen?1:0),n.lineTo(C,(b>>1)+1),n.lineTo(E,b),n.stroke();break}default:}}#ae(n,e){let t=this;(n?.chInUse||e).forEach((i,l)=>{if(i){let h=t.#l[l>>4][l&15].cxt;h.clearRect(0,0,h.canvas.width,h.canvas.height),n.chKeyPr[l].forEach(({v:p,s:m},b)=>{t.#j(h,b,p,m,t.device.getPitchShift(l),l)})}})}#ue(n){let e=this;e.clockSource.now()-e.#P>4e3&&(e.#d=0,e.#i=142-e.#r.view.clientHeight,(e.#x?.clientWidth||0)>840&&(e.#d=840-e.#x.clientWidth),e.#r.view.style.transform=`translateX(${e.#d}px) translateY(${e.#i}px)`,n&&(e.#P=0))}#me(){let n=self.innerWidth/self.innerHeight,e=1,t=self.innerWidth,i=self.innerHeight;n>=$e?(e=Math.min(Math.round(self.innerHeight/1080*1e4)/1e4,100),t=Math.ceil(self.innerHeight*$e)):n<$e&&(e=Math.min(Math.round(self.innerWidth/1920*1e4)/1e4,100),i=Math.ceil(self.innerWidth/$e)),this.#m.style.width=`${t}px`,this.#m.style.height=`${i}px`,this.#w.style.transform=`scale(${e})`}#ie;#be(){let n=this,e=n.#K?.currentTime||0,t=n.render(e),i=n.clockSource.now(),l=t.curPoly+t.extraPoly,h=t.curPolyEC+t.extraPolyEC;n.#e<l&&(n.#e=l),n.#b<h&&(n.#b=h),n.#t.curPoly.setTextRaw(`${n.useElementCount?h:l}`.padStart(3,"0")),n.#t.maxPoly.setTextRaw(`${n.useElementCount?n.#b:n.#e}`.padStart(3,"0")),n.#K?.realtime?(n.#t.barCount.setTextRaw("LINE"),n.#t.barDelim.style.display="none",n.#t.barNote.setTextRaw("IN")):(n.#t.barCount.setTextRaw(t.noteBar+1),n.#t.barDelim.style.display="",n.#t.barNote.setTextRaw(Math.floor(t.noteBeat)+1));let p=[7,11,1,91,93,94,74,5,256,256],m=n.#R+n.#o;for(let a=0;a<y.ch;a++){let s=a>>4,c=a*y.ace,r=n.#l[s][a&15];if(n.device.getActive()[a]&&s>=n.#R&&s<m){p[8]=t.ace[c+0]||256,p[9]=t.ace[c+1]||256,r.ccVis.clearRect(0,0,109,25),r.ccVis.fillStyle=`#${n.getChAccent(a)}`,r.ccVis.strokeStyle=`#${n.getChAccent(a)}`,r.ccVis.lineWidth=2;for(let o=0;o<p.length;o++){let f=p[o];if(f<256){let g=n.device?.getChCc(a,f),u=g*24/127;if(u>0){let w=24-u;r.ccVis.fillRect(o*6,w,4,u)}}}let d=n.device?.getChCc(a,10)||1;switch(n.panStyle){case 7:case 6:case 5:case 3:case 2:case 1:{let o=(d+125)*.024933275,f=(d-64)*.024933275;r.ccVis.beginPath(),d>127?n.panStyle>>1&1&&(r.ccVis.arc(84.5,22.5,21.5,0,Q[12],!0),r.ccVis.stroke()):(n.panStyle>>1&1&&(d<64?(r.ccVis.arc(84.5,22.5,21.5,Q[18],o,!0),r.ccVis.stroke()):d>64&&(r.ccVis.arc(84.5,22.5,21.5,Q[18],o),r.ccVis.stroke())),n.panStyle&1&&(r.ccVis.strokeStyle=`#${n.#S}`,r.ccVis.lineWidth=n.panStyle>>2?1:3,r.ccVis.beginPath(),r.ccVis.moveTo(84.5,22.5),d===64?r.ccVis.lineTo(84.5,4):r.ccVis.lineTo(84.5+18*Math.sin(f),22.5-18.5*Math.cos(f)),r.ccVis.stroke())),n.panStyle>>2&1&&(r.ccVis.fillStyle=`#${n.#S}`,r.ccVis.beginPath(),r.ccVis.arc(84.5,22.5,2.5,0,Q[4]),r.ccVis.fill());break}case 11:case 10:case 9:{let o=(d+77)*.033244367,f=(d-64)*.033244367;r.ccVis.beginPath(),d>127?n.panStyle>>1&1&&(r.ccVis.arc(84.5,16.5,15.5,Q[26],Q[34],!0),r.ccVis.stroke()):(n.panStyle>>1&1&&(d<64?(r.ccVis.arc(84.5,16.5,15.5,Q[18],o,!0),r.ccVis.stroke()):d>64&&(r.ccVis.arc(84.5,16.5,15.5,Q[18],o),r.ccVis.stroke())),n.panStyle&1&&(r.ccVis.strokeStyle=`#${n.#S}`,r.ccVis.lineWidth=3,r.ccVis.beginPath(),r.ccVis.moveTo(84.5,16.5),d===64?r.ccVis.lineTo(84.5,4):r.ccVis.lineTo(84.5+11.5*Math.sin(f),16.5-11.5*Math.cos(f)),r.ccVis.stroke())),(!(n.panStyle&1)||d>>7)&&(r.ccVis.fillStyle=`#${n.#S}`,r.ccVis.beginPath(),r.ccVis.arc(84.5,16.5,2.5,0,Q[24]),r.ccVis.fill());break}default:{let o=Math.abs(d-64)/2.625;d<64?r.ccVis.fillRect(84-o,0,o,24):d>127?(r.ccVis.fillRect(60,0,49,24),r.ccVis.clearRect(61,1,47,22)):r.ccVis.fillRect(85,0,o,24),r.ccVis.fillStyle=`#${n.#S}`,r.ccVis.fillRect(84,0,1,24)}}if(r.metre.clearRect(0,0,121,25),r.metre.fillStyle=`#${n.#S}`,r.metre.globalCompositeOperation="source-over",r.metre.rWidth>r.metre.canvas.width){r.metre.rNew&&(r.metre.rNew=!1,r.metre.rOffset=e);let o=e-(r.metre.rOffset||0),f=32,g=r.metre.rWidth-r.metre.canvas.width+f,u=o*-25%(r.metre.rWidth+f+48)+48;u>0&&(u=0),r.metre.fillText(r.metre.innerText,u,3+n.#Y.cfont4[0]),Math.abs(u)>g&&r.metre.fillText(r.metre.innerText,u+r.metre.rWidth+f,3+n.#Y.cfont4[0])}else r.metre.fillText(r.metre.innerText,0,3+n.#Y.cfont4[0]);switch(r.metre.globalCompositeOperation="xor",r.metre.fillRect(0,0,t.strength[a]*121/255,25),r.extVis.clearRect(0,0,47,25),r.extVis.fillStyle=`#${n.#S}`,t.chExt[a][0]){case n.device.EXT_VL:{let o=(n.device?.getChCc(a,136)-64)/64||t.rawPitch[a]/8192;o=o*-4+4;let f=+(t.rawVelo[a]>0||n.device?.getChCc(a,1)>0)*(n.device?.getChCc(a,129)*n.device?.getChCc(a,11)/16129);!f&&t.rawStrength[a]&&(f=t.rawStrength[a]*n.device?.getChCc(a,11)/16129),f*=32;let g=n.device?.getChCc(a,1)/127*8;r.extVis.beginPath(),r.extVis.moveTo(0,12-o-3),r.extVis.lineTo(7+f,12),r.extVis.lineTo(0,12+o+3),r.extVis.fill(),r.extVis.fillStyle=`#${n.getChAccent(a)}`,r.extVis.beginPath(),r.extVis.ellipse(43,12,4,4+g,0,0,ya),r.extVis.fill();break}case n.device.EXT_DX:{for(let o=0;o<16;o++){let f=o+142,g=n.device?.getChCc(a,f);o>=8&&(r.extVis.fillStyle=`#${n.getChAccent(a)}`);let u=o*3,w=(g-64)/5.82;w>=0?r.extVis.fillRect(u,12-w,2,w+1):r.extVis.fillRect(u,12,2,1-w)}break}}}}let b=new Array(y.ch);if(n.#l.forEach((a,s)=>{a.forEach((c,r)=>{c.refresh&&(c.refresh=!1,b[s<<7|r]=!0)})}),["line"].indexOf(n.#p)>-1)for(;n.#te.length>0;){let a=n.#te.shift();b[a.part]=!0}n.#ae(t,b),t.extraNotes.forEach(a=>{let{part:s,note:c,velo:r,state:d}=a,o=n.#l[s>>4][s&15].cxt;n.#j(o,c,r,d,n.device.getPitchShift(s),s)});let E=n.#A.cxt;if(i>t.bitmap.expire?n.#B.fill(0):t.bitmap.bitmap.length>256?t.bitmap.bitmap.forEach((a,s)=>{n.#B[s]=a?n.pixelMax:n.pixelMin}):t.bitmap.bitmap.forEach((a,s)=>{n.#B[s<<1]=a?n.pixelMax:n.pixelMin,n.#B[s<<1|1]=a?n.pixelMax:n.pixelMin}),n.#f.fill(0),i<=t.letter.expire&&n.glyphs.getStr(t.letter.text.padEnd(32," ")).forEach((a,s)=>{let c=(s&15)*5,r=s>>4<<3;a.forEach((d,o)=>{let f=c+o%5,g=r+Math.floor(o/5);n.#f[g*80+f]=d?n.pixelMax:n.pixelMin})}),n.#J.forEach((a,s,c)=>{let r=n.#B[s];r>a?c[s]+=Math.min(r-a,Se):r<a&&(c[s]-=Math.min(a-r,Se))}),n.#y.forEach((a,s,c)=>{let r=n.#f[s];r>a?c[s]+=Math.min(r-a,Se):r<a&&(c[s]-=Math.min(a-r,Se))}),n.#J.forEach((a,s)=>{let c=s>>5,r=s&31;n.#D[s]!==a?(E.clearRect(252+(r<<2),c<<2,3,3),a&&(E.fillStyle=`#${n.#S}${a.toString(16).padStart(2,"0")}`,E.fillRect(252+(r<<2),c<<2,3,3))):T()&&(E.clearRect(252+(r<<2),c<<2,3,3),a&&(E.fillStyle=`#ff0000${a.toString(16).padStart(2,"0")}`,E.fillRect(252+(r<<2),c<<2,3,3)))}),n.#y.forEach((a,s)=>{let c=Math.floor(s/80),r=s%80;r+=Math.floor(r/5),n.#s[s]!==a?(E.clearRect(r<<2,(c|16)<<2,3,3),a&&(E.fillStyle=`#${n.#S}${a.toString(16).padStart(2,"0")}`,E.fillRect(r<<2,(c|16)<<2,3,3))):T()&&(E.clearRect(r<<2,(c|16)<<2,3,3),a&&(E.fillStyle=`#ff0000${a.toString(16).padStart(2,"0")}`,E.fillRect(r<<2,(c|16)<<2,3,3)))}),n.#D.forEach((a,s,c)=>{c[s]=n.#J[s]}),n.#s.forEach((a,s,c)=>{c[s]=n.#y[s]}),T()){E.clearRect(0,0,251,63);for(let a=0;a<=n.device.polyIndexLast;a++){let s=a&31,c=a>>5;if(a+1===n.device.polyIndexLatest)E.fillStyle="#ff0";else switch(n.device.getPolyState(a)){case n.device.NOTE_SUSTAIN:{E.fillStyle="#0f0";break}case n.device.NOTE_HELD:case n.device.NOTE_SOSTENUTO_HELD:{E.fillStyle="#0f7";break}case n.device.NOTE_SOSTENUTO_SUSTAIN:{E.fillStyle="#70f";break}case n.device.NOTE_MUTED_RECOVERABLE:{E.fillStyle="#f70";break}default:E.fillStyle="#f00"}E.fillRect(s<<2,c<<2,3,3)}}let C=(self.performance||self.Date).now();switch(n.eventViewMode){case 0:{n.#t.events.setTextRaw(`${t.eventCount}`.padStart(3,"0"));break}case 1:{let a=1e3/(C-n.#T);a>99?(a=Math.round(a),n.#t.events.setTextRaw(`${a}`)):a>9?(a=Math.round(a*10)/10,n.#t.events.setTextRaw(`${Math.floor(a)}.${Math.floor(a*10%10)}`)):(a=Math.round(a*100)/100,n.#t.events.setTextRaw(`${Math.floor(a)}.${Math.floor(a*100%100)}`));break}case 2:{n.#t.events.setTextRaw(`${n.device.polyIndexLatest}`.padStart(3,"0"));break}default:n.#t.events.setTextRaw("???")}n.#T=C}#q;#G;get style(){return this.#p}set style(n){let e=this;e.#p=n,e.#ae(e.render(e.#K?.currentTime||0)),D(e.#w,["cambiare-style-block","cambiare-style-comb","cambiare-style-piano","cambiare-style-line"]),_(e.#w,[`cambiare-style-${n}`])}getChMode(n=0,e){if(n>=y.ch)throw new RangeError("Invalid part number");let t=this;return e?t.#H[n]:t.#H[n]??t.#V}getChAccent(n=0){if(n>=y.ch)throw new RangeError("Invalid part number");let e=this;return e.#X[n]??e.#N}setClockSource(n){this.#K=n}setPixelProfile(n){let e=this;if(Tt[n]){let t=Tt[n];e.#Y=t,e.#w&&(e.#w.style.setProperty("--pcp-font4",`translate(${t.font4[1]}px, ${t.font4[0]}px)`),e.#w.style.setProperty("--pcp-font7",`translate(${t.font7[1]}px, ${t.font7[0]}px)`))}else throw new Error(`"${n}" is not a valid pixel correction profile`)}setMode(n){let e=this;e.#V=n,e.#N=(Te[n]||["fcdaff","742b81","fcdaff"])[e.#$];for(let t of e.#w.classList)t.substring(0,14)==="cambiare-mode-"&&e.#w.classList.remove(t);n!=="?"&&e.#w.classList.add(`cambiare-mode-${n}`)}setChMode(n,e){let t=this;t.#H[n]=e;let i=t.#l[n>>4][n&15];for(let l of i.root.classList)l.substring(0,10)==="part-mode-"&&i.root.classList.remove(l);e!=="?"&&i.root.classList.add(`part-mode-${e}`)}setScheme(n=0){let e=this;e.#$=n>=0&&n<3?n:0,e.#S=["ffffff","000000","ffffff"][e.#$],D(e.#w,["cambiare-scheme-light","cambiare-scheme-luma"]),e.#$&&_(e.#w,[[null,"cambiare-scheme-light","cambiare-scheme-luma"][e.#$]]),e.#N=(Te[e.#V]||["fcdaff","742b81","fcdaff"])[e.#$];for(let t=0;t<y.ch;t++)if(e.device.getChActive(t)!==0&&e.#X[t]){let i=Te[e.#H[t]];i&&(e.#X[t]=i[e.#$])}}#re(n){let e=this,t=e.#o,i=e.#R;e.#l.forEach((l,h)=>{if(h>=i&&h<i+t){_(l.root,["port-active"]);let p=h-i,{l:m,t:b}=Ca[p*(4/t)];l.root.style.top=`${b}px`,l.root.style.left=`${m}px`,l.forEach((E,C)=>{E.root.style.top=`${C*(t>2?26:52)}px`})}else D(l.root,["port-active"]),l.root.style.top="",l.root.style.left="",l.forEach((p,m)=>{p.root.style.top=""});n&&l.forEach((p,m)=>{p.cxt.canvas.width=e.#o===1?1193:495,p.cxt.canvas.height=e.#o===4?26:52})})}setPort(n){let e=this;D(e.#w,["cambiare-start0","cambiare-start1","cambiare-start2","cambiare-start3","cambiare-start4","cambiare-start5","cambiare-start6","cambiare-start7"]),_(e.#w,[`cambiare-start${n}`]),e.#R=n,e.#re(!1)}setRange(n){let e=this;D(e.#w,["cambiare-port1","cambiare-port2","cambiare-port4","cambiare-compact"]),_(e.#w,[`cambiare-${n}`]),e.#o=parseInt(n.slice(4))||1,e.#re(!0)}setFrameTime(n=20){let e=this;e.#G?.constructor&&clearInterval(e.#G),n<5?n=5:n>500&&(n=500),e.#G=setInterval(e.#q,n),e.smoothingAtk=Math.pow(.1,n/20),e.smoothingDcy=Math.pow(.75,n/20)}attach(n){let e=this;e.#Z=n;let t=$("div",["cambiare-container"]);n.appendChild(t),e.#m=t;let i=$("div",["cambiare-canvas","cambiare-port1","cambiare-start0","cambiare-style-comb"]);t.appendChild(i),e.#w=i,self.addEventListener("resize",e.#ie),e.#ie(),e.setFrameTime(20),e.#t.root=$("div",["sect-info"]),e.#t.events=$("span",["field","pcp-font4"],{t:1,l:0,w:35,h:33}),e.#t.curPoly=$("span",["field","pcp-font4"],{t:1,l:52,w:35,h:33}),e.#t.maxPoly=$("span",["field","pcp-font4"],{t:1,l:98,w:35,h:33}),e.#t.sigN=$("span",["field","pcp-font4"],{t:1,l:194,w:23,h:33,a:"right"}),e.#t.sigD=$("span",["field","pcp-font4"],{t:1,l:232,w:23,h:33}),e.#t.barCount=$("span",["field","pcp-font4"],{t:1,l:304,w:35,h:33,a:"right"}),e.#t.barDelim=$("span",["field","field-label","pcp-font4"],{t:0,l:343,w:8,h:33,i:"/"}),e.#t.barNote=$("span",["field","pcp-font4"],{t:1,l:354,w:23,h:33}),e.#t.tempo=$("span",["field","pcp-font4"],{t:1,l:454,w:64,h:33,a:"right"}),e.#t.volume=$("span",["field","pcp-font4"],{t:1,l:562,w:63,h:33,a:"right"}),e.#t.mode=$("span",["field","pcp-font4"],{t:1,l:708,w:152,h:33}),e.#t.reverb=$("span",["field","pcp-font4"],{t:1,l:1e3,w:190,h:33}),e.#t.chorus=$("span",["field","pcp-font4"],{t:1,l:1235,w:190,h:33}),e.#t.delay=$("span",["field","pcp-font4"],{t:1,l:1471,w:190,h:33}),e.#t.insert=$("span",["field","pcp-font4"],{t:1,l:1706,w:190,h:33}),e.#t.title=$("span",["field","pcp-font4"],{t:35,l:50,w:810,h:33}),e.#t.insert1=$("span",["field","pcp-font4"],{t:0,l:40,w:190,h:33}),e.#t.insert2=$("span",["field","pcp-font4"],{t:0,l:40,w:190,h:33}),e.#t.insert3=$("span",["field","pcp-font4"],{t:0,l:40,w:190,h:33}),e.#t.insert4=$("span",["field","pcp-font4"],{t:0,l:40,w:190,h:33}),e.#t.inscon1=$("span",["field","field-collapsive"],{t:35,l:960,w:230,h:33}),e.#t.inscon2=$("span",["field","field-collapsive"],{t:35,l:1195,w:230,h:33}),e.#t.inscon3=$("span",["field","field-collapsive"],{t:35,l:1431,w:230,h:33}),e.#t.inscon4=$("span",["field","field-collapsive"],{t:35,l:1666,w:230,h:33}),I(e.#t.inscon1,[$("span",["field","field-key","pcp-font7"],{t:0,l:0,w:36,h:33,i:"In2",a:"right"}),e.#t.insert1]),I(e.#t.inscon2,[$("span",["field","field-key","pcp-font7"],{t:0,l:0,w:36,h:33,i:"In3",a:"right"}),e.#t.insert2]),I(e.#t.inscon3,[$("span",["field","field-key","pcp-font7"],{t:0,l:0,w:36,h:33,i:"In4",a:"right"}),e.#t.insert3]),I(e.#t.inscon4,[$("span",["field","field-key","pcp-font7"],{t:0,l:0,w:36,h:33,i:"In5",a:"right"}),e.#t.insert4]),i.appendChild(e.#t.root),I(e.#t.root,[e.#t.events,e.#t.curPoly,$("span",["field","field-label","pcp-font4"],{t:1,l:89,w:5,h:33,i:":"}),e.#t.maxPoly,$("span",["field","field-key","pcp-font7"],{t:1,l:148,w:41,h:33,i:"TSig"}),e.#t.sigN,$("span",["field","field-label","pcp-font4"],{t:0,l:221,w:8,h:33,i:"/"}),e.#t.sigD,$("span",["field","field-key","pcp-font7"],{t:1,l:268,w:30,h:33,i:"Bar"}),e.#t.barCount,e.#t.barDelim,e.#t.barNote,$("span",["field","field-key","pcp-font7"],{t:1,l:390,w:61,h:33,i:"Tempo",a:"right"}),e.#t.tempo,$("span",["field","field-key","pcp-font7"],{t:1,l:528,w:29,h:33,i:"Vol"}),e.#t.volume,$("span",["field","field-label","pcp-font4"],{t:1,l:626,w:17,h:33,i:"%"}),$("span",["field","field-key","pcp-font7"],{t:1,l:652,w:52,h:33,i:"Mode"}),e.#t.mode,$("span",["field","field-key","pcp-font7"],{t:1,l:960,w:36,h:33,i:"Rev",a:"right"}),e.#t.reverb,$("span",["field","field-key","pcp-font7"],{t:1,l:1195,w:36,h:33,i:"Cho",a:"right"}),e.#t.chorus,$("span",["field","field-key","pcp-font7"],{t:1,l:1431,w:36,h:33,i:"Var",a:"right"}),e.#t.delay,$("span",["field","field-key","pcp-font7"],{t:1,l:1666,w:36,h:33,i:"In1",a:"right"}),e.#t.insert,e.#t.inscon1,e.#t.inscon2,e.#t.inscon3,e.#t.inscon4,$("span",["field","field-key","pcp-font7"],{t:35,l:0,w:44,h:33,i:"Title"}),e.#t.title]),e.#L.root=$("div",["sect-mark"]),e.#L.left=$("div",["sect-mark-left","boundary"],{t:0,l:0}),e.#L.right=$("div",["sect-mark-right","boundary"],{t:0,l:960}),i.appendChild(e.#L.root),I(e.#L.root,[e.#L.left,e.#L.right]),I(e.#L.left,[$("span",["field","field-key"],{t:0,l:0,w:26,h:33,i:"CH"}),$("span",["field","field-key"],{t:0,l:30,w:49,h:33,i:"Voice"}),$("span",["field","field-key","mark-send-title"],{t:2,l:164,w:25,h:18,i:"Send"}),$("span",["field","field-label","mark-send-param"],{t:16,l:146,w:58,h:16,i:"VEMRCDBP12",a:"center"}),$("span",["field","field-key"],{t:0,l:212,w:35,h:33,i:"Pan"}),$("span",["field","field-key"],{t:0,l:256,w:45,h:33,i:"Note"})]),I(e.#L.right,[$("span",["field","field-key"],{t:0,l:0,w:26,h:33,i:"CH"}),$("span",["field","field-key"],{t:0,l:30,w:49,h:33,i:"Voice"}),$("span",["field","field-key","mark-send-title"],{t:2,l:164,w:25,h:18,i:"Send"}),$("span",["field","field-label","mark-send-param"],{t:16,l:146,w:58,h:16,i:"VEMRCDBP12",a:"center"}),$("span",["field","field-key"],{t:0,l:212,w:35,h:33,i:"Pan"}),$("span",["field","field-key"],{t:0,l:256,w:45,h:33,i:"Note"})]),e.#l.root=$("div",["sect-part"]);for(let l=0;l<y.ch>>4;l++){let h=l<<4;e.#l[l]=[],e.#l[l].root=$("div",["boundary",`part-port-${l}`]);for(let p=0;p<16;p++){let m=(h|p)+1;m>=100?m=`${Math.floor(m/10).toString(16)}${m%10}`:m=`${m}`.padStart(2,"0"),e.#l[l][p]={root:$("div",["boundary","part-channel"]),major:$("div",["boundary","part-info-major"]),minor:$("div",["boundary","part-info-minor"],{t:26}),keys:$("div",["boundary","part-keys"]),notes:$("div",["boundary","part-keyboard"]),cxt:$("canvas",["field"]).getContext("2d"),number:$("span",["field","field-label","pcp-font4"],{t:1,w:18,h:25,i:m}),voice:$("span",["field"],{l:22,t:1,w:121,h:25}),metre:$("canvas",["field"]).getContext("2d"),type:$("span",["field","field-label","pcp-font4"],{t:1,w:18,h:25}),std:$("span",["field","pcp-font4"],{l:22,t:1,w:20,h:25,a:"center"}),msb:$("span",["field","pcp-font4"],{l:48,t:1,w:27,h:25}),prg:$("span",["field","pcp-font4"],{l:81,t:1,w:27,h:25}),lsb:$("span",["field","pcp-font4"],{l:114,t:1,w:27,h:25}),ccVis:$("canvas",["field"],{l:145,t:1}).getContext("2d"),extVis:$("canvas",["field"],{l:207,t:1}).getContext("2d"),ccUpdate:!1};let b=e.#l[l][p];Pt.forEach(E=>{b.notes.appendChild($("span",["field","part-csplit"],{l:E}))}),b.notes.appendChild($("span",["field","part-csplit","part-cdive"],{l:0,w:"100%",h:1})),b.metre.canvas.width=121,b.metre.canvas.height=25,b.metre.textBaseline="top",b.metre.font="20px 'PT Sans Narrow'",b.ccVis.canvas.width=109,b.ccVis.canvas.height=25,b.ccVis.fillStyle=`#${e.#S}`,b.extVis.canvas.width=47,b.extVis.canvas.height=25,b.extVis.fillStyle=`#${e.#S}`,I(b.notes,[b.cxt.canvas]),I(b.keys,[b.notes]),I(b.voice,[b.metre.canvas]),I(b.major,[b.number,b.voice,b.ccVis.canvas]),I(b.minor,[b.type,b.std,b.msb,b.prg,b.lsb,b.extVis.canvas]),I(b.root,[b.major,b.minor,b.keys]),I(e.#l[l].root,[b.root]),b.number.addEventListener("contextmenu",E=>{E.preventDefault(),E.stopImmediatePropagation();let C=l<<4|p;e.#O[C]=+!e.#O[C],[D,_][e.#O[C]](b.root,["part-hidden"])})}e.#l.root.appendChild(e.#l[l].root)}i.appendChild(e.#l.root),e.#r.root=$("div",["sect-meta"]),e.#r.view=$("div",["boundary"]),i.appendChild(e.#r.root),I(e.#r.root,[e.#r.view]),e.#A.root=$("div",["sect-pix","boundary"],{l:1529,t:950,w:379,h:127}),e.#A.cxt=$("canvas",["field"]).getContext("2d"),e.#A.fps=$("span",["field","field-key"],{l:0,w:"100%",h:1}),e.#A.cxt.canvas.width=379,e.#A.cxt.canvas.height=127,I(e.#A.root,[e.#A.cxt.canvas]),i.appendChild(e.#A.root),e.addEventListener("mode",l=>{e.#t.mode.setTextRaw(`${wa[l.data]}`),e.setMode(l.data)}),e.addEventListener("mastervolume",l=>{let h=Math.round(l.data*100)/100;e.#t.volume.setTextRaw(`${Math.floor(h)}.${`${Math.floor(h%1*100)}`.padStart(2,"0")}`)}),e.addEventListener("tempo",l=>{let h=Math.round(l.data*100);e.#t.tempo.setTextRaw(`${Math.floor(h/100)}.${`${Math.floor(h%100)}`.padStart(2,"0")}`)}),e.addEventListener("tsig",l=>{[e.#t.sigN.innerText,e.#t.sigD.innerText]=l.data}),e.addEventListener("title",l=>{e.#t.title.setTextRaw(l.data||"No Title")}),e.addEventListener("voice",({data:l})=>{let h=e.getCachedChVoice(l.part,!0),p=e.getChPrimitives(l.part,!0),m=e.#l[l.part>>4][l.part&15];Mt(m.metre,e.getMapped(h.name),h.refreshFailure||h.ending!==" "),m.type.setTextRaw(ma[e.device.getChType(l.part)]),m.std.setTextRaw(h.standard),m.msb.setTextRaw(`${p[0]}`.padStart(3,"0")),m.prg.setTextRaw(`${p[1]}`.padStart(3,"0")),m.lsb.setTextRaw(`${p[2]}`.padStart(3,"0"))}),e.addEventListener("pitch",l=>{let{part:h,pitch:p}=l.data;e.#l[h>>4][h&15].notes.style.transform=`translateX(${p/1.28}%)`}),e.addEventListener("efxreverb",l=>{if(!l.data?.id)debugger;e.#t.reverb.setTextRaw(e.getEfx(l.data.id))}),e.addEventListener("efxchorus",l=>{if(!l.data?.id)debugger;e.#t.chorus.setTextRaw(e.getEfx(l.data.id))}),e.addEventListener("efxdelay",l=>{if(!l.data?.id)debugger;e.#t.delay.setTextRaw(e.getEfx(l.data.id))}),e.addEventListener("efxinsert0",l=>{if(!l.data?.id)debugger;e.#t.insert.setTextRaw(e.getEfx(l.data.id))}),e.addEventListener("efxinsert1",l=>{if(!l.data?.id)debugger;e.#t.insert1.setTextRaw(e.getEfx(l.data.id)),l.data?.hidden?D(e.#t.inscon1,["field-active"]):_(e.#t.inscon1,["field-active"])}),e.addEventListener("efxinsert2",l=>{if(!l.data?.id)debugger;e.#t.insert2.setTextRaw(e.getEfx(l.data.id)),l.data?.hidden?D(e.#t.inscon2,["field-active"]):_(e.#t.inscon2,["field-active"])}),e.addEventListener("efxinsert3",l=>{if(!l.data?.id)debugger;e.#t.insert3.setTextRaw(e.getEfx(l.data.id)),l.data?.hidden?D(e.#t.inscon3,["field-active"]):_(e.#t.inscon3,["field-active"])}),e.addEventListener("efxinsert4",l=>{if(!l.data?.id)debugger;e.#t.insert4.setTextRaw(e.getEfx(l.data.id)),l.data?.hidden?D(e.#t.inscon4,["field-active"]):_(e.#t.inscon4,["field-active"])}),e.addEventListener("partefxtoggle",l=>{let{part:h,active:p}=l.data;if(h>=y.ch)throw new Error("HORNI");[D,_][p?1:0](e.#l[h>>4][h&15].number,["part-efx"])}),e.addEventListener("channeltoggle",l=>{let{part:h,active:p}=l.data;[D,_][p?1:0](e.#l[h>>4][h&15].root,["part-active"])}),e.addEventListener("channelactive",l=>{if(e.#c<y.ch){let p=e.#l[e.#c>>4][e.#c&15].number;D(p,["part-focus"])}let h=l.data;if(h<y.ch){let p=e.#l[h>>4][h&15].number;_(p,["part-focus"]),e.#c=h}}),e.addEventListener("metacommit",l=>{let h=l.data,p=!1;if(e.#v&&h.type===e.#k&&e.#x){switch(h.type){case"C.Lyrics":case"KarLyric":case"SGLyrics":{I(e.#x,[$("span",["meta-slice"],{i:h.data})]);break}default:e.#x.childNodes[0].data+=h.data}p=!0}else if((h.data?.length||typeof h.data=="object")&&ka.indexOf(h.type)===-1){let m=$("div",["meta-line"]),b=$("span",["field","field-key","meta-type"],{i:Ea[h.type]||h.type});switch(h.mask&&(b.style.display="none"),h.type){case"C.Lyrics":case"KarLyric":case"SGLyrics":{e.#x=$("span",["field","meta-data"]),I(e.#x,[$("span",["meta-slice"],{i:h.data})]);break}case"OSysMeta":{let E=h?.data,C;switch(h?.msg){case"part.rename":{let a=e.device?.getVoice(...e.getCachedChVoice(E.part).sid,e.device?.getChMode(0)).name;C=`CH${E.part+1} was renamed from "${e.getMapped(a)}" (${a}) to "${visualizer.device?.getChCvnString(0)}".`;break}default:console.debug(`Unhandled Octavia system meta event "${h.msg}":
%o`,h.data)}e.#x=$("span",["field","meta-data"],{i:C??`${h.data?.msg}`});break}default:e.#x=$("span",["field","meta-data"],{i:h.data})}for(e.#r.view.appendChild(m),I(m,[b,e.#x]),e.#r.view.children.length>e.#h&&(e.#g=e.clockSource.now()+500,e.#u===0&&console.debug("Meta event garbage collector triggered."),e.#u=1);e.#r.view.children.length>e.#C;)e.#r.view.children[0].remove();p=!0}p&&(e.#v=h.amend??!1,e.#k=h.type??""),e.#ue()}),e.#r.view.style.transform="translateX(0px) translateY(140px)",e.#n=setInterval(async()=>{let l=e.clockSource.now();if(e.#u!==0)switch(e.#u){case 1:{if(l<e.#g)break;e.#r.view.style.transition="none";let h=0;for(;e.#r.view.children.length>e.#a;)e.#r.view.children[0].remove(),h++;e.#ue(),console.debug(`Meta event garbage collector removed ${h} events.`),e.#u=2;break}case 2:{if(l<e.#g+100)break;e.#r.view.style.transition="",T()&&console.debug("Meta event garbage collector restored meta animation."),e.#u=0;break}}},40),e.dispatchEvent("mode","?"),e.dispatchEvent("mastervolume",100),e.dispatchEvent("tempo",120),e.dispatchEvent("tsig",[4,4]),e.dispatchEvent("title",""),e.dispatchEvent("efxreverb",{id:e.device.getEffectType(0)}),e.dispatchEvent("efxchorus",{id:e.device.getEffectType(1)}),e.dispatchEvent("efxdelay",{id:e.device.getEffectType(2)}),e.dispatchEvent("efxinsert0",{id:e.device.getEffectType(3)}),e.#re(!0)}detach(n){let e=this;self.removeEventListener("resize",e.#ie),e.#w.remove(),e.#w=void 0,e.#m.remove(),e.#m=void 0,e.#Z=void 0,clearInterval(e.#G),clearInterval(e.#n)}constructor(n,e){super(new gt,.1,.75);let t=this;t.#ie=t.#me.bind(this),t.#q=t.#be.bind(this),t.#X.fill(null),t.#H.fill(null),n&&t.attach(n),e&&t.setClockSource(e),t.setPixelProfile("none"),t.addEventListener("reset",()=>{t.#e=0,t.#b=0,t.#v=!1,t.#k="",t.#x=null,t.#c=y.invalidCh,t.#X.fill(null),t.#H.fill(null),D(t.#t.inscon1,["field-active"]),D(t.#t.inscon2,["field-active"]),D(t.#t.inscon3,["field-active"]),D(t.#t.inscon4,["field-active"]);try{let i=t.#r.view.children;for(let l=i.length-1;l>=0;l--)i[l].remove();t.#r.view.style.transform="translateX(0px) translateY(140px)";for(let l=0;l<y.ch;l++){let h=t.#l[l>>4][l&15];D(h.root,["part-active"]),D(h.number,["part-efx","part-focus"]);for(let p of h.root.classList)p.substring(0,10)==="part-mode-"&&h.root.classList.remove(p);Mt(h.metre,""),h.type.setTextRaw(""),h.std.setTextRaw(""),h.msb.setTextRaw(""),h.prg.setTextRaw(""),h.lsb.setTextRaw(""),h.notes.style.transform="",h.ccUpdate=!0}}catch{}}),t.addEventListener("chmode",({data:i})=>{let{part:l,mode:h}=i;t.setChMode(l,h);let p=Te[h];p&&(t.#X[l]=p[t.#$])}),t.addEventListener("pitch",({data:i})=>{t.#te.push(i)})}};export{Qr as Cambiare};
