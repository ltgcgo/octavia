"use strict";let ye=function(p,e){let a=Math.min(p.length,e.length),l=p.slice(0,a),d=e.slice(0,a),u=0,E=0;for(;E<a&&u==0;)u=Math.sign(l[E]-d[E]),E++;return u},L=function(p=""){this.name=p,this.pool=[],this.point=function(e,a=!1){if(this.pool.length>0){let l=this.pool.length,d=1<<Math.floor(Math.log2(l)),u=d,E=64;for(;d>=1&&E>=0;){if(E<=0)throw new Error("TTL reached.");if(u==l)u-=d;else{let k=ye(e,this.pool[u]);switch(k){case 0:{E=0;break}case 1:{u+d<=l&&(u+=d);break}case-1:{u!=0&&(u-=d);break}default:console.warn(`Unexpected result ${k}.`)}}d=d>>1,E--}let $=!0;if(u>=this.pool.length)$=!1;else{let k=this;this.pool[u].forEach(function(w,S,t){$&&w!=e[S]&&($=!1)}),!$&&ye(e,this.pool[u])>0&&u++}return $||a?u:-1}else return a?0:-1},this.add=function(e,a){return e.data=a,this.pool.splice(this.point(e,!0),0,e),this},this.default=function(e){console.warn(`No match in "${this.name||"(unknown)"}" for "${e}". Default action not defined.`)},this.get=function(e){let a=this.point(e);if(a>-1)return this.pool[a].data;this.default(e)},this.run=function(e,...a){let l=this.point(e);l>-1?e.subarray?this.pool[l].data(e.subarray(this.pool[l].length),...a):this.pool[l].data(e.slice(this.pool[l].length),...a):this.default(e,...a)}};let Ce=class{#t={};addEventListener(p,e){this.#t[p]||(this.#t[p]=[]),this.#t[p].unshift(e)}removeEventListener(p,e){if(this.#t[p]){let a=this.#t[p].indexOf(e);a>-1&&this.#t[p].splice(a,1),this.#t[p].length<1&&delete this.#t[p]}}dispatchEvent(p,e){let a=new Event(p),l=this;a.data=e,this.#t[p]?.length>0&&this.#t[p].forEach(function(d){try{d?.call(l,a)}catch(u){console.error(u)}}),this[`on${p}`]&&this[`on${p}`](a)}};let Ge=["MSB","PRG","LSB","NME","ELC","DRM","LVL","VXP"],Be={krs:"KR",s90es:"ES",motif:"ES"},Xe={krs:"Kr",s90es:"SE",motif:"ME"},te={g2:new Set("gm,GM,g2,G2".split(",")),xg:new Set};for(let p of"XG,MU,AN,AP,DR,DX,PC,PF,SG,VL".split(","))te.xg.add(p),te.xg.add(p.toLowerCase());let oe=function(p){let e=Math.floor(p/10),a=p%10;return`${e.toString(16)}${a}`},le=class{HINT_XG_MUBASIC=0;HINT_XG_MU100=1;HINT_XG_PSR=2;#t;get bankInfo(){return this.#t}strictMode=!1;get(p=0,e=0,a=0,l,d=0){let u=[p,e,a],E,$=1,k=0,w,S,t,s=Array.from(arguments);switch(l){case"xg":{switch(p){case 0:{if(d===2)a>>4===7?s[2]+=16:a>>3===13&&(s[2]+=40);else switch(a){case 127:{s[2]=0;break}}break}case 16:{a===126&&(s[2]=0);break}case 32:{a>125&&(s[2]=0),s[2]+=4;break}case 33:{(a>125||a===3)&&(s[2]=0),s[2]+=5;break}case 34:case 35:case 36:{a>125&&(s[2]=0),s[2]+=5;break}case 79:case 80:case 81:case 82:case 83:case 84:s[0]+=16;case 95:case 96:case 97:case 98:case 99:case 100:{a===126&&(s[2]=0);break}case 48:case 64:case 126:case 127:{a===126&&(p===127&&e===0||(s[2]=0));break}case 121:{switch(a){case 126:{s[2]=0;break}case 16:{s[2]=15;break}default:s[2]=s[2]&15}break}}break}case"gs":case"sc":{p===0&&a<5?s[0]=49:p<128&&p>125&&a<5&&a!==2&&(s[2]=p,s[0]=49);break}case"mt32":{p===0&&(s[0]=49);break}case"sd":{switch(p){case 121:{s[0]=96;break}case 120:{s[0]=104;break}}s[0]>>1===40?s[2]|=16:s[0]>95&&s[0]<100&&(s[2]|=16,e>>4===7&&(s[0]=96));break}case"pa":{switch(p){case 120:{a==64?s[2]=2:s[2]=1;break}case 121:{switch(a){case 127:{s[2]=79;break}default:s[2]=(s[2]&63)+32}break}}break}case"g2":{p>>1===40?s[2]|=16:p>95&&p<100&&(s[2]|=16,e>>4===7&&(s[0]=96));break}case"sg":{p===8&&a===0&&(s[2]=5);break}case"05rw":case"x5d":{p&&p<56&&(s[0]=56);break}case"s90es":case"motif":case"an1x":case"cs1x":case"cs6x":{if(p===0)break;switch(p){case 63:{switch(l){case"s90es":{a<8?s[2]+=17:a<32?s[2]+=13:s[2]=(s[2]>>3)+19;break}case"motif":{a<8?s[2]+=28:a<32?s[2]+=13:s[2]=(s[2]>>3)+19;break}case"cs1x":{switch(a>>1){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:case 10:{s[2]+=34;break}case 32:{s[2]=34+((a&1)<<2);break}case 33:{s[2]=47+((a&1)<<2);break}case 61:{s[2]=34+((a&1)<<2);break}case 62:{s[2]=47+((a&1)<<2);break}}break}}break}case 32:{a>125&&(s[2]=0),s[2]+=4;break}case 33:{(a>125||a===3)&&(s[2]=0),s[2]+=5;break}case 34:case 35:case 36:{a>125&&(s[2]=0),s[2]+=5;break}case 79:case 80:case 81:case 82:case 83:case 84:s[0]+=16;case 95:case 96:case 97:case 98:case 99:case 100:{a===126&&(s[2]=0);break}}break}}let o=" ",r="M",n="",c=0,i=0;switch(s[0]){case 0:{switch(s[2]){case 127:{r="GM-a";break}case 126:{r="GM-n";break}case 7:{r="GM-k",n="GLX";break}case 5:{r="SG-a",n="000";break}case 4:{l==="gs"||l==="sc"?(r="GM-a",n="000"):(r="SP-l",n="C/M");break}case 3:case 2:case 1:{(l==="gs"||l==="sc")&&(r="GM-a",n="000");break}case 0:{r="GM-a";break}default:r="y",c=3}break}case 8:{l==="sg"?r="GM-s":r="r:";break}case 32:case 33:case 34:case 35:case 36:{l==="xg"&&(r=`${["AP","VL","PF","DX","AN"][p&7]}-${"abcdefgh"[a]}`,c=3);break}case 48:{n=`M${(s[2]>>3).toString().padStart(2,"0")}`,r=`y${n}`,c=1;break}case 49:{s[2]>>1===63?(r=`MT-${"ba"[s[2]&1]}`,n=`C${"-/"[s[2]&1]}M`):(r="GM-a",n="000");break}case 56:{r="GM-b";break}case 57:r=["yDOC","QY10","QY20"][s[2]-112]||"yMxv",n=["DOC","QY1","QY2"][s[2]-112]||"057";case 61:case 128:{r="rDrm";break}case 120:{r="gDrm";break}case 62:{r="kDrm";break}case 63:{if(s[2]<17){let C=s[2];r=C<10?"kP:":"kC:",r+=C%10}else if(s[2]<34)r=["Pre1","Pre2","Pre3","Pre4","Usr1","Usr2","DrmP","DrmU","Plg1","Plg2","Plg3","Pre1","Pre2","Pre3","Pre4","Pre5","Pre6"][s[2]-17];else if(s[2]<55){let C=s[2]-34;switch(C>12&&C--,a>>1){case 32:case 33:{r=`Pr${a-63}U`;break}case 61:case 62:{r=`Pr${a-121}U`;break}default:r=s[2]===46?"PrDr":`Pr${(C>>2)+1}${String.fromCharCode(65+(C&3))}`}}else r="Ds";c=1;break}case 64:{r="ySFX",n="SFX";break}case 67:{r="DX:S";break}case 80:case 81:case 82:case 83:{r=`Prg${"UABC"[s[0]-80]}`;break}case 88:case 89:case 90:case 91:{r=`Cmb${"UABC"[s[0]-88]}`;break}case 95:{r=`${["DR","PC"][s[2]]}-d`;break}case 96:{r=s[2]===106?"AP-a":s[2]>>4===1?"SDg":"PF",s[2]>63?i=63:s[2]>>4===1&&(i=16),c=3;break}case 97:{r=s[2]>>4===1?"SDa":"VL:",c=3,s[2]>>4===1?i=16:i=112;break}case 98:{r=s[2]>>4===1?"SDb":"SG-a",c=3,i=16;break}case 99:{r=s[2]>>4===1?"SDc":"DX",s[2]>63?i=63:s[2]>>4===1&&(i=16),c=3;break}case 100:{r="AN",s[2]>63?i=63:s[2]>>4===1&&(i=16),c=3;break}case 104:case 105:case 106:case 107:{r="SDd",i=104;break}case 121:{r=`GM${s[2]?"":"-a"}`,c=1;break}case 122:{r="lDrm";break}case 126:{r="yDrS";break}case 127:{s[2]===127?r="rDrm":r="yDrm";break}default:s[0]<48?r="r:":r="M"}r.length<4&&(r+=`${[p,a,s[0],s[2]][c]-i}`.padStart(4-r.length,"0")),n.length<3&&(n+=`${[p,a,p,a][c]}`.padStart(3-n.length,"0")),l==="xg"&&(p===0?s[2]<100?r=r.replace("y0","y:"):s[2]===125&&(r="y126"):p===16?(E=`Voice${((s[2]<<7)+s[1]+1).toString().padStart(3,"0")}`,o=" "):p===35&&a>>1===2&&(E=`DXCH_${(((s[2]&1)<<7)+e+1).toString().padStart(3,"0")}`,o=" "));let f=[s[0],s[1],s[2]];for(;!(E?.length>=0);)if(E=this.#t[s[1]||0][(s[0]<<8)+s[2]]?.name,E){let C=this.#t[s[1]||0][(s[0]<<8)+s[2]];$=C?.poly||$,k=C?.type||k,w=C?.drum,S=C?.level,t=C?.voice}else if(this.strictMode)E="",o="?";else if(s[0]===0&&s[1]===0&&s[2]===0)E="Unloaded";else if(this.#t[s[1]||0][s[0]<<8])s[0]===0?(s[2]=0,o="^"):s[2]<1?(s[0]=0,o="*"):(s[2]--,o="^");else if(p===48)s[0]=0,s[2]=0,o="!";else if(p===62)s[1]--,o=" ",s[1]<1&&!E?.length&&(s[0]=0,o="!");else if(p<63)s[0]===0?(s[2]=0,o="^"):s[2]<1?(s[0]=0,o="*"):s[2]--;else if(p===80)E=`PrgU:${e.toString().padStart(3,"0")}`,o="!";else if(p===88)E=`CmbU:${e.toString().padStart(3,"0")}`,o="!";else if(p===121)E=`GM2Vox0${a}`,o="#";else if(p===122)if(s[1]===32?s[1]:s[1]%=7,E=this.#t[s[1]||0][(s[0]<<8)+s[2]]?.name,E){o=" ";let C=this.#t[s[1]||0][(s[0]<<8)+s[2]];$=C?.poly||$,k=C?.type||k,w=C?.drum,S=C?.level}else E="",o="*";else s[1]===0?(E=`${p.toString().padStart(3,"0")} ${e.toString().padStart(3,"0")} ${a.toString().padStart(3,"0")}`,o="!"):s[0]===0?(s[2]=0,o="^"):s[2]>0?s[2]--:s[1]>0?(s[1]=0,o="!"):(s[0]=0,o="?");let h=[s[0],s[1],s[2]];switch(o){case"^":{switch(l){case"gs":case"sc":case"ns5r":{o=" ";break}case"xg":{(a===126||a===152)&&(o=" ");break}}p===127&&(o=" ");break}case"*":break;case"!":break;case"?":break}let b="??";switch(s[0]){case 0:{s[2]===0?b="GM":s[2]===5||s[2]===7?b="KG":s[2]<154&&(b="XG");break}case 32:case 33:case 35:case 36:{s[2]>4?b=["AP","VL","PF","DX","AN"][s[0]-32]:b="GS";break}case 48:{b="MU";break}case 49:{s[2]>>1===63?b="MT":s[2]<5&&(b="GM");break}case 56:case 62:{b="AG";break}case 61:case 80:case 83:case 88:case 89:case 91:{b="AI";break}case 82:case 90:{b="XD";break}case 63:{s[2]<17?b="KR":s[2]<34?b="ES":s[2]<55?b="CS":b="DS";break}case 64:case 126:{b="XG";break}case 67:case 99:{b=s[2]>>4===1?"SD":"DX";break}case 81:{b="RW";break}case 95:{b=["DR","PC"][s[2]];break}case 96:{b=s[2]===106?"AP":s[2]>>4===1?"SD":"PF";break}case 97:{b=s[2]>>4===1?"SD":"VL";break}case 98:{b=s[2]>>4===1?"SD":"SG";break}case 100:{b="AN";break}case 104:case 105:case 106:case 107:{b="SD";break}case 120:{b=e===0?"GM":["G2","PA","PA"][s[2]]??"G2";break}case 128:{b=e===0?"GM":"GS";break}case 121:{b=s[2]?["G2","XG","PA","PA","PA"][s[2]>>4]:"GM";break}case 122:{b="KG";break}case 127:{b=s[2]===127?"MT":e===0?"GM":"XG";break}default:s[0]<48&&(s[0]===16&&l==="xg"?b="XG":b="GS")}switch(l){case"xg":{let C=0,v=0,T="GM",A=!1,M=!1;if(te.xg.has(b)||te.g2.has(b)?o!==" "?p>>4===6?M=!0:p!==0&&(A=!0):f[2]!==h[2]&&(p===81?a>>3===14?(C=97,v=112,M=!0,T="VL"):a>>3===15&&(A=!0):p===97&&(M=!0)):p>>4===6?M=!0:A=!0,M&&p===0&&a===0&&(v=[0,126,152][d]),A)E="Silence",o="?",b="??";else if(M){let H=this.#t[e][C<<8|v];b=T,E=H?.name,$=H?.poly||$,k=H?.type||k,w=H?.drum,S=H?.level,t=H?.voice,o="^"}break}}if(o!==" ")switch(l){case"krs":case"s90es":case"motif":{E="",b=Be[l],o="?";break}case"g2":{E="GM2 Ext?",o="?";break}case"pa":{o==="^"&&(E="Unknown",o="?");break}case"xg":{if(o!=="^"){switch(p){case 120:case 127:case 126:{E="SilntKit";break}default:E="Silence"}o="?"}break}default:self.debugMode&&(E="",o="?")}return o==="?"&&($=0),{name:E||`${Xe[l]||l.toUpperCase()}${oe(p||0)}${oe(e||0)}${oe(a||0)}`,poly:$,type:k,drum:w,level:S,voice:t,iid:f,eid:h,sid:u,hint:d,ending:o,sect:r,bank:n,standard:b,mode:l}}async load(p,e,a="(internal)",l){let d=this,u=[],E=0,$=0,k=0;p.split(`
`).forEach(function(w,S){let t=w.split("	"),s=[];if(S===0){if(t.forEach(function(o,r){u[Ge.indexOf(o)]=r}),u.length<4){console.debug("Debugger launched.");debugger}}else{let o=0,r=0,n=0,c,i=1,f=0,h,b,C;t.forEach(function(M,H){switch(H){case u[0]:{o=parseInt(M);break}case u[1]:{r=parseInt(M);break}case u[2]:{n=parseInt(M);break}case u[3]:{c=M;break}case u[4]:{M=parseInt(M),M<16?i=M+1:(f=(M&15)+1,i=f);break}case u[5]:{b=M;break}case u[6]:{typeof M=="string"&&(h=parseInt(M));break}case u[7]:{C=M;break}}}),d.#t[r]=d.#t[r]||[];let v=d.#t[r],T={msb:o,prg:r,lsb:n,name:c,poly:i,type:f,drum:b,level:h,voice:C,priority:l},A=!1;l<v[o<<8|n]?.priority&&(A=!0,k++),(!v[o<<8|n]||A||e)&&(v[o<<8|n]=T,E++),$++}}),e||console.debug(`Map: From "${a}", ${$} total, ${E} loaded (${E-k} + ${k}).`)}clearRange(p){let e=p.prg!==void 0?p.prg.constructor===Array?p.prg:[p.prg,p.prg]:[0,127],a=p.msb!==void 0?p.msb.constructor===Array?p.msb:[p.msb,p.msb]:[0,127],l=p.lsb!==void 0?p.lsb.constructor===Array?p.lsb:[p.lsb,p.lsb]:[0,127];for(let d=a[0];d<=a[1];d++){let u=d<<8;for(let E=l[0];E<=l[1];E++){let $=u+E;for(let k=e[0];k<=e[1];k++)delete this.#t[k][$]}}}init(){this.#t=[];for(let p=0;p<128;p++)this.#t.push([""])}async loadFiles(...p){this.init();let e=this;p.forEach(async function(a,l){try{e.load(await(await fetch(`./data/bank/${a}.tsv`)).text(),!1,a,l)}catch{console.error(`Failed loading "${a}.tsv".`)}})}constructor(...p){this.loadFiles(...p)}};let Ee=class{#t={};context;set(p,e){this.#t[p]=e}has(p){return!!this.#t[p]}async read(p,e){if(!this.has(p))throw new Error(`No decoder registered for "${p}"`);return await this.#t[p].call(this.context||this,e)}};let Ke=function(p,e){let a=!0;return e.forEach((l,d)=>{a=a&&p[d]===l}),a},Y=function(p){let e=0;return p.forEach(a=>{e*=256,e+=a}),e},_=new TextDecoder,z=new Ee;z.set("s7e",async function(p){let e=new Uint8Array(await p.slice(0,65536).arrayBuffer()),a="MSB	LSB	PRG	NME",l=[0,0,0,0],d=32,u=0,E=0,$=!0,k=[],w=0;for(;$;){let S=e.subarray(u);([()=>{_.decode(S.subarray(0,4))==="YSFC"?(u+=80,E=1):u++},()=>{if(Ke(S.subarray(0,4),l))k.forEach((t,s,o)=>{let r=Y(e.subarray(t.start+4,t.start+8));t.length=r}),E=2;else{let t=_.decode(S.subarray(0,4)),s=Y(S.subarray(4,8));k.push({type:t,start:s}),u+=8}},()=>{let t=k[w],s=e.subarray(t.start,t.start+t.length),o=32;switch(t.type){case"ENVC":{let r=d;for(;r<s.length;){let n=s.subarray(r,r+o),c=_.decode(n.subarray(0,10)).trimEnd();c.slice(0,5)==="Init "&&(c=""),c&&(a+=`
063	${(n[17]+13).toString().padStart(3,"0")}	${n[19].toString().padStart(3,"0")}	${c}`),r+=o}break}case"EDVC":{let r=d;for(;r<s.length;){let n=s.subarray(r,r+o),c=_.decode(n.subarray(0,10)).trimEnd();c.slice(0,5)==="Init "&&(c=""),c&&(a+=`
063	024	${n[19].toString().padStart(3,"0")}	${c}`),r+=o}break}case"EPVC":{let r=32,n=d;for(;n<s.length;){let c=s.subarray(n,n+r),i=_.decode(c.subarray(0,10)).trimEnd();i==="----------"&&(i=""),i&&(a+=`
063	${(c[17]+1).toString().padStart(3,"0")}	${c[19].toString().padStart(3,"0")}	${i}`),n+=r}break}}w++,w>=k.length&&(E=3,$=!1)}][E]||(()=>{$=!1}))()}return a});z.set("pcg",async function(p){let e=new Uint8Array(await p.arrayBuffer()),a="MSB	LSB	PRG	NME",l=100,d=0,u=0,E=!0,$=[],k=0;for(;E;){let w=e.subarray(l);([()=>{E=_.decode(w.subarray(0,4))==="INI2",u=w[15],l+=16,d=1},()=>{let S=_.decode(w.subarray(0,4)),t=w[5],s=w[7],o=w[11],r=Y(w.subarray(12,16)),n=Y(w.subarray(16,20)),c=Y(w.subarray(36,40)),i=_.decode(w.subarray(44,44+o));$.push({type:S,tipMsb:t,tipLsb:s,nameLen:o,length:r,start:n,entryLen:c,name:i}),l+=64,u--,u<1&&(d=2)},()=>{let S=$[k],t=e.subarray(S.start,S.start+S.length);switch(S.type){case"PRG1":break;case"PBK1":{let s=63,o=(S.tipMsb?6:0)+S.tipLsb;for(let r=0;r<128;r++){let n=r*S.entryLen,c=t.subarray(n,n+S.entryLen),i=_.decode(c.subarray(0,24)).trimEnd().replace("InitProg","");i.length&&o>5&&(a+=`
${s.toString().padStart(3,"0")}	${o.toString().padStart(3,"0")}	${r.toString().padStart(3,"0")}	${i}`)}break}case"CBK1":{let s=63,o=(S.tipMsb?3:0)+S.tipLsb+10;for(let r=0;r<128;r++){let n=r*S.entryLen,c=t.subarray(n,n+S.entryLen),i=_.decode(c.subarray(0,24)).trimEnd().replace("InitCombi","");i.length&&o>12&&(a+=`
${s.toString().padStart(3,"0")}	${o.toString().padStart(3,"0")}	${r.toString().padStart(3,"0")}	${i}`)}break}}k++,k>=$.length&&(d=3,E=!1)}][d]||(()=>{E=!1}))()}return a});let W=["off","hall","room","stage","plate","delay LCR","delay LR","echo","cross delay","early reflections","gate reverb","reverse gate"].concat(new Array(4),["white room","tunnel","canyon","basement","karaoke"],new Array(43),["pass through","chorus","celeste","flanger","symphonic","rotary speaker","tremelo","auto pan","phaser","distortion","overdrive","amplifier","3-band EQ","2-band EQ","auto wah"],new Array(1),["pitch change","harmonic","touch wah","compressor","noise gate","voice channel","2-way rotary speaker","ensemble detune","ambience"],new Array(4),["talking mod","Lo-Fi","dist + delay","comp + dist + delay","wah + dist + delay","V dist","dual rotor speaker"]),q=["melodic","drums","drum set 1","drum set 2","drum set 3","drum set 4","drum set 5","drum set 6","drum set 7","drum set 8"],Ve=[17.1,18.6,20.2,21.8,23.3,24.9,26.5,28,29.6,31.2,32.8,34.3,35.9,37.5,39,40.6,42.2,43.7,45.3,46.9,48.4,50],K=[20,22,25,28,32,36,40,45,50,56,63,70,80,90,100,110,125,140,160,180,200,225,250,280,315,355,400,450,500,560,630,700,800,900,1e3,1100,1200,1400,1600,1800,2e3,2200,2500,2800,3200,3600,4e3,4500,5e3,5600,6300,7e3,8e3,9e3,1e4,11e3,12e3,14e3,16e3,18e3,2e4],ge=[0,.04,.08,.13,.17,.21,.25,.29,.34,.38,.42,.46,.51,.55,.59,.63,.67,.72,.76,.8,.84,.88,.93,.97,1.01,1.05,1.09,1.14,1.18,1.22,1.26,1.3,1.35,1.39,1.43,1.47,1.51,1.56,1.6,1.64,1.68,1.72,1.77,1.81,1.85,1.89,1.94,1.98,2.02,2.06,2.1,2.15,2.19,2.23,2.27,2.31,2.36,2.4,2.44,2.48,2.52,2.57,2.61,2.65,2.69,2.78,2.86,2.94,3.03,3.11,3.2,3.28,3.37,3.45,3.53,3.62,3.7,3.87,4.04,4.21,4,37,4.54,4.71,4.88,5.05,5.22,5.38,5.55,5.72,6.06,6.39,6.73,7.07,7.4,7.74,8.08,8.41,8.75,9.08,9.42,9.76,10.1,10.8,11.4,12.1,12.8,13.5,14.1,14.8,15.5,16.2,16.8,17.5,18.2,19.5,20.9,22.2,23.6,24.9,26.2,27.6,28.9,30.3,31.6,33,34.3,37,39.7],me=function(p){let e=.1,a=-.3;return p>66?(e=5,a=315):p>56?(e=1,a=47):p>46&&(e=.5,a=18.5),e*p-a},ke=function(p){return p>105?Ve[p-106]:p>100?p*1.1-100:p/10},$e=",a,i,u,e,o,ka,ki,ku,ke,ko,ky,kw,sa,si,su,se,so,sh,ta,ti,tu,te,to,t,ch,t,s,na,ni,nu,ne,no,ny,nn,ha,hi,hu,he,ho,hy,fa,fi,fu,fe,fo,ma,mi,mu,me,mo,my,mm,ya,yu,ye,yo,ra,ri,ru,re,ro,ry,wa,wi,we,wo,ga,gi,gu,ge,go,gy,gw,za,zi,zu,ze,zo,ja,ji,ju,je,jo,jy,da,di,du,de,do,dy,ba,bi,bu,be,bo,by,va,vi,vu,ve,vo,pa,pi,pu,pe,po,py,nga,ngi,ngu,nge,ngo,ngy,ng,hha,hhi,hhu,hhe,hho,hhy,hhw,*,_,,,~,.".split(","),he={};`hi*,
ka,„Åã
ki,„Åç
ku,„Åè
ke,„Åë
ko,„Åì
ky,„Åç!
kw,„Åèl
tsu,„Å§
ts,„Å§l
sa,„Åï
si,„Åô„ÅÉ
su,„Åô
se,„Åõ
so,„Åù
shi,„Åó
sh,„Åó!
ta,„Åü
ti,„Å¶„ÅÉ
tu,„Å®„ÅÖ
te,„Å¶
to,„Å®
tchy,„Å°!
tchi,„Å°
na,„Å™
ni,„Å´
nu,„Å¨
ne,„Å≠
no,„ÅÆ
ny,„Å´!
nn,„Çì
ha,„ÅØ
hi,„Å≤
hu,„Åª„ÅÖ
he,„Å∏
ho,„Åª
hy,„Å≤!
fa,„Åµ„ÅÅ
fi,„Åµ„ÅÉ
fu,„Åµ
fe,„Åµ„Åá
fo,„Åµ„Åâ
ma,„Åæ
mi,„Åø
mu,„ÇÄ
me,„ÇÅ
mo,„ÇÇ
my,„Åø!
mm,„á∫
ra,„Çâ
ri,„Çä
ru,„Çã
re,„Çå
ro,„Çç
ry,„Çä!
wa,„Çè
wi,„Çê
we,„Çë
wo,„Çí
nga,„Åã„Çö
ngi,„Åç„Çö
ngu,„Åè„Çö
nge,„Åë„Çö
ngo,„Åì„Çö
ngy,„Åç„Çö!
ng,„É≥
ga,„Åå
gi,„Åé
gu,„Åê
ge,„Åí
go,„Åî
gy,„Åé!
gw,„Åêl
za,„Åñ
zi,„Åö„ÅÉ
zu,„Åö
ze,„Åú
zo,„Åû
ja,„Åò„ÇÉ
ji,„Åò
ju,„Åò„ÇÖ
je,„Åò„Åá
jo,„Åò„Çá
jy,„Åò!
da,„Å†
di,„Åß„ÅÉ
du,„Å©„ÅÖ
de,„Åß
do,„Å©
dy,„Åß!
ba,„Å∞
bi,„Å≥
bu,„Å∂
be,„Åπ
bo,„Åº
by,„Å≥!
va,„Çî„ÅÅ
vi,„Çî„ÅÉ
vu,„Çî
ve,„Çî„Åá
vo,„Çî„Åâ
pa,„Å±
pi,„Å¥
pu,„Å∑
pe,„Éö
po,„ÅΩ
py,„Å¥!
!ya,„ÇÉ
!yu,„ÇÖ
!ye,„Åá
!yo,„Çá
ya,„ÇÑ
yu,„ÇÜ
ye,õÄÅ
yo,„Çà
!a,„ÇÉ
!u,„ÇÖ
!e,„Åá
!o,„Çá
!a,„ÇÉ
!u,„ÇÖ
!e,„Åá
!o,„Çá
la,„ÅÅ
li,„ÅÉ
lu,„ÅÖ
le,„Åá
lo,„Åâ
a,„ÅÇ
i,„ÅÑ
u,„ÅÜ
e,„Åà
o,„Åä
*,„Å£
~,
^,
_,`.split(`
`).forEach(p=>{let e=p.split(",");he[e[0]]=e[1]});let we=function(p){let e=p;p[0]=="*"&&(e=e.slice(1)),["aa","ii","uu","ee","oo"].forEach(l=>{for(;e.indexOf(l)>-1;)e=e.replace(l,l[0])});for(let l in he)e=e.replaceAll(l,he[l]);e.indexOf("„Çì")==0&&e.length>1&&(e=e.slice(1));let a=e.indexOf("!");return a>-1&&e.length>1&&(e=e.slice(a+1)),e},ve=function(p){return p?p<96?`cc${p}`:["aftertouch","velocity","pitch bend"][p-96]:"off"},Se={"":["l9","Undefined fallback"],u8:["utf-8","Unicode"],l1:["l9","Pan-Latin"],jp:["sjis","Japanese"],kr:["iso-2022-kr","Korean"],hz:["gb18030","Simplified Chinese"],b5:["big5","Traditional Chinese"],cy:["koi8-ru","Cyrillic"],vn:["tcvn-5773-1993","Vietnamese"]},xe={m:"Male",f:"Female",c:"Chorus",s:"Solo",p:"Plural",w:"Words",x:"Non-vocal"};let fe=["room 1","room 2","room 3","hall 1","hall 2","plate","delay","panning delay"],Te=["chorus 1","chorus 2","chorus 3","chorus 4","feedback","flanger","short delay","short delay feedback"],Me=["delay 1","delay 2","delay 3","delay 4","pan delay 1","pan delay 2","pan delay 3","pan delay 4","delay to reverb","pan repeat"];let Fe={0:"thru",256:"stereo EQ",257:"spectrum",258:"enhancer",259:"humanizer",272:"overdrive",273:"distortion",288:"phaser",289:"auto wah",290:"rotary",291:"stereo flanger",292:"step flanger",293:"tremelo",294:"auto pan",304:"compressor",305:"limiter",320:"hexa chorus",321:"tremelo chorus",322:"stereo chorus",323:"space D",324:"3D chorus",336:"stereo delay",337:"modulated delay",338:"3-tap delay",339:"4-tap delay",340:"tremelo control delay",341:"reverb",342:"gate reverb",343:"3D delay",352:"2-pitch shifter",353:"feedback pitch shifter",368:"3D auto",369:"3D manual",370:"Lo-Fi 1",371:"Lo-Fi 2",512:"overdrive - chorus",513:"overdrive - flanger",514:"overdrive - delay",515:"distortion - chorus",516:"distortion - flanger",517:"distortion - delay",518:"enhancer - chorus",519:"enhancer - flanger",520:"enhancer - delay",521:"chorus - delay",522:"flanger - delay",523:"chorus - flanger",524:"rotary multi",1024:"guitar multi 1",1025:"guitar multi 2",1026:"guitar multi 3",1027:"clean guitar multi 1",1028:"clean guitar multi 2",1029:"bass multi",1030:"rhodes multi",1280:"keyboard multi",4352:"chorus / delay",4353:"flanger / delay",4354:"chorus / flanger",4355:"overdrive / distortion",4356:"overdrive / rotary",4357:"overdrive / phaser",4358:"overdrive / auto wah",4359:"phaser / rotary",4360:"phaser / auto wah"},Ye={66307:["drive"],66309:["vowel",p=>"aiueo"[p]],94723:["pre-filter"],94724:["Lo-Fi type"],94725:["post-filter"],94979:["Lo-Fi type"],94980:["fill type",p=>["off","LPF","HPF"][p]],94984:["noise type",p=>["white","pink"][p]],94987:["disc type",p=>["LP","SP","EP","RND"]],94990:["hum type",p=>`${p+5}0Hz`],94993:["M/S",p=>["mono","stereo"][p]]},de=function(p){return Fe[(p[0]-32<<8)+p[1]]||`0x${p[0].toString(16).padStart(2,"0")}${p[1].toString(16).padStart(2,"0")}`},Pe=function(p,e,a){let l=(p[0]-32<<16)+(p[1]<<8)+e,d=Ye[l]||{},u=d[0];if(u?.length)return u+=`: ${(d[1]||function(){})(a)||a}`,u},ue=[68,48,95,78,41,3,110,122,0];let G=new TextEncoder;let D=function(p=64){return Math.round(2e3*Math.log10(p/64))/100};let B=function(p){let e=0;return p.forEach(a=>{e+=a,e=e&127}),~e+1&127},I=function(p,e){let a=0,l=0;for(let d=0;d<p.length;d++){let u=(d&7)-1,E=(l>>u&1)<<7,$=p[d];$+=E,d&7?(e($,a,p),a++):l=p[d]}};let ze=function(p,e){let a=0;for(let l=0;l<p.length;l++)if(l&1){a=a<<4|p[l]&15;let d=l>>1;e(a,d,p)}else a=p[l]&15},Re=function(p){let e=p.length>>1,a=new Uint8Array(e);return ze(p,(l,d)=>{a[d]=l}),a},Q=function(p){let e=Math.floor(p*14.2);return e<128?e:0},x=function(){return self?.debugMode??!1},Ae=function(p){let e=(p.length+1)*3>>2,a=new Uint8Array(e),l=p.length+3>>2;for(let d=0;d<l;d++){let u=d<<2,E=d*3,$=0;for(let k=0;k<4;k++)$<<=6,$|=p.charCodeAt(u+k)-32&63;a[E]=$>>16,a[E+1]=$>>8&255,a[E+2]=$&255}return a};let $t="‚ô≠ùÑ´,ùÑ´,‚ô≠,,‚ôØ,ùÑ™,ùÑ™‚ôØ".split(",");let O=[new Map,new Map];O[0].set("base64",G.encode("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"));O[0].set("base64url",G.encode("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"));O[0].set("hex",G.encode("0123456789abcdef"));O[0].set("ovm43",G.encode("0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_"));O[0].set("radix64",G.encode("0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz+/"));O[0].set("radix64url",G.encode("0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_"));O[0].set("xx",G.encode("+-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz"));O[0].set("xxurl",G.encode("_-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz"));O[0].set("z64",G.encode("0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ+/"));O[0].set("z64url",G.encode("0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ-_"));for(let[p,e]of O[0]){let a=new Uint8Array(128).fill(255);for(let l=0;l<e.length;l++)a[e[l]]=l;switch(p){case"hex":{for(let l=10;l<16;l++)a[l+55]=l;break}default:a[9]=254,a[10]=254,a[12]=254,a[13]=254,a[32]=254,a[61]=254}O[1].set(p,a)}console.debug(O);let We=(p="base64",e,a=!1)=>{};self.bufferTo=We;let re={red:"#ff7986",orange:"#fca022",grYellow:"#c9e10a",green:"#c1ff0a",white:"#b7e5e3",blue:"#2280ff"},ae={black:"#000000",blue:"#0516bb",purple:"#48009a",inactive:22,medium:59,active:170,range:148},qe=[[6,26],[7,35],[8,44],[9,53],[10,62],[11,71],[12,80],[13,89],[14,98],[15,107],[16,116],[17,125],[18,134],[19,143],[20,152],[21,161],[22,170]],j={},Qe="06,68,2a,16,aa,3b".split(",");for(let p in ae)j[p]=[],Qe.forEach(e=>{j[p].push(`${ae[p]}${e}`)});let se=[];for(let p of qe)se.push([`${ae.black}${p[0].toString(16).padStart(2,"0")}`,`${ae.black}${p[1].toString(16).padStart(2,"0")}`]),p.push(p[1]-p[0]);let vt=`${re.orange}64`,St=`${re.green}64`,xt=`${re.white}64`,Tt=`${re.red}64`,Mt=j.black[0],Pt=j.black[2],Rt=j.black[1];let R=["?","gm","gs","sc","xg","g2","mt32","doc","qy10","qy20","ns5r","x5d","05rw","k11","sg","sd","pa","krs","s90es","motif","cs6x","trin","an1x","cs1x"],je={gm2:"g2","mt-32":"mt32","c/m":"mt32",ag10:"05rw","ag-10":"05rw","05r/w":"05rw",x5:"05rw",x5dr:"x5d",gmega:"k11","kross 2":"krs","motif es":"motif","s90 es":"s90es",trinity:"trin","tr-rack":"trin"},Je=["melodic","drum","menu"],J={"?":[0,0,120,0,0],gm:[0,0,120,0,0],gs:[0,0,128,0,0],sc:[0,0,128,0,0],xg:[0,0,127,0,0],g2:[0,0,120,0,0],mt32:[0,127,127,0,127],doc:[57,112,127,57,112],qy10:[57,113,127,57,113],qy20:[57,114,127,57,114],ns5r:[0,0,61,0,0],x5d:[82,0,62,56,0],"05rw":[81,0,62,56,0],k11:[0,0,122,0,0],sg:[0,0,122,0,0],sd:[97,0,105,0,0],pa:[0,0,120,121,0],krs:[121,0,120,0,0],s90es:[0,0,127,0,0],motif:[0,0,127,0,0],cs6x:[0,0,127,0,0],trin:[0,0,61,0,0],an1x:[36,3,127,0,0],cs1x:[0,0,127,63,0],cs2x:[0,0,127,63,0]},Ze=[9,25,41,57,73,89,105,121],et=[0,3,81,84,88],Oe={8:"Off",9:"On",10:"Note aftertouch",11:"cc",12:"pc",13:"Channel aftertouch",14:"Pitch"},ie={0:0,1:1,2:3,5:4},De={0:0,1:1,2:2,5:3},Le=[[0,24],[0,127],[0,127],[40,88],[0,127],[0,127]],be=[36,37,48,49,52,53],ce=[20,21,22,23,24,25,26,28,29,30,31,36,37,48,49,52,53,64,65],Ie={26:127,29:0,30:0,31:0,52:12,53:54},X=[0,1,2,4,5,6,7,8,10,11,12,13,14,15,16,17,18,19,20,21,22,26,28,32,38,40,41,42,43,44,45,46,47,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,80,81,82,83,84,91,92,93,94,95,98,99,100,101,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157],tt=[2,4,12,13,14,15,16,17,18,19,20,21,40,41,42,43,44,45,46,47,80,81,83,136,130,131,132,133,134,135,137,138,139,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157],at=[33,102,99,32,100,8,9,10],Ue=[0,16,25,40,32,64,24,48],Ne="reverb,chorus,delay,insert0,insert1,insert2,insert3,insert4".split(","),U=[["VL",32,8,1],["SG",8,1,1],["DX",16,1,16],["AN",16,2,5],["PF",2,1,64],["DR",2,1,32],["PC",2,1,32],["AP",2,1,64]],g={};R.forEach((p,e)=>{g[p]=e});let m=[];X.forEach((p,e)=>{m[p]=e});let N={length:ce.length};ce.forEach((p,e)=>{N[p]=e});let rt={};Je.forEach((p,e)=>{rt[p]=e});let st=function(p){let e=[],a=0;return p?.forEach(function(l,d){l===247?e.push(p.subarray(a,d)):l===240&&(a=d+1)}),e.length||e.push(p.subarray(0)),x()&&console.debug(e),e};let pe=8,y={port:pe,ch:pe<<4,chShift:Math.ceil(Math.log2(pe))+4,cc:X.length,nn:128,pl:512,tr:256,cmt:14,rpn:6,rpnt:4,nrpn:be.length,ace:8,drm:8,dpn:ce.length,dnc:128,ext:3,efx:8,cvn:12,redir:32,vxPrim:3,invalidCh:255};y.chcc=y.cc*y.ch;let Z={bank0:255},it=new TextDecoder("l9"),P=new Uint16Array(y.ch),V=new Uint16Array(y.ch),nt=new Uint16Array(y.ch),ne=new Uint16Array(y.ch),ct=new Uint16Array(y.ch),F=new Uint16Array(y.ch),He=new Array(y.drm);for(let p=0;p<y.ch;p++)P[p]=p*y.cc,V[p]=p*y.rpn,nt[p]=p*y.nrpn,ne[p]=p*y.ace,ct[p]=p*y.ext,F[p]=p*y.cvn;for(let p=0;p<y.drm;p++){He[p]=new Uint16Array(y.dpn);let e=p*y.dpn*y.dnc;for(let a=0;a<y.dpn;a++)He[p][a]=e+a*y.dnc}if(typeof self?.require<"u")throw new Error("Environments supporting CommonJS is not supported.");let ot=class{#t;#f=!0;autoRealtime=!1;detach(){this.#t=void 0,this.#f=!0,this.autoRealtime=!1}attach(e,a){if(typeof e<"u"&&typeof e.currentTime=="number")this.#t=e,this.#f=!1,this.autoRealtime=!0;else throw new TypeError("Not a valid time source.")}timeMs(){return typeof performance?.now=="function"?performance.now():Object.hasOwn(self,"Temporal")?Temporal.Now.instant().epochMilliseconds:Date.now()}get realtime(){return this.#f||typeof this.#t>"u"}set realtime(e){if(e)this.#f=!0;else{if(typeof this.#t>"u")throw new TypeError("No attached time source is present.");this.#f=!1}}get currentTime(){return this.realtime||!this.#t?this.timeMs()*.001:this.#t.currentTime}now(){return this.realtime||!this.#t?Math.floor(this.timeMs()):Math.round(this.#t.currentTime*1e3)}constructor(e){e&&this.attach(e)}},Wt=class extends Ce{NOTE_IDLE=0;NOTE_ATTACK=1;NOTE_DECAY=2;NOTE_SUSTAIN=3;NOTE_HELD=4;NOTE_RELEASE=5;NOTE_SOSTENUTO_ATTACK=8;NOTE_SOSTENUTO_DECAY=9;NOTE_SOSTENUTO_SUSTAIN=10;NOTE_SOSTENUTO_HELD=11;NOTE_MUTED_RECOVERABLE=16;CH_MELODIC=0;CH_DRUMS=1;CH_DRUM1=2;CH_DRUM2=3;CH_DRUM3=4;CH_DRUM4=5;CH_DRUM5=6;CH_DRUM6=7;CH_DRUM7=8;CH_DRUM8=9;DUMP_ALL=0;DUMP_ONCE=1;DUMP_MODE=2;EXT_NONE=0;EXT_VL=1;EXT_DX=3;VLBC_SYSTEM=0;VLBC_BRTHEXPR=1;VLBC_VELOINIT=2;VLBC_VELOALL=3;CH_INACTIVE=0;CH_ACTIVE=1;CH_DISABLED=2;KARAOKE_NONE=0;KARAOKE_TEXT=1;KARAOKE_XF=2;#t=0;#f=0;#R=0;#A=new Array(11);get#H(){return this.#A[this.#f]}set#H(e){this.#A[this.#f]=e}#fe=16;get lcdContrast(){return this.#fe}set lcdContrast(e){(e<0||e>=se.length)&&(e=se.length-1),this.#fe=e,this.dispatchEvent("lcdcontrast",e)}#v=new Uint8Array(y.ch);#c=new Uint8Array(y.ch);#a=new Uint8Array(y.ch);#e=new Uint8Array(y.chcc<<1);#g=new Uint8Array(y.ch*y.ace);#i=new Uint8Array(y.ch*y.vxPrim);#y=new Uint8Array(y.ch*y.nn);#m=new Uint8Array(y.ch);#p=new Uint16Array(y.pl);#o=new Uint8Array(y.pl);#_=new Int16Array(y.ch);#I=new Uint8Array(y.ch);#F=new Uint8Array(y.ch);#k=new Uint8Array(y.ch*y.ext);#r=new Uint8Array(y.ch*y.rpn);#n=new Uint8Array(y.ch*y.rpnt);#se=new Int8Array(y.ch*be.length);#w=new Uint8Array(y.drm*y.dpn*y.dnc);#O=new Uint8Array(y.drm*2);#S=new Uint8Array(y.efx*3);#Y=new Uint8Array(y.ch);#z=new Uint8Array(y.ch*y.redir);#d=new Uint8Array(y.port);#ie=new Uint8Array(y.port);#W=new Uint8Array(y.ch);#T=new Uint8Array(y.ch);#q=new Uint8Array(y.ch*y.cvn);#ne=new Uint8Array(y.ch);#G=new Uint8Array(128);#D=new Uint8Array(y.cmt*8);#ce=new Uint8Array(1024);#B=new Uint8Array(y.cmt*64);#b={};clockSource=new ot;modelEx={xg:{map:0,varSys:!1,insPart:new Uint8Array(5)},yPlg:[],vl:{module:0,breath:1,voiceCh:y.invalidCh},sc:{showBar:!0,invBar:!1,invDisp:!1,peakHold:1},cs1x:{perfCh:0},kross:{chToggle:!1},sg:{convLastSyll:0,runLineLen:0,maxLineLen:32,splitMask:!1}};#s;get detect(){return structuredClone(this.#s)}#U;#de;#h=100;#Q=0;#oe=500;#Ce=0;#Ee=0;#ge=32;#me=!1;#X="";#K=0;#ue=0;#le=0;#M=!0;#l=0;#pe;#u=!1;#he=0;#j=new Array(y.ch);#x=[];#N=new Uint8Array(y.ch);#V=new Uint8Array(y.tr);baseBank=new le("gm2","ns5r","xg","gs","sd","gmega","plg-vl","plg-pf","plg-dx","plg-an","plg-dr","plg-sg","kross","s90es","cs2x","pa");userBank=new le("gm2");initOnReset=!1;aiEfxName="";polyIndexShrink=!0;polyIndexLatest=0;polyIndexLast=0;lcdHideBankInfo=!1;chRedir(e,a,l){let d=this;if(d.#V[a])return(d.#V[a]-1)*16+e;if(d.#t===g.sc||d.#t===g.sd){if(l===1)return e;for(let $=0;$<y.ch;$++)if(d.#N[$]===a)return $&112|e&15;let u=0,E=!0;for(;E;)d.#N[e+u]===0?(d.#N[e+u]=a,console.info(`Allocated track ${a} to channel ${e+u+1}.`),E=!1):this.#N[e+u]===a?E=!1:(u+=16,u>=128&&(u=0,E=!1));return e+u}else return e}getTrackPort(e){return this.chRedir(0,e,!0)>>4}forceVoiceRefresh(){for(let e=0;e<y.ch;e++)this.#v[e]&&this.dispatchEvent("voice",{part:e})}#$=[];#J;#C={nOff:(e,a)=>{let l=e*128+a,d=this.#p.lastIndexOf(l);if(d>-1)if(this.getChCc(e,64)>>6)this.#o[d]=this.NOTE_HELD,this.dispatchEvent("note",{part:e,note:a,velo:this.#y[l],state:this.NOTE_HELD});else if(this.getChCc(e,66)>>6&&this.#o[d]===this.NOTE_SOSTENUTO_SUSTAIN)this.#o[d]=this.NOTE_SOSTENUTO_HELD,this.dispatchEvent("note",{part:e,note:a,velo:this.#y[l],state:this.NOTE_SOSTENUTO_HELD});else{this.#p[d]=0,this.#y[l]=0,this.#o[d]=this.NOTE_IDLE;let u=this.getExt(e)[1];(u===this.VLBC_VELOINIT||u===this.VLBC_VELOALL)&&this.setChCc(e,129,0),this.dispatchEvent("note",{part:e,note:a,velo:0,state:this.NOTE_IDLE})}if(this.#m[e]){for(let u=this.polyIndexLast;u>=0;u--)if(this.#p[u]>>7===e&&this.#o[u]!==0){this.#o[u]===this.NOTE_MUTED_RECOVERABLE&&(this.#o[u]=this.NOTE_SUSTAIN);break}}if(this.polyIndexShrink&&this.polyIndexLast>0){let E=!1,$=this.polyIndexLast-8,k=this.polyIndexLast;for(;k>$&&this.#o[k]===0;k--)E=!0;E&&(this.polyIndexLast=k,this.#o[k+1]!==0&&console.error("Polyphonic slot shrinking edge case."))}},nOn:(e,a,l)=>{let d=e*128+a,u=0;if(this.#m[e])for(let E=0;E<=this.polyIndexLast;E++)this.#p[E]>>7===e&&this.#o[E]!==0&&(this.#o[E]=this.NOTE_MUTED_RECOVERABLE);for(;this.#o[u]>0&&this.#p[u]!==d;)u++;if(u<y.pl){this.#p[u]=d,this.#y[d]=l,this.#o[u]=this.NOTE_SUSTAIN,this.#I[e]<l&&(this.#I[e]=l);let E=this.getExt(e)[1];(E===this.VLBC_VELOINIT||E===this.VLBC_VELOALL)&&this.setChCc(e,129,l),this.dispatchEvent("note",{part:e,note:a,velo:l,state:this.NOTE_SUSTAIN}),this.polyIndexLatest=u+1,u>this.polyIndexLast&&(this.polyIndexLast=u)}else console.error("Polyphony exceeded.")},nAt:(e,a,l)=>{},cAt:(e,a)=>{},hoOf:e=>{this.#o.forEach((a,l)=>{if(a===this.NOTE_HELD){let d=this.#p[l],u=d>>7;e===u&&(this.#o[l]=this.NOTE_IDLE,this.#p[l]=0,this.#y[d]=0,this.dispatchEvent("note",{part:e,note:d&127,velo:0,state:this.NOTE_IDLE}))}})},soOn:e=>{this.#o.forEach((a,l)=>{let d;switch(a){case this.NOTE_ATTACK:{d=this.NOTE_SOSTENUTO_ATTACK;break}case this.NOTE_DECAY:{d=this.NOTE_SOSTENUTO_DECAY;break}case this.NOTE_SUSTAIN:{d=this.NOTE_SOSTENUTO_SUSTAIN;break}}if(d){this.#o[l]=d;let u=this.#p[l];this.dispatchEvent("note",{part:e,note:u&127,velo:this.#y[u],state:d})}})},soOf:e=>{this.#o.forEach((a,l)=>{if(a===this.NOTE_SOSTENUTO_HELD){let d=this.#p[l],u=d>>7;e===u&&(this.#o[l]=this.NOTE_IDLE,this.#p[l]=0,this.#y[d]=0,this.dispatchEvent("note",{part:e,note:d&127,velo:0,state:this.NOTE_IDLE}))}})},ano:e=>{this.#p.forEach(a=>{let l=a>>7,d=a&127;a===0&&this.#y[0]===0||l===e&&this.#C.nOff(l,d)})}};#be={8:function(e){let a=e.channel,l=e.data[0];this.#C.nOff(a,l)},9:function(e){let a=e.channel,l=this;if(l.getChModeId(a)===g.xg&&l.#a[a]>1){let E=l.getChDrumFirstWrite(a);E[0]&&E[1]!==y.invalidCh&&!l.#v[a]&&(l.copyChSetup(E[1],a),l.pushChPrimitives(a),console.debug(`Part CH${a+1} copied from CH${E[1]+1}.`))}l.setChActive(a,1);let d=e.data[0],u=e.data[1];u>0?l.#C.nOn(a,d,u):l.#C.nOff(a,d)},10:function(e){let a=e.channel,l=a*128+e.data[0];this.#p.indexOf(l)>-1&&(this.#y[l]=data[1],this.getExt(a)[1]===this.VLBC_VELOALL&&this.setChCc(a,129,data[1]),this.dispatchEvent("note",{part:a,note:e.data[0],velo:e.data[1],state:this.NOTE_SUSTAIN}))},11:function(e){let a=e.channel,l=this,d=l.#j[a],u=d[e.data[0]];u&&(e.data[0]=u),[0,32].indexOf(e.data[0])>-1&&(()=>{switch(this.#t){case g.s90es:case g.motif:{if(e.data[0]===0){[0,63].indexOf(e.data[1])>-1&&l.setChActive(a,1);break}e.data[1]&&l.setChActive(a,1);break}default:break}})();let E=a*y.ext,$=l.getChModeId(a);switch(e.data[0]){case 96:return;case 97:return;case 120:return;case 121:{this.#C.ano(a),this.#_[a]=0,l.resetChCc(a,1,0),l.resetChCc(a,5,0),l.resetChCc(a,64,0),l.resetChCc(a,65,0),l.resetChCc(a,66,0),l.resetChCc(a,67,0),l.resetChCc(a,11,127),l.resetChCc(a,101,127),l.resetChCc(a,100,127),l.resetChCc(a,99,127),l.resetChCc(a,98,127);return}case 123:{this.#C.ano(a);return}case 124:{this.#C.ano(a);return}case 125:{this.#C.ano(a);return}case 126:{this.#m[a]=1,this.#C.ano(a);return}case 127:{this.#m[a]=0,this.#C.ano(a);return}}if(m[e.data[0]]===void 0)console.warn(`cc${e.data[0]} is not accepted.`);else{switch(tt.indexOf(e.data[0])>-1&&this.allocateAce(a,e.data[0]),e.data[0]){case 0:{switch(x()&&console.debug(`${R[l.#t]}, CH${a+1}: ${e.data[1]}`),this.#t===0?e.data[1]<48?(l.#a[a]>0&&(e.data[1]=l.getChPrimitive(a,1,!1),e.data[1]=J.gs[2],console.debug(`Forced channel ${a+1} to stay drums.`)),e.data[1]>0&&(console.debug(`Roland GS detected with MSB: ${e.data[1]}`),l.switchMode("gs",0))):e.data[1]===56?l.switchMode(l.#s.x5===82?"x5d":"05rw",0):e.data[1]===62?l.switchMode(l.#s.x5===82?"x5d":"05rw",0):e.data[1]===63?l.switchMode(R[l.#s.ds],0):e.data[1]===64||e.data[1]===127?l.switchMode("xg",0):(e.data[1]===120||e.data[1]===121)&&l.switchMode("g2",0):l.#t===g.gs||l.#t===g.sc?e.data[1]<56&&this.#a[a]>0&&(e.data[1]=this.getChPrimitive(a,1,!1),e.data[1]=J.gs[2],console.debug(`Forced channel ${a+1} to stay drums.`)):this.#t===g.gm&&(e.data[1]<48?this.#a[a]>0&&(e.data[1]=J.gs[2],this.switchMode("gs",1),console.debug(`Forced channel ${a+1} to stay drums.`)):(e.data[1]===64||e.data[1]===127)&&this.switchMode("xg",1)),this.#t){case g.xg:{[79,95,120,126,127].indexOf(e.data[1])>-1?this.#a[a]===0&&(this.setChType(a,this.CH_DRUM2),console.debug(`CH${a+1} set to drums by MSB.`)):this.#a[a]>0&&(this.setChType(a,this.CH_MELODIC),console.debug(`CH${a+1} set to melodic by MSB.`)),[33,81,97].indexOf(e.data[1])>-1?this.#k[E]=this.EXT_VL:[35,67,83,99].indexOf(e.data[1])>-1?this.#k[E]=this.EXT_DX:this.#k[E]=this.EXT_NONE;break}case g["05rw"]:case g.x5d:case g.ns5r:{[61,62,126,127].indexOf(e.data[1])>-1?this.#a[a]===this.CH_MELODIC&&(this.setChType(a,this.CH_DRUM2),console.debug(`CH${a+1} set to drums by MSB.`)):this.#a[a]!==this.CH_MELODIC&&(this.setChType(a,this.CH_MELODIC),console.debug(`CH${a+1} set to melodic by MSB.`));break}case g.sd:{[104,105,106,107,120].indexOf(e.data[1])>-1?this.#a[a]===0&&(this.setChType(a,this.CH_DRUM2),console.debug(`CH${a+1} set to drums by MSB.`)):this.#a[a]>0&&(this.setChType(a,this.CH_MELODIC),console.debug(`CH${a+1} set to melodic by MSB.`));break}case g.g2:{e.data[1]===120?this.#a[a]===0&&(this.setChType(a,this.CH_DRUMS),console.debug(`CH${a+1} set to drums by MSB.`)):this.#a[a]>0&&(this.setChType(a,this.CH_MELODIC),console.debug(`CH${a+1} set to melodic by MSB.`));break}}break}case 2:{this.getExt(a)[1]===this.VLBC_BRTHEXPR&&this.setChCc(a,129,e.data[1]);break}case 6:{if(this.#F[a]){[g.xg,g.gs,g.sc,g.ns5r].indexOf(this.#t)<0&&console.warn(`NRPN commits are not available under "${R[this.#t]}" mode, even when they are supported in Octavia.`);let k=this.getChCc(a,99),w=this.getChCc(a,98);if(k===1){let S=at.indexOf(w);if(S>-1)this.setChCc(a,71+S,e.data[1]),x()&&console.debug(`Redirected NRPN 1 ${w} to cc${71+S}.`),this.dispatchEvent("cc",{part:a,cc:71+S,data:e.data[1]});else{let t=be.indexOf(w);t>-1?this.#se[a*10+t]=e.data[1]-64:console.warn(`NRPN 0x01${w.toString(16).padStart(2,"0")} is not supported.`),x()&&console.debug(`CH${a+1} voice NRPN ${w} commit`)}}else{if(ce.indexOf(k)<0){let t=`NRPN 0x${k.toString(16).padStart(2,"0")}${w.toString(16).padStart(2,"0")} `;console.warn(k===127?`${t}is not necessary. Consider removing it.`:`${t}is not supported.`)}else{let t=this.#a[a]-2;t<0?console.warn(`CH${a+1} cannot accept drum NRPN as type ${q[this.#a[a]]}.`):this.#w[(t*y.dpn+N[k])*y.dnc+w]=e.data[1]}x()&&console.debug(`CH${a+1} (${q[this.#a[a]]}) drum NRPN ${k} commit`)}}else{let k=ie[this.getChCc(a,100)],w=De[this.getChCc(a,100)];if(this.getChCc(a,101)===0&&k!==void 0)switch(x()&&console.debug(`CH${a+1} RPN 0 ${this.getChCc(a,100)} commit: ${e.data[1]}`),e.data[1]=Math.min(Math.max(e.data[1],Le[k][0]),Le[k][1]),this.#r[a*y.rpn+k]=e.data[1],this.#n[a*y.rpnt+w]=1,$){case g.xg:case g.gs:case g.sc:case g.mt32:case g.s90es:case g.motif:case g.cs1x:case g.cs6x:{switch(this.getChCc(a,100)){case 1:case 2:{this.dispatchEvent("pitch",{part:a,pitch:this.getPitchShift(a)});break}}break}default:this.dispatchEvent("pitch",{part:a,pitch:this.getPitchShift(a)})}}break}case 32:{switch(x()&&console.debug(`${R[this.#t]}, CH${a+1} LSB: ${e.data[1]}`),this.#t){case g.s90es:case g.motif:{this.setChType(a,[32,40].indexOf(e.data[1])>-1?this.CH_DRUMS:this.CH_MELODIC,this.#t,!0);break}}this.getExt(a)[0],this.EXT_DX;break}case 38:{if(!this.#F[a]){let k=ie[this.getChCc(a,100)],w=De[this.getChCc(a,100)];this.getChCc(a,101)===0&&k!==void 0&&(this.#r[a*y.rpn+k+1]=e.data[1],this.#n[a*y.rpnt+w]=1)}break}case 64:{e.data[1]<64&&this.#C.hoOf(a);break}case 66:{e.data[1]>>6?this.#C.soOn(a):this.#C.soOf(a);break}case 98:case 99:{this.#F[a]=1;break}case 100:case 101:{this.#F[a]=0;break}}this.setChCc(a,e.data[0],e.data[1]),this.dispatchEvent("cc",{part:a,cc:e.data[0],data:e.data[1]})}l.getChModeId(a)===g.xg&&l.#a[a]&&l.setDrumFirstWrite(a)},12:function(e){let a=e.channel,l=this;switch(l.#t){case g.s90es:case g.motif:{e.data&&l.setChActive(a,1);break}default:l.setChActive(a,1)}let d=P[a];switch(l.getExt(a)[0]){case l.EXT_VL:break}l.#i[a]=e.data,l.#T[a]=0,l.pushChPrimitives(a),x()&&console.debug(`T:${e.track} C:${a} P:${e.data}`),l.getChModeId(a)===g.xg&&l.#a[a]&&l.setDrumFirstWrite(a)},13:function(e){let a=this,l=e.channel;this.#p.forEach(function(d){let u=d>>7;l===u&&(a.#y[d]=e.data,a.dispatchEvent("note",{part:l,note:d&127,velo:e.data,state:a.NOTE_SUSTAIN}))})},14:function(e){let a=e.channel;this.#_[a]=e.data[1]*128+e.data[0]-8192,this.dispatchEvent("pitch",{part:a,pitch:this.getPitchShift(a)})},15:function(e){st(e.data).forEach(a=>{let l=a[0],d=a[1];this.#he=a.length,(this.#ye[l]||function(){console.debug(`Unknown manufacturer ${l}.`)})(d,a.subarray(2),e.track)})},248:function(e){},250:function(e){},251:function(e){},252:function(e){},254:function(e){},255:function(e){(this.#$[e.meta]||function(l,d,u){}).call(this,e.data,e.track,e.meta),e.meta!==32&&(this.#Q=0);let a=et.indexOf(e.meta)>-1;if(x()&&console.debug(e),a)return e.reply="meta",e}};#ye={64:(e,a,l)=>{this.#te.run(a,l,e)},65:(e,a,l)=>{if(a[0]<16)if(a[1]===72){let d=a[a.length-1],u=B(a.subarray(3,a.length-1));d===u?this.#P.run(a.subarray(0,a.length-1),l,e):console.warn(`Bad SD checksum ${d} - should be ${u}.`)}else this.#P.run(a,l,e);else{let d=a[a.length-1],u=B(a.subarray(2,a.length-1));d===u?this.#P.run(a.subarray(0,a.length-1),l,e):console.warn(`Bad GS checksum ${d} - should be ${u}.`)}},66:(e,a,l)=>{this.#L.run(a,l,e)},67:(e,a,l)=>{switch(e>>4){case 0:{let d=0;for(;a[d]===127&&d<4;)d++;let u=a[1+d]<<7|a[2+d];if(u+7+d!==a.length){console.warn(`Yamaha bulk dump length mismatch! Expected ${a.length-7-d}, received ${u}.`),console.debug(a);break}let E=B(a.subarray(1+d,a.length-1)),$=a[a.length-1];if(a[a.length-1]>>7)console.warn(`Yamaha bulk dump checksum invalid! Expected ${E}, received ${$}:
`),console.debug(a);else if(E!==$)console.warn(`Yamaha bulk dump checksum mismatch! Expected ${E}, received ${$}:
`),console.debug(a);else{let k=a.slice(2,a.length-1);for(let w=0;w<=d;w++)k[w]=a[w];this.#E.run(k,l,e&15)}break}case 1:{this.#E.run(a,l,e&15);break}case 2:{console.warn("Octavia doesn't yet support Yamaha bulk dump requests.");break}case 3:{console.warn("Octavia doesn't yet support Yamaha parameter requests.");break}case 7:{switch(e&15){case 14:{let d=new Uint8Array(a.length+1);d[0]=126,d.set(a,1),this.#E.run(d,l,0);break}default:console.warn(`Unknown Yamaha special SysEx type: ${e}.`)}break}default:console.warn(`Unknown Yamaha SysEx type: ${e>>4}.`)}},68:(e,a,l)=>{this.#re.run(a,l,e)},71:(e,a,l)=>{this.#ae.run(a,l,e)},126:(e,a,l)=>{this.#Z.run(a,l,e)},127:(e,a,l)=>{this.switchMode("gm",0),this.#ee.run(a,l,e)}};#Z;#ee;#E;#P;#L;#te;#ae;#re;buildRchTree(){let e=[];this.#c.forEach((a,l)=>{a<y.ch&&(e[a]?.constructor||(e[a]=[]),e[a].push(l))}),this.#pe=e}buildRccMap(){let e=this;for(let a=0;a<y.ch;a++)e.#j[a]={};e.#z.forEach((a,l)=>{a&&(e.#j[Math.floor(l/y.redir)][a]=l%y.redir|128)}),x()&&console.debug(e.#j)}invokeSysExIndicator(){this.dispatchEvent("mupromptex",this.#he)}getActive(){return this.#v}getChActive(e){return this.#v[e]}getCc(e){if(typeof e!="number"||e<0||e>=y.ch)throw new RangeError(`Invalid part number: CH${e+1}`);let a=this,l=P[e];return a.#e.subarray(l,l+y.cc)}getChCc(e,a){let l=this;if(X.indexOf(a)<0)throw new Error("CC number not accepted");return l.#e[P[e]+m[a]]}getChCcWritten(e,a){let l=this;if(X.indexOf(a)<0)throw new Error("CC number not accepted");return l.#e[y.chcc+P[e]+m[a]]}setChCc(e=0,a,l){let d=this;if(X.indexOf(a)<0)throw new Error("CC number not accepted");if(l?.constructor!==Number)throw new TypeError("Expected numbers for value");let u=l&255,E=P[e]+m[a];d.#e[E]=u,d.#e[E+y.chcc]=1,d.dispatchEvent("cc",{part:e,cc:a,data:u})}getCcAll(){return this.#e.slice()}resetCc(e){let a=this,l=P[e]+y.chcc;a.#e.fill(0,l,l+y.cc)}resetChCc(e,a,l){let d=this;l?.constructor&&d.setChCc(e,a,l),d.#e[P[e]+m[a]+y.chcc]=0}resetCcAll(){this.#e.fill(0,y.chcc,y.chcc<<1)}isChCcWritten(e,a){if(X.indexOf(a)<0)throw new Error("CC number not accepted");return upThis.#e[P[e]+m[a]+y.chcc]}getChSource(){return this.#c}getChType(e=0){return this.#a[e]}getChTypes(){return this.#a}setChType(e,a,l=0,d=!1){a&=15;let u=this;l=l||u.getChModeId(e),u.#a[e]=a,a>0&&!d&&(u.setChCc(e,0,u.#b[l][2]),u.pushChPrimitives(e))}setChActive(e,a=0){this.#v[e]!==a&&this.dispatchEvent("channeltoggle",{part:e,active:a}),this.#v[e]=a}getExt(e){let a=y.ext*e,l=this.#k.subarray(a,a+y.ext),d=new Uint8Array(l.length);switch(d.set(l),d[0]){case this.EXT_VL:{d[1]=d[1]||this.modelEx.vl.breath;break}}return d}getProgram(){return this.#i}getTexts(){return this.#x.slice()}getVel(e){let a=new Map,l=this;return l.#p.forEach(function(d,u){let E=d>>7,$=d&127;e===E&&l.#y[d]>0&&a.set($,{v:l.#y[d],s:l.#o[u]})}),a}getBitmap(){return{bitmap:this.#H,expire:this.#R}}getLetter(){return{text:this.#X,set:this.#ue,expire:this.#K}}getMode(){return R[this.#t]}getMaster(){return{volume:this.#h}}getRpn(){return this.#r}getNrpn(){return this.#se}getSubDb(){return self?.structuredClone(this.#b)}getDetect(){return self?.structuredClone(this.#s)}getVoice(e,a,l,d="?",u=0){let E=this;g[d]?.constructor||(d="?");let $=g[d],k=e||E.#b[$][0],w=a,S=l||E.#b[$][1];k===Z.bank0&&(k=0),S===Z.bank0&&(S=0),d==="ns5r"&&k>0&&k<56&&(S=3);let t=E.userBank.get(k,w,S,d,u);if(d==="mt32"&&t.name.indexOf("MT-m:")===0){let s=parseInt(t.name.slice(5)),o=s*y.cmt,r="";E.#B.subarray(o,o+10).forEach(c=>{c>31&&(r+=String.fromCharCode(c))});let n=`MSB	LSB	PRG	NME
49	127	${w}	${r}`;E.userBank.load(n,!0),t.name=r,t.ending=" "}return(t.ending!==" "||!t.name.length)&&(t=E.baseBank.get(k,w,S,d,u)),t}getChPrimitive(e,a,l){if(a>=y.vxPrim||a?.constructor!==Number)throw new RangeError(`Invalid voice primitive component "${a}"`);if(typeof e!="number"||e<0||e>=y.ch)throw new RangeError(`Invalid part number: CH${e+1}`);let d=this,u=d.#i[a<<y.chShift|e];switch(a){case 1:case 2:{d.getChCcWritten(e,[255,0,32][a])||(u=u||d.#b[d.getChModeId(e)][a+2]),l&&(u=u||d.#b[d.getChModeId(e)][a-1]),u===Z.bank0&&(u=0);break}}return u}getChPrimitives(e,a){let l=this,d=new Uint8Array(3);return d[1]=l.#i[e],d[0]=l.getChPrimitive(e,1,a),d[2]=l.getChPrimitive(e,2,a),d}pushChPrimitives(e){let a=this;a.#i[1<<y.chShift|e]=a.getChCc(e,0),a.#i[2<<y.chShift|e]=a.getChCc(e,32),a.dispatchEvent("voice",{part:e})}getChCvnBuffer(e,a=y.cvn){if(a>y.cvn||a<1)throw new RangeError("Invalid custom voice name buffer length");let l=F[e];return this.#q.subarray(l,l+a)}getChCvnRegister(e,a){if(a>=y.cvn||a<0)throw new RangeError("Invalid custom voice name register");return this.#q[F[e]+a]}setChCvnRegister(e,a,l=32){if(a>=y.cvn||a<0)throw new RangeError("Invalid custom voice name register");this.#ne[e]=1,this.#q[F[e]+a]=Math.max(32,l&255)}resetChCvn(e){this.#q.fill(32,F[e],F[e]+y.cvn),this.#ne[e]=0}getChCvnString(e,a){let l=it.decode(this.getChCvnBuffer(e));return a||(l=l.trimEnd()),l}getChCvnIsWritten(e){return this.#ne[e]}getChVoice(e){let a=this,l=a.getVoice(...a.getChPrimitives(e),a.getChMode(e),a.modelEx[a.getChMode(e)]?.map??0);if(a.#T[e]){let d="";switch(a.#t){case g.mt32:{a.#D.subarray(y.cmt*(e-1),y.cmt*(e-1)+10).forEach(u=>{d+=String.fromCharCode(Math.max(u,32))}),d=d.trimEnd();break}default:d=a.getChCvnString(e)}d.length&&(l.ending="~",l.name=d)}return l}getRawPitch(){return this.#_}getPitchShift(e){let a=this,l=e*y.rpn,d=a.#r[l];return a.#n[e*y.rpnt]?d>>7&&(d-=256):a.#t===g.mt32&&(d=12),a.#_[e]/8192*d+(a.#r[l+3]-64)+((a.#r[l+1]<<7)+a.#r[l+2]-8192)/8192}getEffectType(e=0){let a=3*e+1;return this.#S.subarray(a,a+2)}getPolyState(e=0){return this.#o[e]}setEffectTypeRaw(e=0,a,l){let d=3*e;this.#S[d]=1,this.#S[d+1+ +a]=l}setEffectType(e=0,a,l){this.setEffectTypeRaw(e,!1,a),this.setEffectTypeRaw(e,!0,l)}pushEffectType(e=0,a=!1){if(e<0||e>=y.efx)throw new RangeError(`Invalid EFX slot ${e}`);let l=this.getEffectType(e);a||l[0]===0&&l[1]>>4===15&&(a=!0),this.dispatchEvent(`efx${Ne[e]}`,{id:l,hidden:a})}getEffectSink(){return this.#Y}getChEffectSink(e){return this.#Y[e]}setChEffectSink(e,a=0){let l=this;if(a<0||a>=y.efx)throw new RangeError(`Invalid EFX slot ${a}`);if(e<0||e>=y.ch)throw new RangeError(`Invalid CH${e+1}`);this.#Y[e]=a,this.dispatchEvent("partefxtoggle",{part:e,active:a})}setXgChEffectSink(e,a=0){let l=this,d=l.modelEx.xg,u=a-2;if(a<0||u>=d.insPart.length)throw new RangeError(`Invalid XG insertion slot ${u}`);let E=d.insPart[u];d.insPart[u]=e,E!==y.invalidCh&&l.setChEffectSink(E,0),e===y.invalidCh?E!==y.invalidCh&&l.setChEffectSink(E,0):l.setChEffectSink(e,a)}setLetterDisplay(e,a,l=0,d=3200){let u=this,E;u.#X=" ".repeat(l),e.forEach($=>{u.#X+=String.fromCharCode($>31?$:32),$<32&&(E=E||new Set,E.add($))}),u.#ue=u.clockSource.now(),u.#K=u.clockSource.now()+d,u.dispatchEvent("letter"),E&&(E=Array.from(E),E.forEach(($,k,w)=>{w[k]=$.toString(16).padStart(2,"0")}),console.warn(`${a}${a?" ":""}invalid code point${E.length>1?"s":""}: 0x${E.join(", 0x")}`))}setDetectionTargets(e="?",a=0){let l=this,d=-1;switch(e.replaceAll(", ",",").split(",").forEach(u=>{u=u.toLowerCase();let E=R.indexOf(je[u]||u);x()&&console.debug(`Mapped mode "${u}" to ID "${E}".`),E>-1&&(d=E)}),x()&&console.debug(`Set detection target to ID "${d}".`),d>0&&(l.#s.x5=82,l.#s.ds=g.krs,l.#s.gm=g.gm,l.#s.g2=g.g2),d){case g["05rw"]:{l.#s.x5=81;break}case g.s90es:{l.#s.ds=g.s90es,l.#s.smotif=g.s90es;break}case g.motif:{l.#s.ds=g.motif,l.#s.smotif=g.motif;break}case g.sd:{l.#s.g2=g.sd;break}case g.pa:{l.#s.g2=g.pa;break}}}setGsTargets(e=!1,a=4){if(!a)a=e?3:4;else{if(a>4||a<0)throw new Error(`Invalid GS level ${a}`);if(e&&a>>1!==1)throw new Error(`Invalid SC level ${a}`)}let l=this;l.#s[e?"sc":"gs"]=a,l.#b[g[e?"sc":"gs"]][1]=a,l.forceVoiceRefresh()}getConfigs(){return this.#de}setDumpLimit(e){if(e>2||e<0)throw new RangeError("Invalid dump limit.");this.#U.dumpLimit=e}allocateAce(e=0,a){let l=this;if(!a||a<128&&a>95){console.warn(`cc${a} cannot be allocated as an active custom effect.`);return}let d=!0,u=0,E=y.ace*e;for(;d&&u<y.ace;)l.#g[u+E]===a?d=!1:l.#g[u+E]||(d=!1,l.#g[u+E]=a,console.debug(`Allocated cc${a} to ACE slot ${u} in CH${e+1}.`)),u++;u>=y.ace&&console.warn(`ACE slots are full in CH${e+1}.`)}allocateAceAll(e){let a=this;if(!e||e<128&&e>95){console.warn(`cc${e} cannot be allocated as an active custom effect.`);return}for(let l=0;l<y.ch;l++){let d=!0,u=0,E=y.ace*l;for(;d&&u<y.ace;)a.#g[u+E]===e?d=!1:a.#g[u+E]||(d=!1,a.#g[u+E]=e),u++;u>=y.ace&&console.warn(`ACE slots are full in CH${l+1}.`)}}resetAce(){this.#g.fill(0),console.info("All ACE slots have been reset.")}resetChAceAll(e=0){this.#g.subarray(ne[e],ne[e]+y.ace).fill(0)}resetChAce(e=0,a){let l=!0,d=ne[e],u=d+y.ace;for(;l&&d<u;)this.#g[d]===a&&(this.#g[d]=0,l=!1),d++;l&&x()&&console.debug(`No ACE slot was allocated to cc${a} in CH${e+1}.`)}getAce(){return this.#g}getChAce(e=0,a=0){if(a<0||a>=y.ace)throw new RangeError("No such ACE slot");let l=this.#g[y.ace*e+a];if(l){if(X.indexOf(l)>=0)return this.getChCc(e,l);throw new Error(`Invalid ACE source in CH${e+1}: ${l}`)}else return 0}initDrums(){let e=this;e.#w.fill(64);for(let a=0;a<y.drm;a++){let l=a*y.dpn;for(let d in Ie){let u=Ie[d],E=(l+N[d])*y.dnc;e.#w.subarray(E,E+y.dnc).fill(u)}}}init(e=0){let a=this;a.#Q=0,a.#b[g.xg][1]=0,a.modelEx.xg.map=0,a.dispatchEvent("banklevel",{mode:"xg",data:a.modelEx.xg.map}),a.#v.fill(0),a.#e.fill(0),a.#g.fill(0),a.#i.fill(0),a.#y.fill(0),a.#p.fill(0),a.#o.fill(0),a.#m.fill(0),a.#I.fill(0),a.#_.fill(0),a.#se.fill(0),a.#n.fill(0),a.#k.fill(0),a.#d.fill(0),a.#ie.fill(0),a.#W.fill(0),a.#z.fill(0),a.#h=100,a.#x=[],a.#oe=500,a.modelEx.sg.convLastSyll=0,a.modelEx.sg.runLineLen=0,a.modelEx.sg.splitMask=!1,a.#R=0,a.#f=0,a.lcdContrast=16,a.lcdHideBankInfo=!1;for(let l=0;l<a.#A.length;l++)a.#H.fill(0);a.#l=a.KARAOKE_NONE,a.#le=0,a.#M=!0,a.#u=!1,a.#he=0,a.initDrums(),a.polyIndexLatest=0,a.polyIndexLast=0,a.#c.forEach(function(l,d,u){u[d]=d}),e===0&&(a.dispatchEvent("mode","?"),a.#t=0,a.#N.fill(0),a.#V.fill(0),a.#K=0,a.#X=""),Ze.forEach(l=>{a.setChCc(l,0,a.#b[a.getChModeId(l)][2])}),a.#a.fill(a.CH_MELODIC),a.#a[9]=a.CH_DRUM1,a.#a[25]=a.CH_DRUM3,a.#a[41]=a.CH_DRUMS,a.#a[57]=a.CH_DRUMS,a.#a[73]=a.CH_DRUM5,a.#a[89]=a.CH_DRUM7,a.#a[105]=a.CH_DRUMS,a.#a[121]=a.CH_DRUMS;for(let l=0;l<y.drm;l++)a.#O[l<<1]=0,a.#O[l<<1|1]=y.invalidCh;a.#ce.fill(0),a.#B.fill(0),a.#G.fill(0),a.#D.fill(0),a.#T.fill(0),a.#S.fill(0),a.#Y.fill(0),a.aiEfxName="",a.userBank.clearRange({msb:0,lsb:127,prg:[0,127]}),a.modelEx.xg.varSys=!1,a.modelEx.xg.insPart.fill(y.invalidCh);for(let l=0;l<U.length;l++){let d=a.modelEx.yPlg[l];d.fill(0,0,U[l][2]),d.fill(y.invalidCh,U[l][2])}a.modelEx.sc.showBar=!0,a.modelEx.sc.invBar=!1,a.modelEx.sc.invDisp=!1,a.modelEx.sc.peakHold=1,a.modelEx.cs1x.perfCh=0;for(let l=0;l<y.ch;l++){a.resetChCvn(l);let d=P[l];a.#e[d+m[7]]=100,a.#e[d+m[11]]=127,a.#e[d+m[2]]=127,a.#e[d+m[10]]=64,a.#e.subarray(d+m[71],d+m[71]+8).fill(64),a.#e[d+m[128]]=127,a.#e.subarray(d+m[130],d+m[157]+1).fill(64),a.#e[d+m[91]]=40,a.#e[d+m[101]]=127,a.#e[d+m[100]]=127,a.#e[d+m[99]]=127,a.#e[d+m[98]]=127;let u=l*y.rpn;a.#r[u]=2,a.#r[u+1]=64,a.#r[u+2]=0,a.#r[u+3]=64,a.#r[u+4]=0,a.#r[u+5]=0;let E=l*y.ext;a.#k[E+1]=a.VLBC_BRTHEXPR;let $=l*y.redir;a.#z[$+8]=13}a.switchMode("?",3),a.buildRchTree(),a.buildRccMap(),a.dispatchEvent("mastervolume",a.#h);for(let l=0;l<Ne.length;l++)a.pushEffectType(l);a.dispatchEvent("reset")}setChMode(e,a){let l=this;if(typeof e!="number"||e<0||e>=y.ch)throw new RangeError(`Invalid part number: CH${e+1}`);if(e<0||a>=R.length)throw new RangeError(`Invalid mode ID ${a}`);l.#W[e]=a,l.dispatchEvent("chmode",{part:e,id:a,mode:R[a]}),l.pushChPrimitives(e)}getChMode(e,a){return R[this.getChModeId(e,a)]}getChModeId(e,a){return a?this.#W[e]||this.#d[e>>4]:this.#W[e]||this.#d[e>>4]||this.#t}getPortMode(e,a){return R[this.getPortModeId(e,a)]}getPortModeId(e,a){return a?this.#d[e]:this.#d[e]||this.#t}setPortMode(e,a,l){let d=this;if(e<0||e>=y.ch>>4)throw new RangeError(`Invalid port ${e+1}`);if(a<1)throw new RangeError("Range must be a positive integer");if(e+a>=y.ch>>4)throw new RangeError("Range must be in bound");if(e<0||l>=R.length)throw new RangeError(`Invalid mode ID ${l}`);d.#ie[e]=l;for(let u=e;u<e+a;u++){let E=d.#ie[u];if(a>1&&E!==0&&E!==l)break;d.#d[u]=l;for(let $=u<<4;$<u+1<<4;$++)d.dispatchEvent("chmode",{part:$,id:l,mode:R[l]}),d.pushChPrimitives($)}}copyChSetup(e,a,l){if(e===a){console.warn(`Failed attempt at overwriting CH${e+1} with its own data.`);return}let d=this;if(l&&d.#v[a]){console.warn(`Failed attempt at copying setup data from CH${e+1} to CH${a+1}.`);return}let u=P[e],E=P[a];d.#i[a]=d.#i[e],d.#e.set(d.#e.subarray(u,u+y.cc),E),d.pushChPrimitives(a)}setDrumFirstWrite(e,a){let l=this,d=l.#a[e];if(d<2)return;let u=d-2;if(l.#O[u<<1])if(a)l.#O[u<<1]=0,x()&&console.debug(`First write part for drum set ${u+1} has been reset.`);else return;else a?console.warn(`First write part for drum set ${u+1} is already blank.`):(l.#O[u<<1]=1,l.#O[u<<1|1]=e,console.debug(`First write part for drum set ${u+1} is set to CH${e+1}.`))}getChDrumFirstWrite(e){let a=this,l=a.#a[e];if(l<2)return;let d=l-2;return a.#O.subarray(d<<1,d+1<<1)}getDrumFirstWrite(e){if(e>=0&&e<y.drm)return this.#O.subarray(e<<1,e+1<<1)}switchMode(e,a=0,l=!1){x()&&console.debug(`Requested level ${a} mode change to "${e}".`);let d=this,u=g[e];if(u>-1){if(d.#t===0&&a!==3||a){if(d.initOnReset)switch(a){case 1:{d.#t===0&&d.init(1);break}case 2:{d.init(1);break}}switch(d.#f=0,u){case g.gm:{u=d.#s.gm;break}case g.g2:{u=d.#s.g2;break}}switch(d.#t=u,u){case g.gs:case g.sc:{d.#b[g[e]][1]=d.#s[e];break}}for(let k=0;k<y.ch;k++){let w=d.getChModeId(k,!0);d.#a[k]>0&&w===g["?"]&&(d.setChCc(k,0,d.#b[u][2]),x()&&console.debug(`CH${k+1} (${d.#a[k]}) (${d.getChMode(k)}), ${R[w]} (${d.#b[w][2]}) -> ${R[u]} (${d.#b[u][2]})`),d.pushChPrimitives(k))}switch(u){case g.mt32:{ue.forEach((k,w)=>{let S=w+1;d.#v[S]||(d.#i[S]=k,d.setChCc(S,91,127),d.pushChPrimitives(S))});for(let k=1;k<10;k++)d.pushChPrimitives(k);break}}let E,$;switch(u){case g["?"]:case g.g2:{E=[52,4,52,18,0,255,0,255,0,255,0,255,0,255,0,255];break}case g.xg:case g.cs1x:{E=[1,0,65,0,5,0,64,0,64,0,64,0,64,0,0,255],$=[64,0];break}case g.gm:case g.gs:case g.sc:{E=[40,4,40,18,40,32,32,0,0,255,0,255,0,255,0,255],$=[32,0];break}case g.sd:{E=[58,0,60,0,61,0,61,0],$=[61,0];break}case g["05rw"]:case g.x5d:case g.ns5r:{E=[44,1,44,19,0,255,0,255,0,255,0,255,0,255,0,255];break}case g.k11:case g.sg:{E=[24,0,0,255,0,255,0,255,0,255,0,255,0,255,0,255];break}case g.mt32:{E=[40,4,0,255,0,255,0,255,0,255,0,255,0,255,0,255];break}case g.doc:{E=[24,16,0,255,0,255,0,255,0,255,0,255,0,255,0,255];break}case g.motif:case g.s90es:case g.cs6x:{E=[129,0,133,0,130,0,128,0,128,0,0,255,0,255,0,255],$=[128,0];break}case g.pa:{E=[28,52,28,16,28,0,28,0,0,255,0,255,0,255,0,255],$=[28,0];break}case g.krs:{E=[45,0,45,0,0,255,45,0,45,0,45,0,45,0,45,0],$=[45,0];break}default:E=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}for(let k=0;k<y.efx;k++)if(!d.#S[3*k]&&typeof E[k<<1]=="number"){d.#S[3*k+1]=E[k<<1],d.#S[3*k+2]=E[k<<1|1];let w=!1;$?.length>0&&E[k<<1]===$[0]&&E[k<<1|1]===$[1]&&(w=!0),d.pushEffectType(k,w)}l&&d.setDetectionTargets(e),d.dispatchEvent("mode",R[u]),d.forceVoiceRefresh()}}else throw new Error(`Unknown mode ${e}`)}getRawStrength(){let e=this;return this.#p.forEach(function(a){let l=a>>7;e.#y[a]>e.#I[l]&&(e.#I[l]=e.#y[a])}),this.#I}getStrength(){let e=[],a=this;return this.getRawStrength().forEach(function(l,d){e[d]=Math.floor(l*a.getChCc(d,7)*a.getChCc(d,11)*a.#h/803288)}),e}newStrength(){this.#I.fill(0)}runJson(e){if(e==null){console.warn(new Error("Invalid JSON data provided."));return}if(e.type>14)return e.type===15&&e.data.constructor!==Uint8Array&&(e.data=Uint8Array.from(e.data)),this.#be[e.type].call(this,e);{let a=this.chRedir(e.part,e.track),l=!1;this.#pe[a]?.forEach(d=>{e.channel=d,l=!0,this.#be[e.type].call(this,e)}),l||console.warn(`${Oe[e.type]?Oe[e.type]:e.type}${[11,12].includes(e.type)?(e.data[0]!==void 0?e.data[0]:e.data).toString():""} event sent to CH${a+1} without any recipient.`)}this.#x.length>100&&this.#x.splice(100,this.#x.length-99)}runRaw(e){}async loadBank(e,a){let l=this;switch(e=e.toLowerCase(),e){case"s7e":{l.userBank.clearRange({msb:63,lsb:[21,22]}),l.userBank.clearRange({msb:63,lsb:[24,27]});break}case"pcg":{l.userBank.clearRange({msb:63,lsb:[6,9]}),l.userBank.clearRange({msb:63,lsb:[13,16]});break}default:throw new Error(`Unknown bank format ${e}`)}switch(e){case"s7e":case"pcg":{z.context=this,await l.userBank.load(await z.read(e,a),!1);break}}l.forceVoiceRefresh()}constructor(){super();let e=this;for(let t=0;t<10;t++)e.#A[t]=new Uint8Array(256);e.#A[10]=new Uint8Array(512),e.#J=new L,e.#s={x5:82,ds:g.krs,smotif:g.s90es,gs:4,sc:3,gm:g.gm,g2:g.g2},e.#U={dumpLimit:e.DUMP_MODE},e.#de=new Proxy(e.#U,{set:()=>{}});for(let t in J){let s=g[t];s===void 0?console.debug(`SubDB build error: "${t}" does not exist`):e.#b[s]=new Uint8Array(J[t])}for(let t of U)e.modelEx.yPlg.push(new Uint8Array(t[1]));e.userBank.strictMode=!0,e.userBank.load(`MSB	PRG	LSB	NME
062	000	000	
122	000	000	
122	001	000	
122	002	000	
122	003	000	
122	004	000	
122	005	000	
122	006	000	`),e.addEventListener("metacommit",function(t){let{data:s}=t;e.#x[0]?.type===s.type&&e.#x[0]?.amend?(e.#x[0].amend=s.amend,e.#x[0].data+=s.data):e.#x.unshift(s)}),e.#$[1]=function(t){switch(t=t.replaceAll(`\r
`,`
`).replaceAll("\r",`
`),t.substring(0,2)){case"@I":{e.#l=e.KARAOKE_TEXT,e.dispatchEvent("metacommit",{type:"Kar.Info",data:t.substring(2)?.trimStart()});break}case"@K":{e.#l=e.KARAOKE_TEXT;let s=t.substring(2);s!=="MIDI KARAOKE FILE"&&e.dispatchEvent("metacommit",{type:"Kar.Mode",data:s?.trimStart()}),console.debug(`Karaoke mode active: ${s}`);break}case"@L":{e.#l=e.KARAOKE_TEXT,e.dispatchEvent("metacommit",{type:"Kar.Lang",data:t.substring(2)?.trimStart()});break}case"@T":{e.#l=e.KARAOKE_TEXT,e.dispatchEvent("metacommit",{type:"KarTitle",data:t.substring(2)?.trimStart()});break}case"@V":{e.#l=e.KARAOKE_TEXT,e.dispatchEvent("metacommit",{type:"Kar.Ver.",data:t.substring(2)?.trimStart()});break}case"Mi":{if(t.substring(2,16)==="dStamp-1.00: 0"){let s=t.length;for(let r=t.length;r>0;r--)if((t.charCodeAt(r-1)>>5)+1>>1===1){s=r;break}let o=t.substring(16,s);e.dispatchEvent("metacommit",{type:"MidStamp",data:Ae(o)})}else t.split(`
`).forEach((s,o)=>{e.dispatchEvent("metacommit",{type:"Cmn.Text",data:s,mask:o!==0})});break}case"XF":{let s=t.slice(2).split(":");switch(s[0]){case"hd":{s.slice(1).forEach((o,r)=>{o.length&&e.dispatchEvent("metacommit",{type:["XfSngDte","XfSngRgn","XfSngCat","XfSongBt","XfSngIns","XfSngVoc","XfSngCmp","XfSngLrc","XfSngArr","XfSngPer","XfSngPrg","XfSngTag"][r],data:o})});break}case"ln":{s.slice(1).forEach((o,r)=>{o.length&&e.dispatchEvent("metacommit",{type:["XfKarLng","XfKarNme","XfKarCmp","XfKarLrc","XfKarArr","XfKarPer","XfKarPrg"][r],data:o})});break}default:e.dispatchEvent("metacommit",{type:"XfUnData",data:t})}break}default:switch(e.#l){case e.KARAOKE_TEXT:{switch(t[0]){case"\\":{e.dispatchEvent("metacommit",{type:"KarLyric",data:"",amend:!1}),e.dispatchEvent("metacommit",{type:"KarLyric",data:t.substring(1),amend:!0});break}case"/":{e.dispatchEvent("metacommit",{type:"KarLyric",data:"",mask:!0,amend:!1}),e.dispatchEvent("metacommit",{type:"KarLyric",data:t.substring(1),mask:!0,amend:!0});break}default:e.dispatchEvent("metacommit",{type:"KarLyric",data:t,amend:!0})}break}default:t.split(`
`).forEach((s,o)=>{e.dispatchEvent("metacommit",{type:"Cmn.Text",data:s,mask:o!==0})})}}},e.#$[2]=function(t){e.dispatchEvent("metacommit",{type:"Copyrite",data:t})},e.#$[3]=function(t,s){s<1&&e.#Q<1&&e.dispatchEvent("metacommit",{type:"TrkTitle",data:t})},e.#$[4]=function(t,s){e.dispatchEvent("metacommit",{type:"Instrmnt",data:t})},e.#$[5]=function(t){switch(e.#l){case e.KARAOKE_XF:{let s="";for(let o of t)switch(o){case"^":case"%":{s+=" ";break}case">":{s+="	";break}case"<":{e.dispatchEvent("metacommit",{type:"KarLyric",data:s,mask:e.#u,amend:!1}),s="",e.#u=!1;break}case"/":{e.dispatchEvent("metacommit",{type:"KarLyric",data:s,mask:!1,amend:!1}),s="",e.#u=!0;break}default:s+=o}s.length>0&&(e.dispatchEvent("metacommit",{type:"KarLyric",data:s,mask:e.#u,amend:!0}),e.#u=!1);break}default:{let s=0,o=!0,r=t.length-1;for(;o&&s<8;)switch(t.charCodeAt(s)){case 32:{s++;break}default:o=!1}switch(s>0&&(e.dispatchEvent("metacommit",{type:"C.Lyrics",data:t.substring(0,s),amend:!0,mask:e.#u,untimed:!0}),e.#u=!1),t.charCodeAt(r)){case 10:{e.dispatchEvent("metacommit",{type:"C.Lyrics",data:t.substring(s,r),amend:!1,mask:e.#u}),e.#u=!1;break}case 11:case 13:{e.dispatchEvent("metacommit",{type:"C.Lyrics",data:t.substring(s,r),amend:!1,mask:e.#u}),e.#u=!0;break}case 32:{e.dispatchEvent("metacommit",{type:"C.Lyrics",data:t.substring(s,r),amend:!0,mask:e.#u}),e.dispatchEvent("metacommit",{type:"C.Lyrics",data:" ",amend:!0,mask:!1,untimed:!0}),e.#u=!1;break}default:t.trim()===""?console.info("Blank line? Shouldn't happen."):e.dispatchEvent("metacommit",{type:"C.Lyrics",data:t,amend:!0,mask:e.#u}),e.#u=!1}break}}},e.#$[6]=function(t){e.dispatchEvent("metacommit",{type:"C.Marker",data:t})},e.#$[7]=function(t){switch(t[0]){case"$":{if(t.substring(1,5)==="Lyrc"){e.#l=e.KARAOKE_XF;let s=t.substring(6).split(":"),o=s[0].replaceAll(" ","").split(",");o.forEach((n,c,i)=>{i[c]=parseInt(n)-1});let r=Se[s[2].substring(0,2).toLowerCase()];e.dispatchEvent("metacommit",{type:"XfMeloCh",data:`CH${s[0].replaceAll(" ","").split(",").join(", CH")}`,parsed:o}),e.dispatchEvent("metacommit",{type:"XfLyrOff",data:s[1],parsed:parseInt(s[1])}),e.dispatchEvent("metacommit",{type:"XfLyrEnc",data:r[1],parsed:r[0]}),e.#u=!1}else e.dispatchEvent("metacommit",{type:"CuePoint",data:t});break}case"#":{e.dispatchEvent("metacommit",{type:"XfScneNo",data:t.substring(1)});break}case"&":{t.length===2?(e.dispatchEvent("metacommit",{type:"XfSngPrt",data:xe[t[1]]||`Unknown "${t[1]}"`}),e.#u=!1):e.dispatchEvent("metacommit",{type:"CuePoint",data:t});break}default:e.dispatchEvent("metacommit",{type:"CuePoint",data:t})}},e.#$[32]=function(t){e.#Q=t[0]+1},e.#$[33]=function(t,s){x()&&console.debug(`Track ${s} requests assigning to port ${t}.`),e.#V[s]=t+1},e.#$[81]=function(t,s){e.#oe=t/1e3},e.#$[127]=function(t,s){e.#J.run(t,s)},e.#J.default=function(t){let s=[];for(let o=0;o<8&&o<t.length;o++)s.push(t[o].toString(16).padStart(2,"0").toUpperCase());console.warn(`Unrecognized implementation-specific byte sequence: ${s.join(" ")}${t.length>8?" ...":""}
%o`,t)},e.#J.add([67,0,1],(t,s)=>{x()&&console.debug(`XGworks requests assigning track ${s} to port ${t[0]}.`),e.#V[s]=t[0]+1}).add([67,123,1],(t,s)=>{let o=[];for(let r=0;r<t.length;r+=2){let n=t[r]>>4,c=t[r]&15;if(n<7&&c&&c<8){let i=new Uint8Array(5);i[0]=c-1,i[1]=n-3<<2,i[2]=t[r|1],o.push(i)}}e.dispatchEvent("metacommit",{type:"ChordCtl",src:"yxf",data:o}),console.debug("Yamaha XF chord data: %o",o)}).add([67,123,2],(t,s)=>{let o=new Uint8Array(2);o[0]=t[0]&15,o[1]=t[0]>>4,e.dispatchEvent("metacommit",{type:"RhrslMrk",src:"yxf",data:o}),console.debug(`Yamaha XF rehearsal mark: ${["Intro","Ending","Fill-in"][o[0]]??String.fromCharCode(62+o[0])}${"'".repeat(o[1])} %o`,o)}).add([67,123,96],(t,s)=>{let o=[0,0];t.subarray(1,3).forEach(r=>{o[0]=o[0]<<7,o[0]|=r&127}),t.subarray(3,5).forEach(r=>{o[1]=o[1]<<7,o[1]|=r&127}),e.dispatchEvent("metacommit",{type:"YStyleId",data:o}),console.debug(`Yamaha style ID: model ${o[0].toString(16)}, style ${o[1]+1}`)}),e.#Z=new L("universal non-realtime"),e.#ee=new L("universal realtime"),e.#E=new L("Yamaha"),e.#P=new L("Roland"),e.#L=new L("Korg"),e.#te=new L("Kawai"),e.#ae=new L("Akai"),e.#re=new L("Casio");let a=new L("DX7+ Dump"),l=function(t){let s=[];for(let o=0;o<8&&o<t.length;o++)s.push(t[o].toString(16).padStart(2,"0").toUpperCase());console.info(`Unrecognized SysEx in "${this.name}" set: ${s.join(" ")}${t.length>8?" ...":""}
%o`,t)};e.#Z.default=l,e.#ee.default=l,e.#E.default=l,e.#P.default=l,e.#L.default=l,e.#te.default=l,e.#ae.default=l,e.#re.default=l,a.default=l,e.#Z.add([9],(t,s,o)=>{e.switchMode(["gm","?","g2"][t[0]-1],2),e.setPortMode(e.getTrackPort(s),1,[g.gm,g["?"],e.#s.g2][t[0]-1]),e.#l=e.#l||e.KARAOKE_NONE,console.info(`MIDI reset: ${["GM","Init","GM2"][t[0]-1]}`),t[0]===2&&e.init()}),e.#ee.add([4,1],(t,s,o)=>{e.invokeSysExIndicator(),e.#h=((t[1]<<7)+t[0])/16383*100,e.dispatchEvent("mastervolume",e.#h)}).add([4,3],(t,s,o)=>((t[1]<<7)+t[0]-8192)/8192).add([4,4],(t,s,o)=>t[1]-64).add([4,5],(t,s,o)=>{e.invokeSysExIndicator();let r=t[0],n=t[1],c=t[2],i=3,f=i+(r<<1),h=f+n;if(r!==1){console.error(`Unsupported GM2 global parameter set: slotpath length too long (${r})!
`,t);return}let b=0,C=0,v=0;switch(t.subarray(i,f).forEach(T=>{b=b<<7,b|=T}),x()&&console.debug(`GM2 global parameter: (${t.subarray(3,f)}; p: ${C}, v: ${v})`),b){case 129:{C===0&&(e.setEffectType(0,52,v),e.pushEffectType(0));break}case 130:{C===0&&(e.setEffectType(1,52,v|16),e.pushEffectType(1));break}default:x()&&console.debug("GM2 global paramater slot path unknown.")}}),this.#E.add([76,0,0],(t,s,o)=>{switch(t[0]){case 125:{e.initDrums(),console.info(`XG drum setup reset on drum kit ${t[1]}.`);break}case 126:{e.switchMode("xg",2),e.setPortMode(e.getTrackPort(s),4,g.xg),e.modelEx.vl.module=0,e.#l=e.#l||e.KARAOKE_NONE,console.info("MIDI reset: XG");break}default:{e.invokeSysExIndicator();let r=[0,0,0,0],n=(c,i)=>{r[i]=c};if(t.subarray(1).forEach((c,i)=>{let f=i+t[0];([n,n,n,n,h=>{this.#h=h*129/16383*100,e.dispatchEvent("mastervolume",e.#h)},h=>{},h=>{}][f]||(()=>{}))(c,i)}),t[0]<4){let c=0;r.forEach(i=>{c=c<<4,c+=i}),c-=1024,console.debug(`Master tune: ${c}`)}}}}).add([76,2,1],(t,s,o)=>{e.invokeSysExIndicator();let r="XG ";t[0]<32?(r+="reverb ",t.subarray(1).forEach((n,c)=>{([i=>{e.setEffectTypeRaw(0,!1,i),console.info(`${r}main type: ${W[i]}`),e.pushEffectType(0)},i=>{e.setEffectTypeRaw(0,!0,i),console.debug(`${r}sub type: ${i+1}`),e.pushEffectType(0)},i=>{console.debug(`${r}time: ${me(i)}s`)},i=>{console.debug(`${r}diffusion: ${i}`)},i=>{console.debug(`${r}initial delay: ${i}`)},i=>{console.debug(`${r}HPF cutoff: ${K[i]}Hz`)},i=>{console.debug(`${r}LPF cutoff: ${K[i]}Hz`)},i=>{console.debug(`${r}width: ${i}`)},i=>{console.debug(`${r}height: ${i}`)},i=>{console.debug(`${r}depth: ${i}`)},i=>{console.debug(`${r}wall type: ${i}`)},i=>{console.debug(`${r}dry/wet: ${i}`)},i=>{console.debug(`${r}send: ${D(i)}dB`)},i=>{console.debug(`${r}pan: ${i-64}`)},!1,!1,i=>{console.debug(`${r}delay: ${i}`)},i=>{console.debug(`${r}density: ${i}`)},i=>{console.debug(`${r}balance: ${i}`)},i=>{},i=>{console.debug(`${r}feedback: ${i}`)},i=>{}][t[0]+c]||function(){console.warn(`Unknown XG reverb address: ${t[0]}.`)})(n)})):t[0]<64?(r+="chorus ",t.subarray(1).forEach((n,c)=>{([i=>{e.setEffectTypeRaw(1,!1,i),console.info(`${r}main type: ${W[i]}`),e.pushEffectType(1)},i=>{e.setEffectTypeRaw(1,!0,i),console.debug(`${r}sub type: ${i+1}`),e.pushEffectType(1)},i=>{console.debug(`${r}LFO: ${ge[i]}Hz`)},i=>{},i=>{console.debug(`${r}feedback: ${i}`)},i=>{console.debug(`${r}delay offset: ${ke(i)}ms`)},i=>{},i=>{console.debug(`${r}low: ${K[i]}Hz`)},i=>{console.debug(`${r}low: ${i-64}dB`)},i=>{console.debug(`${r}high: ${K[i]}Hz`)},i=>{console.debug(`${r}high: ${i-64}dB`)},i=>{console.debug(`${r}dry/wet: ${i}`)},i=>{console.debug(`${r}send: ${D(i)}dB`)},i=>{console.debug(`${r}pan: ${i-64}`)},i=>{console.debug(`${r}to reverb: ${D(i)}dB`)},!1,i=>{},i=>{},i=>{},i=>{console.debug(`${r}LFO phase diff: ${(i-64)*3}deg`)},i=>{console.debug(`${r}input mode: ${i?"stereo":"mono"}`)},i=>{}][t[0]-32+c]||function(){console.warn(`Unknown XG chorus address: ${t[0]}.`)})(n)})):t[0]<86?(r+="variation ",t.subarray(1).forEach((n,c)=>{([i=>{e.setEffectTypeRaw(2,!1,i),console.info(`${r}main type: ${W[i]}`),e.pushEffectType(2)},i=>{e.setEffectTypeRaw(2,!0,i),console.debug(`${r}sub type: ${i+1}`),e.pushEffectType(2)}][t[0]-64+c]||function(){})(n)})):t[0]<97?(r+="variation ",t.subarray(1).forEach((n,c)=>{[i=>{console.debug(`${r}send: ${D(i)}dB`)},i=>{console.debug(`${r}pan: ${i-64}`)},i=>{console.debug(`${r}to reverb: ${D(i)}dB`)},i=>{console.debug(`${r}to chorus: ${D(i)}dB`)},i=>{e.modelEx.xg.varSys=!!i,console.debug(`${r}connection: ${i?"system":"insertion"}`)},i=>{if(e.modelEx.xg.varSys){console.warn(`${r}effect is applied system-wide. Setting its effective channel to CH${i+1} will not have any effect.`);return}if(i<64){let f=e.chRedir(i,s,!0);e.setXgChEffectSink(f,2),console.debug(`${r}channel: CH${i+1} (CH${f+1})`)}else e.setXgChEffectSink(y.invalidCh,2),console.info(`${r}channel: CH${i+1} (unsupported)`)},i=>{console.debug(`${r}mod wheel: ${i-64}`)},i=>{console.debug(`${r}bend wheel: ${i-64}`)},i=>{console.debug(`${r}channel after touch: ${i-64}`)},i=>{console.debug(`${r}AC1: ${i-64}`)},i=>{console.debug(`${r}AC2: ${i-64}`)}][t[0]-86+c](n)})):t[0]>111&&t[0]<118?r+="variation ":console.warn(`Unknown XG variation address: ${t[0]}`)}).add([76,2,64],(t,s,o)=>{t.subarray(1).forEach((r,n)=>{let c=n+t[0];if(c===0)console.debug(`XG EQ preset: ${["flat","jazz","pop","rock","classic"][r]}`);else{let i=c-1>>2,f=c-1&3,h=`XG EQ ${i} ${["gain","freq","Q","shape"][f]}: `;[()=>{console.debug(`${h}${r-64}dB`)},()=>{console.debug(`${h}${r} (raw)`)},()=>{console.debug(`${h}${r/10}`)},()=>{console.debug(`${h}${["shelf","peak"][+!!r]}`)}][f]()}})}).add([76,3],(t,s,o)=>{e.invokeSysExIndicator();let r=t[0],n=t[1],c=`XG Insertion ${t[0]+1} `;t.subarray(2).forEach((i,f)=>{([()=>{e.setEffectTypeRaw(3+r,!1,i),console.info(`${c}main type: ${W[i]}`),e.pushEffectType(3+r)},()=>{e.setEffectTypeRaw(3+r,!0,i),console.debug(`${c}sub type: ${i+1}`),e.pushEffectType(3+r)},!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,()=>{if(i<64){let h=e.chRedir(i,s,!0);e.setXgChEffectSink(h,3+r),console.debug(`${c}channel: CH${i+1} (CH${h+1})`)}else e.setXgChEffectSink(y.invalidCh,3+r),console.info(`${c}channel: CH${i+1} (unsupported)`)}][n+f]||function(){})(i)})}).add([76,6,0],(t,s,o)=>{let r=t[0];r<64?e.setLetterDisplay(t.subarray(1),"XG letter display",r):e.#K=e.clockSource.now()}).add([76,7,0],(t,s,o)=>{let r=t[0];e.#f=0,e.#R=e.clockSource.now()+3200,t.subarray(1).forEach(function(c,i){let f=i+r,h=f>>4,b=f&15,C=(b*3+h)*7,v=7,T=0;for(C-=b*5,h===2&&(v=2);T<v;)e.#H[C+T]=c>>6-T&1,T++})}).add([76,8],(t,s)=>{e.invokeSysExIndicator();let o=e.chRedir(t[0],s,!0),r=t[1],n=P[o],c=`XG CH${o+1} `,i=`Unknown XG part address ${r}.`,f=!0;t.subarray(2).forEach((h,b)=>{f=!0,r<1?console.debug(i):r<41?([()=>{e.setChCc(o,0,h),e.pushChPrimitives(o)},()=>{e.setChCc(o,32,h),e.pushChPrimitives(o)},()=>{e.#i[o]=h,e.pushChPrimitives(o)},()=>{f=!1;let C=e.chRedir(h,s,!0),v=e.#c[o];e.#c[o]=C,(o!==C||C!==v)&&(e.buildRchTree(),console.info(`${c}receives from CH${C+1}`)),e.#v[o]||(e.copyChSetup(C,o,!0),console.debug(`${c}copied from CH${C+1}.`),e.setChActive(o,1),e.pushChPrimitives(o))},()=>{e.#m[o]=+!h},()=>{},()=>{f=!1,e.setChType(o,h,g.xg),console.debug(`${c}type: ${q[h]||h}`),e.pushChPrimitives(o)},()=>{e.#r[y.rpn*o+3]=h,e.#n[y.rpnt*o+2]=1,e.dispatchEvent("pitch",{part:o,pitch:e.getPitchShift(o)})},!1,!1,()=>{e.setChCc(o,7,h)},!1,!1,()=>{e.setChCc(o,10,h||128)},!1,!1,()=>{e.setChCc(o,128,h),e.allocateAce(o,128)},()=>{e.setChCc(o,93,h)},()=>{e.setChCc(o,91,h)},()=>{e.setChCc(o,94,h)},()=>{e.setChCc(o,76,h)},()=>{e.setChCc(o,77,h)},()=>{e.setChCc(o,78,h)},()=>{e.setChCc(o,74,h)},()=>{e.setChCc(o,71,h)},()=>{e.setChCc(o,73,h)},()=>{e.setChCc(o,75,h)},()=>{e.setChCc(o,72,h)}][r+b-1]||(()=>{}))():r<48?console.debug(i):r<111?r>102&&r<105&&e.setChCc(o,[5,65][r&1],h):r<114?console.debug(i):r<116?console.debug(`${c}EQ ${["bass","treble"][r&1]} gain: ${h-64}dB`):r<118?console.debug(i):r<120?console.debug(`${c}EQ ${["bass","treble"][r&1]} freq: ${h}`):console.debug(i)}),f&&e.#a[o]>1&&e.setDrumFirstWrite(o)}).add([76,9],(t,s)=>{let o=e.chRedir(t[0],s,!0),r=t[1],n=P[o],c=`PLG-VL CH${o+1} `;t.subarray(2).forEach((i,f)=>{let h=f+r;switch(h){case 1:{console.info(`${c}breath mode: ${["system","breath","velocity","touch EG"][i]}`);break}case 0:case 27:case 28:break;default:if(h<27){let b=h-3>>1,C=["pressure","embouchure","tonguing","scream","breath noise","growl","throat formant","harmonic enhancer","damping","absorption","amplification","brightness"][b];h&1?h<23?(console.debug(`${c}${C} control source: ${ve(i)}`),i&&i<96&&e.allocateAce(o,130+b),e.#z[y.redir*o+b+2]=i,e.buildRccMap()):console.debug(`${c}${C} scale break point: ${i}`):(console.debug(`${c}${C} depth: ${i-64}`),e.setChCc(o,130+b,i))}}})}).add([76,10],(t,s,o)=>{}).add([76,16],(t,s,o)=>{}).add([76,17,0,0],(t,s,o)=>{}).add([76,112],(t,s,o)=>{if(t[0]>=U.length){console.error(`Supplied invalid plugin board ID: ${t[0]}`);return}if(t[1]>=U[t[0]][1]){console.error(`Supplied invalid slot ID for board type "${U[t[0]][0]}" (${t[0]}): ${t[1]} (#${t[1]+1}))`);return}switch(t[1]>=U[t[0]][2]?console.warn(`While enabled in Octavia, slot #${t[1]+1} for board type "${U[t[0]][0]}" (${t[0]}) may not function outside software recreation.`):t[2]>63?console.debug(`XG disable PLG-${U[t[0]][0]} (${t[0]}) slot #${t[1]+1} as it's set to CH${t[2]+1}.`):console.debug(`XG enable PLG-${U[t[0]][0]} (${t[0]}) slot #${t[1]+1} for CH${t[2]+1}.`),e.modelEx.yPlg[t[0]][t[1]]=t[2]<64?e.chRedir(t[2],s,!0):y.invalidCh,t[0]){case 0:{e.#k[y.ext*t[2]]=e.EXT_VL;break}case 2:{e.#k[y.ext*t[2]]=e.EXT_DX;break}default:e.#k[y.ext*t[2]]=e.EXT_NONE}}).add([73,0,0],(t,s)=>{let o=t[0],r="MU System - ";t.subarray(1).forEach((n,c)=>{let i=o+c;i===8?(e.lcdContrast=Math.max(0,Math.min(8,9-n))<<2,console.debug(`${r}LCD contrast: ${n}.`)):i===18?(e.#b[g.xg][1]=[0,126,152][n]??127,console.debug(`${r}default bank: ${["MU Basic","MU100 Native","PSR/LE"][n]??n}.`),e.modelEx.xg.map=n,e.dispatchEvent("banklevel",{mode:"xg",data:n}),e.forceVoiceRefresh()):i>=64&&i<69&&[()=>{e.dispatchEvent("channelactive",n)},()=>{n<8?(e.dispatchEvent("channelmin",n<<4),console.debug(`Octavia System: Minimum CH${(n<<4)+1}`)):(e.dispatchEvent("channelreset"),console.info("Octavia System: Clear channel ranges"))},()=>{n<8?(e.dispatchEvent("channelmax",(n<<4)+15),console.debug(`Octavia System: Maximum CH${(n<<4)+16}`)):(e.dispatchEvent("channelreset"),console.info("Octavia System: Clear channel ranges"))},()=>{e.dispatchEvent("channelreset"),console.info("Octavia System: Clear channel ranges")},()=>{e.#M=!!n,console.info(`Octavia System: RS receiving ${["dis","en"][n]}abled.`)}][i-64]()})}).add([73,10,0],(t,s)=>{let o=t[0],r=`MU RS${e.#M?"":" (ignored)"}: `;if(t[1]!==0){console.info(`${r}button ${o} pressed.`);return}if(o<16)switch(o){case 0:{e.#M&&e.dispatchEvent("portrange",1),console.info(`${r}Show single port.`),e.lcdHideBankInfo=!1;break}case 1:{let n=e.chRedir(0,s,!0);e.#M&&(e.dispatchEvent("portrange",2),e.dispatchEvent("portstart",n)),console.info(`${r}Show CH${n+1}~CH${n+32}.`),e.lcdHideBankInfo=!1;break}case 2:{let n=e.chRedir(0,s,!0);e.#M&&(e.dispatchEvent("portrange",4),e.dispatchEvent("portstart",n)),console.info(`${r}Show CH${n+1}~CH${n+64}.`),e.lcdHideBankInfo=!1;break}case 3:{let n=e.chRedir(0,s,!0);e.#M&&(e.dispatchEvent("portrange",2),e.dispatchEvent("portstart",n)),console.info(`${r}Show CH${n+1}~CH${n+32}, hide info.`),e.lcdHideBankInfo=!0;break}default:o>=4&&o<12?(e.lcdContrast=12-o<<1,console.debug(`${r}LCD contrast set to ${o-3}.`)):console.debug(`${r}unknown switch ${o} invoked.`)}else if(o<32){if(e.#M){let n=e.chRedir(o-16+(e.#le<<4),s,!0);e.dispatchEvent("channelactive",n)}}else if(o<36){let n=e.chRedir(o-32<<4,s,!0);e.#M&&(e.dispatchEvent("portrange",1),e.dispatchEvent("portstart",n>>4),e.#le=o-32),console.info(`${r}Show CH${n+1}~CH${n+16}.`)}}).add([73,11,0],(t,s)=>{let o="MU1000 System - channel ",r="Octavia System - channel ",n=t[0];t.subarray(1).forEach((c,i)=>{let f=n+i;([()=>{e.setChActive(c,1),e.dispatchEvent("channelactive",c),x()&&console.debug(`${o}current part: CH${c+1}`)},()=>{c<5?(e.dispatchEvent("portrange",1<<c),console.debug(`${o}port range: ${1<<c} port(s)`)):(e.dispatchEvent("portrange",0),console.debug(`${o}port range: reset`))},()=>{c<16?(e.dispatchEvent("portstart",c),console.debug(`${r}start port: ${"ABCDEFGHIJKLMNOP"[c]}`)):(e.dispatchEvent("portstart",255),console.debug(`${r}start port: reset`))}][f]||(()=>{console.debug(`${o}unknown address: ${f}`)}))()})}).add([87,0,0],(t,s)=>{let o="VL70-m sound module ";switch(t[0]){case 126:{console.info(`${o}mode set to: ${["VL-XG","VL70-m voice"][t[1]]??`invalid (${t[1]})`}`),e.switchMode("xg",1),t[1]<2&&(e.modelEx.vl.module=t[1]+1),e.setPortMode(e.getTrackPort(s),1,g.xg);break}default:console.info(`Unknown ${o}address: ${t[0]}`)}}).add([93,3],(t,s)=>{let o=e.chRedir(t[0],s,!0),r=`PLG-SG CH${o+1} `,n=e.clockSource.now(),c=e.modelEx.sg;if(t[1]===0){let i="",f=0;t.subarray(2).forEach((h,b)=>{b%2===0?i+=$e[h]||h.toString().padStart("0"):f+=h*13}),(n>=c.convLastSyll||c.runLineLen>=c.maxLineLen)&&(e.dispatchEvent("metacommit",{type:"SGLyrics",data:"",amend:!1}),c.splitMask=n<c.convLastSyll,c.runLineLen=0),e.dispatchEvent("metacommit",{type:"SGLyrics",data:`${we(i)}`,amend:!0,mask:c.splitMask}),c.runLineLen++,c.splitMask=!1,c.convLastSyll=n+Math.ceil(f/2)+e.#oe,x()&&console.debug(`${r}vocals: ${i}`)}else console.warn(`Unknown PLG-SG data: ${t}`)}).add([98,96],(t,s,o,r)=>{let n=e.chRedir(t[0],s,!0),c=P[n],i=t[1];t.subarray(2).forEach((f,h)=>{let b=i+h;if(!(b<10)){if(b===10)e.resetAce();else if(b<27){let C=b+131;e.setChCc(n,C,f),!r?.noAce&&f>0&&f!==64&&e.allocateAce(n,C),e.dispatchEvent("cc",{part:n,cc:C,data:f})}}})}).add([1,20],(t,s,o)=>{o===115?(e.switchMode("doc",2),e.setPortMode(e.getTrackPort(s),1,g.doc),console.info("MIDI reset: DOC")):console.debug(`Unknown Yamaha SysEx: 67, ${o}, ${t.join(", ")}`)}).add([1,17,15,89],(t,s,o)=>{o===115?(e.setEffectType(0,24,t[0]|16),e.pushEffectType(0)):console.debug(`Unknown Yamaha SysEx: 67, ${o}, ${t.join(", ")}`)}).add([1,24],(t,s,o)=>{if(o===115){for(let r=0;r<16;r++){let n=e.chRedir(r,s,!0);e.setChCc(n,91,127)}console.info("DOC Global Reverb: on")}else console.debug(`Unknown Yamaha SysEx: 67, ${o}, ${t.join(", ")}`)}).add([126,0],(t,s,o)=>{switch(t[1]){case 0:{e.dispatchEvent("metacommit",{type:"YMCSSect",data:"Disabled",raw:"Intro "}),console.debug("Yamaha Section Control is off.");break}case 127:{e.dispatchEvent("metacommit",{type:"YMCSSect",data:["Intro","Main A","Main B","Fill-in AB","Fill-in BA","Ending","Blank"][t[0]-8]??`invalid section ${t[0]}`,raw:["Intro ","Main A","Main B","FillAB","FillBA","Ending","Blank "][t[0]-8]??`ID: ${t[0]}`}),console.debug(`Yamaha Section Control switches to "${["intro","main A","main B","fill-in AB","fill-in BA","ending","blank"][t[0]-8]??`Invalid section ${t[0]}`}".`);break}default:console.debug(`Unknown YMCS section control: ${t[1]}`)}}).add([126,2],(t,s,o)=>{let r=[];for(let n=0;n<t.length;n+=2){let c=t[n]>>4,i=t[n]&15;if(c<7&&i&&i<8){let f=new Uint8Array(5);f[0]=i-1,f[1]=c-3<<2,f[2]=t[n|1],r.push(f)}}e.dispatchEvent("metacommit",{type:"ChordCtl",src:"ymcs",data:r}),console.debug("YMCS chord data: %o",r)});let d=function(t,s,o,r){},u=function(t,s){e.invokeSysExIndicator();let o=t*y.dpn,r=s[0],n=s[1];s.subarray(2).forEach((c,i)=>{let f=i+n,h=-1;f<16?([()=>{h=24},()=>{h=25},()=>{h=26},()=>{},()=>{h=28},()=>{h=29},()=>{h=30},()=>{h=31},()=>{},()=>{},()=>{},()=>{h=20},()=>{h=21},()=>{h=22},()=>{h=23},()=>{}][f]||(()=>{console.debug(`Unknown XG-style drum param ${f} on set ${t+1}.`)}))():f<32||(f<40?([()=>{h=48},()=>{h=49},!1,!1,()=>{h=52},()=>{h=53}][f-32]||(()=>{console.debug(`Unknown XG-style drum param ${f} on set ${t+1}.`)}))():f<80||([()=>{h=36}][f-80]||(()=>{console.debug(`Unknown XG-style drum param ${f} on set ${t+1}.`)}))()),h>=0?(x()&&console.debug(o,h,r,c),e.#w[(o+N[h])*y.dnc+r]=c):x()&&console.debug(`XG-style drum param ${f} has no writes.`)})},E=function(t,s,o){e.invokeSysExIndicator();let r=t*y.dpn,n=(s<<7)+o[0];o.subarray(1).forEach((c,i)=>{let f=i+n,h=f&127,b=f>>7,C=-1;b>1&&([()=>{C=26},()=>{},()=>{C=28},()=>{C=29},()=>{C=30},()=>{},()=>{},()=>{C=31}][b-2]||(()=>{console.debug(`Unknown GS-style drum param ${b} on set ${t+1}.`)}))(),C>-1?(x()&&console.debug(r,C,h,c),e.#w[(r+N[C])*y.dnc+h]=c):x()&&console.debug(`GS-style drum param ${b} has no writes.`)})};this.#E.add([76,48],(t,s,o)=>{u(0,t)}).add([76,49],(t,s,o)=>{u(1,t)}).add([76,50],(t,s,o)=>{u(2,t)}).add([76,51],(t,s,o)=>{u(3,t)}).add([76,52],(t,s,o)=>{u(4,t)}).add([76,53],(t,s,o)=>{u(5,t)}).add([76,54],(t,s,o)=>{u(6,t)}).add([76,55],(t,s,o)=>{u(7,t)}),this.#E.add([89,0],(t,s,o)=>{if(e.eprom){let r=t[0],n=(t[1]<<14)+(t[2]<<7)+t[3]+(e.eprom.offset||0);x()&&console.debug(`MU1000 EPROM trail to 0x${n.toString(16).padStart(6,"0")}, ${r} bytes.`);let c=e.eprom.data;t.subarray(4).forEach((i,f)=>{let h=f>>3,b=f&7;if(b===7)for(let C=0;C<7;C++)c[n+7*h+C]+=(i>>6-C&1)<<7;else c[n+7*h+b]=i})}}).add([89,1],(t,s,o)=>{let r=(t[0]<<21)+(t[1]<<14)+(t[2]<<7)+t[3];x()&&console.debug(`MU1000 EPROM jump to 0x${r.toString(16).padStart(6,"0")}.`),e.eprom&&(e.eprom.offset=r)}).add([89,2],(t,s,o)=>{if(e.eprom){let r=(t[0]<<21)+(t[1]<<14)+(t[2]<<7)+t[3]+(e.eprom.offset||0);x()&&console.debug(`MU1000 EPROM write to 0x${r.toString(16).padStart(6,"0")}.`);let n=e.eprom.data;t.subarray(4).forEach((c,i)=>{let f=i>>3,h=i&7;if(h===7)for(let b=0;b<7;b++)n[r+7*f+b]+=(c>>6-b&1)<<7;else n[r+7*f+h]=c})}}).add([89,3],(t,s,o)=>{}),this.#E.add([39,48],(t,s,o)=>{}).add([43,0,0],(t,s,o)=>{e.invokeSysExIndicator();let r=[0,0,0,0],n=(c,i)=>{r[i]=c};if(t.subarray(1).forEach((c,i)=>{let f=i+t[0];[n,n,n,n,()=>{this.#h=c*129/16383*100,e.dispatchEvent("mastervolume",e.#h)},()=>c-64,()=>c||128,()=>c,()=>c,()=>{console.debug(`TG300 variation on cc${c}.`)}][f](c,f)}),t[0]<4){let c=0;r.forEach(i=>{c=c<<4,c+=i}),c-=1024,console.debug(`Master tune: ${c}`)}}).add([43,1,0],(t,s,o)=>{e.invokeSysExIndicator()}).add([43,2],(t,s,o)=>{e.invokeSysExIndicator();let r=e.chRedir(t[0],s,!0),n=t[1],c=P[r],i=`TG300 CH${r+1} `;t.subarray(2).forEach((f,h)=>{h<5?([()=>{},()=>{e.setChCc(r,0,f),e.pushChPrimitives(r)},()=>{e.setChCc(r,32,f),e.pushChPrimitives(r)},()=>{e.#i[r]=f,e.pushChPrimitives(r)},()=>{let b=e.chRedir(f,s,!0),C=e.#c[r];e.#c[r]=b,(r!==b||b!==C)&&(e.buildRchTree(),console.info(`${i}receives from CH${b+1}`))}][h+n]||(()=>{}))(f,h+n):h<21||(h<47?([()=>{e.#m[r]=+!f},()=>{},()=>{},()=>{e.#r[y.rpn*r+3]=f,e.#n[y.rpnt*r+2]=1,e.dispatchEvent("pitch",{part:r,pitch:e.getPitchShift(r)})},()=>{},()=>{e.setChCc(r,7,f)},!1,!1,()=>{e.setChCc(r,10,f||128)},!1,!1,()=>{console.debug(`${i} AC1 at cc${f}`)},()=>{console.debug(`${i} AC2 at cc${f}`)},()=>{e.#e[c+m[128]]=f,e.allocateAce(r,128)},()=>{e.#e[c+m[93]]=f},()=>{e.#e[c+m[91]]=f},()=>{e.#e[c+m[94]]=f},()=>{e.#e[c+m[76]]=f},()=>{e.#e[c+m[77]]=f},()=>{e.#e[c+m[74]]=f},()=>{e.#e[c+m[71]]=f},()=>{e.#e[c+m[73]]=f},()=>{e.#e[c+m[75]]=f},()=>{e.#e[c+m[72]]=f},()=>{e.#e[c+m[78]]=f}][h+n-21]||(()=>{}))(f,h+n):h<95||([()=>{e.#e[c+m[65]]=f},()=>{e.#e[c+m[5]]=f}][h+n-95]||(()=>{}))(f,h+n))})}).add([43,7,0],(t,s,o)=>{let r=t[0];e.setLetterDisplay(t.subarray(1),"TG300 letter display",r)}).add([43,7,1],(t,s,o)=>{e.#f=0,e.#R=e.clockSource.now()+3200,t.forEach(function(r,n){let c=n>>4,i=n&15,f=(i*3+c)*7,h=7,b=0;for(f-=i*5,c===2&&(h=2);b<h;)e.#H[f+b]=r>>6-b&1,b++})}),this.#P.add([66,18,0,0,127],(t,s,o)=>{e.switchMode("sc",2),e.setPortMode(e.getTrackPort(s),2,g.sc),e.#l=e.KARAOKE_NONE,e.#N.fill(0),console.info(`GS system to ${["single","dual"][t[0]]} mode.`)}).add([66,18,64,0],(t,s,o)=>{switch(t[0]){case 127:{e.switchMode("gs",2),e.setPortMode(e.getTrackPort(s),4,g.gs),e.#l=e.KARAOKE_NONE,e.#N.fill(0),console.info("MIDI reset: GS");break}default:{e.invokeSysExIndicator();let r=[0,0,0,0],n=(c,i)=>{r[i]=c};if(t.subarray(1).forEach((c,i)=>{let f=i+t[0];[n,n,n,n,h=>{this.#h=h*129/16383*100,e.dispatchEvent("mastervolume",e.#h)},h=>{},h=>{}][f](c,i)}),t[0]<4){let c=0;r.forEach(i=>{c=c<<4,c+=i}),c-=1024,console.debug(`Master tune: ${c}`)}}}}).add([66,18,64,1],(t,s,o)=>{e.invokeSysExIndicator();let r=t[0];if(r<16){let n="".padStart(r," ");t.subarray(1).forEach((c,i)=>{n+=String.fromCharCode(Math.max(32,c))}),n=n.padEnd(16," "),console.debug(`GS patch name: ${n}`)}else r<48||(r<65?t.subarray(1).forEach((n,c)=>{let i=`GS ${r+c>55?"chorus":"reverb"} `;([()=>{console.info(`${i}type: ${fe[n]}`),e.setEffectType(0,40,n),e.pushEffectType(0)},()=>{},()=>{},()=>{},()=>{},()=>{},!1,()=>{console.debug(`${i}predelay: ${n}ms`)},()=>{console.info(`${i}type: ${Te[n]}`),e.setEffectType(1,40,16+n),e.pushEffectType(1)},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{console.debug(`${i}to reverb: ${D(n)}`)},()=>{console.debug(`${i}to delay: ${D(n)}`)}][r+c-48]||(()=>{}))()}):r<80?console.debug(`Unknown GS patch address: ${r}`):r<91?t.subarray(1).forEach((n,c)=>{let i="GS delay ";([()=>{console.info(`${i}type: ${Me[n]}`),e.setEffectType(2,40,32+n),e.pushEffectType(2)},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{console.debug(`${i}to reverb: ${D(n)}`)}][r+c-80]||(()=>{}))()}):console.debug(`Unknown GS patch address: ${r}`))}).add([66,18,64,2],(t,s,o)=>{let r="GS EQ ";t.subarray(1).forEach((n,c)=>{([()=>{console.debug(`${r}low freq: ${[200,400][n]}Hz`)},()=>{console.debug(`${r}low gain: ${n-64}dB`)},()=>{console.debug(`${r}high freq: ${[3e3,6e3][n]}Hz`)},()=>{console.debug(`${r}high gain: ${n-64}dB`)}][t[0]+c]||function(){console.warn(`Unknown GS EQ address: ${t[0]+c}`)})()})}).add([66,18,64,3],(t,s,o)=>{e.invokeSysExIndicator();let r="GS EFX ",n=function(c,i){let f=Pe(e.#S.subarray(10,12),i,c);f&&console.debug(`${r}${de(e.#S.subarray(10,12))} ${f}`)};t.subarray(1).forEach((c,i)=>{([()=>{e.setEffectTypeRaw(3,!1,32+c),e.pushEffectType(3)},()=>{e.setEffectTypeRaw(3,!0,c),console.info(`${r}type: ${de(e.#S.subarray(10,12))}`),e.pushEffectType(3)},!1,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,()=>{console.debug(`${r}to reverb: ${D(c)}dB`)},()=>{console.debug(`${r}to chorus: ${D(c)}dB`)},()=>{console.debug(`${r}to delay: ${D(c)}dB`)},!1,()=>{console.debug(`${r}1 source: ${c}`),c&&c<96&&e.allocateAceAll(c)},()=>{console.debug(`${r}1 depth: ${c-64}`)},()=>{console.debug(`${r}2 source: ${c}`),c&&c<96&&e.allocateAceAll(c)},()=>{console.debug(`${r}2 depth: ${c-64}`)},()=>{console.debug(`${r}to EQ: ${c?"ON":"OFF"}`)}][t[0]+i]||function(f,h){console.warn(`Unknown GS EFX address: ${h}`)})(c,t[0]+i)})}).add([66,18,65],(t,s,o)=>{E((t[0]>>4)+1<<1,t[0]&15,t.subarray(1))}).add([66,18,72],(t,s,o)=>{let r=(t[0]&127)<<7|t[1]&127;console.debug(r,Re(t.subarray(2)))}).add([69,18,16],(t,s,o)=>{switch(t[0]){case 0:{let r=t[1];e.setLetterDisplay(t.subarray(2),"GS display text",r);break}case 8:{let r=t[1],n=e.modelEx.sc;t.subarray(2).forEach((c,i)=>{([()=>{n.showBar=!(c&1),n.invBar=c>>1&1,n.invDisp=c>>2&1},()=>{n.peakHold=c<4?c:1}][i+r]||(()=>{console.debug("Unsupported GS display type SysEx.")}))()});break}case 32:{e.#R=e.clockSource.now()+3200,t[1]===0&&(t[2]?(e.#f=Math.max(Math.min(t[2]-1,9),0),x()&&console.debug(`GS switch display page ${t[2]-1}.`)):(e.#f=0,e.#R=e.clockSource.now(),x()&&console.debug("GS disable display page.")));break}default:if(t[0]<6){e.#f>9&&(e.#f=0);let r=t[0]-1<<1|t[1]>>6;e.#f===r&&(e.#R=e.clockSource.now()+3200),e.#A[r]?.length||(e.#A[r]=new Uint8Array(256));let n=e.#A[r];x()&&console.debug(`GS frame draw page ${r}.`);let c=t[1]&63;t.subarray(2).forEach(function(f,h){let b=h+c,C=b>>4,v=b&15,T=(v*4+C)*5,A=5,M=0;for(T-=v*4,C===3&&(A=1);M<A;)n[T+M]=f>>4-M&1,M++})}else console.warn(`Unknown GS display section: ${t[0]}`)}}).add([69,18,32],(t,s,o)=>{let r=t[0],n=t[1],c=t.subarray(2);if(r>>4){console.warn(`SC-8850 partial screen dump out of bounds: invalid bundle.
`,t);return}let i=n+c.length,f=n*6-(n*2428>>16<<1),h=i*6-(i*2428>>16<<1);if(f>640){console.warn(`SC-8850 partial screen dump out of bounds: invalid buffer range.
`,t);return}h>640&&(console.info(`SC-8850 partial screen dump out of bounds: invalid buffer end, automatically restricted.
`,t),h=640);let b=new Uint8Array(h-f);c.forEach((T,A)=>{let M=A+n,H=(M*2428&65535)*27>>16===26,_e=M*6-(M*2428>>16<<1),ee=H?2:0;for(;ee<6;)b[_e+(5-ee)]=T>>ee&1,ee++});let C=r*108+n,v=C*6-(C*2428>>16<<1);e.dispatchEvent("screen",{type:"sc8850",offset:v,data:b}),x()&&console.debug(`SC-8850 screen dump: bundle ${r+1}, range ${f}~${h}`)});let $=function(t,s,o){e.invokeSysExIndicator();let r=t[0],n=P[s],c=V[s],i=`GS CH${s+1} `;r<3?(t.subarray(1).forEach((f,h)=>{[()=>{e.#e[n+m[0]]=f,e.pushChPrimitives(s)},()=>{e.#i[s]=f},()=>{let b=0;f<16?b=e.chRedir(f,o,!0):b=y.ch;let C=e.#c[s];e.#c[s]=b,(s!==b||b!==C)&&(e.buildRchTree(),console.info(`${i}receives from CH${b+1}`))}][r+h]()}),e.pushChPrimitives(s)):r<19||(r<44?t.subarray(1).forEach((f,h)=>{([()=>{e.#m[s]=+!f},!1,()=>{e.setChType(s,f<<1,g.gs),console.debug(`${i}type: ${f?"drum ":"melodic"}${f||""}`)},()=>{e.#r[c+3]=f,e.#n[y.rpnt*s+2]=1,e.dispatchEvent("pitch",{part:s,pitch:e.getPitchShift(s)})},!1,!1,()=>{e.#e[n+m[7]]=f},!1,!1,()=>{e.setChCc(s,10,f||128)},!1,!1,()=>{console.debug(`${i}CC 1: cc${f}`)},()=>{console.debug(`${i}CC 2: cc${f}`)},()=>{e.#e[n+m[93]]=f},()=>{e.#e[n+m[91]]=f},!1,!1,()=>{e.#r[c+1]=f,e.#n[y.rpnt*s+1]=1,e.dispatchEvent("pitch",{part:s,pitch:e.getPitchShift(s)})},()=>{e.#r[c+2]=f,e.#n[y.rpnt*s+1]=1,e.dispatchEvent("pitch",{part:s,pitch:e.getPitchShift(s)})},()=>{e.#e[n+m[94]]=f}][r+h-19]||(()=>{}))()}):r<76||console.debug(`Unknown GS part address: ${r}`))},k=function(t,s){let o=t[0],r=`GS CH${s+1} `;o<2?t.subarray(1).forEach((n,c)=>{[()=>{e.setChCc(s,32,n)},()=>{}][o+c]()}):o<32?console.warn(`Unknown GS misc address: ${o}`):o<35?t.subarray(1).forEach((n,c)=>{[()=>{console.debug(`${r}EQ: o${["ff","n"][n]}`)},()=>{},()=>{console.debug(`${r}EFX: o${["ff","n"][n]}`),e.setChEffectSink(s,n?3:0)}][o+c-32]()}):console.warn(`Unknown GS misc address: ${o}`)};this.#P.add([66,18,64,16],(t,s)=>{$(t,e.chRedir(9,s,!0),s)}).add([66,18,64,17],(t,s)=>{$(t,e.chRedir(0,s,!0),s)}).add([66,18,64,18],(t,s)=>{$(t,e.chRedir(1,s,!0),s)}).add([66,18,64,19],(t,s)=>{$(t,e.chRedir(2,s,!0),s)}).add([66,18,64,20],(t,s)=>{$(t,e.chRedir(3,s,!0),s)}).add([66,18,64,21],(t,s)=>{$(t,e.chRedir(4,s,!0),s)}).add([66,18,64,22],(t,s)=>{$(t,e.chRedir(5,s,!0),s)}).add([66,18,64,23],(t,s)=>{$(t,e.chRedir(6,s,!0),s)}).add([66,18,64,24],(t,s)=>{$(t,e.chRedir(7,s,!0),s)}).add([66,18,64,25],(t,s)=>{$(t,e.chRedir(8,s,!0),s)}).add([66,18,64,26],(t,s)=>{$(t,e.chRedir(10,s,!0),s)}).add([66,18,64,27],(t,s)=>{$(t,e.chRedir(11,s,!0),s)}).add([66,18,64,28],(t,s)=>{$(t,e.chRedir(12,s,!0),s)}).add([66,18,64,29],(t,s)=>{$(t,e.chRedir(13,s,!0),s)}).add([66,18,64,30],(t,s)=>{$(t,e.chRedir(14,s,!0),s)}).add([66,18,64,31],(t,s)=>{$(t,e.chRedir(15,s,!0),s)}).add([66,18,64,64],(t,s)=>{k(t,e.chRedir(9,s,!0))}).add([66,18,64,65],(t,s)=>{k(t,e.chRedir(0,s,!0))}).add([66,18,64,66],(t,s)=>{k(t,e.chRedir(1,s,!0))}).add([66,18,64,67],(t,s)=>{k(t,e.chRedir(2,s,!0))}).add([66,18,64,68],(t,s)=>{k(t,e.chRedir(3,s,!0))}).add([66,18,64,69],(t,s)=>{k(t,e.chRedir(4,s,!0))}).add([66,18,64,70],(t,s)=>{k(t,e.chRedir(5,s,!0))}).add([66,18,64,71],(t,s)=>{k(t,e.chRedir(6,s,!0))}).add([66,18,64,72],(t,s)=>{k(t,e.chRedir(7,s,!0))}).add([66,18,64,73],(t,s)=>{k(t,e.chRedir(8,s,!0))}).add([66,18,64,74],(t,s)=>{k(t,e.chRedir(10,s,!0))}).add([66,18,64,75],(t,s)=>{k(t,e.chRedir(11,s,!0))}).add([66,18,64,76],(t,s)=>{k(t,e.chRedir(12,s,!0))}).add([66,18,64,77],(t,s)=>{k(t,e.chRedir(13,s,!0))}).add([66,18,64,78],(t,s)=>{k(t,e.chRedir(14,s,!0))}).add([66,18,64,79],(t,s)=>{k(t,e.chRedir(15,s,!0))}),this.#L.add([54,65],(t,s)=>{let o=e.#s.x5===81?"05rw":"x5d";e.switchMode(o,1),e.setPortMode(e.getTrackPort(s),1,g[o]);let r=t[t.length-1],n=t.subarray(0,t.length-1),c=B(n);c!==r&&(console.info(`X5D multi parameters checksum mismatch! Expected ${c}, got ${r}.`),console.debug(t));let i=(t[1]<<7)+t[0],f=(t[3]<<7)+t[2],h=e.chRedir(i&15,s,!0),b=P[h];[()=>{f<1||(f<101?(e.setChType(h,e.CH_MELODIC,g.x5d),e.#i[h]=f-1,e.#e[b+m[0]]=e.#s.x5):f<229?(e.setChType(h,e.CH_MELODIC,g.x5d),e.#i[h]=f-101,e.#e[b+m[0]]=56):(e.setChType(h,e.CH_DRUMS,g.x5d),e.#i[h]=Ue[f-229]||0,e.#e[b+m[0]]=62)),e.pushChPrimitives(h)},()=>{e.#e[b+m[7]]=f},()=>{f<31&&(e.#e[b+m[10]]=Math.round((f-15)*4.2+64))},()=>{e.#e[b+m[93]]=Q(f)},()=>{e.#e[b+m[91]]=Q(f)},()=>{e.#r[h*y.rpn+3]=f>8191?f-16320:64+f,e.#n[y.rpnt*h+2]=1,e.dispatchEvent("pitch",{part:h,pitch:e.getPitchShift(h)})},()=>{e.#r[h*y.rpn+1]=f>8191?f-16320:64+f,e.#n[y.rpnt*h+1]=1,e.dispatchEvent("pitch",{part:h,pitch:e.getPitchShift(h)})},()=>{f>0&&(e.#r[h*y.rpn]=f,e.#n[y.rpnt*h]=1,e.dispatchEvent("pitch",{part:h,pitch:e.getPitchShift(h)}))},()=>{}][i>>4]()}).add([54,76,0],(t,s)=>{e.invokeSysExIndicator();let o=e.#s.x5===81?"05rw":"x5d";e.switchMode(o,1),e.setPortMode(e.getTrackPort(s),1,g[o]);let r="",n=e.#s.x5,c=0,i=0,f="MSB	PRG	LSB	NME";I(t,function(h,b){if(b<16400){let C=b%164;switch(!0){case C<10:{h>31&&(r+=String.fromCharCode(h));break}case C===10:break;case C===11:{f+=`
${n}	${c}	${i}	${r.trim().replace("Init Voice","")}`,c++,r="";break}}c>99&&(n=90,c=0)}}),e.userBank.clearRange({msb:e.#s.x5,prg:[0,99],lsb:0}),e.userBank.load(f),x()&&console.debug(f),e.forceVoiceRefresh()}).add([54,77,0],(t,s)=>{e.invokeSysExIndicator();let o=e.#s.x5===81?"05rw":"x5d";e.switchMode(o,1),e.setPortMode(e.getTrackPort(s),1,g[o]);let r="",n=90,c=0,i=0,f="MSB	PRG	LSB	NME";I(t,function(h,b){if(b<13600){let C=b%136;switch(!0){case C<10:{h>31&&(r+=String.fromCharCode(h));break}case C===11:{f+=`
${n}	${c}	${i}	${r.trim().replace("Init Combi","")}`,c++,r="";break}}}}),e.userBank.clearRange({msb:90,prg:[0,99],lsb:0}),e.userBank.load(f),x()&&console.debug(f),e.forceVoiceRefresh()}).add([54,78],(t,s)=>{let o=e.#s.x5===81?"05rw":"x5d";e.switchMode(o,0),e.setPortMode(e.getTrackPort(s),1,g[o]),console.debug(`X5D mode switch requested: ${["combi","combi edit","prog","prog edit","multi","global"][t[0]]} mode.`)}).add([54,85],(t,s)=>{e.invokeSysExIndicator();let o=e.#s.x5===81?"05rw":"x5d";e.switchMode(o,1),e.setPortMode(e.getTrackPort(s),1,g[o]),I(t,(r,n)=>{n>0&&n<3&&(e.setEffectType(n-1,44,r),e.pushEffectType(n-1))})}).add([54,104],(t,s)=>{e.invokeSysExIndicator();let o=e.#s.x5===81?"05rw":"x5d";e.switchMode(o,1);let r=e.getTrackPort(s);if(e.#d[r]&&e.#d[r]!==g[o])if(e.#U.dumpLimit===e.DUMP_MODE){console.warn(`Dump cancelled for track ${s}. Port ${String.fromCharCode(65+r)} mode "${R[e.#d[r]]}" mismatch, should be "${o}".`);return}else console.info(`Track ${s} is trying to perform a mismached mode dump on port ${String.fromCharCode(65+r)}.`);e.setPortMode(r,1,g[o]),I(t,function(n,c,i,f){if(c<192){let h=e.chRedir(Math.floor(c/12),s,!0),b=P[h];switch(c%12){case 0:{n<128?(e.setChType(h,e.CH_MELODIC,g.x5d),e.#e[b+m[0]]=e.#s.x5,e.#i[h]=n):(e.setChType(h,e.CH_DRUMS,g.x5d),e.#e[b+m[0]]=62,e.#i[h]=Ue[n-128]),n>0&&e.setChActive(h,1),e.pushChPrimitives(h);break}case 1:{e.#e[b+m[7]]=n;break}case 2:{e.#r[h*y.rpn+3]=n>127?n-192:64+n,e.#n[y.rpnt*h+2]=1,e.dispatchEvent("pitch",{part:h,pitch:e.getPitchShift(h)});break}case 3:{e.#r[h*y.rpn+1]=n>127?n-192:64+n,e.#n[y.rpnt*h+1]=1,e.dispatchEvent("pitch",{part:h,pitch:e.getPitchShift(h)});break}case 4:{n<31&&(e.#e[b+m[10]]=Math.round((n-15)*4.2+64));break}case 5:{let C=n>>4,v=n&15;e.#e[b+m[91]]=Q(v),e.#e[b+m[93]]=Q(C);break}case 10:{e.#a[h]||(e.#e[b+m[0]]=n>>6?56:e.#s.x5,e.pushChPrimitives(h));break}case 11:{let C=e.chRedir(n&15,s,!0),v=n>>4;e.#c[h]=n,(C!==h||v)&&console.info(`X5D Part CH${h+1} receives from CH${C+1}.`)}}}else{let h=e.chRedir(c-192,s,!0)}}),e.buildRchTree()}),this.#P.add([22,18,127],(t,s,o)=>{e.switchMode("mt32",2),e.setPortMode(e.getTrackPort(s),1,g.mt32),e.#l=e.KARAOKE_NONE,e.userBank.clearRange({msb:0,lsb:127,prg:[0,127]}),console.info("MIDI reset: MT-32")}).add([22,18,0],(t,s,o)=>{e.switchMode("mt32",1);let r=e.chRedir(o,s,!0),n=t[1];t.subarray(2).forEach((c,i)=>{let f=i+n;e.#G[f+(r-1)*16]=c,([!1,()=>{let h=e.#G[r-1<<4];if(h<3){if(e.#T[r]=1,h===2)for(let b=0;b<name.length;b++)e.#D[(r-1)*y.cmt+b]=e.#B[c*y.cmt+b];else{let b=e.baseBank.get(0,c+(h<<6),127,"mt32").name;for(let C=0;C<b.length;C++)e.#D[(r-1)*y.cmt+C]=b.charCodeAt(C)}e.pushChPrimitives(r)}},()=>{e.#r[r*y.rpn+3]=c+40,e.#n[y.rpnt*r+2]=1},()=>{e.#r[r*y.rpn+1]=c+14,e.#n[y.rpnt*r+1]=1},()=>{e.#r[r*y.rpn]=c,e.#n[y.rpnt*r]=1},!1,()=>{e.setChCc(r,91,c?127:0)},!1,()=>{e.setChCc(r,7,c)},()=>{e.setChCc(r,10,Math.ceil(c*9.05))}][f]||(()=>{}))()})}).add([22,18,1],(t,s,o)=>{e.switchMode("mt32",1);let r=o&7;console.debug(`MT-32 slot #${o+1} Drum: ${t}`);let n=t[0]<<7|t[1];t.subarray(2).forEach((c,i)=>{let f=i+n,h=(f>>2)+24,b=f&3,C=r*y.dpn;if(x()&&console.debug(`MT-32 temp drum note ${h} param ${b}: ${c}`),h<24){console.warn(`MT-32 dev drum write attempted on an OOB note: ${h}`);return}[()=>{},()=>{e.#w[(C+N[26])*y.dnc+h]=Math.round(c*1.27)},()=>{e.#w[(C+N[26])*y.dnc+h]=c*9+1&127},()=>{e.#w[(C+N[26])*y.dnc+h]=c?127:0}][b]()})}).add([22,18,2],(t,s,o)=>{e.switchMode("mt32",1);let r=e.chRedir(o,s,!0),n=t[1]+(t[0]<<7);n<10&&(e.#T[r]=1),t.subarray(2).forEach((c,i)=>{let f=i+n;f<14&&(e.#D[(r-1)*y.cmt+f]=c)}),e.pushChPrimitives(r)}).add([22,18,3],(t,s,o)=>{e.switchMode("mt32",1);let r=o&7;if(t[0]){let n=(t[0]-1<<7)+t[1]-16;t.subarray(2).forEach((c,i)=>{let f=i+n,h=(f>>2)+24,b=f&3,C=r*y.dpn;if(x()&&console.debug(`MT-32 dev drum note ${h} param ${b}: ${c}`),h<24){console.warn(`MT-32 dev drum write attempted on an OOB note: ${h}`);return}[()=>{},()=>{e.#w[(C+N[26])*y.dnc+h]=Math.round(c*1.27)},()=>{e.#w[(C+N[26])*y.dnc+h]=c*9+1&127},()=>{e.#w[(C+N[26])*y.dnc+h]=c?127:0}][b]()})}else{let n=t[1];t.subarray(2).forEach((c,i)=>{let f=i+n;e.#G[f]=c;let h=e.chRedir(1+(f>>4),s,!0),b=f&15;([!1,()=>{let C=e.#G[h-1<<4];if(C<3)if(e.#T[h]=1,C===2)for(let v=0;v<name.length;v++)e.#D[(h-1)*y.cmt+v]=e.#B[c*y.cmt+v];else{let v=e.baseBank.get(0,c+(C<<6),127,"mt32").name;for(let T=0;T<v.length;T++)e.#D[(h-1)*y.cmt+T]=v.charCodeAt(T)}e.pushChPrimitives(h)},()=>{e.#r[h*y.rpn+3]=c+40,e.#n[y.rpnt*h+2]=1},()=>{e.#r[h*y.rpn+1]=c+14,e.#n[y.rpnt*h+1]=1},()=>{e.#r[h*y.rpn]=c,e.#n[y.rpnt*h]=1},!1,()=>{e.setChCc(h,91,c?127:0)},!1,()=>{e.setChCc(h,7,c)},()=>{e.setChCc(h,10,Math.ceil(c*9.05))}][b]||(()=>{}))()})}}).add([22,18,4],(t,s,o)=>{e.switchMode("mt32",1);let r=t[1]+(t[0]<<7),n=[];t.subarray(2).forEach((c,i)=>{let f=i+r,h=e.chRedir(Math.floor(f/246+1),s,!0),b=f%246;b<14&&(e.#D[(h-1)*y.cmt+b]=c),b<10&&(e.#T[h]=1),n.indexOf(h)<0&&n.push(h)}),n.forEach(c=>{e.pushChPrimitives(c)})}).add([22,18,5],(t,s,o)=>{e.switchMode("mt32",1);let r=(t[0]<<7)+t[1];t.subarray(2).forEach((n,c)=>{let i=r+c,f=Math.floor(i/8),h=i&7,b=f*8;e.#ce[i]=n,([!1,()=>{let C=e.#ce[b];if(C<3){let v="";if(C===2){let A=y.cmt*f;v=`MT-m:${n.toString().padStart(3,"0")}`}else v=e.baseBank.get(0,n+(C<<6),127,"mt32").name;e.userBank.clearRange({msb:0,lsb:127,prg:f});let T=`MSB	LSB	PRG	NME
49	127	${f}	${v}`;e.userBank.load(T,!0)}}][h]||(()=>{}))()}),e.forceVoiceRefresh()}).add([22,18,8],(t,s,o)=>{e.switchMode("mt32",1);let r=((t[0]&1)<<7)+t[1],n=t[0]>>1,c=!1;if(t.subarray(2).forEach((i,f)=>{let h=r+f;h<y.cmt&&(e.#B[n*y.cmt+h]=i,c=!0)}),c){e.userBank.clearRange({msb:0,lsb:127,prg:n});let i=`MSB	LSB	PRG	NME
49	127	${n}	MT-m:${n}`;e.userBank.load(i,!0)}e.forceVoiceRefresh()}).add([22,18,16],(t,s,o)=>{e.switchMode("mt32",1);let r=t[1],n=!1,c=function(i,f){e.#c[f-12]=i,n=!0};t.subarray(2).forEach((i,f)=>{let h=f+r;([!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,c,c,c,c,c,c,c,c,c,()=>{e.#h=i,e.dispatchEvent("mastervolume",e.#h)}][h]||(()=>{}))(i,f)}),n&&e.buildRchTree()}).add([22,18,32],(t,s,o)=>{e.switchMode("mt32",1);let r=t[1],n=" ".repeat(r);t.subarray(2).forEach(c=>{c>31?n+=String.fromCharCode(c):n+=" "}),e.#X=n.padStart(20," "),e.#K=e.clockSource.now()+3200}).add([22,18,82],(t,s)=>{let o=e.chRedir(0,s,!0);for(let r=0;r<16;r++)e.#C.ano(o+r),r&&r<10&&(e.#i[o+r]=ue[r-1]);console.info("MT-32 alt reset complete.")}),this.#L.add([66,0],(t,s)=>{e.switchMode("ns5r",1),e.setPortMode(e.getTrackPort(s),2,g.ns5r),e.#l=e.KARAOKE_NONE,console.debug(`NS5R mode switch requested: ${["global","multi","prog edit","comb edit","drum edit","effect edit"][t[0]]} mode.`)}).add([66,1],(t,s)=>{let o=["ns5r","05rw"][t[0]];e.switchMode(o,1),e.setPortMode(e.getTrackPort(s),2,g[o]),e.#l=e.KARAOKE_NONE}).add([66,18,0,0],(t,s)=>{let o=t[0];switch(o){case 124:case 126:case 127:{e.switchMode("ns5r",2),e.setPortMode(e.getTrackPort(s),2,g.ns5r),e.#l=e.KARAOKE_NONE;break}case 125:{e.initDrums(),console.info(`NS5R drum setup reset on drum kit ${t[1]}.`);break}default:if(o<10){let r=[0,0,0,0],n=(c,i)=>{r[i]=c};if(t.subarray(1).forEach((c,i)=>{[n,n,n,n,()=>{e.#h=c*129/16383*100,e.dispatchEvent("mastervolume",e.#h)},()=>c-64,()=>c-64,()=>{},()=>{},()=>{}][o+i]()}),t[0]<4){let c=0;r.forEach(i=>{c=c<<4,c+=i}),c-=1024,console.debug(`Master tune: ${c}`)}}}}).add([66,18,0,1],(t,s)=>{}).add([66,18,0,2],(t,s)=>{}).add([66,18,1],(t,s)=>{e.invokeSysExIndicator();let o=e.chRedir(t[0],s,!0),r=P[o],n=t[1],c=`NS5R CH${o+1} `;t.subarray(2).forEach((i,f)=>{let h=n+f;h<3?([()=>{e.#e[r+m[0]]=i||Z.bank0,e.pushChPrimitives(o)},()=>{e.#e[r+m[32]]=i,e.pushChPrimitives(o)},()=>{e.#i[o]=i}][h](),e.pushChPrimitives(o)):h<8||(h<14?[()=>{let b=e.chRedir(i,s,!0),C=e.#c[o];e.#c[o]=b,(o!==b||b!==C)&&(e.buildRchTree(),console.info(`${c}receives from CH${b+1}`))},()=>{e.#m[o]=+!i},()=>{e.setChType(o,i,g.ns5r),console.debug(`${c}type: ${q[i]}`)},()=>{e.#r[y.rpn*o+3]=i,e.#n[y.rpnt*o+2]=1,e.dispatchEvent("pitch",{part:o,pitch:e.getPitchShift(o)})},()=>{},()=>{}][h-8]():h<16||(h<33?[()=>{e.#e[r+m[7]]=i},()=>{e.#e[r+m[11]]=i},()=>{},()=>{},()=>{e.#e[r+m[10]]=i||128},()=>{},()=>{},()=>{e.#e[r+m[93]]=i},()=>{e.#e[r+m[91]]=i},()=>{e.#e[r+m[76]]=i},()=>{e.#e[r+m[77]]=i},()=>{e.#e[r+m[78]]=i},()=>{e.#e[r+m[74]]=i},()=>{e.#e[r+m[71]]=i},()=>{e.#e[r+m[73]]=i},()=>{e.#e[r+m[75]]=i},()=>{e.#e[r+m[72]]=i}][h-16]():h<112||h<114&&[()=>{e.#e[r+m[5]]=i},()=>{e.#e[r+m[65]]=i}][h-112]()))})}).add([66,18,8,0],(t,s)=>{let o=t[0];if(o<32)e.setLetterDisplay(t.subarray(1,33),"NS5R letter display");else{let r=o-32;e.#R=e.clockSource.now()+3200,e.#f=10;let n=t.subarray(1),c=4;n.forEach(function(i,f){let h=f+r,b=h>>4,C=h&15;if(h<80){let v=b<c?i:i>>3,T=0,A=b<c?6:3;for(;v>0;)e.#H[C*32+b*7+(A-T)]=v&1,v=v>>1,T++}})}}).add([66,18,48],(t,s,o)=>{u(0,t)}).add([66,18,49],(t,s,o)=>{u(1,t)}).add([66,18,50],(t,s,o)=>{u(2,t)}).add([66,18,51],(t,s,o)=>{u(3,t)}).add([66,18,52],(t,s,o)=>{u(4,t)}).add([66,18,53],(t,s,o)=>{u(5,t)}).add([66,18,54],(t,s,o)=>{u(6,t)}).add([66,18,55],(t,s,o)=>{u(7,t)}).add([66,52],(t,s)=>{e.switchMode("ns5r",1),e.#l=e.KARAOKE_NONE;let o="";I(t,(r,n)=>{n<8?(r>31&&(o+=String.fromCharCode(r)),n===7&&(e.aiEfxName=o)):n<10&&(e.setEffectType(n-8,44,r),e.pushEffectType(n-8))})}).add([66,53],(t,s)=>{e.invokeSysExIndicator(),e.switchMode("ns5r",1),e.#l=e.KARAOKE_NONE;let o="",r=t[t.length-1],n=t.subarray(0,t.length-1),c=B(n);c!==r&&(console.info(`NS5R current multi dump checksum mismatch! Expected ${c}, got ${r}.`),console.debug(t));let i=e.getTrackPort(s);if(e.#d[i]&&e.#d[i]!==g.ns5r)if(e.#U.dumpLimit===e.DUMP_MODE){console.warn(`Dump cancelled for track ${s}. Port ${String.fromCharCode(65+i)} mode "${R[e.#d[i]]}" mismatch, should be "ns5r".`);return}else console.info(`Track ${s} is trying to perform a mismached mode dump on port ${String.fromCharCode(65+i)}.`);e.setPortMode(i,2,g.ns5r),I(n,function(f,h){switch(!0){case h<2944:{let b=e.chRedir(Math.floor(h/92),s,!0),C=P[b];switch(h%92){case 0:{e.#e[C+m[0]]=f,e.pushChPrimitives(b),e.pushChPrimitives(b);break}case 1:{e.#e[C+m[32]]=f,!f&&!e.#e[C+m[0]]&&(e.#e[C+m[0]]=Z.bank0),e.pushChPrimitives(b);break}case 2:{e.#i[b]=f,f>0&&e.setChActive(b,1);break}case 3:{let v=e.chRedir(f,s,!0);e.#c[b]=v,b!==v&&console.info(`NS5R CH${b+1} receives from CH${v+1}.`);break}case 7:{e.#a[b]=f,e.pushChPrimitives(b);break}case 8:{e.#r[b*y.rpn+3]=f<40||f>88?f+(f>63?-192:64):f,e.#n[y.rpnt*b+2]=1,e.dispatchEvent("pitch",{part:b,pitch:e.getPitchShift(b)});break}case 9:case 10:{e.#e[C+m[7]]=f;break}case 11:{e.#e[C+m[11]]=f;break}case 14:{e.#e[C+m[10]]=f||128;break}case 19:{e.#e[C+m[93]]=f;break}case 20:{e.#e[C+m[91]]=f;break}case 84:{e.#e[C+m[65]]=f;break}case 85:{e.#e[C+m[5]]=f;break}}break}case h<3096:break;case h<3134:{let b=h-3096;b<8?(f>31&&(o+=String.fromCharCode(f)),b===7&&(e.aiEfxName=o)):b<10&&(e.setEffectType(b-8,44,f),e.pushEffectType(b-8));break}case h<8566:break}}),e.buildRchTree()}).add([66,54],(t,s)=>{e.invokeSysExIndicator(),e.switchMode("ns5r",1);let o="",r=80,n=0,c=0,i="MSB	PRG	LSB	NME";I(t,function(f,h){let b=h%158;switch(!0){case b<10:{f>31&&(o+=String.fromCharCode(f));break}case b===10:break;case b===11:{r=f&127;break}case b===12:{c=f&127;break}case b===13:{i+=`
${r}	${n}	${c}	${o.trim().replace("Init Voice","")}`,n++,o="";break}}}),e.userBank.clearRange({msb:80,lsb:0}),e.userBank.load(i),x()&&console.debug(i),e.forceVoiceRefresh()}).add([66,55],(t,s)=>{e.invokeSysExIndicator(),e.switchMode("ns5r",1);let o="",r=88,n=0,c=0,i="MSB	PRG	LSB	NME";I(t,function(f,h){let b=h%126;switch(!0){case b<10:{f>31&&(o+=String.fromCharCode(f));break}case b===11:break;case b===12:break;case b===13:{i+=`
${r}	${n}	${c}	${o.trim().replace("Init Combi","")}`,n++,o="";break}}}),e.userBank.clearRange({msb:88,lsb:0}),e.userBank.load(i),x()&&console.debug(i),e.forceVoiceRefresh()}).add([66,125],(t,s,o)=>{e.dispatchEvent("backlight",["green","orange","red",!1,"yellow","blue","purple"][t[0]]||"white")}).add([66,127],(t,s,o)=>{let r=t[t.length-1],n=t.subarray(0,t.length-1),c=B(n);c!==r&&(console.info(`NS5R screen dump checksum mismatch! Expected ${c}, got ${r}.`),console.debug(t));let i=new Uint8Array(5760);I(t,(f,h,b)=>{if(h<720)for(let C=0;C<8;C++)i[h*8+C]=f>>7-C&1}),e.dispatchEvent("screen",{type:"ns5r",data:i})}).add([76],(t,s,o)=>{e.#L.run([66,...t],s,o)}),e.#te.add([16,0,8,0],(t,s,o)=>{let r=(t[2]<<4)+t[3],n="K11 ";([()=>{e.switchMode("k11",2),e.setPortMode(e.getTrackPort(s),2,g.k11),e.#l=e.KARAOKE_NONE,e.#b[g.k11][1]=r?4:0,console.info("MIDI reset: GMega/K11")},()=>{e.setEffectType(0,24,r),console.debug(`${n}reverb type: ${r}`),e.pushEffectType(0)},()=>{console.debug(`${n}reverb time: ${r}`)},()=>{console.debug(`${n}reverb time: ${r}`)},()=>{console.debug(`${n}reverb predelay: ${r}`)},()=>{console.debug(`${n}reverb predelay: ${r}`)},()=>{console.debug(`${n}depth high: ${r}`)},()=>{console.debug(`${n}depth high: ${r}`)},()=>{console.debug(`${n}depth low: ${r}`)},()=>{console.debug(`${n}depth low: ${r}`)}][t[0]]||(()=>{}))()}).add([16,0,8,1],(t,s,o)=>{e.invokeSysExIndicator();let r=e.chRedir(t[1],s,!0),n=P[r],c=V[r],i=(t[3]<<4)+t[4],f=`GMega CH${r+1} `;([()=>{i<128?(e.setChType(r,e.CH_MELODIC,g.k11),e.#e[n+m[0]]=0,e.#i[r]=i):(e.setChType(r,e.CH_DRUMS,g.k11),e.#i[r]=i-128),e.pushChPrimitives(r)},()=>{let h=e.chRedir(i,s,!0),b=e.#c[r];e.#c[r]=h,(r!==h||h!==b)&&(e.buildRchTree(),console.info(`${f}receives from CH${h+1}`))},()=>{e.#e[n+m[7]]=i},()=>{uupThis.setChActive(r,i)},()=>{e.#e[n+m[10]]=i},()=>{e.#r[c+3]=i+40,e.#n[y.rpnt*r+2]=1,e.dispatchEvent("pitch",{part:r,pitch:e.getPitchShift(r)})},()=>{e.#r[c+1]=i>>1,e.#r[c+2]=i&1,e.#n[y.rpnt*r+1]=1,e.dispatchEvent("pitch",{part:r,pitch:e.getPitchShift(r)})},()=>{e.#e[n+m[91]]=i?127:0},()=>{},()=>{e.#e[n+m[74]]=i},()=>{e.#e[n+m[73]]=i},()=>{e.#e[n+m[72]]=i}][t[0]]||(()=>{}))()}).add([16,0,9,0],(t,s,o)=>{e.invokeSysExIndicator();let r=(t[2]<<4)+t[3],n="GMLX ";([()=>{console.debug(`${n}reverb type: ${r}`)},()=>{console.debug(`${n}reverb time: ${r}`)},()=>{console.debug(`${n}reverb predelay: ${r}`)},()=>{console.debug(`${n}depth high: ${r}`)},()=>{console.debug(`${n}depth low: ${r}`)}][t[0]]||(()=>{}))()}).add([16,0,9,3],(t,s,o)=>{e.invokeSysExIndicator();let r=(t[2]<<4)+t[3],n=e.chRedir(t[1],s,!0),c=P[n],i=`GMLX CH${n+1} `;[()=>{r<128?(e.setChType(n,e.CH_MELODIC,g.k11),e.#e[c+m[0]]=0,e.#e[c+m[32]]=0,e.#i[n]=r):r<160?(e.setChType(n,e.CH_MELODIC,g.k11),e.#e[c+m[0]]=0,e.#e[c+m[32]]=7,e.#i[n]=r-100):(e.setChType(n,e.CH_DRUMS,g.k11),e.#e[c+m[0]]=122,e.#e[c+m[32]]=0,e.#i[n]=r-160),e.pushChPrimitives(n)},()=>{let f=e.chRedir(r,s,!0),h=e.#c[n];e.#c[n]=f,(n!==f||f!==h)&&(e.buildRchTree(),console.info(`${i}receives from CH${f+1}`))}][t[0]]()}).add([16,0,9,4],(t,s,o)=>{e.invokeSysExIndicator();let r=(t[2]<<4)+t[3],n=e.chRedir(t[1],s,!0),c=P[n],i=V[n];[()=>{e.setChActive(n,r)},()=>{e.#e[c+m[7]]=r},()=>{e.#e[c+m[10]]=r},()=>{e.#e[c+m[91]]=r?127:0},()=>{e.#r[i+3]=r+40,e.#n[y.rpnt*n+2]=1,e.dispatchEvent("pitch",{part:n,pitch:e.getPitchShift(n)})},()=>{e.#r[i+1]=r,e.#n[y.rpnt*n+1]=1,e.dispatchEvent("pitch",{part:n,pitch:e.getPitchShift(n)})},()=>{e.#r[i]=r,e.#n[y.rpnt*n]=1,e.dispatchEvent("pitch",{part:n,pitch:e.getPitchShift(n)})},()=>{}][t[0]]()}),this.#ae.add([66,93,64],(t,s,o)=>{let r=t[2];switch(t[0]){case 0:{switch(t[1]){case 4:{e.invokeSysExIndicator(),e.#h=r*129/16383*100,e.dispatchEvent("mastervolume",e.#h);break}case 5:{e.invokeSysExIndicator(),r-64;break}case 6:{e.invokeSysExIndicator(),console.debug(`SG global reverb: ${r?"on":"off"}`);break}case 127:{e.switchMode("sg",2),e.setPortMode(e.getTrackPort(s),1,g.sg);break}}break}case 1:{switch(t[1]){case 48:{e.invokeSysExIndicator(),console.debug(`SG reverb type: ${fe[r]}`);break}}break}default:if(t[0]>>4===1){e.invokeSysExIndicator();let n=e.chRedir(t[0]&15,s,!0);if(t[1]===2){let c=e.chRedir(r,s,!0),i=e.#c[n];e.#c[n]=c,(n!==c||c!==i)&&(e.buildRchTree(),console.info(`SG CH${n+1} receives from CH${c+1}`))}else t[1]===19&&e.setChCc(n,7,r)}else console.warn(`Unknown AKAI SG SysEx: ${t}`)}}),this.#re.add([9],(t,s,o)=>{e.invokeSysExIndicator(),console.debug(`GZ set effect: ${["stage reverb","hall reverb","room reverb","chorus","tremolo","phaser","rotary speaker","enhancer","flanger","EQ"][t[0]]||"off"}`)}),this.#E.add([127,0],(t,s,o)=>{e.switchMode("motif",1);let r=new Uint8Array([127,1,...t]);e.#E.run(r,s,o)}).add([127,1,0,0],(t,s,o)=>{e.switchMode("s90es");let r="S90/Motif ES system ",n=t[0];t.subarray(1).forEach((c,i)=>{([()=>{e.#h=c*12900/16383,e.dispatchEvent("mastervolume",e.#h)}][n+i]||(()=>{console.info(`Unrecognized ${r}ID: ${n+i}`)}))()})}).add([127,1,14],(t,s,o)=>{e.switchMode("s90es");let r="S90/Motif ES bulk header ",n=[];n[95]=(c,i,f)=>{console.debug(`${r}multi edit buffer: ${c[1]}`)},(n[t[0]]||(()=>{console.info(`Unrecognized ${r}ID: ${t[0]}.`)}))(t.subarray(1))}).add([127,1,15],(t,s,o)=>{e.switchMode("s90es");let r="S90/Motif ES bulk footer ",n=[];n[95]=(c,i,f)=>{console.debug(`${r}multi edit buffer: ${c[1]}`)},(n[t[0]]||(()=>{console.info(`Unrecognized ${r}ID: ${t[0]}.`)}))(t.subarray(1))}).add([127,1,54,1],(t,s,o)=>{e.switchMode("s90es");let r="S90/Motif ES reverb ",n=t[0];t.subarray(1).forEach((c,i)=>{([()=>{e.setEffectTypeRaw(0,!1,c&15|128)},()=>{e.setEffectTypeRaw(0,!0,c)}][n+i]||(()=>{}))()}),e.pushEffectType(0)}).add([127,1,54,2],(t,s,o)=>{e.switchMode("s90es");let r="S90/Motif ES chorus ",n=t[0];t.subarray(1).forEach((c,i)=>{([()=>{e.setEffectTypeRaw(1,!1,c&15|128)},()=>{e.setEffectTypeRaw(1,!0,c)}][n+i]||(()=>{}))()}),e.pushEffectType(1)}).add([127,1,54,3],(t,s,o)=>{e.switchMode("s90es");let r="S90/Motif ES insert 1 ",n=t[0];t.subarray(1).forEach((c,i)=>{([()=>{e.setEffectTypeRaw(3,!1,c&15|128)},()=>{e.setEffectTypeRaw(3,!0,c)}][n+i]||(()=>{}))()}),e.pushEffectType(3)}).add([127,1,54,4],(t,s,o)=>{e.switchMode("s90es");let r="S90/Motif ES insert 2 ",n=t[0];t.subarray(1).forEach((c,i)=>{([()=>{e.setEffectTypeRaw(4,!1,c&15|128)},()=>{e.setEffectTypeRaw(4,!0,c)}][n+i]||(()=>{}))()}),e.pushEffectType(4)}).add([127,1,54,16],(t,s,o)=>{e.switchMode("s90es");let r=t[0];t.subarray(1).forEach((n,c)=>{let f=`S90/Motif ES EQ${(c>>2)+1} `;([()=>{let h=n-64},()=>{let h=K[n]},()=>{let h=n/10},()=>{let h=n}][r+c&3]||(()=>{}))()})}).add([127,1,54,17],(t,s,o)=>{e.switchMode("s90es");let r="S90/Motif ES variation ",n=t[0];t.subarray(1).forEach((c,i)=>{([()=>{e.setEffectTypeRaw(2,!1,c&15|128)},()=>{e.setEffectTypeRaw(2,!0,c)}][n+i]||(()=>{}))()}),e.pushEffectType(2)}).add([127,1,55],(t,s,o)=>{e.invokeSysExIndicator(),e.switchMode("s90es");let r=e.getTrackPort(s);if(e.#d[r]&&e.#d[r]!==e.#s.smotif)if(e.#U.dumpLimit===e.DUMP_MODE){console.warn(`Dump cancelled for track ${s}. Port ${String.fromCharCode(65+r)} mode "${R[e.#d[r]]}" mismatch, should be "${R[e.#s.smotif]}".`);return}else console.info(`Track ${s} is trying to perform a mismached mode dump on port ${String.fromCharCode(65+r)}.`);let n=e.chRedir(t[0],s,!0),c=P[n],i=t[1];t[0]>15&&(n=t[0]+32);let f=`Track ${s} S90/Motif ES bulk CH${n<128?n+1:"U"+(n-127)} `;console.debug(f,t),!(t[0]>15)&&t.subarray(2).forEach((h,b)=>{([()=>{e.setChCc(n,0,h),e.pushChPrimitives(n)},()=>{h&&e.setChActive(n,1),e.setChCc(n,32,h),e.getChPrimitive(n,1)===63&&e.setChType(n,[32,40].indexOf(h)>-1?e.CH_DRUMS:e.CH_MELODIC,e.#t,!0),e.pushChPrimitives(n)},()=>{h&&e.setChActive(n,1),e.#i[n]=h,e.pushChPrimitives(n)},()=>{let C=e.chRedir(h,s,!0),v=e.#c[n];e.#c[n]=C,(n!==C||C!==v)&&(e.buildRchTree(),console.info(`${f}receives from CH${C+1}`))},()=>{e.#m[n]=h?0:1},!1,!1,!1,!1,!1,!1,!1,!1,()=>{h!==100&&e.setChActive(n,1),e.#e[c+m[7]]=h},()=>{h!==64&&e.setChActive(n,1),e.#e[c+m[10]]=h},!1,!1,!1,()=>{e.#e[c+m[91]]=h},()=>{h&&e.setChActive(n,1),e.#e[c+m[93]]=h},()=>{h&&e.setChActive(n,1),e.#e[c+m[94]]=h},()=>{e.setChCc(n,128,h),h!==127&&(e.setChActive(n,1),e.allocateAce(n,128))},()=>{},()=>{h!==64&&e.setChActive(n,1),e.#e[c+m[74]]=h},()=>{h!==64&&e.setChActive(n,1),e.#e[c+m[71]]=h},!1,()=>{e.#e[c+m[65]]=h},()=>{e.#e[c+m[5]]=h},()=>{}][i+b]||(()=>{}))()})}),e.#E.add([100,14],(t,s,o)=>{e.switchMode("cs6x"),e.setPortMode(e.getTrackPort(s),1,g.cs6x);let r=["normal voice","plugin voice PLG","drums",,"performance",,"phrase clip"][t[0]>>4]??"invalid";t[0]&!0?r+=" edit buffer":t[0]>>4==1?r+=`${(t[0]&1)+1}`:r+=` ${["INT","EXT"][t[0]&1]}`,console.debug(`CS6x bulk dump for ${r} started.`)}).add([100,15],(t,s,o)=>{e.switchMode("cs6x");let r=["normal voice","plugin voice PLG","drums",,"performance",,"phrase clip"][t[0]>>4]??"invalid";t[0]&!0?r+=" edit buffer":t[0]>>4==1?r+=`${(t[0]&1)+1}`:r+=` ${["INT","EXT"][t[0]&1]}`,console.debug(`CS6x bulk dump for ${r} ended.`)}).add([100,76,112],(t,s,o)=>{e.switchMode("cs6x");let r=0,n=t[0];t.subarray(1).forEach((c,i)=>{let f=i+n;f<10?(e.setChCvnRegister(r,i,c&127),e.#T[r]=1):f<12||f<13&&console.debug(`Plugin voice type: ${c}`)}),e.pushChPrimitives(r)}).add([100,76,0],(t,s,o)=>{e.switchMode("cs6x"),e.setPortMode(e.getTrackPort(s),1,g.cs6x);let r=0,n=t[0];t.subarray(1).forEach((c,i)=>{let f=i+n;([()=>{e.setChCc(r,7,c),c!==100&&e.setChActive(r,1)},,,()=>{e.#m[r]=c==0,e.setChCc(r,64,0),e.#C.ano(r),e.resetChAceAll(r)},,()=>{},,,()=>{e.setChCc(r,65,c?127:0)},()=>{e.setChCc(r,5,c)},,()=>{e.setChCc(r,91,c),c!==40&&e.setChActive(r,1)},()=>{e.setChCc(r,93,c),c&&e.setChActive(r,1)}][f]||(()=>{}))()})}).add([100,76,1],(t,s,o)=>{e.switchMode("cs6x");let r=0,n=t[0],c=!1;t.subarray(1).forEach((i,f)=>{let h=f+n;([()=>{e.setEffectTypeRaw(0,!1,i&15|128),c=!0},()=>{e.setEffectTypeRaw(0,!0,i),c=!0}][h]||(()=>{}))()}),c&&e.pushEffectType(0)}).add([100,76,2],(t,s,o)=>{e.switchMode("cs6x");let r=0,n=t[0],c=!1;t.subarray(1).forEach((i,f)=>{let h=f+n;([()=>{e.setEffectTypeRaw(1,!1,i&15|128),c=!0},()=>{e.setEffectTypeRaw(1,!0,i),c=!0}][h]||(()=>{}))()}),c&&e.pushEffectType(1)}).add([100,76,3],(t,s,o)=>{e.switchMode("cs6x");let r=0,n=t[0],c=!1;t.subarray(1).forEach((i,f)=>{let h=f+n;([()=>{e.setEffectTypeRaw(2,!1,i&15|128),c=!0},()=>{e.setEffectTypeRaw(2,!0,i),c=!0}][h]||(()=>{}))()}),c&&e.pushEffectType(2)}).add([100,76,5],(t,s,o)=>{e.switchMode("cs6x")}).add([100,76,16],(t,s,o)=>{e.switchMode("cs6x");let r=0,n=t[0],c=!1;if(t.subarray(1).forEach((i,f)=>{let h=f+n;([()=>{e.setChCc(r,0,i),c=!0},()=>{e.setChCc(r,32,i),c=!0,i&&e.setChActive(r,1)},()=>{e.#i[r]=i,c=!0,i&&e.setChActive(r,1)},()=>{e.#n[V[r]+ie[2]]=1,e.#r[V[r]+ie[2]]=i,i&&e.setChActive(r,1)}][h]||(()=>{}))()}),c){switch(e.pushChPrimitives(r),e.getChVoice(r).standard){case"DX":{e.#k[r]=e.EXT_DX;break}case"VL":{e.#k[r]=e.EXT_VL;break}}e.dispatchEvent("metacommit",{type:"OSysMeta",msg:"part.rename",data:{part:r}})}}).add([100,76,32],(t,s,o)=>{e.switchMode("cs6x");let r=0,n=t[0],c=e.#k[r];switch(c){case e.EXT_DX:{t.length>2&&console.debug(t),t.subarray(1).forEach((i,f)=>{let h=f+n;if(h<6){let b=h+142;e.setChCc(r,b,i),i!==64&&e.allocateAce(r,b)}else if(h<12){let b=h+144;e.setChCc(r,b,i),i!==64&&e.allocateAce(r,b)}else([()=>{},()=>{},()=>{},()=>{}][h]||(()=>{}))()});break}case e.EXT_VL:{console.info(`Support for Modular System Plug-in writes is not yet present for plugin type ${c}.`);break}default:console.warn(`Unsupported plug-in type: ${c}`)}}),this.#P.add([0,72,18,0,0,0,0],(t,s,o)=>{e.switchMode("sd",2),e.setPortMode(e.getTrackPort(s),2,g.sd),console.info("MIDI reset: SD")}).add([0,72,18,16,0],(t,s,o)=>{e.invokeSysExIndicator();let r=t[0]>>5,n=t[0]&31;switch(r){case 0:{let c=t[0]>>1,i=t[1];switch(c){case 1:{t.subarray(2).forEach((f,h,b)=>{let C=h+i;switch(C){case 0:{f&&(e.setEffectType(1,60,f-1),e.pushEffectType(1),console.debug(`SD MFX Cho: ${C} - ${f}`));break}}});break}case 2:{t.subarray(2).forEach((f,h)=>{let b=h+i;switch(b){case 0:{f&&(e.setEffectType(0,55+f,0),e.pushEffectType(0),console.debug(`SD MFX Rev: ${b} - ${f}`));break}}});break}case 3:case 4:case 5:{let f=c-1;t.subarray(2).forEach((h,b)=>{let C=b+i;switch(console.debug(`SD MFX ${f-2}: ${C} - ${h}`),C){case 0:{e.setEffectTypeRaw(f,62,h),e.pushEffectType(f);break}}}),console.debug(`SD MFX message:
%o`,t);break}default:console.debug(`Unknown SD-90 global effects message:
%o`,t)}break}case 1:{let c=e.chRedir(n,s,!0),i=t[1],f=P[c];t.subarray(2).forEach((h,b)=>{let C=i+b;C<37?([()=>{},()=>{},0,()=>{},()=>{switch(h){case 104:case 105:case 106:case 107:case 120:case 128:{e.#a[c]||e.setChType(c,e.CH_DRUMS);break}default:e.#a[c]&&e.setChType(c,e.CH_MELODIC)}e.setChCc(c,0,h),e.pushChPrimitives(c)},()=>{e.setChCc(c,32,h),e.pushChPrimitives(c)},()=>{e.#i[c]=h},()=>{e.#e[f+m[7]]=h},()=>{e.#e[f+m[10]]=h},()=>{},()=>{},()=>{h<2&&(e.#m[c]=h)},()=>{h<2&&(e.#e[f+m[68]]=h?127:0)},()=>{},()=>{h<2&&(e.#e[f+m[65]]=h?127:0)},()=>{e.#e[f+m[5]]=h&15<<4|e.#e[f+m[5]]&15},()=>{e.#e[f+m[5]]=h&15|(e.#e[f+m[5]]&240)>>4},()=>{e.#e[f+m[74]]=h},()=>{e.#e[f+m[71]]=h},()=>{e.#e[f+m[73]]=h},()=>{e.#e[f+m[72]]=h},0,0,0,0,0,0,0,()=>{e.#e[f+m[128]]=h,e.allocateAce(128)},()=>{e.#e[f+m[93]]=h},()=>{e.#e[f+m[91]]=h},0,0,()=>{e.#e[f+m[75]]=h},()=>{e.#e[f+m[76]]=h},()=>{e.#e[f+m[77]]=h},()=>{e.#e[f+m[78]]=h}][C]||(()=>{}))():C<63||(C<64?(e.#a[c]?(e.setChCc(c,0,104|h),e.pushChPrimitives(c)):(e.setChCc(c,0,96|h),e.pushChPrimitives(c)),e.pushChPrimitives(c)):console.debug(`Unknown SD-90 global CH${c+1} param setup message:
%o`,t))});break}case 2:{let c=e.chRedir(n,s,!0),i=t[1];console.debug(`Unknown SD-90 global CH${c+1} MIDI setup message:
%o`,t.subarray(2));break}default:console.warn(`Unknown SD-90 global part setup message:
%o`,t)}}),e.#L.add([0,1,73,78],(t,s,o)=>{e.switchMode("krs",1),e.setPortMode(e.getTrackPort(s),1,g.krs),console.debug("Might be KORG KROSS 2 mode reset... Not sure.")}).add([0,1,73,117,2,37],(t,s,o)=>{e.switchMode("krs",1);let r=e.getTrackPort(s);if(e.#d[r]&&e.#d[r]!==g.krs)if(e.#U.dumpLimit===e.DUMP_MODE){console.warn(`Dump cancelled. Port ${String.fromCharCode(65+r)} mode "${R[e.#d[r]]}" mismatch, should be "krs".`);return}else console.info(`Track ${s} is trying to perform a mismached mode dump on port ${String.fromCharCode(65+r)}.`);e.setPortMode(e.getTrackPort(s),1,g.krs);let n="KROSS 2 BMT1 ",c="";I(t,(i,f)=>{if(f<24)c+=String.fromCharCode(Math.max(32,i));else if(!(f<88)){if(f<468){let h=f-88,b=h*863>>16,C=h-b*76;([()=>{e.setEffectType(b+3,45,i),e.pushEffectType(b+3)},!1,()=>{console.debug(`${n}IFX${b+1} sends to ${i<=5&&i>0?`IFX${i}`:"direct out"}.`)}][C]||(()=>{}))()}else if(f<604){let h=f-468,b=h*964>>16,C=h-b*68;([()=>{e.setEffectType(1-b,45,i),e.dispatchEvent(["efxreverb","efxchorus"][1-b],{id:e.getEffectType(1-b)})},!1][C]||(()=>{}))()}else if(!(f<1276)){let h=f-1276,b=h*1490>>16,C=e.chRedir(b,s,!0),v=h-b*44;v<22?([()=>{i&&e.setChActive(C,1),e.#i[C]=i,e.pushChPrimitives(C)},()=>{i&&e.setChActive(C,1),i<10?(e.setChCc(C,0,63),e.setChCc(C,32,i)):i<20?(e.setChCc(C,0,121),e.setChCc(C,32,i-10)):i<24&&(e.setChCc(C,0,[120,0,56,62][i-20]),e.setChCc(C,32,0)),e.pushChPrimitives(C)},()=>{let T=e.chRedir(i&15,s,!0);e.#c[C]=T,T!==C&&console.info(`${n}CH${C+1} receives from CH${T+1}`);let A=i>>5&1;e.modelEx.kross.chToggle&&(e.setChActive(C,A),A||console.debug(`KORG KROSS 2 CH${C+1} is disabled.`))},!1,!1,()=>{e.setChCc(C,7,i)},!1,()=>{},()=>{},!1,!1,!1,!1,!1,()=>{e.setChCc(C,10,i||128)}][v]||(()=>{}))():v<36?([()=>{let T=i&7;i&8&&(T=1),T>1&&console.debug(`${n}CH${C+1} sends to ${T>1?`IFX${T-1}`:"direct out"} (${i.toString(16)}).`),e.setChEffectSink(C,i>1&&i<7?i+1:0)}][v-22]||(()=>{}))():([()=>{e.setChCc(C,74,(i+128&255)-64)},()=>{e.setChCc(C,71,(i+128&255)-64)},!1,!1,()=>{e.setChCc(C,73,(i+128&255)-64)},()=>{e.setChCc(C,75,(i+128&255)-64)},!1,()=>{e.setChCc(C,72,(i+128&255)-64)}][v-36]||(()=>{}))()}}}),c=c.trimEnd(),e.dispatchEvent("metacommit",{type:"EORTitle",data:c})});let w=function(t,s,o){let r=e.chRedir(t,s,!0);e.setChMode(r,g.an1x),e.pushChPrimitives(r),console.debug(`Yamaha AN1x slot ${o+1} receives from CH${r+1}(${t+1}).`),e.modelEx.yPlg[3][o]=r};e.#E.add([92,0,0],(t,s,o)=>{let r=t[0];t.subarray(1).forEach((n,c)=>{let i=c+r;i<2||([!1,!1,!1,!1,!1,!1,()=>{w(n,s,0)},()=>{w(n,s,1)}][i-2]||(()=>{}))()})}),e.#E.add([75,80,0],(t,s,o)=>{let r=t[0];t.subarray(1).forEach((n,c)=>{let i=c+r;([()=>{e.modelEx.cs1x.perfCh=n,e.pushChPrimitives(n),console.debug(`Yamaha CS1x performance on CH${n+1}.`)},!1,!1,!1,()=>{},!1,()=>{switch(n){case 1:{e.switchMode("xg",2),e.setPortMode(e.getTrackPort(s),1,g.xg),console.debug("Yamaha CS1x set to XG mode.");break}case 3:{e.switchMode("cs1x",2),e.setPortMode(e.getTrackPort(s),1,g.cs1x),console.debug("Yamaha CS1x set to performance mode.");break}default:console.warn(`Unknown Yamaha CS1x mode: ${n}`)}},()=>{}][i]||(()=>{}))()})}).add([75,96,0],(t,s,o)=>{let r=t[0],n=!1,c=e.modelEx.cs1x.perfCh;t.subarray(1).forEach((i,f)=>{let h=f+r;h<8?(n=!0,e.#T[c]=1,e.setChCvnRegister(c,h,i)):h<48?([!1,()=>{e.setChCc(c,7,i)}][h]||(()=>{}))():h<80?([()=>{e.setEffectTypeRaw(0,!1,i)},()=>{e.setEffectTypeRaw(0,!0,i),e.pushEffectType(0)},()=>{e.setEffectTypeRaw(1,!1,i)},()=>{e.setEffectTypeRaw(1,!0,i),e.pushEffectType(1)},()=>{e.setEffectTypeRaw(2,!1,i)},()=>{e.setEffectTypeRaw(2,!0,i),e.pushEffectType(2)}][h-48]||(()=>{}))():x()&&console.debug(`Unknown CS1x effect register: ${h}.`)}),n&&(e.setChActive(c,1),e.pushChPrimitives(c))});let S=(t,s,o)=>{let r=0;o.forEach((n,c)=>{([()=>{r=(n&1)<<7|r&127,e.setEffectTypeRaw(t,!1,28),e.setEffectTypeRaw(t,!0,r)},()=>{r=r&128|n&127,e.setEffectTypeRaw(t,!1,28),e.setEffectTypeRaw(t,!0,r),e.pushEffectType(t)}][c+s]||(()=>{}))()})};e.#L.add([96,0,1],(t,s,o)=>{let r=t[0];switch(t[1]){case 0:{S(0,t[2],t.subarray(3)),console.debug(`Partially parsed KORG PA EFX SysEX:
`,t);break}case 1:{S(1,t[2],t.subarray(3)),console.debug(`Partially parsed KORG PA EFX SysEX:
`,t);break}case 2:{S(2,t[2],t.subarray(3)),console.debug(`Partially parsed KORG PA EFX SysEX:
`,t);break}case 3:{S(3,t[2],t.subarray(3)),console.debug(`Partially parsed KORG PA EFX SysEX:
`,t);break}default:console.debug(`Unparsed KORG PA SysEX:
`,t)}})}};export{Wt as OctaviaDevice,ot as TimeMuxer,y as allocated,m as ccBufferOffset,N as dnToPos,Ne as effectSlots,x as getDebugState,Z as overrides};
