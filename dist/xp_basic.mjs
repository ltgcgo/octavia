"use strict";let $r=Object.create;let ba=Object.defineProperty;let xr=Object.getOwnPropertyDescriptor;let Sr=Object.getOwnPropertyNames;let Tr=Object.getPrototypeOf,Mr=Object.prototype.hasOwnProperty;let Pr=(g,u,e)=>u in g?ba(g,u,{enumerable:!0,configurable:!0,writable:!0,value:e}):g[u]=e;let Ua=(g,u)=>()=>(g&&(u=g(g=0)),u);let Ar=(g,u)=>()=>(u||g((u={exports:{}}).exports,u),u.exports);let Rr=(g,u,e,a)=>{if(u&&typeof u=="object"||typeof u=="function")for(let s of Sr(u))!Mr.call(g,s)&&s!==e&&ba(g,s,{get:()=>u[s],enumerable:!(a=xr(u,s))||a.enumerable});return g};let Ir=(g,u,e)=>(e=g!=null?$r(Tr(g)):{},Rr(u||!g||!g.__esModule?ba(e,"default",{value:g,enumerable:!0}):e,g));let A=(g,u,e)=>(Pr(g,typeof u!="symbol"?u+"":u,e),e),Oa=(g,u,e)=>{if(!u.has(g))throw TypeError("Cannot "+e)};let r=(g,u,e)=>(Oa(g,u,"read from private field"),e?e.call(g):u.get(g)),P=(g,u,e)=>{if(u.has(g))throw TypeError("Cannot add the same private member more than once");u instanceof WeakSet?u.add(g):u.set(g,e)},M=(g,u,e,a)=>(Oa(g,u,"write to private field"),a?a.call(g,e):u.set(g,e),e),na=(g,u,e,a)=>({set _(s){M(g,u,s,e)},get _(){return r(g,u,a)}});let _a=(g,u,e)=>(u=g[Symbol.asyncIterator],e=(a,s)=>(s=g[a])&&(u[a]=l=>new Promise((f,b,y)=>(l=s.call(g,l),y=l.done,Promise.resolve(l.value).then(w=>f({value:w,done:y}),b)))),u?u.call(g):(g=g[Symbol.iterator](),u={},e("next"),e("return"),u));let Na=Ua(()=>{"use strict";O();(function(){let g=function(b,y,w){let $,C;if(self.MessageEvent)switch(b){case"message":{C=new MessageEvent(b,{data:y,ports:w==null?void 0:w.ports}),Object.defineProperty(C,"source",{value:w==null?void 0:w.source});break}default:C=new Event(b)}else C=document.createEvent("Event"),C.initEvent(b,!1,!1),w&&b=="message"&&(C.data=y,w.source&&Object.defineProperty(C,"source",{value:w.source}),($=w.ports)!=null&&$.length&&Object.defineProperty(C,"ports",{value:w.ports}));return C};self.BroadcastChannel?console.info("[Snowy] Snowy is disabled."):(console.info("[Snowy] Snowy is enabled. Path: ".concat(self.SNOWY_PATH||"/snowy.js")),e=[],a={},s=function(b){let y,w=this;if((this==null?void 0:this.constructor)!=s)throw new TypeError("Illegal constructor");e.push(this),(y=a[b])!=null&&y.constructor||(a[b]=[]),a[b].push(this);let $=Math.floor(Math.random()*281474976710656),C=[],t=0,n=[],h=!0,i=!1;Object.defineProperty(this,"id",{get:function(){return $}}),Object.defineProperty(this,"name",{value:b}),this.close=function(){let c,d=e.indexOf(w);d>-1?(u.postMessage({t:"d",c:b,i:$}),e.splice(d,1),(c=a[b])!=null&&c.constructor&&(d=a[b].indexOf(w),d>-1&&a[b].splice(d,1)),a[b].length||delete a[b],console.debug("[Snowy] BroadcastChannel closed."),i=!0):console.debug("[Snowy] BroadcastChannel already closed.")},this.postMessage=function(c){if(u){if(i)throw new Error("Channel already closed");u.postMessage({t:"m",c:b,i:$,m:t,d:c}),t++,t>4294967295&&(t=0)}else n.push(c),console.debug("[Snowy] Message is cached.")},this.flush=function(){if(u){if(h){for(u.postMessage({t:"r",c:b,i:$}),console.debug("[Snowy] ".concat(n.length," message(s) in cache."));n.length;){let c=n.shift();w.postMessage(c)}h=!1,console.debug("[Snowy] All cached messages are flushed away.")}}else throw new Error("Tried to flush when the ports are not ready")},this.receiveMessage=function(c){c.c==b?c.i!=$&&w.dispatchEvent(g("message",c.d,{source:w})):console.debug("[Snowy] Channel ID mismatch. Instance ".concat($," receives from ").concat(b,", not ").concat(c.c,"."))};let o={};this.dispatchEvent=function(c){let d,m;if(Object.defineProperty(c,"target",{value:w}),Object.defineProperty(c,"currentTarget",{value:w}),(d=o[c.type])!=null&&d.length)for(let p=o[c.type],k=0;k<p.length;k++)((m=p[k])==null?void 0:m.constructor)==Function&&p[k].call(w,c);w["on".concat(c.type)]&&w["on".concat(c.type)].constructor==Function&&w["on".concat(c.type)].call(w,c)},this.addEventListener=function(c,d){let m;(m=o[c])!=null&&m.constructor||(o[c]=[]);let p=o[c].indexOf(d);p==-1&&o[c].push(d)},this.removeEventListener=function(c,d){let m,p;if((m=o[c])!=null&&m.length){let k=o[c].indexOf(d);k>-1&&o[c].splice(k,1)}!((p=o[c])!=null&&p.length)&&o[c].constructor&&delete o[c]}},self.BroadcastChannel=s,l=function(){if(u){u.addEventListener("message",function(y){let w=y.data,$=!1;switch(w.t){case"k":{$=!1,u.postMessage({t:"k"});break}case"m":{let C=a[w.c];if(C!=null&&C.length)for(let t=0;t<C.length;t++)C[t].receiveMessage(w);break}case"c":{for(let n=[],h=0;h<e.length;h++){let i=e[h].name;n.indexOf(i)<0&&n.push(i)}u.postMessage({t:"k",c:n});break}default:$=!0}$&&console.info("ReceiveBroadcast",w)});for(let b=0;b<e.length;b++)e[b].flush()}else throw new Error("Message port isn't yet ready");console.info("[Snowy] Snowy is active.")},f=function(){if(!u){let b=new SharedWorker(self.SNOWY_PATH||"/snowy.js");b.port.start();let y=function(w){w.data.t=="swc"&&(b.port.removeEventListener("message",y),u=b.port,u.postMessage({t:"k"}),l())};b.port.addEventListener("message",y)}},f());let u,e,a,s,l,f})()});let O=Ua(()=>{"use strict";Na();{let g=function(u,e){let a=new FileReader;return new Promise((s,l)=>{switch(a.addEventListener("abort",()=>{l(new Error("Blob read aborted"))}),a.addEventListener("error",f=>{l(a.error||f.data||new Error("Blob read error"))}),a.addEventListener("load",()=>{s(a.result)}),e.toLowerCase()){case"arraybuffer":case"buffer":{a.readAsArrayBuffer(u);break}case"string":case"text":{a.readAsText(u);break}default:l(new Error(`Unknown target ${e}`))}})};Blob.prototype.arrayBuffer=Blob.prototype.arrayBuffer||function(){return g(this,"buffer")},Blob.prototype.text=Blob.prototype.text||function(){return g(this,"text")}}String.prototype.replaceAll=String.prototype.replaceAll||function(g,u){let e=0,a=16,s=this,l=[];for(;e<a&&s.lastIndexOf(g)>-1;){let f=s.lastIndexOf(g);l.unshift(s.slice(f+g.length)),s=s.slice(0,f),f==0&&l.unshift(""),e++}return s.length&&l.unshift(s),l.join(u)||""},String.prototype.padStart=String.prototype.padStart||function(g,u){if(u){let e=this;for(;e.length<g;)e=`${u}${e}`;return e}},String.prototype.padEnd=String.prototype.padEnd||function(g,u){if(u){let e=this;for(;e.length<g;)e+=u;return e}}});let pr=Ar((pi,Aa)=>{O();(function(){"use strict";let g={fatal:!0},u=[new TextDecoder("iso-8859-15",g),new TextDecoder("utf-8",g),new TextDecoder("sjis",g),new TextDecoder("euc-jp",g),new TextDecoder("ascii")],e={debug:!1,parse:function(a,s){if(a instanceof Uint8Array)return e.Uint8(a);if(typeof a=="string")return e.Base64(a);if(a instanceof HTMLElement&&a.type==="file")return e.addListener(a,s);throw new Error("MidiParser.parse() : Invalid input provided")},addListener:function(a,s){if(!File||!FileReader)throw new Error("The File|FileReader APIs are not supported in this browser. Use instead MidiParser.Base64() or MidiParser.Uint8()");if(a===void 0||!(a instanceof HTMLElement)||a.tagName!=="INPUT"||a.type.toLowerCase()!=="file")return console.warn("MidiParser.addListener() : Provided element is not a valid FILE INPUT element"),!1;s=s||function(){},a.addEventListener("change",function(l){if(!l.target.files.length)return!1;console.log("MidiParser.addListener() : File detected in INPUT ELEMENT processing data..");let f=new FileReader;f.readAsArrayBuffer(l.target.files[0]),f.onload=function(b){s(e.Uint8(new Uint8Array(b.target.result)))}})},Base64:function(a){let s=function(b){let y="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";if(b=b.replace(/^.*?base64,/,""),b=String(b).replace(/[\t\n\f\r ]+/g,""),!/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/.test(b))throw new TypeError("Failed to execute _atob() : The string to be decoded is not correctly encoded.");b+="==".slice(2-(3&b.length));let w,$="",C,t,n=0;for(;n<b.length;)w=y.indexOf(b.charAt(n++))<<18|y.indexOf(b.charAt(n++))<<12|(C=y.indexOf(b.charAt(n++)))<<6|(t=y.indexOf(b.charAt(n++))),$+=C===64?String.fromCharCode(w>>16&255):t===64?String.fromCharCode(w>>16&255,w>>8&255):String.fromCharCode(w>>16&255,w>>8&255,255&w);return $}(a=String(a));let l=s.length;let f=new Uint8Array(new ArrayBuffer(l));for(let b=0;b<l;b++)f[b]=s.charCodeAt(b);return e.Uint8(f)},Uint8:function(f){let s={data:null,pointer:0,movePointer:function(C){return this.pointer+=C,this.pointer},readInt:function(C){if((C=Math.min(C,this.data.byteLength-this.pointer))<1)return-1;let t=0;if(1<C)for(let n=1;n<=C-1;n++)t+=this.data.getUint8(this.pointer)*Math.pow(256,C-n),this.pointer++;return t+=this.data.getUint8(this.pointer),this.pointer++,t},readStr:function(C){let t=new Uint8Array(C),n=!1,h;t.forEach((i,o)=>{t[o]=this.readInt(1)});for(let i=0;i<u.length;i++)if(!n)try{if(h=u[i].decode(t),i===0)for(let o=0;o<h.length;o++){let c=h.charCodeAt(o);if(c>191||c>127&&c<160)throw new RangeError(`Invalid code point: ${c}`)}n=!0,console.debug(`String byte sequence in ${u[i].encoding}`)}catch(o){console.debug(`SMF string ${o}`)}return h||"String byte sequence read failed."},backOne:function(){this.pointer--},readIntVLV:function(){let C=0;if(this.pointer>=this.data.byteLength)return-1;if(this.data.getUint8(this.pointer)<128)C=this.readInt(1);else{let n=[];for(;128<=this.data.getUint8(this.pointer);)n.push(this.readInt(1)-128);let t=this.readInt(1);for(let h=1;h<=n.length;h++)C+=n[n.length-h]*Math.pow(128,h);C+=t}return C}};if(s.data=new DataView(f.buffer,f.byteOffset,f.byteLength),s.readInt(4)!==1297377380)return console.warn("Header validation failed (not MIDI standard or file corrupt.)"),!1;s.readInt(4);let l={};l.formatType=s.readInt(2),l.tracks=s.readInt(2),l.track=[];let f=s.readInt(1),b=s.readInt(1);128<=f?(l.timeDivision=[],l.timeDivision[0]=f-128,l.timeDivision[1]=b):l.timeDivision=256*f+b;for(let C=1;C<=l.tracks;C++){l.track[C-1]={event:[]};let y,w=s.readInt(4);if(w===-1)break;if(w!==1297379947)return!1;s.readInt(4);let t=0,n=!1,h,i;for(;!n&&(t++,l.track[C-1].event[t-1]={},l.track[C-1].event[t-1].deltaTime=s.readIntVLV(),(h=s.readInt(1))!==-1);)if(128<=h?i=h:(h=i,s.movePointer(-1)),h===255){l.track[C-1].event[t-1].type=255,l.track[C-1].event[t-1].metaType=s.readInt(1);let $=s.readIntVLV();switch(l.track[C-1].event[t-1].metaType){case 47:case-1:n=!0;break;case 1:case 2:case 3:case 4:case 5:case 7:case 6:l.track[C-1].event[t-1].data=s.readStr($);break;case 33:case 89:case 81:l.track[C-1].event[t-1].data=s.readInt($);break;case 84:l.track[C-1].event[t-1].data=[],l.track[C-1].event[t-1].data[0]=s.readInt(1),l.track[C-1].event[t-1].data[1]=s.readInt(1),l.track[C-1].event[t-1].data[2]=s.readInt(1),l.track[C-1].event[t-1].data[3]=s.readInt(1),l.track[C-1].event[t-1].data[4]=s.readInt(1);break;case 88:l.track[C-1].event[t-1].data=[],l.track[C-1].event[t-1].data[0]=s.readInt(1),l.track[C-1].event[t-1].data[1]=s.readInt(1),l.track[C-1].event[t-1].data[2]=s.readInt(1),l.track[C-1].event[t-1].data[3]=s.readInt(1);break;default:this.customInterpreter!==null&&(l.track[C-1].event[t-1].data=this.customInterpreter(l.track[C-1].event[t-1].metaType,s,$)),this.customInterpreter!==null&&l.track[C-1].event[t-1].data!==!1||(s.readInt($),l.track[C-1].event[t-1].data=s.readInt($),this.debug&&console.info("Unimplemented 0xFF meta event! data block readed as Integer"))}}else switch((h=h.toString(16).split(""))[1]||h.unshift("0"),l.track[C-1].event[t-1].type=parseInt(h[0],16),l.track[C-1].event[t-1].channel=parseInt(h[1],16),l.track[C-1].event[t-1].type){case 15:this.customInterpreter!==null&&(l.track[C-1].event[t-1].data=this.customInterpreter(l.track[C-1].event[t-1].type,s,!1)),this.customInterpreter!==null&&l.track[C-1].event[t-1].data!==!1||(y=s.readIntVLV(),l.track[C-1].event[t-1].data=s.readInt(y),this.debug&&console.info("Unimplemented 0xF exclusive events! data block readed as Integer"));break;case 10:case 11:case 14:case 8:case 9:l.track[C-1].event[t-1].data=[],l.track[C-1].event[t-1].data[0]=s.readInt(1),l.track[C-1].event[t-1].data[1]=s.readInt(1);break;case 12:case 13:l.track[C-1].event[t-1].data=s.readInt(1);break;case-1:n=!0;break;default:if(this.customInterpreter!==null&&(l.track[C-1].event[t-1].data=this.customInterpreter(l.track[C-1].event[t-1].metaType,s,!1)),this.customInterpreter===null||l.track[C-1].event[t-1].data===!1)return console.log("Unknown EVENT detected... reading cancelled!"),!1}}return l},customInterpreter:null};if(typeof Aa<"u")Aa.exports=e;else{let a=typeof window=="object"&&window.self===window&&window||typeof self=="object"&&self.self===self&&self||typeof global=="object"&&global.global===global&&global;a.MidiParser=e}})()});O();O();let pe,Ha,oa=(Ha=class{constructor(){P(this,pe,{})}addEventListener(g,u){r(this,pe)[g]||(r(this,pe)[g]=[]),r(this,pe)[g].unshift(u)}removeEventListener(g,u){if(r(this,pe)[g]){let e=r(this,pe)[g].indexOf(u);e>-1&&r(this,pe)[g].splice(e,1),r(this,pe)[g].length<1&&delete r(this,pe)[g]}}dispatchEvent(g,u){let s;let e=new Event(g),a=this;e.data=u,((s=r(this,pe)[g])==null?void 0:s.length)>0&&r(this,pe)[g].forEach(function(l){try{l==null||l.call(a,e)}catch(f){console.error(f)}}),this[`on${g}`]&&this[`on${g}`](e)}},pe=new WeakMap,Ha);O();O();let Ga=function(g,u){let e=Math.min(g.length,u.length),a=g.slice(0,e),s=u.slice(0,e),l=0,f=0;for(;f<e&&l==0;)l=Math.sign(a[f]-s[f]),f++;return l},Se=function(g=""){this.name=g,this.pool=[],this.point=function(u,e=!1){if(this.pool.length>0){let a=this.pool.length,s=1<<Math.floor(Math.log2(a)),l=s,f=64;for(;s>=1&&f>=0;){if(f<=0)throw new Error("TTL reached.");if(l==a)l-=s;else{let y=Ga(u,this.pool[l]);switch(y){case 0:{f=0;break}case 1:{l+s<=a&&(l+=s);break}case-1:{l!=0&&(l-=s);break}default:console.warn(`Unexpected result ${y}.`)}}s=s>>1,f--}let b=!0;if(l>=this.pool.length)b=!1;else{let y=this;this.pool[l].forEach(function(w,$,C){b&&w!=u[$]&&(b=!1)}),!b&&Ga(u,this.pool[l])>0&&l++}return b||e?l:-1}else return e?0:-1},this.add=function(u,e){return u.data=e,this.pool.splice(this.point(u,!0),0,u),this},this.default=function(u){console.warn(`No match in "${this.name||"(unknown)"}" for "${u}". Default action not defined.`)},this.get=function(u){let e=this.point(u);if(e>-1)return this.pool[e].data;this.default(u)},this.run=function(u,...e){let a=this.point(u);a>-1?u.subarray?this.pool[a].data(u.subarray(this.pool[a].length),...e):this.pool[a].data(u.slice(this.pool[a].length),...e):this.default(u,...e)}};O();let Br=["MSB","PRG","LSB","NME","ELC","DRM","LVL","VXP"],Dr={krs:"KR",s90es:"ES",motif:"ES"},Lr={krs:"Kr",s90es:"SE",motif:"ME"},lt={g2:new Set("gm,GM,g2,G2".split(",")),xg:new Set};for(let g of"XG,MU,AN,AP,DR,DX,PC,PF,SG,VL".split(","))lt.xg.add(g),lt.xg.add(g.toLowerCase());let ya=function(g){let u=Math.floor(g/10),e=g%10;return`${u.toString(16)}${e}`},se,Va,Ea=(Va=class{constructor(...g){A(this,"HINT_XG_MUBASIC",0);A(this,"HINT_XG_MU100",1);A(this,"HINT_XG_PSR",2);P(this,se,void 0);A(this,"strictMode",!1);this.loadFiles(...g)}get bankInfo(){return r(this,se)}get(g=0,u=0,e=0,a,s=0){let k,v,I;let l=[g,u,e],f,b=1,y=0,w,$,C,t=Array.from(arguments);switch(a){case"xg":{switch(g){case 0:{if(s===2)e>>4===7?t[2]+=16:e>>3===13&&(t[2]+=40);else switch(e){case 127:{t[2]=0;break}}break}case 16:{e===126&&(t[2]=0);break}case 32:{e>125&&(t[2]=0),t[2]+=4;break}case 33:{(e>125||e===3)&&(t[2]=0),t[2]+=5;break}case 34:case 35:case 36:{e>125&&(t[2]=0),t[2]+=5;break}case 79:case 80:case 81:case 82:case 83:case 84:t[0]+=16;case 95:case 96:case 97:case 98:case 99:case 100:{e===126&&(t[2]=0);break}case 48:case 64:case 126:case 127:{e===126&&(g===127&&u===0||(t[2]=0));break}case 121:{switch(e){case 126:{t[2]=0;break}case 16:{t[2]=15;break}default:t[2]=t[2]&15}break}}break}case"gs":case"sc":{g===0&&e<5?t[0]=49:g<128&&g>125&&e<5&&e!==2&&(t[2]=g,t[0]=49);break}case"mt32":{g===0&&(t[0]=49);break}case"sd":{switch(g){case 121:{t[0]=96;break}case 120:{t[0]=104;break}}t[0]>>1===40?t[2]|=16:t[0]>95&&t[0]<100&&(t[2]|=16,u>>4===7&&(t[0]=96));break}case"pa":{switch(g){case 120:{e==64?t[2]=2:t[2]=1;break}case 121:{switch(e){case 127:{t[2]=79;break}default:t[2]=(t[2]&63)+32}break}}break}case"g2":{g>>1===40?t[2]|=16:g>95&&g<100&&(t[2]|=16,u>>4===7&&(t[0]=96));break}case"sg":{g===8&&e===0&&(t[2]=5);break}case"05rw":case"x5d":{g&&g<56&&(t[0]=56);break}case"s90es":case"motif":case"an1x":case"cs1x":case"cs6x":{if(g===0)break;switch(g){case 63:{switch(a){case"s90es":{e<8?t[2]+=17:e<32?t[2]+=13:t[2]=(t[2]>>3)+19;break}case"motif":{e<8?t[2]+=28:e<32?t[2]+=13:t[2]=(t[2]>>3)+19;break}case"cs1x":{switch(e>>1){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:case 10:{t[2]+=34;break}case 32:{t[2]=34+((e&1)<<2);break}case 33:{t[2]=47+((e&1)<<2);break}case 61:{t[2]=34+((e&1)<<2);break}case 62:{t[2]=47+((e&1)<<2);break}}break}}break}case 32:{e>125&&(t[2]=0),t[2]+=4;break}case 33:{(e>125||e===3)&&(t[2]=0),t[2]+=5;break}case 34:case 35:case 36:{e>125&&(t[2]=0),t[2]+=5;break}case 79:case 80:case 81:case 82:case 83:case 84:t[0]+=16;case 95:case 96:case 97:case 98:case 99:case 100:{e===126&&(t[2]=0);break}}break}}let n=" ",h="M",i="",o=0,c=0;switch(t[0]){case 0:{switch(t[2]){case 127:{h="GM-a";break}case 126:{h="GM-n";break}case 7:{h="GM-k",i="GLX";break}case 5:{h="SG-a",i="000";break}case 4:{a==="gs"||a==="sc"?(h="GM-a",i="000"):(h="SP-l",i="C/M");break}case 3:case 2:case 1:{(a==="gs"||a==="sc")&&(h="GM-a",i="000");break}case 0:{h="GM-a";break}default:h="y",o=3}break}case 8:{a==="sg"?h="GM-s":h="r:";break}case 32:case 33:case 34:case 35:case 36:{a==="xg"&&(h=`${["AP","VL","PF","DX","AN"][g&7]}-${"abcdefgh"[e]}`,o=3);break}case 48:{i=`M${(t[2]>>3).toString().padStart(2,"0")}`,h=`y${i}`,o=1;break}case 49:{t[2]>>1===63?(h=`MT-${"ba"[t[2]&1]}`,i=`C${"-/"[t[2]&1]}M`):(h="GM-a",i="000");break}case 56:{h="GM-b";break}case 57:h=["yDOC","QY10","QY20"][t[2]-112]||"yMxv",i=["DOC","QY1","QY2"][t[2]-112]||"057";case 61:case 128:{h="rDrm";break}case 120:{h="gDrm";break}case 62:{h="kDrm";break}case 63:{if(t[2]<17){let R=t[2];h=R<10?"kP:":"kC:",h+=R%10}else if(t[2]<34)h=["Pre1","Pre2","Pre3","Pre4","Usr1","Usr2","DrmP","DrmU","Plg1","Plg2","Plg3","Pre1","Pre2","Pre3","Pre4","Pre5","Pre6"][t[2]-17];else if(t[2]<55){let R=t[2]-34;switch(R>12&&R--,e>>1){case 32:case 33:{h=`Pr${e-63}U`;break}case 61:case 62:{h=`Pr${e-121}U`;break}default:h=t[2]===46?"PrDr":`Pr${(R>>2)+1}${String.fromCharCode(65+(R&3))}`}}else h="Ds";o=1;break}case 64:{h="ySFX",i="SFX";break}case 67:{h="DX:S";break}case 80:case 81:case 82:case 83:{h=`Prg${"UABC"[t[0]-80]}`;break}case 88:case 89:case 90:case 91:{h=`Cmb${"UABC"[t[0]-88]}`;break}case 95:{h=`${["DR","PC"][t[2]]}-d`;break}case 96:{h=t[2]===106?"AP-a":t[2]>>4===1?"SDg":"PF",t[2]>63?c=63:t[2]>>4===1&&(c=16),o=3;break}case 97:{h=t[2]>>4===1?"SDa":"VL:",o=3,t[2]>>4===1?c=16:c=112;break}case 98:{h=t[2]>>4===1?"SDb":"SG-a",o=3,c=16;break}case 99:{h=t[2]>>4===1?"SDc":"DX",t[2]>63?c=63:t[2]>>4===1&&(c=16),o=3;break}case 100:{h="AN",t[2]>63?c=63:t[2]>>4===1&&(c=16),o=3;break}case 104:case 105:case 106:case 107:{h="SDd",c=104;break}case 121:{h=`GM${t[2]?"":"-a"}`,o=1;break}case 122:{h="lDrm";break}case 126:{h="yDrS";break}case 127:{t[2]===127?h="rDrm":h="yDrm";break}default:t[0]<48?h="r:":h="M"}h.length<4&&(h+=`${[g,e,t[0],t[2]][o]-c}`.padStart(4-h.length,"0")),i.length<3&&(i+=`${[g,e,g,e][o]}`.padStart(3-i.length,"0")),a==="xg"&&(g===0?t[2]<100?h=h.replace("y0","y:"):t[2]===125&&(h="y126"):g===16?(f=`Voice${((t[2]<<7)+t[1]+1).toString().padStart(3,"0")}`,n=" "):g===35&&e>>1===2&&(f=`DXCH_${(((t[2]&1)<<7)+u+1).toString().padStart(3,"0")}`,n=" "));let d=[t[0],t[1],t[2]];for(;!((f==null?void 0:f.length)>=0);)if(f=(k=r(this,se)[t[1]||0][(t[0]<<8)+t[2]])==null?void 0:k.name,f){let R=r(this,se)[t[1]||0][(t[0]<<8)+t[2]];b=(R==null?void 0:R.poly)||b,y=(R==null?void 0:R.type)||y,w=R==null?void 0:R.drum,$=R==null?void 0:R.level,C=R==null?void 0:R.voice}else if(this.strictMode)f="",n="?";else if(t[0]===0&&t[1]===0&&t[2]===0)f="Unloaded";else if(r(this,se)[t[1]||0][t[0]<<8])t[0]===0?(t[2]=0,n="^"):t[2]<1?(t[0]=0,n="*"):(t[2]--,n="^");else if(g===48)t[0]=0,t[2]=0,n="!";else if(g===62)t[1]--,n=" ",t[1]<1&&!(f!=null&&f.length)&&(t[0]=0,n="!");else if(g<63)t[0]===0?(t[2]=0,n="^"):t[2]<1?(t[0]=0,n="*"):t[2]--;else if(g===80)f=`PrgU:${u.toString().padStart(3,"0")}`,n="!";else if(g===88)f=`CmbU:${u.toString().padStart(3,"0")}`,n="!";else if(g===121)f=`GM2Vox0${e}`,n="#";else if(g===122)if(t[1]===32?t[1]:t[1]%=7,f=(v=r(this,se)[t[1]||0][(t[0]<<8)+t[2]])==null?void 0:v.name,f){n=" ";let R=r(this,se)[t[1]||0][(t[0]<<8)+t[2]];b=(R==null?void 0:R.poly)||b,y=(R==null?void 0:R.type)||y,w=R==null?void 0:R.drum,$=R==null?void 0:R.level}else f="",n="*";else t[1]===0?(f=`${g.toString().padStart(3,"0")} ${u.toString().padStart(3,"0")} ${e.toString().padStart(3,"0")}`,n="!"):t[0]===0?(t[2]=0,n="^"):t[2]>0?t[2]--:t[1]>0?(t[1]=0,n="!"):(t[0]=0,n="?");let m=[t[0],t[1],t[2]];switch(n){case"^":{switch(a){case"gs":case"sc":case"ns5r":{n=" ";break}case"xg":{(e===126||e===152)&&(n=" ");break}}g===127&&(n=" ");break}case"*":break;case"!":break;case"?":break}let p="??";switch(t[0]){case 0:{t[2]===0?p="GM":t[2]===5||t[2]===7?p="KG":t[2]<154&&(p="XG");break}case 32:case 33:case 35:case 36:{t[2]>4?p=["AP","VL","PF","DX","AN"][t[0]-32]:p="GS";break}case 48:{p="MU";break}case 49:{t[2]>>1===63?p="MT":t[2]<5&&(p="GM");break}case 56:case 62:{p="AG";break}case 61:case 80:case 83:case 88:case 89:case 91:{p="AI";break}case 82:case 90:{p="XD";break}case 63:{t[2]<17?p="KR":t[2]<34?p="ES":t[2]<55?p="CS":p="DS";break}case 64:case 126:{p="XG";break}case 67:case 99:{p=t[2]>>4===1?"SD":"DX";break}case 81:{p="RW";break}case 95:{p=["DR","PC"][t[2]];break}case 96:{p=t[2]===106?"AP":t[2]>>4===1?"SD":"PF";break}case 97:{p=t[2]>>4===1?"SD":"VL";break}case 98:{p=t[2]>>4===1?"SD":"SG";break}case 100:{p="AN";break}case 104:case 105:case 106:case 107:{p="SD";break}case 120:{p=u===0?"GM":(I=["G2","PA","PA"][t[2]])!=null?I:"G2";break}case 128:{p=u===0?"GM":"GS";break}case 121:{p=t[2]?["G2","XG","PA","PA","PA"][t[2]>>4]:"GM";break}case 122:{p="KG";break}case 127:{p=t[2]===127?"MT":u===0?"GM":"XG";break}default:t[0]<48&&(t[0]===16&&a==="xg"?p="XG":p="GS")}switch(a){case"xg":{let R=0,ae=0,Y="GM",ue=!1,ze=!1;if(lt.xg.has(p)||lt.g2.has(p)?n!==" "?g>>4===6?ze=!0:g!==0&&(ue=!0):d[2]!==m[2]&&(g===81?e>>3===14?(R=97,ae=112,ze=!0,Y="VL"):e>>3===15&&(ue=!0):g===97&&(ze=!0)):g>>4===6?ze=!0:ue=!0,ze&&g===0&&e===0&&(ae=[0,126,152][s]),ue)f="Silence",n="?",p="??";else if(ze){let z=r(this,se)[u][R<<8|ae];p=Y,f=z==null?void 0:z.name,b=(z==null?void 0:z.poly)||b,y=(z==null?void 0:z.type)||y,w=z==null?void 0:z.drum,$=z==null?void 0:z.level,C=z==null?void 0:z.voice,n="^"}break}}if(n!==" ")switch(a){case"krs":case"s90es":case"motif":{f="",p=Dr[a],n="?";break}case"g2":{f="GM2 Ext?",n="?";break}case"pa":{n==="^"&&(f="Unknown",n="?");break}case"xg":{if(n!=="^"){switch(g){case 120:case 127:case 126:{f="SilntKit";break}default:f="Silence"}n="?"}break}default:self.debugMode&&(f="",n="?")}return n==="?"&&(b=0),{name:f||`${Lr[a]||a.toUpperCase()}${ya(g||0)}${ya(u||0)}${ya(e||0)}`,poly:b,type:y,drum:w,level:$,voice:C,iid:d,eid:m,sid:l,hint:s,ending:n,sect:h,bank:i,standard:p,mode:a}}async load(g,u,e="(internal)",a){let s=this,l=[],f=0,b=0,y=0;g.split(`
`).forEach(function(w,$){let n;let C=w.split("	"),t=[];if($===0){if(C.forEach(function(h,i){l[Br.indexOf(h)]=i}),l.length<4){console.debug("Debugger launched.");debugger}}else{let h=0,i=0,o=0,c,d=1,m=0,p,k,v;C.forEach(function(Y,ue){switch(ue){case l[0]:{h=parseInt(Y);break}case l[1]:{i=parseInt(Y);break}case l[2]:{o=parseInt(Y);break}case l[3]:{c=Y;break}case l[4]:{Y=parseInt(Y),Y<16?d=Y+1:(m=(Y&15)+1,d=m);break}case l[5]:{k=Y;break}case l[6]:{typeof Y=="string"&&(p=parseInt(Y));break}case l[7]:{v=Y;break}}}),r(s,se)[i]=r(s,se)[i]||[];let I=r(s,se)[i],R={msb:h,prg:i,lsb:o,name:c,poly:d,type:m,drum:k,level:p,voice:v,priority:a},ae=!1;a<((n=I[h<<8|o])==null?void 0:n.priority)&&(ae=!0,y++),(!I[h<<8|o]||ae||u)&&(I[h<<8|o]=R,f++),b++}}),u||console.debug(`Map: From "${e}", ${b} total, ${f} loaded (${f-y} + ${y}).`)}clearRange(g){let u=g.prg!==void 0?g.prg.constructor===Array?g.prg:[g.prg,g.prg]:[0,127],e=g.msb!==void 0?g.msb.constructor===Array?g.msb:[g.msb,g.msb]:[0,127],a=g.lsb!==void 0?g.lsb.constructor===Array?g.lsb:[g.lsb,g.lsb]:[0,127];for(let s=e[0];s<=e[1];s++){let l=s<<8;for(let f=a[0];f<=a[1];f++){let b=l+f;for(let y=u[0];y<=u[1];y++)delete r(this,se)[y][b]}}}init(){M(this,se,[]);for(let g=0;g<128;g++)r(this,se).push([""])}async loadFiles(...g){this.init();let u=this;g.forEach(async function(e,a){try{u.load(await(await fetch(`./data/bank/${e}.tsv`)).text(),!1,e,a)}catch(s){console.error(`Failed loading "${e}.tsv".`)}})}},se=new WeakMap,Va);O();O();let Pt,Xa,Fa=(Xa=class{constructor(){P(this,Pt,{});A(this,"context")}set(g,u){r(this,Pt)[g]=u}has(g){return!!r(this,Pt)[g]}async read(g,u){if(!this.has(g))throw new Error(`No decoder registered for "${g}"`);return await r(this,Pt)[g].call(this.context||this,u)}},Pt=new WeakMap,Xa);let Ur=function(g,u){let e=!0;return u.forEach((a,s)=>{e=e&&g[s]===a}),e},Kt=function(g){let u=0;return g.forEach(e=>{u*=256,u+=e}),u},Ue=new TextDecoder,Yt=new Fa;Yt.set("s7e",async function(g){let u=new Uint8Array(await g.slice(0,65536).arrayBuffer()),e="MSB	LSB	PRG	NME",a=[0,0,0,0],s=32,l=0,f=0,b=!0,y=[],w=0;for(;b;){let $=u.subarray(l);([()=>{Ue.decode($.subarray(0,4))==="YSFC"?(l+=80,f=1):l++},()=>{if(Ur($.subarray(0,4),a))y.forEach((C,t,n)=>{let h=Kt(u.subarray(C.start+4,C.start+8));C.length=h}),f=2;else{let C=Ue.decode($.subarray(0,4)),t=Kt($.subarray(4,8));y.push({type:C,start:t}),l+=8}},()=>{let C=y[w],t=u.subarray(C.start,C.start+C.length),n=32;switch(C.type){case"ENVC":{let h=s;for(;h<t.length;){let i=t.subarray(h,h+n),o=Ue.decode(i.subarray(0,10)).trimEnd();o.slice(0,5)==="Init "&&(o=""),o&&(e+=`
063	${(i[17]+13).toString().padStart(3,"0")}	${i[19].toString().padStart(3,"0")}	${o}`),h+=n}break}case"EDVC":{let h=s;for(;h<t.length;){let i=t.subarray(h,h+n),o=Ue.decode(i.subarray(0,10)).trimEnd();o.slice(0,5)==="Init "&&(o=""),o&&(e+=`
063	024	${i[19].toString().padStart(3,"0")}	${o}`),h+=n}break}case"EPVC":{let h=32,i=s;for(;i<t.length;){let o=t.subarray(i,i+h),c=Ue.decode(o.subarray(0,10)).trimEnd();c==="----------"&&(c=""),c&&(e+=`
063	${(o[17]+1).toString().padStart(3,"0")}	${o[19].toString().padStart(3,"0")}	${c}`),i+=h}break}}w++,w>=y.length&&(f=3,b=!1)}][f]||(()=>{b=!1}))()}return e});Yt.set("pcg",async function(g){let u=new Uint8Array(await g.arrayBuffer()),e="MSB	LSB	PRG	NME",a=100,s=0,l=0,f=!0,b=[],y=0;for(;f;){let w=u.subarray(a);([()=>{f=Ue.decode(w.subarray(0,4))==="INI2",l=w[15],a+=16,s=1},()=>{let $=Ue.decode(w.subarray(0,4)),C=w[5],t=w[7],n=w[11],h=Kt(w.subarray(12,16)),i=Kt(w.subarray(16,20)),o=Kt(w.subarray(36,40)),c=Ue.decode(w.subarray(44,44+n));b.push({type:$,tipMsb:C,tipLsb:t,nameLen:n,length:h,start:i,entryLen:o,name:c}),a+=64,l--,l<1&&(s=2)},()=>{let $=b[y],C=u.subarray($.start,$.start+$.length);switch($.type){case"PRG1":break;case"PBK1":{let t=63,n=($.tipMsb?6:0)+$.tipLsb;for(let h=0;h<128;h++){let i=h*$.entryLen,o=C.subarray(i,i+$.entryLen),c=Ue.decode(o.subarray(0,24)).trimEnd().replace("InitProg","");c.length&&n>5&&(e+=`
${t.toString().padStart(3,"0")}	${n.toString().padStart(3,"0")}	${h.toString().padStart(3,"0")}	${c}`)}break}case"CBK1":{let t=63,n=($.tipMsb?3:0)+$.tipLsb+10;for(let h=0;h<128;h++){let i=h*$.entryLen,o=C.subarray(i,i+$.entryLen),c=Ue.decode(o.subarray(0,24)).trimEnd().replace("InitCombi","");c.length&&n>12&&(e+=`
${t.toString().padStart(3,"0")}	${n.toString().padStart(3,"0")}	${h.toString().padStart(3,"0")}	${c}`)}break}}y++,y>=b.length&&(s=3,f=!1)}][s]||(()=>{f=!1}))()}return e});O();let zt=["off","hall","room","stage","plate","delay LCR","delay LR","echo","cross delay","early reflections","gate reverb","reverse gate"].concat(new Array(4),["white room","tunnel","canyon","basement","karaoke"],new Array(43),["pass through","chorus","celeste","flanger","symphonic","rotary speaker","tremelo","auto pan","phaser","distortion","overdrive","amplifier","3-band EQ","2-band EQ","auto wah"],new Array(1),["pitch change","harmonic","touch wah","compressor","noise gate","voice channel","2-way rotary speaker","ensemble detune","ambience"],new Array(4),["talking mod","Lo-Fi","dist + delay","comp + dist + delay","wah + dist + delay","V dist","dual rotor speaker"]),Wt=["melodic","drums","drum set 1","drum set 2","drum set 3","drum set 4","drum set 5","drum set 6","drum set 7","drum set 8"],Or=[17.1,18.6,20.2,21.8,23.3,24.9,26.5,28,29.6,31.2,32.8,34.3,35.9,37.5,39,40.6,42.2,43.7,45.3,46.9,48.4,50],At=[20,22,25,28,32,36,40,45,50,56,63,70,80,90,100,110,125,140,160,180,200,225,250,280,315,355,400,450,500,560,630,700,800,900,1e3,1100,1200,1400,1600,1800,2e3,2200,2500,2800,3200,3600,4e3,4500,5e3,5600,6300,7e3,8e3,9e3,1e4,11e3,12e3,14e3,16e3,18e3,2e4],Ka=[0,.04,.08,.13,.17,.21,.25,.29,.34,.38,.42,.46,.51,.55,.59,.63,.67,.72,.76,.8,.84,.88,.93,.97,1.01,1.05,1.09,1.14,1.18,1.22,1.26,1.3,1.35,1.39,1.43,1.47,1.51,1.56,1.6,1.64,1.68,1.72,1.77,1.81,1.85,1.89,1.94,1.98,2.02,2.06,2.1,2.15,2.19,2.23,2.27,2.31,2.36,2.4,2.44,2.48,2.52,2.57,2.61,2.65,2.69,2.78,2.86,2.94,3.03,3.11,3.2,3.28,3.37,3.45,3.53,3.62,3.7,3.87,4.04,4.21,4,37,4.54,4.71,4.88,5.05,5.22,5.38,5.55,5.72,6.06,6.39,6.73,7.07,7.4,7.74,8.08,8.41,8.75,9.08,9.42,9.76,10.1,10.8,11.4,12.1,12.8,13.5,14.1,14.8,15.5,16.2,16.8,17.5,18.2,19.5,20.9,22.2,23.6,24.9,26.2,27.6,28.9,30.3,31.6,33,34.3,37,39.7],Ya=function(g){let u=.1,e=-.3;return g>66?(u=5,e=315):g>56?(u=1,e=47):g>46&&(u=.5,e=18.5),u*g-e},za=function(g){return g>105?Or[g-106]:g>100?g*1.1-100:g/10},Wa=",a,i,u,e,o,ka,ki,ku,ke,ko,ky,kw,sa,si,su,se,so,sh,ta,ti,tu,te,to,t,ch,t,s,na,ni,nu,ne,no,ny,nn,ha,hi,hu,he,ho,hy,fa,fi,fu,fe,fo,ma,mi,mu,me,mo,my,mm,ya,yu,ye,yo,ra,ri,ru,re,ro,ry,wa,wi,we,wo,ga,gi,gu,ge,go,gy,gw,za,zi,zu,ze,zo,ja,ji,ju,je,jo,jy,da,di,du,de,do,dy,ba,bi,bu,be,bo,by,va,vi,vu,ve,vo,pa,pi,pu,pe,po,py,nga,ngi,ngu,nge,ngo,ngy,ng,hha,hhi,hhu,hhe,hho,hhy,hhw,*,_,,,~,.".split(","),wa={};`hi*,
ka,„Åã
ki,„Åç
ku,„Åè
ke,„Åë
ko,„Åì
ky,„Åç!
kw,„Åèl
tsu,„Å§
ts,„Å§l
sa,„Åï
si,„Åô„ÅÉ
su,„Åô
se,„Åõ
so,„Åù
shi,„Åó
sh,„Åó!
ta,„Åü
ti,„Å¶„ÅÉ
tu,„Å®„ÅÖ
te,„Å¶
to,„Å®
tchy,„Å°!
tchi,„Å°
na,„Å™
ni,„Å´
nu,„Å¨
ne,„Å≠
no,„ÅÆ
ny,„Å´!
nn,„Çì
ha,„ÅØ
hi,„Å≤
hu,„Åª„ÅÖ
he,„Å∏
ho,„Åª
hy,„Å≤!
fa,„Åµ„ÅÅ
fi,„Åµ„ÅÉ
fu,„Åµ
fe,„Åµ„Åá
fo,„Åµ„Åâ
ma,„Åæ
mi,„Åø
mu,„ÇÄ
me,„ÇÅ
mo,„ÇÇ
my,„Åø!
mm,„á∫
ra,„Çâ
ri,„Çä
ru,„Çã
re,„Çå
ro,„Çç
ry,„Çä!
wa,„Çè
wi,„Çê
we,„Çë
wo,„Çí
nga,„Åã„Çö
ngi,„Åç„Çö
ngu,„Åè„Çö
nge,„Åë„Çö
ngo,„Åì„Çö
ngy,„Åç„Çö!
ng,„É≥
ga,„Åå
gi,„Åé
gu,„Åê
ge,„Åí
go,„Åî
gy,„Åé!
gw,„Åêl
za,„Åñ
zi,„Åö„ÅÉ
zu,„Åö
ze,„Åú
zo,„Åû
ja,„Åò„ÇÉ
ji,„Åò
ju,„Åò„ÇÖ
je,„Åò„Åá
jo,„Åò„Çá
jy,„Åò!
da,„Å†
di,„Åß„ÅÉ
du,„Å©„ÅÖ
de,„Åß
do,„Å©
dy,„Åß!
ba,„Å∞
bi,„Å≥
bu,„Å∂
be,„Åπ
bo,„Åº
by,„Å≥!
va,„Çî„ÅÅ
vi,„Çî„ÅÉ
vu,„Çî
ve,„Çî„Åá
vo,„Çî„Åâ
pa,„Å±
pi,„Å¥
pu,„Å∑
pe,„Éö
po,„ÅΩ
py,„Å¥!
!ya,„ÇÉ
!yu,„ÇÖ
!ye,„Åá
!yo,„Çá
ya,„ÇÑ
yu,„ÇÜ
ye,õÄÅ
yo,„Çà
!a,„ÇÉ
!u,„ÇÖ
!e,„Åá
!o,„Çá
!a,„ÇÉ
!u,„ÇÖ
!e,„Åá
!o,„Çá
la,„ÅÅ
li,„ÅÉ
lu,„ÅÖ
le,„Åá
lo,„Åâ
a,„ÅÇ
i,„ÅÑ
u,„ÅÜ
e,„Åà
o,„Åä
*,„Å£
~,
^,
_,`.split(`
`).forEach(g=>{let u=g.split(",");wa[u[0]]=u[1]});let qa=function(g){let u=g;g[0]=="*"&&(u=u.slice(1)),["aa","ii","uu","ee","oo"].forEach(a=>{for(;u.indexOf(a)>-1;)u=u.replace(a,a[0])});for(let a in wa)u=u.replaceAll(a,wa[a]);u.indexOf("„Çì")==0&&u.length>1&&(u=u.slice(1));let e=u.indexOf("!");return e>-1&&u.length>1&&(u=u.slice(e+1)),u},Qa=function(g){return g?g<96?`cc${g}`:["aftertouch","velocity","pitch bend"][g-96]:"off"},Ja={"":["l9","Undefined fallback"],u8:["utf-8","Unicode"],l1:["l9","Pan-Latin"],jp:["sjis","Japanese"],kr:["iso-2022-kr","Korean"],hz:["gb18030","Simplified Chinese"],b5:["big5","Traditional Chinese"],cy:["koi8-ru","Cyrillic"],vn:["tcvn-5773-1993","Vietnamese"]},Za={m:"Male",f:"Female",c:"Chorus",s:"Solo",p:"Plural",w:"Words",x:"Non-vocal"};O();let ka=["room 1","room 2","room 3","hall 1","hall 2","plate","delay","panning delay"],ja=["chorus 1","chorus 2","chorus 3","chorus 4","feedback","flanger","short delay","short delay feedback"],er=["delay 1","delay 2","delay 3","delay 4","pan delay 1","pan delay 2","pan delay 3","pan delay 4","delay to reverb","pan repeat"];let _r={0:"thru",256:"stereo EQ",257:"spectrum",258:"enhancer",259:"humanizer",272:"overdrive",273:"distortion",288:"phaser",289:"auto wah",290:"rotary",291:"stereo flanger",292:"step flanger",293:"tremelo",294:"auto pan",304:"compressor",305:"limiter",320:"hexa chorus",321:"tremelo chorus",322:"stereo chorus",323:"space D",324:"3D chorus",336:"stereo delay",337:"modulated delay",338:"3-tap delay",339:"4-tap delay",340:"tremelo control delay",341:"reverb",342:"gate reverb",343:"3D delay",352:"2-pitch shifter",353:"feedback pitch shifter",368:"3D auto",369:"3D manual",370:"Lo-Fi 1",371:"Lo-Fi 2",512:"overdrive - chorus",513:"overdrive - flanger",514:"overdrive - delay",515:"distortion - chorus",516:"distortion - flanger",517:"distortion - delay",518:"enhancer - chorus",519:"enhancer - flanger",520:"enhancer - delay",521:"chorus - delay",522:"flanger - delay",523:"chorus - flanger",524:"rotary multi",1024:"guitar multi 1",1025:"guitar multi 2",1026:"guitar multi 3",1027:"clean guitar multi 1",1028:"clean guitar multi 2",1029:"bass multi",1030:"rhodes multi",1280:"keyboard multi",4352:"chorus / delay",4353:"flanger / delay",4354:"chorus / flanger",4355:"overdrive / distortion",4356:"overdrive / rotary",4357:"overdrive / phaser",4358:"overdrive / auto wah",4359:"phaser / rotary",4360:"phaser / auto wah"},Nr={66307:["drive"],66309:["vowel",g=>"aiueo"[g]],94723:["pre-filter"],94724:["Lo-Fi type"],94725:["post-filter"],94979:["Lo-Fi type"],94980:["fill type",g=>["off","LPF","HPF"][g]],94984:["noise type",g=>["white","pink"][g]],94987:["disc type",g=>["LP","SP","EP","RND"]],94990:["hum type",g=>`${g+5}0Hz`],94993:["M/S",g=>["mono","stereo"][g]]},Ca=function(g){return _r[(g[0]-32<<8)+g[1]]||`0x${g[0].toString(16).padStart(2,"0")}${g[1].toString(16).padStart(2,"0")}`},tr=function(g,u,e){let a=(g[0]-32<<16)+(g[1]<<8)+u,s=Nr[a]||{},l=s[0];if(l!=null&&l.length)return l+=`: ${(s[1]||function(){})(e)||e}`,l},va=[68,48,95,78,41,3,110,122,0];O();let Oe=new TextEncoder,ar=(g,u)=>{let e=Math.min(g.length,u.length),a=0;for(let s=0;s<e;s++)if(a=g[s]-u[s],a!==0)return[s,a];return g.length!==u.length?[e,g.length-u.length]:[0,0]},me=function(g=64){return Math.round(2e3*Math.log10(g/64))/100},rr=function(g,u,e){let a=[],s=e==!1?u.readIntVLV():e;g==0||g==127;for(let l=0;l<s;l++){let f=u.readInt(1);if(a.push(f),f!=247){if(f!=240){if(f>127)return console.debug(`Early termination: ${a}`),a.pop(),u.backOne(),u.backOne(),new Uint8Array(a)}}}return new Uint8Array(a)},dt=function(g){let u=0;return g.forEach(e=>{u+=e,u=u&127}),~u+1&127},Te=function(g,u){let e=0,a=0;for(let s=0;s<g.length;s++){let l=(s&7)-1,f=(a>>l&1)<<7,b=g[s];b+=f,s&7?(u(b,e,g),e++):a=g[s]}};let Hr=function(g,u){let e=0;for(let a=0;a<g.length;a++)if(a&1){e=e<<4|g[a]&15;let s=a>>1;u(e,s,g)}else e=g[a]&15},sr=function(g){let u=g.length>>1,e=new Uint8Array(u);return Hr(g,(a,s)=>{e[s]=a}),e},qt=function(g){let u=Math.floor(g*14.2);return u<128?u:0},B=function(){let g;return(g=self==null?void 0:self.debugMode)!=null?g:!1},ir=function(g){let u=(g.length+1)*3>>2,e=new Uint8Array(u),a=g.length+3>>2;for(let s=0;s<a;s++){let l=s<<2,f=s*3,b=0;for(let y=0;y<4;y++)b<<=6,b|=g.charCodeAt(l+y)-32&63;e[f]=b>>16,e[f+1]=b>>8&255,e[f+2]=b&255}return e};let Ls="‚ô≠ùÑ´,ùÑ´,‚ô≠,,‚ôØ,ùÑ™,ùÑ™‚ôØ".split(",");let ge=[new Map,new Map];ge[0].set("base64",Oe.encode("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"));ge[0].set("base64url",Oe.encode("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"));ge[0].set("hex",Oe.encode("0123456789abcdef"));ge[0].set("ovm43",Oe.encode("0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_"));ge[0].set("radix64",Oe.encode("0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz+/"));ge[0].set("radix64url",Oe.encode("0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_"));ge[0].set("xx",Oe.encode("+-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz"));ge[0].set("xxurl",Oe.encode("_-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz"));ge[0].set("z64",Oe.encode("0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ+/"));ge[0].set("z64url",Oe.encode("0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ-_"));for(let[g,u]of ge[0]){let e=new Uint8Array(128).fill(255);for(let a=0;a<u.length;a++)e[u[a]]=a;switch(g){case"hex":{for(let a=10;a<16;a++)e[a+55]=a;break}default:e[9]=254,e[10]=254,e[12]=254,e[13]=254,e[32]=254,e[61]=254}ge[1].set(g,e)}console.debug(ge);let Gr=(g="base64",u,e=!1)=>{};self.bufferTo=Gr;O();let la={red:"#ff7986",orange:"#fca022",grYellow:"#c9e10a",green:"#c1ff0a",white:"#b7e5e3",blue:"#2280ff"},ca={black:"#000000",blue:"#0516bb",purple:"#48009a",inactive:22,medium:59,active:170,range:148},Vr=[[6,26],[7,35],[8,44],[9,53],[10,62],[11,71],[12,80],[13,89],[14,98],[15,107],[16,116],[17,125],[18,134],[19,143],[20,152],[21,161],[22,170]],Qt={},Xr="06,68,2a,16,aa,3b".split(",");for(let g in ca)Qt[g]=[],Xr.forEach(u=>{Qt[g].push(`${ca[g]}${u}`)});let da=[];for(let g of Vr)da.push([`${ca.black}${g[0].toString(16).padStart(2,"0")}`,`${ca.black}${g[1].toString(16).padStart(2,"0")}`]),g.push(g[1]-g[0]);let _s=`${la.orange}64`,Ns=`${la.green}64`,Hs=`${la.white}64`,Gs=`${la.red}64`,Vs=Qt.black[0],Xs=Qt.black[2],Fs=Qt.black[1];let q=["?","gm","gs","sc","xg","g2","mt32","doc","qy10","qy20","ns5r","x5d","05rw","k11","sg","sd","pa","krs","s90es","motif","cs6x","trin","an1x","cs1x"],Fr={gm2:"g2","mt-32":"mt32","c/m":"mt32",ag10:"05rw","ag-10":"05rw","05r/w":"05rw",x5:"05rw",x5dr:"x5d",gmega:"k11","kross 2":"krs","motif es":"motif","s90 es":"s90es",trinity:"trin","tr-rack":"trin"},Kr=["melodic","drum","menu"],Jt={"?":[0,0,120,0,0],gm:[0,0,120,0,0],gs:[0,0,128,0,0],sc:[0,0,128,0,0],xg:[0,0,127,0,0],g2:[0,0,120,0,0],mt32:[0,127,127,0,127],doc:[57,112,127,57,112],qy10:[57,113,127,57,113],qy20:[57,114,127,57,114],ns5r:[0,0,61,0,0],x5d:[82,0,62,56,0],"05rw":[81,0,62,56,0],k11:[0,0,122,0,0],sg:[0,0,122,0,0],sd:[97,0,105,0,0],pa:[0,0,120,121,0],krs:[121,0,120,0,0],s90es:[0,0,127,0,0],motif:[0,0,127,0,0],cs6x:[0,0,127,0,0],trin:[0,0,61,0,0],an1x:[36,3,127,0,0],cs1x:[0,0,127,63,0],cs2x:[0,0,127,63,0]},Yr=[9,25,41,57,73,89,105,121],zr=[0,3,81,84,88],nr={8:"Off",9:"On",10:"Note aftertouch",11:"cc",12:"pc",13:"Channel aftertouch",14:"Pitch"},ha={0:0,1:1,2:3,5:4},or={0:0,1:1,2:2,5:3},cr=[[0,24],[0,127],[0,127],[40,88],[0,127],[0,127]],xa=[36,37,48,49,52,53],pa=[20,21,22,23,24,25,26,28,29,30,31,36,37,48,49,52,53,64,65],lr={26:127,29:0,30:0,31:0,52:12,53:54},ht=[0,1,2,4,5,6,7,8,10,11,12,13,14,15,16,17,18,19,20,21,22,26,28,32,38,40,41,42,43,44,45,46,47,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,80,81,82,83,84,91,92,93,94,95,98,99,100,101,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157],Wr=[2,4,12,13,14,15,16,17,18,19,20,21,40,41,42,43,44,45,46,47,80,81,83,136,130,131,132,133,134,135,137,138,139,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157],qr=[33,102,99,32,100,8,9,10],dr=[0,16,25,40,32,64,24,48],Zt="reverb,chorus,delay,insert0,insert1,insert2,insert3,insert4".split(","),Me=[["VL",32,8,1],["SG",8,1,1],["DX",16,1,16],["AN",16,2,5],["PF",2,1,64],["DR",2,1,32],["PC",2,1,32],["AP",2,1,64]],S={};q.forEach((g,u)=>{S[g]=u});let T=[];ht.forEach((g,u)=>{T[g]=u});let we={length:pa.length};pa.forEach((g,u)=>{we[g]=u});let Qr={};Kr.forEach((g,u)=>{Qr[g]=u});let Jr=function(g){let u=[],e=0;return g==null||g.forEach(function(a,s){a===247?u.push(g.subarray(e,s)):a===240&&(e=s+1)}),u.length||u.push(g.subarray(0)),B()&&console.debug(u),u};let $a=8,E={port:$a,ch:$a<<4,chShift:Math.ceil(Math.log2($a))+4,cc:ht.length,nn:128,pl:512,tr:256,cmt:14,rpn:6,rpnt:4,nrpn:xa.length,ace:8,drm:8,dpn:pa.length,dnc:128,ext:3,efx:8,cvn:12,redir:32,vxPrim:3,invalidCh:255};E.chcc=E.cc*E.ch;let Le={bank0:255},Zr=new TextDecoder("l9"),G=new Uint16Array(E.ch),Rt=new Uint16Array(E.ch),jr=new Uint16Array(E.ch),fa=new Uint16Array(E.ch),es=new Uint16Array(E.ch),It=new Uint16Array(E.ch),hr=new Array(E.drm);for(let g=0;g<E.ch;g++)G[g]=g*E.cc,Rt[g]=g*E.rpn,jr[g]=g*E.nrpn,fa[g]=g*E.ace,es[g]=g*E.ext,It[g]=g*E.cvn;for(let g=0;g<E.drm;g++){hr[g]=new Uint16Array(E.dpn);let u=g*E.dpn*E.dnc;for(let e=0;e<E.dpn;e++)hr[g][e]=u+e*E.dnc}if(typeof(self==null?void 0:self.require)<"u")throw new Error("Environments supporting CommonJS is not supported.");let Pe,We,fr,ts=(fr=class{constructor(u){P(this,Pe,void 0);P(this,We,!0);A(this,"autoRealtime",!1);u&&this.attach(u)}detach(){M(this,Pe,void 0),M(this,We,!0),this.autoRealtime=!1}attach(u,e){if(typeof u<"u"&&typeof u.currentTime=="number")M(this,Pe,u),M(this,We,!1),this.autoRealtime=!0;else throw new TypeError("Not a valid time source.")}timeMs(){return typeof(performance==null?void 0:performance.now)=="function"?performance.now():Object.hasOwn(self,"Temporal")?Temporal.Now.instant().epochMilliseconds:Date.now()}get realtime(){return r(this,We)||typeof r(this,Pe)>"u"}set realtime(u){if(u)M(this,We,!0);else{if(typeof r(this,Pe)>"u")throw new TypeError("No attached time source is present.");M(this,We,!1)}}get currentTime(){return this.realtime||!r(this,Pe)?this.timeMs()*.001:r(this,Pe).currentTime}now(){return this.realtime||!r(this,Pe)?Math.floor(this.timeMs()):Math.round(r(this,Pe).currentTime*1e3)}},Pe=new WeakMap,We=new WeakMap,fr),H,ne,Ae,Re,Fe,Bt,as,jt,be,V,D,x,ie,_,ee,oe,Z,F,qe,_e,ft,ce,L,N,Dt,he,Ie,ye,ut,pt,Q,Lt,gt,ke,mt,Ut,Qe,Be,Ot,Je,j,U,Ne,ea,W,bt,_t,Sa,Ta,Ma,Pa,Ze,je,ta,Nt,Ce,K,aa,J,Ht,yt,Ee,He,et,le,Et,te,ra,ua,wt,kt,re,ve,De,Ct,vt,$t,ur,li=(ur=class extends oa{constructor(){super();P(this,Fe);A(this,"NOTE_IDLE",0);A(this,"NOTE_ATTACK",1);A(this,"NOTE_DECAY",2);A(this,"NOTE_SUSTAIN",3);A(this,"NOTE_HELD",4);A(this,"NOTE_RELEASE",5);A(this,"NOTE_SOSTENUTO_ATTACK",8);A(this,"NOTE_SOSTENUTO_DECAY",9);A(this,"NOTE_SOSTENUTO_SUSTAIN",10);A(this,"NOTE_SOSTENUTO_HELD",11);A(this,"NOTE_MUTED_RECOVERABLE",16);A(this,"CH_MELODIC",0);A(this,"CH_DRUMS",1);A(this,"CH_DRUM1",2);A(this,"CH_DRUM2",3);A(this,"CH_DRUM3",4);A(this,"CH_DRUM4",5);A(this,"CH_DRUM5",6);A(this,"CH_DRUM6",7);A(this,"CH_DRUM7",8);A(this,"CH_DRUM8",9);A(this,"DUMP_ALL",0);A(this,"DUMP_ONCE",1);A(this,"DUMP_MODE",2);A(this,"EXT_NONE",0);A(this,"EXT_VL",1);A(this,"EXT_DX",3);A(this,"VLBC_SYSTEM",0);A(this,"VLBC_BRTHEXPR",1);A(this,"VLBC_VELOINIT",2);A(this,"VLBC_VELOALL",3);A(this,"CH_INACTIVE",0);A(this,"CH_ACTIVE",1);A(this,"CH_DISABLED",2);A(this,"KARAOKE_NONE",0);A(this,"KARAOKE_TEXT",1);A(this,"KARAOKE_XF",2);P(this,H,0);P(this,ne,0);P(this,Ae,0);P(this,Re,new Array(11));P(this,jt,16);P(this,be,new Uint8Array(E.ch));P(this,V,new Uint8Array(E.ch));P(this,D,new Uint8Array(E.ch));P(this,x,new Uint8Array(E.chcc<<1));P(this,ie,new Uint8Array(E.ch*E.ace));P(this,_,new Uint8Array(E.ch*E.vxPrim));P(this,ee,new Uint8Array(E.ch*E.nn));P(this,oe,new Uint8Array(E.ch));P(this,Z,new Uint16Array(E.pl));P(this,F,new Uint8Array(E.pl));P(this,qe,new Int16Array(E.ch));P(this,_e,new Uint8Array(E.ch));P(this,ft,new Uint8Array(E.ch));P(this,ce,new Uint8Array(E.ch*E.ext));P(this,L,new Uint8Array(E.ch*E.rpn));P(this,N,new Uint8Array(E.ch*E.rpnt));P(this,Dt,new Int8Array(E.ch*xa.length));P(this,he,new Uint8Array(E.drm*E.dpn*E.dnc));P(this,Ie,new Uint8Array(E.drm*2));P(this,ye,new Uint8Array(E.efx*3));P(this,ut,new Uint8Array(E.ch));P(this,pt,new Uint8Array(E.ch*E.redir));P(this,Q,new Uint8Array(E.port));P(this,Lt,new Uint8Array(E.port));P(this,gt,new Uint8Array(E.ch));P(this,ke,new Uint8Array(E.ch));P(this,mt,new Uint8Array(E.ch*E.cvn));P(this,Ut,new Uint8Array(E.ch));P(this,Qe,new Uint8Array(128));P(this,Be,new Uint8Array(E.cmt*8));P(this,Ot,new Uint8Array(1024));P(this,Je,new Uint8Array(E.cmt*64));P(this,j,{});A(this,"clockSource",new ts);A(this,"modelEx",{xg:{map:0,varSys:!1,insPart:new Uint8Array(5)},yPlg:[],vl:{module:0,breath:1,voiceCh:E.invalidCh},sc:{showBar:!0,invBar:!1,invDisp:!1,peakHold:1},cs1x:{perfCh:0},kross:{chToggle:!1},sg:{convLastSyll:0,runLineLen:0,maxLineLen:32,splitMask:!1}});P(this,U,void 0);P(this,Ne,void 0);P(this,ea,void 0);P(this,W,100);P(this,bt,0);P(this,_t,500);P(this,Sa,0);P(this,Ta,0);P(this,Ma,32);P(this,Pa,!1);P(this,Ze,"");P(this,je,0);P(this,ta,0);P(this,Nt,0);P(this,Ce,!0);P(this,K,0);P(this,aa,void 0);P(this,J,!1);P(this,Ht,0);P(this,yt,new Array(E.ch));P(this,Ee,[]);P(this,He,new Uint8Array(E.ch));P(this,et,new Uint8Array(E.tr));A(this,"baseBank",new Ea("gm2","ns5r","xg","gs","sd","gmega","plg-vl","plg-pf","plg-dx","plg-an","plg-dr","plg-sg","kross","s90es","cs2x","pa"));A(this,"userBank",new Ea("gm2"));A(this,"initOnReset",!1);A(this,"aiEfxName","");A(this,"polyIndexShrink",!0);A(this,"polyIndexLatest",0);A(this,"polyIndexLast",0);A(this,"lcdHideBankInfo",!1);P(this,le,[]);P(this,Et,void 0);P(this,te,{nOff:(e,a)=>{let s=e*128+a,l=r(this,Z).lastIndexOf(s);if(l>-1)if(this.getChCc(e,64)>>6)r(this,F)[l]=this.NOTE_HELD,this.dispatchEvent("note",{part:e,note:a,velo:r(this,ee)[s],state:this.NOTE_HELD});else if(this.getChCc(e,66)>>6&&r(this,F)[l]===this.NOTE_SOSTENUTO_SUSTAIN)r(this,F)[l]=this.NOTE_SOSTENUTO_HELD,this.dispatchEvent("note",{part:e,note:a,velo:r(this,ee)[s],state:this.NOTE_SOSTENUTO_HELD});else{r(this,Z)[l]=0,r(this,ee)[s]=0,r(this,F)[l]=this.NOTE_IDLE;let f=this.getExt(e)[1];(f===this.VLBC_VELOINIT||f===this.VLBC_VELOALL)&&this.setChCc(e,129,0),this.dispatchEvent("note",{part:e,note:a,velo:0,state:this.NOTE_IDLE})}if(r(this,oe)[e]){for(let f=this.polyIndexLast;f>=0;f--)if(r(this,Z)[f]>>7===e&&r(this,F)[f]!==0){r(this,F)[f]===this.NOTE_MUTED_RECOVERABLE&&(r(this,F)[f]=this.NOTE_SUSTAIN);break}}if(this.polyIndexShrink&&this.polyIndexLast>0){let b=!1,y=this.polyIndexLast-8,w=this.polyIndexLast;for(;w>y&&r(this,F)[w]===0;w--)b=!0;b&&(this.polyIndexLast=w,r(this,F)[w+1]!==0&&console.error("Polyphonic slot shrinking edge case."))}},nOn:(e,a,s)=>{let l=e*128+a,f=0;if(r(this,oe)[e])for(let b=0;b<=this.polyIndexLast;b++)r(this,Z)[b]>>7===e&&r(this,F)[b]!==0&&(r(this,F)[b]=this.NOTE_MUTED_RECOVERABLE);for(;r(this,F)[f]>0&&r(this,Z)[f]!==l;)f++;if(f<E.pl){r(this,Z)[f]=l,r(this,ee)[l]=s,r(this,F)[f]=this.NOTE_SUSTAIN,r(this,_e)[e]<s&&(r(this,_e)[e]=s);let b=this.getExt(e)[1];(b===this.VLBC_VELOINIT||b===this.VLBC_VELOALL)&&this.setChCc(e,129,s),this.dispatchEvent("note",{part:e,note:a,velo:s,state:this.NOTE_SUSTAIN}),this.polyIndexLatest=f+1,f>this.polyIndexLast&&(this.polyIndexLast=f)}else console.error("Polyphony exceeded.")},nAt:(e,a,s)=>{},cAt:(e,a)=>{},hoOf:e=>{r(this,F).forEach((a,s)=>{if(a===this.NOTE_HELD){let l=r(this,Z)[s],f=l>>7;e===f&&(r(this,F)[s]=this.NOTE_IDLE,r(this,Z)[s]=0,r(this,ee)[l]=0,this.dispatchEvent("note",{part:e,note:l&127,velo:0,state:this.NOTE_IDLE}))}})},soOn:e=>{r(this,F).forEach((a,s)=>{let l;switch(a){case this.NOTE_ATTACK:{l=this.NOTE_SOSTENUTO_ATTACK;break}case this.NOTE_DECAY:{l=this.NOTE_SOSTENUTO_DECAY;break}case this.NOTE_SUSTAIN:{l=this.NOTE_SOSTENUTO_SUSTAIN;break}}if(l){r(this,F)[s]=l;let f=r(this,Z)[s];this.dispatchEvent("note",{part:e,note:f&127,velo:r(this,ee)[f],state:l})}})},soOf:e=>{r(this,F).forEach((a,s)=>{if(a===this.NOTE_SOSTENUTO_HELD){let l=r(this,Z)[s],f=l>>7;e===f&&(r(this,F)[s]=this.NOTE_IDLE,r(this,Z)[s]=0,r(this,ee)[l]=0,this.dispatchEvent("note",{part:e,note:l&127,velo:0,state:this.NOTE_IDLE}))}})},ano:e=>{r(this,Z).forEach(a=>{let s=a>>7,l=a&127;a===0&&r(this,ee)[0]===0||s===e&&r(this,te).nOff(s,l)})}});P(this,ra,{8:function(e){let a=e.channel,s=e.data[0];r(this,te).nOff(a,s)},9:function(e){let a=e.channel,s=this;if(s.getChModeId(a)===S.xg&&r(s,D)[a]>1){let b=s.getChDrumFirstWrite(a);b[0]&&b[1]!==E.invalidCh&&!r(s,be)[a]&&(s.copyChSetup(b[1],a),s.pushChPrimitives(a),console.debug(`Part CH${a+1} copied from CH${b[1]+1}.`))}s.setChActive(a,1);let l=e.data[0],f=e.data[1];f>0?r(s,te).nOn(a,l,f):r(s,te).nOff(a,l)},10:function(e){let a=e.channel,s=a*128+e.data[0];r(this,Z).indexOf(s)>-1&&(r(this,ee)[s]=data[1],this.getExt(a)[1]===this.VLBC_VELOALL&&this.setChCc(a,129,data[1]),this.dispatchEvent("note",{part:a,note:e.data[0],velo:e.data[1],state:this.NOTE_SUSTAIN}))},11:function(e){let a=e.channel,s=this,l=r(s,yt)[a],f=l[e.data[0]];f&&(e.data[0]=f),[0,32].indexOf(e.data[0])>-1&&(()=>{switch(r(this,H)){case S.s90es:case S.motif:{if(e.data[0]===0){[0,63].indexOf(e.data[1])>-1&&s.setChActive(a,1);break}e.data[1]&&s.setChActive(a,1);break}default:break}})();let b=a*E.ext,y=s.getChModeId(a);switch(e.data[0]){case 96:return;case 97:return;case 120:return;case 121:{r(this,te).ano(a),r(this,qe)[a]=0,s.resetChCc(a,1,0),s.resetChCc(a,5,0),s.resetChCc(a,64,0),s.resetChCc(a,65,0),s.resetChCc(a,66,0),s.resetChCc(a,67,0),s.resetChCc(a,11,127),s.resetChCc(a,101,127),s.resetChCc(a,100,127),s.resetChCc(a,99,127),s.resetChCc(a,98,127);return}case 123:{r(this,te).ano(a);return}case 124:{r(this,te).ano(a);return}case 125:{r(this,te).ano(a);return}case 126:{r(this,oe)[a]=1,r(this,te).ano(a);return}case 127:{r(this,oe)[a]=0,r(this,te).ano(a);return}}if(T[e.data[0]]===void 0)console.warn(`cc${e.data[0]} is not accepted.`);else{switch(Wr.indexOf(e.data[0])>-1&&this.allocateAce(a,e.data[0]),e.data[0]){case 0:{switch(B()&&console.debug(`${q[r(s,H)]}, CH${a+1}: ${e.data[1]}`),r(this,H)===0?e.data[1]<48?(r(s,D)[a]>0&&(e.data[1]=s.getChPrimitive(a,1,!1),e.data[1]=Jt.gs[2],console.debug(`Forced channel ${a+1} to stay drums.`)),e.data[1]>0&&(console.debug(`Roland GS detected with MSB: ${e.data[1]}`),s.switchMode("gs",0))):e.data[1]===56||e.data[1]===62?s.switchMode(r(s,U).x5===82?"x5d":"05rw",0):e.data[1]===63?s.switchMode(q[r(s,U).ds],0):e.data[1]===64||e.data[1]===127?s.switchMode("xg",0):(e.data[1]===120||e.data[1]===121)&&s.switchMode("g2",0):r(s,H)===S.gs||r(s,H)===S.sc?e.data[1]<56&&r(this,D)[a]>0&&(e.data[1]=this.getChPrimitive(a,1,!1),e.data[1]=Jt.gs[2],console.debug(`Forced channel ${a+1} to stay drums.`)):r(this,H)===S.gm&&(e.data[1]<48?r(this,D)[a]>0&&(e.data[1]=Jt.gs[2],this.switchMode("gs",1),console.debug(`Forced channel ${a+1} to stay drums.`)):(e.data[1]===64||e.data[1]===127)&&this.switchMode("xg",1)),r(this,H)){case S.xg:{[79,95,120,126,127].indexOf(e.data[1])>-1?r(this,D)[a]===0&&(this.setChType(a,this.CH_DRUM2),console.debug(`CH${a+1} set to drums by MSB.`)):r(this,D)[a]>0&&(this.setChType(a,this.CH_MELODIC),console.debug(`CH${a+1} set to melodic by MSB.`)),[33,81,97].indexOf(e.data[1])>-1?r(this,ce)[b]=this.EXT_VL:[35,67,83,99].indexOf(e.data[1])>-1?r(this,ce)[b]=this.EXT_DX:r(this,ce)[b]=this.EXT_NONE;break}case S["05rw"]:case S.x5d:case S.ns5r:{[61,62,126,127].indexOf(e.data[1])>-1?r(this,D)[a]===this.CH_MELODIC&&(this.setChType(a,this.CH_DRUM2),console.debug(`CH${a+1} set to drums by MSB.`)):r(this,D)[a]!==this.CH_MELODIC&&(this.setChType(a,this.CH_MELODIC),console.debug(`CH${a+1} set to melodic by MSB.`));break}case S.sd:{[104,105,106,107,120].indexOf(e.data[1])>-1?r(this,D)[a]===0&&(this.setChType(a,this.CH_DRUM2),console.debug(`CH${a+1} set to drums by MSB.`)):r(this,D)[a]>0&&(this.setChType(a,this.CH_MELODIC),console.debug(`CH${a+1} set to melodic by MSB.`));break}case S.g2:{e.data[1]===120?r(this,D)[a]===0&&(this.setChType(a,this.CH_DRUMS),console.debug(`CH${a+1} set to drums by MSB.`)):r(this,D)[a]>0&&(this.setChType(a,this.CH_MELODIC),console.debug(`CH${a+1} set to melodic by MSB.`));break}}break}case 2:{this.getExt(a)[1]===this.VLBC_BRTHEXPR&&this.setChCc(a,129,e.data[1]);break}case 6:{if(r(this,ft)[a]){[S.xg,S.gs,S.sc,S.ns5r].indexOf(r(this,H))<0&&console.warn(`NRPN commits are not available under "${q[r(this,H)]}" mode, even when they are supported in Octavia.`);let w=this.getChCc(a,99),$=this.getChCc(a,98);if(w===1){let C=qr.indexOf($);if(C>-1)this.setChCc(a,71+C,e.data[1]),B()&&console.debug(`Redirected NRPN 1 ${$} to cc${71+C}.`),this.dispatchEvent("cc",{part:a,cc:71+C,data:e.data[1]});else{let t=xa.indexOf($);t>-1?r(this,Dt)[a*10+t]=e.data[1]-64:console.warn(`NRPN 0x01${$.toString(16).padStart(2,"0")} is not supported.`),B()&&console.debug(`CH${a+1} voice NRPN ${$} commit`)}}else{if(pa.indexOf(w)<0){let t=`NRPN 0x${w.toString(16).padStart(2,"0")}${$.toString(16).padStart(2,"0")} `;console.warn(w===127?`${t}is not necessary. Consider removing it.`:`${t}is not supported.`)}else{let t=r(this,D)[a]-2;t<0?console.warn(`CH${a+1} cannot accept drum NRPN as type ${Wt[r(this,D)[a]]}.`):r(this,he)[(t*E.dpn+we[w])*E.dnc+$]=e.data[1]}B()&&console.debug(`CH${a+1} (${Wt[r(this,D)[a]]}) drum NRPN ${w} commit`)}}else{let w=ha[this.getChCc(a,100)],$=or[this.getChCc(a,100)];if(this.getChCc(a,101)===0&&w!==void 0)switch(B()&&console.debug(`CH${a+1} RPN 0 ${this.getChCc(a,100)} commit: ${e.data[1]}`),e.data[1]=Math.min(Math.max(e.data[1],cr[w][0]),cr[w][1]),r(this,L)[a*E.rpn+w]=e.data[1],r(this,N)[a*E.rpnt+$]=1,y){case S.xg:case S.gs:case S.sc:case S.mt32:case S.s90es:case S.motif:case S.cs1x:case S.cs6x:{switch(this.getChCc(a,100)){case 1:case 2:{this.dispatchEvent("pitch",{part:a,pitch:this.getPitchShift(a)});break}}break}default:this.dispatchEvent("pitch",{part:a,pitch:this.getPitchShift(a)})}}break}case 32:{switch(B()&&console.debug(`${q[r(this,H)]}, CH${a+1} LSB: ${e.data[1]}`),r(this,H)){case S.s90es:case S.motif:{this.setChType(a,[32,40].indexOf(e.data[1])>-1?this.CH_DRUMS:this.CH_MELODIC,r(this,H),!0);break}}this.getExt(a)[0],this.EXT_DX;break}case 38:{if(!r(this,ft)[a]){let w=ha[this.getChCc(a,100)],$=or[this.getChCc(a,100)];this.getChCc(a,101)===0&&w!==void 0&&(r(this,L)[a*E.rpn+w+1]=e.data[1],r(this,N)[a*E.rpnt+$]=1)}break}case 64:{e.data[1]<64&&r(this,te).hoOf(a);break}case 66:{e.data[1]>>6?r(this,te).soOn(a):r(this,te).soOf(a);break}case 98:case 99:{r(this,ft)[a]=1;break}case 100:case 101:{r(this,ft)[a]=0;break}}this.setChCc(a,e.data[0],e.data[1]),this.dispatchEvent("cc",{part:a,cc:e.data[0],data:e.data[1]})}s.getChModeId(a)===S.xg&&r(s,D)[a]&&s.setDrumFirstWrite(a)},12:function(e){let a=e.channel,s=this;switch(r(s,H)){case S.s90es:case S.motif:{e.data&&s.setChActive(a,1);break}default:s.setChActive(a,1)}let l=G[a];switch(s.getExt(a)[0]){case s.EXT_VL:break}r(s,_)[a]=e.data,r(s,ke)[a]=0,s.pushChPrimitives(a),B()&&console.debug(`T:${e.track} C:${a} P:${e.data}`),s.getChModeId(a)===S.xg&&r(s,D)[a]&&s.setDrumFirstWrite(a)},13:function(e){let a=this,s=e.channel;r(this,Z).forEach(function(l){let f=l>>7;s===f&&(r(a,ee)[l]=e.data,a.dispatchEvent("note",{part:s,note:l&127,velo:e.data,state:a.NOTE_SUSTAIN}))})},14:function(e){let a=e.channel;r(this,qe)[a]=e.data[1]*128+e.data[0]-8192,this.dispatchEvent("pitch",{part:a,pitch:this.getPitchShift(a)})},15:function(e){Jr(e.data).forEach(a=>{let s=a[0],l=a[1];M(this,Ht,a.length),(r(this,ua)[s]||function(){console.debug(`Unknown manufacturer ${s}.`)})(l,a.subarray(2),e.track)})},248:function(e){},250:function(e){},251:function(e){},252:function(e){},254:function(e){},255:function(e){(r(this,le)[e.meta]||function(s,l,f){}).call(this,e.data,e.track,e.meta),e.meta!==32&&M(this,bt,0);let a=zr.indexOf(e.meta)>-1;if(B()&&console.debug(e),a)return e.reply="meta",e}});P(this,ua,{64:(e,a,s)=>{r(this,Ct).run(a,s,e)},65:(e,a,s)=>{if(a[0]<16)if(a[1]===72){let l=a[a.length-1],f=dt(a.subarray(3,a.length-1));l===f?r(this,ve).run(a.subarray(0,a.length-1),s,e):console.warn(`Bad SD checksum ${l} - should be ${f}.`)}else r(this,ve).run(a,s,e);else{let l=a[a.length-1],f=dt(a.subarray(2,a.length-1));l===f?r(this,ve).run(a.subarray(0,a.length-1),s,e):console.warn(`Bad GS checksum ${l} - should be ${f}.`)}},66:(e,a,s)=>{r(this,De).run(a,s,e)},67:(e,a,s)=>{switch(e>>4){case 0:{let l=0;for(;a[l]===127&&l<4;)l++;let f=a[1+l]<<7|a[2+l];if(f+7+l!==a.length){console.warn(`Yamaha bulk dump length mismatch! Expected ${a.length-7-l}, received ${f}.`),console.debug(a);break}let b=dt(a.subarray(1+l,a.length-1)),y=a[a.length-1];if(a[a.length-1]>>7)console.warn(`Yamaha bulk dump checksum invalid! Expected ${b}, received ${y}:
`),console.debug(a);else if(b!==y)console.warn(`Yamaha bulk dump checksum mismatch! Expected ${b}, received ${y}:
`),console.debug(a);else{let w=a.slice(2,a.length-1);for(let $=0;$<=l;$++)w[$]=a[$];r(this,re).run(w,s,e&15)}break}case 1:{r(this,re).run(a,s,e&15);break}case 2:{console.warn("Octavia doesn't yet support Yamaha bulk dump requests.");break}case 3:{console.warn("Octavia doesn't yet support Yamaha parameter requests.");break}case 7:{switch(e&15){case 14:{let l=new Uint8Array(a.length+1);l[0]=126,l.set(a,1),r(this,re).run(l,s,0);break}default:console.warn(`Unknown Yamaha special SysEx type: ${e}.`)}break}default:console.warn(`Unknown Yamaha SysEx type: ${e>>4}.`)}},68:(e,a,s)=>{r(this,$t).run(a,s,e)},71:(e,a,s)=>{r(this,vt).run(a,s,e)},126:(e,a,s)=>{r(this,wt).run(a,s,e)},127:(e,a,s)=>{this.switchMode("gm",0),r(this,kt).run(a,s,e)}});P(this,wt,void 0);P(this,kt,void 0);P(this,re,void 0);P(this,ve,void 0);P(this,De,void 0);P(this,Ct,void 0);P(this,vt,void 0);P(this,$t,void 0);let e=this;for(let t=0;t<10;t++)r(e,Re)[t]=new Uint8Array(256);r(e,Re)[10]=new Uint8Array(512),M(e,Et,new Se),M(e,U,{x5:82,ds:S.krs,smotif:S.s90es,gs:4,sc:3,gm:S.gm,g2:S.g2}),M(e,Ne,{dumpLimit:e.DUMP_MODE}),M(e,ea,new Proxy(r(e,Ne),{set:()=>{}}));for(let t in Jt){let n=S[t];n===void 0?console.debug(`SubDB build error: "${t}" does not exist`):r(e,j)[n]=new Uint8Array(Jt[t])}for(let t of Me)e.modelEx.yPlg.push(new Uint8Array(t[1]));e.userBank.strictMode=!0,e.userBank.load(`MSB	PRG	LSB	NME
062	000	000	
122	000	000	
122	001	000	
122	002	000	
122	003	000	
122	004	000	
122	005	000	
122	006	000	`),e.addEventListener("metacommit",function(t){let h,i;let{data:n}=t;((h=r(e,Ee)[0])==null?void 0:h.type)===n.type&&((i=r(e,Ee)[0])!=null&&i.amend)?(r(e,Ee)[0].amend=n.amend,r(e,Ee)[0].data+=n.data):r(e,Ee).unshift(n)}),r(e,le)[1]=function(t){let n,h,i,o;switch(t=t.replaceAll(`\r
`,`
`).replaceAll("\r",`
`),t.substring(0,2)){case"@I":{M(e,K,e.KARAOKE_TEXT),e.dispatchEvent("metacommit",{type:"Kar.Info",data:(n=t.substring(2))==null?void 0:n.trimStart()});break}case"@K":{M(e,K,e.KARAOKE_TEXT);let c=t.substring(2);c!=="MIDI KARAOKE FILE"&&e.dispatchEvent("metacommit",{type:"Kar.Mode",data:c==null?void 0:c.trimStart()}),console.debug(`Karaoke mode active: ${c}`);break}case"@L":{M(e,K,e.KARAOKE_TEXT),e.dispatchEvent("metacommit",{type:"Kar.Lang",data:(h=t.substring(2))==null?void 0:h.trimStart()});break}case"@T":{M(e,K,e.KARAOKE_TEXT),e.dispatchEvent("metacommit",{type:"KarTitle",data:(i=t.substring(2))==null?void 0:i.trimStart()});break}case"@V":{M(e,K,e.KARAOKE_TEXT),e.dispatchEvent("metacommit",{type:"Kar.Ver.",data:(o=t.substring(2))==null?void 0:o.trimStart()});break}case"Mi":{if(t.substring(2,16)==="dStamp-1.00: 0"){let c=t.length;for(let m=t.length;m>0;m--)if((t.charCodeAt(m-1)>>5)+1>>1===1){c=m;break}let d=t.substring(16,c);e.dispatchEvent("metacommit",{type:"MidStamp",data:ir(d)})}else t.split(`
`).forEach((c,d)=>{e.dispatchEvent("metacommit",{type:"Cmn.Text",data:c,mask:d!==0})});break}case"XF":{let c=t.slice(2).split(":");switch(c[0]){case"hd":{c.slice(1).forEach((d,m)=>{d.length&&e.dispatchEvent("metacommit",{type:["XfSngDte","XfSngRgn","XfSngCat","XfSongBt","XfSngIns","XfSngVoc","XfSngCmp","XfSngLrc","XfSngArr","XfSngPer","XfSngPrg","XfSngTag"][m],data:d})});break}case"ln":{c.slice(1).forEach((d,m)=>{d.length&&e.dispatchEvent("metacommit",{type:["XfKarLng","XfKarNme","XfKarCmp","XfKarLrc","XfKarArr","XfKarPer","XfKarPrg"][m],data:d})});break}default:e.dispatchEvent("metacommit",{type:"XfUnData",data:t})}break}default:switch(r(e,K)){case e.KARAOKE_TEXT:{switch(t[0]){case"\\":{e.dispatchEvent("metacommit",{type:"KarLyric",data:"",amend:!1}),e.dispatchEvent("metacommit",{type:"KarLyric",data:t.substring(1),amend:!0});break}case"/":{e.dispatchEvent("metacommit",{type:"KarLyric",data:"",mask:!0,amend:!1}),e.dispatchEvent("metacommit",{type:"KarLyric",data:t.substring(1),mask:!0,amend:!0});break}default:e.dispatchEvent("metacommit",{type:"KarLyric",data:t,amend:!0})}break}default:t.split(`
`).forEach((c,d)=>{e.dispatchEvent("metacommit",{type:"Cmn.Text",data:c,mask:d!==0})})}}},r(e,le)[2]=function(t){e.dispatchEvent("metacommit",{type:"Copyrite",data:t})},r(e,le)[3]=function(t,n){n<1&&r(e,bt)<1&&e.dispatchEvent("metacommit",{type:"TrkTitle",data:t})},r(e,le)[4]=function(t,n){e.dispatchEvent("metacommit",{type:"Instrmnt",data:t})},r(e,le)[5]=function(t){switch(r(e,K)){case e.KARAOKE_XF:{let n="";for(let h of t)switch(h){case"^":case"%":{n+=" ";break}case">":{n+="	";break}case"<":{e.dispatchEvent("metacommit",{type:"KarLyric",data:n,mask:r(e,J),amend:!1}),n="",M(e,J,!1);break}case"/":{e.dispatchEvent("metacommit",{type:"KarLyric",data:n,mask:!1,amend:!1}),n="",M(e,J,!0);break}default:n+=h}n.length>0&&(e.dispatchEvent("metacommit",{type:"KarLyric",data:n,mask:r(e,J),amend:!0}),M(e,J,!1));break}default:{let n=0,h=!0,i=t.length-1;for(;h&&n<8;)switch(t.charCodeAt(n)){case 32:{n++;break}default:h=!1}switch(n>0&&(e.dispatchEvent("metacommit",{type:"C.Lyrics",data:t.substring(0,n),amend:!0,mask:r(e,J),untimed:!0}),M(e,J,!1)),t.charCodeAt(i)){case 10:{e.dispatchEvent("metacommit",{type:"C.Lyrics",data:t.substring(n,i),amend:!1,mask:r(e,J)}),M(e,J,!1);break}case 11:case 13:{e.dispatchEvent("metacommit",{type:"C.Lyrics",data:t.substring(n,i),amend:!1,mask:r(e,J)}),M(e,J,!0);break}case 32:{e.dispatchEvent("metacommit",{type:"C.Lyrics",data:t.substring(n,i),amend:!0,mask:r(e,J)}),e.dispatchEvent("metacommit",{type:"C.Lyrics",data:" ",amend:!0,mask:!1,untimed:!0}),M(e,J,!1);break}default:t.trim()===""?console.info("Blank line? Shouldn't happen."):e.dispatchEvent("metacommit",{type:"C.Lyrics",data:t,amend:!0,mask:r(e,J)}),M(e,J,!1)}break}}},r(e,le)[6]=function(t){e.dispatchEvent("metacommit",{type:"C.Marker",data:t})},r(e,le)[7]=function(t){switch(t[0]){case"$":{if(t.substring(1,5)==="Lyrc"){M(e,K,e.KARAOKE_XF);let n=t.substring(6).split(":"),h=n[0].replaceAll(" ","").split(",");h.forEach((o,c,d)=>{d[c]=parseInt(o)-1});let i=Ja[n[2].substring(0,2).toLowerCase()];e.dispatchEvent("metacommit",{type:"XfMeloCh",data:`CH${n[0].replaceAll(" ","").split(",").join(", CH")}`,parsed:h}),e.dispatchEvent("metacommit",{type:"XfLyrOff",data:n[1],parsed:parseInt(n[1])}),e.dispatchEvent("metacommit",{type:"XfLyrEnc",data:i[1],parsed:i[0]}),M(e,J,!1)}else e.dispatchEvent("metacommit",{type:"CuePoint",data:t});break}case"#":{e.dispatchEvent("metacommit",{type:"XfScneNo",data:t.substring(1)});break}case"&":{t.length===2?(e.dispatchEvent("metacommit",{type:"XfSngPrt",data:Za[t[1]]||`Unknown "${t[1]}"`}),M(e,J,!1)):e.dispatchEvent("metacommit",{type:"CuePoint",data:t});break}default:e.dispatchEvent("metacommit",{type:"CuePoint",data:t})}},r(e,le)[32]=function(t){M(e,bt,t[0]+1)},r(e,le)[33]=function(t,n){B()&&console.debug(`Track ${n} requests assigning to port ${t}.`),r(e,et)[n]=t+1},r(e,le)[81]=function(t,n){M(e,_t,t/1e3)},r(e,le)[127]=function(t,n){r(e,Et).run(t,n)},r(e,Et).default=function(t){let n=[];for(let h=0;h<8&&h<t.length;h++)n.push(t[h].toString(16).padStart(2,"0").toUpperCase());console.warn(`Unrecognized implementation-specific byte sequence: ${n.join(" ")}${t.length>8?" ...":""}
%o`,t)},r(e,Et).add([67,0,1],(t,n)=>{B()&&console.debug(`XGworks requests assigning track ${n} to port ${t[0]}.`),r(e,et)[n]=t[0]+1}).add([67,123,1],(t,n)=>{let h=[];for(let i=0;i<t.length;i+=2){let o=t[i]>>4,c=t[i]&15;if(o<7&&c&&c<8){let d=new Uint8Array(5);d[0]=c-1,d[1]=o-3<<2,d[2]=t[i|1],h.push(d)}}e.dispatchEvent("metacommit",{type:"ChordCtl",src:"yxf",data:h}),console.debug("Yamaha XF chord data: %o",h)}).add([67,123,2],(t,n)=>{let i;let h=new Uint8Array(2);h[0]=t[0]&15,h[1]=t[0]>>4,e.dispatchEvent("metacommit",{type:"RhrslMrk",src:"yxf",data:h}),console.debug(`Yamaha XF rehearsal mark: ${(i=["Intro","Ending","Fill-in"][h[0]])!=null?i:String.fromCharCode(62+h[0])}${"'".repeat(h[1])} %o`,h)}).add([67,123,96],(t,n)=>{let h=[0,0];t.subarray(1,3).forEach(i=>{h[0]=h[0]<<7,h[0]|=i&127}),t.subarray(3,5).forEach(i=>{h[1]=h[1]<<7,h[1]|=i&127}),e.dispatchEvent("metacommit",{type:"YStyleId",data:h}),console.debug(`Yamaha style ID: model ${h[0].toString(16)}, style ${h[1]+1}`)}),M(e,wt,new Se("universal non-realtime")),M(e,kt,new Se("universal realtime")),M(e,re,new Se("Yamaha")),M(e,ve,new Se("Roland")),M(e,De,new Se("Korg")),M(e,Ct,new Se("Kawai")),M(e,vt,new Se("Akai")),M(e,$t,new Se("Casio"));let a=new Se("DX7+ Dump"),s=function(t){let n=[];for(let h=0;h<8&&h<t.length;h++)n.push(t[h].toString(16).padStart(2,"0").toUpperCase());console.info(`Unrecognized SysEx in "${this.name}" set: ${n.join(" ")}${t.length>8?" ...":""}
%o`,t)};r(e,wt).default=s,r(e,kt).default=s,r(e,re).default=s,r(e,ve).default=s,r(e,De).default=s,r(e,Ct).default=s,r(e,vt).default=s,r(e,$t).default=s,a.default=s,r(e,wt).add([9],(t,n,h)=>{e.switchMode(["gm","?","g2"][t[0]-1],2),e.setPortMode(e.getTrackPort(n),1,[S.gm,S["?"],r(e,U).g2][t[0]-1]),M(e,K,r(e,K)||e.KARAOKE_NONE),console.info(`MIDI reset: ${["GM","Init","GM2"][t[0]-1]}`),t[0]===2&&e.init()}),r(e,kt).add([4,1],(t,n,h)=>{e.invokeSysExIndicator(),M(e,W,((t[1]<<7)+t[0])/16383*100),e.dispatchEvent("mastervolume",r(e,W))}).add([4,3],(t,n,h)=>((t[1]<<7)+t[0]-8192)/8192).add([4,4],(t,n,h)=>t[1]-64).add([4,5],(t,n,h)=>{e.invokeSysExIndicator();let i=t[0],o=t[1],c=t[2],d=3,m=d+(i<<1),p=m+o;if(i!==1){console.error(`Unsupported GM2 global parameter set: slotpath length too long (${i})!
`,t);return}let k=0,v=0,I=0;switch(t.subarray(d,m).forEach(R=>{k=k<<7,k|=R}),B()&&console.debug(`GM2 global parameter: (${t.subarray(3,m)}; p: ${v}, v: ${I})`),k){case 129:{v===0&&(e.setEffectType(0,52,I),e.pushEffectType(0));break}case 130:{v===0&&(e.setEffectType(1,52,I|16),e.pushEffectType(1));break}default:B()&&console.debug("GM2 global paramater slot path unknown.")}}),r(this,re).add([76,0,0],(t,n,h)=>{switch(t[0]){case 125:{e.initDrums(),console.info(`XG drum setup reset on drum kit ${t[1]}.`);break}case 126:{e.switchMode("xg",2),e.setPortMode(e.getTrackPort(n),4,S.xg),e.modelEx.vl.module=0,M(e,K,r(e,K)||e.KARAOKE_NONE),console.info("MIDI reset: XG");break}default:{e.invokeSysExIndicator();let i=[0,0,0,0],o=(c,d)=>{i[d]=c};if(t.subarray(1).forEach((c,d)=>{let m=d+t[0];([o,o,o,o,p=>{M(this,W,p*129/16383*100),e.dispatchEvent("mastervolume",r(e,W))},p=>{},p=>{}][m]||(()=>{}))(c,d)}),t[0]<4){let c=0;i.forEach(d=>{c=c<<4,c+=d}),c-=1024,console.debug(`Master tune: ${c}`)}}}}).add([76,2,1],(t,n,h)=>{e.invokeSysExIndicator();let i="XG ";t[0]<32?(i+="reverb ",t.subarray(1).forEach((o,c)=>{([d=>{e.setEffectTypeRaw(0,!1,d),console.info(`${i}main type: ${zt[d]}`),e.pushEffectType(0)},d=>{e.setEffectTypeRaw(0,!0,d),console.debug(`${i}sub type: ${d+1}`),e.pushEffectType(0)},d=>{console.debug(`${i}time: ${Ya(d)}s`)},d=>{console.debug(`${i}diffusion: ${d}`)},d=>{console.debug(`${i}initial delay: ${d}`)},d=>{console.debug(`${i}HPF cutoff: ${At[d]}Hz`)},d=>{console.debug(`${i}LPF cutoff: ${At[d]}Hz`)},d=>{console.debug(`${i}width: ${d}`)},d=>{console.debug(`${i}height: ${d}`)},d=>{console.debug(`${i}depth: ${d}`)},d=>{console.debug(`${i}wall type: ${d}`)},d=>{console.debug(`${i}dry/wet: ${d}`)},d=>{console.debug(`${i}send: ${me(d)}dB`)},d=>{console.debug(`${i}pan: ${d-64}`)},!1,!1,d=>{console.debug(`${i}delay: ${d}`)},d=>{console.debug(`${i}density: ${d}`)},d=>{console.debug(`${i}balance: ${d}`)},d=>{},d=>{console.debug(`${i}feedback: ${d}`)},d=>{}][t[0]+c]||function(){console.warn(`Unknown XG reverb address: ${t[0]}.`)})(o)})):t[0]<64?(i+="chorus ",t.subarray(1).forEach((o,c)=>{([d=>{e.setEffectTypeRaw(1,!1,d),console.info(`${i}main type: ${zt[d]}`),e.pushEffectType(1)},d=>{e.setEffectTypeRaw(1,!0,d),console.debug(`${i}sub type: ${d+1}`),e.pushEffectType(1)},d=>{console.debug(`${i}LFO: ${Ka[d]}Hz`)},d=>{},d=>{console.debug(`${i}feedback: ${d}`)},d=>{console.debug(`${i}delay offset: ${za(d)}ms`)},d=>{},d=>{console.debug(`${i}low: ${At[d]}Hz`)},d=>{console.debug(`${i}low: ${d-64}dB`)},d=>{console.debug(`${i}high: ${At[d]}Hz`)},d=>{console.debug(`${i}high: ${d-64}dB`)},d=>{console.debug(`${i}dry/wet: ${d}`)},d=>{console.debug(`${i}send: ${me(d)}dB`)},d=>{console.debug(`${i}pan: ${d-64}`)},d=>{console.debug(`${i}to reverb: ${me(d)}dB`)},!1,d=>{},d=>{},d=>{},d=>{console.debug(`${i}LFO phase diff: ${(d-64)*3}deg`)},d=>{console.debug(`${i}input mode: ${d?"stereo":"mono"}`)},d=>{}][t[0]-32+c]||function(){console.warn(`Unknown XG chorus address: ${t[0]}.`)})(o)})):t[0]<86?(i+="variation ",t.subarray(1).forEach((o,c)=>{([d=>{e.setEffectTypeRaw(2,!1,d),console.info(`${i}main type: ${zt[d]}`),e.pushEffectType(2)},d=>{e.setEffectTypeRaw(2,!0,d),console.debug(`${i}sub type: ${d+1}`),e.pushEffectType(2)}][t[0]-64+c]||function(){})(o)})):t[0]<97?(i+="variation ",t.subarray(1).forEach((o,c)=>{[d=>{console.debug(`${i}send: ${me(d)}dB`)},d=>{console.debug(`${i}pan: ${d-64}`)},d=>{console.debug(`${i}to reverb: ${me(d)}dB`)},d=>{console.debug(`${i}to chorus: ${me(d)}dB`)},d=>{e.modelEx.xg.varSys=!!d,console.debug(`${i}connection: ${d?"system":"insertion"}`)},d=>{if(e.modelEx.xg.varSys){console.warn(`${i}effect is applied system-wide. Setting its effective channel to CH${d+1} will not have any effect.`);return}if(d<64){let m=e.chRedir(d,n,!0);e.setXgChEffectSink(m,2),console.debug(`${i}channel: CH${d+1} (CH${m+1})`)}else e.setXgChEffectSink(E.invalidCh,2),console.info(`${i}channel: CH${d+1} (unsupported)`)},d=>{console.debug(`${i}mod wheel: ${d-64}`)},d=>{console.debug(`${i}bend wheel: ${d-64}`)},d=>{console.debug(`${i}channel after touch: ${d-64}`)},d=>{console.debug(`${i}AC1: ${d-64}`)},d=>{console.debug(`${i}AC2: ${d-64}`)}][t[0]-86+c](o)})):t[0]>111&&t[0]<118?i+="variation ":console.warn(`Unknown XG variation address: ${t[0]}`)}).add([76,2,64],(t,n,h)=>{t.subarray(1).forEach((i,o)=>{let c=o+t[0];if(c===0)console.debug(`XG EQ preset: ${["flat","jazz","pop","rock","classic"][i]}`);else{let d=c-1>>2,m=c-1&3,p=`XG EQ ${d} ${["gain","freq","Q","shape"][m]}: `;[()=>{console.debug(`${p}${i-64}dB`)},()=>{console.debug(`${p}${i} (raw)`)},()=>{console.debug(`${p}${i/10}`)},()=>{console.debug(`${p}${["shelf","peak"][+!!i]}`)}][m]()}})}).add([76,3],(t,n,h)=>{e.invokeSysExIndicator();let i=t[0],o=t[1],c=`XG Insertion ${t[0]+1} `;t.subarray(2).forEach((d,m)=>{([()=>{e.setEffectTypeRaw(3+i,!1,d),console.info(`${c}main type: ${zt[d]}`),e.pushEffectType(3+i)},()=>{e.setEffectTypeRaw(3+i,!0,d),console.debug(`${c}sub type: ${d+1}`),e.pushEffectType(3+i)},!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,()=>{if(d<64){let p=e.chRedir(d,n,!0);e.setXgChEffectSink(p,3+i),console.debug(`${c}channel: CH${d+1} (CH${p+1})`)}else e.setXgChEffectSink(E.invalidCh,3+i),console.info(`${c}channel: CH${d+1} (unsupported)`)}][o+m]||function(){})(d)})}).add([76,6,0],(t,n,h)=>{let i=t[0];i<64?e.setLetterDisplay(t.subarray(1),"XG letter display",i):M(e,je,e.clockSource.now())}).add([76,7,0],(t,n,h)=>{let i=t[0];M(e,ne,0),M(e,Ae,e.clockSource.now()+3200),t.subarray(1).forEach(function(c,d){let m=d+i,p=m>>4,k=m&15,v=(k*3+p)*7,I=7,R=0;for(v-=k*5,p===2&&(I=2);R<I;)r(e,Fe,Bt)[v+R]=c>>6-R&1,R++})}).add([76,8],(t,n)=>{e.invokeSysExIndicator();let h=e.chRedir(t[0],n,!0),i=t[1],o=G[h],c=`XG CH${h+1} `,d=`Unknown XG part address ${i}.`,m=!0;t.subarray(2).forEach((p,k)=>{m=!0,i<1?console.debug(d):i<41?([()=>{e.setChCc(h,0,p),e.pushChPrimitives(h)},()=>{e.setChCc(h,32,p),e.pushChPrimitives(h)},()=>{r(e,_)[h]=p,e.pushChPrimitives(h)},()=>{m=!1;let v=e.chRedir(p,n,!0),I=r(e,V)[h];r(e,V)[h]=v,(h!==v||v!==I)&&(e.buildRchTree(),console.info(`${c}receives from CH${v+1}`)),r(e,be)[h]||(e.copyChSetup(v,h,!0),console.debug(`${c}copied from CH${v+1}.`),e.setChActive(h,1),e.pushChPrimitives(h))},()=>{r(e,oe)[h]=+!p},()=>{},()=>{m=!1,e.setChType(h,p,S.xg),console.debug(`${c}type: ${Wt[p]||p}`),e.pushChPrimitives(h)},()=>{r(e,L)[E.rpn*h+3]=p,r(e,N)[E.rpnt*h+2]=1,e.dispatchEvent("pitch",{part:h,pitch:e.getPitchShift(h)})},!1,!1,()=>{e.setChCc(h,7,p)},!1,!1,()=>{e.setChCc(h,10,p||128)},!1,!1,()=>{e.setChCc(h,128,p),e.allocateAce(h,128)},()=>{e.setChCc(h,93,p)},()=>{e.setChCc(h,91,p)},()=>{e.setChCc(h,94,p)},()=>{e.setChCc(h,76,p)},()=>{e.setChCc(h,77,p)},()=>{e.setChCc(h,78,p)},()=>{e.setChCc(h,74,p)},()=>{e.setChCc(h,71,p)},()=>{e.setChCc(h,73,p)},()=>{e.setChCc(h,75,p)},()=>{e.setChCc(h,72,p)}][i+k-1]||(()=>{}))():i<48?console.debug(d):i<111?i>102&&i<105&&e.setChCc(h,[5,65][i&1],p):i<114?console.debug(d):i<116?console.debug(`${c}EQ ${["bass","treble"][i&1]} gain: ${p-64}dB`):i<118?console.debug(d):i<120?console.debug(`${c}EQ ${["bass","treble"][i&1]} freq: ${p}`):console.debug(d)}),m&&r(e,D)[h]>1&&e.setDrumFirstWrite(h)}).add([76,9],(t,n)=>{let h=e.chRedir(t[0],n,!0),i=t[1],o=G[h],c=`PLG-VL CH${h+1} `;t.subarray(2).forEach((d,m)=>{let p=m+i;switch(p){case 1:{console.info(`${c}breath mode: ${["system","breath","velocity","touch EG"][d]}`);break}case 0:case 27:case 28:break;default:if(p<27){let k=p-3>>1,v=["pressure","embouchure","tonguing","scream","breath noise","growl","throat formant","harmonic enhancer","damping","absorption","amplification","brightness"][k];p&1?p<23?(console.debug(`${c}${v} control source: ${Qa(d)}`),d&&d<96&&e.allocateAce(h,130+k),r(e,pt)[E.redir*h+k+2]=d,e.buildRccMap()):console.debug(`${c}${v} scale break point: ${d}`):(console.debug(`${c}${v} depth: ${d-64}`),e.setChCc(h,130+k,d))}}})}).add([76,10],(t,n,h)=>{}).add([76,16],(t,n,h)=>{}).add([76,17,0,0],(t,n,h)=>{}).add([76,112],(t,n,h)=>{if(t[0]>=Me.length){console.error(`Supplied invalid plugin board ID: ${t[0]}`);return}if(t[1]>=Me[t[0]][1]){console.error(`Supplied invalid slot ID for board type "${Me[t[0]][0]}" (${t[0]}): ${t[1]} (#${t[1]+1}))`);return}switch(t[1]>=Me[t[0]][2]?console.warn(`While enabled in Octavia, slot #${t[1]+1} for board type "${Me[t[0]][0]}" (${t[0]}) may not function outside software recreation.`):t[2]>63?console.debug(`XG disable PLG-${Me[t[0]][0]} (${t[0]}) slot #${t[1]+1} as it's set to CH${t[2]+1}.`):console.debug(`XG enable PLG-${Me[t[0]][0]} (${t[0]}) slot #${t[1]+1} for CH${t[2]+1}.`),e.modelEx.yPlg[t[0]][t[1]]=t[2]<64?e.chRedir(t[2],n,!0):E.invalidCh,t[0]){case 0:{r(e,ce)[E.ext*t[2]]=e.EXT_VL;break}case 2:{r(e,ce)[E.ext*t[2]]=e.EXT_DX;break}default:r(e,ce)[E.ext*t[2]]=e.EXT_NONE}}).add([73,0,0],(t,n)=>{let h=t[0],i="MU System - ";t.subarray(1).forEach((o,c)=>{let m,p;let d=h+c;d===8?(e.lcdContrast=Math.max(0,Math.min(8,9-o))<<2,console.debug(`${i}LCD contrast: ${o}.`)):d===18?(r(e,j)[S.xg][1]=(m=[0,126,152][o])!=null?m:127,console.debug(`${i}default bank: ${(p=["MU Basic","MU100 Native","PSR/LE"][o])!=null?p:o}.`),e.modelEx.xg.map=o,e.dispatchEvent("banklevel",{mode:"xg",data:o}),e.forceVoiceRefresh()):d>=64&&d<69&&[()=>{e.dispatchEvent("channelactive",o)},()=>{o<8?(e.dispatchEvent("channelmin",o<<4),console.debug(`Octavia System: Minimum CH${(o<<4)+1}`)):(e.dispatchEvent("channelreset"),console.info("Octavia System: Clear channel ranges"))},()=>{o<8?(e.dispatchEvent("channelmax",(o<<4)+15),console.debug(`Octavia System: Maximum CH${(o<<4)+16}`)):(e.dispatchEvent("channelreset"),console.info("Octavia System: Clear channel ranges"))},()=>{e.dispatchEvent("channelreset"),console.info("Octavia System: Clear channel ranges")},()=>{M(e,Ce,!!o),console.info(`Octavia System: RS receiving ${["dis","en"][o]}abled.`)}][d-64]()})}).add([73,10,0],(t,n)=>{let h=t[0],i=`MU RS${r(e,Ce)?"":" (ignored)"}: `;if(t[1]!==0){console.info(`${i}button ${h} pressed.`);return}if(h<16)switch(h){case 0:{r(e,Ce)&&e.dispatchEvent("portrange",1),console.info(`${i}Show single port.`),e.lcdHideBankInfo=!1;break}case 1:{let o=e.chRedir(0,n,!0);r(e,Ce)&&(e.dispatchEvent("portrange",2),e.dispatchEvent("portstart",o)),console.info(`${i}Show CH${o+1}~CH${o+32}.`),e.lcdHideBankInfo=!1;break}case 2:{let o=e.chRedir(0,n,!0);r(e,Ce)&&(e.dispatchEvent("portrange",4),e.dispatchEvent("portstart",o)),console.info(`${i}Show CH${o+1}~CH${o+64}.`),e.lcdHideBankInfo=!1;break}case 3:{let o=e.chRedir(0,n,!0);r(e,Ce)&&(e.dispatchEvent("portrange",2),e.dispatchEvent("portstart",o)),console.info(`${i}Show CH${o+1}~CH${o+32}, hide info.`),e.lcdHideBankInfo=!0;break}default:h>=4&&h<12?(e.lcdContrast=12-h<<1,console.debug(`${i}LCD contrast set to ${h-3}.`)):console.debug(`${i}unknown switch ${h} invoked.`)}else if(h<32){if(r(e,Ce)){let o=e.chRedir(h-16+(r(e,Nt)<<4),n,!0);e.dispatchEvent("channelactive",o)}}else if(h<36){let o=e.chRedir(h-32<<4,n,!0);r(e,Ce)&&(e.dispatchEvent("portrange",1),e.dispatchEvent("portstart",o>>4),M(e,Nt,h-32)),console.info(`${i}Show CH${o+1}~CH${o+16}.`)}}).add([73,11,0],(t,n)=>{let h="MU1000 System - channel ",i="Octavia System - channel ",o=t[0];t.subarray(1).forEach((c,d)=>{let m=o+d;([()=>{e.setChActive(c,1),e.dispatchEvent("channelactive",c),B()&&console.debug(`${h}current part: CH${c+1}`)},()=>{c<5?(e.dispatchEvent("portrange",1<<c),console.debug(`${h}port range: ${1<<c} port(s)`)):(e.dispatchEvent("portrange",0),console.debug(`${h}port range: reset`))},()=>{c<16?(e.dispatchEvent("portstart",c),console.debug(`${i}start port: ${"ABCDEFGHIJKLMNOP"[c]}`)):(e.dispatchEvent("portstart",255),console.debug(`${i}start port: reset`))}][m]||(()=>{console.debug(`${h}unknown address: ${m}`)}))()})}).add([87,0,0],(t,n)=>{let i;let h="VL70-m sound module ";switch(t[0]){case 126:{console.info(`${h}mode set to: ${(i=["VL-XG","VL70-m voice"][t[1]])!=null?i:`invalid (${t[1]})`}`),e.switchMode("xg",1),t[1]<2&&(e.modelEx.vl.module=t[1]+1),e.setPortMode(e.getTrackPort(n),1,S.xg);break}default:console.info(`Unknown ${h}address: ${t[0]}`)}}).add([93,3],(t,n)=>{let h=e.chRedir(t[0],n,!0),i=`PLG-SG CH${h+1} `,o=e.clockSource.now(),c=e.modelEx.sg;if(t[1]===0){let d="",m=0;t.subarray(2).forEach((p,k)=>{k%2===0?d+=Wa[p]||p.toString().padStart("0"):m+=p*13}),(o>=c.convLastSyll||c.runLineLen>=c.maxLineLen)&&(e.dispatchEvent("metacommit",{type:"SGLyrics",data:"",amend:!1}),c.splitMask=o<c.convLastSyll,c.runLineLen=0),e.dispatchEvent("metacommit",{type:"SGLyrics",data:`${qa(d)}`,amend:!0,mask:c.splitMask}),c.runLineLen++,c.splitMask=!1,c.convLastSyll=o+Math.ceil(m/2)+r(e,_t),B()&&console.debug(`${i}vocals: ${d}`)}else console.warn(`Unknown PLG-SG data: ${t}`)}).add([98,96],(t,n,h,i)=>{let o=e.chRedir(t[0],n,!0),c=G[o],d=t[1];t.subarray(2).forEach((m,p)=>{let k=d+p;if(!(k<10)){if(k===10)e.resetAce();else if(k<27){let v=k+131;e.setChCc(o,v,m),!(i!=null&&i.noAce)&&m>0&&m!==64&&e.allocateAce(o,v),e.dispatchEvent("cc",{part:o,cc:v,data:m})}}})}).add([1,20],(t,n,h)=>{h===115?(e.switchMode("doc",2),e.setPortMode(e.getTrackPort(n),1,S.doc),console.info("MIDI reset: DOC")):console.debug(`Unknown Yamaha SysEx: 67, ${h}, ${t.join(", ")}`)}).add([1,17,15,89],(t,n,h)=>{h===115?(e.setEffectType(0,24,t[0]|16),e.pushEffectType(0)):console.debug(`Unknown Yamaha SysEx: 67, ${h}, ${t.join(", ")}`)}).add([1,24],(t,n,h)=>{if(h===115){for(let i=0;i<16;i++){let o=e.chRedir(i,n,!0);e.setChCc(o,91,127)}console.info("DOC Global Reverb: on")}else console.debug(`Unknown Yamaha SysEx: 67, ${h}, ${t.join(", ")}`)}).add([126,0],(t,n,h)=>{let i,o,c;switch(t[1]){case 0:{e.dispatchEvent("metacommit",{type:"YMCSSect",data:"Disabled",raw:"Intro "}),console.debug("Yamaha Section Control is off.");break}case 127:{e.dispatchEvent("metacommit",{type:"YMCSSect",data:(i=["Intro","Main A","Main B","Fill-in AB","Fill-in BA","Ending","Blank"][t[0]-8])!=null?i:`invalid section ${t[0]}`,raw:(o=["Intro ","Main A","Main B","FillAB","FillBA","Ending","Blank "][t[0]-8])!=null?o:`ID: ${t[0]}`}),console.debug(`Yamaha Section Control switches to "${(c=["intro","main A","main B","fill-in AB","fill-in BA","ending","blank"][t[0]-8])!=null?c:`Invalid section ${t[0]}`}".`);break}default:console.debug(`Unknown YMCS section control: ${t[1]}`)}}).add([126,2],(t,n,h)=>{let i=[];for(let o=0;o<t.length;o+=2){let c=t[o]>>4,d=t[o]&15;if(c<7&&d&&d<8){let m=new Uint8Array(5);m[0]=d-1,m[1]=c-3<<2,m[2]=t[o|1],i.push(m)}}e.dispatchEvent("metacommit",{type:"ChordCtl",src:"ymcs",data:i}),console.debug("YMCS chord data: %o",i)});let l=function(t,n,h,i){},f=function(t,n){e.invokeSysExIndicator();let h=t*E.dpn,i=n[0],o=n[1];n.subarray(2).forEach((c,d)=>{let m=d+o,p=-1;m<16?([()=>{p=24},()=>{p=25},()=>{p=26},()=>{},()=>{p=28},()=>{p=29},()=>{p=30},()=>{p=31},()=>{},()=>{},()=>{},()=>{p=20},()=>{p=21},()=>{p=22},()=>{p=23},()=>{}][m]||(()=>{console.debug(`Unknown XG-style drum param ${m} on set ${t+1}.`)}))():m<32||(m<40?([()=>{p=48},()=>{p=49},!1,!1,()=>{p=52},()=>{p=53}][m-32]||(()=>{console.debug(`Unknown XG-style drum param ${m} on set ${t+1}.`)}))():m<80||([()=>{p=36}][m-80]||(()=>{console.debug(`Unknown XG-style drum param ${m} on set ${t+1}.`)}))()),p>=0?(B()&&console.debug(h,p,i,c),r(e,he)[(h+we[p])*E.dnc+i]=c):B()&&console.debug(`XG-style drum param ${m} has no writes.`)})},b=function(t,n,h){e.invokeSysExIndicator();let i=t*E.dpn,o=(n<<7)+h[0];h.subarray(1).forEach((c,d)=>{let m=d+o,p=m&127,k=m>>7,v=-1;k>1&&([()=>{v=26},()=>{},()=>{v=28},()=>{v=29},()=>{v=30},()=>{},()=>{},()=>{v=31}][k-2]||(()=>{console.debug(`Unknown GS-style drum param ${k} on set ${t+1}.`)}))(),v>-1?(B()&&console.debug(i,v,p,c),r(e,he)[(i+we[v])*E.dnc+p]=c):B()&&console.debug(`GS-style drum param ${k} has no writes.`)})};r(this,re).add([76,48],(t,n,h)=>{f(0,t)}).add([76,49],(t,n,h)=>{f(1,t)}).add([76,50],(t,n,h)=>{f(2,t)}).add([76,51],(t,n,h)=>{f(3,t)}).add([76,52],(t,n,h)=>{f(4,t)}).add([76,53],(t,n,h)=>{f(5,t)}).add([76,54],(t,n,h)=>{f(6,t)}).add([76,55],(t,n,h)=>{f(7,t)}),r(this,re).add([89,0],(t,n,h)=>{if(e.eprom){let i=t[0],o=(t[1]<<14)+(t[2]<<7)+t[3]+(e.eprom.offset||0);B()&&console.debug(`MU1000 EPROM trail to 0x${o.toString(16).padStart(6,"0")}, ${i} bytes.`);let c=e.eprom.data;t.subarray(4).forEach((d,m)=>{let p=m>>3,k=m&7;if(k===7)for(let v=0;v<7;v++)c[o+7*p+v]+=(d>>6-v&1)<<7;else c[o+7*p+k]=d})}}).add([89,1],(t,n,h)=>{let i=(t[0]<<21)+(t[1]<<14)+(t[2]<<7)+t[3];B()&&console.debug(`MU1000 EPROM jump to 0x${i.toString(16).padStart(6,"0")}.`),e.eprom&&(e.eprom.offset=i)}).add([89,2],(t,n,h)=>{if(e.eprom){let i=(t[0]<<21)+(t[1]<<14)+(t[2]<<7)+t[3]+(e.eprom.offset||0);B()&&console.debug(`MU1000 EPROM write to 0x${i.toString(16).padStart(6,"0")}.`);let o=e.eprom.data;t.subarray(4).forEach((c,d)=>{let m=d>>3,p=d&7;if(p===7)for(let k=0;k<7;k++)o[i+7*m+k]+=(c>>6-k&1)<<7;else o[i+7*m+p]=c})}}).add([89,3],(t,n,h)=>{}),r(this,re).add([39,48],(t,n,h)=>{}).add([43,0,0],(t,n,h)=>{e.invokeSysExIndicator();let i=[0,0,0,0],o=(c,d)=>{i[d]=c};if(t.subarray(1).forEach((c,d)=>{let m=d+t[0];[o,o,o,o,()=>{M(this,W,c*129/16383*100),e.dispatchEvent("mastervolume",r(e,W))},()=>c-64,()=>c||128,()=>c,()=>c,()=>{console.debug(`TG300 variation on cc${c}.`)}][m](c,m)}),t[0]<4){let c=0;i.forEach(d=>{c=c<<4,c+=d}),c-=1024,console.debug(`Master tune: ${c}`)}}).add([43,1,0],(t,n,h)=>{e.invokeSysExIndicator()}).add([43,2],(t,n,h)=>{e.invokeSysExIndicator();let i=e.chRedir(t[0],n,!0),o=t[1],c=G[i],d=`TG300 CH${i+1} `;t.subarray(2).forEach((m,p)=>{p<5?([()=>{},()=>{e.setChCc(i,0,m),e.pushChPrimitives(i)},()=>{e.setChCc(i,32,m),e.pushChPrimitives(i)},()=>{r(e,_)[i]=m,e.pushChPrimitives(i)},()=>{let k=e.chRedir(m,n,!0),v=r(e,V)[i];r(e,V)[i]=k,(i!==k||k!==v)&&(e.buildRchTree(),console.info(`${d}receives from CH${k+1}`))}][p+o]||(()=>{}))(m,p+o):p<21||(p<47?([()=>{r(e,oe)[i]=+!m},()=>{},()=>{},()=>{r(e,L)[E.rpn*i+3]=m,r(e,N)[E.rpnt*i+2]=1,e.dispatchEvent("pitch",{part:i,pitch:e.getPitchShift(i)})},()=>{},()=>{e.setChCc(i,7,m)},!1,!1,()=>{e.setChCc(i,10,m||128)},!1,!1,()=>{console.debug(`${d} AC1 at cc${m}`)},()=>{console.debug(`${d} AC2 at cc${m}`)},()=>{r(e,x)[c+T[128]]=m,e.allocateAce(i,128)},()=>{r(e,x)[c+T[93]]=m},()=>{r(e,x)[c+T[91]]=m},()=>{r(e,x)[c+T[94]]=m},()=>{r(e,x)[c+T[76]]=m},()=>{r(e,x)[c+T[77]]=m},()=>{r(e,x)[c+T[74]]=m},()=>{r(e,x)[c+T[71]]=m},()=>{r(e,x)[c+T[73]]=m},()=>{r(e,x)[c+T[75]]=m},()=>{r(e,x)[c+T[72]]=m},()=>{r(e,x)[c+T[78]]=m}][p+o-21]||(()=>{}))(m,p+o):p<95||([()=>{r(e,x)[c+T[65]]=m},()=>{r(e,x)[c+T[5]]=m}][p+o-95]||(()=>{}))(m,p+o))})}).add([43,7,0],(t,n,h)=>{let i=t[0];e.setLetterDisplay(t.subarray(1),"TG300 letter display",i)}).add([43,7,1],(t,n,h)=>{M(e,ne,0),M(e,Ae,e.clockSource.now()+3200),t.forEach(function(i,o){let c=o>>4,d=o&15,m=(d*3+c)*7,p=7,k=0;for(m-=d*5,c===2&&(p=2);k<p;)r(e,Fe,Bt)[m+k]=i>>6-k&1,k++})}),r(this,ve).add([66,18,0,0,127],(t,n,h)=>{e.switchMode("sc",2),e.setPortMode(e.getTrackPort(n),2,S.sc),M(e,K,e.KARAOKE_NONE),r(e,He).fill(0),console.info(`GS system to ${["single","dual"][t[0]]} mode.`)}).add([66,18,64,0],(t,n,h)=>{switch(t[0]){case 127:{e.switchMode("gs",2),e.setPortMode(e.getTrackPort(n),4,S.gs),M(e,K,e.KARAOKE_NONE),r(e,He).fill(0),console.info("MIDI reset: GS");break}default:{e.invokeSysExIndicator();let i=[0,0,0,0],o=(c,d)=>{i[d]=c};if(t.subarray(1).forEach((c,d)=>{let m=d+t[0];[o,o,o,o,p=>{M(this,W,p*129/16383*100),e.dispatchEvent("mastervolume",r(e,W))},p=>{},p=>{}][m](c,d)}),t[0]<4){let c=0;i.forEach(d=>{c=c<<4,c+=d}),c-=1024,console.debug(`Master tune: ${c}`)}}}}).add([66,18,64,1],(t,n,h)=>{e.invokeSysExIndicator();let i=t[0];if(i<16){let o="".padStart(i," ");t.subarray(1).forEach((c,d)=>{o+=String.fromCharCode(Math.max(32,c))}),o=o.padEnd(16," "),console.debug(`GS patch name: ${o}`)}else i<48||(i<65?t.subarray(1).forEach((o,c)=>{let d=`GS ${i+c>55?"chorus":"reverb"} `;([()=>{console.info(`${d}type: ${ka[o]}`),e.setEffectType(0,40,o),e.pushEffectType(0)},()=>{},()=>{},()=>{},()=>{},()=>{},!1,()=>{console.debug(`${d}predelay: ${o}ms`)},()=>{console.info(`${d}type: ${ja[o]}`),e.setEffectType(1,40,16+o),e.pushEffectType(1)},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{console.debug(`${d}to reverb: ${me(o)}`)},()=>{console.debug(`${d}to delay: ${me(o)}`)}][i+c-48]||(()=>{}))()}):i<80?console.debug(`Unknown GS patch address: ${i}`):i<91?t.subarray(1).forEach((o,c)=>{let d="GS delay ";([()=>{console.info(`${d}type: ${er[o]}`),e.setEffectType(2,40,32+o),e.pushEffectType(2)},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{console.debug(`${d}to reverb: ${me(o)}`)}][i+c-80]||(()=>{}))()}):console.debug(`Unknown GS patch address: ${i}`))}).add([66,18,64,2],(t,n,h)=>{let i="GS EQ ";t.subarray(1).forEach((o,c)=>{([()=>{console.debug(`${i}low freq: ${[200,400][o]}Hz`)},()=>{console.debug(`${i}low gain: ${o-64}dB`)},()=>{console.debug(`${i}high freq: ${[3e3,6e3][o]}Hz`)},()=>{console.debug(`${i}high gain: ${o-64}dB`)}][t[0]+c]||function(){console.warn(`Unknown GS EQ address: ${t[0]+c}`)})()})}).add([66,18,64,3],(t,n,h)=>{e.invokeSysExIndicator();let i="GS EFX ",o=function(c,d){let m=tr(r(e,ye).subarray(10,12),d,c);m&&console.debug(`${i}${Ca(r(e,ye).subarray(10,12))} ${m}`)};t.subarray(1).forEach((c,d)=>{([()=>{e.setEffectTypeRaw(3,!1,32+c),e.pushEffectType(3)},()=>{e.setEffectTypeRaw(3,!0,c),console.info(`${i}type: ${Ca(r(e,ye).subarray(10,12))}`),e.pushEffectType(3)},!1,o,o,o,o,o,o,o,o,o,o,o,o,o,o,o,o,o,o,o,o,()=>{console.debug(`${i}to reverb: ${me(c)}dB`)},()=>{console.debug(`${i}to chorus: ${me(c)}dB`)},()=>{console.debug(`${i}to delay: ${me(c)}dB`)},!1,()=>{console.debug(`${i}1 source: ${c}`),c&&c<96&&e.allocateAceAll(c)},()=>{console.debug(`${i}1 depth: ${c-64}`)},()=>{console.debug(`${i}2 source: ${c}`),c&&c<96&&e.allocateAceAll(c)},()=>{console.debug(`${i}2 depth: ${c-64}`)},()=>{console.debug(`${i}to EQ: ${c?"ON":"OFF"}`)}][t[0]+d]||function(m,p){console.warn(`Unknown GS EFX address: ${p}`)})(c,t[0]+d)})}).add([66,18,65],(t,n,h)=>{b((t[0]>>4)+1<<1,t[0]&15,t.subarray(1))}).add([66,18,72],(t,n,h)=>{let i=(t[0]&127)<<7|t[1]&127;console.debug(i,sr(t.subarray(2)))}).add([69,18,16],(t,n,h)=>{let i;switch(t[0]){case 0:{let o=t[1];e.setLetterDisplay(t.subarray(2),"GS display text",o);break}case 8:{let o=t[1],c=e.modelEx.sc;t.subarray(2).forEach((d,m)=>{([()=>{c.showBar=!(d&1),c.invBar=d>>1&1,c.invDisp=d>>2&1},()=>{c.peakHold=d<4?d:1}][m+o]||(()=>{console.debug("Unsupported GS display type SysEx.")}))()});break}case 32:{M(e,Ae,e.clockSource.now()+3200),t[1]===0&&(t[2]?(M(e,ne,Math.max(Math.min(t[2]-1,9),0)),B()&&console.debug(`GS switch display page ${t[2]-1}.`)):(M(e,ne,0),M(e,Ae,e.clockSource.now()),B()&&console.debug("GS disable display page.")));break}default:if(t[0]<6){r(e,ne)>9&&M(e,ne,0);let o=t[0]-1<<1|t[1]>>6;r(e,ne)===o&&M(e,Ae,e.clockSource.now()+3200),(i=r(e,Re)[o])!=null&&i.length||(r(e,Re)[o]=new Uint8Array(256));let c=r(e,Re)[o];B()&&console.debug(`GS frame draw page ${o}.`);let d=t[1]&63;t.subarray(2).forEach(function(p,k){let v=k+d,I=v>>4,R=v&15,ae=(R*4+I)*5,Y=5,ue=0;for(ae-=R*4,I===3&&(Y=1);ue<Y;)c[ae+ue]=p>>4-ue&1,ue++})}else console.warn(`Unknown GS display section: ${t[0]}`)}}).add([69,18,32],(t,n,h)=>{let i=t[0],o=t[1],c=t.subarray(2);if(i>>4){console.warn(`SC-8850 partial screen dump out of bounds: invalid bundle.
`,t);return}let d=o+c.length,m=o*6-(o*2428>>16<<1),p=d*6-(d*2428>>16<<1);if(m>640){console.warn(`SC-8850 partial screen dump out of bounds: invalid buffer range.
`,t);return}p>640&&(console.info(`SC-8850 partial screen dump out of bounds: invalid buffer end, automatically restricted.
`,t),p=640);let k=new Uint8Array(p-m);c.forEach((R,ae)=>{let Y=ae+o,ue=(Y*2428&65535)*27>>16===26,ze=Y*6-(Y*2428>>16<<1),z=ue?2:0;for(;z<6;)k[ze+(5-z)]=R>>z&1,z++});let v=i*108+o,I=v*6-(v*2428>>16<<1);e.dispatchEvent("screen",{type:"sc8850",offset:I,data:k}),B()&&console.debug(`SC-8850 screen dump: bundle ${i+1}, range ${m}~${p}`)});let y=function(t,n,h){e.invokeSysExIndicator();let i=t[0],o=G[n],c=Rt[n],d=`GS CH${n+1} `;i<3?(t.subarray(1).forEach((m,p)=>{[()=>{r(e,x)[o+T[0]]=m,e.pushChPrimitives(n)},()=>{r(e,_)[n]=m},()=>{let k=0;m<16?k=e.chRedir(m,h,!0):k=E.ch;let v=r(e,V)[n];r(e,V)[n]=k,(n!==k||k!==v)&&(e.buildRchTree(),console.info(`${d}receives from CH${k+1}`))}][i+p]()}),e.pushChPrimitives(n)):i<19||(i<44?t.subarray(1).forEach((m,p)=>{([()=>{r(e,oe)[n]=+!m},!1,()=>{e.setChType(n,m<<1,S.gs),console.debug(`${d}type: ${m?"drum ":"melodic"}${m||""}`)},()=>{r(e,L)[c+3]=m,r(e,N)[E.rpnt*n+2]=1,e.dispatchEvent("pitch",{part:n,pitch:e.getPitchShift(n)})},!1,!1,()=>{r(e,x)[o+T[7]]=m},!1,!1,()=>{e.setChCc(n,10,m||128)},!1,!1,()=>{console.debug(`${d}CC 1: cc${m}`)},()=>{console.debug(`${d}CC 2: cc${m}`)},()=>{r(e,x)[o+T[93]]=m},()=>{r(e,x)[o+T[91]]=m},!1,!1,()=>{r(e,L)[c+1]=m,r(e,N)[E.rpnt*n+1]=1,e.dispatchEvent("pitch",{part:n,pitch:e.getPitchShift(n)})},()=>{r(e,L)[c+2]=m,r(e,N)[E.rpnt*n+1]=1,e.dispatchEvent("pitch",{part:n,pitch:e.getPitchShift(n)})},()=>{r(e,x)[o+T[94]]=m}][i+p-19]||(()=>{}))()}):i<76||console.debug(`Unknown GS part address: ${i}`))},w=function(t,n){let h=t[0],i=`GS CH${n+1} `;h<2?t.subarray(1).forEach((o,c)=>{[()=>{e.setChCc(n,32,o)},()=>{}][h+c]()}):h<32?console.warn(`Unknown GS misc address: ${h}`):h<35?t.subarray(1).forEach((o,c)=>{[()=>{console.debug(`${i}EQ: o${["ff","n"][o]}`)},()=>{},()=>{console.debug(`${i}EFX: o${["ff","n"][o]}`),e.setChEffectSink(n,o?3:0)}][h+c-32]()}):console.warn(`Unknown GS misc address: ${h}`)};r(this,ve).add([66,18,64,16],(t,n)=>{y(t,e.chRedir(9,n,!0),n)}).add([66,18,64,17],(t,n)=>{y(t,e.chRedir(0,n,!0),n)}).add([66,18,64,18],(t,n)=>{y(t,e.chRedir(1,n,!0),n)}).add([66,18,64,19],(t,n)=>{y(t,e.chRedir(2,n,!0),n)}).add([66,18,64,20],(t,n)=>{y(t,e.chRedir(3,n,!0),n)}).add([66,18,64,21],(t,n)=>{y(t,e.chRedir(4,n,!0),n)}).add([66,18,64,22],(t,n)=>{y(t,e.chRedir(5,n,!0),n)}).add([66,18,64,23],(t,n)=>{y(t,e.chRedir(6,n,!0),n)}).add([66,18,64,24],(t,n)=>{y(t,e.chRedir(7,n,!0),n)}).add([66,18,64,25],(t,n)=>{y(t,e.chRedir(8,n,!0),n)}).add([66,18,64,26],(t,n)=>{y(t,e.chRedir(10,n,!0),n)}).add([66,18,64,27],(t,n)=>{y(t,e.chRedir(11,n,!0),n)}).add([66,18,64,28],(t,n)=>{y(t,e.chRedir(12,n,!0),n)}).add([66,18,64,29],(t,n)=>{y(t,e.chRedir(13,n,!0),n)}).add([66,18,64,30],(t,n)=>{y(t,e.chRedir(14,n,!0),n)}).add([66,18,64,31],(t,n)=>{y(t,e.chRedir(15,n,!0),n)}).add([66,18,64,64],(t,n)=>{w(t,e.chRedir(9,n,!0))}).add([66,18,64,65],(t,n)=>{w(t,e.chRedir(0,n,!0))}).add([66,18,64,66],(t,n)=>{w(t,e.chRedir(1,n,!0))}).add([66,18,64,67],(t,n)=>{w(t,e.chRedir(2,n,!0))}).add([66,18,64,68],(t,n)=>{w(t,e.chRedir(3,n,!0))}).add([66,18,64,69],(t,n)=>{w(t,e.chRedir(4,n,!0))}).add([66,18,64,70],(t,n)=>{w(t,e.chRedir(5,n,!0))}).add([66,18,64,71],(t,n)=>{w(t,e.chRedir(6,n,!0))}).add([66,18,64,72],(t,n)=>{w(t,e.chRedir(7,n,!0))}).add([66,18,64,73],(t,n)=>{w(t,e.chRedir(8,n,!0))}).add([66,18,64,74],(t,n)=>{w(t,e.chRedir(10,n,!0))}).add([66,18,64,75],(t,n)=>{w(t,e.chRedir(11,n,!0))}).add([66,18,64,76],(t,n)=>{w(t,e.chRedir(12,n,!0))}).add([66,18,64,77],(t,n)=>{w(t,e.chRedir(13,n,!0))}).add([66,18,64,78],(t,n)=>{w(t,e.chRedir(14,n,!0))}).add([66,18,64,79],(t,n)=>{w(t,e.chRedir(15,n,!0))}),r(this,De).add([54,65],(t,n)=>{let h=r(e,U).x5===81?"05rw":"x5d";e.switchMode(h,1),e.setPortMode(e.getTrackPort(n),1,S[h]);let i=t[t.length-1],o=t.subarray(0,t.length-1),c=dt(o);c!==i&&(console.info(`X5D multi parameters checksum mismatch! Expected ${c}, got ${i}.`),console.debug(t));let d=(t[1]<<7)+t[0],m=(t[3]<<7)+t[2],p=e.chRedir(d&15,n,!0),k=G[p];[()=>{m<1||(m<101?(e.setChType(p,e.CH_MELODIC,S.x5d),r(e,_)[p]=m-1,r(e,x)[k+T[0]]=r(e,U).x5):m<229?(e.setChType(p,e.CH_MELODIC,S.x5d),r(e,_)[p]=m-101,r(e,x)[k+T[0]]=56):(e.setChType(p,e.CH_DRUMS,S.x5d),r(e,_)[p]=dr[m-229]||0,r(e,x)[k+T[0]]=62)),e.pushChPrimitives(p)},()=>{r(e,x)[k+T[7]]=m},()=>{m<31&&(r(e,x)[k+T[10]]=Math.round((m-15)*4.2+64))},()=>{r(e,x)[k+T[93]]=qt(m)},()=>{r(e,x)[k+T[91]]=qt(m)},()=>{r(e,L)[p*E.rpn+3]=m>8191?m-16320:64+m,r(e,N)[E.rpnt*p+2]=1,e.dispatchEvent("pitch",{part:p,pitch:e.getPitchShift(p)})},()=>{r(e,L)[p*E.rpn+1]=m>8191?m-16320:64+m,r(e,N)[E.rpnt*p+1]=1,e.dispatchEvent("pitch",{part:p,pitch:e.getPitchShift(p)})},()=>{m>0&&(r(e,L)[p*E.rpn]=m,r(e,N)[E.rpnt*p]=1,e.dispatchEvent("pitch",{part:p,pitch:e.getPitchShift(p)}))},()=>{}][d>>4]()}).add([54,76,0],(t,n)=>{e.invokeSysExIndicator();let h=r(e,U).x5===81?"05rw":"x5d";e.switchMode(h,1),e.setPortMode(e.getTrackPort(n),1,S[h]);let i="",o=r(e,U).x5,c=0,d=0,m="MSB	PRG	LSB	NME";Te(t,function(p,k){if(k<16400){let v=k%164;switch(!0){case v<10:{p>31&&(i+=String.fromCharCode(p));break}case v===10:break;case v===11:{m+=`
${o}	${c}	${d}	${i.trim().replace("Init Voice","")}`,c++,i="";break}}c>99&&(o=90,c=0)}}),e.userBank.clearRange({msb:r(e,U).x5,prg:[0,99],lsb:0}),e.userBank.load(m),B()&&console.debug(m),e.forceVoiceRefresh()}).add([54,77,0],(t,n)=>{e.invokeSysExIndicator();let h=r(e,U).x5===81?"05rw":"x5d";e.switchMode(h,1),e.setPortMode(e.getTrackPort(n),1,S[h]);let i="",o=90,c=0,d=0,m="MSB	PRG	LSB	NME";Te(t,function(p,k){if(k<13600){let v=k%136;switch(!0){case v<10:{p>31&&(i+=String.fromCharCode(p));break}case v===11:{m+=`
${o}	${c}	${d}	${i.trim().replace("Init Combi","")}`,c++,i="";break}}}}),e.userBank.clearRange({msb:90,prg:[0,99],lsb:0}),e.userBank.load(m),B()&&console.debug(m),e.forceVoiceRefresh()}).add([54,78],(t,n)=>{let h=r(e,U).x5===81?"05rw":"x5d";e.switchMode(h,0),e.setPortMode(e.getTrackPort(n),1,S[h]),console.debug(`X5D mode switch requested: ${["combi","combi edit","prog","prog edit","multi","global"][t[0]]} mode.`)}).add([54,85],(t,n)=>{e.invokeSysExIndicator();let h=r(e,U).x5===81?"05rw":"x5d";e.switchMode(h,1),e.setPortMode(e.getTrackPort(n),1,S[h]),Te(t,(i,o)=>{o>0&&o<3&&(e.setEffectType(o-1,44,i),e.pushEffectType(o-1))})}).add([54,104],(t,n)=>{e.invokeSysExIndicator();let h=r(e,U).x5===81?"05rw":"x5d";e.switchMode(h,1);let i=e.getTrackPort(n);if(r(e,Q)[i]&&r(e,Q)[i]!==S[h])if(r(e,Ne).dumpLimit===e.DUMP_MODE){console.warn(`Dump cancelled for track ${n}. Port ${String.fromCharCode(65+i)} mode "${q[r(e,Q)[i]]}" mismatch, should be "${h}".`);return}else console.info(`Track ${n} is trying to perform a mismached mode dump on port ${String.fromCharCode(65+i)}.`);e.setPortMode(i,1,S[h]),Te(t,function(o,c,d,m){if(c<192){let p=e.chRedir(Math.floor(c/12),n,!0),k=G[p];switch(c%12){case 0:{o<128?(e.setChType(p,e.CH_MELODIC,S.x5d),r(e,x)[k+T[0]]=r(e,U).x5,r(e,_)[p]=o):(e.setChType(p,e.CH_DRUMS,S.x5d),r(e,x)[k+T[0]]=62,r(e,_)[p]=dr[o-128]),o>0&&e.setChActive(p,1),e.pushChPrimitives(p);break}case 1:{r(e,x)[k+T[7]]=o;break}case 2:{r(e,L)[p*E.rpn+3]=o>127?o-192:64+o,r(e,N)[E.rpnt*p+2]=1,e.dispatchEvent("pitch",{part:p,pitch:e.getPitchShift(p)});break}case 3:{r(e,L)[p*E.rpn+1]=o>127?o-192:64+o,r(e,N)[E.rpnt*p+1]=1,e.dispatchEvent("pitch",{part:p,pitch:e.getPitchShift(p)});break}case 4:{o<31&&(r(e,x)[k+T[10]]=Math.round((o-15)*4.2+64));break}case 5:{let v=o>>4,I=o&15;r(e,x)[k+T[91]]=qt(I),r(e,x)[k+T[93]]=qt(v);break}case 10:{r(e,D)[p]||(r(e,x)[k+T[0]]=o>>6?56:r(e,U).x5,e.pushChPrimitives(p));break}case 11:{let v=e.chRedir(o&15,n,!0),I=o>>4;r(e,V)[p]=o,(v!==p||I)&&console.info(`X5D Part CH${p+1} receives from CH${v+1}.`)}}}else{let p=e.chRedir(c-192,n,!0)}}),e.buildRchTree()}),r(this,ve).add([22,18,127],(t,n,h)=>{e.switchMode("mt32",2),e.setPortMode(e.getTrackPort(n),1,S.mt32),M(e,K,e.KARAOKE_NONE),e.userBank.clearRange({msb:0,lsb:127,prg:[0,127]}),console.info("MIDI reset: MT-32")}).add([22,18,0],(t,n,h)=>{e.switchMode("mt32",1);let i=e.chRedir(h,n,!0),o=t[1];t.subarray(2).forEach((c,d)=>{let m=d+o;r(e,Qe)[m+(i-1)*16]=c,([!1,()=>{let p=r(e,Qe)[i-1<<4];if(p<3){if(r(e,ke)[i]=1,p===2)for(let k=0;k<name.length;k++)r(e,Be)[(i-1)*E.cmt+k]=r(e,Je)[c*E.cmt+k];else{let k=e.baseBank.get(0,c+(p<<6),127,"mt32").name;for(let v=0;v<k.length;v++)r(e,Be)[(i-1)*E.cmt+v]=k.charCodeAt(v)}e.pushChPrimitives(i)}},()=>{r(e,L)[i*E.rpn+3]=c+40,r(e,N)[E.rpnt*i+2]=1},()=>{r(e,L)[i*E.rpn+1]=c+14,r(e,N)[E.rpnt*i+1]=1},()=>{r(e,L)[i*E.rpn]=c,r(e,N)[E.rpnt*i]=1},!1,()=>{e.setChCc(i,91,c?127:0)},!1,()=>{e.setChCc(i,7,c)},()=>{e.setChCc(i,10,Math.ceil(c*9.05))}][m]||(()=>{}))()})}).add([22,18,1],(t,n,h)=>{e.switchMode("mt32",1);let i=h&7;console.debug(`MT-32 slot #${h+1} Drum: ${t}`);let o=t[0]<<7|t[1];t.subarray(2).forEach((c,d)=>{let m=d+o,p=(m>>2)+24,k=m&3,v=i*E.dpn;if(B()&&console.debug(`MT-32 temp drum note ${p} param ${k}: ${c}`),p<24){console.warn(`MT-32 dev drum write attempted on an OOB note: ${p}`);return}[()=>{},()=>{r(e,he)[(v+we[26])*E.dnc+p]=Math.round(c*1.27)},()=>{r(e,he)[(v+we[26])*E.dnc+p]=c*9+1&127},()=>{r(e,he)[(v+we[26])*E.dnc+p]=c?127:0}][k]()})}).add([22,18,2],(t,n,h)=>{e.switchMode("mt32",1);let i=e.chRedir(h,n,!0),o=t[1]+(t[0]<<7);o<10&&(r(e,ke)[i]=1),t.subarray(2).forEach((c,d)=>{let m=d+o;m<14&&(r(e,Be)[(i-1)*E.cmt+m]=c)}),e.pushChPrimitives(i)}).add([22,18,3],(t,n,h)=>{e.switchMode("mt32",1);let i=h&7;if(t[0]){let o=(t[0]-1<<7)+t[1]-16;t.subarray(2).forEach((c,d)=>{let m=d+o,p=(m>>2)+24,k=m&3,v=i*E.dpn;if(B()&&console.debug(`MT-32 dev drum note ${p} param ${k}: ${c}`),p<24){console.warn(`MT-32 dev drum write attempted on an OOB note: ${p}`);return}[()=>{},()=>{r(e,he)[(v+we[26])*E.dnc+p]=Math.round(c*1.27)},()=>{r(e,he)[(v+we[26])*E.dnc+p]=c*9+1&127},()=>{r(e,he)[(v+we[26])*E.dnc+p]=c?127:0}][k]()})}else{let o=t[1];t.subarray(2).forEach((c,d)=>{let m=d+o;r(e,Qe)[m]=c;let p=e.chRedir(1+(m>>4),n,!0),k=m&15;([!1,()=>{let v=r(e,Qe)[p-1<<4];if(v<3)if(r(e,ke)[p]=1,v===2)for(let I=0;I<name.length;I++)r(e,Be)[(p-1)*E.cmt+I]=r(e,Je)[c*E.cmt+I];else{let I=e.baseBank.get(0,c+(v<<6),127,"mt32").name;for(let R=0;R<I.length;R++)r(e,Be)[(p-1)*E.cmt+R]=I.charCodeAt(R)}e.pushChPrimitives(p)},()=>{r(e,L)[p*E.rpn+3]=c+40,r(e,N)[E.rpnt*p+2]=1},()=>{r(e,L)[p*E.rpn+1]=c+14,r(e,N)[E.rpnt*p+1]=1},()=>{r(e,L)[p*E.rpn]=c,r(e,N)[E.rpnt*p]=1},!1,()=>{e.setChCc(p,91,c?127:0)},!1,()=>{e.setChCc(p,7,c)},()=>{e.setChCc(p,10,Math.ceil(c*9.05))}][k]||(()=>{}))()})}}).add([22,18,4],(t,n,h)=>{e.switchMode("mt32",1);let i=t[1]+(t[0]<<7),o=[];t.subarray(2).forEach((c,d)=>{let m=d+i,p=e.chRedir(Math.floor(m/246+1),n,!0),k=m%246;k<14&&(r(e,Be)[(p-1)*E.cmt+k]=c),k<10&&(r(e,ke)[p]=1),o.indexOf(p)<0&&o.push(p)}),o.forEach(c=>{e.pushChPrimitives(c)})}).add([22,18,5],(t,n,h)=>{e.switchMode("mt32",1);let i=(t[0]<<7)+t[1];t.subarray(2).forEach((o,c)=>{let d=i+c,m=Math.floor(d/8),p=d&7,k=m*8;r(e,Ot)[d]=o,([!1,()=>{let v=r(e,Ot)[k];if(v<3){let I="";if(v===2){let ae=E.cmt*m;I=`MT-m:${o.toString().padStart(3,"0")}`}else I=e.baseBank.get(0,o+(v<<6),127,"mt32").name;e.userBank.clearRange({msb:0,lsb:127,prg:m});let R=`MSB	LSB	PRG	NME
49	127	${m}	${I}`;e.userBank.load(R,!0)}}][p]||(()=>{}))()}),e.forceVoiceRefresh()}).add([22,18,8],(t,n,h)=>{e.switchMode("mt32",1);let i=((t[0]&1)<<7)+t[1],o=t[0]>>1,c=!1;if(t.subarray(2).forEach((d,m)=>{let p=i+m;p<E.cmt&&(r(e,Je)[o*E.cmt+p]=d,c=!0)}),c){e.userBank.clearRange({msb:0,lsb:127,prg:o});let d=`MSB	LSB	PRG	NME
49	127	${o}	MT-m:${o}`;e.userBank.load(d,!0)}e.forceVoiceRefresh()}).add([22,18,16],(t,n,h)=>{e.switchMode("mt32",1);let i=t[1],o=!1,c=function(d,m){r(e,V)[m-12]=d,o=!0};t.subarray(2).forEach((d,m)=>{let p=m+i;([!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,c,c,c,c,c,c,c,c,c,()=>{M(e,W,d),e.dispatchEvent("mastervolume",r(e,W))}][p]||(()=>{}))(d,m)}),o&&e.buildRchTree()}).add([22,18,32],(t,n,h)=>{e.switchMode("mt32",1);let i=t[1],o=" ".repeat(i);t.subarray(2).forEach(c=>{c>31?o+=String.fromCharCode(c):o+=" "}),M(e,Ze,o.padStart(20," ")),M(e,je,e.clockSource.now()+3200)}).add([22,18,82],(t,n)=>{let h=e.chRedir(0,n,!0);for(let i=0;i<16;i++)r(e,te).ano(h+i),i&&i<10&&(r(e,_)[h+i]=va[i-1]);console.info("MT-32 alt reset complete.")}),r(this,De).add([66,0],(t,n)=>{e.switchMode("ns5r",1),e.setPortMode(e.getTrackPort(n),2,S.ns5r),M(e,K,e.KARAOKE_NONE),console.debug(`NS5R mode switch requested: ${["global","multi","prog edit","comb edit","drum edit","effect edit"][t[0]]} mode.`)}).add([66,1],(t,n)=>{let h=["ns5r","05rw"][t[0]];e.switchMode(h,1),e.setPortMode(e.getTrackPort(n),2,S[h]),M(e,K,e.KARAOKE_NONE)}).add([66,18,0,0],(t,n)=>{let h=t[0];switch(h){case 124:case 126:case 127:{e.switchMode("ns5r",2),e.setPortMode(e.getTrackPort(n),2,S.ns5r),M(e,K,e.KARAOKE_NONE);break}case 125:{e.initDrums(),console.info(`NS5R drum setup reset on drum kit ${t[1]}.`);break}default:if(h<10){let i=[0,0,0,0],o=(c,d)=>{i[d]=c};if(t.subarray(1).forEach((c,d)=>{[o,o,o,o,()=>{M(e,W,c*129/16383*100),e.dispatchEvent("mastervolume",r(e,W))},()=>c-64,()=>c-64,()=>{},()=>{},()=>{}][h+d]()}),t[0]<4){let c=0;i.forEach(d=>{c=c<<4,c+=d}),c-=1024,console.debug(`Master tune: ${c}`)}}}}).add([66,18,0,1],(t,n)=>{}).add([66,18,0,2],(t,n)=>{}).add([66,18,1],(t,n)=>{e.invokeSysExIndicator();let h=e.chRedir(t[0],n,!0),i=G[h],o=t[1],c=`NS5R CH${h+1} `;t.subarray(2).forEach((d,m)=>{let p=o+m;p<3?([()=>{r(e,x)[i+T[0]]=d||Le.bank0,e.pushChPrimitives(h)},()=>{r(e,x)[i+T[32]]=d,e.pushChPrimitives(h)},()=>{r(e,_)[h]=d}][p](),e.pushChPrimitives(h)):p<8||(p<14?[()=>{let k=e.chRedir(d,n,!0),v=r(e,V)[h];r(e,V)[h]=k,(h!==k||k!==v)&&(e.buildRchTree(),console.info(`${c}receives from CH${k+1}`))},()=>{r(e,oe)[h]=+!d},()=>{e.setChType(h,d,S.ns5r),console.debug(`${c}type: ${Wt[d]}`)},()=>{r(e,L)[E.rpn*h+3]=d,r(e,N)[E.rpnt*h+2]=1,e.dispatchEvent("pitch",{part:h,pitch:e.getPitchShift(h)})},()=>{},()=>{}][p-8]():p<16||(p<33?[()=>{r(e,x)[i+T[7]]=d},()=>{r(e,x)[i+T[11]]=d},()=>{},()=>{},()=>{r(e,x)[i+T[10]]=d||128},()=>{},()=>{},()=>{r(e,x)[i+T[93]]=d},()=>{r(e,x)[i+T[91]]=d},()=>{r(e,x)[i+T[76]]=d},()=>{r(e,x)[i+T[77]]=d},()=>{r(e,x)[i+T[78]]=d},()=>{r(e,x)[i+T[74]]=d},()=>{r(e,x)[i+T[71]]=d},()=>{r(e,x)[i+T[73]]=d},()=>{r(e,x)[i+T[75]]=d},()=>{r(e,x)[i+T[72]]=d}][p-16]():p<112||p<114&&[()=>{r(e,x)[i+T[5]]=d},()=>{r(e,x)[i+T[65]]=d}][p-112]()))})}).add([66,18,8,0],(t,n)=>{let h=t[0];if(h<32)e.setLetterDisplay(t.subarray(1,33),"NS5R letter display");else{let i=h-32;M(e,Ae,e.clockSource.now()+3200),M(e,ne,10);let o=t.subarray(1),c=4;o.forEach(function(d,m){let p=m+i,k=p>>4,v=p&15;if(p<80){let I=k<c?d:d>>3,R=0,ae=k<c?6:3;for(;I>0;)r(e,Fe,Bt)[v*32+k*7+(ae-R)]=I&1,I=I>>1,R++}})}}).add([66,18,48],(t,n,h)=>{f(0,t)}).add([66,18,49],(t,n,h)=>{f(1,t)}).add([66,18,50],(t,n,h)=>{f(2,t)}).add([66,18,51],(t,n,h)=>{f(3,t)}).add([66,18,52],(t,n,h)=>{f(4,t)}).add([66,18,53],(t,n,h)=>{f(5,t)}).add([66,18,54],(t,n,h)=>{f(6,t)}).add([66,18,55],(t,n,h)=>{f(7,t)}).add([66,52],(t,n)=>{e.switchMode("ns5r",1),M(e,K,e.KARAOKE_NONE);let h="";Te(t,(i,o)=>{o<8?(i>31&&(h+=String.fromCharCode(i)),o===7&&(e.aiEfxName=h)):o<10&&(e.setEffectType(o-8,44,i),e.pushEffectType(o-8))})}).add([66,53],(t,n)=>{e.invokeSysExIndicator(),e.switchMode("ns5r",1),M(e,K,e.KARAOKE_NONE);let h="",i=t[t.length-1],o=t.subarray(0,t.length-1),c=dt(o);c!==i&&(console.info(`NS5R current multi dump checksum mismatch! Expected ${c}, got ${i}.`),console.debug(t));let d=e.getTrackPort(n);if(r(e,Q)[d]&&r(e,Q)[d]!==S.ns5r)if(r(e,Ne).dumpLimit===e.DUMP_MODE){console.warn(`Dump cancelled for track ${n}. Port ${String.fromCharCode(65+d)} mode "${q[r(e,Q)[d]]}" mismatch, should be "ns5r".`);return}else console.info(`Track ${n} is trying to perform a mismached mode dump on port ${String.fromCharCode(65+d)}.`);e.setPortMode(d,2,S.ns5r),Te(o,function(m,p){switch(!0){case p<2944:{let k=e.chRedir(Math.floor(p/92),n,!0),v=G[k];switch(p%92){case 0:{r(e,x)[v+T[0]]=m,e.pushChPrimitives(k),e.pushChPrimitives(k);break}case 1:{r(e,x)[v+T[32]]=m,!m&&!r(e,x)[v+T[0]]&&(r(e,x)[v+T[0]]=Le.bank0),e.pushChPrimitives(k);break}case 2:{r(e,_)[k]=m,m>0&&e.setChActive(k,1);break}case 3:{let I=e.chRedir(m,n,!0);r(e,V)[k]=I,k!==I&&console.info(`NS5R CH${k+1} receives from CH${I+1}.`);break}case 7:{r(e,D)[k]=m,e.pushChPrimitives(k);break}case 8:{r(e,L)[k*E.rpn+3]=m<40||m>88?m+(m>63?-192:64):m,r(e,N)[E.rpnt*k+2]=1,e.dispatchEvent("pitch",{part:k,pitch:e.getPitchShift(k)});break}case 9:case 10:{r(e,x)[v+T[7]]=m;break}case 11:{r(e,x)[v+T[11]]=m;break}case 14:{r(e,x)[v+T[10]]=m||128;break}case 19:{r(e,x)[v+T[93]]=m;break}case 20:{r(e,x)[v+T[91]]=m;break}case 84:{r(e,x)[v+T[65]]=m;break}case 85:{r(e,x)[v+T[5]]=m;break}}break}case p<3096:break;case p<3134:{let k=p-3096;k<8?(m>31&&(h+=String.fromCharCode(m)),k===7&&(e.aiEfxName=h)):k<10&&(e.setEffectType(k-8,44,m),e.pushEffectType(k-8));break}case p<8566:break}}),e.buildRchTree()}).add([66,54],(t,n)=>{e.invokeSysExIndicator(),e.switchMode("ns5r",1);let h="",i=80,o=0,c=0,d="MSB	PRG	LSB	NME";Te(t,function(m,p){let k=p%158;switch(!0){case k<10:{m>31&&(h+=String.fromCharCode(m));break}case k===10:break;case k===11:{i=m&127;break}case k===12:{c=m&127;break}case k===13:{d+=`
${i}	${o}	${c}	${h.trim().replace("Init Voice","")}`,o++,h="";break}}}),e.userBank.clearRange({msb:80,lsb:0}),e.userBank.load(d),B()&&console.debug(d),e.forceVoiceRefresh()}).add([66,55],(t,n)=>{e.invokeSysExIndicator(),e.switchMode("ns5r",1);let h="",i=88,o=0,c=0,d="MSB	PRG	LSB	NME";Te(t,function(m,p){let k=p%126;switch(!0){case k<10:{m>31&&(h+=String.fromCharCode(m));break}case k===11:break;case k===12:break;case k===13:{d+=`
${i}	${o}	${c}	${h.trim().replace("Init Combi","")}`,o++,h="";break}}}),e.userBank.clearRange({msb:88,lsb:0}),e.userBank.load(d),B()&&console.debug(d),e.forceVoiceRefresh()}).add([66,125],(t,n,h)=>{e.dispatchEvent("backlight",["green","orange","red",!1,"yellow","blue","purple"][t[0]]||"white")}).add([66,127],(t,n,h)=>{let i=t[t.length-1],o=t.subarray(0,t.length-1),c=dt(o);c!==i&&(console.info(`NS5R screen dump checksum mismatch! Expected ${c}, got ${i}.`),console.debug(t));let d=new Uint8Array(5760);Te(t,(m,p,k)=>{if(p<720)for(let v=0;v<8;v++)d[p*8+v]=m>>7-v&1}),e.dispatchEvent("screen",{type:"ns5r",data:d})}).add([76],(t,n,h)=>{r(e,De).run([66,...t],n,h)}),r(e,Ct).add([16,0,8,0],(t,n,h)=>{let i=(t[2]<<4)+t[3],o="K11 ";([()=>{e.switchMode("k11",2),e.setPortMode(e.getTrackPort(n),2,S.k11),M(e,K,e.KARAOKE_NONE),r(e,j)[S.k11][1]=i?4:0,console.info("MIDI reset: GMega/K11")},()=>{e.setEffectType(0,24,i),console.debug(`${o}reverb type: ${i}`),e.pushEffectType(0)},()=>{console.debug(`${o}reverb time: ${i}`)},()=>{console.debug(`${o}reverb time: ${i}`)},()=>{console.debug(`${o}reverb predelay: ${i}`)},()=>{console.debug(`${o}reverb predelay: ${i}`)},()=>{console.debug(`${o}depth high: ${i}`)},()=>{console.debug(`${o}depth high: ${i}`)},()=>{console.debug(`${o}depth low: ${i}`)},()=>{console.debug(`${o}depth low: ${i}`)}][t[0]]||(()=>{}))()}).add([16,0,8,1],(t,n,h)=>{e.invokeSysExIndicator();let i=e.chRedir(t[1],n,!0),o=G[i],c=Rt[i],d=(t[3]<<4)+t[4],m=`GMega CH${i+1} `;([()=>{d<128?(e.setChType(i,e.CH_MELODIC,S.k11),r(e,x)[o+T[0]]=0,r(e,_)[i]=d):(e.setChType(i,e.CH_DRUMS,S.k11),r(e,_)[i]=d-128),e.pushChPrimitives(i)},()=>{let p=e.chRedir(d,n,!0),k=r(e,V)[i];r(e,V)[i]=p,(i!==p||p!==k)&&(e.buildRchTree(),console.info(`${m}receives from CH${p+1}`))},()=>{r(e,x)[o+T[7]]=d},()=>{uupThis.setChActive(i,d)},()=>{r(e,x)[o+T[10]]=d},()=>{r(e,L)[c+3]=d+40,r(e,N)[E.rpnt*i+2]=1,e.dispatchEvent("pitch",{part:i,pitch:e.getPitchShift(i)})},()=>{r(e,L)[c+1]=d>>1,r(e,L)[c+2]=d&1,r(e,N)[E.rpnt*i+1]=1,e.dispatchEvent("pitch",{part:i,pitch:e.getPitchShift(i)})},()=>{r(e,x)[o+T[91]]=d?127:0},()=>{},()=>{r(e,x)[o+T[74]]=d},()=>{r(e,x)[o+T[73]]=d},()=>{r(e,x)[o+T[72]]=d}][t[0]]||(()=>{}))()}).add([16,0,9,0],(t,n,h)=>{e.invokeSysExIndicator();let i=(t[2]<<4)+t[3],o="GMLX ";([()=>{console.debug(`${o}reverb type: ${i}`)},()=>{console.debug(`${o}reverb time: ${i}`)},()=>{console.debug(`${o}reverb predelay: ${i}`)},()=>{console.debug(`${o}depth high: ${i}`)},()=>{console.debug(`${o}depth low: ${i}`)}][t[0]]||(()=>{}))()}).add([16,0,9,3],(t,n,h)=>{e.invokeSysExIndicator();let i=(t[2]<<4)+t[3],o=e.chRedir(t[1],n,!0),c=G[o],d=`GMLX CH${o+1} `;[()=>{i<128?(e.setChType(o,e.CH_MELODIC,S.k11),r(e,x)[c+T[0]]=0,r(e,x)[c+T[32]]=0,r(e,_)[o]=i):i<160?(e.setChType(o,e.CH_MELODIC,S.k11),r(e,x)[c+T[0]]=0,r(e,x)[c+T[32]]=7,r(e,_)[o]=i-100):(e.setChType(o,e.CH_DRUMS,S.k11),r(e,x)[c+T[0]]=122,r(e,x)[c+T[32]]=0,r(e,_)[o]=i-160),e.pushChPrimitives(o)},()=>{let m=e.chRedir(i,n,!0),p=r(e,V)[o];r(e,V)[o]=m,(o!==m||m!==p)&&(e.buildRchTree(),console.info(`${d}receives from CH${m+1}`))}][t[0]]()}).add([16,0,9,4],(t,n,h)=>{e.invokeSysExIndicator();let i=(t[2]<<4)+t[3],o=e.chRedir(t[1],n,!0),c=G[o],d=Rt[o];[()=>{e.setChActive(o,i)},()=>{r(e,x)[c+T[7]]=i},()=>{r(e,x)[c+T[10]]=i},()=>{r(e,x)[c+T[91]]=i?127:0},()=>{r(e,L)[d+3]=i+40,r(e,N)[E.rpnt*o+2]=1,e.dispatchEvent("pitch",{part:o,pitch:e.getPitchShift(o)})},()=>{r(e,L)[d+1]=i,r(e,N)[E.rpnt*o+1]=1,e.dispatchEvent("pitch",{part:o,pitch:e.getPitchShift(o)})},()=>{r(e,L)[d]=i,r(e,N)[E.rpnt*o]=1,e.dispatchEvent("pitch",{part:o,pitch:e.getPitchShift(o)})},()=>{}][t[0]]()}),r(this,vt).add([66,93,64],(t,n,h)=>{let i=t[2];switch(t[0]){case 0:{switch(t[1]){case 4:{e.invokeSysExIndicator(),M(e,W,i*129/16383*100),e.dispatchEvent("mastervolume",r(e,W));break}case 5:{e.invokeSysExIndicator(),i-64;break}case 6:{e.invokeSysExIndicator(),console.debug(`SG global reverb: ${i?"on":"off"}`);break}case 127:{e.switchMode("sg",2),e.setPortMode(e.getTrackPort(n),1,S.sg);break}}break}case 1:{switch(t[1]){case 48:{e.invokeSysExIndicator(),console.debug(`SG reverb type: ${ka[i]}`);break}}break}default:if(t[0]>>4===1){e.invokeSysExIndicator();let o=e.chRedir(t[0]&15,n,!0);if(t[1]===2){let c=e.chRedir(i,n,!0),d=r(e,V)[o];r(e,V)[o]=c,(o!==c||c!==d)&&(e.buildRchTree(),console.info(`SG CH${o+1} receives from CH${c+1}`))}else t[1]===19&&e.setChCc(o,7,i)}else console.warn(`Unknown AKAI SG SysEx: ${t}`)}}),r(this,$t).add([9],(t,n,h)=>{e.invokeSysExIndicator(),console.debug(`GZ set effect: ${["stage reverb","hall reverb","room reverb","chorus","tremolo","phaser","rotary speaker","enhancer","flanger","EQ"][t[0]]||"off"}`)}),r(this,re).add([127,0],(t,n,h)=>{e.switchMode("motif",1);let i=new Uint8Array([127,1,...t]);r(e,re).run(i,n,h)}).add([127,1,0,0],(t,n,h)=>{e.switchMode("s90es");let i="S90/Motif ES system ",o=t[0];t.subarray(1).forEach((c,d)=>{([()=>{M(e,W,c*12900/16383),e.dispatchEvent("mastervolume",r(e,W))}][o+d]||(()=>{console.info(`Unrecognized ${i}ID: ${o+d}`)}))()})}).add([127,1,14],(t,n,h)=>{e.switchMode("s90es");let i="S90/Motif ES bulk header ",o=[];o[95]=(c,d,m)=>{console.debug(`${i}multi edit buffer: ${c[1]}`)},(o[t[0]]||(()=>{console.info(`Unrecognized ${i}ID: ${t[0]}.`)}))(t.subarray(1))}).add([127,1,15],(t,n,h)=>{e.switchMode("s90es");let i="S90/Motif ES bulk footer ",o=[];o[95]=(c,d,m)=>{console.debug(`${i}multi edit buffer: ${c[1]}`)},(o[t[0]]||(()=>{console.info(`Unrecognized ${i}ID: ${t[0]}.`)}))(t.subarray(1))}).add([127,1,54,1],(t,n,h)=>{e.switchMode("s90es");let i="S90/Motif ES reverb ",o=t[0];t.subarray(1).forEach((c,d)=>{([()=>{e.setEffectTypeRaw(0,!1,c&15|128)},()=>{e.setEffectTypeRaw(0,!0,c)}][o+d]||(()=>{}))()}),e.pushEffectType(0)}).add([127,1,54,2],(t,n,h)=>{e.switchMode("s90es");let i="S90/Motif ES chorus ",o=t[0];t.subarray(1).forEach((c,d)=>{([()=>{e.setEffectTypeRaw(1,!1,c&15|128)},()=>{e.setEffectTypeRaw(1,!0,c)}][o+d]||(()=>{}))()}),e.pushEffectType(1)}).add([127,1,54,3],(t,n,h)=>{e.switchMode("s90es");let i="S90/Motif ES insert 1 ",o=t[0];t.subarray(1).forEach((c,d)=>{([()=>{e.setEffectTypeRaw(3,!1,c&15|128)},()=>{e.setEffectTypeRaw(3,!0,c)}][o+d]||(()=>{}))()}),e.pushEffectType(3)}).add([127,1,54,4],(t,n,h)=>{e.switchMode("s90es");let i="S90/Motif ES insert 2 ",o=t[0];t.subarray(1).forEach((c,d)=>{([()=>{e.setEffectTypeRaw(4,!1,c&15|128)},()=>{e.setEffectTypeRaw(4,!0,c)}][o+d]||(()=>{}))()}),e.pushEffectType(4)}).add([127,1,54,16],(t,n,h)=>{e.switchMode("s90es");let i=t[0];t.subarray(1).forEach((o,c)=>{let m=`S90/Motif ES EQ${(c>>2)+1} `;([()=>{let p=o-64},()=>{let p=At[o]},()=>{let p=o/10},()=>{let p=o}][i+c&3]||(()=>{}))()})}).add([127,1,54,17],(t,n,h)=>{e.switchMode("s90es");let i="S90/Motif ES variation ",o=t[0];t.subarray(1).forEach((c,d)=>{([()=>{e.setEffectTypeRaw(2,!1,c&15|128)},()=>{e.setEffectTypeRaw(2,!0,c)}][o+d]||(()=>{}))()}),e.pushEffectType(2)}).add([127,1,55],(t,n,h)=>{e.invokeSysExIndicator(),e.switchMode("s90es");let i=e.getTrackPort(n);if(r(e,Q)[i]&&r(e,Q)[i]!==r(e,U).smotif)if(r(e,Ne).dumpLimit===e.DUMP_MODE){console.warn(`Dump cancelled for track ${n}. Port ${String.fromCharCode(65+i)} mode "${q[r(e,Q)[i]]}" mismatch, should be "${q[r(e,U).smotif]}".`);return}else console.info(`Track ${n} is trying to perform a mismached mode dump on port ${String.fromCharCode(65+i)}.`);let o=e.chRedir(t[0],n,!0),c=G[o],d=t[1];t[0]>15&&(o=t[0]+32);let m=`Track ${n} S90/Motif ES bulk CH${o<128?o+1:"U"+(o-127)} `;console.debug(m,t),!(t[0]>15)&&t.subarray(2).forEach((p,k)=>{([()=>{e.setChCc(o,0,p),e.pushChPrimitives(o)},()=>{p&&e.setChActive(o,1),e.setChCc(o,32,p),e.getChPrimitive(o,1)===63&&e.setChType(o,[32,40].indexOf(p)>-1?e.CH_DRUMS:e.CH_MELODIC,r(e,H),!0),e.pushChPrimitives(o)},()=>{p&&e.setChActive(o,1),r(e,_)[o]=p,e.pushChPrimitives(o)},()=>{let v=e.chRedir(p,n,!0),I=r(e,V)[o];r(e,V)[o]=v,(o!==v||v!==I)&&(e.buildRchTree(),console.info(`${m}receives from CH${v+1}`))},()=>{r(e,oe)[o]=p?0:1},!1,!1,!1,!1,!1,!1,!1,!1,()=>{p!==100&&e.setChActive(o,1),r(e,x)[c+T[7]]=p},()=>{p!==64&&e.setChActive(o,1),r(e,x)[c+T[10]]=p},!1,!1,!1,()=>{r(e,x)[c+T[91]]=p},()=>{p&&e.setChActive(o,1),r(e,x)[c+T[93]]=p},()=>{p&&e.setChActive(o,1),r(e,x)[c+T[94]]=p},()=>{e.setChCc(o,128,p),p!==127&&(e.setChActive(o,1),e.allocateAce(o,128))},()=>{},()=>{p!==64&&e.setChActive(o,1),r(e,x)[c+T[74]]=p},()=>{p!==64&&e.setChActive(o,1),r(e,x)[c+T[71]]=p},!1,()=>{r(e,x)[c+T[65]]=p},()=>{r(e,x)[c+T[5]]=p},()=>{}][d+k]||(()=>{}))()})}),r(e,re).add([100,14],(t,n,h)=>{let o;e.switchMode("cs6x"),e.setPortMode(e.getTrackPort(n),1,S.cs6x);let i=(o=["normal voice","plugin voice PLG","drums",,"performance",,"phrase clip"][t[0]>>4])!=null?o:"invalid";t[0]&!0?i+=" edit buffer":t[0]>>4==1?i+=`${(t[0]&1)+1}`:i+=` ${["INT","EXT"][t[0]&1]}`,console.debug(`CS6x bulk dump for ${i} started.`)}).add([100,15],(t,n,h)=>{let o;e.switchMode("cs6x");let i=(o=["normal voice","plugin voice PLG","drums",,"performance",,"phrase clip"][t[0]>>4])!=null?o:"invalid";t[0]&!0?i+=" edit buffer":t[0]>>4==1?i+=`${(t[0]&1)+1}`:i+=` ${["INT","EXT"][t[0]&1]}`,console.debug(`CS6x bulk dump for ${i} ended.`)}).add([100,76,112],(t,n,h)=>{e.switchMode("cs6x");let i=0,o=t[0];t.subarray(1).forEach((c,d)=>{let m=d+o;m<10?(e.setChCvnRegister(i,d,c&127),r(e,ke)[i]=1):m<12||m<13&&console.debug(`Plugin voice type: ${c}`)}),e.pushChPrimitives(i)}).add([100,76,0],(t,n,h)=>{e.switchMode("cs6x"),e.setPortMode(e.getTrackPort(n),1,S.cs6x);let i=0,o=t[0];t.subarray(1).forEach((c,d)=>{let m=d+o;([()=>{e.setChCc(i,7,c),c!==100&&e.setChActive(i,1)},,,()=>{r(e,oe)[i]=c==0,e.setChCc(i,64,0),r(e,te).ano(i),e.resetChAceAll(i)},,()=>{},,,()=>{e.setChCc(i,65,c?127:0)},()=>{e.setChCc(i,5,c)},,()=>{e.setChCc(i,91,c),c!==40&&e.setChActive(i,1)},()=>{e.setChCc(i,93,c),c&&e.setChActive(i,1)}][m]||(()=>{}))()})}).add([100,76,1],(t,n,h)=>{e.switchMode("cs6x");let i=0,o=t[0],c=!1;t.subarray(1).forEach((d,m)=>{let p=m+o;([()=>{e.setEffectTypeRaw(0,!1,d&15|128),c=!0},()=>{e.setEffectTypeRaw(0,!0,d),c=!0}][p]||(()=>{}))()}),c&&e.pushEffectType(0)}).add([100,76,2],(t,n,h)=>{e.switchMode("cs6x");let i=0,o=t[0],c=!1;t.subarray(1).forEach((d,m)=>{let p=m+o;([()=>{e.setEffectTypeRaw(1,!1,d&15|128),c=!0},()=>{e.setEffectTypeRaw(1,!0,d),c=!0}][p]||(()=>{}))()}),c&&e.pushEffectType(1)}).add([100,76,3],(t,n,h)=>{e.switchMode("cs6x");let i=0,o=t[0],c=!1;t.subarray(1).forEach((d,m)=>{let p=m+o;([()=>{e.setEffectTypeRaw(2,!1,d&15|128),c=!0},()=>{e.setEffectTypeRaw(2,!0,d),c=!0}][p]||(()=>{}))()}),c&&e.pushEffectType(2)}).add([100,76,5],(t,n,h)=>{e.switchMode("cs6x")}).add([100,76,16],(t,n,h)=>{e.switchMode("cs6x");let i=0,o=t[0],c=!1;if(t.subarray(1).forEach((d,m)=>{let p=m+o;([()=>{e.setChCc(i,0,d),c=!0},()=>{e.setChCc(i,32,d),c=!0,d&&e.setChActive(i,1)},()=>{r(e,_)[i]=d,c=!0,d&&e.setChActive(i,1)},()=>{r(e,N)[Rt[i]+ha[2]]=1,r(e,L)[Rt[i]+ha[2]]=d,d&&e.setChActive(i,1)}][p]||(()=>{}))()}),c){switch(e.pushChPrimitives(i),e.getChVoice(i).standard){case"DX":{r(e,ce)[i]=e.EXT_DX;break}case"VL":{r(e,ce)[i]=e.EXT_VL;break}}e.dispatchEvent("metacommit",{type:"OSysMeta",msg:"part.rename",data:{part:i}})}}).add([100,76,32],(t,n,h)=>{e.switchMode("cs6x");let i=0,o=t[0],c=r(e,ce)[i];switch(c){case e.EXT_DX:{t.length>2&&console.debug(t),t.subarray(1).forEach((d,m)=>{let p=m+o;if(p<6){let k=p+142;e.setChCc(i,k,d),d!==64&&e.allocateAce(i,k)}else if(p<12){let k=p+144;e.setChCc(i,k,d),d!==64&&e.allocateAce(i,k)}else([()=>{},()=>{},()=>{},()=>{}][p]||(()=>{}))()});break}case e.EXT_VL:{console.info(`Support for Modular System Plug-in writes is not yet present for plugin type ${c}.`);break}default:console.warn(`Unsupported plug-in type: ${c}`)}}),r(this,ve).add([0,72,18,0,0,0,0],(t,n,h)=>{e.switchMode("sd",2),e.setPortMode(e.getTrackPort(n),2,S.sd),console.info("MIDI reset: SD")}).add([0,72,18,16,0],(t,n,h)=>{e.invokeSysExIndicator();let i=t[0]>>5,o=t[0]&31;switch(i){case 0:{let c=t[0]>>1,d=t[1];switch(c){case 1:{t.subarray(2).forEach((m,p,k)=>{let v=p+d;switch(v){case 0:{m&&(e.setEffectType(1,60,m-1),e.pushEffectType(1),console.debug(`SD MFX Cho: ${v} - ${m}`));break}}});break}case 2:{t.subarray(2).forEach((m,p)=>{let k=p+d;switch(k){case 0:{m&&(e.setEffectType(0,55+m,0),e.pushEffectType(0),console.debug(`SD MFX Rev: ${k} - ${m}`));break}}});break}case 3:case 4:case 5:{let m=c-1;t.subarray(2).forEach((p,k)=>{let v=k+d;switch(console.debug(`SD MFX ${m-2}: ${v} - ${p}`),v){case 0:{e.setEffectTypeRaw(m,62,p),e.pushEffectType(m);break}}}),console.debug(`SD MFX message:
%o`,t);break}default:console.debug(`Unknown SD-90 global effects message:
%o`,t)}break}case 1:{let c=e.chRedir(o,n,!0),d=t[1],m=G[c];t.subarray(2).forEach((p,k)=>{let v=d+k;v<37?([()=>{},()=>{},0,()=>{},()=>{switch(p){case 104:case 105:case 106:case 107:case 120:case 128:{r(e,D)[c]||e.setChType(c,e.CH_DRUMS);break}default:r(e,D)[c]&&e.setChType(c,e.CH_MELODIC)}e.setChCc(c,0,p),e.pushChPrimitives(c)},()=>{e.setChCc(c,32,p),e.pushChPrimitives(c)},()=>{r(e,_)[c]=p},()=>{r(e,x)[m+T[7]]=p},()=>{r(e,x)[m+T[10]]=p},()=>{},()=>{},()=>{p<2&&(r(e,oe)[c]=p)},()=>{p<2&&(r(e,x)[m+T[68]]=p?127:0)},()=>{},()=>{p<2&&(r(e,x)[m+T[65]]=p?127:0)},()=>{r(e,x)[m+T[5]]=p&15<<4|r(e,x)[m+T[5]]&15},()=>{r(e,x)[m+T[5]]=p&15|(r(e,x)[m+T[5]]&240)>>4},()=>{r(e,x)[m+T[74]]=p},()=>{r(e,x)[m+T[71]]=p},()=>{r(e,x)[m+T[73]]=p},()=>{r(e,x)[m+T[72]]=p},0,0,0,0,0,0,0,()=>{r(e,x)[m+T[128]]=p,e.allocateAce(128)},()=>{r(e,x)[m+T[93]]=p},()=>{r(e,x)[m+T[91]]=p},0,0,()=>{r(e,x)[m+T[75]]=p},()=>{r(e,x)[m+T[76]]=p},()=>{r(e,x)[m+T[77]]=p},()=>{r(e,x)[m+T[78]]=p}][v]||(()=>{}))():v<63||(v<64?(r(e,D)[c]?(e.setChCc(c,0,104|p),e.pushChPrimitives(c)):(e.setChCc(c,0,96|p),e.pushChPrimitives(c)),e.pushChPrimitives(c)):console.debug(`Unknown SD-90 global CH${c+1} param setup message:
%o`,t))});break}case 2:{let c=e.chRedir(o,n,!0),d=t[1];console.debug(`Unknown SD-90 global CH${c+1} MIDI setup message:
%o`,t.subarray(2));break}default:console.warn(`Unknown SD-90 global part setup message:
%o`,t)}}),r(e,De).add([0,1,73,78],(t,n,h)=>{e.switchMode("krs",1),e.setPortMode(e.getTrackPort(n),1,S.krs),console.debug("Might be KORG KROSS 2 mode reset... Not sure.")}).add([0,1,73,117,2,37],(t,n,h)=>{e.switchMode("krs",1);let i=e.getTrackPort(n);if(r(e,Q)[i]&&r(e,Q)[i]!==S.krs)if(r(e,Ne).dumpLimit===e.DUMP_MODE){console.warn(`Dump cancelled. Port ${String.fromCharCode(65+i)} mode "${q[r(e,Q)[i]]}" mismatch, should be "krs".`);return}else console.info(`Track ${n} is trying to perform a mismached mode dump on port ${String.fromCharCode(65+i)}.`);e.setPortMode(e.getTrackPort(n),1,S.krs);let o="KROSS 2 BMT1 ",c="";Te(t,(d,m)=>{if(m<24)c+=String.fromCharCode(Math.max(32,d));else if(!(m<88)){if(m<468){let p=m-88,k=p*863>>16,v=p-k*76;([()=>{e.setEffectType(k+3,45,d),e.pushEffectType(k+3)},!1,()=>{console.debug(`${o}IFX${k+1} sends to ${d<=5&&d>0?`IFX${d}`:"direct out"}.`)}][v]||(()=>{}))()}else if(m<604){let p=m-468,k=p*964>>16,v=p-k*68;([()=>{e.setEffectType(1-k,45,d),e.dispatchEvent(["efxreverb","efxchorus"][1-k],{id:e.getEffectType(1-k)})},!1][v]||(()=>{}))()}else if(!(m<1276)){let p=m-1276,k=p*1490>>16,v=e.chRedir(k,n,!0),I=p-k*44;I<22?([()=>{d&&e.setChActive(v,1),r(e,_)[v]=d,e.pushChPrimitives(v)},()=>{d&&e.setChActive(v,1),d<10?(e.setChCc(v,0,63),e.setChCc(v,32,d)):d<20?(e.setChCc(v,0,121),e.setChCc(v,32,d-10)):d<24&&(e.setChCc(v,0,[120,0,56,62][d-20]),e.setChCc(v,32,0)),e.pushChPrimitives(v)},()=>{let R=e.chRedir(d&15,n,!0);r(e,V)[v]=R,R!==v&&console.info(`${o}CH${v+1} receives from CH${R+1}`);let ae=d>>5&1;e.modelEx.kross.chToggle&&(e.setChActive(v,ae),ae||console.debug(`KORG KROSS 2 CH${v+1} is disabled.`))},!1,!1,()=>{e.setChCc(v,7,d)},!1,()=>{},()=>{},!1,!1,!1,!1,!1,()=>{e.setChCc(v,10,d||128)}][I]||(()=>{}))():I<36?([()=>{let R=d&7;d&8&&(R=1),R>1&&console.debug(`${o}CH${v+1} sends to ${R>1?`IFX${R-1}`:"direct out"} (${d.toString(16)}).`),e.setChEffectSink(v,d>1&&d<7?d+1:0)}][I-22]||(()=>{}))():([()=>{e.setChCc(v,74,(d+128&255)-64)},()=>{e.setChCc(v,71,(d+128&255)-64)},!1,!1,()=>{e.setChCc(v,73,(d+128&255)-64)},()=>{e.setChCc(v,75,(d+128&255)-64)},!1,()=>{e.setChCc(v,72,(d+128&255)-64)}][I-36]||(()=>{}))()}}}),c=c.trimEnd(),e.dispatchEvent("metacommit",{type:"EORTitle",data:c})});let $=function(t,n,h){let i=e.chRedir(t,n,!0);e.setChMode(i,S.an1x),e.pushChPrimitives(i),console.debug(`Yamaha AN1x slot ${h+1} receives from CH${i+1}(${t+1}).`),e.modelEx.yPlg[3][h]=i};r(e,re).add([92,0,0],(t,n,h)=>{let i=t[0];t.subarray(1).forEach((o,c)=>{let d=c+i;d<2||([!1,!1,!1,!1,!1,!1,()=>{$(o,n,0)},()=>{$(o,n,1)}][d-2]||(()=>{}))()})}),r(e,re).add([75,80,0],(t,n,h)=>{let i=t[0];t.subarray(1).forEach((o,c)=>{let d=c+i;([()=>{e.modelEx.cs1x.perfCh=o,e.pushChPrimitives(o),console.debug(`Yamaha CS1x performance on CH${o+1}.`)},!1,!1,!1,()=>{},!1,()=>{switch(o){case 1:{e.switchMode("xg",2),e.setPortMode(e.getTrackPort(n),1,S.xg),console.debug("Yamaha CS1x set to XG mode.");break}case 3:{e.switchMode("cs1x",2),e.setPortMode(e.getTrackPort(n),1,S.cs1x),console.debug("Yamaha CS1x set to performance mode.");break}default:console.warn(`Unknown Yamaha CS1x mode: ${o}`)}},()=>{}][d]||(()=>{}))()})}).add([75,96,0],(t,n,h)=>{let i=t[0],o=!1,c=e.modelEx.cs1x.perfCh;t.subarray(1).forEach((d,m)=>{let p=m+i;p<8?(o=!0,r(e,ke)[c]=1,e.setChCvnRegister(c,p,d)):p<48?([!1,()=>{e.setChCc(c,7,d)}][p]||(()=>{}))():p<80?([()=>{e.setEffectTypeRaw(0,!1,d)},()=>{e.setEffectTypeRaw(0,!0,d),e.pushEffectType(0)},()=>{e.setEffectTypeRaw(1,!1,d)},()=>{e.setEffectTypeRaw(1,!0,d),e.pushEffectType(1)},()=>{e.setEffectTypeRaw(2,!1,d)},()=>{e.setEffectTypeRaw(2,!0,d),e.pushEffectType(2)}][p-48]||(()=>{}))():B()&&console.debug(`Unknown CS1x effect register: ${p}.`)}),o&&(e.setChActive(c,1),e.pushChPrimitives(c))});let C=(t,n,h)=>{let i=0;h.forEach((o,c)=>{([()=>{i=(o&1)<<7|i&127,e.setEffectTypeRaw(t,!1,28),e.setEffectTypeRaw(t,!0,i)},()=>{i=i&128|o&127,e.setEffectTypeRaw(t,!1,28),e.setEffectTypeRaw(t,!0,i),e.pushEffectType(t)}][c+n]||(()=>{}))()})};r(e,De).add([96,0,1],(t,n,h)=>{let i=t[0];switch(t[1]){case 0:{C(0,t[2],t.subarray(3)),console.debug(`Partially parsed KORG PA EFX SysEX:
`,t);break}case 1:{C(1,t[2],t.subarray(3)),console.debug(`Partially parsed KORG PA EFX SysEX:
`,t);break}case 2:{C(2,t[2],t.subarray(3)),console.debug(`Partially parsed KORG PA EFX SysEX:
`,t);break}case 3:{C(3,t[2],t.subarray(3)),console.debug(`Partially parsed KORG PA EFX SysEX:
`,t);break}default:console.debug(`Unparsed KORG PA SysEX:
`,t)}})}get lcdContrast(){return r(this,jt)}set lcdContrast(e){(e<0||e>=da.length)&&(e=da.length-1),M(this,jt,e),this.dispatchEvent("lcdcontrast",e)}get detect(){return structuredClone(r(this,U))}chRedir(e,a,s){let l=this;if(r(l,et)[a])return(r(l,et)[a]-1)*16+e;if(r(l,H)===S.sc||r(l,H)===S.sd){if(s===1)return e;for(let y=0;y<E.ch;y++)if(r(l,He)[y]===a)return y&112|e&15;let f=0,b=!0;for(;b;)r(l,He)[e+f]===0?(r(l,He)[e+f]=a,console.info(`Allocated track ${a} to channel ${e+f+1}.`),b=!1):r(this,He)[e+f]===a?b=!1:(f+=16,f>=128&&(f=0,b=!1));return e+f}else return e}getTrackPort(e){return this.chRedir(0,e,!0)>>4}forceVoiceRefresh(){for(let e=0;e<E.ch;e++)r(this,be)[e]&&this.dispatchEvent("voice",{part:e})}buildRchTree(){let e=[];r(this,V).forEach((a,s)=>{let l;a<E.ch&&((l=e[a])!=null&&l.constructor||(e[a]=[]),e[a].push(s))}),M(this,aa,e)}buildRccMap(){let e=this;for(let a=0;a<E.ch;a++)r(e,yt)[a]={};r(e,pt).forEach((a,s)=>{a&&(r(e,yt)[Math.floor(s/E.redir)][a]=s%E.redir|128)}),B()&&console.debug(r(e,yt))}invokeSysExIndicator(){this.dispatchEvent("mupromptex",r(this,Ht))}getActive(){return r(this,be)}getChActive(e){return r(this,be)[e]}getCc(e){if(typeof e!="number"||e<0||e>=E.ch)throw new RangeError(`Invalid part number: CH${e+1}`);let a=this,s=G[e];return r(a,x).subarray(s,s+E.cc)}getChCc(e,a){let s=this;if(ht.indexOf(a)<0)throw new Error("CC number not accepted");return r(s,x)[G[e]+T[a]]}getChCcWritten(e,a){let s=this;if(ht.indexOf(a)<0)throw new Error("CC number not accepted");return r(s,x)[E.chcc+G[e]+T[a]]}setChCc(e=0,a,s){let l=this;if(ht.indexOf(a)<0)throw new Error("CC number not accepted");if((s==null?void 0:s.constructor)!==Number)throw new TypeError("Expected numbers for value");let f=s&255,b=G[e]+T[a];r(l,x)[b]=f,r(l,x)[b+E.chcc]=1,l.dispatchEvent("cc",{part:e,cc:a,data:f})}getCcAll(){return r(this,x).slice()}resetCc(e){let a=this,s=G[e]+E.chcc;r(a,x).fill(0,s,s+E.cc)}resetChCc(e,a,s){let l=this;s!=null&&s.constructor&&l.setChCc(e,a,s),r(l,x)[G[e]+T[a]+E.chcc]=0}resetCcAll(){r(this,x).fill(0,E.chcc,E.chcc<<1)}isChCcWritten(e,a){if(ht.indexOf(a)<0)throw new Error("CC number not accepted");return r(upThis,x)[G[e]+T[a]+E.chcc]}getChSource(){return r(this,V)}getChType(e=0){return r(this,D)[e]}getChTypes(){return r(this,D)}setChType(e,a,s=0,l=!1){a&=15;let f=this;s=s||f.getChModeId(e),r(f,D)[e]=a,a>0&&!l&&(f.setChCc(e,0,r(f,j)[s][2]),f.pushChPrimitives(e))}setChActive(e,a=0){r(this,be)[e]!==a&&this.dispatchEvent("channeltoggle",{part:e,active:a}),r(this,be)[e]=a}getExt(e){let a=E.ext*e,s=r(this,ce).subarray(a,a+E.ext),l=new Uint8Array(s.length);switch(l.set(s),l[0]){case this.EXT_VL:{l[1]=l[1]||this.modelEx.vl.breath;break}}return l}getProgram(){return r(this,_)}getTexts(){return r(this,Ee).slice()}getVel(e){let a=new Map,s=this;return r(s,Z).forEach(function(l,f){let b=l>>7,y=l&127;e===b&&r(s,ee)[l]>0&&a.set(y,{v:r(s,ee)[l],s:r(s,F)[f]})}),a}getBitmap(){return{bitmap:r(this,Fe,Bt),expire:r(this,Ae)}}getLetter(){return{text:r(this,Ze),set:r(this,ta),expire:r(this,je)}}getMode(){return q[r(this,H)]}getMaster(){return{volume:r(this,W)}}getRpn(){return r(this,L)}getNrpn(){return r(this,Dt)}getSubDb(){return self==null?void 0:self.structuredClone(r(this,j))}getDetect(){return self==null?void 0:self.structuredClone(r(this,U))}getVoice(e,a,s,l="?",f=0){let n;let b=this;(n=S[l])!=null&&n.constructor||(l="?");let y=S[l],w=e||r(b,j)[y][0],$=a,C=s||r(b,j)[y][1];w===Le.bank0&&(w=0),C===Le.bank0&&(C=0),l==="ns5r"&&w>0&&w<56&&(C=3);let t=b.userBank.get(w,$,C,l,f);if(l==="mt32"&&t.name.indexOf("MT-m:")===0){let h=parseInt(t.name.slice(5)),i=h*E.cmt,o="";r(b,Je).subarray(i,i+10).forEach(d=>{d>31&&(o+=String.fromCharCode(d))});let c=`MSB	LSB	PRG	NME
49	127	${$}	${o}`;b.userBank.load(c,!0),t.name=o,t.ending=" "}return(t.ending!==" "||!t.name.length)&&(t=b.baseBank.get(w,$,C,l,f)),t}getChPrimitive(e,a,s){if(a>=E.vxPrim||(a==null?void 0:a.constructor)!==Number)throw new RangeError(`Invalid voice primitive component "${a}"`);if(typeof e!="number"||e<0||e>=E.ch)throw new RangeError(`Invalid part number: CH${e+1}`);let l=this,f=r(l,_)[a<<E.chShift|e];switch(a){case 1:case 2:{l.getChCcWritten(e,[255,0,32][a])||(f=f||r(l,j)[l.getChModeId(e)][a+2]),s&&(f=f||r(l,j)[l.getChModeId(e)][a-1]),f===Le.bank0&&(f=0);break}}return f}getChPrimitives(e,a){let s=this,l=new Uint8Array(3);return l[1]=r(s,_)[e],l[0]=s.getChPrimitive(e,1,a),l[2]=s.getChPrimitive(e,2,a),l}pushChPrimitives(e){let a=this;r(a,_)[1<<E.chShift|e]=a.getChCc(e,0),r(a,_)[2<<E.chShift|e]=a.getChCc(e,32),a.dispatchEvent("voice",{part:e})}getChCvnBuffer(e,a=E.cvn){if(a>E.cvn||a<1)throw new RangeError("Invalid custom voice name buffer length");let s=It[e];return r(this,mt).subarray(s,s+a)}getChCvnRegister(e,a){if(a>=E.cvn||a<0)throw new RangeError("Invalid custom voice name register");return r(this,mt)[It[e]+a]}setChCvnRegister(e,a,s=32){if(a>=E.cvn||a<0)throw new RangeError("Invalid custom voice name register");r(this,Ut)[e]=1,r(this,mt)[It[e]+a]=Math.max(32,s&255)}resetChCvn(e){r(this,mt).fill(32,It[e],It[e]+E.cvn),r(this,Ut)[e]=0}getChCvnString(e,a){let s=Zr.decode(this.getChCvnBuffer(e));return a||(s=s.trimEnd()),s}getChCvnIsWritten(e){return r(this,Ut)[e]}getChVoice(e){let l,f;let a=this,s=a.getVoice(...a.getChPrimitives(e),a.getChMode(e),(f=(l=a.modelEx[a.getChMode(e)])==null?void 0:l.map)!=null?f:0);if(r(a,ke)[e]){let b="";switch(r(a,H)){case S.mt32:{r(a,Be).subarray(E.cmt*(e-1),E.cmt*(e-1)+10).forEach(y=>{b+=String.fromCharCode(Math.max(y,32))}),b=b.trimEnd();break}default:b=a.getChCvnString(e)}b.length&&(s.ending="~",s.name=b)}return s}getRawPitch(){return r(this,qe)}getPitchShift(e){let a=this,s=e*E.rpn,l=r(a,L)[s];return r(a,N)[e*E.rpnt]?l>>7&&(l-=256):r(a,H)===S.mt32&&(l=12),r(a,qe)[e]/8192*l+(r(a,L)[s+3]-64)+((r(a,L)[s+1]<<7)+r(a,L)[s+2]-8192)/8192}getEffectType(e=0){let a=3*e+1;return r(this,ye).subarray(a,a+2)}getPolyState(e=0){return r(this,F)[e]}setEffectTypeRaw(e=0,a,s){let l=3*e;r(this,ye)[l]=1,r(this,ye)[l+1+ +a]=s}setEffectType(e=0,a,s){this.setEffectTypeRaw(e,!1,a),this.setEffectTypeRaw(e,!0,s)}pushEffectType(e=0,a=!1){if(e<0||e>=E.efx)throw new RangeError(`Invalid EFX slot ${e}`);let s=this.getEffectType(e);a||s[0]===0&&s[1]>>4===15&&(a=!0),this.dispatchEvent(`efx${Zt[e]}`,{id:s,hidden:a})}getEffectSink(){return r(this,ut)}getChEffectSink(e){return r(this,ut)[e]}setChEffectSink(e,a=0){let s=this;if(a<0||a>=E.efx)throw new RangeError(`Invalid EFX slot ${a}`);if(e<0||e>=E.ch)throw new RangeError(`Invalid CH${e+1}`);r(this,ut)[e]=a,this.dispatchEvent("partefxtoggle",{part:e,active:a})}setXgChEffectSink(e,a=0){let s=this,l=s.modelEx.xg,f=a-2;if(a<0||f>=l.insPart.length)throw new RangeError(`Invalid XG insertion slot ${f}`);let b=l.insPart[f];l.insPart[f]=e,b!==E.invalidCh&&s.setChEffectSink(b,0),e===E.invalidCh?b!==E.invalidCh&&s.setChEffectSink(b,0):s.setChEffectSink(e,a)}setLetterDisplay(e,a,s=0,l=3200){let f=this,b;M(f,Ze," ".repeat(s)),e.forEach(y=>{M(f,Ze,r(f,Ze)+String.fromCharCode(y>31?y:32)),y<32&&(b=b||new Set,b.add(y))}),M(f,ta,f.clockSource.now()),M(f,je,f.clockSource.now()+l),f.dispatchEvent("letter"),b&&(b=Array.from(b),b.forEach((y,w,$)=>{$[w]=y.toString(16).padStart(2,"0")}),console.warn(`${a}${a?" ":""}invalid code point${b.length>1?"s":""}: 0x${b.join(", 0x")}`))}setDetectionTargets(e="?",a=0){let s=this,l=-1;switch(e.replaceAll(", ",",").split(",").forEach(f=>{f=f.toLowerCase();let b=q.indexOf(Fr[f]||f);B()&&console.debug(`Mapped mode "${f}" to ID "${b}".`),b>-1&&(l=b)}),B()&&console.debug(`Set detection target to ID "${l}".`),l>0&&(r(s,U).x5=82,r(s,U).ds=S.krs,r(s,U).gm=S.gm,r(s,U).g2=S.g2),l){case S["05rw"]:{r(s,U).x5=81;break}case S.s90es:{r(s,U).ds=S.s90es,r(s,U).smotif=S.s90es;break}case S.motif:{r(s,U).ds=S.motif,r(s,U).smotif=S.motif;break}case S.sd:{r(s,U).g2=S.sd;break}case S.pa:{r(s,U).g2=S.pa;break}}}setGsTargets(e=!1,a=4){if(!a)a=e?3:4;else{if(a>4||a<0)throw new Error(`Invalid GS level ${a}`);if(e&&a>>1!==1)throw new Error(`Invalid SC level ${a}`)}let s=this;r(s,U)[e?"sc":"gs"]=a,r(s,j)[S[e?"sc":"gs"]][1]=a,s.forceVoiceRefresh()}getConfigs(){return r(this,ea)}setDumpLimit(e){if(e>2||e<0)throw new RangeError("Invalid dump limit.");r(this,Ne).dumpLimit=e}allocateAce(e=0,a){let s=this;if(!a||a<128&&a>95){console.warn(`cc${a} cannot be allocated as an active custom effect.`);return}let l=!0,f=0,b=E.ace*e;for(;l&&f<E.ace;)r(s,ie)[f+b]===a?l=!1:r(s,ie)[f+b]||(l=!1,r(s,ie)[f+b]=a,console.debug(`Allocated cc${a} to ACE slot ${f} in CH${e+1}.`)),f++;f>=E.ace&&console.warn(`ACE slots are full in CH${e+1}.`)}allocateAceAll(e){let a=this;if(!e||e<128&&e>95){console.warn(`cc${e} cannot be allocated as an active custom effect.`);return}for(let s=0;s<E.ch;s++){let l=!0,f=0,b=E.ace*s;for(;l&&f<E.ace;)r(a,ie)[f+b]===e?l=!1:r(a,ie)[f+b]||(l=!1,r(a,ie)[f+b]=e),f++;f>=E.ace&&console.warn(`ACE slots are full in CH${s+1}.`)}}resetAce(){r(this,ie).fill(0),console.info("All ACE slots have been reset.")}resetChAceAll(e=0){r(this,ie).subarray(fa[e],fa[e]+E.ace).fill(0)}resetChAce(e=0,a){let s=!0,l=fa[e],f=l+E.ace;for(;s&&l<f;)r(this,ie)[l]===a&&(r(this,ie)[l]=0,s=!1),l++;s&&B()&&console.debug(`No ACE slot was allocated to cc${a} in CH${e+1}.`)}getAce(){return r(this,ie)}getChAce(e=0,a=0){if(a<0||a>=E.ace)throw new RangeError("No such ACE slot");let s=r(this,ie)[E.ace*e+a];if(s){if(ht.indexOf(s)>=0)return this.getChCc(e,s);throw new Error(`Invalid ACE source in CH${e+1}: ${s}`)}else return 0}initDrums(){let e=this;r(e,he).fill(64);for(let a=0;a<E.drm;a++){let s=a*E.dpn;for(let l in lr){let f=lr[l],b=(s+we[l])*E.dnc;r(e,he).subarray(b,b+E.dnc).fill(f)}}}init(e=0){let a=this;M(a,bt,0),r(a,j)[S.xg][1]=0,a.modelEx.xg.map=0,a.dispatchEvent("banklevel",{mode:"xg",data:a.modelEx.xg.map}),r(a,be).fill(0),r(a,x).fill(0),r(a,ie).fill(0),r(a,_).fill(0),r(a,ee).fill(0),r(a,Z).fill(0),r(a,F).fill(0),r(a,oe).fill(0),r(a,_e).fill(0),r(a,qe).fill(0),r(a,Dt).fill(0),r(a,N).fill(0),r(a,ce).fill(0),r(a,Q).fill(0),r(a,Lt).fill(0),r(a,gt).fill(0),r(a,pt).fill(0),M(a,W,100),M(a,Ee,[]),M(a,_t,500),a.modelEx.sg.convLastSyll=0,a.modelEx.sg.runLineLen=0,a.modelEx.sg.splitMask=!1,M(a,Ae,0),M(a,ne,0),a.lcdContrast=16,a.lcdHideBankInfo=!1;for(let s=0;s<r(a,Re).length;s++)r(a,Fe,Bt).fill(0);M(a,K,a.KARAOKE_NONE),M(a,Nt,0),M(a,Ce,!0),M(a,J,!1),M(a,Ht,0),a.initDrums(),a.polyIndexLatest=0,a.polyIndexLast=0,r(a,V).forEach(function(s,l,f){f[l]=l}),e===0&&(a.dispatchEvent("mode","?"),M(a,H,0),r(a,He).fill(0),r(a,et).fill(0),M(a,je,0),M(a,Ze,"")),Yr.forEach(s=>{a.setChCc(s,0,r(a,j)[a.getChModeId(s)][2])}),r(a,D).fill(a.CH_MELODIC),r(a,D)[9]=a.CH_DRUM1,r(a,D)[25]=a.CH_DRUM3,r(a,D)[41]=a.CH_DRUMS,r(a,D)[57]=a.CH_DRUMS,r(a,D)[73]=a.CH_DRUM5,r(a,D)[89]=a.CH_DRUM7,r(a,D)[105]=a.CH_DRUMS,r(a,D)[121]=a.CH_DRUMS;for(let s=0;s<E.drm;s++)r(a,Ie)[s<<1]=0,r(a,Ie)[s<<1|1]=E.invalidCh;r(a,Ot).fill(0),r(a,Je).fill(0),r(a,Qe).fill(0),r(a,Be).fill(0),r(a,ke).fill(0),r(a,ye).fill(0),r(a,ut).fill(0),a.aiEfxName="",a.userBank.clearRange({msb:0,lsb:127,prg:[0,127]}),a.modelEx.xg.varSys=!1,a.modelEx.xg.insPart.fill(E.invalidCh);for(let s=0;s<Me.length;s++){let l=a.modelEx.yPlg[s];l.fill(0,0,Me[s][2]),l.fill(E.invalidCh,Me[s][2])}a.modelEx.sc.showBar=!0,a.modelEx.sc.invBar=!1,a.modelEx.sc.invDisp=!1,a.modelEx.sc.peakHold=1,a.modelEx.cs1x.perfCh=0;for(let s=0;s<E.ch;s++){a.resetChCvn(s);let l=G[s];r(a,x)[l+T[7]]=100,r(a,x)[l+T[11]]=127,r(a,x)[l+T[2]]=127,r(a,x)[l+T[10]]=64,r(a,x).subarray(l+T[71],l+T[71]+8).fill(64),r(a,x)[l+T[128]]=127,r(a,x).subarray(l+T[130],l+T[157]+1).fill(64),r(a,x)[l+T[91]]=40,r(a,x)[l+T[101]]=127,r(a,x)[l+T[100]]=127,r(a,x)[l+T[99]]=127,r(a,x)[l+T[98]]=127;let f=s*E.rpn;r(a,L)[f]=2,r(a,L)[f+1]=64,r(a,L)[f+2]=0,r(a,L)[f+3]=64,r(a,L)[f+4]=0,r(a,L)[f+5]=0;let b=s*E.ext;r(a,ce)[b+1]=a.VLBC_BRTHEXPR;let y=s*E.redir;r(a,pt)[y+8]=13}a.switchMode("?",3),a.buildRchTree(),a.buildRccMap(),a.dispatchEvent("mastervolume",r(a,W));for(let s=0;s<Zt.length;s++)a.pushEffectType(s);a.dispatchEvent("reset")}setChMode(e,a){let s=this;if(typeof e!="number"||e<0||e>=E.ch)throw new RangeError(`Invalid part number: CH${e+1}`);if(e<0||a>=q.length)throw new RangeError(`Invalid mode ID ${a}`);r(s,gt)[e]=a,s.dispatchEvent("chmode",{part:e,id:a,mode:q[a]}),s.pushChPrimitives(e)}getChMode(e,a){return q[this.getChModeId(e,a)]}getChModeId(e,a){return a?r(this,gt)[e]||r(this,Q)[e>>4]:r(this,gt)[e]||r(this,Q)[e>>4]||r(this,H)}getPortMode(e,a){return q[this.getPortModeId(e,a)]}getPortModeId(e,a){return a?r(this,Q)[e]:r(this,Q)[e]||r(this,H)}setPortMode(e,a,s){let l=this;if(e<0||e>=E.ch>>4)throw new RangeError(`Invalid port ${e+1}`);if(a<1)throw new RangeError("Range must be a positive integer");if(e+a>=E.ch>>4)throw new RangeError("Range must be in bound");if(e<0||s>=q.length)throw new RangeError(`Invalid mode ID ${s}`);r(l,Lt)[e]=s;for(let f=e;f<e+a;f++){let b=r(l,Lt)[f];if(a>1&&b!==0&&b!==s)break;r(l,Q)[f]=s;for(let y=f<<4;y<f+1<<4;y++)l.dispatchEvent("chmode",{part:y,id:s,mode:q[s]}),l.pushChPrimitives(y)}}copyChSetup(e,a,s){if(e===a){console.warn(`Failed attempt at overwriting CH${e+1} with its own data.`);return}let l=this;if(s&&r(l,be)[a]){console.warn(`Failed attempt at copying setup data from CH${e+1} to CH${a+1}.`);return}let f=G[e],b=G[a];r(l,_)[a]=r(l,_)[e],r(l,x).set(r(l,x).subarray(f,f+E.cc),b),l.pushChPrimitives(a)}setDrumFirstWrite(e,a){let s=this,l=r(s,D)[e];if(l<2)return;let f=l-2;if(r(s,Ie)[f<<1])if(a)r(s,Ie)[f<<1]=0,B()&&console.debug(`First write part for drum set ${f+1} has been reset.`);else return;else a?console.warn(`First write part for drum set ${f+1} is already blank.`):(r(s,Ie)[f<<1]=1,r(s,Ie)[f<<1|1]=e,console.debug(`First write part for drum set ${f+1} is set to CH${e+1}.`))}getChDrumFirstWrite(e){let a=this,s=r(a,D)[e];if(s<2)return;let l=s-2;return r(a,Ie).subarray(l<<1,l+1<<1)}getDrumFirstWrite(e){if(e>=0&&e<E.drm)return r(this,Ie).subarray(e<<1,e+1<<1)}switchMode(e,a=0,s=!1){B()&&console.debug(`Requested level ${a} mode change to "${e}".`);let l=this,f=S[e];if(f>-1){if(r(l,H)===0&&a!==3||a){if(l.initOnReset)switch(a){case 1:{r(l,H)===0&&l.init(1);break}case 2:{l.init(1);break}}switch(M(l,ne,0),f){case S.gm:{f=r(l,U).gm;break}case S.g2:{f=r(l,U).g2;break}}switch(M(l,H,f),f){case S.gs:case S.sc:{r(l,j)[S[e]][1]=r(l,U)[e];break}}for(let w=0;w<E.ch;w++){let $=l.getChModeId(w,!0);r(l,D)[w]>0&&$===S["?"]&&(l.setChCc(w,0,r(l,j)[f][2]),B()&&console.debug(`CH${w+1} (${r(l,D)[w]}) (${l.getChMode(w)}), ${q[$]} (${r(l,j)[$][2]}) -> ${q[f]} (${r(l,j)[f][2]})`),l.pushChPrimitives(w))}switch(f){case S.mt32:{va.forEach((w,$)=>{let C=$+1;r(l,be)[C]||(r(l,_)[C]=w,l.setChCc(C,91,127),l.pushChPrimitives(C))});for(let w=1;w<10;w++)l.pushChPrimitives(w);break}}let b,y;switch(f){case S["?"]:case S.g2:{b=[52,4,52,18,0,255,0,255,0,255,0,255,0,255,0,255];break}case S.xg:case S.cs1x:{b=[1,0,65,0,5,0,64,0,64,0,64,0,64,0,0,255],y=[64,0];break}case S.gm:case S.gs:case S.sc:{b=[40,4,40,18,40,32,32,0,0,255,0,255,0,255,0,255],y=[32,0];break}case S.sd:{b=[58,0,60,0,61,0,61,0],y=[61,0];break}case S["05rw"]:case S.x5d:case S.ns5r:{b=[44,1,44,19,0,255,0,255,0,255,0,255,0,255,0,255];break}case S.k11:case S.sg:{b=[24,0,0,255,0,255,0,255,0,255,0,255,0,255,0,255];break}case S.mt32:{b=[40,4,0,255,0,255,0,255,0,255,0,255,0,255,0,255];break}case S.doc:{b=[24,16,0,255,0,255,0,255,0,255,0,255,0,255,0,255];break}case S.motif:case S.s90es:case S.cs6x:{b=[129,0,133,0,130,0,128,0,128,0,0,255,0,255,0,255],y=[128,0];break}case S.pa:{b=[28,52,28,16,28,0,28,0,0,255,0,255,0,255,0,255],y=[28,0];break}case S.krs:{b=[45,0,45,0,0,255,45,0,45,0,45,0,45,0,45,0],y=[45,0];break}default:b=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}for(let w=0;w<E.efx;w++)if(!r(l,ye)[3*w]&&typeof b[w<<1]=="number"){r(l,ye)[3*w+1]=b[w<<1],r(l,ye)[3*w+2]=b[w<<1|1];let $=!1;(y==null?void 0:y.length)>0&&b[w<<1]===y[0]&&b[w<<1|1]===y[1]&&($=!0),l.pushEffectType(w,$)}s&&l.setDetectionTargets(e),l.dispatchEvent("mode",q[f]),l.forceVoiceRefresh()}}else throw new Error(`Unknown mode ${e}`)}getRawStrength(){let e=this;return r(this,Z).forEach(function(a){let s=a>>7;r(e,ee)[a]>r(e,_e)[s]&&(r(e,_e)[s]=r(e,ee)[a])}),r(this,_e)}getStrength(){let e=[],a=this;return this.getRawStrength().forEach(function(s,l){e[l]=Math.floor(s*a.getChCc(l,7)*a.getChCc(l,11)*r(a,W)/803288)}),e}newStrength(){r(this,_e).fill(0)}runJson(e){let a;if(e==null){console.warn(new Error("Invalid JSON data provided."));return}if(e.type>14)return e.type===15&&e.data.constructor!==Uint8Array&&(e.data=Uint8Array.from(e.data)),r(this,ra)[e.type].call(this,e);{let s=this.chRedir(e.part,e.track),l=!1;(a=r(this,aa)[s])==null||a.forEach(f=>{e.channel=f,l=!0,r(this,ra)[e.type].call(this,e)}),l||console.warn(`${nr[e.type]?nr[e.type]:e.type}${[11,12].includes(e.type)?(e.data[0]!==void 0?e.data[0]:e.data).toString():""} event sent to CH${s+1} without any recipient.`)}r(this,Ee).length>100&&r(this,Ee).splice(100,r(this,Ee).length-99)}runRaw(e){}async loadBank(e,a){let s=this;switch(e=e.toLowerCase(),e){case"s7e":{s.userBank.clearRange({msb:63,lsb:[21,22]}),s.userBank.clearRange({msb:63,lsb:[24,27]});break}case"pcg":{s.userBank.clearRange({msb:63,lsb:[6,9]}),s.userBank.clearRange({msb:63,lsb:[13,16]});break}default:throw new Error(`Unknown bank format ${e}`)}switch(e){case"s7e":case"pcg":{Yt.context=this,await s.userBank.load(await Yt.read(e,a),!1);break}}s.forceVoiceRefresh()}},H=new WeakMap,ne=new WeakMap,Ae=new WeakMap,Re=new WeakMap,Fe=new WeakSet,Bt=function(){return r(this,Re)[r(this,ne)]},as=function(e){r(this,Re)[r(this,ne)]=e},jt=new WeakMap,be=new WeakMap,V=new WeakMap,D=new WeakMap,x=new WeakMap,ie=new WeakMap,_=new WeakMap,ee=new WeakMap,oe=new WeakMap,Z=new WeakMap,F=new WeakMap,qe=new WeakMap,_e=new WeakMap,ft=new WeakMap,ce=new WeakMap,L=new WeakMap,N=new WeakMap,Dt=new WeakMap,he=new WeakMap,Ie=new WeakMap,ye=new WeakMap,ut=new WeakMap,pt=new WeakMap,Q=new WeakMap,Lt=new WeakMap,gt=new WeakMap,ke=new WeakMap,mt=new WeakMap,Ut=new WeakMap,Qe=new WeakMap,Be=new WeakMap,Ot=new WeakMap,Je=new WeakMap,j=new WeakMap,U=new WeakMap,Ne=new WeakMap,ea=new WeakMap,W=new WeakMap,bt=new WeakMap,_t=new WeakMap,Sa=new WeakMap,Ta=new WeakMap,Ma=new WeakMap,Pa=new WeakMap,Ze=new WeakMap,je=new WeakMap,ta=new WeakMap,Nt=new WeakMap,Ce=new WeakMap,K=new WeakMap,aa=new WeakMap,J=new WeakMap,Ht=new WeakMap,yt=new WeakMap,Ee=new WeakMap,He=new WeakMap,et=new WeakMap,le=new WeakMap,Et=new WeakMap,te=new WeakMap,ra=new WeakMap,ua=new WeakMap,wt=new WeakMap,kt=new WeakMap,re=new WeakMap,ve=new WeakMap,De=new WeakMap,Ct=new WeakMap,vt=new WeakMap,$t=new WeakMap,ur);let La=Ir(pr(),1);O();O();let sa,gr,br=(gr=class{constructor(g,u,e,a){P(this,sa,!1);M(this,sa,g),this.start=u,this.end=e,this.data=a}get duration(){return this.ranged?this.end-this.start:0}get ranged(){return r(this,sa)}},sa=new WeakMap,gr),Ra=class extends br{constructor(g,u,e){super(!0,g,u,e)}},yr=class extends br{constructor(g,u){super(!1,g,g,u)}},xt,mr,Ia=(mr=class extends Array{constructor(){super(...arguments);P(this,xt,-1)}resetIndex(u){M(this,xt,-1)}fresh(){this.sort(function(u,e){return u.start==e.start?0:(+(u.start>e.start)<<1)-1}),this.forEach(function(u,e){u.index=e})}step(u,e=!1){let a=[];if(e)for(let s=0;s<this.length&&!(this[s].start>u);s++){if(this[s].end<u)continue;a.push(this[s])}else{let s=this.getRange(r(this,xt)==-1?0:u-1,u),l=this;s.forEach(function(f){f.index>r(l,xt)&&(a.push(f),M(l,xt,f.index))})}return a}getRange(u,e){let b;u>e&&([u,e]=[e,u]);let a=[],s=-1,l=Math.ceil(Math.sqrt(this.length)),f=!0;for(let y=0;y<this.length;y+=l)this[y+l]?s<0&&this[y+l].start>=u&&(s=y):s=s<0?y:s;for(;f;)((b=this[s])==null?void 0:b.end)<e?this[s].start>=u&&a.push(this[s]):f=!1,s++;return a}},xt=new WeakMap,mr);let rs=0xffffffffffff,Er=function(g){let u=new Ia,e=this,a=g.timeDivision,s=120,l=new Ia,f=0,b=0;l.push(new Ra(0,rs,[120,0])),g.track.forEach(function(C){f=0,C.event.forEach(function(t){f+=t.deltaTime,t.type===255&&(t==null?void 0:t.metaType)===81&&(s=6e7/t.data,l[l.length-1]&&l.push(new Ra(f,0xffffffffffff,[s,0])))})}),l.fresh(),l.forEach(function(C,t,n){t>0&&(n[t-1].end=C.start)});let y=120;l.forEach(function(C,t,n){t>0&&(C.end===C.start?n.splice(n.indexOf(C),1):y===C.data[0]&&(n[t-1].end=C.end,n.splice(n.indexOf(C),1)),y=C.data[0])});let w=0,$=120;return l.forEach(function(C){let t=C.start,n=t/$/a*60+w;$=C.data[0],w=n-t/$/a*60,C.data[1]=w}),console.debug("All tempo changes: ",l),s=120,f=0,b=0,g.track.forEach(function(C,t){f=0,b=0;let n=t+1;C.event.forEach(function(h,i){f+=h.deltaTime;let o=l.step(f,!0)[0];o&&(s=o.data[0],b=o.data[1]);let c={type:h.type,data:h.data,track:n,part:0};h.type>14?c.meta=h.metaType:c.part=h.channel,u.push(new yr(f/s/a*60+b,c))})}),u.fresh(),self.midiEvents=u,console.debug(`Parsed a type ${g.formatType} MIDI sequence.`),u};O();let ss={866:"cp866","utf-8":"utf-8",utf8:"utf-8","utf-16":"utf-16",utf16:"utf-16","utf-16le":"utf-16",utf16le:"utf-16",unicode:"utf-16",unicodefeff:"utf-16","ucs-2":"utf-16","utf-16be":"utf-16be",utf16be:"utf-16be","utf-24":"utf-24",utf24:"utf-24","utf-24le":"utf-24",utf24le:"utf-24","utf-24be":"utf-24be",utf24be:"utf-24be","utf-32":"utf-32",utf32:"utf-32","utf-32le":"utf-32",utf32le:"utf-32","utf-32be":"utf-32be",utf32be:"utf-32be",latin1:"latin1",l1:"latin1",ascii:"latin1","us-ascii":"latin1","iso-8859-1":"latin1","iso8859-1":"latin1",cp1252:"latin1","windows-1252":"latin1",cp819:"latin1",ibm819:"latin1",latin2:"latin2",l2:"latin2","iso-8859-2":"latin2","iso8859-2":"latin2",latin3:"latin3",l3:"latin3","iso-8859-3":"latin3","iso8859-3":"latin3",latin4:"latin4",l4:"latin4","iso-8859-4":"latin4","iso8859-4":"latin4",latin5:"latin5",l5:"latin5","iso-8859-9":"latin5","iso8859-9":"latin5",cp1254:"latin5","windows-1254":"latin5",latin6:"latin6",l6:"latin6","iso-8859-10":"latin6","iso8859-10":"latin6",latin9:"latin9",l9:"latin9","iso-8859-15":"latin9","iso8859-15":"latin9","iso-8859-5":"iso-8859-5","iso8859-5":"iso-8859-5",cyrillic:"iso-8859-5","iso-8859-6":"iso-8859-6","iso8859-6":"iso-8859-6","iso-8859-6-e":"iso-8859-6","iso8859-6e":"iso-8859-6","iso-8859-6-i":"iso-8859-6","iso8859-6i":"iso-8859-6","asmo-708":"iso-8859-6","ecma-114":"iso-8859-6",arabic:"iso-8859-6","iso-8859-7":"iso-8859-7","iso8859-7":"iso-8859-7","ecma-118":"iso-8859-7",greek:"iso-8859-7",greek8:"iso-8859-7","iso-8859-8":"iso-8859-8","iso8859-8":"iso-8859-8","iso-8859-8-e":"iso-8859-8","iso8859-8e":"iso-8859-8",hebrew:"iso-8859-8",visual:"iso-8859-8","iso-8859-8-i":"iso-8859-8-i","iso8859-8i":"iso-8859-8-i",logical:"iso-8859-8-i","iso-8859-11":"iso-8859-11","iso8859-11":"iso-8859-11","windows-874":"iso-8859-11","dos-874":"iso-8859-11",cp874:"iso-8859-11","tis-620":"iso-8859-11","iso-8859-13":"iso-8859-13","iso8859-13":"iso-8859-13",latin7:"iso-8859-13",l7:"iso-8859-13","iso-8859-14":"iso-8859-14","iso8859-14":"iso-8859-14",latin8:"iso-8859-14",l8:"iso-8859-14","iso-8859-16":"iso-8859-16","iso8859-16":"iso-8859-16",cp866:"cp866",ibm866:"cp866",cp1250:"cp1250","windows-1250":"cp1250",cp1251:"cp1251","windows-1251":"cp1251",cp1253:"cp1253","windows-1253":"cp1253",cp1255:"cp1255","windows-1255":"cp1255",cp1256:"cp1256","windows-1256":"cp1256",cp1257:"cp1257","windows-1257":"cp1257",cp1258:"cp1258","windows-1258":"cp1258","euc-jp":"euc-jp",cp954:"euc-jp","euc-kr":"euc-kr",koi8:"koi8",koi:"koi8","koi8-r":"koi8","koi8-u":"koi8-u","koi8-ru":"koi8-u",mac:"mac",macintosh:"mac","mac-cyrillic":"x-mac-cyrillic","x-mac-cyrillic":"x-mac-cyrillic","x-mac-ukrainian":"x-mac-cyrillic",gbk:"gbk",gb2312:"gbk",chinese:"gbk","euc-cn":"gbk",gb18030:"gb18030",big5:"big5","big5-hkscs":"big5",sjis:"sjis","shift-jis":"sjis",ms932:"sjis","windows-31j":"sjis"},is={"utf-8":1,"utf-16":2,"utf-16be":3,"utf-24":4,"utf-24be":5,"utf-32":6,"utf-32be":7,latin1:0,latin2:0,latin3:0,latin4:0,latin5:0,latin6:0,latin9:0,"iso-8859-5":0,"iso-8859-6":0,"iso-8859-7":0,"iso-8859-8":0,"iso-8859-8-i":0,"iso-8859-11":0,"iso-8859-13":0,"iso-8859-14":0,"iso-8859-16":0,cp866:0,cp1250:0,cp1251:0,cp1253:0,cp1255:0,cp1256:0,cp1257:0,cp1258:0,"euc-jp":1,"euc-kr":1,koi8:0,"koi8-u":0,mac:0,"x-mac-cyrillic":0,gbk:1,gb18030:1,big5:1,sjis:1},Ge,tt=(Ge=class{static getUnitSize(g){if(g>7)throw new RangeError("Cannot decode encodings with more than 4 bits per unit.");return(g>>1)+1}static isBigEndian(g){return(g&1)===1}static collapse(g){let u=ss[g];if(typeof u!="string")throw new TypeError(`Provided label "${g}" is not supported.`);return u}static indicator(g){let u=is[g];if(typeof u!="number")throw new TypeError(`Provided collapsed label "${g}" is not supported.`);return u}},A(Ge,"BYTE_1",0),A(Ge,"BYTE_1_VL",1),A(Ge,"BYTE_2_LE",2),A(Ge,"BYTE_2_BE",3),A(Ge,"BYTE_3_LE",4),A(Ge,"BYTE_3_BE",5),A(Ge,"BYTE_4_LE",6),A(Ge,"BYTE_4_BE",7),Ge),fe=(g,u)=>{g.unsent=!1,g.enqueue(u)},ga=(g,u,e=1,a=!0)=>{if(typeof e!="number"||e<=0||e>4)throw new RangeError(`Invalid byte size ${e}.`);if(!(g instanceof Uint8Array||g instanceof Uint8ClampedArray))throw new TypeError("Input buffer is not Uint8Array.");if(typeof u!="number"||u<0||u>=g.length)throw new RangeError(`Provided offset ${u} is out of buffer range.`);if(e===1)return g[u];{let s=0;if(a)for(let l=0;l<e;l++)s<<=8,s|=g[u+l];else for(let l=0;l<e;l++)s|=g[u+l]<<(l<<3);return s<0?s+4294967296:s}},ns=class{static lineRaw(g,u=0){if(typeof u!="number"||u<0||u>7)throw new TypeError("Invalid split mode.");if(!g||(g==null?void 0:g.constructor)!==ReadableStream)throw new TypeError("Not a readable stream.");let e=tt.getUnitSize(u),a=tt.isBigEndian(u),s=g.getReader(),l,f=!1,b=[],y=0,w=0,$=0;return new ReadableStream({pull:async C=>{for(C.unsent=!0;C.unsent;){if(!l||y>=l.length){y>w&&(b.push(l.subarray(w)),w=0);let t=await s.read();l=t.value,f=t.done,y=0}if(l){let t=0;if(e===1)t=l[y];else if(a)for(let h=0;h<e;h++)t<<=8,t|=l[y+h];else for(let h=0;h<e;h++)t|=l[y+h]<<(h<<3);let n=!1;switch(t){case 10:{$===13?w+=e:n=!0;break}case 13:{n=!0;break}}if(n){if(b.length){b.push(l.subarray(w,y));let h=0;for(let c=0;c<b.length;c++)h+=b[c].length;let i=new Uint8Array(h),o=0;for(let c=0;c<b.length;c++)i.set(b[c],o),o+=b[c].length;fe(C,i),b=[]}else fe(C,l.subarray(w,y));w=y+=e}$=t}if(f){if(w!==y&&l&&b.push(l.subarray(w,y)),b.length){let t=0;for(let i=0;i<b.length;i++)t+=b[i].length;let n=new Uint8Array(t),h=0;for(let i=0;i<b.length;i++)n.set(b[i],h),h+=b[i].length;fe(C,n)}C.unsent=!1,C.close()}y+=e}}},new ByteLengthQueuingStrategy({highWaterMark:256}))}static chunkRaw(g,u="utf-8"){if(!g||(g==null?void 0:g.constructor)!==ReadableStream)throw new TypeError("Not a readable stream.");let e=tt.indicator(u),a=tt.getUnitSize(e),s=tt.isBigEndian(e),l=g.getReader(),f;return new ReadableStream({pull:async b=>{b.unsent=!0;let{value:y,done:w}=await l.read();if(y){let $=0,C=y.length;if(e!==0&&typeof(f==null?void 0:f.length)=="number"){let t=!1;switch(u){case"big5":case"gbk":case"sjis":case"euc-kr":{$=1;let n=new Uint8Array(2);n[0]=f[0],n[1]=y[0],fe(b,n);break}case"euc-jp":{let n=3;f[0]===143?$=3-f.length:f[0]>127?($=1,n=2):n=f.length;let h=new Uint8Array(3);h.set(f),h.set(y.subarray(0,$),f.length),fe(b,h.subarray(0,n));break}case"gb18030":{let n=new Uint8Array(4),h=4;n.set(f),n.set(y.subarray(0,4-f.length),f.length),n[0]<128?h=f.length:n[1]>=64?($=1,h=2):$=4-f.length,fe(b,n.subarray(0,h));break}case"utf-8":{let n=4;f[0]>=240?$=4-f.length:f[0]>=224?($=3-f.length,n=3):f[0]>=192?($=1,n=2):n=f.length;let h=new Uint8Array(4);h.set(f),h.set(y.subarray(0,$),f.length),fe(b,h.subarray(0,n));break}case"utf-16":case"utf-16be":{let n=new Uint8Array(4);n.set(f),n.set(y.subarray(0,4-f.length)),$=4-f.length,ga(transientSize,0,2,s)>=55296&&ga(transientSize,2,2,s)>=55296?fe(b,n):(fe(b,n.subarray(0,2)),fe(b,n.subarray(2)));break}default:{let n=new Uint8Array(a);n.set(f),n.set(y.subarray(0,a-f.length),f.length),fe(b,n)}}}if(f=void 0,e===0)fe(b,y.subarray($));else{switch(u){case"utf-24":case"utf-24be":{C=Math.floor((y.length-$)/a)*a+$;break}case"utf-32":case"utf-32be":{C=(y.length-$>>2<<2)+$;break}case"utf-8":{if(y[y.length-1]>127){let t=!0,n=y.length,h=y.length-8;for(;t&&n>h;)n--,y[n]<128?C=n+1:y[n]>192&&(C=n)}break}case"utf-16":case"utf-16be":{if(C=(y.length-$>>1<<1)+$,ga(y,C-2,2,s)>=55296){let t=!0,n=C,h=C-6;for(;t&&n>h;)n-=2,ga(y,n,2,s)>>10===54&&(C=n)}break}default:throw new TypeError("Maybe someday the rest of the decoders will be implemented")}fe(b,y.subarray($,C))}C<y.length&&(f=y.subarray(C))}w&&(typeof(f==null?void 0:f.length)=="number"&&fe(b,f),b.unsent=!1,b.close())}},new ByteLengthQueuingStrategy({highWaterMark:256}))}static line(g,u="utf-8",e){let a=tt.collapse(u),s=tt.indicator(a),l=this.lineRaw(g,s).getReader(),f=new TextDecoder(a,onlostpointercapture);return new ReadableStream({pull:async b=>{let{value:y,done:w}=await l.read();y&&b.enqueue(f.decode(y)),w&&b.close()}})}static chunk(g,u="utf-8",e){let a=tt.collapse(u);if(self.TextDecoderStream){let s=new TextDecoderStream(a,e);return g.pipeTo(s.writable),s.readable}else{let s=this.chunkRaw(g,a).getReader(),l=new TextDecoder(a);return new ReadableStream({pull:async f=>{let{value:b,done:y}=await s.read();b&&(console.debug(b),f.enqueue(l.decode(b))),y&&f.close()}})}}},wr=ns;O();let Ba={0:"\0",a:"\x07",b:"\b",e:"\x1B",f:"\f",n:`
`,r:"\r",t:"	",v:"\v","\\":"\\","'":"'",'"':'"'},Da=new Uint8Array(128);Da.fill(1,48,58);Da.fill(1,65,71);Da.fill(1,97,103);let Gt=new Uint8Array(256);Gt.fill(1,0,32);Gt.fill(1,128,160);Gt[127]=1;let os={};for(let g in Ba){let u=Ba[g];os[u]=`\\${g}`,Gt[u.charCodeAt(0)]=2}Gt[34]=3;Gt[39]=3;let kr=g=>{let u="",e=!1;for(let a=0;a<g.length;a++){let s=g[a];if(e){let l=0;switch(s){case"x":{l=2;break}case"u":{l=4;break}case"U":{l=8;break}default:{let f=Ba[s];if(typeof f=="string")u+=f;else throw new Error(`Invalid escape identifier "${s}" at index ${a}`);e=!1;continue}}if(l>0){let f=a+1,b=g.substring(f,f+l);if(b.length<l)throw new RangeError(`Insufficient code point buffer "${b}" at index ${f}`);let y=parseInt(b,16);if(Number.isNaN(y))throw new RangeError(`Malformed code point representation "${b}" at index ${f}`);if(y>=1114112)throw new RangeError(`Code point "${b}" exceeds 0x10ffff at index ${f}`);u+=String.fromCodePoint(y),e=!1,a+=l}}else s==="\\"?e=!0:u+=s}return u},cs=(g,u=0)=>{};self.TextEscape=cs;let at,ma=(at=class{static parse(g,u){let e=g&this.MASK_TYPE,a=g&this.MASK_DATA,s=0,l=0,f,b=0,y,w=u.getReader();return new ReadableStream({pull:async $=>{let{value:C,done:t}=await w.read();if(typeof C=="string"){switch(e){case this.TYPE_TSV:{f=[];try{for(let n of C.split("	"))switch(a){case this.DATA_TEXT:{f.push(kr(n));break}case this.DATA_JSON:{f.push(s===0?kr(n):JSON.parse(n));break}default:throw new TypeError(`Unknown DSV value type ${e}`)}}catch(n){console.debug(`The following error appeared when parsing on line ${s+1}.`),console.error(n)}break}case this.TYPE_CSV:{if(a!==this.DATA_TEXT)throw new TypeError(`Invalid type ${e} for CSV, only plain text is allowed`);break}default:throw new TypeError(`Unknown DSV type ${e}`)}$.enqueue(f),s++}t&&$.close()}})}static parseObjects(g,u){let e=0,a=this.parse(g,u).getReader(),s;return new ReadableStream({start:async l=>{let{value:f,done:b}=await a.read();typeof(f==null?void 0:f.length)=="number"&&(s=f),b&&l.close()},pull:async l=>{let{value:f,done:b}=await a.read();if(typeof(f==null?void 0:f.length)=="number"){let y={};for(let w=0;w<f.length;w++)f[w]&&(y[s[w]]=f[w]);l.enqueue(y)}b&&l.close()}})}},A(at,"MASK_TYPE",3),A(at,"MASK_DATA",12),A(at,"TYPE_TSV",0),A(at,"TYPE_CSV",1),A(at,"DATA_TEXT",0),A(at,"DATA_JSON",4),at);La.default.customInterpreter=rr;let X=(g,u,e)=>{g.addEventListener(e,a=>{u.dispatchEvent(e,a.data)})},Cr=g=>{let u=g.split("/");return u[u.length-1]||u[u.length-2]||"(remote)"};if(typeof(self==null?void 0:self.require)<"u")throw new Error("Environments supporting CommonJS is not supported.");let rt,st,Vt,Ke,$e,St,Xt,Tt,ia,Ft,Mt,it,nt,xe,de,Ve,Ye,Xe,ot,ct,vr,Xi=(vr=class extends oa{constructor(u,e=.5,a=.5){super();A(this,"BM_UNIVERSAL",0);A(this,"BM_YAMAHA_MU",1);A(this,"device");P(this,rt,void 0);P(this,st,{});P(this,Vt,[]);P(this,Ke,new Map);P(this,$e,"");P(this,St,[]);P(this,Xt,[]);P(this,Tt,new Uint8ClampedArray(E.ch));P(this,ia,new Uint8ClampedArray(E.ch));P(this,Ft,new Uint32Array(E.ch));P(this,Mt,new Uint32Array(E.ch));P(this,it,.5);P(this,nt,120);P(this,xe,4);P(this,de,4);P(this,Ve,0);P(this,Ye,0);P(this,Xe,new Array(E.ch));P(this,ot,new Uint8Array(E.ch));P(this,ct,0);A(this,"dState");A(this,"msActive",200);A(this,"msFrame",100);A(this,"msExhaust",300);A(this,"smoothAttack",0);A(this,"smoothDecay",0);let s=this;s.smoothAttack=e,s.smoothDecay=a,s.device=u,s.addEventListener("meta",function(l){let f;(f=l==null?void 0:l.data)==null||f.forEach(function(b){(r(s,St)[b.meta]||console.debug).call(s,b.meta,b.data)})}),X(s.device,s,"mode"),X(s.device,s,"mastervolume"),X(s.device,s,"channelactive"),X(s.device,s,"channelmin"),X(s.device,s,"channelmax"),X(s.device,s,"portrange"),X(s.device,s,"portstart"),X(s.device,s,"channelreset"),X(s.device,s,"channeltoggle"),X(s.device,s,"screen"),X(s.device,s,"metacommit"),X(s.device,s,"voice"),X(s.device,s,"pitch"),X(s.device,s,"note"),X(s.device,s,"reset"),X(s.device,s,"banklevel"),X(s.device,s,"efxreverb"),X(s.device,s,"efxchorus"),X(s.device,s,"efxdelay"),X(s.device,s,"efxinsert0"),X(s.device,s,"efxinsert1"),X(s.device,s,"efxinsert2"),X(s.device,s,"efxinsert3"),X(s.device,s,"efxinsert4"),X(s.device,s,"partefxtoggle"),X(s.device,s,"chmode"),s.addEventListener("note",function({data:l}){if(r(s,Xt).push(l),l.state===3){let f=Math.floor(r(s,Ye)*1e3);r(s,Ft)[l.part]=f,f-r(s,Mt)[l.part]>=s.msExhaust&&(r(s,Mt)[l.part]=f)}}),s.addEventListener("voice",({data:l})=>{s.refreshCachedChVoice(l.part)}),s.addEventListener("reset",({data:l})=>{r(s,ot).fill(1),r(s,Ft).fill(0),r(s,Mt).fill(0)}),r(s,ot).fill(1),r(s,St)[3]=function(l,f){let b;((b=r(s,$e))==null?void 0:b.length)<1&&(M(s,$e,f),s.dispatchEvent("title",r(s,$e)))},r(s,St)[81]=function(l,f){let b=s.noteProgress,y=r(s,it)||.5;M(s,nt,6e7/f),M(s,it,f/1e6),M(s,Ve,r(s,Ve)+(b*(y/r(s,it))-b)),s.dispatchEvent("tempo",r(s,nt))},r(s,St)[88]=function(l,f){let b=s.noteBar,y=s.noteBeat,w=r(s,xe),$=r(s,de);M(s,xe,f[0]),M(s,de,1<<f[1]);let C=Math.round(b+y/w);w!==r(s,xe)&&M(s,Ve,r(s,Ve)-C*(r(s,xe)-w)*(4/r(s,de))),$!==r(s,de)&&(console.debug(`${b}/${y}`),$<r(s,de)?M(s,Ve,r(s,Ve)+C*(r(s,de)-$)*($/r(s,de))):M(s,Ve,r(s,Ve)+C*(r(s,de)-$)*(r(s,de)/$))),s.dispatchEvent("tsig",s.getTimeSig())},s.addEventListener("metacommit",({data:l})=>{let f;switch(l.type){case"KarTitle":case"EORTitle":{((f=r(s,$e))==null?void 0:f.length)<1&&(M(s,$e,l.data),s.dispatchEvent("title",r(s,$e)));break}}})}get clockSource(){let u;return(u=this.device)==null?void 0:u.clockSource}set clockSource(u){if(this.device)this.device.clockSource=u;else throw new Error("OctaviaDevice is not ready.")}reset(){let e;let u=this;u.dispatchEvent("reset"),(e=r(u,rt))==null||e.resetIndex(),u.device.init(),M(u,$e,""),M(u,it,.5),M(u,nt,120),M(u,xe,4),M(u,de,4),M(u,Ve,0),M(u,Ye,0),u.dispatchEvent("tempo",r(u,nt)),u.dispatchEvent("title",r(u,$e)),u.dispatchEvent("tsig",u.getTimeSig())}init(){this.reset(),M(this,rt,void 0)}async loadFile(u){M(this,rt,Er(La.default.parse(new Uint8Array(await u.arrayBuffer()))))}async loadMap(u,e,a,s="(internal)"){let l=this,f=0,b=0,y=0,w=0,$,C;u.split(`
`).forEach((t,n)=>{let i;if(!t)return;let h=t.split("	");if(n){if(!w)return;let o="",c="";h.forEach((m,p)=>{switch(p){case $:{o=m;break}case C:{c=m;break}}});let d=!1;((i=r(l,st)[o])==null?void 0:i.priority)>a&&(d=!0,y++),!r(l,st)[o]||d||e?(r(l,st)[o]={name:c,priority:a},f++):self.debugMode&&console.debug(`Voice "${c}" (${o}) seems to be in conflict with (${r(l,st)[o]}).`),b++}else h.forEach((o,c)=>{switch(o){case"ID":{$=c,w++;break}case"Name":{C=c,w++;break}default:console.debug(`Unknown map field: ${o}`)}})}),console.debug(`Voice names: From "${s}", ${b} total, ${f} loaded (${f-y} + ${y}).`),l==null||l.device.forceVoiceRefresh()}async loadMapPaths(u){let e=this;u.forEach(async(a,s)=>{e.loadMap(await(await fetch(a)).text(),0,s,Cr(a))})}async loadEfx(u,e){let a=this,s=0,l=0,f,b,y;u.split(`
`).forEach((w,$)=>{if(w)if($){let C=0,t;w.split("	").forEach((n,h)=>{switch(h){case f:{C|=(parseInt(n,16)&255)<<8;break}case b:{C|=parseInt(n,16)&255;break}case y:{t=n;break}}}),!r(a,Vt)[C]||e?(r(a,Vt)[C]=t,s++):self.debugMode&&console.debug(`EFX ID 0x${C.toString(16).padStart(4,"0")} (${t}) seems to be in conflict.`),l++}else w.split("	").forEach((C,t)=>{switch(C){case"MSB":{f=t;break}case"LSB":{b=t;break}case"Name":{y=t;break}default:console.debug(`Unknown EFX field: ${C}`)}})}),console.debug(`EFX: ${l} total, ${s} loaded.`);for(let w=0;w<Zt.length;w++){let $=!1,C=a.device.getEffectType(w);C[0]===0&&C[1]>>4===15&&($=!0),a.dispatchEvent(`efx${Zt[w]}`,{id:C,hidden:$})}}async loadModels(u,e){let a=this,s=0,l=0}async loadStyles(u,e){let a=this,s=0,l=0}async loadProps(u,e,a=0,s="(internal)"){let w,$;let l=this,f=0,b=0,y=0;try{for(let C=_a(ma.parseObjects(ma.DATA_TEXT|ma.TYPE_TSV,wr.line(u))),t,n,h;t=!(n=await C.next()).done;t=!1){let i=n.value;if(typeof(i==null?void 0:i.voiceId)=="string")if(b++,!(r(l,Ke).has(i.voiceId)||((w=r(l,Ke).get(i.voiceId))==null?void 0:w.priority)<=a)||e){if(Object.keys(i).length<2)continue;(($=r(l,Ke).get(i.voiceId))==null?void 0:$.priority)>a&&y++,i.priority=a,l.handleProp&&await l.handleProp(i),r(l,Ke).set(i.voiceId,i),f++}else console.debug(`Tried to write a pre-existing entry "${i.voiceId}" on entry ${b}.`)}}catch(n){h=[n]}finally{try{t&&(n=C.return)&&await n.call(C)}finally{if(h)throw h[0]}}console.debug(`Voice properties: From "${s}", ${b} total, ${f} loaded (${f-y} + ${y}).`)}async loadPropsPaths(u){let e=this;u.forEach(async(a,s)=>{let l=a.split("/");e.loadProps((await fetch(a)).body,0,s,Cr(a))})}switchMode(u,e=!1){this.device.switchMode(u,e)}getMode(){return this.device.getMode()}getVoice(){return this.device.getVoice(...arguments)}getChVoice(u){return this.device.getChVoice(u)}refreshCachedChVoice(u,e){let b;let a=this,s=e!=null?e:a.device.getChVoice(u),l=r(a,Xe)[u],f=!0;if(na(a,ct)._++,!e)switch(a.device.getChMode(u)){case"xg":{if(a.device.getChType(u)>0&&a.device.getChPrimitive(u,1)!==126)switch(s.ending){case"!":case"?":{f=!1,l.refreshFailure=!0,console.debug("Cached voice persisted due to invalid drum kit.");break}}break}case"gs":case"sc":{s.ending!==" "&&(s.sid[2]===1?(s.name="Silence",s.refreshFailure=!0,console.debug("Cached voice nullified due to invalid SC-55 voice.")):(f=!1,l.refreshFailure=!0,console.debug("Cached voice persisted due to invalid GS voice.")));break}}return f?(r(a,Xe)[u]=s,r(a,ot)[u]=(b=s.poly)!=null?b:1,r(a,ct)>1?console.debug(`Bubbling prevented at instance #${r(a,ct)}.`):a.dispatchEvent("cachedvoice",{part:u}),na(a,ct)._--,s):(na(a,ct)._--,l)}getCachedChVoice(u){let l,f;let e=this,a=r(e,Xe)[u],s=(l=e.device)==null?void 0:l.getChPrimitives(u,!0);if(a&&((f=e.device)==null?void 0:f.getChCvnIsWritten(u))===0)switch(a.ending){case"?":case"!":return e.refreshCachedChVoice(u,void 0);default:return ar(a.sid,s)[1]!==0||a.name==="Unloaded"?e.refreshCachedChVoice(u):a}else return e.refreshCachedChVoice(u)}getChPrimitive(u,e,a){return this.device.getChPrimitive(u,e,a)}getChPrimitives(u,e){return this.device.getChPrimitives(u,e)}getMapped(u){let e;return((e=r(this,st)[u])==null?void 0:e.name)||u}getEfx(u){let[e,a]=u,s=e<<8|a;return r(this,Vt)[s]||`0x${s.toString(16).padStart(4,"0")}`}getVoxBm(u,e=this.BM_UNIVERSAL){let l,f;if(!u)throw new Error("Voice object must be valid");let a=this;if(!a.voxBm)throw new Error("Voice bitmap repository isn't yet initialized");let s=a.voxBm.getBm(u.name);if(!s){switch(u.mode){case"xg":{switch(u.sid[0]){case 0:case 80:case 81:case 83:case 84:case 96:case 97:case 99:case 100:{s=a.voxBm.getBm(a.getVoice(Le.bank0,u.sid[1],Le.bank0,u.mode).name);break}}break}case"g2":case"sd":{switch(u.sid[0]){case 96:case 97:case 98:case 99:{s=a.voxBm.getBm(a.getVoice(Le.bank0,u.sid[1],Le.bank0,u.mode).name);break}case 104:case 105:case 106:case 107:{s=a.voxBm.getBm(a.getVoice(120,u.sid[1],Le.bank0,u.mode).name);break}}break}case"gs":case"sc":case"k11":case"sg":case"gm":{switch(u.sid[0]){case 120:break;case 122:case 127:{s=a.voxBm.getBm(a.getVoice(120,u.sid[1],0,u.mode).name);break}default:s=a.voxBm.getBm(a.getVoice(0,u.sid[1],0,u.mode).name)}break}case"05rw":case"x5d":case"ns5r":{switch(u.sid[0]){case 56:{s=a.voxBm.getBm(a.getVoice(0,u.sid[1],0,"gm").name);break}}break}default:}switch(e){case a.BM_UNIVERSAL:break;case a.BM_YAMAHA_MU:{let b=u.standard.toLowerCase();if(b!==u.mode&&lt.xg.has(b))switch(u.sid[0]>>4){case 2:{s=(l=a.sysBm)==null?void 0:l.getBm(`ext_${b}I`);break}case 3:{u.sid[0]===48&&(s=(f=a.sysBm)==null?void 0:f.getBm("boot_3"));break}case 6:{s=a.sysBm.getBm(`ext_${b}P`);break}default:{s=a.sysBm.getBm(`ext_${b}`);break}}else["es"].indexOf(b)>-1?s=a.sysBm.getBm("boot_3"):b==="kr"&&(s=a.sysBm.getBm("st_korg"));break}}}return s||(s=a.voxBm.getBm(a.getVoice(u.sid[0],u.sid[1],0,u.mode).name)),s}getChBm(u,e=this.BM_UNIVERSAL,a){let b,y;let s=this;a=a!=null?a:s.getChVoice(u);let l=s==null?void 0:s.device.getChType(u),f;switch(e){case s.BM_UNIVERSAL:break;case s.BM_YAMAHA_MU:{let w=a.standard.toLowerCase();if(w!==a.mode&&lt.xg.has(w))switch(a.sid[0]>>4){case 1:{a.sid[0]===16&&(f=s.sysBm.getBm("cat_svox"));break}case 2:{f=(b=s.sysBm)==null?void 0:b.getBm(`ext_${w}I`);break}case 3:{a.sid[0]===48&&(f=(y=s.sysBm)==null?void 0:y.getBm("boot_3"));break}case 6:{f=s.sysBm.getBm(`ext_${w}P`);break}default:{f=s.sysBm.getBm(`ext_${w}`);break}}else if(["es"].indexOf(w)>-1)f=s.sysBm.getBm("boot_3");else if(w==="kr")f=s.sysBm.getBm("st_korg");else if(w==="xg")switch(a.sid[0]){case 126:{a.sid[1]>>2===28&&(f=s.sysBm.getBm("cat_smpl"));break}}if(!f&&l)switch(a.ending){case"!":case"?":case"*":{f=s.sysBm.getBm(l>1&&l<6?`cat_dS${l-1}`:"cat_drS");break}default:f=s.sysBm.getBm(l>1&&l<10?`cat_dr${l-1}`:"cat_drm")}break}}if(f=f||s.getVoxBm(a,e),!f){if(!s.sysBm)return;switch(a.mode){case"xg":{switch(a.sid[0]){case 126:{a.sid[1]>>2===28&&(f=s.sysBm.getBm("cat_smpl"));break}case 16:{f=s.sysBm.getBm("cat_smpl");break}case 64:case 67:{f=s.sysBm.getBm("cat_sfx");break}case 32:case 33:case 34:case 35:case 36:case 48:case 82:{f=s.sysBm.getBm("cat_xg");break}}break}default:switch(a.sid[0]){case 63:case 32:case 33:case 34:case 35:case 36:case 48:case 82:{f=s.sysBm.getBm("cat_mex");break}}}}if(f)switch(a.ending){case"!":case"?":case"*":{f=s.sysBm.getBm(l?"cat_drS":"no_vox");break}}else l?f=s.sysBm.getBm("cat_drS"):f=s.sysBm.getBm("no_vox");return f}getChBmState(u,e=1){let a=this,s=Math.floor(r(a,Ye)*1e3)-a.getChLastNoteExhausted(u);return a.getChLastNoteExhausted(u)<=0?0:s<a.msActive?(e-=1,e<1?0:Math.floor(s/a.msFrame)%e+1):0}detachState(u){let e=this;if(e.dState){let a=e.dState;switch(u){case"mu":{e.removeEventListener("mupromptex",a.muScheduleSysEx),e.removeEventListener("mode",a.muModeFunc),delete a.muModeFunc,delete a.muModeBm,delete a.muExhaustEx,delete a.muDurationEx,delete a.muBlinkSpeedEx,delete a.muPromptEx,delete a.muScheduledEx,delete a.muUnresolvedEx,delete a.muDisableExBlink,delete a.muUseVoiceBm,delete a.muTempWindow,delete a.muBlinkSpeedMode,delete a.muBmex,delete a.muBmst,delete a.isMu;break}}return!0}else return!1}attachState(u){let l,f;let e=this;e.dState=(l=e.dState)!=null?l:{};let a=e.dState,s=!1;switch(u){case"mu":{a.isMu=!0,a.muBmst=0,a.muBmex=0,a.muBlinkSpeedMode=400,a.muTempWindow=new Uint8Array(256),a.muUseVoiceBm=!0,a.muDisableExBlink=!1,a.muUnresolvedEx=0,a.muScheduledEx=0,a.muPromptEx=0,a.muBlinkSpeedEx=200,a.muDurationEx=a.muBlinkSpeedEx*5,a.muExhaustEx=a.muBlinkSpeedEx<<1,a.muModeFunc=function(b){let y=e.sysBm.getBm(`st_${{gm:"gm1",g2:"gm2","?":"gm1",ns5r:"korg",ag10:"korg",x5d:"korg","05rw":"korg",krs:"korg",sg:"gm1",k11:"gm1",sd:"gm2",sc:"gs"}[b.data]||b.data}`);y&&(a.muModeBm=y.getFrame(0)),a.muBmst=2,a.muBmex=e.clockSource.now()+(a.muBlinkSpeedMode<<2)},e.addEventListener("mode",a.muModeFunc),a.muScheduleSysEx=function(b){a.muDisableExBlink?(a.muScheduledEx=0,B()&&console.debug("SysEx blinking cancelled due to disabled feature.")):(a.muScheduledEx+=b.data,B()&&console.debug(`Scheduled a SysEx prompt at ${b.data} B. Remaining ${a.muScheduledEx} B unfulfilled prompts.`))},(f=e.device)==null||f.addEventListener("mupromptex",a.muScheduleSysEx);break}default:s=!0}return!s}muWriteBm(u,e,a){let t,n,h,i;if((u==null?void 0:u.BYTES_PER_ELEMENT)!==1)throw new TypeError("Buffer must be Uint8Array.");let s=this,l=u.length>>8||1;if(!s.dState.isMu)throw new Error("Device state for MU is not yet attached.");let f=s.dState,b=s.clockSource.now(),y=(t=s.device)==null?void 0:t.getBitmap(),w=f.muTempWindow,$=!1,C=!1;if(f.muScheduledEx>0){let o=f.muScheduledEx*85+4095>>12;b-f.muPromptEx>f.muBlinkSpeedEx?(f.muUnresolvedEx+=o*204+4095>>12,B()&&console.debug(`SysEx blinking submitted, now at ${f.muUnresolvedEx}.`)):((b-f.muPromptEx)*41>>12&1&&f.muUnresolvedEx<8&&f.muUnresolvedEx==8,f.muUnresolvedEx+=o+1>>1,B()&&console.debug(`SysEx blinking too busy, now at ${f.muUnresolvedEx}.`)),f.muScheduledEx=0}if(b<y.expire)f.muUnresolvedEx>0&&(f.muUnresolvedEx=0,B()&&console.debug("SysEx blinking cancelled by bitmap.")),y.bitmap.length<=256?(w=y.bitmap,$=!0):(u.set(y.bitmap.subarray(0,u.length)),C=!0);else if(b<f.muBmex){if(f.muBmst===2){$=!0,f.muUnresolvedEx>0&&(f.muUnresolvedEx=0,B()&&console.debug("SysEx blinking cancelled by mode set."));let o=Math.floor((f.muBmex-b)/f.muBlinkSpeedMode)&1;f.muModeBm?(n=f.muModeBm)==null||n.forEach((c,d)=>{w[d]=o===c}):w.fill(o?0:1)}}else if(f.muUseVoiceBm){$=!0,f.muUnresolvedEx>0&&b-f.muPromptEx>=f.muExhaustEx?(f.muUnresolvedEx<16?f.muUnresolvedEx=0:f.muUnresolvedEx-=16,f.muPromptEx=b,B()&&console.debug(`SysEx blinking resolved to ${f.muUnresolvedEx}.`)):f.muUnresolvedEx<0&&(f.muUnresolvedEx=0),f.muBmst=0;let o=s.getChBm(e,s.BM_YAMAHA_MU,a),c=s.getChBmState(e,(o==null?void 0:o.frames)||1);o&&w.set(o.getFrame(c));let d=b-f.muPromptEx;d<=f.muDurationEx&&((h=s.sysBm.getBm("sysex_m"))==null||h.getFrame(0).forEach((m,p)=>{m&&(w[p]=0)}),(i=s.sysBm.getBm(`sysex_${Math.floor(d/f.muDurationEx*5)&1}`))==null||i.getFrame(0).forEach((m,p)=>{m&&(w[p]=1)}))}if($){let o=0;for(let c=0;c<w.length;c++){let d=w[c];u[o]=d?255:0,l===2&&(u[o+1]=d?255:0),o+=l}}return $||C}getProps(u){let e=this,a,s,l=0,f=u;for(;l<8&&a==null&&(!(s!=null&&s.constructor)||s instanceof Array&&(s[1]!==u.eid[1]||s[2]!==u.eid[2]));)s=u.eid,typeof u.voice=="string"&&(r(e,Ke).has(u.voice)?a=r(e,Ke).get(u.voice):u=e.getVoice(s[0],s[2]===0?0:s[1],s[2]===0?0:s[2]-1));return!a&&l===8&&console.info(`Voice property fetching failed for "${u.name}" (${u.eid.join(" ")}).`),a}get noteProgress(){return r(this,Ye)/r(this,it)}get noteOverall(){return(this.noteProgress-r(this,Ve))*r(this,de)/4}get noteBar(){return Math.floor(this.noteOverall/r(this,xe))}get noteBeat(){let u=this.noteOverall%r(this,xe);return u<0&&(u+=r(this,xe)),u}get noteOffset(){return r(this,Ve)}getTimeSig(){return[r(this,xe),r(this,de)]}getTempo(){return r(this,nt)}getPool(){return r(this,rt)}getChCachedVoiceRaw(u){return r(this,Xe)[u]}getChLastNoteAt(u){return r(this,Ft)[u]}getChLastNoteExhausted(u){return r(this,Mt)[u]}eachVoice(u,e=!1){let s;let a=this;for(let l=0;l<r(a,Xe).length;l++)(e||(s=a.device)!=null&&s.getChActive(l))&&u(r(a,Xe)[l],l,r(a,Xe))}sendCmd(u){this.device.runJson(u)}render(u){let o,c,d;u>r(this,Ye)&&M(this,Ye,u);let e=((o=r(this,rt))==null?void 0:o.step(u))||[],a=0,s=0,l=new Set,f={},b=[],y=this,w=[];for(y.device.getStrength().forEach((m,p)=>{r(y,ia)[p]=m}),y.device.newStrength(),e.forEach(function(m){let p=m.data,k=y.device.runJson(p);switch(k==null?void 0:k.reply){case"meta":{w.push(k);break}}k!=null&&k.reply&&delete k.reply});r(y,Xt).length>0;){let m=r(y,Xt).shift(),p=m.part<<7|m.note;m.state?(l.add(p),f[p]=m.velo):l.has(p)&&(b.push({part:m.part,note:m.note,velo:f[p],state:y.device.NOTE_SUSTAIN}),a++,s+=r(y,ot)[m.part])}(w==null?void 0:w.length)>0&&y.dispatchEvent("meta",w);let $=[],C=[],t=y.device.getStrength();t.forEach(function(m,p,k){k[p]=Math.max(r(y,ia)[p],m);let v=k[p]-r(y,Tt)[p];if(v>=0){let I=4*.25**(y.device.getChCc(p,73)/64);r(y,Tt)[p]+=Math.ceil(v-v*y.smoothAttack**I)}else{let I=4*.25**(y.device.getChCc(p,72)/64);r(y,Tt)[p]+=Math.floor(v-v*y.smoothDecay**I)}});let n=0,h=0;return(d=(c=y.device)==null?void 0:c.getActive())==null||d.forEach(function(m,p){m&&($[p]=y.device.getVel(p),C[p]=y.device.getExt(p),n+=$[p].size,h+=$[p].size*r(y,ot)[p])}),{extraPoly:a,extraPolyEC:s,extraNotes:b,curPoly:n,curPolyEC:h,chKeyPr:$,chExt:C,eventCount:e.length,title:r(y,$e),texts:y.device.getTexts(),master:y.device.getMaster(),strength:r(y,Tt),velo:t,rpn:y.device.getRpn(),tSig:y.getTimeSig(),tempo:y.getTempo(),noteBar:y.noteBar,noteBeat:y.noteBeat,ace:y.device.getAce(),rawVelo:y.device.getStrength(),rawStrength:y.device.getRawStrength(),rawPitch:y.device.getRawPitch(),efxSink:y.device.getEffectSink()}}},rt=new WeakMap,st=new WeakMap,Vt=new WeakMap,Ke=new WeakMap,$e=new WeakMap,St=new WeakMap,Xt=new WeakMap,Tt=new WeakMap,ia=new WeakMap,Ft=new WeakMap,Mt=new WeakMap,it=new WeakMap,nt=new WeakMap,xe=new WeakMap,de=new WeakMap,Ve=new WeakMap,Ye=new WeakMap,Xe=new WeakMap,ot=new WeakMap,ct=new WeakMap,vr);export{Xi as RootDisplay,E as allocated,we as dnToPos};
