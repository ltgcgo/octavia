var $r=Object.create;var ma=Object.defineProperty;var Sr=Object.getOwnPropertyDescriptor;var xr=Object.getOwnPropertyNames;var Tr=Object.getPrototypeOf,Mr=Object.prototype.hasOwnProperty;var Pr=(g,f,e)=>f in g?ma(g,f,{enumerable:!0,configurable:!0,writable:!0,value:e}):g[f]=e;var Ua=(g,f)=>()=>(g&&(f=g(g=0)),f);var Ar=(g,f)=>()=>(f||g((f={exports:{}}).exports,f),f.exports);var Rr=(g,f,e,a)=>{if(f&&typeof f=="object"||typeof f=="function")for(let s of xr(f))!Mr.call(g,s)&&s!==e&&ma(g,s,{get:()=>f[s],enumerable:!(a=Sr(f,s))||a.enumerable});return g};var Ir=(g,f,e)=>(e=g!=null?$r(Tr(g)):{},Rr(f||!g||!g.__esModule?ma(e,"default",{value:g,enumerable:!0}):e,g));var A=(g,f,e)=>(Pr(g,typeof f!="symbol"?f+"":f,e),e),Oa=(g,f,e)=>{if(!f.has(g))throw TypeError("Cannot "+e)};var r=(g,f,e)=>(Oa(g,f,"read from private field"),e?e.call(g):f.get(g)),P=(g,f,e)=>{if(f.has(g))throw TypeError("Cannot add the same private member more than once");f instanceof WeakSet?f.add(g):f.set(g,e)},M=(g,f,e,a)=>(Oa(g,f,"write to private field"),a?a.call(g,e):f.set(g,e),e),na=(g,f,e,a)=>({set _(s){M(g,f,s,e)},get _(){return r(g,f,a)}});var _a=(g,f,e)=>(f=g[Symbol.asyncIterator],e=(a,s)=>(s=g[a])&&(f[a]=l=>new Promise((u,m,y)=>(l=s.call(g,l),y=l.done,Promise.resolve(l.value).then(w=>u({value:w,done:y}),m)))),f?f.call(g):(g=g[Symbol.iterator](),f={},e("next"),e("return"),f));var Na=Ua(()=>{"use strict";O();(function(){var g=function(m,y,w){var $,k;if(self.MessageEvent)switch(m){case"message":{k=new MessageEvent(m,{data:y,ports:w==null?void 0:w.ports}),Object.defineProperty(k,"source",{value:w==null?void 0:w.source});break}default:k=new Event(m)}else k=document.createEvent("Event"),k.initEvent(m,!1,!1),w&&m=="message"&&(k.data=y,w.source&&Object.defineProperty(k,"source",{value:w.source}),($=w.ports)!=null&&$.length&&Object.defineProperty(k,"ports",{value:w.ports}));return k};self.BroadcastChannel?console.info("[Snowy] Snowy is disabled."):(console.info("[Snowy] Snowy is enabled. Path: ".concat(self.SNOWY_PATH||"/snowy.js")),e=[],a={},s=function(m){var y,w=this;if((this==null?void 0:this.constructor)!=s)throw new TypeError("Illegal constructor");e.push(this),(y=a[m])!=null&&y.constructor||(a[m]=[]),a[m].push(this);var $=Math.floor(Math.random()*281474976710656),k=[],t=0,n=[],d=!0,i=!1;Object.defineProperty(this,"id",{get:function(){return $}}),Object.defineProperty(this,"name",{value:m}),this.close=function(){var o,h=e.indexOf(w);h>-1?(f.postMessage({t:"d",c:m,i:$}),e.splice(h,1),(o=a[m])!=null&&o.constructor&&(h=a[m].indexOf(w),h>-1&&a[m].splice(h,1)),a[m].length||delete a[m],console.debug("[Snowy] BroadcastChannel closed."),i=!0):console.debug("[Snowy] BroadcastChannel already closed.")},this.postMessage=function(o){if(f){if(i)throw new Error("Channel already closed");f.postMessage({t:"m",c:m,i:$,m:t,d:o}),t++,t>4294967295&&(t=0)}else n.push(o),console.debug("[Snowy] Message is cached.")},this.flush=function(){if(f){if(d){for(f.postMessage({t:"r",c:m,i:$}),console.debug("[Snowy] ".concat(n.length," message(s) in cache."));n.length;){var o=n.shift();w.postMessage(o)}d=!1,console.debug("[Snowy] All cached messages are flushed away.")}}else throw new Error("Tried to flush when the ports are not ready")},this.receiveMessage=function(o){o.c==m?o.i!=$&&w.dispatchEvent(g("message",o.d,{source:w})):console.debug("[Snowy] Channel ID mismatch. Instance ".concat($," receives from ").concat(m,", not ").concat(o.c,"."))};var c={};this.dispatchEvent=function(o){var h,b;if(Object.defineProperty(o,"target",{value:w}),Object.defineProperty(o,"currentTarget",{value:w}),(h=c[o.type])!=null&&h.length)for(var p=c[o.type],C=0;C<p.length;C++)((b=p[C])==null?void 0:b.constructor)==Function&&p[C].call(w,o);w["on".concat(o.type)]&&w["on".concat(o.type)].constructor==Function&&w["on".concat(o.type)].call(w,o)},this.addEventListener=function(o,h){var b;(b=c[o])!=null&&b.constructor||(c[o]=[]);var p=c[o].indexOf(h);p==-1&&c[o].push(h)},this.removeEventListener=function(o,h){var b,p;if((b=c[o])!=null&&b.length){var C=c[o].indexOf(h);C>-1&&c[o].splice(C,1)}!((p=c[o])!=null&&p.length)&&c[o].constructor&&delete c[o]}},self.BroadcastChannel=s,l=function(){if(f){f.addEventListener("message",function(y){var w=y.data,$=!1;switch(w.t){case"k":{$=!1,f.postMessage({t:"k"});break}case"m":{var k=a[w.c];if(k!=null&&k.length)for(var t=0;t<k.length;t++)k[t].receiveMessage(w);break}case"c":{for(var n=[],d=0;d<e.length;d++){var i=e[d].name;n.indexOf(i)<0&&n.push(i)}f.postMessage({t:"k",c:n});break}default:$=!0}$&&console.info("ReceiveBroadcast",w)});for(var m=0;m<e.length;m++)e[m].flush()}else throw new Error("Message port isn't yet ready");console.info("[Snowy] Snowy is active.")},u=function(){if(!f){var m=new SharedWorker(self.SNOWY_PATH||"/snowy.js");m.port.start();var y=function(w){w.data.t=="swc"&&(m.port.removeEventListener("message",y),f=m.port,f.postMessage({t:"k"}),l())};m.port.addEventListener("message",y)}},u());var f,e,a,s,l,u})()});var O=Ua(()=>{"use strict";Na();{let g=function(f,e){let a=new FileReader;return new Promise((s,l)=>{switch(a.addEventListener("abort",()=>{l(new Error("Blob read aborted"))}),a.addEventListener("error",u=>{l(a.error||u.data||new Error("Blob read error"))}),a.addEventListener("load",()=>{s(a.result)}),e.toLowerCase()){case"arraybuffer":case"buffer":{a.readAsArrayBuffer(f);break}case"string":case"text":{a.readAsText(f);break}default:l(new Error(`Unknown target ${e}`))}})};Blob.prototype.arrayBuffer=Blob.prototype.arrayBuffer||function(){return g(this,"buffer")},Blob.prototype.text=Blob.prototype.text||function(){return g(this,"text")}}String.prototype.replaceAll=String.prototype.replaceAll||function(g,f){let e=0,a=16,s=this,l=[];for(;e<a&&s.lastIndexOf(g)>-1;){let u=s.lastIndexOf(g);l.unshift(s.slice(u+g.length)),s=s.slice(0,u),u==0&&l.unshift(""),e++}return s.length&&l.unshift(s),l.join(f)||""},String.prototype.padStart=String.prototype.padStart||function(g,f){if(f){let e=this;for(;e.length<g;)e=`${f}${e}`;return e}},String.prototype.padEnd=String.prototype.padEnd||function(g,f){if(f){let e=this;for(;e.length<g;)e+=f;return e}}});var pr=Ar((pi,Aa)=>{O();(function(){"use strict";let g={fatal:!0},f=[new TextDecoder("iso-8859-15",g),new TextDecoder("utf-8",g),new TextDecoder("sjis",g),new TextDecoder("euc-jp",g),new TextDecoder("ascii")],e={debug:!1,parse:function(a,s){if(a instanceof Uint8Array)return e.Uint8(a);if(typeof a=="string")return e.Base64(a);if(a instanceof HTMLElement&&a.type==="file")return e.addListener(a,s);throw new Error("MidiParser.parse() : Invalid input provided")},addListener:function(a,s){if(!File||!FileReader)throw new Error("The File|FileReader APIs are not supported in this browser. Use instead MidiParser.Base64() or MidiParser.Uint8()");if(a===void 0||!(a instanceof HTMLElement)||a.tagName!=="INPUT"||a.type.toLowerCase()!=="file")return console.warn("MidiParser.addListener() : Provided element is not a valid FILE INPUT element"),!1;s=s||function(){},a.addEventListener("change",function(l){if(!l.target.files.length)return!1;console.log("MidiParser.addListener() : File detected in INPUT ELEMENT processing data..");let u=new FileReader;u.readAsArrayBuffer(l.target.files[0]),u.onload=function(m){s(e.Uint8(new Uint8Array(m.target.result)))}})},Base64:function(a){let s=function(m){var y="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";if(m=m.replace(/^.*?base64,/,""),m=String(m).replace(/[\t\n\f\r ]+/g,""),!/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/.test(m))throw new TypeError("Failed to execute _atob() : The string to be decoded is not correctly encoded.");m+="==".slice(2-(3&m.length));let w,$="",k,t,n=0;for(;n<m.length;)w=y.indexOf(m.charAt(n++))<<18|y.indexOf(m.charAt(n++))<<12|(k=y.indexOf(m.charAt(n++)))<<6|(t=y.indexOf(m.charAt(n++))),$+=k===64?String.fromCharCode(w>>16&255):t===64?String.fromCharCode(w>>16&255,w>>8&255):String.fromCharCode(w>>16&255,w>>8&255,255&w);return $}(a=String(a));var l=s.length;let u=new Uint8Array(new ArrayBuffer(l));for(let m=0;m<l;m++)u[m]=s.charCodeAt(m);return e.Uint8(u)},Uint8:function(u){let s={data:null,pointer:0,movePointer:function(k){return this.pointer+=k,this.pointer},readInt:function(k){if((k=Math.min(k,this.data.byteLength-this.pointer))<1)return-1;let t=0;if(1<k)for(let n=1;n<=k-1;n++)t+=this.data.getUint8(this.pointer)*Math.pow(256,k-n),this.pointer++;return t+=this.data.getUint8(this.pointer),this.pointer++,t},readStr:function(k){let t=new Uint8Array(k),n=!1,d;t.forEach((i,c)=>{t[c]=this.readInt(1)});for(let i=0;i<f.length;i++)if(!n)try{if(d=f[i].decode(t),i===0)for(let c=0;c<d.length;c++){let o=d.charCodeAt(c);if(o>191||o>127&&o<160)throw new RangeError(`Invalid code point: ${o}`)}n=!0,console.debug(`String byte sequence in ${f[i].encoding}`)}catch(c){console.debug(`SMF string ${c}`)}return d||"String byte sequence read failed."},backOne:function(){this.pointer--},readIntVLV:function(){let k=0;if(this.pointer>=this.data.byteLength)return-1;if(this.data.getUint8(this.pointer)<128)k=this.readInt(1);else{let n=[];for(;128<=this.data.getUint8(this.pointer);)n.push(this.readInt(1)-128);var t=this.readInt(1);for(let d=1;d<=n.length;d++)k+=n[n.length-d]*Math.pow(128,d);k+=t}return k}};if(s.data=new DataView(u.buffer,u.byteOffset,u.byteLength),s.readInt(4)!==1297377380)return console.warn("Header validation failed (not MIDI standard or file corrupt.)"),!1;s.readInt(4);let l={};l.formatType=s.readInt(2),l.tracks=s.readInt(2),l.track=[];var u=s.readInt(1),m=s.readInt(1);128<=u?(l.timeDivision=[],l.timeDivision[0]=u-128,l.timeDivision[1]=m):l.timeDivision=256*u+m;for(let k=1;k<=l.tracks;k++){l.track[k-1]={event:[]};var y,w=s.readInt(4);if(w===-1)break;if(w!==1297379947)return!1;s.readInt(4);let t=0,n=!1,d,i;for(;!n&&(t++,l.track[k-1].event[t-1]={},l.track[k-1].event[t-1].deltaTime=s.readIntVLV(),(d=s.readInt(1))!==-1);)if(128<=d?i=d:(d=i,s.movePointer(-1)),d===255){l.track[k-1].event[t-1].type=255,l.track[k-1].event[t-1].metaType=s.readInt(1);var $=s.readIntVLV();switch(l.track[k-1].event[t-1].metaType){case 47:case-1:n=!0;break;case 1:case 2:case 3:case 4:case 5:case 7:case 6:l.track[k-1].event[t-1].data=s.readStr($);break;case 33:case 89:case 81:l.track[k-1].event[t-1].data=s.readInt($);break;case 84:l.track[k-1].event[t-1].data=[],l.track[k-1].event[t-1].data[0]=s.readInt(1),l.track[k-1].event[t-1].data[1]=s.readInt(1),l.track[k-1].event[t-1].data[2]=s.readInt(1),l.track[k-1].event[t-1].data[3]=s.readInt(1),l.track[k-1].event[t-1].data[4]=s.readInt(1);break;case 88:l.track[k-1].event[t-1].data=[],l.track[k-1].event[t-1].data[0]=s.readInt(1),l.track[k-1].event[t-1].data[1]=s.readInt(1),l.track[k-1].event[t-1].data[2]=s.readInt(1),l.track[k-1].event[t-1].data[3]=s.readInt(1);break;default:this.customInterpreter!==null&&(l.track[k-1].event[t-1].data=this.customInterpreter(l.track[k-1].event[t-1].metaType,s,$)),this.customInterpreter!==null&&l.track[k-1].event[t-1].data!==!1||(s.readInt($),l.track[k-1].event[t-1].data=s.readInt($),this.debug&&console.info("Unimplemented 0xFF meta event! data block readed as Integer"))}}else switch((d=d.toString(16).split(""))[1]||d.unshift("0"),l.track[k-1].event[t-1].type=parseInt(d[0],16),l.track[k-1].event[t-1].channel=parseInt(d[1],16),l.track[k-1].event[t-1].type){case 15:this.customInterpreter!==null&&(l.track[k-1].event[t-1].data=this.customInterpreter(l.track[k-1].event[t-1].type,s,!1)),this.customInterpreter!==null&&l.track[k-1].event[t-1].data!==!1||(y=s.readIntVLV(),l.track[k-1].event[t-1].data=s.readInt(y),this.debug&&console.info("Unimplemented 0xF exclusive events! data block readed as Integer"));break;case 10:case 11:case 14:case 8:case 9:l.track[k-1].event[t-1].data=[],l.track[k-1].event[t-1].data[0]=s.readInt(1),l.track[k-1].event[t-1].data[1]=s.readInt(1);break;case 12:case 13:l.track[k-1].event[t-1].data=s.readInt(1);break;case-1:n=!0;break;default:if(this.customInterpreter!==null&&(l.track[k-1].event[t-1].data=this.customInterpreter(l.track[k-1].event[t-1].metaType,s,!1)),this.customInterpreter===null||l.track[k-1].event[t-1].data===!1)return console.log("Unknown EVENT detected... reading cancelled!"),!1}}return l},customInterpreter:null};if(typeof Aa<"u")Aa.exports=e;else{let a=typeof window=="object"&&window.self===window&&window||typeof self=="object"&&self.self===self&&self||typeof global=="object"&&global.global===global&&global;a.MidiParser=e}})()});O();O();var pe,Ha,oa=(Ha=class{constructor(){P(this,pe,{})}addEventListener(g,f){r(this,pe)[g]||(r(this,pe)[g]=[]),r(this,pe)[g].unshift(f)}removeEventListener(g,f){if(r(this,pe)[g]){let e=r(this,pe)[g].indexOf(f);e>-1&&r(this,pe)[g].splice(e,1),r(this,pe)[g].length<1&&delete r(this,pe)[g]}}dispatchEvent(g,f){var s;let e=new Event(g),a=this;e.data=f,((s=r(this,pe)[g])==null?void 0:s.length)>0&&r(this,pe)[g].forEach(function(l){try{l==null||l.call(a,e)}catch(u){console.error(u)}}),this[`on${g}`]&&this[`on${g}`](e)}},pe=new WeakMap,Ha);O();O();var Ga=function(g,f){let e=Math.min(g.length,f.length),a=g.slice(0,e),s=f.slice(0,e),l=0,u=0;for(;u<e&&l==0;)l=Math.sign(a[u]-s[u]),u++;return l},xe=function(g=""){this.name=g,this.pool=[],this.point=function(f,e=!1){if(this.pool.length>0){let a=this.pool.length,s=1<<Math.floor(Math.log2(a)),l=s,u=64;for(;s>=1&&u>=0;){if(u<=0)throw new Error("TTL reached.");if(l==a)l-=s;else{let y=Ga(f,this.pool[l]);switch(y){case 0:{u=0;break}case 1:{l+s<=a&&(l+=s);break}case-1:{l!=0&&(l-=s);break}default:console.warn(`Unexpected result ${y}.`)}}s=s>>1,u--}let m=!0;if(l>=this.pool.length)m=!1;else{let y=this;this.pool[l].forEach(function(w,$,k){m&&w!=f[$]&&(m=!1)}),!m&&Ga(f,this.pool[l])>0&&l++}return m||e?l:-1}else return e?0:-1},this.add=function(f,e){return f.data=e,this.pool.splice(this.point(f,!0),0,f),this},this.default=function(f){console.warn(`No match in "${this.name||"(unknown)"}" for "${f}". Default action not defined.`)},this.get=function(f){let e=this.point(f);if(e>-1)return this.pool[e].data;this.default(f)},this.run=function(f,...e){let a=this.point(f);a>-1?f.subarray?this.pool[a].data(f.subarray(this.pool[a].length),...e):this.pool[a].data(f.slice(this.pool[a].length),...e):this.default(f,...e)}};O();var Lr=["MSB","PRG","LSB","NME","ELC","DRM","LVL","VXP"],Dr={krs:"KR",s90es:"ES",motif:"ES"},Br={krs:"Kr",s90es:"SE",motif:"ME"},lt={g2:new Set("gm,GM,g2,G2".split(",")),xg:new Set};for(let g of"XG,MU,AN,AP,DR,DX,PC,PF,SG,VL".split(","))lt.xg.add(g),lt.xg.add(g.toLowerCase());var ya=function(g){let f=Math.floor(g/10),e=g%10;return`${f.toString(16)}${e}`},se,Va,Ea=(Va=class{constructor(...g){A(this,"HINT_XG_MUBASIC",0);A(this,"HINT_XG_MU100",1);A(this,"HINT_XG_PSR",2);P(this,se,void 0);A(this,"strictMode",!1);this.loadFiles(...g)}get bankInfo(){return r(this,se)}get(g=0,f=0,e=0,a,s=0){var C,v,I;let l=[g,f,e],u,m=1,y=0,w,$,k,t=Array.from(arguments);switch(a){case"xg":{switch(g){case 0:{if(s===2)e>>4===7?t[2]+=16:e>>3===13&&(t[2]+=40);else switch(e){case 127:{t[2]=0;break}}break}case 16:{e===126&&(t[2]=0);break}case 32:{e>125&&(t[2]=0),t[2]+=4;break}case 33:{(e>125||e===3)&&(t[2]=0),t[2]+=5;break}case 34:case 35:case 36:{e>125&&(t[2]=0),t[2]+=5;break}case 79:case 80:case 81:case 82:case 83:case 84:t[0]+=16;case 95:case 96:case 97:case 98:case 99:case 100:{e===126&&(t[2]=0);break}case 48:case 64:case 126:case 127:{e===126&&(g===127&&f===0||(t[2]=0));break}case 121:{switch(e){case 126:{t[2]=0;break}case 16:{t[2]=15;break}default:t[2]=t[2]&15}break}}break}case"gs":case"sc":{g===0&&e<5?t[0]=49:g<128&&g>125&&e<5&&e!==2&&(t[2]=g,t[0]=49);break}case"mt32":{g===0&&(t[0]=49);break}case"sd":{switch(g){case 121:{t[0]=96;break}case 120:{t[0]=104;break}}t[0]>>1===40?t[2]|=16:t[0]>95&&t[0]<100&&(t[2]|=16,f>>4===7&&(t[0]=96));break}case"pa":{switch(g){case 120:{e==64?t[2]=2:t[2]=1;break}case 121:{switch(e){case 127:{t[2]=79;break}default:t[2]=(t[2]&63)+32}break}}break}case"g2":{g>>1===40?t[2]|=16:g>95&&g<100&&(t[2]|=16,f>>4===7&&(t[0]=96));break}case"sg":{g===8&&e===0&&(t[2]=5);break}case"05rw":case"x5d":{g&&g<56&&(t[0]=56);break}case"s90es":case"motif":case"an1x":case"cs1x":case"cs6x":{if(g===0)break;switch(g){case 63:{switch(a){case"s90es":{e<8?t[2]+=17:e<32?t[2]+=13:t[2]=(t[2]>>3)+19;break}case"motif":{e<8?t[2]+=28:e<32?t[2]+=13:t[2]=(t[2]>>3)+19;break}case"cs1x":{switch(e>>1){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:case 10:{t[2]+=34;break}case 32:{t[2]=34+((e&1)<<2);break}case 33:{t[2]=47+((e&1)<<2);break}case 61:{t[2]=34+((e&1)<<2);break}case 62:{t[2]=47+((e&1)<<2);break}}break}}break}case 32:{e>125&&(t[2]=0),t[2]+=4;break}case 33:{(e>125||e===3)&&(t[2]=0),t[2]+=5;break}case 34:case 35:case 36:{e>125&&(t[2]=0),t[2]+=5;break}case 79:case 80:case 81:case 82:case 83:case 84:t[0]+=16;case 95:case 96:case 97:case 98:case 99:case 100:{e===126&&(t[2]=0);break}}break}}let n=" ",d="M",i="",c=0,o=0;switch(t[0]){case 0:{switch(t[2]){case 127:{d="GM-a";break}case 126:{d="GM-n";break}case 7:{d="GM-k",i="GLX";break}case 5:{d="SG-a",i="000";break}case 4:{a==="gs"||a==="sc"?(d="GM-a",i="000"):(d="SP-l",i="C/M");break}case 3:case 2:case 1:{(a==="gs"||a==="sc")&&(d="GM-a",i="000");break}case 0:{d="GM-a";break}default:d="y",c=3}break}case 8:{a==="sg"?d="GM-s":d="r:";break}case 32:case 33:case 34:case 35:case 36:{a==="xg"&&(d=`${["AP","VL","PF","DX","AN"][g&7]}-${"abcdefgh"[e]}`,c=3);break}case 48:{i=`M${(t[2]>>3).toString().padStart(2,"0")}`,d=`y${i}`,c=1;break}case 49:{t[2]>>1===63?(d=`MT-${"ba"[t[2]&1]}`,i=`C${"-/"[t[2]&1]}M`):(d="GM-a",i="000");break}case 56:{d="GM-b";break}case 57:d=["yDOC","QY10","QY20"][t[2]-112]||"yMxv",i=["DOC","QY1","QY2"][t[2]-112]||"057";case 61:case 128:{d="rDrm";break}case 120:{d="gDrm";break}case 62:{d="kDrm";break}case 63:{if(t[2]<17){let R=t[2];d=R<10?"kP:":"kC:",d+=R%10}else if(t[2]<34)d=["Pre1","Pre2","Pre3","Pre4","Usr1","Usr2","DrmP","DrmU","Plg1","Plg2","Plg3","Pre1","Pre2","Pre3","Pre4","Pre5","Pre6"][t[2]-17];else if(t[2]<55){let R=t[2]-34;switch(R>12&&R--,e>>1){case 32:case 33:{d=`Pr${e-63}U`;break}case 61:case 62:{d=`Pr${e-121}U`;break}default:d=t[2]===46?"PrDr":`Pr${(R>>2)+1}${String.fromCharCode(65+(R&3))}`}}else d="Ds";c=1;break}case 64:{d="ySFX",i="SFX";break}case 67:{d="DX:S";break}case 80:case 81:case 82:case 83:{d=`Prg${"UABC"[t[0]-80]}`;break}case 88:case 89:case 90:case 91:{d=`Cmb${"UABC"[t[0]-88]}`;break}case 95:{d=`${["DR","PC"][t[2]]}-d`;break}case 96:{d=t[2]===106?"AP-a":t[2]>>4===1?"SDg":"PF",t[2]>63?o=63:t[2]>>4===1&&(o=16),c=3;break}case 97:{d=t[2]>>4===1?"SDa":"VL:",c=3,t[2]>>4===1?o=16:o=112;break}case 98:{d=t[2]>>4===1?"SDb":"SG-a",c=3,o=16;break}case 99:{d=t[2]>>4===1?"SDc":"DX",t[2]>63?o=63:t[2]>>4===1&&(o=16),c=3;break}case 100:{d="AN",t[2]>63?o=63:t[2]>>4===1&&(o=16),c=3;break}case 104:case 105:case 106:case 107:{d="SDd",o=104;break}case 121:{d=`GM${t[2]?"":"-a"}`,c=1;break}case 122:{d="lDrm";break}case 126:{d="yDrS";break}case 127:{t[2]===127?d="rDrm":d="yDrm";break}default:t[0]<48?d="r:":d="M"}d.length<4&&(d+=`${[g,e,t[0],t[2]][c]-o}`.padStart(4-d.length,"0")),i.length<3&&(i+=`${[g,e,g,e][c]}`.padStart(3-i.length,"0")),a==="xg"&&(g===0?t[2]<100?d=d.replace("y0","y:"):t[2]===125&&(d="y126"):g===16?(u=`Voice${((t[2]<<7)+t[1]+1).toString().padStart(3,"0")}`,n=" "):g===35&&e>>1===2&&(u=`DXCH_${(((t[2]&1)<<7)+f+1).toString().padStart(3,"0")}`,n=" "));let h=[t[0],t[1],t[2]];for(;!((u==null?void 0:u.length)>=0);)if(u=(C=r(this,se)[t[1]||0][(t[0]<<8)+t[2]])==null?void 0:C.name,u){let R=r(this,se)[t[1]||0][(t[0]<<8)+t[2]];m=(R==null?void 0:R.poly)||m,y=(R==null?void 0:R.type)||y,w=R==null?void 0:R.drum,$=R==null?void 0:R.level,k=R==null?void 0:R.voice}else if(this.strictMode)u="",n="?";else if(t[0]===0&&t[1]===0&&t[2]===0)u="Unloaded";else if(r(this,se)[t[1]||0][t[0]<<8])t[0]===0?(t[2]=0,n="^"):t[2]<1?(t[0]=0,n="*"):(t[2]--,n="^");else if(g===48)t[0]=0,t[2]=0,n="!";else if(g===62)t[1]--,n=" ",t[1]<1&&!(u!=null&&u.length)&&(t[0]=0,n="!");else if(g<63)t[0]===0?(t[2]=0,n="^"):t[2]<1?(t[0]=0,n="*"):t[2]--;else if(g===80)u=`PrgU:${f.toString().padStart(3,"0")}`,n="!";else if(g===88)u=`CmbU:${f.toString().padStart(3,"0")}`,n="!";else if(g===121)u=`GM2Vox0${e}`,n="#";else if(g===122)if(t[1]===32?t[1]:t[1]%=7,u=(v=r(this,se)[t[1]||0][(t[0]<<8)+t[2]])==null?void 0:v.name,u){n=" ";let R=r(this,se)[t[1]||0][(t[0]<<8)+t[2]];m=(R==null?void 0:R.poly)||m,y=(R==null?void 0:R.type)||y,w=R==null?void 0:R.drum,$=R==null?void 0:R.level}else u="",n="*";else t[1]===0?(u=`${g.toString().padStart(3,"0")} ${f.toString().padStart(3,"0")} ${e.toString().padStart(3,"0")}`,n="!"):t[0]===0?(t[2]=0,n="^"):t[2]>0?t[2]--:t[1]>0?(t[1]=0,n="!"):(t[0]=0,n="?");let b=[t[0],t[1],t[2]];switch(n){case"^":{switch(a){case"gs":case"sc":case"ns5r":{n=" ";break}case"xg":{(e===126||e===152)&&(n=" ");break}}g===127&&(n=" ");break}case"*":break;case"!":break;case"?":break}let p="??";switch(t[0]){case 0:{t[2]===0?p="GM":t[2]===5||t[2]===7?p="KG":t[2]<154&&(p="XG");break}case 32:case 33:case 35:case 36:{t[2]>4?p=["AP","VL","PF","DX","AN"][t[0]-32]:p="GS";break}case 48:{p="MU";break}case 49:{t[2]>>1===63?p="MT":t[2]<5&&(p="GM");break}case 56:case 62:{p="AG";break}case 61:case 80:case 83:case 88:case 89:case 91:{p="AI";break}case 82:case 90:{p="XD";break}case 63:{t[2]<17?p="KR":t[2]<34?p="ES":t[2]<55?p="CS":p="DS";break}case 64:case 126:{p="XG";break}case 67:case 99:{p=t[2]>>4===1?"SD":"DX";break}case 81:{p="RW";break}case 95:{p=["DR","PC"][t[2]];break}case 96:{p=t[2]===106?"AP":t[2]>>4===1?"SD":"PF";break}case 97:{p=t[2]>>4===1?"SD":"VL";break}case 98:{p=t[2]>>4===1?"SD":"SG";break}case 100:{p="AN";break}case 104:case 105:case 106:case 107:{p="SD";break}case 120:{p=f===0?"GM":(I=["G2","PA","PA"][t[2]])!=null?I:"G2";break}case 128:{p=f===0?"GM":"GS";break}case 121:{p=t[2]?["G2","XG","PA","PA","PA"][t[2]>>4]:"GM";break}case 122:{p="KG";break}case 127:{p=t[2]===127?"MT":f===0?"GM":"XG";break}default:t[0]<48&&(t[0]===16&&a==="xg"?p="XG":p="GS")}switch(a){case"xg":{let R=0,ae=0,Y="GM",ue=!1,ze=!1;if(lt.xg.has(p)||lt.g2.has(p)?n!==" "?g>>4===6?ze=!0:g!==0&&(ue=!0):h[2]!==b[2]&&(g===81?e>>3===14?(R=97,ae=112,ze=!0,Y="VL"):e>>3===15&&(ue=!0):g===97&&(ze=!0)):g>>4===6?ze=!0:ue=!0,ze&&g===0&&e===0&&(ae=[0,126,152][s]),ue)u="Silence",n="?",p="??";else if(ze){let z=r(this,se)[f][R<<8|ae];p=Y,u=z==null?void 0:z.name,m=(z==null?void 0:z.poly)||m,y=(z==null?void 0:z.type)||y,w=z==null?void 0:z.drum,$=z==null?void 0:z.level,k=z==null?void 0:z.voice,n="^"}break}}if(n!==" ")switch(a){case"krs":case"s90es":case"motif":{u="",p=Dr[a],n="?";break}case"g2":{u="GM2 Ext?",n="?";break}case"pa":{n==="^"&&(u="Unknown",n="?");break}case"xg":{if(n!=="^"){switch(g){case 120:case 127:case 126:{u="SilntKit";break}default:u="Silence"}n="?"}break}default:self.debugMode&&(u="",n="?")}return n==="?"&&(m=0),{name:u||`${Br[a]||a.toUpperCase()}${ya(g||0)}${ya(f||0)}${ya(e||0)}`,poly:m,type:y,drum:w,level:$,voice:k,iid:h,eid:b,sid:l,hint:s,ending:n,sect:d,bank:i,standard:p,mode:a}}async load(g,f,e="(internal)",a){let s=this,l=[],u=0,m=0,y=0;g.split(`
`).forEach(function(w,$){var n;let k=w.split("	"),t=[];if($===0){if(k.forEach(function(d,i){l[Lr.indexOf(d)]=i}),l.length<4){console.debug("Debugger launched.");debugger}}else{let d=0,i=0,c=0,o,h=1,b=0,p,C,v;k.forEach(function(Y,ue){switch(ue){case l[0]:{d=parseInt(Y);break}case l[1]:{i=parseInt(Y);break}case l[2]:{c=parseInt(Y);break}case l[3]:{o=Y;break}case l[4]:{Y=parseInt(Y),Y<16?h=Y+1:(b=(Y&15)+1,h=b);break}case l[5]:{C=Y;break}case l[6]:{typeof Y=="string"&&(p=parseInt(Y));break}case l[7]:{v=Y;break}}}),r(s,se)[i]=r(s,se)[i]||[];let I=r(s,se)[i],R={msb:d,prg:i,lsb:c,name:o,poly:h,type:b,drum:C,level:p,voice:v,priority:a},ae=!1;a<((n=I[d<<8|c])==null?void 0:n.priority)&&(ae=!0,y++),(!I[d<<8|c]||ae||f)&&(I[d<<8|c]=R,u++),m++}}),f||console.debug(`Map: From "${e}", ${m} total, ${u} loaded (${u-y} + ${y}).`)}clearRange(g){let f=g.prg!==void 0?g.prg.constructor===Array?g.prg:[g.prg,g.prg]:[0,127],e=g.msb!==void 0?g.msb.constructor===Array?g.msb:[g.msb,g.msb]:[0,127],a=g.lsb!==void 0?g.lsb.constructor===Array?g.lsb:[g.lsb,g.lsb]:[0,127];for(let s=e[0];s<=e[1];s++){let l=s<<8;for(let u=a[0];u<=a[1];u++){let m=l+u;for(let y=f[0];y<=f[1];y++)delete r(this,se)[y][m]}}}init(){M(this,se,[]);for(let g=0;g<128;g++)r(this,se).push([""])}async loadFiles(...g){this.init();let f=this;g.forEach(async function(e,a){try{f.load(await(await fetch(`./data/bank/${e}.tsv`)).text(),!1,e,a)}catch(s){console.error(`Failed loading "${e}.tsv".`)}})}},se=new WeakMap,Va);O();O();var Pt,Xa,Fa=(Xa=class{constructor(){P(this,Pt,{});A(this,"context")}set(g,f){r(this,Pt)[g]=f}has(g){return!!r(this,Pt)[g]}async read(g,f){if(!this.has(g))throw new Error(`No decoder registered for "${g}"`);return await r(this,Pt)[g].call(this.context||this,f)}},Pt=new WeakMap,Xa);var Ur=function(g,f){let e=!0;return f.forEach((a,s)=>{e=e&&g[s]===a}),e},Kt=function(g){let f=0;return g.forEach(e=>{f*=256,f+=e}),f},Ue=new TextDecoder,Yt=new Fa;Yt.set("s7e",async function(g){let f=new Uint8Array(await g.slice(0,65536).arrayBuffer()),e="MSB	LSB	PRG	NME",a=[0,0,0,0],s=32,l=0,u=0,m=!0,y=[],w=0;for(;m;){let $=f.subarray(l);([()=>{Ue.decode($.subarray(0,4))==="YSFC"?(l+=80,u=1):l++},()=>{if(Ur($.subarray(0,4),a))y.forEach((k,t,n)=>{let d=Kt(f.subarray(k.start+4,k.start+8));k.length=d}),u=2;else{let k=Ue.decode($.subarray(0,4)),t=Kt($.subarray(4,8));y.push({type:k,start:t}),l+=8}},()=>{let k=y[w],t=f.subarray(k.start,k.start+k.length),n=32;switch(k.type){case"ENVC":{let d=s;for(;d<t.length;){let i=t.subarray(d,d+n),c=Ue.decode(i.subarray(0,10)).trimEnd();c.slice(0,5)==="Init "&&(c=""),c&&(e+=`
063	${(i[17]+13).toString().padStart(3,"0")}	${i[19].toString().padStart(3,"0")}	${c}`),d+=n}break}case"EDVC":{let d=s;for(;d<t.length;){let i=t.subarray(d,d+n),c=Ue.decode(i.subarray(0,10)).trimEnd();c.slice(0,5)==="Init "&&(c=""),c&&(e+=`
063	024	${i[19].toString().padStart(3,"0")}	${c}`),d+=n}break}case"EPVC":{let d=32,i=s;for(;i<t.length;){let c=t.subarray(i,i+d),o=Ue.decode(c.subarray(0,10)).trimEnd();o==="----------"&&(o=""),o&&(e+=`
063	${(c[17]+1).toString().padStart(3,"0")}	${c[19].toString().padStart(3,"0")}	${o}`),i+=d}break}}w++,w>=y.length&&(u=3,m=!1)}][u]||(()=>{m=!1}))()}return e});Yt.set("pcg",async function(g){let f=new Uint8Array(await g.arrayBuffer()),e="MSB	LSB	PRG	NME",a=100,s=0,l=0,u=!0,m=[],y=0;for(;u;){let w=f.subarray(a);([()=>{u=Ue.decode(w.subarray(0,4))==="INI2",l=w[15],a+=16,s=1},()=>{let $=Ue.decode(w.subarray(0,4)),k=w[5],t=w[7],n=w[11],d=Kt(w.subarray(12,16)),i=Kt(w.subarray(16,20)),c=Kt(w.subarray(36,40)),o=Ue.decode(w.subarray(44,44+n));m.push({type:$,tipMsb:k,tipLsb:t,nameLen:n,length:d,start:i,entryLen:c,name:o}),a+=64,l--,l<1&&(s=2)},()=>{let $=m[y],k=f.subarray($.start,$.start+$.length);switch($.type){case"PRG1":break;case"PBK1":{let t=63,n=($.tipMsb?6:0)+$.tipLsb;for(let d=0;d<128;d++){let i=d*$.entryLen,c=k.subarray(i,i+$.entryLen),o=Ue.decode(c.subarray(0,24)).trimEnd().replace("InitProg","");o.length&&n>5&&(e+=`
${t.toString().padStart(3,"0")}	${n.toString().padStart(3,"0")}	${d.toString().padStart(3,"0")}	${o}`)}break}case"CBK1":{let t=63,n=($.tipMsb?3:0)+$.tipLsb+10;for(let d=0;d<128;d++){let i=d*$.entryLen,c=k.subarray(i,i+$.entryLen),o=Ue.decode(c.subarray(0,24)).trimEnd().replace("InitCombi","");o.length&&n>12&&(e+=`
${t.toString().padStart(3,"0")}	${n.toString().padStart(3,"0")}	${d.toString().padStart(3,"0")}	${o}`)}break}}y++,y>=m.length&&(s=3,u=!1)}][s]||(()=>{u=!1}))()}return e});O();var zt=["off","hall","room","stage","plate","delay LCR","delay LR","echo","cross delay","early reflections","gate reverb","reverse gate"].concat(new Array(4),["white room","tunnel","canyon","basement","karaoke"],new Array(43),["pass through","chorus","celeste","flanger","symphonic","rotary speaker","tremelo","auto pan","phaser","distortion","overdrive","amplifier","3-band EQ","2-band EQ","auto wah"],new Array(1),["pitch change","harmonic","touch wah","compressor","noise gate","voice channel","2-way rotary speaker","ensemble detune","ambience"],new Array(4),["talking mod","Lo-Fi","dist + delay","comp + dist + delay","wah + dist + delay","V dist","dual rotor speaker"]),Wt=["melodic","drums","drum set 1","drum set 2","drum set 3","drum set 4","drum set 5","drum set 6","drum set 7","drum set 8"],Or=[17.1,18.6,20.2,21.8,23.3,24.9,26.5,28,29.6,31.2,32.8,34.3,35.9,37.5,39,40.6,42.2,43.7,45.3,46.9,48.4,50],At=[20,22,25,28,32,36,40,45,50,56,63,70,80,90,100,110,125,140,160,180,200,225,250,280,315,355,400,450,500,560,630,700,800,900,1e3,1100,1200,1400,1600,1800,2e3,2200,2500,2800,3200,3600,4e3,4500,5e3,5600,6300,7e3,8e3,9e3,1e4,11e3,12e3,14e3,16e3,18e3,2e4],Ka=[0,.04,.08,.13,.17,.21,.25,.29,.34,.38,.42,.46,.51,.55,.59,.63,.67,.72,.76,.8,.84,.88,.93,.97,1.01,1.05,1.09,1.14,1.18,1.22,1.26,1.3,1.35,1.39,1.43,1.47,1.51,1.56,1.6,1.64,1.68,1.72,1.77,1.81,1.85,1.89,1.94,1.98,2.02,2.06,2.1,2.15,2.19,2.23,2.27,2.31,2.36,2.4,2.44,2.48,2.52,2.57,2.61,2.65,2.69,2.78,2.86,2.94,3.03,3.11,3.2,3.28,3.37,3.45,3.53,3.62,3.7,3.87,4.04,4.21,4,37,4.54,4.71,4.88,5.05,5.22,5.38,5.55,5.72,6.06,6.39,6.73,7.07,7.4,7.74,8.08,8.41,8.75,9.08,9.42,9.76,10.1,10.8,11.4,12.1,12.8,13.5,14.1,14.8,15.5,16.2,16.8,17.5,18.2,19.5,20.9,22.2,23.6,24.9,26.2,27.6,28.9,30.3,31.6,33,34.3,37,39.7],Ya=function(g){let f=.1,e=-.3;return g>66?(f=5,e=315):g>56?(f=1,e=47):g>46&&(f=.5,e=18.5),f*g-e},za=function(g){return g>105?Or[g-106]:g>100?g*1.1-100:g/10},Wa=",a,i,u,e,o,ka,ki,ku,ke,ko,ky,kw,sa,si,su,se,so,sh,ta,ti,tu,te,to,t,ch,t,s,na,ni,nu,ne,no,ny,nn,ha,hi,hu,he,ho,hy,fa,fi,fu,fe,fo,ma,mi,mu,me,mo,my,mm,ya,yu,ye,yo,ra,ri,ru,re,ro,ry,wa,wi,we,wo,ga,gi,gu,ge,go,gy,gw,za,zi,zu,ze,zo,ja,ji,ju,je,jo,jy,da,di,du,de,do,dy,ba,bi,bu,be,bo,by,va,vi,vu,ve,vo,pa,pi,pu,pe,po,py,nga,ngi,ngu,nge,ngo,ngy,ng,hha,hhi,hhu,hhe,hho,hhy,hhw,*,_,,,~,.".split(","),wa={};`hi*,
ka,„Åã
ki,„Åç
ku,„Åè
ke,„Åë
ko,„Åì
ky,„Åç!
kw,„Åèl
tsu,„Å§
ts,„Å§l
sa,„Åï
si,„Åô„ÅÉ
su,„Åô
se,„Åõ
so,„Åù
shi,„Åó
sh,„Åó!
ta,„Åü
ti,„Å¶„ÅÉ
tu,„Å®„ÅÖ
te,„Å¶
to,„Å®
tchy,„Å°!
tchi,„Å°
na,„Å™
ni,„Å´
nu,„Å¨
ne,„Å≠
no,„ÅÆ
ny,„Å´!
nn,„Çì
ha,„ÅØ
hi,„Å≤
hu,„Åª„ÅÖ
he,„Å∏
ho,„Åª
hy,„Å≤!
fa,„Åµ„ÅÅ
fi,„Åµ„ÅÉ
fu,„Åµ
fe,„Åµ„Åá
fo,„Åµ„Åâ
ma,„Åæ
mi,„Åø
mu,„ÇÄ
me,„ÇÅ
mo,„ÇÇ
my,„Åø!
mm,„á∫
ra,„Çâ
ri,„Çä
ru,„Çã
re,„Çå
ro,„Çç
ry,„Çä!
wa,„Çè
wi,„Çê
we,„Çë
wo,„Çí
nga,„Åã„Çö
ngi,„Åç„Çö
ngu,„Åè„Çö
nge,„Åë„Çö
ngo,„Åì„Çö
ngy,„Åç„Çö!
ng,„É≥
ga,„Åå
gi,„Åé
gu,„Åê
ge,„Åí
go,„Åî
gy,„Åé!
gw,„Åêl
za,„Åñ
zi,„Åö„ÅÉ
zu,„Åö
ze,„Åú
zo,„Åû
ja,„Åò„ÇÉ
ji,„Åò
ju,„Åò„ÇÖ
je,„Åò„Åá
jo,„Åò„Çá
jy,„Åò!
da,„Å†
di,„Åß„ÅÉ
du,„Å©„ÅÖ
de,„Åß
do,„Å©
dy,„Åß!
ba,„Å∞
bi,„Å≥
bu,„Å∂
be,„Åπ
bo,„Åº
by,„Å≥!
va,„Çî„ÅÅ
vi,„Çî„ÅÉ
vu,„Çî
ve,„Çî„Åá
vo,„Çî„Åâ
pa,„Å±
pi,„Å¥
pu,„Å∑
pe,„Éö
po,„ÅΩ
py,„Å¥!
!ya,„ÇÉ
!yu,„ÇÖ
!ye,„Åá
!yo,„Çá
ya,„ÇÑ
yu,„ÇÜ
ye,õÄÅ
yo,„Çà
!a,„ÇÉ
!u,„ÇÖ
!e,„Åá
!o,„Çá
!a,„ÇÉ
!u,„ÇÖ
!e,„Åá
!o,„Çá
la,„ÅÅ
li,„ÅÉ
lu,„ÅÖ
le,„Åá
lo,„Åâ
a,„ÅÇ
i,„ÅÑ
u,„ÅÜ
e,„Åà
o,„Åä
*,„Å£
~,
^,
_,`.split(`
`).forEach(g=>{let f=g.split(",");wa[f[0]]=f[1]});var qa=function(g){let f=g;g[0]=="*"&&(f=f.slice(1)),["aa","ii","uu","ee","oo"].forEach(a=>{for(;f.indexOf(a)>-1;)f=f.replace(a,a[0])});for(let a in wa)f=f.replaceAll(a,wa[a]);f.indexOf("„Çì")==0&&f.length>1&&(f=f.slice(1));let e=f.indexOf("!");return e>-1&&f.length>1&&(f=f.slice(e+1)),f},Qa=function(g){return g?g<96?`cc${g}`:["aftertouch","velocity","pitch bend"][g-96]:"off"},Ja={"":["l9","Undefined fallback"],u8:["utf-8","Unicode"],l1:["l9","Pan-Latin"],jp:["sjis","Japanese"],kr:["iso-2022-kr","Korean"],hz:["gb18030","Simplified Chinese"],b5:["big5","Traditional Chinese"],cy:["koi8-ru","Cyrillic"],vn:["tcvn-5773-1993","Vietnamese"]},Za={m:"Male",f:"Female",c:"Chorus",s:"Solo",p:"Plural",w:"Words",x:"Non-vocal"};O();var Ca=["room 1","room 2","room 3","hall 1","hall 2","plate","delay","panning delay"],ja=["chorus 1","chorus 2","chorus 3","chorus 4","feedback","flanger","short delay","short delay feedback"],er=["delay 1","delay 2","delay 3","delay 4","pan delay 1","pan delay 2","pan delay 3","pan delay 4","delay to reverb","pan repeat"];var _r={0:"thru",256:"stereo EQ",257:"spectrum",258:"enhancer",259:"humanizer",272:"overdrive",273:"distortion",288:"phaser",289:"auto wah",290:"rotary",291:"stereo flanger",292:"step flanger",293:"tremelo",294:"auto pan",304:"compressor",305:"limiter",320:"hexa chorus",321:"tremelo chorus",322:"stereo chorus",323:"space D",324:"3D chorus",336:"stereo delay",337:"modulated delay",338:"3-tap delay",339:"4-tap delay",340:"tremelo control delay",341:"reverb",342:"gate reverb",343:"3D delay",352:"2-pitch shifter",353:"feedback pitch shifter",368:"3D auto",369:"3D manual",370:"Lo-Fi 1",371:"Lo-Fi 2",512:"overdrive - chorus",513:"overdrive - flanger",514:"overdrive - delay",515:"distortion - chorus",516:"distortion - flanger",517:"distortion - delay",518:"enhancer - chorus",519:"enhancer - flanger",520:"enhancer - delay",521:"chorus - delay",522:"flanger - delay",523:"chorus - flanger",524:"rotary multi",1024:"guitar multi 1",1025:"guitar multi 2",1026:"guitar multi 3",1027:"clean guitar multi 1",1028:"clean guitar multi 2",1029:"bass multi",1030:"rhodes multi",1280:"keyboard multi",4352:"chorus / delay",4353:"flanger / delay",4354:"chorus / flanger",4355:"overdrive / distortion",4356:"overdrive / rotary",4357:"overdrive / phaser",4358:"overdrive / auto wah",4359:"phaser / rotary",4360:"phaser / auto wah"},Nr={66307:["drive"],66309:["vowel",g=>"aiueo"[g]],94723:["pre-filter"],94724:["Lo-Fi type"],94725:["post-filter"],94979:["Lo-Fi type"],94980:["fill type",g=>["off","LPF","HPF"][g]],94984:["noise type",g=>["white","pink"][g]],94987:["disc type",g=>["LP","SP","EP","RND"]],94990:["hum type",g=>`${g+5}0Hz`],94993:["M/S",g=>["mono","stereo"][g]]},ka=function(g){return _r[(g[0]-32<<8)+g[1]]||`0x${g[0].toString(16).padStart(2,"0")}${g[1].toString(16).padStart(2,"0")}`},tr=function(g,f,e){let a=(g[0]-32<<16)+(g[1]<<8)+f,s=Nr[a]||{},l=s[0];if(l!=null&&l.length)return l+=`: ${(s[1]||function(){})(e)||e}`,l},va=[68,48,95,78,41,3,110,122,0];O();var Oe=new TextEncoder,ar=(g,f)=>{let e=Math.min(g.length,f.length),a=0;for(let s=0;s<e;s++)if(a=g[s]-f[s],a!==0)return[s,a];return g.length!==f.length?[e,g.length-f.length]:[0,0]},be=function(g=64){return Math.round(2e3*Math.log10(g/64))/100},rr=function(g,f,e){let a=[],s=e==!1?f.readIntVLV():e;g==0||g==127;for(let l=0;l<s;l++){let u=f.readInt(1);if(a.push(u),u!=247){if(u!=240){if(u>127)return console.debug(`Early termination: ${a}`),a.pop(),f.backOne(),f.backOne(),new Uint8Array(a)}}}return new Uint8Array(a)},dt=function(g){let f=0;return g.forEach(e=>{f+=e,f=f&127}),~f+1&127},Te=function(g,f){let e=0,a=0;for(let s=0;s<g.length;s++){let l=(s&7)-1,u=(a>>l&1)<<7,m=g[s];m+=u,s&7?(f(m,e,g),e++):a=g[s]}};var Hr=function(g,f){let e=0;for(let a=0;a<g.length;a++)if(a&1){e=e<<4|g[a]&15;let s=a>>1;f(e,s,g)}else e=g[a]&15},sr=function(g){let f=g.length>>1,e=new Uint8Array(f);return Hr(g,(a,s)=>{e[s]=a}),e},qt=function(g){let f=Math.floor(g*14.2);return f<128?f:0},D=function(){var g;return(g=self==null?void 0:self.debugMode)!=null?g:!1},ir=function(g){let f=(g.length+1)*3>>2,e=new Uint8Array(f),a=g.length+3>>2;for(let s=0;s<a;s++){let l=s<<2,u=s*3,m=0;for(let y=0;y<4;y++)m<<=6,m|=g.charCodeAt(l+y)-32&63;e[u]=m>>16,e[u+1]=m>>8&255,e[u+2]=m&255}return e};var Bs="‚ô≠ùÑ´,ùÑ´,‚ô≠,,‚ôØ,ùÑ™,ùÑ™‚ôØ".split(",");var ge=[new Map,new Map];ge[0].set("base64",Oe.encode("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"));ge[0].set("base64url",Oe.encode("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"));ge[0].set("hex",Oe.encode("0123456789abcdef"));ge[0].set("ovm43",Oe.encode("0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_"));ge[0].set("radix64",Oe.encode("0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz+/"));ge[0].set("radix64url",Oe.encode("0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_"));ge[0].set("xx",Oe.encode("+-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz"));ge[0].set("xxurl",Oe.encode("_-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz"));ge[0].set("z64",Oe.encode("0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ+/"));ge[0].set("z64url",Oe.encode("0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ-_"));for(let[g,f]of ge[0]){let e=new Uint8Array(128).fill(255);for(let a=0;a<f.length;a++)e[f[a]]=a;switch(g){case"hex":{for(let a=10;a<16;a++)e[a+55]=a;break}default:e[9]=254,e[10]=254,e[12]=254,e[13]=254,e[32]=254,e[61]=254}ge[1].set(g,e)}console.debug(ge);var Gr=(g="base64",f,e=!1)=>{};self.bufferTo=Gr;O();var la={red:"#ff7986",orange:"#fca022",grYellow:"#c9e10a",green:"#c1ff0a",white:"#b7e5e3",blue:"#2280ff"},ca={black:"#000000",blue:"#0516bb",purple:"#48009a",inactive:22,medium:59,active:170,range:148},Vr=[[6,26],[7,35],[8,44],[9,53],[10,62],[11,71],[12,80],[13,89],[14,98],[15,107],[16,116],[17,125],[18,134],[19,143],[20,152],[21,161],[22,170]],Qt={},Xr="06,68,2a,16,aa,3b".split(",");for(let g in ca)Qt[g]=[],Xr.forEach(f=>{Qt[g].push(`${ca[g]}${f}`)});var da=[];for(let g of Vr)da.push([`${ca.black}${g[0].toString(16).padStart(2,"0")}`,`${ca.black}${g[1].toString(16).padStart(2,"0")}`]),g.push(g[1]-g[0]);var _s=`${la.orange}64`,Ns=`${la.green}64`,Hs=`${la.white}64`,Gs=`${la.red}64`,Vs=Qt.black[0],Xs=Qt.black[2],Fs=Qt.black[1];var q=["?","gm","gs","sc","xg","g2","mt32","doc","qy10","qy20","ns5r","x5d","05rw","k11","sg","sd","pa","krs","s90es","motif","cs6x","trin","an1x","cs1x"],Fr={gm2:"g2","mt-32":"mt32","c/m":"mt32",ag10:"05rw","ag-10":"05rw","05r/w":"05rw",x5:"05rw",x5dr:"x5d",gmega:"k11","kross 2":"krs","motif es":"motif","s90 es":"s90es",trinity:"trin","tr-rack":"trin"},Kr=["melodic","drum","menu"],Jt={"?":[0,0,120,0,0],gm:[0,0,120,0,0],gs:[0,0,128,0,0],sc:[0,0,128,0,0],xg:[0,0,127,0,0],g2:[0,0,120,0,0],mt32:[0,127,127,0,127],doc:[57,112,127,57,112],qy10:[57,113,127,57,113],qy20:[57,114,127,57,114],ns5r:[0,0,61,0,0],x5d:[82,0,62,56,0],"05rw":[81,0,62,56,0],k11:[0,0,122,0,0],sg:[0,0,122,0,0],sd:[97,0,105,0,0],pa:[0,0,120,121,0],krs:[121,0,120,0,0],s90es:[0,0,127,0,0],motif:[0,0,127,0,0],cs6x:[0,0,127,0,0],trin:[0,0,61,0,0],an1x:[36,3,127,0,0],cs1x:[0,0,127,63,0],cs2x:[0,0,127,63,0]},Yr=[9,25,41,57,73,89,105,121],zr=[0,3,81,84,88],nr={8:"Off",9:"On",10:"Note aftertouch",11:"cc",12:"pc",13:"Channel aftertouch",14:"Pitch"},ha={0:0,1:1,2:3,5:4},or={0:0,1:1,2:2,5:3},cr=[[0,24],[0,127],[0,127],[40,88],[0,127],[0,127]],Sa=[36,37,48,49,52,53],pa=[20,21,22,23,24,25,26,28,29,30,31,36,37,48,49,52,53,64,65],lr={26:127,29:0,30:0,31:0,52:12,53:54},ht=[0,1,2,4,5,6,7,8,10,11,12,13,14,15,16,17,18,19,20,21,22,26,28,32,38,40,41,42,43,44,45,46,47,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,80,81,82,83,84,91,92,93,94,95,98,99,100,101,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157],Wr=[2,4,12,13,14,15,16,17,18,19,20,21,40,41,42,43,44,45,46,47,80,81,83,136,130,131,132,133,134,135,137,138,139,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157],qr=[33,102,99,32,100,8,9,10],dr=[0,16,25,40,32,64,24,48],Zt="reverb,chorus,delay,insert0,insert1,insert2,insert3,insert4".split(","),Me=[["VL",32,8,1],["SG",8,1,1],["DX",16,1,16],["AN",16,2,5],["PF",2,1,64],["DR",2,1,32],["PC",2,1,32],["AP",2,1,64]],x={};q.forEach((g,f)=>{x[g]=f});var T=[];ht.forEach((g,f)=>{T[g]=f});var we={length:pa.length};pa.forEach((g,f)=>{we[g]=f});var Qr={};Kr.forEach((g,f)=>{Qr[g]=f});var Jr=function(g){let f=[],e=0;return g==null||g.forEach(function(a,s){a===247?f.push(g.subarray(e,s)):a===240&&(e=s+1)}),f.length||f.push(g.subarray(0)),D()&&console.debug(f),f};var $a=8,E={port:$a,ch:$a<<4,chShift:Math.ceil(Math.log2($a))+4,cc:ht.length,nn:128,pl:512,tr:256,cmt:14,rpn:6,rpnt:4,nrpn:Sa.length,ace:8,drm:8,dpn:pa.length,dnc:128,ext:3,efx:8,cvn:12,redir:32,vxPrim:3,invalidCh:255};E.chcc=E.cc*E.ch;var Be={bank0:255},Zr=new TextDecoder("l9"),G=new Uint16Array(E.ch),Rt=new Uint16Array(E.ch),jr=new Uint16Array(E.ch),fa=new Uint16Array(E.ch),es=new Uint16Array(E.ch),It=new Uint16Array(E.ch),hr=new Array(E.drm);for(let g=0;g<E.ch;g++)G[g]=g*E.cc,Rt[g]=g*E.rpn,jr[g]=g*E.nrpn,fa[g]=g*E.ace,es[g]=g*E.ext,It[g]=g*E.cvn;for(let g=0;g<E.drm;g++){hr[g]=new Uint16Array(E.dpn);let f=g*E.dpn*E.dnc;for(let e=0;e<E.dpn;e++)hr[g][e]=f+e*E.dnc}if(typeof(self==null?void 0:self.require)<"u")throw new Error("Environments supporting CommonJS is not supported.");var Pe,We,fr,ts=(fr=class{constructor(f){P(this,Pe,void 0);P(this,We,!0);A(this,"autoRealtime",!1);f&&this.attach(f)}detach(){M(this,Pe,void 0),M(this,We,!0),this.autoRealtime=!1}attach(f,e){if(typeof f<"u"&&typeof f.currentTime=="number")M(this,Pe,f),M(this,We,!1),this.autoRealtime=!0;else throw new TypeError("Not a valid time source.")}timeMs(){return typeof(performance==null?void 0:performance.now)=="function"?performance.now():Object.hasOwn(self,"Temporal")?Temporal.Now.instant().epochMilliseconds:Date.now()}get realtime(){return r(this,We)||typeof r(this,Pe)>"u"}set realtime(f){if(f)M(this,We,!0);else{if(typeof r(this,Pe)>"u")throw new TypeError("No attached time source is present.");M(this,We,!1)}}get currentTime(){return this.realtime||!r(this,Pe)?this.timeMs()*.001:r(this,Pe).currentTime}now(){return this.realtime||!r(this,Pe)?Math.floor(this.timeMs()):Math.round(r(this,Pe).currentTime*1e3)}},Pe=new WeakMap,We=new WeakMap,fr),H,ne,Ae,Re,Fe,Lt,as,jt,me,V,L,S,ie,_,ee,oe,Z,F,qe,_e,ft,ce,B,N,Dt,he,Ie,ye,ut,pt,Q,Bt,gt,Ce,bt,Ut,Qe,Le,Ot,Je,j,U,Ne,ea,W,mt,_t,xa,Ta,Ma,Pa,Ze,je,ta,Nt,ke,K,aa,J,Ht,yt,Ee,He,et,le,Et,te,ra,ua,wt,Ct,re,ve,De,kt,vt,$t,ur,li=(ur=class extends oa{constructor(){super();P(this,Fe);A(this,"NOTE_IDLE",0);A(this,"NOTE_ATTACK",1);A(this,"NOTE_DECAY",2);A(this,"NOTE_SUSTAIN",3);A(this,"NOTE_HELD",4);A(this,"NOTE_RELEASE",5);A(this,"NOTE_SOSTENUTO_ATTACK",8);A(this,"NOTE_SOSTENUTO_DECAY",9);A(this,"NOTE_SOSTENUTO_SUSTAIN",10);A(this,"NOTE_SOSTENUTO_HELD",11);A(this,"NOTE_MUTED_RECOVERABLE",16);A(this,"CH_MELODIC",0);A(this,"CH_DRUMS",1);A(this,"CH_DRUM1",2);A(this,"CH_DRUM2",3);A(this,"CH_DRUM3",4);A(this,"CH_DRUM4",5);A(this,"CH_DRUM5",6);A(this,"CH_DRUM6",7);A(this,"CH_DRUM7",8);A(this,"CH_DRUM8",9);A(this,"DUMP_ALL",0);A(this,"DUMP_ONCE",1);A(this,"DUMP_MODE",2);A(this,"EXT_NONE",0);A(this,"EXT_VL",1);A(this,"EXT_DX",3);A(this,"VLBC_SYSTEM",0);A(this,"VLBC_BRTHEXPR",1);A(this,"VLBC_VELOINIT",2);A(this,"VLBC_VELOALL",3);A(this,"CH_INACTIVE",0);A(this,"CH_ACTIVE",1);A(this,"CH_DISABLED",2);A(this,"KARAOKE_NONE",0);A(this,"KARAOKE_TEXT",1);A(this,"KARAOKE_XF",2);P(this,H,0);P(this,ne,0);P(this,Ae,0);P(this,Re,new Array(11));P(this,jt,16);P(this,me,new Uint8Array(E.ch));P(this,V,new Uint8Array(E.ch));P(this,L,new Uint8Array(E.ch));P(this,S,new Uint8Array(E.chcc<<1));P(this,ie,new Uint8Array(E.ch*E.ace));P(this,_,new Uint8Array(E.ch*E.vxPrim));P(this,ee,new Uint8Array(E.ch*E.nn));P(this,oe,new Uint8Array(E.ch));P(this,Z,new Uint16Array(E.pl));P(this,F,new Uint8Array(E.pl));P(this,qe,new Int16Array(E.ch));P(this,_e,new Uint8Array(E.ch));P(this,ft,new Uint8Array(E.ch));P(this,ce,new Uint8Array(E.ch*E.ext));P(this,B,new Uint8Array(E.ch*E.rpn));P(this,N,new Uint8Array(E.ch*E.rpnt));P(this,Dt,new Int8Array(E.ch*Sa.length));P(this,he,new Uint8Array(E.drm*E.dpn*E.dnc));P(this,Ie,new Uint8Array(E.drm*2));P(this,ye,new Uint8Array(E.efx*3));P(this,ut,new Uint8Array(E.ch));P(this,pt,new Uint8Array(E.ch*E.redir));P(this,Q,new Uint8Array(E.port));P(this,Bt,new Uint8Array(E.port));P(this,gt,new Uint8Array(E.ch));P(this,Ce,new Uint8Array(E.ch));P(this,bt,new Uint8Array(E.ch*E.cvn));P(this,Ut,new Uint8Array(E.ch));P(this,Qe,new Uint8Array(128));P(this,Le,new Uint8Array(E.cmt*8));P(this,Ot,new Uint8Array(1024));P(this,Je,new Uint8Array(E.cmt*64));P(this,j,{});A(this,"clockSource",new ts);A(this,"modelEx",{xg:{map:0,varSys:!1,insPart:new Uint8Array(5)},yPlg:[],vl:{module:0,breath:1,voiceCh:E.invalidCh},sc:{showBar:!0,invBar:!1,invDisp:!1,peakHold:1},cs1x:{perfCh:0},kross:{chToggle:!1},sg:{convLastSyll:0,runLineLen:0,maxLineLen:32,splitMask:!1}});P(this,U,void 0);P(this,Ne,void 0);P(this,ea,void 0);P(this,W,100);P(this,mt,0);P(this,_t,500);P(this,xa,0);P(this,Ta,0);P(this,Ma,32);P(this,Pa,!1);P(this,Ze,"");P(this,je,0);P(this,ta,0);P(this,Nt,0);P(this,ke,!0);P(this,K,0);P(this,aa,void 0);P(this,J,!1);P(this,Ht,0);P(this,yt,new Array(E.ch));P(this,Ee,[]);P(this,He,new Uint8Array(E.ch));P(this,et,new Uint8Array(E.tr));A(this,"baseBank",new Ea("gm2","ns5r","xg","gs","sd","gmega","plg-vl","plg-pf","plg-dx","plg-an","plg-dr","plg-sg","kross","s90es","cs2x","pa"));A(this,"userBank",new Ea("gm2"));A(this,"initOnReset",!1);A(this,"aiEfxName","");A(this,"polyIndexShrink",!0);A(this,"polyIndexLatest",0);A(this,"polyIndexLast",0);A(this,"lcdHideBankInfo",!1);P(this,le,[]);P(this,Et,void 0);P(this,te,{nOff:(e,a)=>{let s=e*128+a,l=r(this,Z).lastIndexOf(s);if(l>-1)if(this.getChCc(e,64)>>6)r(this,F)[l]=this.NOTE_HELD,this.dispatchEvent("note",{part:e,note:a,velo:r(this,ee)[s],state:this.NOTE_HELD});else if(this.getChCc(e,66)>>6&&r(this,F)[l]===this.NOTE_SOSTENUTO_SUSTAIN)r(this,F)[l]=this.NOTE_SOSTENUTO_HELD,this.dispatchEvent("note",{part:e,note:a,velo:r(this,ee)[s],state:this.NOTE_SOSTENUTO_HELD});else{r(this,Z)[l]=0,r(this,ee)[s]=0,r(this,F)[l]=this.NOTE_IDLE;let u=this.getExt(e)[1];(u===this.VLBC_VELOINIT||u===this.VLBC_VELOALL)&&this.setChCc(e,129,0),this.dispatchEvent("note",{part:e,note:a,velo:0,state:this.NOTE_IDLE})}if(r(this,oe)[e]){for(let u=this.polyIndexLast;u>=0;u--)if(r(this,Z)[u]>>7===e&&r(this,F)[u]!==0){r(this,F)[u]===this.NOTE_MUTED_RECOVERABLE&&(r(this,F)[u]=this.NOTE_SUSTAIN);break}}if(this.polyIndexShrink&&this.polyIndexLast>0){let m=!1,y=this.polyIndexLast-8,w=this.polyIndexLast;for(;w>y&&r(this,F)[w]===0;w--)m=!0;m&&(this.polyIndexLast=w,r(this,F)[w+1]!==0&&console.error("Polyphonic slot shrinking edge case."))}},nOn:(e,a,s)=>{let l=e*128+a,u=0;if(r(this,oe)[e])for(let m=0;m<=this.polyIndexLast;m++)r(this,Z)[m]>>7===e&&r(this,F)[m]!==0&&(r(this,F)[m]=this.NOTE_MUTED_RECOVERABLE);for(;r(this,F)[u]>0&&r(this,Z)[u]!==l;)u++;if(u<E.pl){r(this,Z)[u]=l,r(this,ee)[l]=s,r(this,F)[u]=this.NOTE_SUSTAIN,r(this,_e)[e]<s&&(r(this,_e)[e]=s);let m=this.getExt(e)[1];(m===this.VLBC_VELOINIT||m===this.VLBC_VELOALL)&&this.setChCc(e,129,s),this.dispatchEvent("note",{part:e,note:a,velo:s,state:this.NOTE_SUSTAIN}),this.polyIndexLatest=u+1,u>this.polyIndexLast&&(this.polyIndexLast=u)}else console.error("Polyphony exceeded.")},nAt:(e,a,s)=>{},cAt:(e,a)=>{},hoOf:e=>{r(this,F).forEach((a,s)=>{if(a===this.NOTE_HELD){let l=r(this,Z)[s],u=l>>7;e===u&&(r(this,F)[s]=this.NOTE_IDLE,r(this,Z)[s]=0,r(this,ee)[l]=0,this.dispatchEvent("note",{part:e,note:l&127,velo:0,state:this.NOTE_IDLE}))}})},soOn:e=>{r(this,F).forEach((a,s)=>{let l;switch(a){case this.NOTE_ATTACK:{l=this.NOTE_SOSTENUTO_ATTACK;break}case this.NOTE_DECAY:{l=this.NOTE_SOSTENUTO_DECAY;break}case this.NOTE_SUSTAIN:{l=this.NOTE_SOSTENUTO_SUSTAIN;break}}if(l){r(this,F)[s]=l;let u=r(this,Z)[s];this.dispatchEvent("note",{part:e,note:u&127,velo:r(this,ee)[u],state:l})}})},soOf:e=>{r(this,F).forEach((a,s)=>{if(a===this.NOTE_SOSTENUTO_HELD){let l=r(this,Z)[s],u=l>>7;e===u&&(r(this,F)[s]=this.NOTE_IDLE,r(this,Z)[s]=0,r(this,ee)[l]=0,this.dispatchEvent("note",{part:e,note:l&127,velo:0,state:this.NOTE_IDLE}))}})},ano:e=>{r(this,Z).forEach(a=>{let s=a>>7,l=a&127;a===0&&r(this,ee)[0]===0||s===e&&r(this,te).nOff(s,l)})}});P(this,ra,{8:function(e){let a=e.channel,s=e.data[0];r(this,te).nOff(a,s)},9:function(e){let a=e.channel,s=this;if(s.getChModeId(a)===x.xg&&r(s,L)[a]>1){let m=s.getChDrumFirstWrite(a);m[0]&&m[1]!==E.invalidCh&&!r(s,me)[a]&&(s.copyChSetup(m[1],a),s.pushChPrimitives(a),console.debug(`Part CH${a+1} copied from CH${m[1]+1}.`))}s.setChActive(a,1);let l=e.data[0],u=e.data[1];u>0?r(s,te).nOn(a,l,u):r(s,te).nOff(a,l)},10:function(e){let a=e.channel,s=a*128+e.data[0];r(this,Z).indexOf(s)>-1&&(r(this,ee)[s]=data[1],this.getExt(a)[1]===this.VLBC_VELOALL&&this.setChCc(a,129,data[1]),this.dispatchEvent("note",{part:a,note:e.data[0],velo:e.data[1],state:this.NOTE_SUSTAIN}))},11:function(e){let a=e.channel,s=this,l=r(s,yt)[a],u=l[e.data[0]];u&&(e.data[0]=u),[0,32].indexOf(e.data[0])>-1&&(()=>{switch(r(this,H)){case x.s90es:case x.motif:{if(e.data[0]===0){[0,63].indexOf(e.data[1])>-1&&s.setChActive(a,1);break}e.data[1]&&s.setChActive(a,1);break}default:break}})();let m=a*E.ext,y=s.getChModeId(a);switch(e.data[0]){case 96:return;case 97:return;case 120:return;case 121:{r(this,te).ano(a),r(this,qe)[a]=0,s.resetChCc(a,1,0),s.resetChCc(a,5,0),s.resetChCc(a,64,0),s.resetChCc(a,65,0),s.resetChCc(a,66,0),s.resetChCc(a,67,0),s.resetChCc(a,11,127),s.resetChCc(a,101,127),s.resetChCc(a,100,127),s.resetChCc(a,99,127),s.resetChCc(a,98,127);return}case 123:{r(this,te).ano(a);return}case 124:{r(this,te).ano(a);return}case 125:{r(this,te).ano(a);return}case 126:{r(this,oe)[a]=1,r(this,te).ano(a);return}case 127:{r(this,oe)[a]=0,r(this,te).ano(a);return}}if(T[e.data[0]]===void 0)console.warn(`cc${e.data[0]} is not accepted.`);else{switch(Wr.indexOf(e.data[0])>-1&&this.allocateAce(a,e.data[0]),e.data[0]){case 0:{switch(D()&&console.debug(`${q[r(s,H)]}, CH${a+1}: ${e.data[1]}`),r(this,H)===0?e.data[1]<48?(r(s,L)[a]>0&&(e.data[1]=s.getChPrimitive(a,1,!1),e.data[1]=Jt.gs[2],console.debug(`Forced channel ${a+1} to stay drums.`)),e.data[1]>0&&(console.debug(`Roland GS detected with MSB: ${e.data[1]}`),s.switchMode("gs",0))):e.data[1]===56||e.data[1]===62?s.switchMode(r(s,U).x5===82?"x5d":"05rw",0):e.data[1]===63?s.switchMode(q[r(s,U).ds],0):e.data[1]===64||e.data[1]===127?s.switchMode("xg",0):(e.data[1]===120||e.data[1]===121)&&s.switchMode("g2",0):r(s,H)===x.gs||r(s,H)===x.sc?e.data[1]<56&&r(this,L)[a]>0&&(e.data[1]=this.getChPrimitive(a,1,!1),e.data[1]=Jt.gs[2],console.debug(`Forced channel ${a+1} to stay drums.`)):r(this,H)===x.gm&&(e.data[1]<48?r(this,L)[a]>0&&(e.data[1]=Jt.gs[2],this.switchMode("gs",1),console.debug(`Forced channel ${a+1} to stay drums.`)):(e.data[1]===64||e.data[1]===127)&&this.switchMode("xg",1)),r(this,H)){case x.xg:{[79,95,120,126,127].indexOf(e.data[1])>-1?r(this,L)[a]===0&&(this.setChType(a,this.CH_DRUM2),console.debug(`CH${a+1} set to drums by MSB.`)):r(this,L)[a]>0&&(this.setChType(a,this.CH_MELODIC),console.debug(`CH${a+1} set to melodic by MSB.`)),[33,81,97].indexOf(e.data[1])>-1?r(this,ce)[m]=this.EXT_VL:[35,67,83,99].indexOf(e.data[1])>-1?r(this,ce)[m]=this.EXT_DX:r(this,ce)[m]=this.EXT_NONE;break}case x["05rw"]:case x.x5d:case x.ns5r:{[61,62,126,127].indexOf(e.data[1])>-1?r(this,L)[a]===this.CH_MELODIC&&(this.setChType(a,this.CH_DRUM2),console.debug(`CH${a+1} set to drums by MSB.`)):r(this,L)[a]!==this.CH_MELODIC&&(this.setChType(a,this.CH_MELODIC),console.debug(`CH${a+1} set to melodic by MSB.`));break}case x.sd:{[104,105,106,107,120].indexOf(e.data[1])>-1?r(this,L)[a]===0&&(this.setChType(a,this.CH_DRUM2),console.debug(`CH${a+1} set to drums by MSB.`)):r(this,L)[a]>0&&(this.setChType(a,this.CH_MELODIC),console.debug(`CH${a+1} set to melodic by MSB.`));break}case x.g2:{e.data[1]===120?r(this,L)[a]===0&&(this.setChType(a,this.CH_DRUMS),console.debug(`CH${a+1} set to drums by MSB.`)):r(this,L)[a]>0&&(this.setChType(a,this.CH_MELODIC),console.debug(`CH${a+1} set to melodic by MSB.`));break}}break}case 2:{this.getExt(a)[1]===this.VLBC_BRTHEXPR&&this.setChCc(a,129,e.data[1]);break}case 6:{if(r(this,ft)[a]){[x.xg,x.gs,x.sc,x.ns5r].indexOf(r(this,H))<0&&console.warn(`NRPN commits are not available under "${q[r(this,H)]}" mode, even when they are supported in Octavia.`);let w=this.getChCc(a,99),$=this.getChCc(a,98);if(w===1){let k=qr.indexOf($);if(k>-1)this.setChCc(a,71+k,e.data[1]),D()&&console.debug(`Redirected NRPN 1 ${$} to cc${71+k}.`),this.dispatchEvent("cc",{part:a,cc:71+k,data:e.data[1]});else{let t=Sa.indexOf($);t>-1?r(this,Dt)[a*10+t]=e.data[1]-64:console.warn(`NRPN 0x01${$.toString(16).padStart(2,"0")} is not supported.`),D()&&console.debug(`CH${a+1} voice NRPN ${$} commit`)}}else{if(pa.indexOf(w)<0){let t=`NRPN 0x${w.toString(16).padStart(2,"0")}${$.toString(16).padStart(2,"0")} `;console.warn(w===127?`${t}is not necessary. Consider removing it.`:`${t}is not supported.`)}else{let t=r(this,L)[a]-2;t<0?console.warn(`CH${a+1} cannot accept drum NRPN as type ${Wt[r(this,L)[a]]}.`):r(this,he)[(t*E.dpn+we[w])*E.dnc+$]=e.data[1]}D()&&console.debug(`CH${a+1} (${Wt[r(this,L)[a]]}) drum NRPN ${w} commit`)}}else{let w=ha[this.getChCc(a,100)],$=or[this.getChCc(a,100)];if(this.getChCc(a,101)===0&&w!==void 0)switch(D()&&console.debug(`CH${a+1} RPN 0 ${this.getChCc(a,100)} commit: ${e.data[1]}`),e.data[1]=Math.min(Math.max(e.data[1],cr[w][0]),cr[w][1]),r(this,B)[a*E.rpn+w]=e.data[1],r(this,N)[a*E.rpnt+$]=1,y){case x.xg:case x.gs:case x.sc:case x.mt32:case x.s90es:case x.motif:case x.cs1x:case x.cs6x:{switch(this.getChCc(a,100)){case 1:case 2:{this.dispatchEvent("pitch",{part:a,pitch:this.getPitchShift(a)});break}}break}default:this.dispatchEvent("pitch",{part:a,pitch:this.getPitchShift(a)})}}break}case 32:{switch(D()&&console.debug(`${q[r(this,H)]}, CH${a+1} LSB: ${e.data[1]}`),r(this,H)){case x.s90es:case x.motif:{this.setChType(a,[32,40].indexOf(e.data[1])>-1?this.CH_DRUMS:this.CH_MELODIC,r(this,H),!0);break}}this.getExt(a)[0],this.EXT_DX;break}case 38:{if(!r(this,ft)[a]){let w=ha[this.getChCc(a,100)],$=or[this.getChCc(a,100)];this.getChCc(a,101)===0&&w!==void 0&&(r(this,B)[a*E.rpn+w+1]=e.data[1],r(this,N)[a*E.rpnt+$]=1)}break}case 64:{e.data[1]<64&&r(this,te).hoOf(a);break}case 66:{e.data[1]>>6?r(this,te).soOn(a):r(this,te).soOf(a);break}case 98:case 99:{r(this,ft)[a]=1;break}case 100:case 101:{r(this,ft)[a]=0;break}}this.setChCc(a,e.data[0],e.data[1]),this.dispatchEvent("cc",{part:a,cc:e.data[0],data:e.data[1]})}s.getChModeId(a)===x.xg&&r(s,L)[a]&&s.setDrumFirstWrite(a)},12:function(e){let a=e.channel,s=this;switch(r(s,H)){case x.s90es:case x.motif:{e.data&&s.setChActive(a,1);break}default:s.setChActive(a,1)}let l=G[a];switch(s.getExt(a)[0]){case s.EXT_VL:break}r(s,_)[a]=e.data,r(s,Ce)[a]=0,s.pushChPrimitives(a),D()&&console.debug(`T:${e.track} C:${a} P:${e.data}`),s.getChModeId(a)===x.xg&&r(s,L)[a]&&s.setDrumFirstWrite(a)},13:function(e){let a=this,s=e.channel;r(this,Z).forEach(function(l){let u=l>>7;s===u&&(r(a,ee)[l]=e.data,a.dispatchEvent("note",{part:s,note:l&127,velo:e.data,state:a.NOTE_SUSTAIN}))})},14:function(e){let a=e.channel;r(this,qe)[a]=e.data[1]*128+e.data[0]-8192,this.dispatchEvent("pitch",{part:a,pitch:this.getPitchShift(a)})},15:function(e){Jr(e.data).forEach(a=>{let s=a[0],l=a[1];M(this,Ht,a.length),(r(this,ua)[s]||function(){console.debug(`Unknown manufacturer ${s}.`)})(l,a.subarray(2),e.track)})},248:function(e){},250:function(e){},251:function(e){},252:function(e){},254:function(e){},255:function(e){(r(this,le)[e.meta]||function(s,l,u){}).call(this,e.data,e.track,e.meta),e.meta!==32&&M(this,mt,0);let a=zr.indexOf(e.meta)>-1;if(D()&&console.debug(e),a)return e.reply="meta",e}});P(this,ua,{64:(e,a,s)=>{r(this,kt).run(a,s,e)},65:(e,a,s)=>{if(a[0]<16)if(a[1]===72){let l=a[a.length-1],u=dt(a.subarray(3,a.length-1));l===u?r(this,ve).run(a.subarray(0,a.length-1),s,e):console.warn(`Bad SD checksum ${l} - should be ${u}.`)}else r(this,ve).run(a,s,e);else{let l=a[a.length-1],u=dt(a.subarray(2,a.length-1));l===u?r(this,ve).run(a.subarray(0,a.length-1),s,e):console.warn(`Bad GS checksum ${l} - should be ${u}.`)}},66:(e,a,s)=>{r(this,De).run(a,s,e)},67:(e,a,s)=>{switch(e>>4){case 0:{let l=0;for(;a[l]===127&&l<4;)l++;let u=a[1+l]<<7|a[2+l];if(u+7+l!==a.length){console.warn(`Yamaha bulk dump length mismatch! Expected ${a.length-7-l}, received ${u}.`),console.debug(a);break}let m=dt(a.subarray(1+l,a.length-1)),y=a[a.length-1];if(a[a.length-1]>>7)console.warn(`Yamaha bulk dump checksum invalid! Expected ${m}, received ${y}:
`),console.debug(a);else if(m!==y)console.warn(`Yamaha bulk dump checksum mismatch! Expected ${m}, received ${y}:
`),console.debug(a);else{let w=a.slice(2,a.length-1);for(let $=0;$<=l;$++)w[$]=a[$];r(this,re).run(w,s,e&15)}break}case 1:{r(this,re).run(a,s,e&15);break}case 2:{console.warn("Octavia doesn't yet support Yamaha bulk dump requests.");break}case 3:{console.warn("Octavia doesn't yet support Yamaha parameter requests.");break}case 7:{switch(e&15){case 14:{let l=new Uint8Array(a.length+1);l[0]=126,l.set(a,1),r(this,re).run(l,s,0);break}default:console.warn(`Unknown Yamaha special SysEx type: ${e}.`)}break}default:console.warn(`Unknown Yamaha SysEx type: ${e>>4}.`)}},68:(e,a,s)=>{r(this,$t).run(a,s,e)},71:(e,a,s)=>{r(this,vt).run(a,s,e)},126:(e,a,s)=>{r(this,wt).run(a,s,e)},127:(e,a,s)=>{this.switchMode("gm",0),r(this,Ct).run(a,s,e)}});P(this,wt,void 0);P(this,Ct,void 0);P(this,re,void 0);P(this,ve,void 0);P(this,De,void 0);P(this,kt,void 0);P(this,vt,void 0);P(this,$t,void 0);let e=this;for(let t=0;t<10;t++)r(e,Re)[t]=new Uint8Array(256);r(e,Re)[10]=new Uint8Array(512),M(e,Et,new xe),M(e,U,{x5:82,ds:x.krs,smotif:x.s90es,gs:4,sc:3,gm:x.gm,g2:x.g2}),M(e,Ne,{dumpLimit:e.DUMP_MODE}),M(e,ea,new Proxy(r(e,Ne),{set:()=>{}}));for(let t in Jt){let n=x[t];n===void 0?console.debug(`SubDB build error: "${t}" does not exist`):r(e,j)[n]=new Uint8Array(Jt[t])}for(let t of Me)e.modelEx.yPlg.push(new Uint8Array(t[1]));e.userBank.strictMode=!0,e.userBank.load(`MSB	PRG	LSB	NME
062	000	000	
122	000	000	
122	001	000	
122	002	000	
122	003	000	
122	004	000	
122	005	000	
122	006	000	`),e.addEventListener("metacommit",function(t){var d,i;let{data:n}=t;((d=r(e,Ee)[0])==null?void 0:d.type)===n.type&&((i=r(e,Ee)[0])!=null&&i.amend)?(r(e,Ee)[0].amend=n.amend,r(e,Ee)[0].data+=n.data):r(e,Ee).unshift(n)}),r(e,le)[1]=function(t){var n,d,i,c;switch(t=t.replaceAll(`\r
`,`
`).replaceAll("\r",`
`),t.substring(0,2)){case"@I":{M(e,K,e.KARAOKE_TEXT),e.dispatchEvent("metacommit",{type:"Kar.Info",data:(n=t.substring(2))==null?void 0:n.trimStart()});break}case"@K":{M(e,K,e.KARAOKE_TEXT);let o=t.substring(2);o!=="MIDI KARAOKE FILE"&&e.dispatchEvent("metacommit",{type:"Kar.Mode",data:o==null?void 0:o.trimStart()}),console.debug(`Karaoke mode active: ${o}`);break}case"@L":{M(e,K,e.KARAOKE_TEXT),e.dispatchEvent("metacommit",{type:"Kar.Lang",data:(d=t.substring(2))==null?void 0:d.trimStart()});break}case"@T":{M(e,K,e.KARAOKE_TEXT),e.dispatchEvent("metacommit",{type:"KarTitle",data:(i=t.substring(2))==null?void 0:i.trimStart()});break}case"@V":{M(e,K,e.KARAOKE_TEXT),e.dispatchEvent("metacommit",{type:"Kar.Ver.",data:(c=t.substring(2))==null?void 0:c.trimStart()});break}case"Mi":{if(t.substring(2,16)==="dStamp-1.00: 0"){let o=t.length;for(let b=t.length;b>0;b--)if((t.charCodeAt(b-1)>>5)+1>>1===1){o=b;break}let h=t.substring(16,o);e.dispatchEvent("metacommit",{type:"MidStamp",data:ir(h)})}else t.split(`
`).forEach((o,h)=>{e.dispatchEvent("metacommit",{type:"Cmn.Text",data:o,mask:h!==0})});break}case"XF":{let o=t.slice(2).split(":");switch(o[0]){case"hd":{o.slice(1).forEach((h,b)=>{h.length&&e.dispatchEvent("metacommit",{type:["XfSngDte","XfSngRgn","XfSngCat","XfSongBt","XfSngIns","XfSngVoc","XfSngCmp","XfSngLrc","XfSngArr","XfSngPer","XfSngPrg","XfSngTag"][b],data:h})});break}case"ln":{o.slice(1).forEach((h,b)=>{h.length&&e.dispatchEvent("metacommit",{type:["XfKarLng","XfKarNme","XfKarCmp","XfKarLrc","XfKarArr","XfKarPer","XfKarPrg"][b],data:h})});break}default:e.dispatchEvent("metacommit",{type:"XfUnData",data:t})}break}default:switch(r(e,K)){case e.KARAOKE_TEXT:{switch(t[0]){case"\\":{e.dispatchEvent("metacommit",{type:"KarLyric",data:"",amend:!1}),e.dispatchEvent("metacommit",{type:"KarLyric",data:t.substring(1),amend:!0});break}case"/":{e.dispatchEvent("metacommit",{type:"KarLyric",data:"",mask:!0,amend:!1}),e.dispatchEvent("metacommit",{type:"KarLyric",data:t.substring(1),mask:!0,amend:!0});break}default:e.dispatchEvent("metacommit",{type:"KarLyric",data:t,amend:!0})}break}default:t.split(`
`).forEach((o,h)=>{e.dispatchEvent("metacommit",{type:"Cmn.Text",data:o,mask:h!==0})})}}},r(e,le)[2]=function(t){e.dispatchEvent("metacommit",{type:"Copyrite",data:t})},r(e,le)[3]=function(t,n){n<1&&r(e,mt)<1&&e.dispatchEvent("metacommit",{type:"TrkTitle",data:t})},r(e,le)[4]=function(t,n){e.dispatchEvent("metacommit",{type:"Instrmnt",data:t})},r(e,le)[5]=function(t){switch(r(e,K)){case e.KARAOKE_XF:{let n="";for(let d of t)switch(d){case"^":case"%":{n+=" ";break}case">":{n+="	";break}case"<":{e.dispatchEvent("metacommit",{type:"KarLyric",data:n,mask:r(e,J),amend:!1}),n="",M(e,J,!1);break}case"/":{e.dispatchEvent("metacommit",{type:"KarLyric",data:n,mask:!1,amend:!1}),n="",M(e,J,!0);break}default:n+=d}n.length>0&&(e.dispatchEvent("metacommit",{type:"KarLyric",data:n,mask:r(e,J),amend:!0}),M(e,J,!1));break}default:{let n=0,d=!0,i=t.length-1;for(;d&&n<8;)switch(t.charCodeAt(n)){case 32:{n++;break}default:d=!1}switch(n>0&&(e.dispatchEvent("metacommit",{type:"C.Lyrics",data:t.substring(0,n),amend:!0,mask:r(e,J),untimed:!0}),M(e,J,!1)),t.charCodeAt(i)){case 10:{e.dispatchEvent("metacommit",{type:"C.Lyrics",data:t.substring(n,i),amend:!1,mask:r(e,J)}),M(e,J,!1);break}case 11:case 13:{e.dispatchEvent("metacommit",{type:"C.Lyrics",data:t.substring(n,i),amend:!1,mask:r(e,J)}),M(e,J,!0);break}case 32:{e.dispatchEvent("metacommit",{type:"C.Lyrics",data:t.substring(n,i),amend:!0,mask:r(e,J)}),e.dispatchEvent("metacommit",{type:"C.Lyrics",data:" ",amend:!0,mask:!1,untimed:!0}),M(e,J,!1);break}default:t.trim()===""?console.info("Blank line? Shouldn't happen."):e.dispatchEvent("metacommit",{type:"C.Lyrics",data:t,amend:!0,mask:r(e,J)}),M(e,J,!1)}break}}},r(e,le)[6]=function(t){e.dispatchEvent("metacommit",{type:"C.Marker",data:t})},r(e,le)[7]=function(t){switch(t[0]){case"$":{if(t.substring(1,5)==="Lyrc"){M(e,K,e.KARAOKE_XF);let n=t.substring(6).split(":"),d=n[0].replaceAll(" ","").split(",");d.forEach((c,o,h)=>{h[o]=parseInt(c)-1});let i=Ja[n[2].substring(0,2).toLowerCase()];e.dispatchEvent("metacommit",{type:"XfMeloCh",data:`CH${n[0].replaceAll(" ","").split(",").join(", CH")}`,parsed:d}),e.dispatchEvent("metacommit",{type:"XfLyrOff",data:n[1],parsed:parseInt(n[1])}),e.dispatchEvent("metacommit",{type:"XfLyrEnc",data:i[1],parsed:i[0]}),M(e,J,!1)}else e.dispatchEvent("metacommit",{type:"CuePoint",data:t});break}case"#":{e.dispatchEvent("metacommit",{type:"XfScneNo",data:t.substring(1)});break}case"&":{t.length===2?(e.dispatchEvent("metacommit",{type:"XfSngPrt",data:Za[t[1]]||`Unknown "${t[1]}"`}),M(e,J,!1)):e.dispatchEvent("metacommit",{type:"CuePoint",data:t});break}default:e.dispatchEvent("metacommit",{type:"CuePoint",data:t})}},r(e,le)[32]=function(t){M(e,mt,t[0]+1)},r(e,le)[33]=function(t,n){D()&&console.debug(`Track ${n} requests assigning to port ${t}.`),r(e,et)[n]=t+1},r(e,le)[81]=function(t,n){M(e,_t,t/1e3)},r(e,le)[127]=function(t,n){r(e,Et).run(t,n)},r(e,Et).default=function(t){let n=[];for(let d=0;d<8&&d<t.length;d++)n.push(t[d].toString(16).padStart(2,"0").toUpperCase());console.warn(`Unrecognized implementation-specific byte sequence: ${n.join(" ")}${t.length>8?" ...":""}
%o`,t)},r(e,Et).add([67,0,1],(t,n)=>{D()&&console.debug(`XGworks requests assigning track ${n} to port ${t[0]}.`),r(e,et)[n]=t[0]+1}).add([67,123,1],(t,n)=>{let d=[];for(let i=0;i<t.length;i+=2){let c=t[i]>>4,o=t[i]&15;if(c<7&&o&&o<8){let h=new Uint8Array(5);h[0]=o-1,h[1]=c-3<<2,h[2]=t[i|1],d.push(h)}}e.dispatchEvent("metacommit",{type:"ChordCtl",src:"yxf",data:d}),console.debug("Yamaha XF chord data: %o",d)}).add([67,123,2],(t,n)=>{var i;let d=new Uint8Array(2);d[0]=t[0]&15,d[1]=t[0]>>4,e.dispatchEvent("metacommit",{type:"RhrslMrk",src:"yxf",data:d}),console.debug(`Yamaha XF rehearsal mark: ${(i=["Intro","Ending","Fill-in"][d[0]])!=null?i:String.fromCharCode(62+d[0])}${"'".repeat(d[1])} %o`,d)}).add([67,123,96],(t,n)=>{let d=[0,0];t.subarray(1,3).forEach(i=>{d[0]=d[0]<<7,d[0]|=i&127}),t.subarray(3,5).forEach(i=>{d[1]=d[1]<<7,d[1]|=i&127}),e.dispatchEvent("metacommit",{type:"YStyleId",data:d}),console.debug(`Yamaha style ID: model ${d[0].toString(16)}, style ${d[1]+1}`)}),M(e,wt,new xe("universal non-realtime")),M(e,Ct,new xe("universal realtime")),M(e,re,new xe("Yamaha")),M(e,ve,new xe("Roland")),M(e,De,new xe("Korg")),M(e,kt,new xe("Kawai")),M(e,vt,new xe("Akai")),M(e,$t,new xe("Casio"));let a=new xe("DX7+ Dump"),s=function(t){let n=[];for(let d=0;d<8&&d<t.length;d++)n.push(t[d].toString(16).padStart(2,"0").toUpperCase());console.info(`Unrecognized SysEx in "${this.name}" set: ${n.join(" ")}${t.length>8?" ...":""}
%o`,t)};r(e,wt).default=s,r(e,Ct).default=s,r(e,re).default=s,r(e,ve).default=s,r(e,De).default=s,r(e,kt).default=s,r(e,vt).default=s,r(e,$t).default=s,a.default=s,r(e,wt).add([9],(t,n,d)=>{e.switchMode(["gm","?","g2"][t[0]-1],2),e.setPortMode(e.getTrackPort(n),1,[x.gm,x["?"],r(e,U).g2][t[0]-1]),M(e,K,r(e,K)||e.KARAOKE_NONE),console.info(`MIDI reset: ${["GM","Init","GM2"][t[0]-1]}`),t[0]===2&&e.init()}),r(e,Ct).add([4,1],(t,n,d)=>{e.invokeSysExIndicator(),M(e,W,((t[1]<<7)+t[0])/16383*100),e.dispatchEvent("mastervolume",r(e,W))}).add([4,3],(t,n,d)=>((t[1]<<7)+t[0]-8192)/8192).add([4,4],(t,n,d)=>t[1]-64).add([4,5],(t,n,d)=>{e.invokeSysExIndicator();let i=t[0],c=t[1],o=t[2],h=3,b=h+(i<<1),p=b+c;if(i!==1){console.error(`Unsupported GM2 global parameter set: slotpath length too long (${i})!
`,t);return}let C=0,v=0,I=0;switch(t.subarray(h,b).forEach(R=>{C=C<<7,C|=R}),D()&&console.debug(`GM2 global parameter: (${t.subarray(3,b)}; p: ${v}, v: ${I})`),C){case 129:{v===0&&(e.setEffectType(0,52,I),e.pushEffectType(0));break}case 130:{v===0&&(e.setEffectType(1,52,I|16),e.pushEffectType(1));break}default:D()&&console.debug("GM2 global paramater slot path unknown.")}}),r(this,re).add([76,0,0],(t,n,d)=>{switch(t[0]){case 125:{e.initDrums(),console.info(`XG drum setup reset on drum kit ${t[1]}.`);break}case 126:{e.switchMode("xg",2),e.setPortMode(e.getTrackPort(n),4,x.xg),e.modelEx.vl.module=0,M(e,K,r(e,K)||e.KARAOKE_NONE),console.info("MIDI reset: XG");break}default:{e.invokeSysExIndicator();let i=[0,0,0,0],c=(o,h)=>{i[h]=o};if(t.subarray(1).forEach((o,h)=>{let b=h+t[0];([c,c,c,c,p=>{M(this,W,p*129/16383*100),e.dispatchEvent("mastervolume",r(e,W))},p=>{},p=>{}][b]||(()=>{}))(o,h)}),t[0]<4){let o=0;i.forEach(h=>{o=o<<4,o+=h}),o-=1024,console.debug(`Master tune: ${o}`)}}}}).add([76,2,1],(t,n,d)=>{e.invokeSysExIndicator();let i="XG ";t[0]<32?(i+="reverb ",t.subarray(1).forEach((c,o)=>{([h=>{e.setEffectTypeRaw(0,!1,h),console.info(`${i}main type: ${zt[h]}`),e.pushEffectType(0)},h=>{e.setEffectTypeRaw(0,!0,h),console.debug(`${i}sub type: ${h+1}`),e.pushEffectType(0)},h=>{console.debug(`${i}time: ${Ya(h)}s`)},h=>{console.debug(`${i}diffusion: ${h}`)},h=>{console.debug(`${i}initial delay: ${h}`)},h=>{console.debug(`${i}HPF cutoff: ${At[h]}Hz`)},h=>{console.debug(`${i}LPF cutoff: ${At[h]}Hz`)},h=>{console.debug(`${i}width: ${h}`)},h=>{console.debug(`${i}height: ${h}`)},h=>{console.debug(`${i}depth: ${h}`)},h=>{console.debug(`${i}wall type: ${h}`)},h=>{console.debug(`${i}dry/wet: ${h}`)},h=>{console.debug(`${i}send: ${be(h)}dB`)},h=>{console.debug(`${i}pan: ${h-64}`)},!1,!1,h=>{console.debug(`${i}delay: ${h}`)},h=>{console.debug(`${i}density: ${h}`)},h=>{console.debug(`${i}balance: ${h}`)},h=>{},h=>{console.debug(`${i}feedback: ${h}`)},h=>{}][t[0]+o]||function(){console.warn(`Unknown XG reverb address: ${t[0]}.`)})(c)})):t[0]<64?(i+="chorus ",t.subarray(1).forEach((c,o)=>{([h=>{e.setEffectTypeRaw(1,!1,h),console.info(`${i}main type: ${zt[h]}`),e.pushEffectType(1)},h=>{e.setEffectTypeRaw(1,!0,h),console.debug(`${i}sub type: ${h+1}`),e.pushEffectType(1)},h=>{console.debug(`${i}LFO: ${Ka[h]}Hz`)},h=>{},h=>{console.debug(`${i}feedback: ${h}`)},h=>{console.debug(`${i}delay offset: ${za(h)}ms`)},h=>{},h=>{console.debug(`${i}low: ${At[h]}Hz`)},h=>{console.debug(`${i}low: ${h-64}dB`)},h=>{console.debug(`${i}high: ${At[h]}Hz`)},h=>{console.debug(`${i}high: ${h-64}dB`)},h=>{console.debug(`${i}dry/wet: ${h}`)},h=>{console.debug(`${i}send: ${be(h)}dB`)},h=>{console.debug(`${i}pan: ${h-64}`)},h=>{console.debug(`${i}to reverb: ${be(h)}dB`)},!1,h=>{},h=>{},h=>{},h=>{console.debug(`${i}LFO phase diff: ${(h-64)*3}deg`)},h=>{console.debug(`${i}input mode: ${h?"stereo":"mono"}`)},h=>{}][t[0]-32+o]||function(){console.warn(`Unknown XG chorus address: ${t[0]}.`)})(c)})):t[0]<86?(i+="variation ",t.subarray(1).forEach((c,o)=>{([h=>{e.setEffectTypeRaw(2,!1,h),console.info(`${i}main type: ${zt[h]}`),e.pushEffectType(2)},h=>{e.setEffectTypeRaw(2,!0,h),console.debug(`${i}sub type: ${h+1}`),e.pushEffectType(2)}][t[0]-64+o]||function(){})(c)})):t[0]<97?(i+="variation ",t.subarray(1).forEach((c,o)=>{[h=>{console.debug(`${i}send: ${be(h)}dB`)},h=>{console.debug(`${i}pan: ${h-64}`)},h=>{console.debug(`${i}to reverb: ${be(h)}dB`)},h=>{console.debug(`${i}to chorus: ${be(h)}dB`)},h=>{e.modelEx.xg.varSys=!!h,console.debug(`${i}connection: ${h?"system":"insertion"}`)},h=>{if(e.modelEx.xg.varSys){console.warn(`${i}effect is applied system-wide. Setting its effective channel to CH${h+1} will not have any effect.`);return}if(h<64){let b=e.chRedir(h,n,!0);e.setXgChEffectSink(b,2),console.debug(`${i}channel: CH${h+1} (CH${b+1})`)}else e.setXgChEffectSink(E.invalidCh,2),console.info(`${i}channel: CH${h+1} (unsupported)`)},h=>{console.debug(`${i}mod wheel: ${h-64}`)},h=>{console.debug(`${i}bend wheel: ${h-64}`)},h=>{console.debug(`${i}channel after touch: ${h-64}`)},h=>{console.debug(`${i}AC1: ${h-64}`)},h=>{console.debug(`${i}AC2: ${h-64}`)}][t[0]-86+o](c)})):t[0]>111&&t[0]<118?i+="variation ":console.warn(`Unknown XG variation address: ${t[0]}`)}).add([76,2,64],(t,n,d)=>{t.subarray(1).forEach((i,c)=>{let o=c+t[0];if(o===0)console.debug(`XG EQ preset: ${["flat","jazz","pop","rock","classic"][i]}`);else{let h=o-1>>2,b=o-1&3,p=`XG EQ ${h} ${["gain","freq","Q","shape"][b]}: `;[()=>{console.debug(`${p}${i-64}dB`)},()=>{console.debug(`${p}${i} (raw)`)},()=>{console.debug(`${p}${i/10}`)},()=>{console.debug(`${p}${["shelf","peak"][+!!i]}`)}][b]()}})}).add([76,3],(t,n,d)=>{e.invokeSysExIndicator();let i=t[0],c=t[1],o=`XG Insertion ${t[0]+1} `;t.subarray(2).forEach((h,b)=>{([()=>{e.setEffectTypeRaw(3+i,!1,h),console.info(`${o}main type: ${zt[h]}`),e.pushEffectType(3+i)},()=>{e.setEffectTypeRaw(3+i,!0,h),console.debug(`${o}sub type: ${h+1}`),e.pushEffectType(3+i)},!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,()=>{if(h<64){let p=e.chRedir(h,n,!0);e.setXgChEffectSink(p,3+i),console.debug(`${o}channel: CH${h+1} (CH${p+1})`)}else e.setXgChEffectSink(E.invalidCh,3+i),console.info(`${o}channel: CH${h+1} (unsupported)`)}][c+b]||function(){})(h)})}).add([76,6,0],(t,n,d)=>{let i=t[0];i<64?e.setLetterDisplay(t.subarray(1),"XG letter display",i):M(e,je,e.clockSource.now())}).add([76,7,0],(t,n,d)=>{let i=t[0];M(e,ne,0),M(e,Ae,e.clockSource.now()+3200),t.subarray(1).forEach(function(o,h){let b=h+i,p=b>>4,C=b&15,v=(C*3+p)*7,I=7,R=0;for(v-=C*5,p===2&&(I=2);R<I;)r(e,Fe,Lt)[v+R]=o>>6-R&1,R++})}).add([76,8],(t,n)=>{e.invokeSysExIndicator();let d=e.chRedir(t[0],n,!0),i=t[1],c=G[d],o=`XG CH${d+1} `,h=`Unknown XG part address ${i}.`,b=!0;t.subarray(2).forEach((p,C)=>{b=!0,i<1?console.debug(h):i<41?([()=>{e.setChCc(d,0,p),e.pushChPrimitives(d)},()=>{e.setChCc(d,32,p),e.pushChPrimitives(d)},()=>{r(e,_)[d]=p,e.pushChPrimitives(d)},()=>{b=!1;let v=e.chRedir(p,n,!0),I=r(e,V)[d];r(e,V)[d]=v,(d!==v||v!==I)&&(e.buildRchTree(),console.info(`${o}receives from CH${v+1}`)),r(e,me)[d]||(e.copyChSetup(v,d,!0),console.debug(`${o}copied from CH${v+1}.`),e.setChActive(d,1),e.pushChPrimitives(d))},()=>{r(e,oe)[d]=+!p},()=>{},()=>{b=!1,e.setChType(d,p,x.xg),console.debug(`${o}type: ${Wt[p]||p}`),e.pushChPrimitives(d)},()=>{r(e,B)[E.rpn*d+3]=p,r(e,N)[E.rpnt*d+2]=1,e.dispatchEvent("pitch",{part:d,pitch:e.getPitchShift(d)})},!1,!1,()=>{e.setChCc(d,7,p)},!1,!1,()=>{e.setChCc(d,10,p||128)},!1,!1,()=>{e.setChCc(d,128,p),e.allocateAce(d,128)},()=>{e.setChCc(d,93,p)},()=>{e.setChCc(d,91,p)},()=>{e.setChCc(d,94,p)},()=>{e.setChCc(d,76,p)},()=>{e.setChCc(d,77,p)},()=>{e.setChCc(d,78,p)},()=>{e.setChCc(d,74,p)},()=>{e.setChCc(d,71,p)},()=>{e.setChCc(d,73,p)},()=>{e.setChCc(d,75,p)},()=>{e.setChCc(d,72,p)}][i+C-1]||(()=>{}))():i<48?console.debug(h):i<111?i>102&&i<105&&e.setChCc(d,[5,65][i&1],p):i<114?console.debug(h):i<116?console.debug(`${o}EQ ${["bass","treble"][i&1]} gain: ${p-64}dB`):i<118?console.debug(h):i<120?console.debug(`${o}EQ ${["bass","treble"][i&1]} freq: ${p}`):console.debug(h)}),b&&r(e,L)[d]>1&&e.setDrumFirstWrite(d)}).add([76,9],(t,n)=>{let d=e.chRedir(t[0],n,!0),i=t[1],c=G[d],o=`PLG-VL CH${d+1} `;t.subarray(2).forEach((h,b)=>{let p=b+i;switch(p){case 1:{console.info(`${o}breath mode: ${["system","breath","velocity","touch EG"][h]}`);break}case 0:case 27:case 28:break;default:if(p<27){let C=p-3>>1,v=["pressure","embouchure","tonguing","scream","breath noise","growl","throat formant","harmonic enhancer","damping","absorption","amplification","brightness"][C];p&1?p<23?(console.debug(`${o}${v} control source: ${Qa(h)}`),h&&h<96&&e.allocateAce(d,130+C),r(e,pt)[E.redir*d+C+2]=h,e.buildRccMap()):console.debug(`${o}${v} scale break point: ${h}`):(console.debug(`${o}${v} depth: ${h-64}`),e.setChCc(d,130+C,h))}}})}).add([76,10],(t,n,d)=>{}).add([76,16],(t,n,d)=>{}).add([76,17,0,0],(t,n,d)=>{}).add([76,112],(t,n,d)=>{if(t[0]>=Me.length){console.error(`Supplied invalid plugin board ID: ${t[0]}`);return}if(t[1]>=Me[t[0]][1]){console.error(`Supplied invalid slot ID for board type "${Me[t[0]][0]}" (${t[0]}): ${t[1]} (#${t[1]+1}))`);return}switch(t[1]>=Me[t[0]][2]?console.warn(`While enabled in Octavia, slot #${t[1]+1} for board type "${Me[t[0]][0]}" (${t[0]}) may not function outside software recreation.`):t[2]>63?console.debug(`XG disable PLG-${Me[t[0]][0]} (${t[0]}) slot #${t[1]+1} as it's set to CH${t[2]+1}.`):console.debug(`XG enable PLG-${Me[t[0]][0]} (${t[0]}) slot #${t[1]+1} for CH${t[2]+1}.`),e.modelEx.yPlg[t[0]][t[1]]=t[2]<64?e.chRedir(t[2],n,!0):E.invalidCh,t[0]){case 0:{r(e,ce)[E.ext*t[2]]=e.EXT_VL;break}case 2:{r(e,ce)[E.ext*t[2]]=e.EXT_DX;break}default:r(e,ce)[E.ext*t[2]]=e.EXT_NONE}}).add([73,0,0],(t,n)=>{let d=t[0],i="MU System - ";t.subarray(1).forEach((c,o)=>{var b,p;let h=d+o;h===8?(e.lcdContrast=Math.max(0,Math.min(8,9-c))<<2,console.debug(`${i}LCD contrast: ${c}.`)):h===18?(r(e,j)[x.xg][1]=(b=[0,126,152][c])!=null?b:127,console.debug(`${i}default bank: ${(p=["MU Basic","MU100 Native","PSR/LE"][c])!=null?p:c}.`),e.modelEx.xg.map=c,e.dispatchEvent("banklevel",{mode:"xg",data:c}),e.forceVoiceRefresh()):h>=64&&h<69&&[()=>{e.dispatchEvent("channelactive",c)},()=>{c<8?(e.dispatchEvent("channelmin",c<<4),console.debug(`Octavia System: Minimum CH${(c<<4)+1}`)):(e.dispatchEvent("channelreset"),console.info("Octavia System: Clear channel ranges"))},()=>{c<8?(e.dispatchEvent("channelmax",(c<<4)+15),console.debug(`Octavia System: Maximum CH${(c<<4)+16}`)):(e.dispatchEvent("channelreset"),console.info("Octavia System: Clear channel ranges"))},()=>{e.dispatchEvent("channelreset"),console.info("Octavia System: Clear channel ranges")},()=>{M(e,ke,!!c),console.info(`Octavia System: RS receiving ${["dis","en"][c]}abled.`)}][h-64]()})}).add([73,10,0],(t,n)=>{let d=t[0],i=`MU RS${r(e,ke)?"":" (ignored)"}: `;if(t[1]!==0){console.info(`${i}button ${d} pressed.`);return}if(d<16)switch(d){case 0:{r(e,ke)&&e.dispatchEvent("portrange",1),console.info(`${i}Show single port.`),e.lcdHideBankInfo=!1;break}case 1:{let c=e.chRedir(0,n,!0);r(e,ke)&&(e.dispatchEvent("portrange",2),e.dispatchEvent("portstart",c)),console.info(`${i}Show CH${c+1}~CH${c+32}.`),e.lcdHideBankInfo=!1;break}case 2:{let c=e.chRedir(0,n,!0);r(e,ke)&&(e.dispatchEvent("portrange",4),e.dispatchEvent("portstart",c)),console.info(`${i}Show CH${c+1}~CH${c+64}.`),e.lcdHideBankInfo=!1;break}case 3:{let c=e.chRedir(0,n,!0);r(e,ke)&&(e.dispatchEvent("portrange",2),e.dispatchEvent("portstart",c)),console.info(`${i}Show CH${c+1}~CH${c+32}, hide info.`),e.lcdHideBankInfo=!0;break}default:d>=4&&d<12?(e.lcdContrast=12-d<<1,console.debug(`${i}LCD contrast set to ${d-3}.`)):console.debug(`${i}unknown switch ${d} invoked.`)}else if(d<32){if(r(e,ke)){let c=e.chRedir(d-16+(r(e,Nt)<<4),n,!0);e.dispatchEvent("channelactive",c)}}else if(d<36){let c=e.chRedir(d-32<<4,n,!0);r(e,ke)&&(e.dispatchEvent("portrange",1),e.dispatchEvent("portstart",c>>4),M(e,Nt,d-32)),console.info(`${i}Show CH${c+1}~CH${c+16}.`)}}).add([73,11,0],(t,n)=>{let d="MU1000 System - channel ",i="Octavia System - channel ",c=t[0];t.subarray(1).forEach((o,h)=>{let b=c+h;([()=>{e.setChActive(o,1),e.dispatchEvent("channelactive",o),D()&&console.debug(`${d}current part: CH${o+1}`)},()=>{o<5?(e.dispatchEvent("portrange",1<<o),console.debug(`${d}port range: ${1<<o} port(s)`)):(e.dispatchEvent("portrange",0),console.debug(`${d}port range: reset`))},()=>{o<16?(e.dispatchEvent("portstart",o),console.debug(`${i}start port: ${"ABCDEFGHIJKLMNOP"[o]}`)):(e.dispatchEvent("portstart",255),console.debug(`${i}start port: reset`))}][b]||(()=>{console.debug(`${d}unknown address: ${b}`)}))()})}).add([87,0,0],(t,n)=>{var i;let d="VL70-m sound module ";switch(t[0]){case 126:{console.info(`${d}mode set to: ${(i=["VL-XG","VL70-m voice"][t[1]])!=null?i:`invalid (${t[1]})`}`),e.switchMode("xg",1),t[1]<2&&(e.modelEx.vl.module=t[1]+1),e.setPortMode(e.getTrackPort(n),1,x.xg);break}default:console.info(`Unknown ${d}address: ${t[0]}`)}}).add([93,3],(t,n)=>{let d=e.chRedir(t[0],n,!0),i=`PLG-SG CH${d+1} `,c=e.clockSource.now(),o=e.modelEx.sg;if(t[1]===0){let h="",b=0;t.subarray(2).forEach((p,C)=>{C%2===0?h+=Wa[p]||p.toString().padStart("0"):b+=p*13}),(c>=o.convLastSyll||o.runLineLen>=o.maxLineLen)&&(e.dispatchEvent("metacommit",{type:"SGLyrics",data:"",amend:!1}),o.splitMask=c<o.convLastSyll,o.runLineLen=0),e.dispatchEvent("metacommit",{type:"SGLyrics",data:`${qa(h)}`,amend:!0,mask:o.splitMask}),o.runLineLen++,o.splitMask=!1,o.convLastSyll=c+Math.ceil(b/2)+r(e,_t),D()&&console.debug(`${i}vocals: ${h}`)}else console.warn(`Unknown PLG-SG data: ${t}`)}).add([98,96],(t,n,d,i)=>{let c=e.chRedir(t[0],n,!0),o=G[c],h=t[1];t.subarray(2).forEach((b,p)=>{let C=h+p;if(!(C<10)){if(C===10)e.resetAce();else if(C<27){let v=C+131;e.setChCc(c,v,b),!(i!=null&&i.noAce)&&b>0&&b!==64&&e.allocateAce(c,v),e.dispatchEvent("cc",{part:c,cc:v,data:b})}}})}).add([1,20],(t,n,d)=>{d===115?(e.switchMode("doc",2),e.setPortMode(e.getTrackPort(n),1,x.doc),console.info("MIDI reset: DOC")):console.debug(`Unknown Yamaha SysEx: 67, ${d}, ${t.join(", ")}`)}).add([1,17,15,89],(t,n,d)=>{d===115?(e.setEffectType(0,24,t[0]|16),e.pushEffectType(0)):console.debug(`Unknown Yamaha SysEx: 67, ${d}, ${t.join(", ")}`)}).add([1,24],(t,n,d)=>{if(d===115){for(let i=0;i<16;i++){let c=e.chRedir(i,n,!0);e.setChCc(c,91,127)}console.info("DOC Global Reverb: on")}else console.debug(`Unknown Yamaha SysEx: 67, ${d}, ${t.join(", ")}`)}).add([126,0],(t,n,d)=>{var i,c,o;switch(t[1]){case 0:{e.dispatchEvent("metacommit",{type:"YMCSSect",data:"Disabled",raw:"Intro "}),console.debug("Yamaha Section Control is off.");break}case 127:{e.dispatchEvent("metacommit",{type:"YMCSSect",data:(i=["Intro","Main A","Main B","Fill-in AB","Fill-in BA","Ending","Blank"][t[0]-8])!=null?i:`invalid section ${t[0]}`,raw:(c=["Intro ","Main A","Main B","FillAB","FillBA","Ending","Blank "][t[0]-8])!=null?c:`ID: ${t[0]}`}),console.debug(`Yamaha Section Control switches to "${(o=["intro","main A","main B","fill-in AB","fill-in BA","ending","blank"][t[0]-8])!=null?o:`Invalid section ${t[0]}`}".`);break}default:console.debug(`Unknown YMCS section control: ${t[1]}`)}}).add([126,2],(t,n,d)=>{let i=[];for(let c=0;c<t.length;c+=2){let o=t[c]>>4,h=t[c]&15;if(o<7&&h&&h<8){let b=new Uint8Array(5);b[0]=h-1,b[1]=o-3<<2,b[2]=t[c|1],i.push(b)}}e.dispatchEvent("metacommit",{type:"ChordCtl",src:"ymcs",data:i}),console.debug("YMCS chord data: %o",i)});let l=function(t,n,d,i){},u=function(t,n){e.invokeSysExIndicator();let d=t*E.dpn,i=n[0],c=n[1];n.subarray(2).forEach((o,h)=>{let b=h+c,p=-1;b<16?([()=>{p=24},()=>{p=25},()=>{p=26},()=>{},()=>{p=28},()=>{p=29},()=>{p=30},()=>{p=31},()=>{},()=>{},()=>{},()=>{p=20},()=>{p=21},()=>{p=22},()=>{p=23},()=>{}][b]||(()=>{console.debug(`Unknown XG-style drum param ${b} on set ${t+1}.`)}))():b<32||(b<40?([()=>{p=48},()=>{p=49},!1,!1,()=>{p=52},()=>{p=53}][b-32]||(()=>{console.debug(`Unknown XG-style drum param ${b} on set ${t+1}.`)}))():b<80||([()=>{p=36}][b-80]||(()=>{console.debug(`Unknown XG-style drum param ${b} on set ${t+1}.`)}))()),p>=0?(D()&&console.debug(d,p,i,o),r(e,he)[(d+we[p])*E.dnc+i]=o):D()&&console.debug(`XG-style drum param ${b} has no writes.`)})},m=function(t,n,d){e.invokeSysExIndicator();let i=t*E.dpn,c=(n<<7)+d[0];d.subarray(1).forEach((o,h)=>{let b=h+c,p=b&127,C=b>>7,v=-1;C>1&&([()=>{v=26},()=>{},()=>{v=28},()=>{v=29},()=>{v=30},()=>{},()=>{},()=>{v=31}][C-2]||(()=>{console.debug(`Unknown GS-style drum param ${C} on set ${t+1}.`)}))(),v>-1?(D()&&console.debug(i,v,p,o),r(e,he)[(i+we[v])*E.dnc+p]=o):D()&&console.debug(`GS-style drum param ${C} has no writes.`)})};r(this,re).add([76,48],(t,n,d)=>{u(0,t)}).add([76,49],(t,n,d)=>{u(1,t)}).add([76,50],(t,n,d)=>{u(2,t)}).add([76,51],(t,n,d)=>{u(3,t)}).add([76,52],(t,n,d)=>{u(4,t)}).add([76,53],(t,n,d)=>{u(5,t)}).add([76,54],(t,n,d)=>{u(6,t)}).add([76,55],(t,n,d)=>{u(7,t)}),r(this,re).add([89,0],(t,n,d)=>{if(e.eprom){let i=t[0],c=(t[1]<<14)+(t[2]<<7)+t[3]+(e.eprom.offset||0);D()&&console.debug(`MU1000 EPROM trail to 0x${c.toString(16).padStart(6,"0")}, ${i} bytes.`);let o=e.eprom.data;t.subarray(4).forEach((h,b)=>{let p=b>>3,C=b&7;if(C===7)for(let v=0;v<7;v++)o[c+7*p+v]+=(h>>6-v&1)<<7;else o[c+7*p+C]=h})}}).add([89,1],(t,n,d)=>{let i=(t[0]<<21)+(t[1]<<14)+(t[2]<<7)+t[3];D()&&console.debug(`MU1000 EPROM jump to 0x${i.toString(16).padStart(6,"0")}.`),e.eprom&&(e.eprom.offset=i)}).add([89,2],(t,n,d)=>{if(e.eprom){let i=(t[0]<<21)+(t[1]<<14)+(t[2]<<7)+t[3]+(e.eprom.offset||0);D()&&console.debug(`MU1000 EPROM write to 0x${i.toString(16).padStart(6,"0")}.`);let c=e.eprom.data;t.subarray(4).forEach((o,h)=>{let b=h>>3,p=h&7;if(p===7)for(let C=0;C<7;C++)c[i+7*b+C]+=(o>>6-C&1)<<7;else c[i+7*b+p]=o})}}).add([89,3],(t,n,d)=>{}),r(this,re).add([39,48],(t,n,d)=>{}).add([43,0,0],(t,n,d)=>{e.invokeSysExIndicator();let i=[0,0,0,0],c=(o,h)=>{i[h]=o};if(t.subarray(1).forEach((o,h)=>{let b=h+t[0];[c,c,c,c,()=>{M(this,W,o*129/16383*100),e.dispatchEvent("mastervolume",r(e,W))},()=>o-64,()=>o||128,()=>o,()=>o,()=>{console.debug(`TG300 variation on cc${o}.`)}][b](o,b)}),t[0]<4){let o=0;i.forEach(h=>{o=o<<4,o+=h}),o-=1024,console.debug(`Master tune: ${o}`)}}).add([43,1,0],(t,n,d)=>{e.invokeSysExIndicator()}).add([43,2],(t,n,d)=>{e.invokeSysExIndicator();let i=e.chRedir(t[0],n,!0),c=t[1],o=G[i],h=`TG300 CH${i+1} `;t.subarray(2).forEach((b,p)=>{p<5?([()=>{},()=>{e.setChCc(i,0,b),e.pushChPrimitives(i)},()=>{e.setChCc(i,32,b),e.pushChPrimitives(i)},()=>{r(e,_)[i]=b,e.pushChPrimitives(i)},()=>{let C=e.chRedir(b,n,!0),v=r(e,V)[i];r(e,V)[i]=C,(i!==C||C!==v)&&(e.buildRchTree(),console.info(`${h}receives from CH${C+1}`))}][p+c]||(()=>{}))(b,p+c):p<21||(p<47?([()=>{r(e,oe)[i]=+!b},()=>{},()=>{},()=>{r(e,B)[E.rpn*i+3]=b,r(e,N)[E.rpnt*i+2]=1,e.dispatchEvent("pitch",{part:i,pitch:e.getPitchShift(i)})},()=>{},()=>{e.setChCc(i,7,b)},!1,!1,()=>{e.setChCc(i,10,b||128)},!1,!1,()=>{console.debug(`${h} AC1 at cc${b}`)},()=>{console.debug(`${h} AC2 at cc${b}`)},()=>{r(e,S)[o+T[128]]=b,e.allocateAce(i,128)},()=>{r(e,S)[o+T[93]]=b},()=>{r(e,S)[o+T[91]]=b},()=>{r(e,S)[o+T[94]]=b},()=>{r(e,S)[o+T[76]]=b},()=>{r(e,S)[o+T[77]]=b},()=>{r(e,S)[o+T[74]]=b},()=>{r(e,S)[o+T[71]]=b},()=>{r(e,S)[o+T[73]]=b},()=>{r(e,S)[o+T[75]]=b},()=>{r(e,S)[o+T[72]]=b},()=>{r(e,S)[o+T[78]]=b}][p+c-21]||(()=>{}))(b,p+c):p<95||([()=>{r(e,S)[o+T[65]]=b},()=>{r(e,S)[o+T[5]]=b}][p+c-95]||(()=>{}))(b,p+c))})}).add([43,7,0],(t,n,d)=>{let i=t[0];e.setLetterDisplay(t.subarray(1),"TG300 letter display",i)}).add([43,7,1],(t,n,d)=>{M(e,ne,0),M(e,Ae,e.clockSource.now()+3200),t.forEach(function(i,c){let o=c>>4,h=c&15,b=(h*3+o)*7,p=7,C=0;for(b-=h*5,o===2&&(p=2);C<p;)r(e,Fe,Lt)[b+C]=i>>6-C&1,C++})}),r(this,ve).add([66,18,0,0,127],(t,n,d)=>{e.switchMode("sc",2),e.setPortMode(e.getTrackPort(n),2,x.sc),M(e,K,e.KARAOKE_NONE),r(e,He).fill(0),console.info(`GS system to ${["single","dual"][t[0]]} mode.`)}).add([66,18,64,0],(t,n,d)=>{switch(t[0]){case 127:{e.switchMode("gs",2),e.setPortMode(e.getTrackPort(n),4,x.gs),M(e,K,e.KARAOKE_NONE),r(e,He).fill(0),console.info("MIDI reset: GS");break}default:{e.invokeSysExIndicator();let i=[0,0,0,0],c=(o,h)=>{i[h]=o};if(t.subarray(1).forEach((o,h)=>{let b=h+t[0];[c,c,c,c,p=>{M(this,W,p*129/16383*100),e.dispatchEvent("mastervolume",r(e,W))},p=>{},p=>{}][b](o,h)}),t[0]<4){let o=0;i.forEach(h=>{o=o<<4,o+=h}),o-=1024,console.debug(`Master tune: ${o}`)}}}}).add([66,18,64,1],(t,n,d)=>{e.invokeSysExIndicator();let i=t[0];if(i<16){let c="".padStart(i," ");t.subarray(1).forEach((o,h)=>{c+=String.fromCharCode(Math.max(32,o))}),c=c.padEnd(16," "),console.debug(`GS patch name: ${c}`)}else i<48||(i<65?t.subarray(1).forEach((c,o)=>{let h=`GS ${i+o>55?"chorus":"reverb"} `;([()=>{console.info(`${h}type: ${Ca[c]}`),e.setEffectType(0,40,c),e.pushEffectType(0)},()=>{},()=>{},()=>{},()=>{},()=>{},!1,()=>{console.debug(`${h}predelay: ${c}ms`)},()=>{console.info(`${h}type: ${ja[c]}`),e.setEffectType(1,40,16+c),e.pushEffectType(1)},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{console.debug(`${h}to reverb: ${be(c)}`)},()=>{console.debug(`${h}to delay: ${be(c)}`)}][i+o-48]||(()=>{}))()}):i<80?console.debug(`Unknown GS patch address: ${i}`):i<91?t.subarray(1).forEach((c,o)=>{let h="GS delay ";([()=>{console.info(`${h}type: ${er[c]}`),e.setEffectType(2,40,32+c),e.pushEffectType(2)},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{console.debug(`${h}to reverb: ${be(c)}`)}][i+o-80]||(()=>{}))()}):console.debug(`Unknown GS patch address: ${i}`))}).add([66,18,64,2],(t,n,d)=>{let i="GS EQ ";t.subarray(1).forEach((c,o)=>{([()=>{console.debug(`${i}low freq: ${[200,400][c]}Hz`)},()=>{console.debug(`${i}low gain: ${c-64}dB`)},()=>{console.debug(`${i}high freq: ${[3e3,6e3][c]}Hz`)},()=>{console.debug(`${i}high gain: ${c-64}dB`)}][t[0]+o]||function(){console.warn(`Unknown GS EQ address: ${t[0]+o}`)})()})}).add([66,18,64,3],(t,n,d)=>{e.invokeSysExIndicator();let i="GS EFX ",c=function(o,h){let b=tr(r(e,ye).subarray(10,12),h,o);b&&console.debug(`${i}${ka(r(e,ye).subarray(10,12))} ${b}`)};t.subarray(1).forEach((o,h)=>{([()=>{e.setEffectTypeRaw(3,!1,32+o),e.pushEffectType(3)},()=>{e.setEffectTypeRaw(3,!0,o),console.info(`${i}type: ${ka(r(e,ye).subarray(10,12))}`),e.pushEffectType(3)},!1,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,()=>{console.debug(`${i}to reverb: ${be(o)}dB`)},()=>{console.debug(`${i}to chorus: ${be(o)}dB`)},()=>{console.debug(`${i}to delay: ${be(o)}dB`)},!1,()=>{console.debug(`${i}1 source: ${o}`),o&&o<96&&e.allocateAceAll(o)},()=>{console.debug(`${i}1 depth: ${o-64}`)},()=>{console.debug(`${i}2 source: ${o}`),o&&o<96&&e.allocateAceAll(o)},()=>{console.debug(`${i}2 depth: ${o-64}`)},()=>{console.debug(`${i}to EQ: ${o?"ON":"OFF"}`)}][t[0]+h]||function(b,p){console.warn(`Unknown GS EFX address: ${p}`)})(o,t[0]+h)})}).add([66,18,65],(t,n,d)=>{m((t[0]>>4)+1<<1,t[0]&15,t.subarray(1))}).add([66,18,72],(t,n,d)=>{let i=(t[0]&127)<<7|t[1]&127;console.debug(i,sr(t.subarray(2)))}).add([69,18,16],(t,n,d)=>{var i;switch(t[0]){case 0:{let c=t[1];e.setLetterDisplay(t.subarray(2),"GS display text",c);break}case 8:{let c=t[1],o=e.modelEx.sc;t.subarray(2).forEach((h,b)=>{([()=>{o.showBar=!(h&1),o.invBar=h>>1&1,o.invDisp=h>>2&1},()=>{o.peakHold=h<4?h:1}][b+c]||(()=>{console.debug("Unsupported GS display type SysEx.")}))()});break}case 32:{M(e,Ae,e.clockSource.now()+3200),t[1]===0&&(t[2]?(M(e,ne,Math.max(Math.min(t[2]-1,9),0)),D()&&console.debug(`GS switch display page ${t[2]-1}.`)):(M(e,ne,0),M(e,Ae,e.clockSource.now()),D()&&console.debug("GS disable display page.")));break}default:if(t[0]<6){r(e,ne)>9&&M(e,ne,0);let c=t[0]-1<<1|t[1]>>6;r(e,ne)===c&&M(e,Ae,e.clockSource.now()+3200),(i=r(e,Re)[c])!=null&&i.length||(r(e,Re)[c]=new Uint8Array(256));let o=r(e,Re)[c];D()&&console.debug(`GS frame draw page ${c}.`);let h=t[1]&63;t.subarray(2).forEach(function(p,C){let v=C+h,I=v>>4,R=v&15,ae=(R*4+I)*5,Y=5,ue=0;for(ae-=R*4,I===3&&(Y=1);ue<Y;)o[ae+ue]=p>>4-ue&1,ue++})}else console.warn(`Unknown GS display section: ${t[0]}`)}}).add([69,18,32],(t,n,d)=>{let i=t[0],c=t[1],o=t.subarray(2);if(i>>4){console.warn(`SC-8850 partial screen dump out of bounds: invalid bundle.
`,t);return}let h=c+o.length,b=c*6-(c*2428>>16<<1),p=h*6-(h*2428>>16<<1);if(b>640){console.warn(`SC-8850 partial screen dump out of bounds: invalid buffer range.
`,t);return}p>640&&(console.info(`SC-8850 partial screen dump out of bounds: invalid buffer end, automatically restricted.
`,t),p=640);let C=new Uint8Array(p-b);o.forEach((R,ae)=>{let Y=ae+c,ue=(Y*2428&65535)*27>>16===26,ze=Y*6-(Y*2428>>16<<1),z=ue?2:0;for(;z<6;)C[ze+(5-z)]=R>>z&1,z++});let v=i*108+c,I=v*6-(v*2428>>16<<1);e.dispatchEvent("screen",{type:"sc8850",offset:I,data:C}),D()&&console.debug(`SC-8850 screen dump: bundle ${i+1}, range ${b}~${p}`)});let y=function(t,n,d){e.invokeSysExIndicator();let i=t[0],c=G[n],o=Rt[n],h=`GS CH${n+1} `;i<3?(t.subarray(1).forEach((b,p)=>{[()=>{r(e,S)[c+T[0]]=b,e.pushChPrimitives(n)},()=>{r(e,_)[n]=b},()=>{let C=0;b<16?C=e.chRedir(b,d,!0):C=E.ch;let v=r(e,V)[n];r(e,V)[n]=C,(n!==C||C!==v)&&(e.buildRchTree(),console.info(`${h}receives from CH${C+1}`))}][i+p]()}),e.pushChPrimitives(n)):i<19||(i<44?t.subarray(1).forEach((b,p)=>{([()=>{r(e,oe)[n]=+!b},!1,()=>{e.setChType(n,b<<1,x.gs),console.debug(`${h}type: ${b?"drum ":"melodic"}${b||""}`)},()=>{r(e,B)[o+3]=b,r(e,N)[E.rpnt*n+2]=1,e.dispatchEvent("pitch",{part:n,pitch:e.getPitchShift(n)})},!1,!1,()=>{r(e,S)[c+T[7]]=b},!1,!1,()=>{e.setChCc(n,10,b||128)},!1,!1,()=>{console.debug(`${h}CC 1: cc${b}`)},()=>{console.debug(`${h}CC 2: cc${b}`)},()=>{r(e,S)[c+T[93]]=b},()=>{r(e,S)[c+T[91]]=b},!1,!1,()=>{r(e,B)[o+1]=b,r(e,N)[E.rpnt*n+1]=1,e.dispatchEvent("pitch",{part:n,pitch:e.getPitchShift(n)})},()=>{r(e,B)[o+2]=b,r(e,N)[E.rpnt*n+1]=1,e.dispatchEvent("pitch",{part:n,pitch:e.getPitchShift(n)})},()=>{r(e,S)[c+T[94]]=b}][i+p-19]||(()=>{}))()}):i<76||console.debug(`Unknown GS part address: ${i}`))},w=function(t,n){let d=t[0],i=`GS CH${n+1} `;d<2?t.subarray(1).forEach((c,o)=>{[()=>{e.setChCc(n,32,c)},()=>{}][d+o]()}):d<32?console.warn(`Unknown GS misc address: ${d}`):d<35?t.subarray(1).forEach((c,o)=>{[()=>{console.debug(`${i}EQ: o${["ff","n"][c]}`)},()=>{},()=>{console.debug(`${i}EFX: o${["ff","n"][c]}`),e.setChEffectSink(n,c?3:0)}][d+o-32]()}):console.warn(`Unknown GS misc address: ${d}`)};r(this,ve).add([66,18,64,16],(t,n)=>{y(t,e.chRedir(9,n,!0),n)}).add([66,18,64,17],(t,n)=>{y(t,e.chRedir(0,n,!0),n)}).add([66,18,64,18],(t,n)=>{y(t,e.chRedir(1,n,!0),n)}).add([66,18,64,19],(t,n)=>{y(t,e.chRedir(2,n,!0),n)}).add([66,18,64,20],(t,n)=>{y(t,e.chRedir(3,n,!0),n)}).add([66,18,64,21],(t,n)=>{y(t,e.chRedir(4,n,!0),n)}).add([66,18,64,22],(t,n)=>{y(t,e.chRedir(5,n,!0),n)}).add([66,18,64,23],(t,n)=>{y(t,e.chRedir(6,n,!0),n)}).add([66,18,64,24],(t,n)=>{y(t,e.chRedir(7,n,!0),n)}).add([66,18,64,25],(t,n)=>{y(t,e.chRedir(8,n,!0),n)}).add([66,18,64,26],(t,n)=>{y(t,e.chRedir(10,n,!0),n)}).add([66,18,64,27],(t,n)=>{y(t,e.chRedir(11,n,!0),n)}).add([66,18,64,28],(t,n)=>{y(t,e.chRedir(12,n,!0),n)}).add([66,18,64,29],(t,n)=>{y(t,e.chRedir(13,n,!0),n)}).add([66,18,64,30],(t,n)=>{y(t,e.chRedir(14,n,!0),n)}).add([66,18,64,31],(t,n)=>{y(t,e.chRedir(15,n,!0),n)}).add([66,18,64,64],(t,n)=>{w(t,e.chRedir(9,n,!0))}).add([66,18,64,65],(t,n)=>{w(t,e.chRedir(0,n,!0))}).add([66,18,64,66],(t,n)=>{w(t,e.chRedir(1,n,!0))}).add([66,18,64,67],(t,n)=>{w(t,e.chRedir(2,n,!0))}).add([66,18,64,68],(t,n)=>{w(t,e.chRedir(3,n,!0))}).add([66,18,64,69],(t,n)=>{w(t,e.chRedir(4,n,!0))}).add([66,18,64,70],(t,n)=>{w(t,e.chRedir(5,n,!0))}).add([66,18,64,71],(t,n)=>{w(t,e.chRedir(6,n,!0))}).add([66,18,64,72],(t,n)=>{w(t,e.chRedir(7,n,!0))}).add([66,18,64,73],(t,n)=>{w(t,e.chRedir(8,n,!0))}).add([66,18,64,74],(t,n)=>{w(t,e.chRedir(10,n,!0))}).add([66,18,64,75],(t,n)=>{w(t,e.chRedir(11,n,!0))}).add([66,18,64,76],(t,n)=>{w(t,e.chRedir(12,n,!0))}).add([66,18,64,77],(t,n)=>{w(t,e.chRedir(13,n,!0))}).add([66,18,64,78],(t,n)=>{w(t,e.chRedir(14,n,!0))}).add([66,18,64,79],(t,n)=>{w(t,e.chRedir(15,n,!0))}),r(this,De).add([54,65],(t,n)=>{let d=r(e,U).x5===81?"05rw":"x5d";e.switchMode(d,1),e.setPortMode(e.getTrackPort(n),1,x[d]);let i=t[t.length-1],c=t.subarray(0,t.length-1),o=dt(c);o!==i&&(console.info(`X5D multi parameters checksum mismatch! Expected ${o}, got ${i}.`),console.debug(t));let h=(t[1]<<7)+t[0],b=(t[3]<<7)+t[2],p=e.chRedir(h&15,n,!0),C=G[p];[()=>{b<1||(b<101?(e.setChType(p,e.CH_MELODIC,x.x5d),r(e,_)[p]=b-1,r(e,S)[C+T[0]]=r(e,U).x5):b<229?(e.setChType(p,e.CH_MELODIC,x.x5d),r(e,_)[p]=b-101,r(e,S)[C+T[0]]=56):(e.setChType(p,e.CH_DRUMS,x.x5d),r(e,_)[p]=dr[b-229]||0,r(e,S)[C+T[0]]=62)),e.pushChPrimitives(p)},()=>{r(e,S)[C+T[7]]=b},()=>{b<31&&(r(e,S)[C+T[10]]=Math.round((b-15)*4.2+64))},()=>{r(e,S)[C+T[93]]=qt(b)},()=>{r(e,S)[C+T[91]]=qt(b)},()=>{r(e,B)[p*E.rpn+3]=b>8191?b-16320:64+b,r(e,N)[E.rpnt*p+2]=1,e.dispatchEvent("pitch",{part:p,pitch:e.getPitchShift(p)})},()=>{r(e,B)[p*E.rpn+1]=b>8191?b-16320:64+b,r(e,N)[E.rpnt*p+1]=1,e.dispatchEvent("pitch",{part:p,pitch:e.getPitchShift(p)})},()=>{b>0&&(r(e,B)[p*E.rpn]=b,r(e,N)[E.rpnt*p]=1,e.dispatchEvent("pitch",{part:p,pitch:e.getPitchShift(p)}))},()=>{}][h>>4]()}).add([54,76,0],(t,n)=>{e.invokeSysExIndicator();let d=r(e,U).x5===81?"05rw":"x5d";e.switchMode(d,1),e.setPortMode(e.getTrackPort(n),1,x[d]);let i="",c=r(e,U).x5,o=0,h=0,b="MSB	PRG	LSB	NME";Te(t,function(p,C){if(C<16400){let v=C%164;switch(!0){case v<10:{p>31&&(i+=String.fromCharCode(p));break}case v===10:break;case v===11:{b+=`
${c}	${o}	${h}	${i.trim().replace("Init Voice","")}`,o++,i="";break}}o>99&&(c=90,o=0)}}),e.userBank.clearRange({msb:r(e,U).x5,prg:[0,99],lsb:0}),e.userBank.load(b),D()&&console.debug(b),e.forceVoiceRefresh()}).add([54,77,0],(t,n)=>{e.invokeSysExIndicator();let d=r(e,U).x5===81?"05rw":"x5d";e.switchMode(d,1),e.setPortMode(e.getTrackPort(n),1,x[d]);let i="",c=90,o=0,h=0,b="MSB	PRG	LSB	NME";Te(t,function(p,C){if(C<13600){let v=C%136;switch(!0){case v<10:{p>31&&(i+=String.fromCharCode(p));break}case v===11:{b+=`
${c}	${o}	${h}	${i.trim().replace("Init Combi","")}`,o++,i="";break}}}}),e.userBank.clearRange({msb:90,prg:[0,99],lsb:0}),e.userBank.load(b),D()&&console.debug(b),e.forceVoiceRefresh()}).add([54,78],(t,n)=>{let d=r(e,U).x5===81?"05rw":"x5d";e.switchMode(d,0),e.setPortMode(e.getTrackPort(n),1,x[d]),console.debug(`X5D mode switch requested: ${["combi","combi edit","prog","prog edit","multi","global"][t[0]]} mode.`)}).add([54,85],(t,n)=>{e.invokeSysExIndicator();let d=r(e,U).x5===81?"05rw":"x5d";e.switchMode(d,1),e.setPortMode(e.getTrackPort(n),1,x[d]),Te(t,(i,c)=>{c>0&&c<3&&(e.setEffectType(c-1,44,i),e.pushEffectType(c-1))})}).add([54,104],(t,n)=>{e.invokeSysExIndicator();let d=r(e,U).x5===81?"05rw":"x5d";e.switchMode(d,1);let i=e.getTrackPort(n);if(r(e,Q)[i]&&r(e,Q)[i]!==x[d])if(r(e,Ne).dumpLimit===e.DUMP_MODE){console.warn(`Dump cancelled for track ${n}. Port ${String.fromCharCode(65+i)} mode "${q[r(e,Q)[i]]}" mismatch, should be "${d}".`);return}else console.info(`Track ${n} is trying to perform a mismached mode dump on port ${String.fromCharCode(65+i)}.`);e.setPortMode(i,1,x[d]),Te(t,function(c,o,h,b){if(o<192){let p=e.chRedir(Math.floor(o/12),n,!0),C=G[p];switch(o%12){case 0:{c<128?(e.setChType(p,e.CH_MELODIC,x.x5d),r(e,S)[C+T[0]]=r(e,U).x5,r(e,_)[p]=c):(e.setChType(p,e.CH_DRUMS,x.x5d),r(e,S)[C+T[0]]=62,r(e,_)[p]=dr[c-128]),c>0&&e.setChActive(p,1),e.pushChPrimitives(p);break}case 1:{r(e,S)[C+T[7]]=c;break}case 2:{r(e,B)[p*E.rpn+3]=c>127?c-192:64+c,r(e,N)[E.rpnt*p+2]=1,e.dispatchEvent("pitch",{part:p,pitch:e.getPitchShift(p)});break}case 3:{r(e,B)[p*E.rpn+1]=c>127?c-192:64+c,r(e,N)[E.rpnt*p+1]=1,e.dispatchEvent("pitch",{part:p,pitch:e.getPitchShift(p)});break}case 4:{c<31&&(r(e,S)[C+T[10]]=Math.round((c-15)*4.2+64));break}case 5:{let v=c>>4,I=c&15;r(e,S)[C+T[91]]=qt(I),r(e,S)[C+T[93]]=qt(v);break}case 10:{r(e,L)[p]||(r(e,S)[C+T[0]]=c>>6?56:r(e,U).x5,e.pushChPrimitives(p));break}case 11:{let v=e.chRedir(c&15,n,!0),I=c>>4;r(e,V)[p]=c,(v!==p||I)&&console.info(`X5D Part CH${p+1} receives from CH${v+1}.`)}}}else{let p=e.chRedir(o-192,n,!0)}}),e.buildRchTree()}),r(this,ve).add([22,18,127],(t,n,d)=>{e.switchMode("mt32",2),e.setPortMode(e.getTrackPort(n),1,x.mt32),M(e,K,e.KARAOKE_NONE),e.userBank.clearRange({msb:0,lsb:127,prg:[0,127]}),console.info("MIDI reset: MT-32")}).add([22,18,0],(t,n,d)=>{e.switchMode("mt32",1);let i=e.chRedir(d,n,!0),c=t[1];t.subarray(2).forEach((o,h)=>{let b=h+c;r(e,Qe)[b+(i-1)*16]=o,([!1,()=>{let p=r(e,Qe)[i-1<<4];if(p<3){if(r(e,Ce)[i]=1,p===2)for(let C=0;C<name.length;C++)r(e,Le)[(i-1)*E.cmt+C]=r(e,Je)[o*E.cmt+C];else{let C=e.baseBank.get(0,o+(p<<6),127,"mt32").name;for(let v=0;v<C.length;v++)r(e,Le)[(i-1)*E.cmt+v]=C.charCodeAt(v)}e.pushChPrimitives(i)}},()=>{r(e,B)[i*E.rpn+3]=o+40,r(e,N)[E.rpnt*i+2]=1},()=>{r(e,B)[i*E.rpn+1]=o+14,r(e,N)[E.rpnt*i+1]=1},()=>{r(e,B)[i*E.rpn]=o,r(e,N)[E.rpnt*i]=1},!1,()=>{e.setChCc(i,91,o?127:0)},!1,()=>{e.setChCc(i,7,o)},()=>{e.setChCc(i,10,Math.ceil(o*9.05))}][b]||(()=>{}))()})}).add([22,18,1],(t,n,d)=>{e.switchMode("mt32",1);let i=d&7;console.debug(`MT-32 slot #${d+1} Drum: ${t}`);let c=t[0]<<7|t[1];t.subarray(2).forEach((o,h)=>{let b=h+c,p=(b>>2)+24,C=b&3,v=i*E.dpn;if(D()&&console.debug(`MT-32 temp drum note ${p} param ${C}: ${o}`),p<24){console.warn(`MT-32 dev drum write attempted on an OOB note: ${p}`);return}[()=>{},()=>{r(e,he)[(v+we[26])*E.dnc+p]=Math.round(o*1.27)},()=>{r(e,he)[(v+we[26])*E.dnc+p]=o*9+1&127},()=>{r(e,he)[(v+we[26])*E.dnc+p]=o?127:0}][C]()})}).add([22,18,2],(t,n,d)=>{e.switchMode("mt32",1);let i=e.chRedir(d,n,!0),c=t[1]+(t[0]<<7);c<10&&(r(e,Ce)[i]=1),t.subarray(2).forEach((o,h)=>{let b=h+c;b<14&&(r(e,Le)[(i-1)*E.cmt+b]=o)}),e.pushChPrimitives(i)}).add([22,18,3],(t,n,d)=>{e.switchMode("mt32",1);let i=d&7;if(t[0]){let c=(t[0]-1<<7)+t[1]-16;t.subarray(2).forEach((o,h)=>{let b=h+c,p=(b>>2)+24,C=b&3,v=i*E.dpn;if(D()&&console.debug(`MT-32 dev drum note ${p} param ${C}: ${o}`),p<24){console.warn(`MT-32 dev drum write attempted on an OOB note: ${p}`);return}[()=>{},()=>{r(e,he)[(v+we[26])*E.dnc+p]=Math.round(o*1.27)},()=>{r(e,he)[(v+we[26])*E.dnc+p]=o*9+1&127},()=>{r(e,he)[(v+we[26])*E.dnc+p]=o?127:0}][C]()})}else{let c=t[1];t.subarray(2).forEach((o,h)=>{let b=h+c;r(e,Qe)[b]=o;let p=e.chRedir(1+(b>>4),n,!0),C=b&15;([!1,()=>{let v=r(e,Qe)[p-1<<4];if(v<3)if(r(e,Ce)[p]=1,v===2)for(let I=0;I<name.length;I++)r(e,Le)[(p-1)*E.cmt+I]=r(e,Je)[o*E.cmt+I];else{let I=e.baseBank.get(0,o+(v<<6),127,"mt32").name;for(let R=0;R<I.length;R++)r(e,Le)[(p-1)*E.cmt+R]=I.charCodeAt(R)}e.pushChPrimitives(p)},()=>{r(e,B)[p*E.rpn+3]=o+40,r(e,N)[E.rpnt*p+2]=1},()=>{r(e,B)[p*E.rpn+1]=o+14,r(e,N)[E.rpnt*p+1]=1},()=>{r(e,B)[p*E.rpn]=o,r(e,N)[E.rpnt*p]=1},!1,()=>{e.setChCc(p,91,o?127:0)},!1,()=>{e.setChCc(p,7,o)},()=>{e.setChCc(p,10,Math.ceil(o*9.05))}][C]||(()=>{}))()})}}).add([22,18,4],(t,n,d)=>{e.switchMode("mt32",1);let i=t[1]+(t[0]<<7),c=[];t.subarray(2).forEach((o,h)=>{let b=h+i,p=e.chRedir(Math.floor(b/246+1),n,!0),C=b%246;C<14&&(r(e,Le)[(p-1)*E.cmt+C]=o),C<10&&(r(e,Ce)[p]=1),c.indexOf(p)<0&&c.push(p)}),c.forEach(o=>{e.pushChPrimitives(o)})}).add([22,18,5],(t,n,d)=>{e.switchMode("mt32",1);let i=(t[0]<<7)+t[1];t.subarray(2).forEach((c,o)=>{let h=i+o,b=Math.floor(h/8),p=h&7,C=b*8;r(e,Ot)[h]=c,([!1,()=>{let v=r(e,Ot)[C];if(v<3){let I="";if(v===2){let ae=E.cmt*b;I=`MT-m:${c.toString().padStart(3,"0")}`}else I=e.baseBank.get(0,c+(v<<6),127,"mt32").name;e.userBank.clearRange({msb:0,lsb:127,prg:b});let R=`MSB	LSB	PRG	NME
49	127	${b}	${I}`;e.userBank.load(R,!0)}}][p]||(()=>{}))()}),e.forceVoiceRefresh()}).add([22,18,8],(t,n,d)=>{e.switchMode("mt32",1);let i=((t[0]&1)<<7)+t[1],c=t[0]>>1,o=!1;if(t.subarray(2).forEach((h,b)=>{let p=i+b;p<E.cmt&&(r(e,Je)[c*E.cmt+p]=h,o=!0)}),o){e.userBank.clearRange({msb:0,lsb:127,prg:c});let h=`MSB	LSB	PRG	NME
49	127	${c}	MT-m:${c}`;e.userBank.load(h,!0)}e.forceVoiceRefresh()}).add([22,18,16],(t,n,d)=>{e.switchMode("mt32",1);let i=t[1],c=!1,o=function(h,b){r(e,V)[b-12]=h,c=!0};t.subarray(2).forEach((h,b)=>{let p=b+i;([!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,o,o,o,o,o,o,o,o,o,()=>{M(e,W,h),e.dispatchEvent("mastervolume",r(e,W))}][p]||(()=>{}))(h,b)}),c&&e.buildRchTree()}).add([22,18,32],(t,n,d)=>{e.switchMode("mt32",1);let i=t[1],c=" ".repeat(i);t.subarray(2).forEach(o=>{o>31?c+=String.fromCharCode(o):c+=" "}),M(e,Ze,c.padStart(20," ")),M(e,je,e.clockSource.now()+3200)}).add([22,18,82],(t,n)=>{let d=e.chRedir(0,n,!0);for(let i=0;i<16;i++)r(e,te).ano(d+i),i&&i<10&&(r(e,_)[d+i]=va[i-1]);console.info("MT-32 alt reset complete.")}),r(this,De).add([66,0],(t,n)=>{e.switchMode("ns5r",1),e.setPortMode(e.getTrackPort(n),2,x.ns5r),M(e,K,e.KARAOKE_NONE),console.debug(`NS5R mode switch requested: ${["global","multi","prog edit","comb edit","drum edit","effect edit"][t[0]]} mode.`)}).add([66,1],(t,n)=>{let d=["ns5r","05rw"][t[0]];e.switchMode(d,1),e.setPortMode(e.getTrackPort(n),2,x[d]),M(e,K,e.KARAOKE_NONE)}).add([66,18,0,0],(t,n)=>{let d=t[0];switch(d){case 124:case 126:case 127:{e.switchMode("ns5r",2),e.setPortMode(e.getTrackPort(n),2,x.ns5r),M(e,K,e.KARAOKE_NONE);break}case 125:{e.initDrums(),console.info(`NS5R drum setup reset on drum kit ${t[1]}.`);break}default:if(d<10){let i=[0,0,0,0],c=(o,h)=>{i[h]=o};if(t.subarray(1).forEach((o,h)=>{[c,c,c,c,()=>{M(e,W,o*129/16383*100),e.dispatchEvent("mastervolume",r(e,W))},()=>o-64,()=>o-64,()=>{},()=>{},()=>{}][d+h]()}),t[0]<4){let o=0;i.forEach(h=>{o=o<<4,o+=h}),o-=1024,console.debug(`Master tune: ${o}`)}}}}).add([66,18,0,1],(t,n)=>{}).add([66,18,0,2],(t,n)=>{}).add([66,18,1],(t,n)=>{e.invokeSysExIndicator();let d=e.chRedir(t[0],n,!0),i=G[d],c=t[1],o=`NS5R CH${d+1} `;t.subarray(2).forEach((h,b)=>{let p=c+b;p<3?([()=>{r(e,S)[i+T[0]]=h||Be.bank0,e.pushChPrimitives(d)},()=>{r(e,S)[i+T[32]]=h,e.pushChPrimitives(d)},()=>{r(e,_)[d]=h}][p](),e.pushChPrimitives(d)):p<8||(p<14?[()=>{let C=e.chRedir(h,n,!0),v=r(e,V)[d];r(e,V)[d]=C,(d!==C||C!==v)&&(e.buildRchTree(),console.info(`${o}receives from CH${C+1}`))},()=>{r(e,oe)[d]=+!h},()=>{e.setChType(d,h,x.ns5r),console.debug(`${o}type: ${Wt[h]}`)},()=>{r(e,B)[E.rpn*d+3]=h,r(e,N)[E.rpnt*d+2]=1,e.dispatchEvent("pitch",{part:d,pitch:e.getPitchShift(d)})},()=>{},()=>{}][p-8]():p<16||(p<33?[()=>{r(e,S)[i+T[7]]=h},()=>{r(e,S)[i+T[11]]=h},()=>{},()=>{},()=>{r(e,S)[i+T[10]]=h||128},()=>{},()=>{},()=>{r(e,S)[i+T[93]]=h},()=>{r(e,S)[i+T[91]]=h},()=>{r(e,S)[i+T[76]]=h},()=>{r(e,S)[i+T[77]]=h},()=>{r(e,S)[i+T[78]]=h},()=>{r(e,S)[i+T[74]]=h},()=>{r(e,S)[i+T[71]]=h},()=>{r(e,S)[i+T[73]]=h},()=>{r(e,S)[i+T[75]]=h},()=>{r(e,S)[i+T[72]]=h}][p-16]():p<112||p<114&&[()=>{r(e,S)[i+T[5]]=h},()=>{r(e,S)[i+T[65]]=h}][p-112]()))})}).add([66,18,8,0],(t,n)=>{let d=t[0];if(d<32)e.setLetterDisplay(t.subarray(1,33),"NS5R letter display");else{let i=d-32;M(e,Ae,e.clockSource.now()+3200),M(e,ne,10);let c=t.subarray(1),o=4;c.forEach(function(h,b){let p=b+i,C=p>>4,v=p&15;if(p<80){let I=C<o?h:h>>3,R=0,ae=C<o?6:3;for(;I>0;)r(e,Fe,Lt)[v*32+C*7+(ae-R)]=I&1,I=I>>1,R++}})}}).add([66,18,48],(t,n,d)=>{u(0,t)}).add([66,18,49],(t,n,d)=>{u(1,t)}).add([66,18,50],(t,n,d)=>{u(2,t)}).add([66,18,51],(t,n,d)=>{u(3,t)}).add([66,18,52],(t,n,d)=>{u(4,t)}).add([66,18,53],(t,n,d)=>{u(5,t)}).add([66,18,54],(t,n,d)=>{u(6,t)}).add([66,18,55],(t,n,d)=>{u(7,t)}).add([66,52],(t,n)=>{e.switchMode("ns5r",1),M(e,K,e.KARAOKE_NONE);let d="";Te(t,(i,c)=>{c<8?(i>31&&(d+=String.fromCharCode(i)),c===7&&(e.aiEfxName=d)):c<10&&(e.setEffectType(c-8,44,i),e.pushEffectType(c-8))})}).add([66,53],(t,n)=>{e.invokeSysExIndicator(),e.switchMode("ns5r",1),M(e,K,e.KARAOKE_NONE);let d="",i=t[t.length-1],c=t.subarray(0,t.length-1),o=dt(c);o!==i&&(console.info(`NS5R current multi dump checksum mismatch! Expected ${o}, got ${i}.`),console.debug(t));let h=e.getTrackPort(n);if(r(e,Q)[h]&&r(e,Q)[h]!==x.ns5r)if(r(e,Ne).dumpLimit===e.DUMP_MODE){console.warn(`Dump cancelled for track ${n}. Port ${String.fromCharCode(65+h)} mode "${q[r(e,Q)[h]]}" mismatch, should be "ns5r".`);return}else console.info(`Track ${n} is trying to perform a mismached mode dump on port ${String.fromCharCode(65+h)}.`);e.setPortMode(h,2,x.ns5r),Te(c,function(b,p){switch(!0){case p<2944:{let C=e.chRedir(Math.floor(p/92),n,!0),v=G[C];switch(p%92){case 0:{r(e,S)[v+T[0]]=b,e.pushChPrimitives(C),e.pushChPrimitives(C);break}case 1:{r(e,S)[v+T[32]]=b,!b&&!r(e,S)[v+T[0]]&&(r(e,S)[v+T[0]]=Be.bank0),e.pushChPrimitives(C);break}case 2:{r(e,_)[C]=b,b>0&&e.setChActive(C,1);break}case 3:{let I=e.chRedir(b,n,!0);r(e,V)[C]=I,C!==I&&console.info(`NS5R CH${C+1} receives from CH${I+1}.`);break}case 7:{r(e,L)[C]=b,e.pushChPrimitives(C);break}case 8:{r(e,B)[C*E.rpn+3]=b<40||b>88?b+(b>63?-192:64):b,r(e,N)[E.rpnt*C+2]=1,e.dispatchEvent("pitch",{part:C,pitch:e.getPitchShift(C)});break}case 9:case 10:{r(e,S)[v+T[7]]=b;break}case 11:{r(e,S)[v+T[11]]=b;break}case 14:{r(e,S)[v+T[10]]=b||128;break}case 19:{r(e,S)[v+T[93]]=b;break}case 20:{r(e,S)[v+T[91]]=b;break}case 84:{r(e,S)[v+T[65]]=b;break}case 85:{r(e,S)[v+T[5]]=b;break}}break}case p<3096:break;case p<3134:{let C=p-3096;C<8?(b>31&&(d+=String.fromCharCode(b)),C===7&&(e.aiEfxName=d)):C<10&&(e.setEffectType(C-8,44,b),e.pushEffectType(C-8));break}case p<8566:break}}),e.buildRchTree()}).add([66,54],(t,n)=>{e.invokeSysExIndicator(),e.switchMode("ns5r",1);let d="",i=80,c=0,o=0,h="MSB	PRG	LSB	NME";Te(t,function(b,p){let C=p%158;switch(!0){case C<10:{b>31&&(d+=String.fromCharCode(b));break}case C===10:break;case C===11:{i=b&127;break}case C===12:{o=b&127;break}case C===13:{h+=`
${i}	${c}	${o}	${d.trim().replace("Init Voice","")}`,c++,d="";break}}}),e.userBank.clearRange({msb:80,lsb:0}),e.userBank.load(h),D()&&console.debug(h),e.forceVoiceRefresh()}).add([66,55],(t,n)=>{e.invokeSysExIndicator(),e.switchMode("ns5r",1);let d="",i=88,c=0,o=0,h="MSB	PRG	LSB	NME";Te(t,function(b,p){let C=p%126;switch(!0){case C<10:{b>31&&(d+=String.fromCharCode(b));break}case C===11:break;case C===12:break;case C===13:{h+=`
${i}	${c}	${o}	${d.trim().replace("Init Combi","")}`,c++,d="";break}}}),e.userBank.clearRange({msb:88,lsb:0}),e.userBank.load(h),D()&&console.debug(h),e.forceVoiceRefresh()}).add([66,125],(t,n,d)=>{e.dispatchEvent("backlight",["green","orange","red",!1,"yellow","blue","purple"][t[0]]||"white")}).add([66,127],(t,n,d)=>{let i=t[t.length-1],c=t.subarray(0,t.length-1),o=dt(c);o!==i&&(console.info(`NS5R screen dump checksum mismatch! Expected ${o}, got ${i}.`),console.debug(t));let h=new Uint8Array(5760);Te(t,(b,p,C)=>{if(p<720)for(let v=0;v<8;v++)h[p*8+v]=b>>7-v&1}),e.dispatchEvent("screen",{type:"ns5r",data:h})}).add([76],(t,n,d)=>{r(e,De).run([66,...t],n,d)}),r(e,kt).add([16,0,8,0],(t,n,d)=>{let i=(t[2]<<4)+t[3],c="K11 ";([()=>{e.switchMode("k11",2),e.setPortMode(e.getTrackPort(n),2,x.k11),M(e,K,e.KARAOKE_NONE),r(e,j)[x.k11][1]=i?4:0,console.info("MIDI reset: GMega/K11")},()=>{e.setEffectType(0,24,i),console.debug(`${c}reverb type: ${i}`),e.pushEffectType(0)},()=>{console.debug(`${c}reverb time: ${i}`)},()=>{console.debug(`${c}reverb time: ${i}`)},()=>{console.debug(`${c}reverb predelay: ${i}`)},()=>{console.debug(`${c}reverb predelay: ${i}`)},()=>{console.debug(`${c}depth high: ${i}`)},()=>{console.debug(`${c}depth high: ${i}`)},()=>{console.debug(`${c}depth low: ${i}`)},()=>{console.debug(`${c}depth low: ${i}`)}][t[0]]||(()=>{}))()}).add([16,0,8,1],(t,n,d)=>{e.invokeSysExIndicator();let i=e.chRedir(t[1],n,!0),c=G[i],o=Rt[i],h=(t[3]<<4)+t[4],b=`GMega CH${i+1} `;([()=>{h<128?(e.setChType(i,e.CH_MELODIC,x.k11),r(e,S)[c+T[0]]=0,r(e,_)[i]=h):(e.setChType(i,e.CH_DRUMS,x.k11),r(e,_)[i]=h-128),e.pushChPrimitives(i)},()=>{let p=e.chRedir(h,n,!0),C=r(e,V)[i];r(e,V)[i]=p,(i!==p||p!==C)&&(e.buildRchTree(),console.info(`${b}receives from CH${p+1}`))},()=>{r(e,S)[c+T[7]]=h},()=>{uupThis.setChActive(i,h)},()=>{r(e,S)[c+T[10]]=h},()=>{r(e,B)[o+3]=h+40,r(e,N)[E.rpnt*i+2]=1,e.dispatchEvent("pitch",{part:i,pitch:e.getPitchShift(i)})},()=>{r(e,B)[o+1]=h>>1,r(e,B)[o+2]=h&1,r(e,N)[E.rpnt*i+1]=1,e.dispatchEvent("pitch",{part:i,pitch:e.getPitchShift(i)})},()=>{r(e,S)[c+T[91]]=h?127:0},()=>{},()=>{r(e,S)[c+T[74]]=h},()=>{r(e,S)[c+T[73]]=h},()=>{r(e,S)[c+T[72]]=h}][t[0]]||(()=>{}))()}).add([16,0,9,0],(t,n,d)=>{e.invokeSysExIndicator();let i=(t[2]<<4)+t[3],c="GMLX ";([()=>{console.debug(`${c}reverb type: ${i}`)},()=>{console.debug(`${c}reverb time: ${i}`)},()=>{console.debug(`${c}reverb predelay: ${i}`)},()=>{console.debug(`${c}depth high: ${i}`)},()=>{console.debug(`${c}depth low: ${i}`)}][t[0]]||(()=>{}))()}).add([16,0,9,3],(t,n,d)=>{e.invokeSysExIndicator();let i=(t[2]<<4)+t[3],c=e.chRedir(t[1],n,!0),o=G[c],h=`GMLX CH${c+1} `;[()=>{i<128?(e.setChType(c,e.CH_MELODIC,x.k11),r(e,S)[o+T[0]]=0,r(e,S)[o+T[32]]=0,r(e,_)[c]=i):i<160?(e.setChType(c,e.CH_MELODIC,x.k11),r(e,S)[o+T[0]]=0,r(e,S)[o+T[32]]=7,r(e,_)[c]=i-100):(e.setChType(c,e.CH_DRUMS,x.k11),r(e,S)[o+T[0]]=122,r(e,S)[o+T[32]]=0,r(e,_)[c]=i-160),e.pushChPrimitives(c)},()=>{let b=e.chRedir(i,n,!0),p=r(e,V)[c];r(e,V)[c]=b,(c!==b||b!==p)&&(e.buildRchTree(),console.info(`${h}receives from CH${b+1}`))}][t[0]]()}).add([16,0,9,4],(t,n,d)=>{e.invokeSysExIndicator();let i=(t[2]<<4)+t[3],c=e.chRedir(t[1],n,!0),o=G[c],h=Rt[c];[()=>{e.setChActive(c,i)},()=>{r(e,S)[o+T[7]]=i},()=>{r(e,S)[o+T[10]]=i},()=>{r(e,S)[o+T[91]]=i?127:0},()=>{r(e,B)[h+3]=i+40,r(e,N)[E.rpnt*c+2]=1,e.dispatchEvent("pitch",{part:c,pitch:e.getPitchShift(c)})},()=>{r(e,B)[h+1]=i,r(e,N)[E.rpnt*c+1]=1,e.dispatchEvent("pitch",{part:c,pitch:e.getPitchShift(c)})},()=>{r(e,B)[h]=i,r(e,N)[E.rpnt*c]=1,e.dispatchEvent("pitch",{part:c,pitch:e.getPitchShift(c)})},()=>{}][t[0]]()}),r(this,vt).add([66,93,64],(t,n,d)=>{let i=t[2];switch(t[0]){case 0:{switch(t[1]){case 4:{e.invokeSysExIndicator(),M(e,W,i*129/16383*100),e.dispatchEvent("mastervolume",r(e,W));break}case 5:{e.invokeSysExIndicator(),i-64;break}case 6:{e.invokeSysExIndicator(),console.debug(`SG global reverb: ${i?"on":"off"}`);break}case 127:{e.switchMode("sg",2),e.setPortMode(e.getTrackPort(n),1,x.sg);break}}break}case 1:{switch(t[1]){case 48:{e.invokeSysExIndicator(),console.debug(`SG reverb type: ${Ca[i]}`);break}}break}default:if(t[0]>>4===1){e.invokeSysExIndicator();let c=e.chRedir(t[0]&15,n,!0);if(t[1]===2){let o=e.chRedir(i,n,!0),h=r(e,V)[c];r(e,V)[c]=o,(c!==o||o!==h)&&(e.buildRchTree(),console.info(`SG CH${c+1} receives from CH${o+1}`))}else t[1]===19&&e.setChCc(c,7,i)}else console.warn(`Unknown AKAI SG SysEx: ${t}`)}}),r(this,$t).add([9],(t,n,d)=>{e.invokeSysExIndicator(),console.debug(`GZ set effect: ${["stage reverb","hall reverb","room reverb","chorus","tremolo","phaser","rotary speaker","enhancer","flanger","EQ"][t[0]]||"off"}`)}),r(this,re).add([127,0],(t,n,d)=>{e.switchMode("motif",1);let i=new Uint8Array([127,1,...t]);r(e,re).run(i,n,d)}).add([127,1,0,0],(t,n,d)=>{e.switchMode("s90es");let i="S90/Motif ES system ",c=t[0];t.subarray(1).forEach((o,h)=>{([()=>{M(e,W,o*12900/16383),e.dispatchEvent("mastervolume",r(e,W))}][c+h]||(()=>{console.info(`Unrecognized ${i}ID: ${c+h}`)}))()})}).add([127,1,14],(t,n,d)=>{e.switchMode("s90es");let i="S90/Motif ES bulk header ",c=[];c[95]=(o,h,b)=>{console.debug(`${i}multi edit buffer: ${o[1]}`)},(c[t[0]]||(()=>{console.info(`Unrecognized ${i}ID: ${t[0]}.`)}))(t.subarray(1))}).add([127,1,15],(t,n,d)=>{e.switchMode("s90es");let i="S90/Motif ES bulk footer ",c=[];c[95]=(o,h,b)=>{console.debug(`${i}multi edit buffer: ${o[1]}`)},(c[t[0]]||(()=>{console.info(`Unrecognized ${i}ID: ${t[0]}.`)}))(t.subarray(1))}).add([127,1,54,1],(t,n,d)=>{e.switchMode("s90es");let i="S90/Motif ES reverb ",c=t[0];t.subarray(1).forEach((o,h)=>{([()=>{e.setEffectTypeRaw(0,!1,o&15|128)},()=>{e.setEffectTypeRaw(0,!0,o)}][c+h]||(()=>{}))()}),e.pushEffectType(0)}).add([127,1,54,2],(t,n,d)=>{e.switchMode("s90es");let i="S90/Motif ES chorus ",c=t[0];t.subarray(1).forEach((o,h)=>{([()=>{e.setEffectTypeRaw(1,!1,o&15|128)},()=>{e.setEffectTypeRaw(1,!0,o)}][c+h]||(()=>{}))()}),e.pushEffectType(1)}).add([127,1,54,3],(t,n,d)=>{e.switchMode("s90es");let i="S90/Motif ES insert 1 ",c=t[0];t.subarray(1).forEach((o,h)=>{([()=>{e.setEffectTypeRaw(3,!1,o&15|128)},()=>{e.setEffectTypeRaw(3,!0,o)}][c+h]||(()=>{}))()}),e.pushEffectType(3)}).add([127,1,54,4],(t,n,d)=>{e.switchMode("s90es");let i="S90/Motif ES insert 2 ",c=t[0];t.subarray(1).forEach((o,h)=>{([()=>{e.setEffectTypeRaw(4,!1,o&15|128)},()=>{e.setEffectTypeRaw(4,!0,o)}][c+h]||(()=>{}))()}),e.pushEffectType(4)}).add([127,1,54,16],(t,n,d)=>{e.switchMode("s90es");let i=t[0];t.subarray(1).forEach((c,o)=>{let b=`S90/Motif ES EQ${(o>>2)+1} `;([()=>{let p=c-64},()=>{let p=At[c]},()=>{let p=c/10},()=>{let p=c}][i+o&3]||(()=>{}))()})}).add([127,1,54,17],(t,n,d)=>{e.switchMode("s90es");let i="S90/Motif ES variation ",c=t[0];t.subarray(1).forEach((o,h)=>{([()=>{e.setEffectTypeRaw(2,!1,o&15|128)},()=>{e.setEffectTypeRaw(2,!0,o)}][c+h]||(()=>{}))()}),e.pushEffectType(2)}).add([127,1,55],(t,n,d)=>{e.invokeSysExIndicator(),e.switchMode("s90es");let i=e.getTrackPort(n);if(r(e,Q)[i]&&r(e,Q)[i]!==r(e,U).smotif)if(r(e,Ne).dumpLimit===e.DUMP_MODE){console.warn(`Dump cancelled for track ${n}. Port ${String.fromCharCode(65+i)} mode "${q[r(e,Q)[i]]}" mismatch, should be "${q[r(e,U).smotif]}".`);return}else console.info(`Track ${n} is trying to perform a mismached mode dump on port ${String.fromCharCode(65+i)}.`);let c=e.chRedir(t[0],n,!0),o=G[c],h=t[1];t[0]>15&&(c=t[0]+32);let b=`Track ${n} S90/Motif ES bulk CH${c<128?c+1:"U"+(c-127)} `;console.debug(b,t),!(t[0]>15)&&t.subarray(2).forEach((p,C)=>{([()=>{e.setChCc(c,0,p),e.pushChPrimitives(c)},()=>{p&&e.setChActive(c,1),e.setChCc(c,32,p),e.getChPrimitive(c,1)===63&&e.setChType(c,[32,40].indexOf(p)>-1?e.CH_DRUMS:e.CH_MELODIC,r(e,H),!0),e.pushChPrimitives(c)},()=>{p&&e.setChActive(c,1),r(e,_)[c]=p,e.pushChPrimitives(c)},()=>{let v=e.chRedir(p,n,!0),I=r(e,V)[c];r(e,V)[c]=v,(c!==v||v!==I)&&(e.buildRchTree(),console.info(`${b}receives from CH${v+1}`))},()=>{r(e,oe)[c]=p?0:1},!1,!1,!1,!1,!1,!1,!1,!1,()=>{p!==100&&e.setChActive(c,1),r(e,S)[o+T[7]]=p},()=>{p!==64&&e.setChActive(c,1),r(e,S)[o+T[10]]=p},!1,!1,!1,()=>{r(e,S)[o+T[91]]=p},()=>{p&&e.setChActive(c,1),r(e,S)[o+T[93]]=p},()=>{p&&e.setChActive(c,1),r(e,S)[o+T[94]]=p},()=>{e.setChCc(c,128,p),p!==127&&(e.setChActive(c,1),e.allocateAce(c,128))},()=>{},()=>{p!==64&&e.setChActive(c,1),r(e,S)[o+T[74]]=p},()=>{p!==64&&e.setChActive(c,1),r(e,S)[o+T[71]]=p},!1,()=>{r(e,S)[o+T[65]]=p},()=>{r(e,S)[o+T[5]]=p},()=>{}][h+C]||(()=>{}))()})}),r(e,re).add([100,14],(t,n,d)=>{var c;e.switchMode("cs6x"),e.setPortMode(e.getTrackPort(n),1,x.cs6x);let i=(c=["normal voice","plugin voice PLG","drums",,"performance",,"phrase clip"][t[0]>>4])!=null?c:"invalid";t[0]&!0?i+=" edit buffer":t[0]>>4==1?i+=`${(t[0]&1)+1}`:i+=` ${["INT","EXT"][t[0]&1]}`,console.debug(`CS6x bulk dump for ${i} started.`)}).add([100,15],(t,n,d)=>{var c;e.switchMode("cs6x");let i=(c=["normal voice","plugin voice PLG","drums",,"performance",,"phrase clip"][t[0]>>4])!=null?c:"invalid";t[0]&!0?i+=" edit buffer":t[0]>>4==1?i+=`${(t[0]&1)+1}`:i+=` ${["INT","EXT"][t[0]&1]}`,console.debug(`CS6x bulk dump for ${i} ended.`)}).add([100,76,112],(t,n,d)=>{e.switchMode("cs6x");let i=0,c=t[0];t.subarray(1).forEach((o,h)=>{let b=h+c;b<10?(e.setChCvnRegister(i,h,o&127),r(e,Ce)[i]=1):b<12||b<13&&console.debug(`Plugin voice type: ${o}`)}),e.pushChPrimitives(i)}).add([100,76,0],(t,n,d)=>{e.switchMode("cs6x"),e.setPortMode(e.getTrackPort(n),1,x.cs6x);let i=0,c=t[0];t.subarray(1).forEach((o,h)=>{let b=h+c;([()=>{e.setChCc(i,7,o),o!==100&&e.setChActive(i,1)},,,()=>{r(e,oe)[i]=o==0,e.setChCc(i,64,0),r(e,te).ano(i),e.resetChAceAll(i)},,()=>{},,,()=>{e.setChCc(i,65,o?127:0)},()=>{e.setChCc(i,5,o)},,()=>{e.setChCc(i,91,o),o!==40&&e.setChActive(i,1)},()=>{e.setChCc(i,93,o),o&&e.setChActive(i,1)}][b]||(()=>{}))()})}).add([100,76,1],(t,n,d)=>{e.switchMode("cs6x");let i=0,c=t[0],o=!1;t.subarray(1).forEach((h,b)=>{let p=b+c;([()=>{e.setEffectTypeRaw(0,!1,h&15|128),o=!0},()=>{e.setEffectTypeRaw(0,!0,h),o=!0}][p]||(()=>{}))()}),o&&e.pushEffectType(0)}).add([100,76,2],(t,n,d)=>{e.switchMode("cs6x");let i=0,c=t[0],o=!1;t.subarray(1).forEach((h,b)=>{let p=b+c;([()=>{e.setEffectTypeRaw(1,!1,h&15|128),o=!0},()=>{e.setEffectTypeRaw(1,!0,h),o=!0}][p]||(()=>{}))()}),o&&e.pushEffectType(1)}).add([100,76,3],(t,n,d)=>{e.switchMode("cs6x");let i=0,c=t[0],o=!1;t.subarray(1).forEach((h,b)=>{let p=b+c;([()=>{e.setEffectTypeRaw(2,!1,h&15|128),o=!0},()=>{e.setEffectTypeRaw(2,!0,h),o=!0}][p]||(()=>{}))()}),o&&e.pushEffectType(2)}).add([100,76,5],(t,n,d)=>{e.switchMode("cs6x")}).add([100,76,16],(t,n,d)=>{e.switchMode("cs6x");let i=0,c=t[0],o=!1;if(t.subarray(1).forEach((h,b)=>{let p=b+c;([()=>{e.setChCc(i,0,h),o=!0},()=>{e.setChCc(i,32,h),o=!0,h&&e.setChActive(i,1)},()=>{r(e,_)[i]=h,o=!0,h&&e.setChActive(i,1)},()=>{r(e,N)[Rt[i]+ha[2]]=1,r(e,B)[Rt[i]+ha[2]]=h,h&&e.setChActive(i,1)}][p]||(()=>{}))()}),o){switch(e.pushChPrimitives(i),e.getChVoice(i).standard){case"DX":{r(e,ce)[i]=e.EXT_DX;break}case"VL":{r(e,ce)[i]=e.EXT_VL;break}}e.dispatchEvent("metacommit",{type:"OSysMeta",msg:"part.rename",data:{part:i}})}}).add([100,76,32],(t,n,d)=>{e.switchMode("cs6x");let i=0,c=t[0],o=r(e,ce)[i];switch(o){case e.EXT_DX:{t.length>2&&console.debug(t),t.subarray(1).forEach((h,b)=>{let p=b+c;if(p<6){let C=p+142;e.setChCc(i,C,h),h!==64&&e.allocateAce(i,C)}else if(p<12){let C=p+144;e.setChCc(i,C,h),h!==64&&e.allocateAce(i,C)}else([()=>{},()=>{},()=>{},()=>{}][p]||(()=>{}))()});break}case e.EXT_VL:{console.info(`Support for Modular System Plug-in writes is not yet present for plugin type ${o}.`);break}default:console.warn(`Unsupported plug-in type: ${o}`)}}),r(this,ve).add([0,72,18,0,0,0,0],(t,n,d)=>{e.switchMode("sd",2),e.setPortMode(e.getTrackPort(n),2,x.sd),console.info("MIDI reset: SD")}).add([0,72,18,16,0],(t,n,d)=>{e.invokeSysExIndicator();let i=t[0]>>5,c=t[0]&31;switch(i){case 0:{let o=t[0]>>1,h=t[1];switch(o){case 1:{t.subarray(2).forEach((b,p,C)=>{let v=p+h;switch(v){case 0:{b&&(e.setEffectType(1,60,b-1),e.pushEffectType(1),console.debug(`SD MFX Cho: ${v} - ${b}`));break}}});break}case 2:{t.subarray(2).forEach((b,p)=>{let C=p+h;switch(C){case 0:{b&&(e.setEffectType(0,55+b,0),e.pushEffectType(0),console.debug(`SD MFX Rev: ${C} - ${b}`));break}}});break}case 3:case 4:case 5:{let b=o-1;t.subarray(2).forEach((p,C)=>{let v=C+h;switch(console.debug(`SD MFX ${b-2}: ${v} - ${p}`),v){case 0:{e.setEffectTypeRaw(b,62,p),e.pushEffectType(b);break}}}),console.debug(`SD MFX message:
%o`,t);break}default:console.debug(`Unknown SD-90 global effects message:
%o`,t)}break}case 1:{let o=e.chRedir(c,n,!0),h=t[1],b=G[o];t.subarray(2).forEach((p,C)=>{let v=h+C;v<37?([()=>{},()=>{},0,()=>{},()=>{switch(p){case 104:case 105:case 106:case 107:case 120:case 128:{r(e,L)[o]||e.setChType(o,e.CH_DRUMS);break}default:r(e,L)[o]&&e.setChType(o,e.CH_MELODIC)}e.setChCc(o,0,p),e.pushChPrimitives(o)},()=>{e.setChCc(o,32,p),e.pushChPrimitives(o)},()=>{r(e,_)[o]=p},()=>{r(e,S)[b+T[7]]=p},()=>{r(e,S)[b+T[10]]=p},()=>{},()=>{},()=>{p<2&&(r(e,oe)[o]=p)},()=>{p<2&&(r(e,S)[b+T[68]]=p?127:0)},()=>{},()=>{p<2&&(r(e,S)[b+T[65]]=p?127:0)},()=>{r(e,S)[b+T[5]]=p&15<<4|r(e,S)[b+T[5]]&15},()=>{r(e,S)[b+T[5]]=p&15|(r(e,S)[b+T[5]]&240)>>4},()=>{r(e,S)[b+T[74]]=p},()=>{r(e,S)[b+T[71]]=p},()=>{r(e,S)[b+T[73]]=p},()=>{r(e,S)[b+T[72]]=p},0,0,0,0,0,0,0,()=>{r(e,S)[b+T[128]]=p,e.allocateAce(128)},()=>{r(e,S)[b+T[93]]=p},()=>{r(e,S)[b+T[91]]=p},0,0,()=>{r(e,S)[b+T[75]]=p},()=>{r(e,S)[b+T[76]]=p},()=>{r(e,S)[b+T[77]]=p},()=>{r(e,S)[b+T[78]]=p}][v]||(()=>{}))():v<63||(v<64?(r(e,L)[o]?(e.setChCc(o,0,104|p),e.pushChPrimitives(o)):(e.setChCc(o,0,96|p),e.pushChPrimitives(o)),e.pushChPrimitives(o)):console.debug(`Unknown SD-90 global CH${o+1} param setup message:
%o`,t))});break}case 2:{let o=e.chRedir(c,n,!0),h=t[1];console.debug(`Unknown SD-90 global CH${o+1} MIDI setup message:
%o`,t.subarray(2));break}default:console.warn(`Unknown SD-90 global part setup message:
%o`,t)}}),r(e,De).add([0,1,73,78],(t,n,d)=>{e.switchMode("krs",1),e.setPortMode(e.getTrackPort(n),1,x.krs),console.debug("Might be KORG KROSS 2 mode reset... Not sure.")}).add([0,1,73,117,2,37],(t,n,d)=>{e.switchMode("krs",1);let i=e.getTrackPort(n);if(r(e,Q)[i]&&r(e,Q)[i]!==x.krs)if(r(e,Ne).dumpLimit===e.DUMP_MODE){console.warn(`Dump cancelled. Port ${String.fromCharCode(65+i)} mode "${q[r(e,Q)[i]]}" mismatch, should be "krs".`);return}else console.info(`Track ${n} is trying to perform a mismached mode dump on port ${String.fromCharCode(65+i)}.`);e.setPortMode(e.getTrackPort(n),1,x.krs);let c="KROSS 2 BMT1 ",o="";Te(t,(h,b)=>{if(b<24)o+=String.fromCharCode(Math.max(32,h));else if(!(b<88)){if(b<468){let p=b-88,C=p*863>>16,v=p-C*76;([()=>{e.setEffectType(C+3,45,h),e.pushEffectType(C+3)},!1,()=>{console.debug(`${c}IFX${C+1} sends to ${h<=5&&h>0?`IFX${h}`:"direct out"}.`)}][v]||(()=>{}))()}else if(b<604){let p=b-468,C=p*964>>16,v=p-C*68;([()=>{e.setEffectType(1-C,45,h),e.dispatchEvent(["efxreverb","efxchorus"][1-C],{id:e.getEffectType(1-C)})},!1][v]||(()=>{}))()}else if(!(b<1276)){let p=b-1276,C=p*1490>>16,v=e.chRedir(C,n,!0),I=p-C*44;I<22?([()=>{h&&e.setChActive(v,1),r(e,_)[v]=h,e.pushChPrimitives(v)},()=>{h&&e.setChActive(v,1),h<10?(e.setChCc(v,0,63),e.setChCc(v,32,h)):h<20?(e.setChCc(v,0,121),e.setChCc(v,32,h-10)):h<24&&(e.setChCc(v,0,[120,0,56,62][h-20]),e.setChCc(v,32,0)),e.pushChPrimitives(v)},()=>{let R=e.chRedir(h&15,n,!0);r(e,V)[v]=R,R!==v&&console.info(`${c}CH${v+1} receives from CH${R+1}`);let ae=h>>5&1;e.modelEx.kross.chToggle&&(e.setChActive(v,ae),ae||console.debug(`KORG KROSS 2 CH${v+1} is disabled.`))},!1,!1,()=>{e.setChCc(v,7,h)},!1,()=>{},()=>{},!1,!1,!1,!1,!1,()=>{e.setChCc(v,10,h||128)}][I]||(()=>{}))():I<36?([()=>{let R=h&7;h&8&&(R=1),R>1&&console.debug(`${c}CH${v+1} sends to ${R>1?`IFX${R-1}`:"direct out"} (${h.toString(16)}).`),e.setChEffectSink(v,h>1&&h<7?h+1:0)}][I-22]||(()=>{}))():([()=>{e.setChCc(v,74,(h+128&255)-64)},()=>{e.setChCc(v,71,(h+128&255)-64)},!1,!1,()=>{e.setChCc(v,73,(h+128&255)-64)},()=>{e.setChCc(v,75,(h+128&255)-64)},!1,()=>{e.setChCc(v,72,(h+128&255)-64)}][I-36]||(()=>{}))()}}}),o=o.trimEnd(),e.dispatchEvent("metacommit",{type:"EORTitle",data:o})});let $=function(t,n,d){let i=e.chRedir(t,n,!0);e.setChMode(i,x.an1x),e.pushChPrimitives(i),console.debug(`Yamaha AN1x slot ${d+1} receives from CH${i+1}(${t+1}).`),e.modelEx.yPlg[3][d]=i};r(e,re).add([92,0,0],(t,n,d)=>{let i=t[0];t.subarray(1).forEach((c,o)=>{let h=o+i;h<2||([!1,!1,!1,!1,!1,!1,()=>{$(c,n,0)},()=>{$(c,n,1)}][h-2]||(()=>{}))()})}),r(e,re).add([75,80,0],(t,n,d)=>{let i=t[0];t.subarray(1).forEach((c,o)=>{let h=o+i;([()=>{e.modelEx.cs1x.perfCh=c,e.pushChPrimitives(c),console.debug(`Yamaha CS1x performance on CH${c+1}.`)},!1,!1,!1,()=>{},!1,()=>{switch(c){case 1:{e.switchMode("xg",2),e.setPortMode(e.getTrackPort(n),1,x.xg),console.debug("Yamaha CS1x set to XG mode.");break}case 3:{e.switchMode("cs1x",2),e.setPortMode(e.getTrackPort(n),1,x.cs1x),console.debug("Yamaha CS1x set to performance mode.");break}default:console.warn(`Unknown Yamaha CS1x mode: ${c}`)}},()=>{}][h]||(()=>{}))()})}).add([75,96,0],(t,n,d)=>{let i=t[0],c=!1,o=e.modelEx.cs1x.perfCh;t.subarray(1).forEach((h,b)=>{let p=b+i;p<8?(c=!0,r(e,Ce)[o]=1,e.setChCvnRegister(o,p,h)):p<48?([!1,()=>{e.setChCc(o,7,h)}][p]||(()=>{}))():p<80?([()=>{e.setEffectTypeRaw(0,!1,h)},()=>{e.setEffectTypeRaw(0,!0,h),e.pushEffectType(0)},()=>{e.setEffectTypeRaw(1,!1,h)},()=>{e.setEffectTypeRaw(1,!0,h),e.pushEffectType(1)},()=>{e.setEffectTypeRaw(2,!1,h)},()=>{e.setEffectTypeRaw(2,!0,h),e.pushEffectType(2)}][p-48]||(()=>{}))():D()&&console.debug(`Unknown CS1x effect register: ${p}.`)}),c&&(e.setChActive(o,1),e.pushChPrimitives(o))});let k=(t,n,d)=>{let i=0;d.forEach((c,o)=>{([()=>{i=(c&1)<<7|i&127,e.setEffectTypeRaw(t,!1,28),e.setEffectTypeRaw(t,!0,i)},()=>{i=i&128|c&127,e.setEffectTypeRaw(t,!1,28),e.setEffectTypeRaw(t,!0,i),e.pushEffectType(t)}][o+n]||(()=>{}))()})};r(e,De).add([96,0,1],(t,n,d)=>{let i=t[0];switch(t[1]){case 0:{k(0,t[2],t.subarray(3)),console.debug(`Partially parsed KORG PA EFX SysEX:
`,t);break}case 1:{k(1,t[2],t.subarray(3)),console.debug(`Partially parsed KORG PA EFX SysEX:
`,t);break}case 2:{k(2,t[2],t.subarray(3)),console.debug(`Partially parsed KORG PA EFX SysEX:
`,t);break}case 3:{k(3,t[2],t.subarray(3)),console.debug(`Partially parsed KORG PA EFX SysEX:
`,t);break}default:console.debug(`Unparsed KORG PA SysEX:
`,t)}})}get lcdContrast(){return r(this,jt)}set lcdContrast(e){(e<0||e>=da.length)&&(e=da.length-1),M(this,jt,e),this.dispatchEvent("lcdcontrast",e)}get detect(){return structuredClone(r(this,U))}chRedir(e,a,s){let l=this;if(r(l,et)[a])return(r(l,et)[a]-1)*16+e;if(r(l,H)===x.sc||r(l,H)===x.sd){if(s===1)return e;for(let y=0;y<E.ch;y++)if(r(l,He)[y]===a)return y&112|e&15;let u=0,m=!0;for(;m;)r(l,He)[e+u]===0?(r(l,He)[e+u]=a,console.info(`Allocated track ${a} to channel ${e+u+1}.`),m=!1):r(this,He)[e+u]===a?m=!1:(u+=16,u>=128&&(u=0,m=!1));return e+u}else return e}getTrackPort(e){return this.chRedir(0,e,!0)>>4}forceVoiceRefresh(){for(let e=0;e<E.ch;e++)r(this,me)[e]&&this.dispatchEvent("voice",{part:e})}buildRchTree(){let e=[];r(this,V).forEach((a,s)=>{var l;a<E.ch&&((l=e[a])!=null&&l.constructor||(e[a]=[]),e[a].push(s))}),M(this,aa,e)}buildRccMap(){let e=this;for(let a=0;a<E.ch;a++)r(e,yt)[a]={};r(e,pt).forEach((a,s)=>{a&&(r(e,yt)[Math.floor(s/E.redir)][a]=s%E.redir|128)}),D()&&console.debug(r(e,yt))}invokeSysExIndicator(){this.dispatchEvent("mupromptex",r(this,Ht))}getActive(){return r(this,me)}getChActive(e){return r(this,me)[e]}getCc(e){if(typeof e!="number"||e<0||e>=E.ch)throw new RangeError(`Invalid part number: CH${e+1}`);let a=this,s=G[e];return r(a,S).subarray(s,s+E.cc)}getChCc(e,a){let s=this;if(ht.indexOf(a)<0)throw new Error("CC number not accepted");return r(s,S)[G[e]+T[a]]}getChCcWritten(e,a){let s=this;if(ht.indexOf(a)<0)throw new Error("CC number not accepted");return r(s,S)[E.chcc+G[e]+T[a]]}setChCc(e=0,a,s){let l=this;if(ht.indexOf(a)<0)throw new Error("CC number not accepted");if((s==null?void 0:s.constructor)!==Number)throw new TypeError("Expected numbers for value");let u=s&255,m=G[e]+T[a];r(l,S)[m]=u,r(l,S)[m+E.chcc]=1,l.dispatchEvent("cc",{part:e,cc:a,data:u})}getCcAll(){return r(this,S).slice()}resetCc(e){let a=this,s=G[e]+E.chcc;r(a,S).fill(0,s,s+E.cc)}resetChCc(e,a,s){let l=this;s!=null&&s.constructor&&l.setChCc(e,a,s),r(l,S)[G[e]+T[a]+E.chcc]=0}resetCcAll(){r(this,S).fill(0,E.chcc,E.chcc<<1)}isChCcWritten(e,a){if(ht.indexOf(a)<0)throw new Error("CC number not accepted");return r(upThis,S)[G[e]+T[a]+E.chcc]}getChSource(){return r(this,V)}getChType(e=0){return r(this,L)[e]}getChTypes(){return r(this,L)}setChType(e,a,s=0,l=!1){a&=15;let u=this;s=s||u.getChModeId(e),r(u,L)[e]=a,a>0&&!l&&(u.setChCc(e,0,r(u,j)[s][2]),u.pushChPrimitives(e))}setChActive(e,a=0){r(this,me)[e]!==a&&this.dispatchEvent("channeltoggle",{part:e,active:a}),r(this,me)[e]=a}getExt(e){let a=E.ext*e,s=r(this,ce).subarray(a,a+E.ext),l=new Uint8Array(s.length);switch(l.set(s),l[0]){case this.EXT_VL:{l[1]=l[1]||this.modelEx.vl.breath;break}}return l}getProgram(){return r(this,_)}getTexts(){return r(this,Ee).slice()}getVel(e){let a=new Map,s=this;return r(s,Z).forEach(function(l,u){let m=l>>7,y=l&127;e===m&&r(s,ee)[l]>0&&a.set(y,{v:r(s,ee)[l],s:r(s,F)[u]})}),a}getBitmap(){return{bitmap:r(this,Fe,Lt),expire:r(this,Ae)}}getLetter(){return{text:r(this,Ze),set:r(this,ta),expire:r(this,je)}}getMode(){return q[r(this,H)]}getMaster(){return{volume:r(this,W)}}getRpn(){return r(this,B)}getNrpn(){return r(this,Dt)}getSubDb(){return self==null?void 0:self.structuredClone(r(this,j))}getDetect(){return self==null?void 0:self.structuredClone(r(this,U))}getVoice(e,a,s,l="?",u=0){var n;let m=this;(n=x[l])!=null&&n.constructor||(l="?");let y=x[l],w=e||r(m,j)[y][0],$=a,k=s||r(m,j)[y][1];w===Be.bank0&&(w=0),k===Be.bank0&&(k=0),l==="ns5r"&&w>0&&w<56&&(k=3);let t=m.userBank.get(w,$,k,l,u);if(l==="mt32"&&t.name.indexOf("MT-m:")===0){let d=parseInt(t.name.slice(5)),i=d*E.cmt,c="";r(m,Je).subarray(i,i+10).forEach(h=>{h>31&&(c+=String.fromCharCode(h))});let o=`MSB	LSB	PRG	NME
49	127	${$}	${c}`;m.userBank.load(o,!0),t.name=c,t.ending=" "}return(t.ending!==" "||!t.name.length)&&(t=m.baseBank.get(w,$,k,l,u)),t}getChPrimitive(e,a,s){if(a>=E.vxPrim||(a==null?void 0:a.constructor)!==Number)throw new RangeError(`Invalid voice primitive component "${a}"`);if(typeof e!="number"||e<0||e>=E.ch)throw new RangeError(`Invalid part number: CH${e+1}`);let l=this,u=r(l,_)[a<<E.chShift|e];switch(a){case 1:case 2:{l.getChCcWritten(e,[255,0,32][a])||(u=u||r(l,j)[l.getChModeId(e)][a+2]),s&&(u=u||r(l,j)[l.getChModeId(e)][a-1]),u===Be.bank0&&(u=0);break}}return u}getChPrimitives(e,a){let s=this,l=new Uint8Array(3);return l[1]=r(s,_)[e],l[0]=s.getChPrimitive(e,1,a),l[2]=s.getChPrimitive(e,2,a),l}pushChPrimitives(e){let a=this;r(a,_)[1<<E.chShift|e]=a.getChCc(e,0),r(a,_)[2<<E.chShift|e]=a.getChCc(e,32),a.dispatchEvent("voice",{part:e})}getChCvnBuffer(e,a=E.cvn){if(a>E.cvn||a<1)throw new RangeError("Invalid custom voice name buffer length");let s=It[e];return r(this,bt).subarray(s,s+a)}getChCvnRegister(e,a){if(a>=E.cvn||a<0)throw new RangeError("Invalid custom voice name register");return r(this,bt)[It[e]+a]}setChCvnRegister(e,a,s=32){if(a>=E.cvn||a<0)throw new RangeError("Invalid custom voice name register");r(this,Ut)[e]=1,r(this,bt)[It[e]+a]=Math.max(32,s&255)}resetChCvn(e){r(this,bt).fill(32,It[e],It[e]+E.cvn),r(this,Ut)[e]=0}getChCvnString(e,a){let s=Zr.decode(this.getChCvnBuffer(e));return a||(s=s.trimEnd()),s}getChCvnIsWritten(e){return r(this,Ut)[e]}getChVoice(e){var l,u;let a=this,s=a.getVoice(...a.getChPrimitives(e),a.getChMode(e),(u=(l=a.modelEx[a.getChMode(e)])==null?void 0:l.map)!=null?u:0);if(r(a,Ce)[e]){let m="";switch(r(a,H)){case x.mt32:{r(a,Le).subarray(E.cmt*(e-1),E.cmt*(e-1)+10).forEach(y=>{m+=String.fromCharCode(Math.max(y,32))}),m=m.trimEnd();break}default:m=a.getChCvnString(e)}m.length&&(s.ending="~",s.name=m)}return s}getRawPitch(){return r(this,qe)}getPitchShift(e){let a=this,s=e*E.rpn,l=r(a,B)[s];return r(a,N)[e*E.rpnt]?l>>7&&(l-=256):r(a,H)===x.mt32&&(l=12),r(a,qe)[e]/8192*l+(r(a,B)[s+3]-64)+((r(a,B)[s+1]<<7)+r(a,B)[s+2]-8192)/8192}getEffectType(e=0){let a=3*e+1;return r(this,ye).subarray(a,a+2)}getPolyState(e=0){return r(this,F)[e]}setEffectTypeRaw(e=0,a,s){let l=3*e;r(this,ye)[l]=1,r(this,ye)[l+1+ +a]=s}setEffectType(e=0,a,s){this.setEffectTypeRaw(e,!1,a),this.setEffectTypeRaw(e,!0,s)}pushEffectType(e=0,a=!1){if(e<0||e>=E.efx)throw new RangeError(`Invalid EFX slot ${e}`);let s=this.getEffectType(e);a||s[0]===0&&s[1]>>4===15&&(a=!0),this.dispatchEvent(`efx${Zt[e]}`,{id:s,hidden:a})}getEffectSink(){return r(this,ut)}getChEffectSink(e){return r(this,ut)[e]}setChEffectSink(e,a=0){let s=this;if(a<0||a>=E.efx)throw new RangeError(`Invalid EFX slot ${a}`);if(e<0||e>=E.ch)throw new RangeError(`Invalid CH${e+1}`);r(this,ut)[e]=a,this.dispatchEvent("partefxtoggle",{part:e,active:a})}setXgChEffectSink(e,a=0){let s=this,l=s.modelEx.xg,u=a-2;if(a<0||u>=l.insPart.length)throw new RangeError(`Invalid XG insertion slot ${u}`);let m=l.insPart[u];l.insPart[u]=e,m!==E.invalidCh&&s.setChEffectSink(m,0),e===E.invalidCh?m!==E.invalidCh&&s.setChEffectSink(m,0):s.setChEffectSink(e,a)}setLetterDisplay(e,a,s=0,l=3200){let u=this,m;M(u,Ze," ".repeat(s)),e.forEach(y=>{M(u,Ze,r(u,Ze)+String.fromCharCode(y>31?y:32)),y<32&&(m=m||new Set,m.add(y))}),M(u,ta,u.clockSource.now()),M(u,je,u.clockSource.now()+l),u.dispatchEvent("letter"),m&&(m=Array.from(m),m.forEach((y,w,$)=>{$[w]=y.toString(16).padStart(2,"0")}),console.warn(`${a}${a?" ":""}invalid code point${m.length>1?"s":""}: 0x${m.join(", 0x")}`))}setDetectionTargets(e="?",a=0){let s=this,l=-1;switch(e.replaceAll(", ",",").split(",").forEach(u=>{u=u.toLowerCase();let m=q.indexOf(Fr[u]||u);D()&&console.debug(`Mapped mode "${u}" to ID "${m}".`),m>-1&&(l=m)}),D()&&console.debug(`Set detection target to ID "${l}".`),l>0&&(r(s,U).x5=82,r(s,U).ds=x.krs,r(s,U).gm=x.gm,r(s,U).g2=x.g2),l){case x["05rw"]:{r(s,U).x5=81;break}case x.s90es:{r(s,U).ds=x.s90es,r(s,U).smotif=x.s90es;break}case x.motif:{r(s,U).ds=x.motif,r(s,U).smotif=x.motif;break}case x.sd:{r(s,U).g2=x.sd;break}case x.pa:{r(s,U).g2=x.pa;break}}}setGsTargets(e=!1,a=4){if(!a)a=e?3:4;else{if(a>4||a<0)throw new Error(`Invalid GS level ${a}`);if(e&&a>>1!==1)throw new Error(`Invalid SC level ${a}`)}let s=this;r(s,U)[e?"sc":"gs"]=a,r(s,j)[x[e?"sc":"gs"]][1]=a,s.forceVoiceRefresh()}getConfigs(){return r(this,ea)}setDumpLimit(e){if(e>2||e<0)throw new RangeError("Invalid dump limit.");r(this,Ne).dumpLimit=e}allocateAce(e=0,a){let s=this;if(!a||a<128&&a>95){console.warn(`cc${a} cannot be allocated as an active custom effect.`);return}let l=!0,u=0,m=E.ace*e;for(;l&&u<E.ace;)r(s,ie)[u+m]===a?l=!1:r(s,ie)[u+m]||(l=!1,r(s,ie)[u+m]=a,console.debug(`Allocated cc${a} to ACE slot ${u} in CH${e+1}.`)),u++;u>=E.ace&&console.warn(`ACE slots are full in CH${e+1}.`)}allocateAceAll(e){let a=this;if(!e||e<128&&e>95){console.warn(`cc${e} cannot be allocated as an active custom effect.`);return}for(let s=0;s<E.ch;s++){let l=!0,u=0,m=E.ace*s;for(;l&&u<E.ace;)r(a,ie)[u+m]===e?l=!1:r(a,ie)[u+m]||(l=!1,r(a,ie)[u+m]=e),u++;u>=E.ace&&console.warn(`ACE slots are full in CH${s+1}.`)}}resetAce(){r(this,ie).fill(0),console.info("All ACE slots have been reset.")}resetChAceAll(e=0){r(this,ie).subarray(fa[e],fa[e]+E.ace).fill(0)}resetChAce(e=0,a){let s=!0,l=fa[e],u=l+E.ace;for(;s&&l<u;)r(this,ie)[l]===a&&(r(this,ie)[l]=0,s=!1),l++;s&&D()&&console.debug(`No ACE slot was allocated to cc${a} in CH${e+1}.`)}getAce(){return r(this,ie)}getChAce(e=0,a=0){if(a<0||a>=E.ace)throw new RangeError("No such ACE slot");let s=r(this,ie)[E.ace*e+a];if(s){if(ht.indexOf(s)>=0)return this.getChCc(e,s);throw new Error(`Invalid ACE source in CH${e+1}: ${s}`)}else return 0}initDrums(){let e=this;r(e,he).fill(64);for(let a=0;a<E.drm;a++){let s=a*E.dpn;for(let l in lr){let u=lr[l],m=(s+we[l])*E.dnc;r(e,he).subarray(m,m+E.dnc).fill(u)}}}init(e=0){let a=this;M(a,mt,0),r(a,j)[x.xg][1]=0,a.modelEx.xg.map=0,a.dispatchEvent("banklevel",{mode:"xg",data:a.modelEx.xg.map}),r(a,me).fill(0),r(a,S).fill(0),r(a,ie).fill(0),r(a,_).fill(0),r(a,ee).fill(0),r(a,Z).fill(0),r(a,F).fill(0),r(a,oe).fill(0),r(a,_e).fill(0),r(a,qe).fill(0),r(a,Dt).fill(0),r(a,N).fill(0),r(a,ce).fill(0),r(a,Q).fill(0),r(a,Bt).fill(0),r(a,gt).fill(0),r(a,pt).fill(0),M(a,W,100),M(a,Ee,[]),M(a,_t,500),a.modelEx.sg.convLastSyll=0,a.modelEx.sg.runLineLen=0,a.modelEx.sg.splitMask=!1,M(a,Ae,0),M(a,ne,0),a.lcdContrast=16,a.lcdHideBankInfo=!1;for(let s=0;s<r(a,Re).length;s++)r(a,Fe,Lt).fill(0);M(a,K,a.KARAOKE_NONE),M(a,Nt,0),M(a,ke,!0),M(a,J,!1),M(a,Ht,0),a.initDrums(),a.polyIndexLatest=0,a.polyIndexLast=0,r(a,V).forEach(function(s,l,u){u[l]=l}),e===0&&(a.dispatchEvent("mode","?"),M(a,H,0),r(a,He).fill(0),r(a,et).fill(0),M(a,je,0),M(a,Ze,"")),Yr.forEach(s=>{a.setChCc(s,0,r(a,j)[a.getChModeId(s)][2])}),r(a,L).fill(a.CH_MELODIC),r(a,L)[9]=a.CH_DRUM1,r(a,L)[25]=a.CH_DRUM3,r(a,L)[41]=a.CH_DRUMS,r(a,L)[57]=a.CH_DRUMS,r(a,L)[73]=a.CH_DRUM5,r(a,L)[89]=a.CH_DRUM7,r(a,L)[105]=a.CH_DRUMS,r(a,L)[121]=a.CH_DRUMS;for(let s=0;s<E.drm;s++)r(a,Ie)[s<<1]=0,r(a,Ie)[s<<1|1]=E.invalidCh;r(a,Ot).fill(0),r(a,Je).fill(0),r(a,Qe).fill(0),r(a,Le).fill(0),r(a,Ce).fill(0),r(a,ye).fill(0),r(a,ut).fill(0),a.aiEfxName="",a.userBank.clearRange({msb:0,lsb:127,prg:[0,127]}),a.modelEx.xg.varSys=!1,a.modelEx.xg.insPart.fill(E.invalidCh);for(let s=0;s<Me.length;s++){let l=a.modelEx.yPlg[s];l.fill(0,0,Me[s][2]),l.fill(E.invalidCh,Me[s][2])}a.modelEx.sc.showBar=!0,a.modelEx.sc.invBar=!1,a.modelEx.sc.invDisp=!1,a.modelEx.sc.peakHold=1,a.modelEx.cs1x.perfCh=0;for(let s=0;s<E.ch;s++){a.resetChCvn(s);let l=G[s];r(a,S)[l+T[7]]=100,r(a,S)[l+T[11]]=127,r(a,S)[l+T[2]]=127,r(a,S)[l+T[10]]=64,r(a,S).subarray(l+T[71],l+T[71]+8).fill(64),r(a,S)[l+T[128]]=127,r(a,S).subarray(l+T[130],l+T[157]+1).fill(64),r(a,S)[l+T[91]]=40,r(a,S)[l+T[101]]=127,r(a,S)[l+T[100]]=127,r(a,S)[l+T[99]]=127,r(a,S)[l+T[98]]=127;let u=s*E.rpn;r(a,B)[u]=2,r(a,B)[u+1]=64,r(a,B)[u+2]=0,r(a,B)[u+3]=64,r(a,B)[u+4]=0,r(a,B)[u+5]=0;let m=s*E.ext;r(a,ce)[m+1]=a.VLBC_BRTHEXPR;let y=s*E.redir;r(a,pt)[y+8]=13}a.switchMode("?",3),a.buildRchTree(),a.buildRccMap(),a.dispatchEvent("mastervolume",r(a,W));for(let s=0;s<Zt.length;s++)a.pushEffectType(s);a.dispatchEvent("reset")}setChMode(e,a){let s=this;if(typeof e!="number"||e<0||e>=E.ch)throw new RangeError(`Invalid part number: CH${e+1}`);if(e<0||a>=q.length)throw new RangeError(`Invalid mode ID ${a}`);r(s,gt)[e]=a,s.dispatchEvent("chmode",{part:e,id:a,mode:q[a]}),s.pushChPrimitives(e)}getChMode(e,a){return q[this.getChModeId(e,a)]}getChModeId(e,a){return a?r(this,gt)[e]||r(this,Q)[e>>4]:r(this,gt)[e]||r(this,Q)[e>>4]||r(this,H)}getPortMode(e,a){return q[this.getPortModeId(e,a)]}getPortModeId(e,a){return a?r(this,Q)[e]:r(this,Q)[e]||r(this,H)}setPortMode(e,a,s){let l=this;if(e<0||e>=E.ch>>4)throw new RangeError(`Invalid port ${e+1}`);if(a<1)throw new RangeError("Range must be a positive integer");if(e+a>=E.ch>>4)throw new RangeError("Range must be in bound");if(e<0||s>=q.length)throw new RangeError(`Invalid mode ID ${s}`);r(l,Bt)[e]=s;for(let u=e;u<e+a;u++){let m=r(l,Bt)[u];if(a>1&&m!==0&&m!==s)break;r(l,Q)[u]=s;for(let y=u<<4;y<u+1<<4;y++)l.dispatchEvent("chmode",{part:y,id:s,mode:q[s]}),l.pushChPrimitives(y)}}copyChSetup(e,a,s){if(e===a){console.warn(`Failed attempt at overwriting CH${e+1} with its own data.`);return}let l=this;if(s&&r(l,me)[a]){console.warn(`Failed attempt at copying setup data from CH${e+1} to CH${a+1}.`);return}let u=G[e],m=G[a];r(l,_)[a]=r(l,_)[e],r(l,S).set(r(l,S).subarray(u,u+E.cc),m),l.pushChPrimitives(a)}setDrumFirstWrite(e,a){let s=this,l=r(s,L)[e];if(l<2)return;let u=l-2;if(r(s,Ie)[u<<1])if(a)r(s,Ie)[u<<1]=0,D()&&console.debug(`First write part for drum set ${u+1} has been reset.`);else return;else a?console.warn(`First write part for drum set ${u+1} is already blank.`):(r(s,Ie)[u<<1]=1,r(s,Ie)[u<<1|1]=e,console.debug(`First write part for drum set ${u+1} is set to CH${e+1}.`))}getChDrumFirstWrite(e){let a=this,s=r(a,L)[e];if(s<2)return;let l=s-2;return r(a,Ie).subarray(l<<1,l+1<<1)}getDrumFirstWrite(e){if(e>=0&&e<E.drm)return r(this,Ie).subarray(e<<1,e+1<<1)}switchMode(e,a=0,s=!1){D()&&console.debug(`Requested level ${a} mode change to "${e}".`);let l=this,u=x[e];if(u>-1){if(r(l,H)===0&&a!==3||a){if(l.initOnReset)switch(a){case 1:{r(l,H)===0&&l.init(1);break}case 2:{l.init(1);break}}switch(M(l,ne,0),u){case x.gm:{u=r(l,U).gm;break}case x.g2:{u=r(l,U).g2;break}}switch(M(l,H,u),u){case x.gs:case x.sc:{r(l,j)[x[e]][1]=r(l,U)[e];break}}for(let w=0;w<E.ch;w++){let $=l.getChModeId(w,!0);r(l,L)[w]>0&&$===x["?"]&&(l.setChCc(w,0,r(l,j)[u][2]),D()&&console.debug(`CH${w+1} (${r(l,L)[w]}) (${l.getChMode(w)}), ${q[$]} (${r(l,j)[$][2]}) -> ${q[u]} (${r(l,j)[u][2]})`),l.pushChPrimitives(w))}switch(u){case x.mt32:{va.forEach((w,$)=>{let k=$+1;r(l,me)[k]||(r(l,_)[k]=w,l.setChCc(k,91,127),l.pushChPrimitives(k))});for(let w=1;w<10;w++)l.pushChPrimitives(w);break}}let m,y;switch(u){case x["?"]:case x.g2:{m=[52,4,52,18,0,255,0,255,0,255,0,255,0,255,0,255];break}case x.xg:case x.cs1x:{m=[1,0,65,0,5,0,64,0,64,0,64,0,64,0,0,255],y=[64,0];break}case x.gm:case x.gs:case x.sc:{m=[40,4,40,18,40,32,32,0,0,255,0,255,0,255,0,255],y=[32,0];break}case x.sd:{m=[58,0,60,0,61,0,61,0],y=[61,0];break}case x["05rw"]:case x.x5d:case x.ns5r:{m=[44,1,44,19,0,255,0,255,0,255,0,255,0,255,0,255];break}case x.k11:case x.sg:{m=[24,0,0,255,0,255,0,255,0,255,0,255,0,255,0,255];break}case x.mt32:{m=[40,4,0,255,0,255,0,255,0,255,0,255,0,255,0,255];break}case x.doc:{m=[24,16,0,255,0,255,0,255,0,255,0,255,0,255,0,255];break}case x.motif:case x.s90es:case x.cs6x:{m=[129,0,133,0,130,0,128,0,128,0,0,255,0,255,0,255],y=[128,0];break}case x.pa:{m=[28,52,28,16,28,0,28,0,0,255,0,255,0,255,0,255],y=[28,0];break}case x.krs:{m=[45,0,45,0,0,255,45,0,45,0,45,0,45,0,45,0],y=[45,0];break}default:m=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}for(let w=0;w<E.efx;w++)if(!r(l,ye)[3*w]&&typeof m[w<<1]=="number"){r(l,ye)[3*w+1]=m[w<<1],r(l,ye)[3*w+2]=m[w<<1|1];let $=!1;(y==null?void 0:y.length)>0&&m[w<<1]===y[0]&&m[w<<1|1]===y[1]&&($=!0),l.pushEffectType(w,$)}s&&l.setDetectionTargets(e),l.dispatchEvent("mode",q[u]),l.forceVoiceRefresh()}}else throw new Error(`Unknown mode ${e}`)}getRawStrength(){let e=this;return r(this,Z).forEach(function(a){let s=a>>7;r(e,ee)[a]>r(e,_e)[s]&&(r(e,_e)[s]=r(e,ee)[a])}),r(this,_e)}getStrength(){let e=[],a=this;return this.getRawStrength().forEach(function(s,l){e[l]=Math.floor(s*a.getChCc(l,7)*a.getChCc(l,11)*r(a,W)/803288)}),e}newStrength(){r(this,_e).fill(0)}runJson(e){var a;if(e==null){console.warn(new Error("Invalid JSON data provided."));return}if(e.type>14)return e.type===15&&e.data.constructor!==Uint8Array&&(e.data=Uint8Array.from(e.data)),r(this,ra)[e.type].call(this,e);{let s=this.chRedir(e.part,e.track),l=!1;(a=r(this,aa)[s])==null||a.forEach(u=>{e.channel=u,l=!0,r(this,ra)[e.type].call(this,e)}),l||console.warn(`${nr[e.type]?nr[e.type]:e.type}${[11,12].includes(e.type)?(e.data[0]!==void 0?e.data[0]:e.data).toString():""} event sent to CH${s+1} without any recipient.`)}r(this,Ee).length>100&&r(this,Ee).splice(100,r(this,Ee).length-99)}runRaw(e){}async loadBank(e,a){let s=this;switch(e=e.toLowerCase(),e){case"s7e":{s.userBank.clearRange({msb:63,lsb:[21,22]}),s.userBank.clearRange({msb:63,lsb:[24,27]});break}case"pcg":{s.userBank.clearRange({msb:63,lsb:[6,9]}),s.userBank.clearRange({msb:63,lsb:[13,16]});break}default:throw new Error(`Unknown bank format ${e}`)}switch(e){case"s7e":case"pcg":{Yt.context=this,await s.userBank.load(await Yt.read(e,a),!1);break}}s.forceVoiceRefresh()}},H=new WeakMap,ne=new WeakMap,Ae=new WeakMap,Re=new WeakMap,Fe=new WeakSet,Lt=function(){return r(this,Re)[r(this,ne)]},as=function(e){r(this,Re)[r(this,ne)]=e},jt=new WeakMap,me=new WeakMap,V=new WeakMap,L=new WeakMap,S=new WeakMap,ie=new WeakMap,_=new WeakMap,ee=new WeakMap,oe=new WeakMap,Z=new WeakMap,F=new WeakMap,qe=new WeakMap,_e=new WeakMap,ft=new WeakMap,ce=new WeakMap,B=new WeakMap,N=new WeakMap,Dt=new WeakMap,he=new WeakMap,Ie=new WeakMap,ye=new WeakMap,ut=new WeakMap,pt=new WeakMap,Q=new WeakMap,Bt=new WeakMap,gt=new WeakMap,Ce=new WeakMap,bt=new WeakMap,Ut=new WeakMap,Qe=new WeakMap,Le=new WeakMap,Ot=new WeakMap,Je=new WeakMap,j=new WeakMap,U=new WeakMap,Ne=new WeakMap,ea=new WeakMap,W=new WeakMap,mt=new WeakMap,_t=new WeakMap,xa=new WeakMap,Ta=new WeakMap,Ma=new WeakMap,Pa=new WeakMap,Ze=new WeakMap,je=new WeakMap,ta=new WeakMap,Nt=new WeakMap,ke=new WeakMap,K=new WeakMap,aa=new WeakMap,J=new WeakMap,Ht=new WeakMap,yt=new WeakMap,Ee=new WeakMap,He=new WeakMap,et=new WeakMap,le=new WeakMap,Et=new WeakMap,te=new WeakMap,ra=new WeakMap,ua=new WeakMap,wt=new WeakMap,Ct=new WeakMap,re=new WeakMap,ve=new WeakMap,De=new WeakMap,kt=new WeakMap,vt=new WeakMap,$t=new WeakMap,ur);var Ba=Ir(pr(),1);O();O();var sa,gr,mr=(gr=class{constructor(g,f,e,a){P(this,sa,!1);M(this,sa,g),this.start=f,this.end=e,this.data=a}get duration(){return this.ranged?this.end-this.start:0}get ranged(){return r(this,sa)}},sa=new WeakMap,gr),Ra=class extends mr{constructor(g,f,e){super(!0,g,f,e)}},yr=class extends mr{constructor(g,f){super(!1,g,g,f)}},St,br,Ia=(br=class extends Array{constructor(){super(...arguments);P(this,St,-1)}resetIndex(f){M(this,St,-1)}fresh(){this.sort(function(f,e){return f.start==e.start?0:(+(f.start>e.start)<<1)-1}),this.forEach(function(f,e){f.index=e})}step(f,e=!1){let a=[];if(e)for(let s=0;s<this.length&&!(this[s].start>f);s++){if(this[s].end<f)continue;a.push(this[s])}else{let s=this.getRange(r(this,St)==-1?0:f-1,f),l=this;s.forEach(function(u){u.index>r(l,St)&&(a.push(u),M(l,St,u.index))})}return a}getRange(f,e){var m;f>e&&([f,e]=[e,f]);let a=[],s=-1,l=Math.ceil(Math.sqrt(this.length)),u=!0;for(let y=0;y<this.length;y+=l)this[y+l]?s<0&&this[y+l].start>=f&&(s=y):s=s<0?y:s;for(;u;)((m=this[s])==null?void 0:m.end)<e?this[s].start>=f&&a.push(this[s]):u=!1,s++;return a}},St=new WeakMap,br);var rs=0xffffffffffff,Er=function(g){let f=new Ia,e=this,a=g.timeDivision,s=120,l=new Ia,u=0,m=0;l.push(new Ra(0,rs,[120,0])),g.track.forEach(function(k){u=0,k.event.forEach(function(t){u+=t.deltaTime,t.type===255&&(t==null?void 0:t.metaType)===81&&(s=6e7/t.data,l[l.length-1]&&l.push(new Ra(u,0xffffffffffff,[s,0])))})}),l.fresh(),l.forEach(function(k,t,n){t>0&&(n[t-1].end=k.start)});let y=120;l.forEach(function(k,t,n){t>0&&(k.end===k.start?n.splice(n.indexOf(k),1):y===k.data[0]&&(n[t-1].end=k.end,n.splice(n.indexOf(k),1)),y=k.data[0])});let w=0,$=120;return l.forEach(function(k){let t=k.start,n=t/$/a*60+w;$=k.data[0],w=n-t/$/a*60,k.data[1]=w}),console.debug("All tempo changes: ",l),s=120,u=0,m=0,g.track.forEach(function(k,t){u=0,m=0;let n=t+1;k.event.forEach(function(d,i){u+=d.deltaTime;let c=l.step(u,!0)[0];c&&(s=c.data[0],m=c.data[1]);let o={type:d.type,data:d.data,track:n,part:0};d.type>14?o.meta=d.metaType:o.part=d.channel,f.push(new yr(u/s/a*60+m,o))})}),f.fresh(),self.midiEvents=f,console.debug(`Parsed a type ${g.formatType} MIDI sequence.`),f};O();var ss={866:"cp866","utf-8":"utf-8",utf8:"utf-8","utf-16":"utf-16",utf16:"utf-16","utf-16le":"utf-16",utf16le:"utf-16",unicode:"utf-16",unicodefeff:"utf-16","ucs-2":"utf-16","utf-16be":"utf-16be",utf16be:"utf-16be","utf-24":"utf-24",utf24:"utf-24","utf-24le":"utf-24",utf24le:"utf-24","utf-24be":"utf-24be",utf24be:"utf-24be","utf-32":"utf-32",utf32:"utf-32","utf-32le":"utf-32",utf32le:"utf-32","utf-32be":"utf-32be",utf32be:"utf-32be",latin1:"latin1",l1:"latin1",ascii:"latin1","us-ascii":"latin1","iso-8859-1":"latin1","iso8859-1":"latin1",cp1252:"latin1","windows-1252":"latin1",cp819:"latin1",ibm819:"latin1",latin2:"latin2",l2:"latin2","iso-8859-2":"latin2","iso8859-2":"latin2",latin3:"latin3",l3:"latin3","iso-8859-3":"latin3","iso8859-3":"latin3",latin4:"latin4",l4:"latin4","iso-8859-4":"latin4","iso8859-4":"latin4",latin5:"latin5",l5:"latin5","iso-8859-9":"latin5","iso8859-9":"latin5",cp1254:"latin5","windows-1254":"latin5",latin6:"latin6",l6:"latin6","iso-8859-10":"latin6","iso8859-10":"latin6",latin9:"latin9",l9:"latin9","iso-8859-15":"latin9","iso8859-15":"latin9","iso-8859-5":"iso-8859-5","iso8859-5":"iso-8859-5",cyrillic:"iso-8859-5","iso-8859-6":"iso-8859-6","iso8859-6":"iso-8859-6","iso-8859-6-e":"iso-8859-6","iso8859-6e":"iso-8859-6","iso-8859-6-i":"iso-8859-6","iso8859-6i":"iso-8859-6","asmo-708":"iso-8859-6","ecma-114":"iso-8859-6",arabic:"iso-8859-6","iso-8859-7":"iso-8859-7","iso8859-7":"iso-8859-7","ecma-118":"iso-8859-7",greek:"iso-8859-7",greek8:"iso-8859-7","iso-8859-8":"iso-8859-8","iso8859-8":"iso-8859-8","iso-8859-8-e":"iso-8859-8","iso8859-8e":"iso-8859-8",hebrew:"iso-8859-8",visual:"iso-8859-8","iso-8859-8-i":"iso-8859-8-i","iso8859-8i":"iso-8859-8-i",logical:"iso-8859-8-i","iso-8859-11":"iso-8859-11","iso8859-11":"iso-8859-11","windows-874":"iso-8859-11","dos-874":"iso-8859-11",cp874:"iso-8859-11","tis-620":"iso-8859-11","iso-8859-13":"iso-8859-13","iso8859-13":"iso-8859-13",latin7:"iso-8859-13",l7:"iso-8859-13","iso-8859-14":"iso-8859-14","iso8859-14":"iso-8859-14",latin8:"iso-8859-14",l8:"iso-8859-14","iso-8859-16":"iso-8859-16","iso8859-16":"iso-8859-16",cp866:"cp866",ibm866:"cp866",cp1250:"cp1250","windows-1250":"cp1250",cp1251:"cp1251","windows-1251":"cp1251",cp1253:"cp1253","windows-1253":"cp1253",cp1255:"cp1255","windows-1255":"cp1255",cp1256:"cp1256","windows-1256":"cp1256",cp1257:"cp1257","windows-1257":"cp1257",cp1258:"cp1258","windows-1258":"cp1258","euc-jp":"euc-jp",cp954:"euc-jp","euc-kr":"euc-kr",koi8:"koi8",koi:"koi8","koi8-r":"koi8","koi8-u":"koi8-u","koi8-ru":"koi8-u",mac:"mac",macintosh:"mac","mac-cyrillic":"x-mac-cyrillic","x-mac-cyrillic":"x-mac-cyrillic","x-mac-ukrainian":"x-mac-cyrillic",gbk:"gbk",gb2312:"gbk",chinese:"gbk","euc-cn":"gbk",gb18030:"gb18030",big5:"big5","big5-hkscs":"big5",sjis:"sjis","shift-jis":"sjis",ms932:"sjis","windows-31j":"sjis"},is={"utf-8":1,"utf-16":2,"utf-16be":3,"utf-24":4,"utf-24be":5,"utf-32":6,"utf-32be":7,latin1:0,latin2:0,latin3:0,latin4:0,latin5:0,latin6:0,latin9:0,"iso-8859-5":0,"iso-8859-6":0,"iso-8859-7":0,"iso-8859-8":0,"iso-8859-8-i":0,"iso-8859-11":0,"iso-8859-13":0,"iso-8859-14":0,"iso-8859-16":0,cp866:0,cp1250:0,cp1251:0,cp1253:0,cp1255:0,cp1256:0,cp1257:0,cp1258:0,"euc-jp":1,"euc-kr":1,koi8:0,"koi8-u":0,mac:0,"x-mac-cyrillic":0,gbk:1,gb18030:1,big5:1,sjis:1},Ge,tt=(Ge=class{static getUnitSize(g){if(g>7)throw new RangeError("Cannot decode encodings with more than 4 bits per unit.");return(g>>1)+1}static isBigEndian(g){return(g&1)===1}static collapse(g){let f=ss[g];if(typeof f!="string")throw new TypeError(`Provided label "${g}" is not supported.`);return f}static indicator(g){let f=is[g];if(typeof f!="number")throw new TypeError(`Provided collapsed label "${g}" is not supported.`);return f}},A(Ge,"BYTE_1",0),A(Ge,"BYTE_1_VL",1),A(Ge,"BYTE_2_LE",2),A(Ge,"BYTE_2_BE",3),A(Ge,"BYTE_3_LE",4),A(Ge,"BYTE_3_BE",5),A(Ge,"BYTE_4_LE",6),A(Ge,"BYTE_4_BE",7),Ge),fe=(g,f)=>{g.unsent=!1,g.enqueue(f)},ga=(g,f,e=1,a=!0)=>{if(typeof e!="number"||e<=0||e>4)throw new RangeError(`Invalid byte size ${e}.`);if(!(g instanceof Uint8Array||g instanceof Uint8ClampedArray))throw new TypeError("Input buffer is not Uint8Array.");if(typeof f!="number"||f<0||f>=g.length)throw new RangeError(`Provided offset ${f} is out of buffer range.`);if(e===1)return g[f];{let s=0;if(a)for(let l=0;l<e;l++)s<<=8,s|=g[f+l];else for(let l=0;l<e;l++)s|=g[f+l]<<(l<<3);return s<0?s+4294967296:s}},ns=class{static lineRaw(g,f=0){if(typeof f!="number"||f<0||f>7)throw new TypeError("Invalid split mode.");if(!g||(g==null?void 0:g.constructor)!==ReadableStream)throw new TypeError("Not a readable stream.");let e=tt.getUnitSize(f),a=tt.isBigEndian(f),s=g.getReader(),l,u=!1,m=[],y=0,w=0,$=0;return new ReadableStream({pull:async k=>{for(k.unsent=!0;k.unsent;){if(!l||y>=l.length){y>w&&(m.push(l.subarray(w)),w=0);let t=await s.read();l=t.value,u=t.done,y=0}if(l){let t=0;if(e===1)t=l[y];else if(a)for(let d=0;d<e;d++)t<<=8,t|=l[y+d];else for(let d=0;d<e;d++)t|=l[y+d]<<(d<<3);let n=!1;switch(t){case 10:{$===13?w+=e:n=!0;break}case 13:{n=!0;break}}if(n){if(m.length){m.push(l.subarray(w,y));let d=0;for(let o=0;o<m.length;o++)d+=m[o].length;let i=new Uint8Array(d),c=0;for(let o=0;o<m.length;o++)i.set(m[o],c),c+=m[o].length;fe(k,i),m=[]}else fe(k,l.subarray(w,y));w=y+=e}$=t}if(u){if(w!==y&&l&&m.push(l.subarray(w,y)),m.length){let t=0;for(let i=0;i<m.length;i++)t+=m[i].length;let n=new Uint8Array(t),d=0;for(let i=0;i<m.length;i++)n.set(m[i],d),d+=m[i].length;fe(k,n)}k.unsent=!1,k.close()}y+=e}}},new ByteLengthQueuingStrategy({highWaterMark:256}))}static chunkRaw(g,f="utf-8"){if(!g||(g==null?void 0:g.constructor)!==ReadableStream)throw new TypeError("Not a readable stream.");let e=tt.indicator(f),a=tt.getUnitSize(e),s=tt.isBigEndian(e),l=g.getReader(),u;return new ReadableStream({pull:async m=>{m.unsent=!0;let{value:y,done:w}=await l.read();if(y){let $=0,k=y.length;if(e!==0&&typeof(u==null?void 0:u.length)=="number"){let t=!1;switch(f){case"big5":case"gbk":case"sjis":case"euc-kr":{$=1;let n=new Uint8Array(2);n[0]=u[0],n[1]=y[0],fe(m,n);break}case"euc-jp":{let n=3;u[0]===143?$=3-u.length:u[0]>127?($=1,n=2):n=u.length;let d=new Uint8Array(3);d.set(u),d.set(y.subarray(0,$),u.length),fe(m,d.subarray(0,n));break}case"gb18030":{let n=new Uint8Array(4),d=4;n.set(u),n.set(y.subarray(0,4-u.length),u.length),n[0]<128?d=u.length:n[1]>=64?($=1,d=2):$=4-u.length,fe(m,n.subarray(0,d));break}case"utf-8":{let n=4;u[0]>=240?$=4-u.length:u[0]>=224?($=3-u.length,n=3):u[0]>=192?($=1,n=2):n=u.length;let d=new Uint8Array(4);d.set(u),d.set(y.subarray(0,$),u.length),fe(m,d.subarray(0,n));break}case"utf-16":case"utf-16be":{let n=new Uint8Array(4);n.set(u),n.set(y.subarray(0,4-u.length)),$=4-u.length,ga(transientSize,0,2,s)>=55296&&ga(transientSize,2,2,s)>=55296?fe(m,n):(fe(m,n.subarray(0,2)),fe(m,n.subarray(2)));break}default:{let n=new Uint8Array(a);n.set(u),n.set(y.subarray(0,a-u.length),u.length),fe(m,n)}}}if(u=void 0,e===0)fe(m,y.subarray($));else{switch(f){case"utf-24":case"utf-24be":{k=Math.floor((y.length-$)/a)*a+$;break}case"utf-32":case"utf-32be":{k=(y.length-$>>2<<2)+$;break}case"utf-8":{if(y[y.length-1]>127){let t=!0,n=y.length,d=y.length-8;for(;t&&n>d;)n--,y[n]<128?k=n+1:y[n]>192&&(k=n)}break}case"utf-16":case"utf-16be":{if(k=(y.length-$>>1<<1)+$,ga(y,k-2,2,s)>=55296){let t=!0,n=k,d=k-6;for(;t&&n>d;)n-=2,ga(y,n,2,s)>>10===54&&(k=n)}break}default:throw new TypeError("Maybe someday the rest of the decoders will be implemented")}fe(m,y.subarray($,k))}k<y.length&&(u=y.subarray(k))}w&&(typeof(u==null?void 0:u.length)=="number"&&fe(m,u),m.unsent=!1,m.close())}},new ByteLengthQueuingStrategy({highWaterMark:256}))}static line(g,f="utf-8",e){let a=tt.collapse(f),s=tt.indicator(a),l=this.lineRaw(g,s).getReader(),u=new TextDecoder(a,onlostpointercapture);return new ReadableStream({pull:async m=>{let{value:y,done:w}=await l.read();y&&m.enqueue(u.decode(y)),w&&m.close()}})}static chunk(g,f="utf-8",e){let a=tt.collapse(f);if(self.TextDecoderStream){let s=new TextDecoderStream(a,e);return g.pipeTo(s.writable),s.readable}else{let s=this.chunkRaw(g,a).getReader(),l=new TextDecoder(a);return new ReadableStream({pull:async u=>{let{value:m,done:y}=await s.read();m&&(console.debug(m),u.enqueue(l.decode(m))),y&&u.close()}})}}},wr=ns;O();var La={0:"\0",a:"\x07",b:"\b",e:"\x1B",f:"\f",n:`
`,r:"\r",t:"	",v:"\v","\\":"\\","'":"'",'"':'"'},Da=new Uint8Array(128);Da.fill(1,48,58);Da.fill(1,65,71);Da.fill(1,97,103);var Gt=new Uint8Array(256);Gt.fill(1,0,32);Gt.fill(1,128,160);Gt[127]=1;var os={};for(let g in La){let f=La[g];os[f]=`\\${g}`,Gt[f.charCodeAt(0)]=2}Gt[34]=3;Gt[39]=3;var Cr=g=>{let f="",e=!1;for(let a=0;a<g.length;a++){let s=g[a];if(e){let l=0;switch(s){case"x":{l=2;break}case"u":{l=4;break}case"U":{l=8;break}default:{let u=La[s];if(typeof u=="string")f+=u;else throw new Error(`Invalid escape identifier "${s}" at index ${a}`);e=!1;continue}}if(l>0){let u=a+1,m=g.substring(u,u+l);if(m.length<l)throw new RangeError(`Insufficient code point buffer "${m}" at index ${u}`);let y=parseInt(m,16);if(Number.isNaN(y))throw new RangeError(`Malformed code point representation "${m}" at index ${u}`);if(y>=1114112)throw new RangeError(`Code point "${m}" exceeds 0x10ffff at index ${u}`);f+=String.fromCodePoint(y),e=!1,a+=l}}else s==="\\"?e=!0:f+=s}return f},cs=(g,f=0)=>{};self.TextEscape=cs;var at,ba=(at=class{static parse(g,f){let e=g&this.MASK_TYPE,a=g&this.MASK_DATA,s=0,l=0,u,m=0,y,w=f.getReader();return new ReadableStream({pull:async $=>{let{value:k,done:t}=await w.read();if(typeof k=="string"){switch(e){case this.TYPE_TSV:{u=[];try{for(let n of k.split("	"))switch(a){case this.DATA_TEXT:{u.push(Cr(n));break}case this.DATA_JSON:{u.push(s===0?Cr(n):JSON.parse(n));break}default:throw new TypeError(`Unknown DSV value type ${e}`)}}catch(n){console.debug(`The following error appeared when parsing on line ${s+1}.`),console.error(n)}break}case this.TYPE_CSV:{if(a!==this.DATA_TEXT)throw new TypeError(`Invalid type ${e} for CSV, only plain text is allowed`);break}default:throw new TypeError(`Unknown DSV type ${e}`)}$.enqueue(u),s++}t&&$.close()}})}static parseObjects(g,f){let e=0,a=this.parse(g,f).getReader(),s;return new ReadableStream({start:async l=>{let{value:u,done:m}=await a.read();typeof(u==null?void 0:u.length)=="number"&&(s=u),m&&l.close()},pull:async l=>{let{value:u,done:m}=await a.read();if(typeof(u==null?void 0:u.length)=="number"){let y={};for(let w=0;w<u.length;w++)u[w]&&(y[s[w]]=u[w]);l.enqueue(y)}m&&l.close()}})}},A(at,"MASK_TYPE",3),A(at,"MASK_DATA",12),A(at,"TYPE_TSV",0),A(at,"TYPE_CSV",1),A(at,"DATA_TEXT",0),A(at,"DATA_JSON",4),at);Ba.default.customInterpreter=rr;var X=(g,f,e)=>{g.addEventListener(e,a=>{f.dispatchEvent(e,a.data)})},kr=g=>{let f=g.split("/");return f[f.length-1]||f[f.length-2]||"(remote)"};if(typeof(self==null?void 0:self.require)<"u")throw new Error("Environments supporting CommonJS is not supported.");var rt,st,Vt,Ke,$e,xt,Xt,Tt,ia,Ft,Mt,it,nt,Se,de,Ve,Ye,Xe,ot,ct,vr,Vi=(vr=class extends oa{constructor(f,e=.5,a=.5){super();A(this,"BM_UNIVERSAL",0);A(this,"BM_YAMAHA_MU",1);A(this,"device");P(this,rt,void 0);P(this,st,{});P(this,Vt,[]);P(this,Ke,new Map);P(this,$e,"");P(this,xt,[]);P(this,Xt,[]);P(this,Tt,new Uint8ClampedArray(E.ch));P(this,ia,new Uint8ClampedArray(E.ch));P(this,Ft,new Uint32Array(E.ch));P(this,Mt,new Uint32Array(E.ch));P(this,it,.5);P(this,nt,120);P(this,Se,4);P(this,de,4);P(this,Ve,0);P(this,Ye,0);P(this,Xe,new Array(E.ch));P(this,ot,new Uint8Array(E.ch));P(this,ct,0);A(this,"dState");A(this,"msActive",200);A(this,"msFrame",100);A(this,"msExhaust",300);A(this,"smoothAttack",0);A(this,"smoothDecay",0);let s=this;s.smoothAttack=e,s.smoothDecay=a,s.device=f,s.addEventListener("meta",function(l){var u;(u=l==null?void 0:l.data)==null||u.forEach(function(m){(r(s,xt)[m.meta]||console.debug).call(s,m.meta,m.data)})}),X(s.device,s,"mode"),X(s.device,s,"mastervolume"),X(s.device,s,"channelactive"),X(s.device,s,"channelmin"),X(s.device,s,"channelmax"),X(s.device,s,"portrange"),X(s.device,s,"portstart"),X(s.device,s,"channelreset"),X(s.device,s,"channeltoggle"),X(s.device,s,"screen"),X(s.device,s,"metacommit"),X(s.device,s,"voice"),X(s.device,s,"pitch"),X(s.device,s,"note"),X(s.device,s,"reset"),X(s.device,s,"banklevel"),X(s.device,s,"efxreverb"),X(s.device,s,"efxchorus"),X(s.device,s,"efxdelay"),X(s.device,s,"efxinsert0"),X(s.device,s,"efxinsert1"),X(s.device,s,"efxinsert2"),X(s.device,s,"efxinsert3"),X(s.device,s,"efxinsert4"),X(s.device,s,"partefxtoggle"),X(s.device,s,"chmode"),s.addEventListener("note",function({data:l}){if(r(s,Xt).push(l),l.state===3){let u=Math.floor(r(s,Ye)*1e3);r(s,Ft)[l.part]=u,u-r(s,Mt)[l.part]>=s.msExhaust&&(r(s,Mt)[l.part]=u)}}),s.addEventListener("voice",({data:l})=>{s.refreshCachedChVoice(l.part)}),s.addEventListener("reset",({data:l})=>{r(s,ot).fill(1),r(s,Ft).fill(0),r(s,Mt).fill(0)}),r(s,ot).fill(1),r(s,xt)[3]=function(l,u){var m;((m=r(s,$e))==null?void 0:m.length)<1&&(M(s,$e,u),s.dispatchEvent("title",r(s,$e)))},r(s,xt)[81]=function(l,u){let m=s.noteProgress,y=r(s,it)||.5;M(s,nt,6e7/u),M(s,it,u/1e6),M(s,Ve,r(s,Ve)+(m*(y/r(s,it))-m)),s.dispatchEvent("tempo",r(s,nt))},r(s,xt)[88]=function(l,u){let m=s.noteBar,y=s.noteBeat,w=r(s,Se),$=r(s,de);M(s,Se,u[0]),M(s,de,1<<u[1]);let k=Math.round(m+y/w);w!==r(s,Se)&&M(s,Ve,r(s,Ve)-k*(r(s,Se)-w)*(4/r(s,de))),$!==r(s,de)&&(console.debug(`${m}/${y}`),$<r(s,de)?M(s,Ve,r(s,Ve)+k*(r(s,de)-$)*($/r(s,de))):M(s,Ve,r(s,Ve)+k*(r(s,de)-$)*(r(s,de)/$))),s.dispatchEvent("tsig",s.getTimeSig())},s.addEventListener("metacommit",({data:l})=>{var u;switch(l.type){case"KarTitle":case"EORTitle":{((u=r(s,$e))==null?void 0:u.length)<1&&(M(s,$e,l.data),s.dispatchEvent("title",r(s,$e)));break}}})}get clockSource(){var f;return(f=this.device)==null?void 0:f.clockSource}set clockSource(f){if(this.device)this.device.clockSource=f;else throw new Error("OctaviaDevice is not ready.")}reset(){var e;let f=this;f.dispatchEvent("reset"),(e=r(f,rt))==null||e.resetIndex(),f.device.init(),M(f,$e,""),M(f,it,.5),M(f,nt,120),M(f,Se,4),M(f,de,4),M(f,Ve,0),M(f,Ye,0),f.dispatchEvent("tempo",r(f,nt)),f.dispatchEvent("title",r(f,$e)),f.dispatchEvent("tsig",f.getTimeSig())}init(){this.reset(),M(this,rt,void 0)}async loadFile(f){M(this,rt,Er(Ba.default.parse(new Uint8Array(await f.arrayBuffer()))))}async loadMap(f,e,a,s="(internal)"){let l=this,u=0,m=0,y=0,w=0,$,k;f.split(`
`).forEach((t,n)=>{var i;if(!t)return;let d=t.split("	");if(n){if(!w)return;let c="",o="";d.forEach((b,p)=>{switch(p){case $:{c=b;break}case k:{o=b;break}}});let h=!1;((i=r(l,st)[c])==null?void 0:i.priority)>a&&(h=!0,y++),!r(l,st)[c]||h||e?(r(l,st)[c]={name:o,priority:a},u++):self.debugMode&&console.debug(`Voice "${o}" (${c}) seems to be in conflict with (${r(l,st)[c]}).`),m++}else d.forEach((c,o)=>{switch(c){case"ID":{$=o,w++;break}case"Name":{k=o,w++;break}default:console.debug(`Unknown map field: ${c}`)}})}),console.debug(`Voice names: From "${s}", ${m} total, ${u} loaded (${u-y} + ${y}).`),l==null||l.device.forceVoiceRefresh()}async loadMapPaths(f){let e=this;f.forEach(async(a,s)=>{e.loadMap(await(await fetch(a)).text(),0,s,kr(a))})}async loadEfx(f,e){let a=this,s=0,l=0,u,m,y;f.split(`
`).forEach((w,$)=>{if(w)if($){let k=0,t;w.split("	").forEach((n,d)=>{switch(d){case u:{k|=(parseInt(n,16)&255)<<8;break}case m:{k|=parseInt(n,16)&255;break}case y:{t=n;break}}}),!r(a,Vt)[k]||e?(r(a,Vt)[k]=t,s++):self.debugMode&&console.debug(`EFX ID 0x${k.toString(16).padStart(4,"0")} (${t}) seems to be in conflict.`),l++}else w.split("	").forEach((k,t)=>{switch(k){case"MSB":{u=t;break}case"LSB":{m=t;break}case"Name":{y=t;break}default:console.debug(`Unknown EFX field: ${k}`)}})}),console.debug(`EFX: ${l} total, ${s} loaded.`);for(let w=0;w<Zt.length;w++){let $=!1,k=a.device.getEffectType(w);k[0]===0&&k[1]>>4===15&&($=!0),a.dispatchEvent(`efx${Zt[w]}`,{id:k,hidden:$})}}async loadModels(f,e){let a=this,s=0,l=0}async loadStyles(f,e){let a=this,s=0,l=0}async loadProps(f,e,a=0,s="(internal)"){var w,$;let l=this,u=0,m=0,y=0;try{for(var k=_a(ba.parseObjects(ba.DATA_TEXT|ba.TYPE_TSV,wr.line(f))),t,n,d;t=!(n=await k.next()).done;t=!1){let i=n.value;if(typeof(i==null?void 0:i.voiceId)=="string")if(m++,!(r(l,Ke).has(i.voiceId)||((w=r(l,Ke).get(i.voiceId))==null?void 0:w.priority)<=a)||e){if(Object.keys(i).length<2)continue;(($=r(l,Ke).get(i.voiceId))==null?void 0:$.priority)>a&&y++,i.priority=a,l.handleProp&&await l.handleProp(i),r(l,Ke).set(i.voiceId,i),u++}else console.debug(`Tried to write a pre-existing entry "${i.voiceId}" on entry ${m}.`)}}catch(n){d=[n]}finally{try{t&&(n=k.return)&&await n.call(k)}finally{if(d)throw d[0]}}console.debug(`Voice properties: From "${s}", ${m} total, ${u} loaded (${u-y} + ${y}).`)}async loadPropsPaths(f){let e=this;f.forEach(async(a,s)=>{let l=a.split("/");e.loadProps((await fetch(a)).body,0,s,kr(a))})}switchMode(f,e=!1){this.device.switchMode(f,e)}getMode(){return this.device.getMode()}getVoice(){return this.device.getVoice(...arguments)}getChVoice(f){return this.device.getChVoice(f)}refreshCachedChVoice(f,e){var m;let a=this,s=e!=null?e:a.device.getChVoice(f),l=r(a,Xe)[f],u=!0;if(na(a,ct)._++,!e)switch(a.device.getChMode(f)){case"xg":{if(a.device.getChType(f)>0&&a.device.getChPrimitive(f,1)!==126)switch(s.ending){case"!":case"?":{u=!1,l.refreshFailure=!0,console.debug("Cached voice persisted due to invalid drum kit.");break}}break}case"gs":case"sc":{s.ending!==" "&&(s.sid[2]===1?(s.name="Silence",s.refreshFailure=!0,console.debug("Cached voice nullified due to invalid SC-55 voice.")):(u=!1,l.refreshFailure=!0,console.debug("Cached voice persisted due to invalid GS voice.")));break}}return u?(r(a,Xe)[f]=s,r(a,ot)[f]=(m=s.poly)!=null?m:1,r(a,ct)>1?console.debug(`Bubbling prevented at instance #${r(a,ct)}.`):a.dispatchEvent("cachedvoice",{part:f}),na(a,ct)._--,s):(na(a,ct)._--,l)}getCachedChVoice(f){var l,u;let e=this,a=r(e,Xe)[f],s=(l=e.device)==null?void 0:l.getChPrimitives(f,!0);if(a&&((u=e.device)==null?void 0:u.getChCvnIsWritten(f))===0)switch(a.ending){case"?":case"!":return e.refreshCachedChVoice(f,void 0);default:return ar(a.sid,s)[1]!==0||a.name==="Unloaded"?e.refreshCachedChVoice(f):a}else return e.refreshCachedChVoice(f)}getChPrimitive(f,e,a){return this.device.getChPrimitive(f,e,a)}getChPrimitives(f,e){return this.device.getChPrimitives(f,e)}getMapped(f){var e;return((e=r(this,st)[f])==null?void 0:e.name)||f}getEfx(f){let[e,a]=f,s=e<<8|a;return r(this,Vt)[s]||`0x${s.toString(16).padStart(4,"0")}`}getVoxBm(f,e=this.BM_UNIVERSAL){var l,u;if(!f)throw new Error("Voice object must be valid");let a=this;if(!a.voxBm)throw new Error("Voice bitmap repository isn't yet initialized");let s=a.voxBm.getBm(f.name);if(!s){switch(f.mode){case"xg":{switch(f.sid[0]){case 0:case 80:case 81:case 83:case 84:case 96:case 97:case 99:case 100:{s=a.voxBm.getBm(a.getVoice(Be.bank0,f.sid[1],Be.bank0,f.mode).name);break}}break}case"g2":case"sd":{switch(f.sid[0]){case 96:case 97:case 98:case 99:{s=a.voxBm.getBm(a.getVoice(Be.bank0,f.sid[1],Be.bank0,f.mode).name);break}case 104:case 105:case 106:case 107:{s=a.voxBm.getBm(a.getVoice(120,f.sid[1],Be.bank0,f.mode).name);break}}break}case"gs":case"sc":case"k11":case"sg":case"gm":{switch(f.sid[0]){case 120:break;case 122:case 127:{s=a.voxBm.getBm(a.getVoice(120,f.sid[1],0,f.mode).name);break}default:s=a.voxBm.getBm(a.getVoice(0,f.sid[1],0,f.mode).name)}break}case"05rw":case"x5d":case"ns5r":{switch(f.sid[0]){case 56:{s=a.voxBm.getBm(a.getVoice(0,f.sid[1],0,"gm").name);break}}break}default:}switch(e){case a.BM_UNIVERSAL:break;case a.BM_YAMAHA_MU:{let m=f.standard.toLowerCase();if(m!==f.mode&&lt.xg.has(m))switch(f.sid[0]>>4){case 2:{s=(l=a.sysBm)==null?void 0:l.getBm(`ext_${m}I`);break}case 3:{f.sid[0]===48&&(s=(u=a.sysBm)==null?void 0:u.getBm("boot_3"));break}case 6:{s=a.sysBm.getBm(`ext_${m}P`);break}default:{s=a.sysBm.getBm(`ext_${m}`);break}}else["es"].indexOf(m)>-1?s=a.sysBm.getBm("boot_3"):m==="kr"&&(s=a.sysBm.getBm("st_korg"));break}}}return s||(s=a.voxBm.getBm(a.getVoice(f.sid[0],f.sid[1],0,f.mode).name)),s}getChBm(f,e=this.BM_UNIVERSAL,a){var m,y;let s=this;a=a!=null?a:s.getChVoice(f);let l=s==null?void 0:s.device.getChType(f),u;switch(e){case s.BM_UNIVERSAL:break;case s.BM_YAMAHA_MU:{let w=a.standard.toLowerCase();if(w!==a.mode&&lt.xg.has(w))switch(a.sid[0]>>4){case 1:{a.sid[0]===16&&(u=s.sysBm.getBm("cat_svox"));break}case 2:{u=(m=s.sysBm)==null?void 0:m.getBm(`ext_${w}I`);break}case 3:{a.sid[0]===48&&(u=(y=s.sysBm)==null?void 0:y.getBm("boot_3"));break}case 6:{u=s.sysBm.getBm(`ext_${w}P`);break}default:{u=s.sysBm.getBm(`ext_${w}`);break}}else if(["es"].indexOf(w)>-1)u=s.sysBm.getBm("boot_3");else if(w==="kr")u=s.sysBm.getBm("st_korg");else if(w==="xg")switch(a.sid[0]){case 126:{a.sid[1]>>2===28&&(u=s.sysBm.getBm("cat_smpl"));break}}if(!u&&l)switch(a.ending){case"!":case"?":case"*":{u=s.sysBm.getBm(l>1&&l<6?`cat_dS${l-1}`:"cat_drS");break}default:u=s.sysBm.getBm(l>1&&l<10?`cat_dr${l-1}`:"cat_drm")}break}}if(u=u||s.getVoxBm(a,e),!u){if(!s.sysBm)return;switch(a.mode){case"xg":{switch(a.sid[0]){case 126:{a.sid[1]>>2===28&&(u=s.sysBm.getBm("cat_smpl"));break}case 16:{u=s.sysBm.getBm("cat_smpl");break}case 64:case 67:{u=s.sysBm.getBm("cat_sfx");break}case 32:case 33:case 34:case 35:case 36:case 48:case 82:{u=s.sysBm.getBm("cat_xg");break}}break}default:switch(a.sid[0]){case 63:case 32:case 33:case 34:case 35:case 36:case 48:case 82:{u=s.sysBm.getBm("cat_mex");break}}}}if(u)switch(a.ending){case"!":case"?":case"*":{u=s.sysBm.getBm(l?"cat_drS":"no_vox");break}}else l?u=s.sysBm.getBm("cat_drS"):u=s.sysBm.getBm("no_vox");return u}getChBmState(f,e=1){let a=this,s=Math.floor(r(a,Ye)*1e3)-a.getChLastNoteExhausted(f);return a.getChLastNoteExhausted(f)<=0?0:s<a.msActive?(e-=1,e<1?0:Math.floor(s/a.msFrame)%e+1):0}detachState(f){let e=this;if(e.dState){let a=e.dState;switch(f){case"mu":{e.removeEventListener("mode",a.muModeFunc),delete a.muModeFunc,delete a.muModeBm,delete a.muUnresolvedEx,delete a.muUseVoiceBm,delete a.muTempWindow,delete a.muBlinkSpeedMode,delete a.muBmex,delete a.muBmst,delete a.isMu;break}}return!0}else return!1}attachState(f){var l;let e=this;e.dState=(l=e.dState)!=null?l:{};let a=e.dState,s=!1;switch(f){case"mu":{a.isMu=!0,a.muBmst=0,a.muBmex=0,a.muBlinkSpeedMode=400,a.muTempWindow=new Uint8Array(256),a.muUseVoiceBm=!0,a.muUnresolvedEx=0,a.muModeFunc=function(u){let m=e.sysBm.getBm(`st_${{gm:"gm1",g2:"gm2","?":"gm1",ns5r:"korg",ag10:"korg",x5d:"korg","05rw":"korg",krs:"korg",sg:"gm1",k11:"gm1",sd:"gm2",sc:"gs"}[u.data]||u.data}`);m&&(a.muModeBm=m.getFrame(0)),a.muBmst=2,a.muBmex=e.clockSource.now()+a.muBlinkSpeedMode*4},e.addEventListener("mode",a.muModeFunc);break}default:s=!0}return!s}muWriteBm(f,e,a){var k,t;if((f==null?void 0:f.BYTES_PER_ELEMENT)!==1)throw new TypeError("Buffer must be Uint8Array.");let s=this,l=f.length>>8||1;if(!s.dState.isMu)throw new Error("Device state for MU is not yet attached.");let u=s.clockSource.now(),m=(k=s.device)==null?void 0:k.getBitmap(),y=s.dState.muTempWindow,w=!1,$=!1;if(u<m.expire)m.bitmap.length<=256?(y=m.bitmap,w=!0):(f.set(m.bitmap.subarray(0,f.length)),$=!0);else if(u<s.dState.muBmex){if(s.dState.muBmst===2){w=!0;let n=Math.floor((s.dState.muBmex-u)/s.dState.muBlinkSpeedMode)&1;s.dState.muModeBm?(t=s.dState.muModeBm)==null||t.forEach((d,i)=>{y[i]=n===d}):y.fill(n?0:1)}}else if(s.dState.muUseVoiceBm){w=!0,s.dState.muBmst=0;let n=s.getChBm(e,s.BM_YAMAHA_MU,a),d=s.getChBmState(e,(n==null?void 0:n.frames)||1);n&&y.set(n.getFrame(d))}if(w){let n=0;for(let d=0;d<y.length;d++){let i=y[d];f[n]=i?255:0,l===2&&(f[n+1]=i?255:0),n+=l}}return w||$}getProps(f){let e=this,a,s,l=0,u=f;for(;l<8&&a==null&&(!(s!=null&&s.constructor)||s instanceof Array&&(s[1]!==f.eid[1]||s[2]!==f.eid[2]));)s=f.eid,typeof f.voice=="string"&&(r(e,Ke).has(f.voice)?a=r(e,Ke).get(f.voice):f=e.getVoice(s[0],s[2]===0?0:s[1],s[2]===0?0:s[2]-1));return!a&&l===8&&console.info(`Voice property fetching failed for "${f.name}" (${f.eid.join(" ")}).`),a}get noteProgress(){return r(this,Ye)/r(this,it)}get noteOverall(){return(this.noteProgress-r(this,Ve))*r(this,de)/4}get noteBar(){return Math.floor(this.noteOverall/r(this,Se))}get noteBeat(){let f=this.noteOverall%r(this,Se);return f<0&&(f+=r(this,Se)),f}get noteOffset(){return r(this,Ve)}getTimeSig(){return[r(this,Se),r(this,de)]}getTempo(){return r(this,nt)}getPool(){return r(this,rt)}getChCachedVoiceRaw(f){return r(this,Xe)[f]}getChLastNoteAt(f){return r(this,Ft)[f]}getChLastNoteExhausted(f){return r(this,Mt)[f]}eachVoice(f,e=!1){var s;let a=this;for(let l=0;l<r(a,Xe).length;l++)(e||(s=a.device)!=null&&s.getChActive(l))&&f(r(a,Xe)[l],l,r(a,Xe))}sendCmd(f){this.device.runJson(f)}render(f){var c,o,h;f>r(this,Ye)&&M(this,Ye,f);let e=((c=r(this,rt))==null?void 0:c.step(f))||[],a=0,s=0,l=new Set,u={},m=[],y=this,w=[];for(y.device.getStrength().forEach((b,p)=>{r(y,ia)[p]=b}),y.device.newStrength(),e.forEach(function(b){let p=b.data,C=y.device.runJson(p);switch(C==null?void 0:C.reply){case"meta":{w.push(C);break}}C!=null&&C.reply&&delete C.reply});r(y,Xt).length>0;){let b=r(y,Xt).shift(),p=b.part<<7|b.note;b.state?(l.add(p),u[p]=b.velo):l.has(p)&&(m.push({part:b.part,note:b.note,velo:u[p],state:y.device.NOTE_SUSTAIN}),a++,s+=r(y,ot)[b.part])}(w==null?void 0:w.length)>0&&y.dispatchEvent("meta",w);let $=[],k=[],t=y.device.getStrength();t.forEach(function(b,p,C){C[p]=Math.max(r(y,ia)[p],b);let v=C[p]-r(y,Tt)[p];if(v>=0){let I=4*.25**(y.device.getChCc(p,73)/64);r(y,Tt)[p]+=Math.ceil(v-v*y.smoothAttack**I)}else{let I=4*.25**(y.device.getChCc(p,72)/64);r(y,Tt)[p]+=Math.floor(v-v*y.smoothDecay**I)}});let n=0,d=0;return(h=(o=y.device)==null?void 0:o.getActive())==null||h.forEach(function(b,p){b&&($[p]=y.device.getVel(p),k[p]=y.device.getExt(p),n+=$[p].size,d+=$[p].size*r(y,ot)[p])}),{extraPoly:a,extraPolyEC:s,extraNotes:m,curPoly:n,curPolyEC:d,chKeyPr:$,chExt:k,eventCount:e.length,title:r(y,$e),texts:y.device.getTexts(),master:y.device.getMaster(),mode:y.device.getMode(),strength:r(y,Tt),velo:t,rpn:y.device.getRpn(),tSig:y.getTimeSig(),tempo:y.getTempo(),noteBar:y.noteBar,noteBeat:y.noteBeat,ace:y.device.getAce(),rawVelo:y.device.getStrength(),rawStrength:y.device.getRawStrength(),rawPitch:y.device.getRawPitch(),efxSink:y.device.getEffectSink()}}},rt=new WeakMap,st=new WeakMap,Vt=new WeakMap,Ke=new WeakMap,$e=new WeakMap,xt=new WeakMap,Xt=new WeakMap,Tt=new WeakMap,ia=new WeakMap,Ft=new WeakMap,Mt=new WeakMap,it=new WeakMap,nt=new WeakMap,Se=new WeakMap,de=new WeakMap,Ve=new WeakMap,Ye=new WeakMap,Xe=new WeakMap,ot=new WeakMap,ct=new WeakMap,vr);export{Vi as RootDisplay,E as allocated,we as dnToPos};
