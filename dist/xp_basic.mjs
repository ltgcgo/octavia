var Ir=Object.create;var Ht=Object.defineProperty;var Br=Object.getOwnPropertyDescriptor;var Lr=Object.getOwnPropertyNames;var Ur=Object.getPrototypeOf,Nr=Object.prototype.hasOwnProperty;var Hr=(g,e,r)=>e in g?Ht(g,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):g[e]=r;var Jt=(g,e)=>()=>(g&&(e=g(g=0)),e);var _r=(g,e)=>()=>(e||g((e={exports:{}}).exports,e),e.exports);var Gr=(g,e,r,d)=>{if(e&&typeof e=="object"||typeof e=="function")for(let c of Lr(e))!Nr.call(g,c)&&c!==r&&Ht(g,c,{get:()=>e[c],enumerable:!(d=Br(e,c))||d.enumerable});return g};var Xr=(g,e,r)=>(r=g!=null?Ir(Ur(g)):{},Gr(e||!g||!g.__esModule?Ht(r,"default",{value:g,enumerable:!0}):r,g));var P=(g,e,r)=>(Hr(g,typeof e!="symbol"?e+"":e,r),r),jt=(g,e,r)=>{if(!e.has(g))throw TypeError("Cannot "+r)};var t=(g,e,r)=>(jt(g,e,"read from private field"),r?r.call(g):e.get(g)),S=(g,e,r)=>{if(e.has(g))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(g):e.set(g,r)},x=(g,e,r,d)=>(jt(g,e,"write to private field"),d?d.call(g,r):e.set(g,r),r);var er=Jt(()=>{"use strict";N();(function(){var g=function(C,E,a){var h,s;if(self.MessageEvent)switch(C){case"message":{s=new MessageEvent(C,{data:E,ports:a==null?void 0:a.ports}),Object.defineProperty(s,"source",{value:a==null?void 0:a.source});break}default:s=new Event(C)}else s=document.createEvent("Event"),s.initEvent(C,!1,!1),a&&C=="message"&&(s.data=E,a.source&&Object.defineProperty(s,"source",{value:a.source}),(h=a.ports)!=null&&h.length&&Object.defineProperty(s,"ports",{value:a.ports}));return s};self.BroadcastChannel?console.info("[Snowy] Snowy is disabled."):(console.info("[Snowy] Snowy is enabled. Path: ".concat(self.SNOWY_PATH||"/snowy.js")),r=[],d={},c=function(C){var E,a=this;if((this==null?void 0:this.constructor)!=c)throw new TypeError("Illegal constructor");r.push(this),(E=d[C])!=null&&E.constructor||(d[C]=[]),d[C].push(this);var h=Math.floor(Math.random()*281474976710656),s=[],i=0,n=[],o=!0,l=!1;Object.defineProperty(this,"id",{get:function(){return h}}),Object.defineProperty(this,"name",{value:C}),this.close=function(){var f,v=r.indexOf(a);v>-1?(e.postMessage({t:"d",c:C,i:h}),r.splice(v,1),(f=d[C])!=null&&f.constructor&&(v=d[C].indexOf(a),v>-1&&d[C].splice(v,1)),d[C].length||delete d[C],console.debug("[Snowy] BroadcastChannel closed."),l=!0):console.debug("[Snowy] BroadcastChannel already closed.")},this.postMessage=function(f){if(e){if(l)throw new Error("Channel already closed");e.postMessage({t:"m",c:C,i:h,m:i,d:f}),i++,i>4294967295&&(i=0)}else n.push(f),console.debug("[Snowy] Message is cached.")},this.flush=function(){if(e){if(o){for(e.postMessage({t:"r",c:C,i:h}),console.debug("[Snowy] ".concat(n.length," message(s) in cache."));n.length;){var f=n.shift();a.postMessage(f)}o=!1,console.debug("[Snowy] All cached messages are flushed away.")}}else throw new Error("Tried to flush when the ports are not ready")},this.receiveMessage=function(f){f.c==C?f.i!=h&&a.dispatchEvent(g("message",f.d,{source:a})):console.debug("[Snowy] Channel ID mismatch. Instance ".concat(h," receives from ").concat(C,", not ").concat(f.c,"."))};var u={};this.dispatchEvent=function(f){var v,y;if(Object.defineProperty(f,"target",{value:a}),Object.defineProperty(f,"currentTarget",{value:a}),(v=u[f.type])!=null&&v.length)for(var T=u[f.type],D=0;D<T.length;D++)((y=T[D])==null?void 0:y.constructor)==Function&&T[D].call(a,f);a["on".concat(f.type)]&&a["on".concat(f.type)].constructor==Function&&a["on".concat(f.type)].call(a,f)},this.addEventListener=function(f,v){var y;(y=u[f])!=null&&y.constructor||(u[f]=[]);var T=u[f].indexOf(v);T==-1&&u[f].push(v)},this.removeEventListener=function(f,v){var y,T;if((y=u[f])!=null&&y.length){var D=u[f].indexOf(v);D>-1&&u[f].splice(D,1)}!((T=u[f])!=null&&T.length)&&u[f].constructor&&delete u[f]}},self.BroadcastChannel=c,p=function(){if(e){e.addEventListener("message",function(E){var a=E.data,h=!1;switch(a.t){case"k":{h=!1,e.postMessage({t:"k"});break}case"m":{var s=d[a.c];if(s!=null&&s.length)for(var i=0;i<s.length;i++)s[i].receiveMessage(a);break}case"c":{for(var n=[],o=0;o<r.length;o++){var l=r[o].name;n.indexOf(l)<0&&n.push(l)}e.postMessage({t:"k",c:n});break}default:h=!0}h&&console.info("ReceiveBroadcast",a)});for(var C=0;C<r.length;C++)r[C].flush()}else throw new Error("Message port isn't yet ready");console.info("[Snowy] Snowy is active.")},m=function(){if(!e){var C=new SharedWorker(self.SNOWY_PATH||"/snowy.js");C.port.start();var E=function(a){a.data.t=="swc"&&(C.port.removeEventListener("message",E),e=C.port,e.postMessage({t:"k"}),p())};C.port.addEventListener("message",E)}},m());var e,r,d,c,p,m})()});var N=Jt(()=>{"use strict";er();{let g=function(e,r){let d=new FileReader;return new Promise((c,p)=>{switch(d.addEventListener("abort",()=>{p(new Error("Blob read aborted"))}),d.addEventListener("error",m=>{p(d.error||m.data||new Error("Blob read error"))}),d.addEventListener("load",()=>{c(d.result)}),r.toLowerCase()){case"arraybuffer":case"buffer":{d.readAsArrayBuffer(e);break}case"string":case"text":{d.readAsText(e);break}default:p(new Error(`Unknown target ${r}`))}})};Blob.prototype.arrayBuffer=Blob.prototype.arrayBuffer||function(){return g(this,"buffer")},Blob.prototype.text=Blob.prototype.text||function(){return g(this,"text")}}String.prototype.replaceAll=String.prototype.replaceAll||function(g,e){let r=0,d=16,c=this,p=[];for(;r<d&&c.lastIndexOf(g)>-1;){let m=c.lastIndexOf(g);p.unshift(c.slice(m+g.length)),c=c.slice(0,m),m==0&&p.unshift(""),r++}return c.length&&p.unshift(c),p.join(e)||""},String.prototype.padStart=String.prototype.padStart||function(g,e){if(e){let r=this;for(;r.length<g;)r=`${e}${r}`;return r}},String.prototype.padEnd=String.prototype.padEnd||function(g,e){if(e){let r=this;for(;r.length<g;)r+=e;return r}}});var Tr=_r((Za,Wt)=>{N();(function(){"use strict";let g={fatal:!0},e=[new TextDecoder("iso-8859-15",g),new TextDecoder("sjis",g),new TextDecoder("euc-jp",g),new TextDecoder("utf-8",g),new TextDecoder("utf-16",g),new TextDecoder("ascii")],r={debug:!1,parse:function(d,c){if(d instanceof Uint8Array)return r.Uint8(d);if(typeof d=="string")return r.Base64(d);if(d instanceof HTMLElement&&d.type==="file")return r.addListener(d,c);throw new Error("MidiParser.parse() : Invalid input provided")},addListener:function(d,c){if(!File||!FileReader)throw new Error("The File|FileReader APIs are not supported in this browser. Use instead MidiParser.Base64() or MidiParser.Uint8()");if(d===void 0||!(d instanceof HTMLElement)||d.tagName!=="INPUT"||d.type.toLowerCase()!=="file")return console.warn("MidiParser.addListener() : Provided element is not a valid FILE INPUT element"),!1;c=c||function(){},d.addEventListener("change",function(p){if(!p.target.files.length)return!1;console.log("MidiParser.addListener() : File detected in INPUT ELEMENT processing data..");let m=new FileReader;m.readAsArrayBuffer(p.target.files[0]),m.onload=function(C){c(r.Uint8(new Uint8Array(C.target.result)))}})},Base64:function(d){let c=function(C){var E="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";if(C=C.replace(/^.*?base64,/,""),C=String(C).replace(/[\t\n\f\r ]+/g,""),!/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/.test(C))throw new TypeError("Failed to execute _atob() : The string to be decoded is not correctly encoded.");C+="==".slice(2-(3&C.length));let a,h="",s,i,n=0;for(;n<C.length;)a=E.indexOf(C.charAt(n++))<<18|E.indexOf(C.charAt(n++))<<12|(s=E.indexOf(C.charAt(n++)))<<6|(i=E.indexOf(C.charAt(n++))),h+=s===64?String.fromCharCode(a>>16&255):i===64?String.fromCharCode(a>>16&255,a>>8&255):String.fromCharCode(a>>16&255,a>>8&255,255&a);return h}(d=String(d));var p=c.length;let m=new Uint8Array(new ArrayBuffer(p));for(let C=0;C<p;C++)m[C]=c.charCodeAt(C);return r.Uint8(m)},Uint8:function(m){let c={data:null,pointer:0,movePointer:function(s){return this.pointer+=s,this.pointer},readInt:function(s){if((s=Math.min(s,this.data.byteLength-this.pointer))<1)return-1;let i=0;if(1<s)for(let n=1;n<=s-1;n++)i+=this.data.getUint8(this.pointer)*Math.pow(256,s-n),this.pointer++;return i+=this.data.getUint8(this.pointer),this.pointer++,i},readStr:function(s){let i=new Uint8Array(s),n=!1,o;i.forEach((l,u)=>{i[u]=this.readInt(1)});for(let l=0;l<e.length;l++)if(!n)try{if(o=e[l].decode(i),l==0)for(let u=0;u<o.length;u++){let f=o.charCodeAt(u);if(f>191||f>127&&f<160)throw new RangeError(`Invalid code point: ${f}`)}n=!0,console.debug(`String byte sequence in ${e[l].encoding}`)}catch(u){console.debug(`SMF string ${u}`)}return o||"String byte sequence read failed."},backOne:function(){this.pointer--},readIntVLV:function(){let s=0;if(this.pointer>=this.data.byteLength)return-1;if(this.data.getUint8(this.pointer)<128)s=this.readInt(1);else{let n=[];for(;128<=this.data.getUint8(this.pointer);)n.push(this.readInt(1)-128);var i=this.readInt(1);for(let o=1;o<=n.length;o++)s+=n[n.length-o]*Math.pow(128,o);s+=i}return s}};if(c.data=new DataView(m.buffer,m.byteOffset,m.byteLength),c.readInt(4)!==1297377380)return console.warn("Header validation failed (not MIDI standard or file corrupt.)"),!1;c.readInt(4);let p={};p.formatType=c.readInt(2),p.tracks=c.readInt(2),p.track=[];var m=c.readInt(1),C=c.readInt(1);128<=m?(p.timeDivision=[],p.timeDivision[0]=m-128,p.timeDivision[1]=C):p.timeDivision=256*m+C;for(let s=1;s<=p.tracks;s++){p.track[s-1]={event:[]};var E,a=c.readInt(4);if(a===-1)break;if(a!==1297379947)return!1;c.readInt(4);let i=0,n=!1,o,l;for(;!n&&(i++,p.track[s-1].event[i-1]={},p.track[s-1].event[i-1].deltaTime=c.readIntVLV(),(o=c.readInt(1))!==-1);)if(128<=o?l=o:(o=l,c.movePointer(-1)),o===255){p.track[s-1].event[i-1].type=255,p.track[s-1].event[i-1].metaType=c.readInt(1);var h=c.readIntVLV();switch(p.track[s-1].event[i-1].metaType){case 47:case-1:n=!0;break;case 1:case 2:case 3:case 4:case 5:case 7:case 6:p.track[s-1].event[i-1].data=c.readStr(h);break;case 33:case 89:case 81:p.track[s-1].event[i-1].data=c.readInt(h);break;case 84:p.track[s-1].event[i-1].data=[],p.track[s-1].event[i-1].data[0]=c.readInt(1),p.track[s-1].event[i-1].data[1]=c.readInt(1),p.track[s-1].event[i-1].data[2]=c.readInt(1),p.track[s-1].event[i-1].data[3]=c.readInt(1),p.track[s-1].event[i-1].data[4]=c.readInt(1);break;case 88:p.track[s-1].event[i-1].data=[],p.track[s-1].event[i-1].data[0]=c.readInt(1),p.track[s-1].event[i-1].data[1]=c.readInt(1),p.track[s-1].event[i-1].data[2]=c.readInt(1),p.track[s-1].event[i-1].data[3]=c.readInt(1);break;default:this.customInterpreter!==null&&(p.track[s-1].event[i-1].data=this.customInterpreter(p.track[s-1].event[i-1].metaType,c,h)),this.customInterpreter!==null&&p.track[s-1].event[i-1].data!==!1||(c.readInt(h),p.track[s-1].event[i-1].data=c.readInt(h),this.debug&&console.info("Unimplemented 0xFF meta event! data block readed as Integer"))}}else switch((o=o.toString(16).split(""))[1]||o.unshift("0"),p.track[s-1].event[i-1].type=parseInt(o[0],16),p.track[s-1].event[i-1].channel=parseInt(o[1],16),p.track[s-1].event[i-1].type){case 15:this.customInterpreter!==null&&(p.track[s-1].event[i-1].data=this.customInterpreter(p.track[s-1].event[i-1].type,c,!1)),this.customInterpreter!==null&&p.track[s-1].event[i-1].data!==!1||(E=c.readIntVLV(),p.track[s-1].event[i-1].data=c.readInt(E),this.debug&&console.info("Unimplemented 0xF exclusive events! data block readed as Integer"));break;case 10:case 11:case 14:case 8:case 9:p.track[s-1].event[i-1].data=[],p.track[s-1].event[i-1].data[0]=c.readInt(1),p.track[s-1].event[i-1].data[1]=c.readInt(1);break;case 12:case 13:p.track[s-1].event[i-1].data=c.readInt(1);break;case-1:n=!0;break;default:if(this.customInterpreter!==null&&(p.track[s-1].event[i-1].data=this.customInterpreter(p.track[s-1].event[i-1].metaType,c,!1)),this.customInterpreter===null||p.track[s-1].event[i-1].data===!1)return console.log("Unknown EVENT detected... reading cancelled!"),!1}}return p},customInterpreter:null};if(typeof Wt<"u")Wt.exports=r;else{let d=typeof window=="object"&&window.self===window&&window||typeof self=="object"&&self.self===self&&self||typeof global=="object"&&global.global===global&&global;d.MidiParser=r}})()});N();N();var ne,tr,Ot=(tr=class{constructor(){S(this,ne,{})}addEventListener(g,e){t(this,ne)[g]||(t(this,ne)[g]=[]),t(this,ne)[g].unshift(e)}removeEventListener(g,e){if(t(this,ne)[g]){let r=t(this,ne)[g].indexOf(e);r>-1&&t(this,ne)[g].splice(r,1),t(this,ne)[g].length<1&&delete t(this,ne)[g]}}dispatchEvent(g,e){var c;let r=new Event(g),d=this;r.data=e,((c=t(this,ne)[g])==null?void 0:c.length)>0&&t(this,ne)[g].forEach(function(p){try{p==null||p.call(d,r)}catch(m){console.error(m)}}),this[`on${g}`]&&this[`on${g}`](r)}},ne=new WeakMap,tr);N();N();var rr=function(g,e){let r=Math.min(g.length,e.length),d=g.slice(0,r),c=e.slice(0,r),p=0,m=0;for(;m<r&&p==0;)p=Math.sign(d[m]-c[m]),m++;return p},me=function(g=""){this.name=g,this.pool=[],this.point=function(e,r=!1){if(this.pool.length>0){let d=this.pool.length,c=1<<Math.floor(Math.log2(d)),p=c,m=64;for(;c>=1&&m>=0;){if(m<=0)throw new Error("TTL reached.");if(p==d)p-=c;else{let E=rr(e,this.pool[p]);switch(E){case 0:{m=0;break}case 1:{p+c<=d&&(p+=c);break}case-1:{p!=0&&(p-=c);break}default:console.warn(`Unexpected result ${E}.`)}}c=c>>1,m--}let C=!0;if(p>=this.pool.length)C=!1;else{let E=this;this.pool[p].forEach(function(a,h,s){C&&a!=e[h]&&(C=!1)}),!C&&rr(e,this.pool[p])>0&&p++}return C||r?p:-1}else return r?0:-1},this.add=function(e,r){return e.data=r,this.pool.splice(this.point(e,!0),0,e),this},this.default=function(e){console.warn(`No match in "${this.name||"(unknown)"}" for "${e}". Default action not defined.`)},this.get=function(e){let r=this.point(e);if(r>-1)return this.pool[r].data;this.default(e)},this.run=function(e,...r){let d=this.point(e);d>-1?e.subarray?this.pool[d].data(e.subarray(this.pool[d].length),...r):this.pool[d].data(e.slice(this.pool[d].length),...r):this.default(e,...r)}};N();var Vr=["MSB","PRG","LSB","NME","ELC","DRM","LVL"],Fr={krs:"KR",s90es:"ES",motif:"ES"},Kr={krs:"Kr",s90es:"SE",motif:"ME"},_t=function(g){let e=Math.floor(g/10),r=g%10;return`${e.toString(16)}${r}`},ee,ar,Gt=(ar=class{constructor(...g){S(this,ee,void 0);P(this,"strictMode",!1);this.loadFiles(...g)}get bankInfo(){return t(this,ee)}get(g=0,e=0,r=0,d,c=0){var T,D;let p=[g,e,r],m,C=1,E=0,a,h,s=Array.from(arguments);switch(d){case"xg":{switch(g){case 0:{r==126?s[2]=125:r==127&&(s[2]=0);break}case 16:{r==126&&(s[2]=0);break}case 32:{r>125&&(s[2]=0),s[2]+=4;break}case 33:{(r>125||r==3)&&(s[2]=0),s[2]+=5;break}case 34:case 35:case 36:{r>125&&(s[2]=0),s[2]+=5;break}case 79:case 80:case 81:case 82:case 83:case 84:s[0]+=16;case 95:case 96:case 97:case 98:case 99:case 100:{r==126&&(s[2]=0);break}case 48:case 64:case 126:case 127:{r==126&&(g==127&&e==0||(s[2]=0));break}}break}case"gs":case"sc":{g==0&&r<5?s[0]=49:g>125&&r<5&&r!=2&&(s[2]=g,s[0]=49);break}case"mt32":{g==0&&(s[0]=49);break}case"sd":{switch(g){case 121:{s[0]=96;break}case 120:{s[0]=104;break}}s[0]>>1==40?s[2]|=16:s[0]>95&&s[0]<100&&(s[2]|=16,e>>4==7&&(s[0]=96));break}case"g2":{g>>1==40?s[2]|=16:g>95&&g<100&&(s[2]|=16,e>>4==7&&(s[0]=96));break}case"sg":{g==8&&r==0&&(s[2]=5);break}case"05rw":case"x5d":{g&&g<56&&(s[0]=56);break}case"s90es":{if(g==0)break;r<8?s[2]+=17:r<32?s[2]+=13:s[2]=(s[2]>>3)+19;break}case"motif":{if(g==0)break;r<8?s[2]+=28:r<32?s[2]+=13:s[2]=(s[2]>>3)+19;break}}let i=" ",n="M",o="",l=0,u=0;switch(s[0]){case 0:{switch(s[2]){case 127:{n="GM-a";break}case 126:{n="GM-n";break}case 7:{n="GM-k",o="GLX";break}case 5:{n="SG-a",o="000";break}case 4:{d=="gs"||d=="sc"?(n="GM-a",o="000"):(n="SP-l",o="C/M");break}case 3:case 2:case 1:{(d=="gs"||d=="sc")&&(n="GM-a",o="000");break}case 0:{n="GM-a";break}default:n="y",l=3}break}case 8:{d=="sg"?n="GM-s":n="r:";break}case 32:case 33:case 34:case 35:case 36:{d=="xg"&&(n=`${["AP","VL","PF","DX","AN"][g&7]}-${"abcdefgh"[r]}`,l=3);break}case 48:{o=`M${(s[2]>>3).toString().padStart(2,"0")}`,n=`y${o}`,l=1;break}case 49:{s[2]>>1==63?(n=`MT-${"ba"[s[2]&1]}`,o=`C${"-/"[s[2]&1]}M`):(n="GM-a",o="000");break}case 56:{n="GM-b";break}case 57:n=["yDOC","QY10","QY20"][s[2]-112]||"yMxv",o=["DOC","QY1","QY2"][s[2]-112]||"057";case 61:case 120:{n="rDrm";break}case 62:{n="kDrm";break}case 63:{if(s[2]<17){let M=s[2];n=M<10?"kP:":"kC:",n+=M%10}else s[2]<34?n=["Pre1","Pre2","Pre3","Pre4","Usr1","Usr2","DrmP","DrmU","Plg1","Plg2","Plg3","Pre1","Pre2","Pre3","Pre4","Pre5","Pre6"][s[2]-17]:n="Ds";l=1;break}case 64:{n="ySFX",o="SFX";break}case 67:{n="DX:S";break}case 80:case 81:case 82:case 83:{n=`Prg${"UABC"[s[0]-80]}`;break}case 88:case 89:case 90:case 91:{n=`Cmb${"UABC"[s[0]-88]}`;break}case 95:{n=`${["DR","PC"][s[2]]}-d`;break}case 96:{n=s[2]==106?"AP-a":s[2]>>4==1?"SDg":"PF",s[2]>63?u=63:s[2]>>4==1&&(u=16),l=3;break}case 97:{n=s[2]>>4==1?"SDa":"VL:",l=3,s[2]>>4==1?u=16:u=112;break}case 98:{n=s[2]>>4==1?"SDb":"SG-a",l=3,u=16;break}case 99:{n=s[2]>>4==1?"SDc":"DX",s[2]>63?u=63:s[2]>>4==1&&(u=16),l=3;break}case 100:{n="AN",s[2]>63?u=63:s[2]>>4==1&&(u=16),l=3;break}case 104:case 105:case 106:case 107:{n="SDd",u=104;break}case 121:{n=`GM-${s[2]?"":"a"}`,l=3;break}case 122:{n="lDrm";break}case 126:{n="yDrS";break}case 127:{s[2]==127?n="rDrm":n="yDrm";break}default:s[0]<48?n="r:":n="M"}n.length<4&&(n+=`${[g,r,s[0],s[2]][l]-u}`.padStart(4-n.length,"0")),o.length<3&&(o+=`${[g,r,g,r][l]}`.padStart(3-o.length,"0")),d=="xg"&&(g==0?s[2]<100?n=n.replace("y0","y:"):s[2]==125&&(n="y126"):g==16?(m=`Voice${((s[2]<<7)+s[1]+1).toString().padStart(3,"0")}`,i=" "):g==35&&r>>1==2&&(m=`DXCH_${(((s[2]&1)<<7)+e+1).toString().padStart(3,"0")}`,i=" "));let f=[s[0],s[1],s[2]];for(;!((m==null?void 0:m.length)>=0);)if(m=(T=t(this,ee)[s[1]||0][(s[0]<<8)+s[2]])==null?void 0:T.name,m){let M=t(this,ee)[s[1]||0][(s[0]<<8)+s[2]];C=(M==null?void 0:M.poly)||C,E=(M==null?void 0:M.type)||E,a=M==null?void 0:M.drum,h=M==null?void 0:M.level}else if(this.strictMode)m="",i="?";else if(s[0]==0&&s[1]==0&&s[2]==0)m="Unloaded";else if(t(this,ee)[s[1]||0][s[0]<<8])s[0]==0?(s[2]=0,i="^"):s[2]<1?(s[0]=0,i="*"):(s[2]--,i="^");else if(g==48)s[0]=0,s[2]=0,i="!";else if(g==62)s[1]--,i=" ",s[1]<1&&!(m!=null&&m.length)&&(s[0]=0,i="!");else if(g<63)s[0]==0?(s[2]=0,i="^"):s[2]<1?(s[0]=0,i="*"):s[2]--;else if(g==80)m=`PrgU:${e.toString().padStart(3,"0")}`,i="!";else if(g==88)m=`CmbU:${e.toString().padStart(3,"0")}`,i="!";else if(g==121)m=`GM2Vox0${r}`,i="#";else if(g==122)if(s[1]==32?s[1]==0:s[1]%=7,m=(D=t(this,ee)[s[1]||0][(s[0]<<8)+s[2]])==null?void 0:D.name,m){i=" ";let M=t(this,ee)[s[1]||0][(s[0]<<8)+s[2]];C=(M==null?void 0:M.poly)||C,E=(M==null?void 0:M.type)||E,a=M==null?void 0:M.drum,h=M==null?void 0:M.level}else m="",i="*";else s[1]==0?(m=`${g.toString().padStart(3,"0")} ${e.toString().padStart(3,"0")} ${r.toString().padStart(3,"0")}`,i="!"):s[0]==0?(s[2]=0,i="^"):s[2]>0?s[2]--:s[1]>0?(s[1]=0,i="!"):(s[0]=0,i="?");let v=[s[0],s[1],s[2]];switch(i){case"^":{switch(d){case"gs":case"sc":case"ns5r":{i=" ";break}}g==127&&i=="^"&&(i=" ");break}}let y="??";switch(s[0]){case 0:{s[2]==0?y="GM":s[2]==5||s[2]==7?y="KG":s[2]<126&&(y="XG");break}case 32:case 33:case 35:case 36:{s[2]>4?y=["AP","VL","PF","DX","AN"][s[0]-32]:y="GS";break}case 48:{y="MU";break}case 49:{s[2]>>1==63?y="MT":s[2]<5&&(y="GM");break}case 56:{y="AG";break}case 61:case 80:case 83:case 88:case 89:case 91:{y="AI";break}case 62:case 82:case 90:{y="XD";break}case 63:{s[2]<17?y="KR":s[2]<34?y="ES":y="DS";break}case 64:case 126:{y="XG";break}case 67:case 99:{y=s[2]>>4==1?"SD":"DX";break}case 81:{y="RW";break}case 95:{y=["DR","PC"][s[2]];break}case 96:{y=s[2]==106?"AP":s[2]>>4==1?"SD":"PF";break}case 97:{y=s[2]>>4==1?"SD":"VL";break}case 98:{y=s[2]>>4==1?"SD":"SG";break}case 100:{y="AN";break}case 104:case 105:case 106:case 107:{y="SD";break}case 120:{y="GS";break}case 121:{y=s[2]?"G2":"GM";break}case 122:{y="KG";break}case 127:{y=s[2]==127?"MT":e==0?"GM":"XG";break}default:s[0]<48&&(s[0]==16&&d=="xg"?y="XG":y="GS")}if(i!=" ")switch(d){case"krs":case"s90es":case"motif":{m="",y=Fr[d];break}default:self.debugMode&&(m="")}return{name:m||`${Kr[d]||d.toUpperCase()}${_t(g||0)}${_t(e||0)}${_t(r||0)}`,poly:C,type:E,drum:a,level:h,iid:f,eid:v,sid:p,ending:i,sect:n,bank:o,standard:y,mode:d}}async load(g,e,r="(internal)",d){let c=this,p=[],m=0,C=0,E=0;g.split(`
`).forEach(function(a,h){var n;let s=a.split("	"),i=[];if(h==0){if(s.forEach(function(o,l){p[Vr.indexOf(o)]=l}),p.length<4){console.debug("Debugger launched.");debugger}}else{let o=0,l=0,u=0,f,v=1,y=0,T,D;s.forEach(function(V,Re){switch(Re){case p[0]:{o=parseInt(V);break}case p[1]:{l=parseInt(V);break}case p[2]:{u=parseInt(V);break}case p[3]:{f=V;break}case p[4]:{V=parseInt(V),V<16?v=V+1:(y=(V&15)+1,v=y);break}case p[5]:{D=V;break}case p[6]:{V!=null&&V.constructor&&(T=parseInt(V));break}}}),t(c,ee)[l]=t(c,ee)[l]||[];let M=t(c,ee)[l],I={msb:o,prg:l,lsb:u,name:f,poly:v,type:y,drum:D,level:T,priority:d},K=!1;d<((n=M[o<<8|u])==null?void 0:n.priority)&&(K=!0,E++),(!M[o<<8|u]||K||e)&&(M[o<<8|u]=I,m++),C++}}),e||console.debug(`Map "${r}": ${C} total, ${m} loaded (${m-E} + ${E}).`)}clearRange(g){let e=g.prg!=null?g.prg.constructor==Array?g.prg:[g.prg,g.prg]:[0,127],r=g.msb!=null?g.msb.constructor==Array?g.msb:[g.msb,g.msb]:[0,127],d=g.lsb!=null?g.lsb.constructor==Array?g.lsb:[g.lsb,g.lsb]:[0,127];for(let c=r[0];c<=r[1];c++){let p=c<<8;for(let m=d[0];m<=d[1];m++){let C=p+m;for(let E=e[0];E<=e[1];E++)delete t(this,ee)[E][C]}}}init(){x(this,ee,[]);for(let g=0;g<128;g++)t(this,ee).push([""])}async loadFiles(...g){this.init();let e=this;g.forEach(async function(r,d){try{e.load(await(await fetch(`./data/bank/${r}.tsv`)).text(),!1,r,d)}catch(c){console.error(`Failed loading "${r}.tsv".`)}})}},ee=new WeakMap,ar);N();N();var dt,sr,ir=(sr=class{constructor(){S(this,dt,{});P(this,"context")}set(g,e){t(this,dt)[g]=e}has(g){return!!t(this,dt)[g]}async read(g,e){if(!this.has(g))throw new Error(`No decoder registered for "${g}"`);return await t(this,dt)[g].call(this.context||this,e)}},dt=new WeakMap,sr);var zr=function(g,e){let r=!0;return e.forEach((d,c)=>{r=r&&g[c]==d}),r},yt=function(g){let e=0;return g.forEach(r=>{e*=256,e+=r}),e},ke=new TextDecoder,Ct=new ir;Ct.set("s7e",async function(g){let e=new Uint8Array(await g.slice(0,65536).arrayBuffer()),r="MSB	LSB	PRG	NME",d=[0,0,0,0],c=32,p=0,m=0,C=!0,E=[],a=0;for(;C;){let h=e.subarray(p);([()=>{ke.decode(h.subarray(0,4))=="YSFC"?(p+=80,m=1):p++},()=>{if(zr(h.subarray(0,4),d))E.forEach((s,i,n)=>{let o=yt(e.subarray(s.start+4,s.start+8));s.length=o}),m=2;else{let s=ke.decode(h.subarray(0,4)),i=yt(h.subarray(4,8));E.push({type:s,start:i}),p+=8}},()=>{let s=E[a],i=e.subarray(s.start,s.start+s.length),n=32;switch(s.type){case"ENVC":{let o=c;for(;o<i.length;){let l=i.subarray(o,o+n),u=ke.decode(l.subarray(0,10)).trimEnd();u.slice(0,5)=="Init "&&(u=""),u&&(r+=`
063	${(l[17]+13).toString().padStart(3,"0")}	${l[19].toString().padStart(3,"0")}	${u}`),o+=n}break}case"EDVC":{let o=c;for(;o<i.length;){let l=i.subarray(o,o+n),u=ke.decode(l.subarray(0,10)).trimEnd();u.slice(0,5)=="Init "&&(u=""),u&&(r+=`
063	024	${l[19].toString().padStart(3,"0")}	${u}`),o+=n}break}case"EPVC":{let o=32,l=c;for(;l<i.length;){let u=i.subarray(l,l+o),f=ke.decode(u.subarray(0,10)).trimEnd();f=="----------"&&(f=""),f&&(r+=`
063	${(u[17]+1).toString().padStart(3,"0")}	${u[19].toString().padStart(3,"0")}	${f}`),l+=o}break}}a++,a>=E.length&&(m=3,C=!1)}][m]||(()=>{C=!1}))()}return r});Ct.set("pcg",async function(g){let e=new Uint8Array(await g.arrayBuffer()),r="MSB	LSB	PRG	NME",d=100,c=0,p=0,m=!0,C=[],E=0;for(;m;){let a=e.subarray(d);([()=>{m=ke.decode(a.subarray(0,4))=="INI2",p=a[15],d+=16,c=1},()=>{let h=ke.decode(a.subarray(0,4)),s=a[5],i=a[7],n=a[11],o=yt(a.subarray(12,16)),l=yt(a.subarray(16,20)),u=yt(a.subarray(36,40)),f=ke.decode(a.subarray(44,44+n));C.push({type:h,tipMsb:s,tipLsb:i,nameLen:n,length:o,start:l,entryLen:u,name:f}),d+=64,p--,p<1&&(c=2)},()=>{let h=C[E],s=e.subarray(h.start,h.start+h.length);switch(h.type){case"PRG1":break;case"PBK1":{let i=63,n=(h.tipMsb?6:0)+h.tipLsb;for(let o=0;o<128;o++){let l=o*h.entryLen,u=s.subarray(l,l+h.entryLen),f=ke.decode(u.subarray(0,24)).trimEnd().replace("InitProg","");f.length&&n>5&&(r+=`
${i.toString().padStart(3,"0")}	${n.toString().padStart(3,"0")}	${o.toString().padStart(3,"0")}	${f}`)}break}case"CBK1":{let i=63,n=(h.tipMsb?3:0)+h.tipLsb+10;for(let o=0;o<128;o++){let l=o*h.entryLen,u=s.subarray(l,l+h.entryLen),f=ke.decode(u.subarray(0,24)).trimEnd().replace("InitCombi","");f.length&&n>12&&(r+=`
${i.toString().padStart(3,"0")}	${n.toString().padStart(3,"0")}	${o.toString().padStart(3,"0")}	${f}`)}break}}E++,E>=C.length&&(c=3,m=!1)}][c]||(()=>{m=!1}))()}return r});N();var wt=["off","hall","room","stage","plate","delay LCR","delay LR","echo","cross delay","early reflections","gate reverb","reverse gate"].concat(new Array(4),["white room","tunnel","canyon","basement","karaoke"],new Array(43),["pass through","chorus","celeste","flanger","symphonic","rotary speaker","tremelo","auto pan","phaser","distortion","overdrive","amplifier","3-band EQ","2-band EQ","auto wah"],new Array(1),["pitch change","harmonic","touch wah","compressor","noise gate","voice channel","2-way rotary speaker","ensemble detune","ambience"],new Array(4),["talking mod","Lo-Fi","dist + delay","comp + dist + delay","wah + dist + delay","V dist","dual rotor speaker"]),$t=["melodic","drums","drum set 1","drum set 2","drum set 3","drum set 4","drum set 5","drum set 6","drum set 7","drum set 8"],qr=[17.1,18.6,20.2,21.8,23.3,24.9,26.5,28,29.6,31.2,32.8,34.3,35.9,37.5,39,40.6,42.2,43.7,45.3,46.9,48.4,50],ht=[20,22,25,28,32,36,40,45,50,56,63,70,80,90,100,110,125,140,160,180,200,225,250,280,315,355,400,450,500,560,630,700,800,900,1e3,1100,1200,1400,1600,1800,2e3,2200,2500,2800,3200,3600,4e3,4500,5e3,5600,6300,7e3,8e3,9e3,1e4,11e3,12e3,14e3,16e3,18e3,2e4],nr=[0,.04,.08,.13,.17,.21,.25,.29,.34,.38,.42,.46,.51,.55,.59,.63,.67,.72,.76,.8,.84,.88,.93,.97,1.01,1.05,1.09,1.14,1.18,1.22,1.26,1.3,1.35,1.39,1.43,1.47,1.51,1.56,1.6,1.64,1.68,1.72,1.77,1.81,1.85,1.89,1.94,1.98,2.02,2.06,2.1,2.15,2.19,2.23,2.27,2.31,2.36,2.4,2.44,2.48,2.52,2.57,2.61,2.65,2.69,2.78,2.86,2.94,3.03,3.11,3.2,3.28,3.37,3.45,3.53,3.62,3.7,3.87,4.04,4.21,4,37,4.54,4.71,4.88,5.05,5.22,5.38,5.55,5.72,6.06,6.39,6.73,7.07,7.4,7.74,8.08,8.41,8.75,9.08,9.42,9.76,10.1,10.8,11.4,12.1,12.8,13.5,14.1,14.8,15.5,16.2,16.8,17.5,18.2,19.5,20.9,22.2,23.6,24.9,26.2,27.6,28.9,30.3,31.6,33,34.3,37,39.7],cr=function(g){let e=.1,r=-.3;return g>66?(e=5,r=315):g>56?(e=1,r=47):g>46&&(e=.5,r=18.5),e*g-r},or=function(g){return g>105?qr[g-106]:g>100?g*1.1-100:g/10},lr=",a,i,u,e,o,ka,ki,ku,ke,ko,ky,kw,sa,si,su,se,so,sh,ta,ti,tu,te,to,t,ch,t,s,na,ni,nu,ne,no,ny,nn,ha,hi,hu,he,ho,hy,fa,fi,fu,fe,fo,ma,mi,mu,me,mo,my,mm,ya,yu,ye,yo,ra,ri,ru,re,ro,ry,wa,wi,we,wo,ga,gi,gu,ge,go,gy,gw,za,zi,zu,ze,zo,ja,ji,ju,je,jo,jy,da,di,du,de,do,dy,ba,bi,bu,be,bo,by,va,vi,vu,ve,vo,pa,pi,pu,pe,po,py,nga,ngi,ngu,nge,ngo,ngy,ng,hha,hhi,hhu,hhe,hho,hhy,hhw,*,_,,,~,.".split(","),Xt={};`hi*,
ka,ã‹
ki,ã
ku,ã
ke,ã‘
ko,ã“
ky,ã!
kw,ãl
tsu,ã¤
ts,ã¤l
sa,ã•
si,ã™ãƒ
su,ã™
se,ã›
so,ã
shi,ã—
sh,ã—!
ta,ãŸ
ti,ã¦ãƒ
tu,ã¨ã…
te,ã¦
to,ã¨
tchy,ã¡!
tchi,ã¡
na,ãª
ni,ã«
nu,ã¬
ne,ã­
no,ã®
ny,ã«!
nn,ã‚“
ha,ã¯
hi,ã²
hu,ã»ã…
he,ã¸
ho,ã»
hy,ã²!
fa,ãµã
fi,ãµãƒ
fu,ãµ
fe,ãµã‡
fo,ãµã‰
ma,ã¾
mi,ã¿
mu,ã‚€
me,ã‚
mo,ã‚‚
my,ã¿!
mm,ã‡º
ra,ã‚‰
ri,ã‚Š
ru,ã‚‹
re,ã‚Œ
ro,ã‚
ry,ã‚Š!
wa,ã‚
wi,ã‚
we,ã‚‘
wo,ã‚’
nga,ã‹ã‚š
ngi,ãã‚š
ngu,ãã‚š
nge,ã‘ã‚š
ngo,ã“ã‚š
ngy,ãã‚š!
ng,ãƒ³
ga,ãŒ
gi,ãŽ
gu,ã
ge,ã’
go,ã”
gy,ãŽ!
gw,ãl
za,ã–
zi,ãšãƒ
zu,ãš
ze,ãœ
zo,ãž
ja,ã˜ã‚ƒ
ji,ã˜
ju,ã˜ã‚…
je,ã˜ã‡
jo,ã˜ã‚‡
jy,ã˜!
da,ã 
di,ã§ãƒ
du,ã©ã…
de,ã§
do,ã©
dy,ã§!
ba,ã°
bi,ã³
bu,ã¶
be,ã¹
bo,ã¼
by,ã³!
va,ã‚”ã
vi,ã‚”ãƒ
vu,ã‚”
ve,ã‚”ã‡
vo,ã‚”ã‰
pa,ã±
pi,ã´
pu,ã·
pe,ãƒš
po,ã½
py,ã´!
!ya,ã‚ƒ
!yu,ã‚…
!ye,ã‡
!yo,ã‚‡
ya,ã‚„
yu,ã‚†
ye,ð›€
yo,ã‚ˆ
!a,ã‚ƒ
!u,ã‚…
!e,ã‡
!o,ã‚‡
!a,ã‚ƒ
!u,ã‚…
!e,ã‡
!o,ã‚‡
la,ã
li,ãƒ
lu,ã…
le,ã‡
lo,ã‰
a,ã‚
i,ã„
u,ã†
e,ãˆ
o,ãŠ
*,ã£
~,
^,
_,`.split(`
`).forEach(g=>{let e=g.split(",");Xt[e[0]]=e[1]});var dr=function(g){let e=g;g[0]=="*"&&(e=e.slice(1)),["aa","ii","uu","ee","oo"].forEach(d=>{for(;e.indexOf(d)>-1;)e=e.replace(d,d[0])});for(let d in Xt)e=e.replaceAll(d,Xt[d]);e.indexOf("ã‚“")==0&&e.length>1&&(e=e.slice(1));let r=e.indexOf("!");return r>-1&&e.length>1&&(e=e.slice(r+1)),e},hr=function(g){return g?g<96?`cc${g}`:["aftertouch","velocity","pitch bend"][g-96]:"off"};N();var Vt=["room 1","room 2","room 3","hall 1","hall 2","plate","delay","panning delay"],fr=["chorus 1","chorus 2","chorus 3","chorus 4","feedback","flanger","short delay","short delay feedback"],ur=["delay 1","delay 2","delay 3","delay 4","pan delay 1","pan delay 2","pan delay 3","pan delay 4","delay to reverb","pan repeat"];var Wr={0:"thru",256:"stereo EQ",257:"spectrum",258:"enhancer",259:"humanizer",272:"overdrive",273:"distortion",288:"phaser",289:"auto wah",290:"rotary",291:"stereo flanger",292:"step flanger",293:"tremelo",294:"auto pan",304:"compressor",305:"limiter",320:"hexa chorus",321:"tremelo chorus",322:"stereo chorus",323:"space D",324:"3D chorus",336:"stereo delay",337:"modulated delay",338:"3-tap delay",339:"4-tap delay",340:"tremelo control delay",341:"reverb",342:"gate reverb",343:"3D delay",352:"2-pitch shifter",353:"feedback pitch shifter",368:"3D auto",369:"3D manual",370:"Lo-Fi 1",371:"Lo-Fi 2",512:"overdrive - chorus",513:"overdrive - flanger",514:"overdrive - delay",515:"distortion - chorus",516:"distortion - flanger",517:"distortion - delay",518:"enhancer - chorus",519:"enhancer - flanger",520:"enhancer - delay",521:"chorus - delay",522:"flanger - delay",523:"chorus - flanger",524:"rotary multi",1024:"guitar multi 1",1025:"guitar multi 2",1026:"guitar multi 3",1027:"clean guitar multi 1",1028:"clean guitar multi 2",1029:"bass multi",1030:"rhodes multi",1280:"keyboard multi",4352:"chorus / delay",4353:"flanger / delay",4354:"chorus / flanger",4355:"overdrive / distortion",4356:"overdrive / rotary",4357:"overdrive / phaser",4358:"overdrive / auto wah",4359:"phaser / rotary",4360:"phaser / auto wah"},Qr={66307:["drive"],66309:["vowel",g=>"aiueo"[g]],94723:["pre-filter"],94724:["Lo-Fi type"],94725:["post-filter"],94979:["Lo-Fi type"],94980:["fill type",g=>["off","LPF","HPF"][g]],94984:["noise type",g=>["white","pink"][g]],94987:["disc type",g=>["LP","SP","EP","RND"]],94990:["hum type",g=>`${g+5}0Hz`],94993:["M/S",g=>["mono","stereo"][g]]},Ft=function(g){return Wr[(g[0]-32<<8)+g[1]]||`0x${g[0].toString(16).padStart(2,"0")}${g[1].toString(16).padStart(2,"0")}`},pr=function(g,e,r){let d=(g[0]-32<<16)+(g[1]<<8)+e,c=Qr[d]||{},p=c[0];if(p!=null&&p.length)return p+=`: ${(c[1]||function(){})(r)||r}`,p},Kt=[68,48,95,78,41,3,110,122,0];N();var ce=function(g=64){return Math.round(2e3*Math.log10(g/64))/100},gr=function(g,e,r){let d=[],c=r==!1?e.readIntVLV():r;g==0||g==127;for(let p=0;p<c;p++){let m=e.readInt(1);if(d.push(m),m!=247){if(m!=240){if(m>127)return console.debug(`Early termination: ${d}`),d.pop(),e.backOne(),e.backOne(),new Uint8Array(d)}}}return new Uint8Array(d)},Le=function(g){let e=0;return g.forEach(r=>{e+=r,e=e&127}),~e+1&127},ve=function(g,e){let r=0,d=0;for(let c=0;c<g.length;c++){let p=c%8-1,m=(d>>p&1)<<7,C=g[c];C+=m,c%8!=0?(e(C,r,g),r++):d=g[c]}};var kt=function(g){let e=Math.floor(g*14.2);return e<128?e:0},O=function(){return!!self.Bun||self.debugMode||!1};var z=["?","gm","gs","sc","xg","g2","mt32","doc","qy10","qy20","ns5r","x5d","05rw","k11","sg","sd","pa","krs","s90es","motif","trin"],Yr={gm2:"g2","mt-32":"mt32","c/m":"mt32",ag10:"05rw","ag-10":"05rw","05r/w":"05rw",x5:"05rw",x5dr:"x5d",gmega:"k11","kross 2":"krs","motif es":"motif","s90 es":"s90es",trinity:"trin","tr-rack":"trin"},Zr=["melodic","drum","menu"],br={"?":[0,0,120,0,0],gm:[0,0,127,0,0],gs:[0,0,120,0,0],sc:[0,0,120,0,0],xg:[0,0,127,0,0],g2:[0,0,120,0,0],mt32:[0,127,127,0,127],doc:[57,112,127,57,112],qy10:[57,113,127,57,113],qy20:[57,114,127,57,114],ns5r:[0,0,61,0,0],x5d:[82,0,62,56,0],"05rw":[81,0,62,56,0],k11:[0,0,122,0,0],sg:[0,0,122,0,0],sd:[97,0,105,0,0],krs:[121,0,120,0,0],s90es:[0,0,127,0,0],motif:[0,0,127,0,0],trin:[0,0,127,0,0]},Jr=[9,25,41,57,73,89,105,121],jr=[0,3,81,84,88],mr={8:"Off",9:"On",10:"Note aftertouch",11:"cc",12:"pc",13:"Channel aftertouch",14:"Pitch"},vr={0:0,1:1,2:3,5:4},Er={0:0,1:1,2:2,5:3},yr=[[0,24],[0,127],[0,127],[40,88],[0,127],[0,127]],qt=[36,37,48,49,52,53],Ut=[20,21,22,23,24,25,26,28,29,30,31,36,37,48,49,52,53,64,65],Cr={26:127,29:0,30:0,31:0,52:12,53:54},ze=[0,1,2,4,5,6,7,8,10,11,32,38,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,84,91,92,93,94,95,98,99,100,101,128,12,13,16,17,18,19,14,15,20,21,26,28,22,80,81,82,83,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157],ea=[2,4,12,13,14,15,16,17,18,19,20,21,80,81,83,136,130,131,132,133,134,135,137,138,139,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157],ta=[33,102,99,32,100,8,9,10],wr=[0,16,25,40,32,64,24,48],k={};z.forEach((g,e)=>{k[g]=e});var $={length:ze.length};ze.forEach((g,e)=>{$[g]=e});var ge={length:Ut.length};Ut.forEach((g,e)=>{ge[g]=e});var ra={};Zr.forEach((g,e)=>{ra[g]=e});var aa=function(g){let e=[],r=0;return g==null||g.forEach(function(d,c){d==247?e.push(g.subarray(r,c)):d==240&&(r=c+1)}),e.length||e.push(g.subarray(0)),O()&&console.debug(e),e};var zt=8,b={port:zt,ch:zt<<4,chShift:Math.ceil(Math.log2(zt))+4,cc:ze.length,nn:128,pl:512,tr:256,cmt:14,rpn:6,rpnt:4,nrpn:qt.length,ace:8,drm:8,dpn:Ut.length,dnc:128,ext:3,efx:7,cvn:12,redir:32,vxPrim:3,invalidCh:255};b.chcc=b.cc*b.ch;var $e={bank0:128},H=new Uint16Array(b.ch),It=new Uint16Array(b.ch),sa=new Uint16Array(b.ch),ia=new Uint16Array(b.ch),xr=new Uint16Array(b.ch),$r=new Array(b.drm);for(let g=0;g<b.ch;g++)H[g]=g*b.cc,It[g]=g*b.rpn,sa[g]=g*b.nrpn,ia[g]=g*b.ace,xr[g]=g*b.ext;for(let g=0;g<b.drm;g++){$r[g]=new Uint16Array(b.dpn);let e=g*b.dpn*b.dnc;for(let r=0;r<b.dpn;r++)$r[g][r]=e+r*b.dnc}var _,te,Ee,Ae,pe,De,Sr,oe,Y,R,w,re,B,Z,le,J,j,Oe,xe,qe,de,A,U,ft,ie,ye,he,ut,We,q,Qe,Ce,xt,Ue,we,pt,Ne,W,L,Se,St,X,Ye,gt,bt,He,_e,Tt,mt,Te,F,Bt,Mt,Ze,fe,Ie,Ge,ae,Je,Q,Pt,Lt,je,et,ue,be,Me,tt,rt,at,kr,za=(kr=class extends Ot{constructor(){super();S(this,pe);P(this,"NOTE_IDLE",0);P(this,"NOTE_ATTACK",1);P(this,"NOTE_DECAY",2);P(this,"NOTE_SUSTAIN",3);P(this,"NOTE_HELD",4);P(this,"NOTE_RELEASE",5);P(this,"NOTE_SOSTENUTO_ATTACK",8);P(this,"NOTE_SOSTENUTO_DECAY",9);P(this,"NOTE_SOSTENUTO_SUSTAIN",10);P(this,"NOTE_SOSTENUTO_HELD",11);P(this,"CH_MELODIC",0);P(this,"CH_DRUMS",1);P(this,"CH_DRUM1",2);P(this,"CH_DRUM2",3);P(this,"CH_DRUM3",4);P(this,"CH_DRUM4",5);P(this,"CH_DRUM5",6);P(this,"CH_DRUM6",7);P(this,"CH_DRUM7",8);P(this,"CH_DRUM8",9);P(this,"DUMP_ALL",0);P(this,"DUMP_ONCE",1);P(this,"DUMP_MODE",2);P(this,"EXT_NONE",0);P(this,"EXT_VL",1);P(this,"EXT_DX",3);P(this,"VLBC_BRTHEXPR",1);P(this,"VLBC_VELOINIT",2);P(this,"VLBC_VELOALL",3);P(this,"CH_INACTIVE",0);P(this,"CH_ACTIVE",1);P(this,"CH_DISABLED",2);S(this,_,0);S(this,te,0);S(this,Ee,0);S(this,Ae,new Array(11));S(this,oe,new Uint8Array(b.ch));S(this,Y,new Uint8Array(b.ch));S(this,R,new Uint8Array(b.ch));S(this,w,new Uint8Array(b.chcc<<1));S(this,re,new Uint8Array(b.ch*b.ace));S(this,B,new Uint8Array(b.ch*b.vxPrim));S(this,Z,new Uint8Array(b.ch*b.nn));S(this,le,new Uint8Array(b.ch));S(this,J,new Uint16Array(b.pl));S(this,j,new Uint8Array(b.pl));S(this,Oe,new Int16Array(b.ch));S(this,xe,new Uint8Array(b.ch));S(this,qe,new Uint8Array(b.ch));S(this,de,new Uint8Array(b.ch*b.ext));S(this,A,new Uint8Array(b.ch*b.rpn));S(this,U,new Uint8Array(b.ch*b.rpnt));S(this,ft,new Int8Array(b.ch*qt.length));S(this,ie,new Uint8Array(b.drm*b.dpn*b.dnc));S(this,ye,new Uint8Array(b.drm*2));S(this,he,new Uint8Array(b.efx*3));S(this,ut,new Uint8Array(b.ch));S(this,We,new Uint8Array(b.ch*b.redir));S(this,q,new Uint8Array(b.port));S(this,Qe,new Uint8Array(b.ch));S(this,Ce,new Uint8Array(b.ch));S(this,xt,new Uint8Array(b.ch*b.cvn));S(this,Ue,new Uint8Array(128));S(this,we,new Uint8Array(b.cmt*8));S(this,pt,new Uint8Array(1024));S(this,Ne,new Uint8Array(b.cmt*64));S(this,W,{});P(this,"modelEx",{sc:{showBar:!0,invBar:!1,invDisp:!1,peakHold:1}});S(this,L,void 0);S(this,Se,void 0);S(this,St,void 0);S(this,X,100);S(this,Ye,0);S(this,gt,500);S(this,bt,0);S(this,He,"");S(this,_e,0);S(this,Tt,0);S(this,mt,0);S(this,Te,!0);S(this,F,!1);S(this,Bt,1);S(this,Mt,void 0);S(this,Ze,new Array(b.ch));S(this,fe,[]);S(this,Ie,new Uint8Array(b.ch));S(this,Ge,new Uint8Array(b.tr));P(this,"baseBank",new Gt("gm2","ns5r","xg","gs","sd","gmega","plg-vl","plg-pf","plg-dx","plg-an","plg-dr","plg-sg","kross","s90es"));P(this,"userBank",new Gt("gm"));P(this,"initOnReset",!1);P(this,"aiEfxName","");S(this,ae,[]);S(this,Je,void 0);S(this,Q,{nOff:(e,r)=>{let d=e*128+r,c=t(this,J).lastIndexOf(d);if(c>-1)if(this.getChCc(e,64)>>6)t(this,j)[c]=this.NOTE_HELD,this.dispatchEvent("note",{part:e,note:r,velo:t(this,Z)[d],state:this.NOTE_HELD});else if(this.getChCc(e,66)>>6&&t(this,j)[c]==this.NOTE_SOSTENUTO_SUSTAIN)t(this,j)[c]=this.NOTE_SOSTENUTO_HELD,this.dispatchEvent("note",{part:e,note:r,velo:t(this,Z)[d],state:this.NOTE_SOSTENUTO_HELD});else{t(this,J)[c]=0,t(this,Z)[d]=0,t(this,j)[c]=this.NOTE_IDLE;let p=this.getExt(e)[1];(p==this.VLBC_VELOINIT||p==this.VLBC_VELOALL)&&this.setChCc(e,129,0),this.dispatchEvent("note",{part:e,note:r,velo:0,state:this.NOTE_IDLE})}},nOn:(e,r,d)=>{let c=e*128+r,p=0;for(t(this,le)[e]&&t(this,Q).ano(e);t(this,j)[p]>0&&t(this,J)[p]!=c;)p++;if(p<b.pl){t(this,J)[p]=c,t(this,Z)[c]=d,t(this,j)[p]=this.NOTE_SUSTAIN,t(this,xe)[e]<d&&(t(this,xe)[e]=d);let m=this.getExt(e)[1];(m==this.VLBC_VELOINIT||m==this.VLBC_VELOALL)&&this.setChCc(e,129,d),this.dispatchEvent("note",{part:e,note:r,velo:d,state:this.NOTE_SUSTAIN})}else console.error("Polyphony exceeded.")},nAt:(e,r,d)=>{},cAt:(e,r)=>{},hoOf:e=>{t(this,j).forEach((r,d)=>{if(r==this.NOTE_HELD){let c=t(this,J)[d],p=c>>7;e==p&&(t(this,j)[d]=this.NOTE_IDLE,t(this,J)[d]=0,t(this,Z)[c]=0,this.dispatchEvent("note",{part:e,note:c&127,velo:0,state:this.NOTE_IDLE}))}})},soOn:e=>{t(this,j).forEach((r,d)=>{let c;switch(r){case this.NOTE_ATTACK:{c=this.NOTE_SOSTENUTO_ATTACK;break}case this.NOTE_DECAY:{c=this.NOTE_SOSTENUTO_DECAY;break}case this.NOTE_SUSTAIN:{c=this.NOTE_SOSTENUTO_SUSTAIN;break}}if(c){t(this,j)[d]=c;let p=t(this,J)[d];this.dispatchEvent("note",{part:e,note:p&127,velo:t(this,Z)[p],state:c})}})},soOf:e=>{t(this,j).forEach((r,d)=>{if(r==this.NOTE_SOSTENUTO_HELD){let c=t(this,J)[d],p=c>>7;e==p&&(t(this,j)[d]=this.NOTE_IDLE,t(this,J)[d]=0,t(this,Z)[c]=0,this.dispatchEvent("note",{part:e,note:c&127,velo:0,state:this.NOTE_IDLE}))}})},ano:e=>{t(this,J).forEach((r,d,c)=>{let p=r>>7,m=r&127;r==0&&t(this,Z)[0]==0||p==e&&t(this,Q).nOff(p,m)})}});S(this,Pt,{8:function(e){let r=e.channel,d=e.data[0];t(this,Q).nOff(r,d)},9:function(e){let r=e.channel,d=this;if(d.getChModeId(r)==k.xg&&t(d,R)[r]>1){let m=d.getChDrumFirstWrite(r);m[0]&&m[1]!=b.invalidCh&&!t(d,oe)[r]&&(d.copyChSetup(m[1],r),d.dispatchEvent("voice",{part:r}),console.debug(`Part CH${r+1} copied from CH${m[1]}.`))}d.setChActive(r,1);let c=e.data[0],p=e.data[1];p>0?t(d,Q).nOn(r,c,p):t(d,Q).nOff(r,c)},10:function(e){let r=e.channel,d=r*128+e.data[0];t(this,J).indexOf(d)>-1&&(t(this,Z)[d]=data[1],this.getExt(r)[1]==this.VLBC_VELOALL&&this.setChCc(r,129,data[1]),this.dispatchEvent("note",{part:r,note:e.data[0],velo:e.data[1],state:this.NOTE_SUSTAIN}))},11:function(e){let r=e.channel,d=this,c=t(this,Ze)[r],p=c[e.data[0]];p&&(e.data[0]=p),[0,32].indexOf(e.data[0])>-1&&(()=>{switch(t(this,_)){case k.s90es:case k.motif:{if(e.data[0]==0){[0,63].indexOf(e.data[1])>-1&&this.setChActive(r,1);break}e.data[1]&&this.setChActive(r,1);break}default:{this.setChActive(r,1);break}}})();let m=r*b.ext,C=this.getChModeId(r);switch(e.data[0]){case 96:return;case 97:return;case 120:return;case 121:{t(this,Q).ano(r),t(this,Oe)[r]=0,d.resetChCc(r,1,0),d.resetChCc(r,5,0),d.resetChCc(r,64,0),d.resetChCc(r,65,0),d.resetChCc(r,66,0),d.resetChCc(r,67,0),d.resetChCc(r,11,127),d.resetChCc(r,101,127),d.resetChCc(r,100,127),d.resetChCc(r,99,127),d.resetChCc(r,98,127);return}case 123:{t(this,Q).ano(r);return}case 124:{t(this,Q).ano(r);return}case 125:{t(this,Q).ano(r);return}case 126:{t(this,le)[r]=1,t(this,Q).ano(r);return}case 127:{t(this,le)[r]=0,t(this,Q).ano(r);return}}if($[e.data[0]]==null)console.warn(`cc${e.data[0]} is not accepted.`);else{switch(ea.indexOf(e.data[0])>-1&&this.allocateAce(r,e.data[0]),e.data[0]){case 0:{switch(O()&&console.debug(`${z[t(this,_)]}, CH${r+1}: ${e.data[1]}`),t(this,_)==0?e.data[1]<48?(t(this,R)[r]>0&&(e.data[1]=this.getChPrimitive(r,1,!1),e.data[1]=120,console.debug(`Forced channel ${r+1} to stay drums.`)),e.data[1]>0&&(console.debug(`Roland GS detected with MSB: ${e.data[1]}`),this.switchMode("gs"))):e.data[1]==56?this.switchMode(t(this,L).x5==82?"x5d":"05rw"):e.data[1]==62?this.switchMode(t(this,L).x5==82?"x5d":"05rw"):e.data[1]==63?this.switchMode(z[t(this,L).ds]):(e.data[1]==64||e.data[1]==127)&&this.switchMode("xg"):t(this,_)==k.gs||t(this,_)==k.sc?e.data[1]<56&&t(this,R)[r]>0&&(e.data[1]=this.getChPrimitive(r,1,!1),e.data[1]=120,console.debug(`Forced channel ${r+1} to stay drums.`)):t(this,_)==k.gm&&(e.data[1]<48?t(this,R)[r]>0&&(e.data[1]=120,this.switchMode("gs",!0),console.debug(`Forced channel ${r+1} to stay drums.`)):(e.data[1]==64||e.data[1]==127)&&this.switchMode("xg",!0)),t(this,_)){case k.xg:{[79,95,126,127].indexOf(e.data[1])>-1?t(this,R)[r]==0&&(this.setChType(r,this.CH_DRUM2),console.debug(`CH${r+1} set to drums by MSB.`)):t(this,R)[r]>0&&(this.setChType(r,this.CH_MELODIC),console.debug(`CH${r+1} set to melodic by MSB.`)),[33,81,97].indexOf(e.data[1])>-1?t(this,de)[m]=this.EXT_VL:[35,67,83,99].indexOf(e.data[1])>-1?t(this,de)[m]=this.EXT_DX:t(this,de)[m]=this.EXT_NONE;break}case k["05rw"]:case k.x5d:case k.ns5r:{[61,62,126,127].indexOf(e.data[1])>-1?t(this,R)[r]==this.CH_MELODIC&&(this.setChType(r,this.CH_DRUM2),console.debug(`CH${r+1} set to drums by MSB.`)):[80,81,82,83].indexOf(e.data[1])>-1||t(this,R)[r]!=this.CH_MELODIC&&(this.setChType(r,this.CH_MELODIC),console.debug(`CH${r+1} set to melodic by MSB.`));break}case k.sd:{[104,105,106,107].indexOf(e.data[1])>-1?t(this,R)[r]==0&&(this.setChType(r,this.CH_DRUM2),console.debug(`CH${r+1} set to drums by MSB.`)):t(this,R)[r]>0&&(this.setChType(r,this.CH_MELODIC),console.debug(`CH${r+1} set to melodic by MSB.`));break}case k.g2:{e.data[1]==120?t(this,R)[r]==0&&(this.setChType(r,this.CH_DRUMS),console.debug(`CH${r+1} set to drums by MSB.`)):t(this,R)[r]>0&&(this.setChType(r,this.CH_MELODIC),console.debug(`CH${r+1} set to melodic by MSB.`));break}}break}case 2:{this.getExt(r)[1]==this.VLBC_BRTHEXPR&&this.setChCc(r,129,e.data[1]);break}case 6:{if(t(this,qe)[r]){[k.xg,k.gs,k.sc,k.ns5r].indexOf(t(this,_))<0&&console.warn(`NRPN commits are not available under "${z[t(this,_)]}" mode, even when they are supported in Octavia.`);let E=this.getChCc(r,99),a=this.getChCc(r,98);if(E==1){let h=ta.indexOf(a);if(h>-1)this.setChCc(r,71+h,e.data[1]),O()&&console.debug(`Redirected NRPN 1 ${a} to cc${71+h}.`),this.dispatchEvent("cc",{part:r,cc:71+h,data:e.data[1]});else{let s=qt.indexOf(a);s>-1?t(this,ft)[r*10+s]=e.data[1]-64:console.warn(`NRPN 0x01${a.toString(16).padStart(2,"0")} is not supported.`),O()&&console.debug(`CH${r+1} voice NRPN ${a} commit`)}}else{if(Ut.indexOf(E)<0){let s=`NRPN 0x${E.toString(16).padStart(2,"0")}${a.toString(16).padStart(2,"0")} `;E==127?console.warn(`${s}is not necessary. Consider removing it.`):console.warn(`${s}is not supported.`)}else{let s=t(this,R)[r]-2;s<0?console.warn(`CH${r+1} cannot accept drum NRPN as type ${$t[t(this,R)[r]]}.`):t(this,ie)[(s*b.dpn+ge[E])*b.dnc+a]=e.data[1]}O()&&console.debug(`CH${r+1} (${$t[t(this,R)[r]]}) drum NRPN ${E} commit`)}}else{let E=vr[this.getChCc(r,100)],a=Er[this.getChCc(r,100)];if(this.getChCc(r,101)==0&&E!=null)switch(O()&&console.debug(`CH${r+1} RPN 0 ${this.getChCc(r,100)} commit: ${e.data[1]}`),e.data[1]=Math.min(Math.max(e.data[1],yr[E][0]),yr[E][1]),t(this,A)[r*b.rpn+E]=e.data[1],t(this,U)[r*b.rpnt+a]=1,C){case k.xg:case k.gs:case k.sc:case k.mt32:case k.s90es:case k.motif:{switch(this.getChCc(r,100)){case 1:case 2:{this.dispatchEvent("pitch",{part:r,pitch:this.getPitchShift(r)});break}}break}default:this.dispatchEvent("pitch",{part:r,pitch:this.getPitchShift(r)})}}break}case 32:{switch(O()&&console.debug(`${z[t(this,_)]}, CH${r+1} LSB: ${e.data[1]}`),t(this,_)){case k.s90es:case k.motif:{this.setChType(r,[32,40].indexOf(e.data[1])>-1?this.CH_DRUMS:this.CH_MELODIC,t(this,_),!0);break}}this.getExt(r)[0]==this.EXT_DX;break}case 38:{if(!t(this,qe)[r]){let E=vr[this.getChCc(r,100)],a=Er[this.getChCc(r,100)];this.getChCc(r,101)==0&&E!=null&&(t(this,A)[r*b.rpn+E+1]=e.data[1],t(this,U)[r*b.rpnt+a]=1)}break}case 64:{e.data[1]<64&&t(this,Q).hoOf(r);break}case 66:{e.data[1]>>6?t(this,Q).soOn(r):t(this,Q).soOf(r);break}case 98:case 99:{t(this,qe)[r]=1;break}case 100:case 101:{t(this,qe)[r]=0;break}}this.setChCc(r,e.data[0],e.data[1]),this.dispatchEvent("cc",{part:r,cc:e.data[0],data:e.data[1]})}d.getChModeId(r)==k.xg&&t(d,R)[r]&&d.setDrumFirstWrite(r)},12:function(e){let r=e.channel,d=this;switch(t(d,_)){case k.s90es:case k.motif:{e.data&&d.setChActive(r,1);break}default:d.setChActive(r,1)}let c=H[r];switch(d.getExt(r)[0]){case d.EXT_VL:break}t(d,B)[r]=e.data,t(d,Ce)[r]=0,d.pushChPrimitives(r),O()&&console.debug(`T:${e.track} C:${r} P:${e.data}`),d.dispatchEvent("voice",{part:r}),d.getChModeId(r)==k.xg&&t(d,R)[r]&&d.setDrumFirstWrite(r)},13:function(e){let r=this,d=e.channel;t(this,J).forEach(function(c){let p=c>>7;d==p&&(t(r,Z)[c]=e.data,r.dispatchEvent("note",{part:d,note:c&127,velo:e.data,state:r.NOTE_SUSTAIN}))})},14:function(e){let r=e.channel;t(this,Oe)[r]=e.data[1]*128+e.data[0]-8192,this.dispatchEvent("pitch",{part:r,pitch:this.getPitchShift(r)})},15:function(e){aa(e.data).forEach(r=>{let d=r[0],c=r[1];(t(this,Lt)[d]||function(){console.debug(`Unknown manufacturer ${d}.`)})(c,r.subarray(2),e.track)})},248:function(e){},250:function(e){},251:function(e){},252:function(e){},254:function(e){},255:function(e){(t(this,ae)[e.meta]||function(d,c,p){}).call(this,e.data,e.track,e.meta),e.meta!=32&&x(this,Ye,0);let r=jr.indexOf(e.meta)>-1;if(O()&&console.debug(e),r)return e.reply="meta",e}});S(this,Lt,{64:(e,r,d)=>{t(this,tt).run(r,d,e)},65:(e,r,d)=>{if(r[0]<16)if(r[1]==72){let c=r[r.length-1],p=Le(r.subarray(3,r.length-1));c==p?t(this,be).run(r.subarray(0,r.length-1),d,e):console.warn(`Bad SD checksum ${c} - should be ${p}.`)}else t(this,be).run(r,d,e);else{let c=r[r.length-1],p=Le(r.subarray(2,r.length-1));c==p?t(this,be).run(r.subarray(0,r.length-1),d,e):console.warn(`Bad GS checksum ${c} - should be ${p}.`)}},66:(e,r,d)=>{t(this,Me).run(r,d,e)},67:(e,r,d)=>{t(this,ue).run(r,d,e)},68:(e,r,d)=>{t(this,at).run(r,d,e)},71:(e,r,d)=>{t(this,rt).run(r,d,e)},126:(e,r,d)=>{t(this,je).run(r,d,e)},127:(e,r,d)=>{this.switchMode("gm"),t(this,et).run(r,d,e)}});S(this,je,void 0);S(this,et,void 0);S(this,ue,void 0);S(this,be,void 0);S(this,Me,void 0);S(this,tt,void 0);S(this,rt,void 0);S(this,at,void 0);let e=this;x(e,pe,new Uint8Array(256),Sr),t(e,Ae)[10]=new Uint8Array(512),x(e,Je,new me),x(e,L,{x5:82,ds:k.krs,smotif:k.s90es,gs:4,sc:3}),x(e,Se,{dumpLimit:e.DUMP_MODE}),x(e,St,new Proxy(t(e,Se),{set:()=>{}}));for(let a in br){let h=k[a];h==null?console.debug(`SubDB build error: "${a}" does not exist`):t(e,W)[h]=new Uint8Array(br[a])}e.userBank.strictMode=!0,e.userBank.load(`MSB	PRG	LSB	NME
062	000	000	
122	000	000	
122	001	000	
122	002	000	
122	003	000	
122	004	000	
122	005	000	
122	006	000	`),e.addEventListener("metacommit",function(a){var s,i;let{data:h}=a;((s=t(e,fe)[0])==null?void 0:s.type)==h.type&&((i=t(e,fe)[0])!=null&&i.amend)?(t(e,fe)[0].amend=h.amend,t(e,fe)[0].data+=h.data):t(e,fe).unshift(h)}),t(e,ae)[1]=function(a){var h,s,i,n,o;switch(a=a.replaceAll(`\r
`,`
`).replaceAll("\r",`
`),a.slice(0,2)){case"@I":{x(this,F,!0),this.dispatchEvent("metacommit",{type:"Kar.Info",data:(h=a.slice(2))==null?void 0:h.trimLeft()});break}case"@K":{x(this,F,!0),this.dispatchEvent("metacommit",{type:"Kar.Mode",data:(s=a.slice(2))==null?void 0:s.trimLeft()}),console.debug(`Karaoke mode active: ${a.slice(2)}`);break}case"@L":{x(this,F,!0),this.dispatchEvent("metacommit",{type:"Kar.Lang",data:(i=a.slice(2))==null?void 0:i.trimLeft()});break}case"@T":{x(this,F,!0),this.dispatchEvent("metacommit",{type:"KarTitle",data:(n=a.slice(2))==null?void 0:n.trimLeft()});break}case"@V":{x(this,F,!0),this.dispatchEvent("metacommit",{type:"Kar.Ver.",data:(o=a.slice(2))==null?void 0:o.trimLeft()});break}case"XF":{let l=a.slice(2).split(":");switch(l[0]){case"hd":{l.slice(1).forEach((u,f)=>{u.length&&this.dispatchEvent("metacommit",{type:["XfSngDte","XfSngRgn","XfSngCat","XfSongBt","XfSngIns","XfSngVoc","XfSngCmp","XfSngLrc","XfSngArr","XfSngPer","XfSngPrg","XfSngTag"][f],data:u})});break}case"ln":{l.slice(1).forEach((u,f)=>{u.length&&this.dispatchEvent("metacommit",{type:["XfKarLng","XfKarNme","XfKarCmp","XfKarLrc","XfKarArr","XfKarPer","XfKarPrg"][f],data:u})});break}default:this.dispatchEvent("metacommit",{type:"XfUnData",data:a})}break}default:t(this,F)?a[0]=="\\"?(this.dispatchEvent("metacommit",{type:"KarLyric",data:"",amend:!1}),this.dispatchEvent("metacommit",{type:"KarLyric",data:a.slice(1),amend:!0})):a[0]=="/"?(this.dispatchEvent("metacommit",{type:"KarLyric",data:"",mask:!0,amend:!1}),this.dispatchEvent("metacommit",{type:"KarLyric",data:a.slice(1),mask:!0,amend:!0})):this.dispatchEvent("metacommit",{type:"KarLyric",data:a,amend:!0}):a.split(`
`).forEach((l,u)=>{this.dispatchEvent("metacommit",{type:"Cmn.Text",data:l,mask:u!=0})})}},t(e,ae)[2]=function(a){this.dispatchEvent("metacommit",{type:"Copyrite",data:a})},t(e,ae)[3]=function(a,h){h<1&&t(this,Ye)<1&&this.dispatchEvent("metacommit",{type:"TrkTitle",data:a})},t(e,ae)[4]=function(a,h){this.dispatchEvent("metacommit",{type:"Instrmnt",data:a})},t(e,ae)[5]=function(a){a.trim()==""?this.dispatchEvent("metacommit",{type:"C.Lyrics",data:"",amend:!1}):this.dispatchEvent("metacommit",{type:"C.Lyrics",data:a,amend:!0})},t(e,ae)[6]=function(a){this.dispatchEvent("metacommit",{type:"C.Marker",data:a})},t(e,ae)[7]=function(a){this.dispatchEvent("metacommit",{type:"CuePoint",data:a})},t(e,ae)[32]=function(a){x(this,Ye,a[0]+1)},t(e,ae)[33]=function(a,h){O()&&console.debug(`Track ${h} requests to get assigned to output ${a}.`),t(e,Ge)[h]=a+1},t(e,ae)[81]=function(a,h){x(e,gt,a/1e3)},t(e,ae)[127]=function(a,h){t(e,Je).run(a,h)},t(e,Je).default=function(a){console.warn(`Unrecognized sequencer-specific byte sequence: ${a}`)},t(e,Je).add([67,0,1],function(a,h){O()&&console.debug(`XGworks requests assigning track ${h} to output ${a[0]}.`),t(e,Ge)[h]=a[0]+1}),x(e,je,new me("universal non-realtime")),x(e,et,new me("universal realtime")),x(e,ue,new me("Yamaha")),x(e,be,new me("Roland")),x(e,Me,new me("Korg")),x(e,tt,new me("Kawai")),x(e,rt,new me("Akai")),x(e,at,new me("Casio"));let r=new me("DX7+ Dump"),d=function(a){console.info(`Unrecognized SysEx in "${this.name}" set.
%o`,a)};t(e,je).default=d,t(e,et).default=d,t(e,ue).default=d,t(e,be).default=d,t(e,Me).default=d,t(e,tt).default=d,t(e,rt).default=d,t(e,at).default=d,r.default=d,t(e,je).add([9],(a,h,s)=>{e.switchMode(["gm","?","g2"][a[0]-1],!0),e.setPortMode(e.getTrackPort(h),1,k[["gm","?","g2"][a[0]-1]]),x(e,F,t(e,F)||!1),console.info(`MIDI reset: ${["GM","Init","GM2"][a[0]-1]}`),a[0]==2&&e.init()}),t(e,et).add([4,1],(a,h,s)=>{e.dispatchEvent("mupromptex"),x(e,X,((a[1]<<7)+a[0])/16383*100),e.dispatchEvent("mastervolume",t(e,X))}).add([4,3],(a,h,s)=>((a[1]<<7)+a[0]-8192)/8192).add([4,4],(a,h,s)=>a[1]-64).add([4,5],(a,h,s)=>{e.dispatchEvent("mupromptex");let i=a[0],n=a[1],o=a[2],l=3,u=l+(i<<1),f=u+n;if(i!=1){console.error(`Unsupported GM2 global parameter set: slotpath length too long (${i})!
`,a);return}let v=0,y=0,T=0;switch(a.subarray(l,u).forEach(D=>{v=v<<7,v|=D}),a.subarray(u,f).forEach((D,M)=>{y|=D<<M*7}),a.subarray(f).forEach((D,M)=>{T|=D<<M*7}),O()&&console.debug(`GM2 global parameter: (${a.subarray(3,u)}; p: ${y}, v: ${T})`),v){case 129:{y==0&&(e.setEffectType(0,52,T),e.dispatchEvent("efxreverb",e.getEffectType(0)));break}case 130:{y==0&&(e.setEffectType(1,52,T|16),e.dispatchEvent("efxchorus",e.getEffectType(1)));break}default:O()&&console.debug("GM2 global paramater slot path unknown.")}}),t(this,ue).add([76,0,0],(a,h,s)=>{switch(a[0]){case 125:{e.initDrums(),console.info(`XG drum setup reset: ${a}`);break}case 126:{e.switchMode("xg",!0),e.setPortMode(e.getTrackPort(h),4,k.xg),x(e,F,!1),console.info("MIDI reset: XG");break}default:{e.dispatchEvent("mupromptex");let i=[0,0,0,0],n=(o,l)=>{i[l]=o};if(a.subarray(1).forEach((o,l)=>{let u=l+a[0];([n,n,n,n,f=>{x(this,X,f*129/16383*100),e.dispatchEvent("mastervolume",t(e,X))},f=>{},f=>{}][u]||(()=>{}))(o,l)}),a[0]<4){let o=0;i.forEach(l=>{o=o<<4,o+=l}),o-=1024}}}}).add([76,2,1],(a,h,s)=>{e.dispatchEvent("mupromptex");let i="XG ";a[0]<32?(i+="reverb ",a.subarray(1).forEach((n,o)=>{([l=>{e.setEffectTypeRaw(0,!1,l),console.info(`${i}main type: ${wt[l]}`),e.dispatchEvent("efxreverb",e.getEffectType(0))},l=>{e.setEffectTypeRaw(0,!0,l),console.debug(`${i}sub type: ${l+1}`),e.dispatchEvent("efxreverb",e.getEffectType(0))},l=>{console.debug(`${i}time: ${cr(l)}s`)},l=>{console.debug(`${i}diffusion: ${l}`)},l=>{console.debug(`${i}initial delay: ${l}`)},l=>{console.debug(`${i}HPF cutoff: ${ht[l]}Hz`)},l=>{console.debug(`${i}LPF cutoff: ${ht[l]}Hz`)},l=>{console.debug(`${i}width: ${l}`)},l=>{console.debug(`${i}height: ${l}`)},l=>{console.debug(`${i}depth: ${l}`)},l=>{console.debug(`${i}wall type: ${l}`)},l=>{console.debug(`${i}dry/wet: ${l}`)},l=>{console.debug(`${i}send: ${ce(l)}dB`)},l=>{console.debug(`${i}pan: ${l-64}`)},!1,!1,l=>{console.debug(`${i}delay: ${l}`)},l=>{console.debug(`${i}density: ${l}`)},l=>{console.debug(`${i}balance: ${l}`)},l=>{},l=>{console.debug(`${i}feedback: ${l}`)},l=>{}][a[0]+o]||function(){console.warn(`Unknown XG reverb address: ${a[0]}.`)})(n)})):a[0]<64?(i+="chorus ",a.subarray(1).forEach((n,o)=>{([l=>{e.setEffectTypeRaw(1,!1,l),console.info(`${i}main type: ${wt[l]}`),e.dispatchEvent("efxchorus",e.getEffectType(1))},l=>{e.setEffectTypeRaw(1,!0,l),console.debug(`${i}sub type: ${l+1}`),e.dispatchEvent("efxchorus",e.getEffectType(1))},l=>{console.debug(`${i}LFO: ${nr[l]}Hz`)},l=>{},l=>{console.debug(`${i}feedback: ${l}`)},l=>{console.debug(`${i}delay offset: ${or(l)}ms`)},l=>{},l=>{console.debug(`${i}low: ${ht[l]}Hz`)},l=>{console.debug(`${i}low: ${l-64}dB`)},l=>{console.debug(`${i}high: ${ht[l]}Hz`)},l=>{console.debug(`${i}high: ${l-64}dB`)},l=>{console.debug(`${i}dry/wet: ${l}`)},l=>{console.debug(`${i}send: ${ce(l)}dB`)},l=>{console.debug(`${i}pan: ${l-64}`)},l=>{console.debug(`${i}to reverb: ${ce(l)}dB`)},!1,l=>{},l=>{},l=>{},l=>{console.debug(`${i}LFO phase diff: ${(l-64)*3}deg`)},l=>{console.debug(`${i}input mode: ${l?"stereo":"mono"}`)},l=>{}][a[0]-32+o]||function(){console.warn(`Unknown XG chorus address: ${a[0]}.`)})(n)})):a[0]<86?(i+="variation ",a.subarray(1).forEach((n,o)=>{([l=>{e.setEffectTypeRaw(2,!1,l),console.info(`${i}main type: ${wt[l]}`),e.dispatchEvent("efxdelay",e.getEffectType(2))},l=>{e.setEffectTypeRaw(2,!0,l),console.debug(`${i}sub type: ${l+1}`),e.dispatchEvent("efxdelay",e.getEffectType(2))}][a[0]-64+o]||function(){})(n)})):a[0]<97?(i+="variation ",a.subarray(1).forEach((n,o)=>{[l=>{console.debug(`${i}send: ${ce(l)}dB`)},l=>{console.debug(`${i}pan: ${l-64}`)},l=>{console.debug(`${i}to reverb: ${ce(l)}dB`)},l=>{console.debug(`${i}to chorus: ${ce(l)}dB`)},l=>{console.debug(`${i}connection: ${l?"system":"insertion"}`)},l=>{console.debug(`${i}channel: CH${l+1}`)},l=>{console.debug(`${i}mod wheel: ${l-64}`)},l=>{console.debug(`${i}bend wheel: ${l-64}`)},l=>{console.debug(`${i}channel after touch: ${l-64}`)},l=>{console.debug(`${i}AC1: ${l-64}`)},l=>{console.debug(`${i}AC2: ${l-64}`)}][a[0]-86+o](n)})):a[0]>111&&a[0]<118?i+="variation ":console.warn(`Unknown XG variation address: ${a[0]}`)}).add([76,2,64],(a,h,s)=>{a.subarray(1).forEach((i,n)=>{let o=n+a[0];if(o==0)console.debug(`XG EQ preset: ${["flat","jazz","pop","rock","classic"][i]}`);else{let l=o-1>>2,u=o-1&3,f=`XG EQ ${l} ${["gain","freq","Q","shape"][u]}: `;[()=>{console.debug(`${f}${i-64}dB`)},()=>{console.debug(`${f}${i} (raw)`)},()=>{console.debug(`${f}${i/10}`)},()=>{console.debug(`${f}${["shelf","peak"][+!!i]}`)}][u]()}})}).add([76,3],(a,h,s)=>{e.dispatchEvent("mupromptex");let i=a[0],n=a[1],o=`XG Insertion ${a[0]+1} `;a.subarray(2).forEach((l,u)=>{([f=>{e.setEffectTypeRaw(3+i,!1,f),console.info(`${o}main type: ${wt[f]}`),e.dispatchEvent(`efxinsert${i}`,e.getEffectType(3+i))},f=>{e.setEffectTypeRaw(3+i,!0,f),console.debug(`${o}sub type: ${f+1}`),e.dispatchEvent(`efxinsert${i}`,e.getEffectType(3+i))}][n+u]||function(){})(l)})}).add([76,6,0],(a,h,s)=>{let i=a[0];i<64?e.setLetterDisplay(a.subarray(1),"XG letter display",i):x(e,_e,Date.now())}).add([76,7,0],(a,h,s)=>{let i=a[0];x(e,te,0),x(e,Ee,Date.now()+3200),t(e,pe,De).fill(0);let n=a.subarray(1);for(let o=0;o<i;o++)n.unshift(0);n.forEach(function(o,l){let u=Math.floor(l/16),f=l%16,v=(f*3+u)*7,y=7,T=0;for(v-=f*5,u==2&&(y=2);T<y;)t(e,pe,De)[v+T]=o>>6-T&1,T++})}).add([76,8],(a,h)=>{e.dispatchEvent("mupromptex");let s=e.chRedir(a[0],h,!0),i=a[1],n=H[s],o=`XG CH${s+1} `,l=`Unknown XG part address ${i}.`,u=!0;a.subarray(2).forEach((f,v)=>{u=!0,i<1?console.debug(l):i<41?([()=>{e.setChCc(s,0,f),e.pushChPrimitives(s),e.dispatchEvent("voice",{part:s})},()=>{e.setChCc(s,32,f),e.pushChPrimitives(s),e.dispatchEvent("voice",{part:s})},()=>{t(e,B)[s]=f,e.dispatchEvent("voice",{part:s})},()=>{u=!1;let y=e.chRedir(f,h,!0);t(e,Y)[s]=y,s!=y&&(e.buildRchTree(),console.info(`${o}receives from CH${y+1}`)),t(e,oe)[s]||(e.copyChSetup(y,s,!0),console.debug(`${o}copied from CH${y+1}.`),e.setChActive(s,1),e.dispatchEvent("voice",{part:s}))},()=>{t(e,le)[s]=+!f},()=>{},()=>{u=!1,e.setChType(s,f,k.xg),console.debug(`${o}type: ${$t[f]||f}`),e.dispatchEvent("voice",{part:s})},()=>{t(e,A)[b.rpn*s+3]=f,t(e,U)[b.rpnt*s+2]=1,e.dispatchEvent("pitch",{part:s,pitch:e.getPitchShift(s)})},!1,!1,()=>{e.setChCc(s,7,f)},!1,!1,()=>{e.setChCc(s,10,f||128)},!1,!1,()=>{e.setChCc(s,128,f),e.allocateAce(s,128)},()=>{e.setChCc(s,93,f)},()=>{e.setChCc(s,91,f)},()=>{e.setChCc(s,94,f)},()=>{e.setChCc(s,76,f)},()=>{e.setChCc(s,77,f)},()=>{e.setChCc(s,78,f)},()=>{e.setChCc(s,74,f)},()=>{e.setChCc(s,71,f)},()=>{e.setChCc(s,73,f)},()=>{e.setChCc(s,75,f)},()=>{e.setChCc(s,72,f)}][i+v-1]||(()=>{}))():i<48?console.debug(l):i<111?i>102&&i<105&&e.setChCc(s,[5,65][i&1],f):i<114?console.debug(l):i<116?console.debug(`${o}EQ ${["bass","treble"][i&1]} gain: ${f-64}dB`):i<118?console.debug(l):i<120?console.debug(`${o}EQ ${["bass","treble"][i&1]} freq: ${f}`):console.debug(l)}),u&&t(e,R)[s]>1&&e.setDrumFirstWrite(s)}).add([76,9],(a,h)=>{let s=e.chRedir(a[0],h,!0),i=a[1],n=H[s],o=`PLG-VL CH${s+1} `;a.subarray(2).forEach((l,u)=>{let f=u+i;switch(f){case 1:{console.info(`${o}breath mode: ${["system","breath","velocity","touch EG"][l]}`);break}case 0:case 27:case 28:break;default:if(f<27){let v=f-3>>1,y=["pressure","embouchure","tonguing","scream","breath noise","growl","throat formant","harmonic enhancer","damping","absorption","amplification","brightness"][v];f&1?f<23?(console.debug(`${o}${y} control source: ${hr(l)}`),l&&l<96&&e.allocateAce(s,130+v),t(e,We)[b.redir*s+v+2]=l,e.buildRccMap()):console.debug(`${o}${y} scale break point: ${l}`):(console.debug(`${o}${y} depth: ${l-64}`),e.setChCc(s,130+v,l))}}})}).add([76,10],(a,h,s)=>{}).add([76,16],(a,h,s)=>{}).add([76,17,0,0],(a,h,s)=>{}).add([76,112],(a,h,s)=>{switch(console.debug(`XG enable PLG-${["VL","SG","DX","AN","PF","DR","PC","AP"][a[0]]} for CH${a[2]+1}.`),a[0]){case 0:{t(e,de)[b.ext*a[2]]=e.EXT_VL;break}case 2:{t(e,de)[b.ext*a[2]]=e.EXT_DX;break}default:t(e,de)[b.ext*a[2]]=e.EXT_NONE}}).add([73,0,0],(a,h)=>{let s=a[0],i="MU1000 System - ";a.subarray(1).forEach((n,o)=>{let l=s+o;l==8?console.debug(`${i}LCD contrast: ${n}.`):l==18?(t(e,W)[k.xg][1]=n?126:0,console.debug(`${i}default bank: ${n?"MU100 Native":"MU Basic"}.`),e.dispatchEvent("banklevel",{mode:"xg",data:+!!n}),e.forceVoiceRefresh()):l>=64&&l<69&&[()=>{e.dispatchEvent("channelactive",n)},()=>{n<8?(e.dispatchEvent("channelmin",n<<4),console.debug(`Octavia System: Minimum CH${(n<<4)+1}`)):(e.dispatchEvent("channelreset"),console.info("Octavia System: Clear channel ranges"))},()=>{n<8?(e.dispatchEvent("channelmax",(n<<4)+15),console.debug(`Octavia System: Maximum CH${(n<<4)+16}`)):(e.dispatchEvent("channelreset"),console.info("Octavia System: Clear channel ranges"))},()=>{e.dispatchEvent("channelreset"),console.info("Octavia System: Clear channel ranges")},()=>{x(e,Te,!!n),console.info(`Octavia System: RS receiving ${["dis","en"][n]}abled.`)}][l-64]()})}).add([73,10,0],(a,h)=>{let s=a[0],i=`MU1000 RS${t(e,Te)?"":" (ignored)"}: `;if(s<16)switch(s){case 2:{let n=e.chRedir(0,h,!0);t(e,Te)&&(e.dispatchEvent("portrange",4),e.dispatchEvent("portstart",n)),console.info(`${i}Show CH${n+1}~CH${n+64}`);break}case 3:{let n=e.chRedir(a[1]<<5,h,!0);t(e,Te)&&(e.dispatchEvent("portrange",2),e.dispatchEvent("portstart",n)),console.info(`${i}Show CH${n+1}~CH${n+32}`);break}default:console.debug(`${i}unknown switch ${s} invoked.`)}else if(s<32){if(t(e,Te)){let n=e.chRedir(s-16+(t(e,mt)<<4),h,!0);e.dispatchEvent("channelactive",n)}}else if(s<36){let n=e.chRedir(s-32<<4,h,!0);t(e,Te)&&(e.dispatchEvent("portrange",1),e.dispatchEvent("portstart",n>>4),x(e,mt,s-32)),console.info(`${i}Show CH${n+1}~CH${n+16}`)}}).add([73,11,0],(a,h)=>{let s="MU1000 System - channel ",i="Octavia System - channel ",n=a[0];a.subarray(1).forEach((o,l)=>{let u=n+l;([()=>{e.setChActive(o,1),e.dispatchEvent("channelactive",o),O()&&console.debug(`${s}current part: CH${o+1}`)},()=>{o<5?(e.dispatchEvent("portrange",1<<o),console.debug(`${s}port range: ${1<<o} port(s)`)):(e.dispatchEvent("portrange",0),console.debug(`${s}port range: reset`))},()=>{o<16?(e.dispatchEvent("portstart",o),console.debug(`${i}start port: ${"ABCDEFGHIJKLMNOP"[o]}`)):(e.dispatchEvent("portstart",255),console.debug(`${i}start port: reset`))}][u]||(()=>{console.debug(`${s}unknown address: ${u}`)}))()})}).add([93,3],(a,h)=>{let s=e.chRedir(a[0],h,!0),i=`PLG-SG CH${s+1} `,n=Date.now();if(a[1]==0){let o="",l=0;a.subarray(2).forEach((u,f)=>{f%2==0?o+=lr[u]||u.toString().padStart("0"):l+=u*13}),n>=t(e,bt)&&this.dispatchEvent("metacommit",{type:"SGLyrics",data:"",amend:!1}),this.dispatchEvent("metacommit",{type:"SGLyrics",data:`${dr(o)}`,amend:!0}),x(e,bt,n+Math.ceil(l/2)+t(e,gt)),O()&&console.debug(`${i}vocals: ${o}`)}else console.warn(`Unknown PLG-SG data: ${a}`)}).add([98,0],(a,h,s)=>{e.dispatchEvent("mupromptex");let i=a[0],n=a.length-5,o=a.length-1;if(i!=n){console.info(`PLG-DX native dump size mismatch! Gave ${i} instead of ${a.length-5}.`);return}let l=Le(a.subarray(4,o));if(l!=a[o]){console.info(`Bad PLG-DX checksum ${a[o]} - should be ${l}.`);return}a[0]=98,t(e,ue).run(a.subarray(0,o),h,s,{noAce:!0})}).add([98,96],(a,h,s,i)=>{let n=e.chRedir(a[0],h,!0),o=H[n],l=a[1];a.subarray(2).forEach((u,f)=>{let v=l+f;if(!(v<10)){if(v==10)e.resetAce();else if(v<27){let y=v+131;i!=null&&i.noAce||e.allocateAce(n,y),e.setChCc(n,y,u),e.dispatchEvent("cc",{part:n,cc:y,data:u})}}})}).add([100,0],(a,h,s)=>{let i=a.subarray(0,a.length-1);if(a[0]+5!=a.length){console.warn(`Yamaha DX7+ dump SysEx size mismatch! Expected ${a.length}, but got ${a[0]}:
`,a);return}let n=Le(i),o=a[a.length-1];if(n!=o){console.warn(`Yamaha DX7+ dump SysEx checksum mismatch! Expected ${n}, but got ${o}:
`,a);return}r.run(i.subarray(1))}).add([100,76],(a,h,s)=>{let i=a[0]>>4,n=a[0]&15,o=a[1];switch(i){case 2:{let l=e.chRedir(n,h,!0),u=H[l];a.subarray(2).forEach((f,v)=>{let y=v+o;if(!(y<7)){if(y<23){let T=y+135;e.allocateAce(l,T),e.setChCc(l,T,f),e.dispatchEvent("cc",{part:l,cc:T,data:f})}}});break}default:console.info("Unknown DX7+ multipart: %o",a)}}).add([1,20],(a,h,s)=>{s==115?(e.switchMode("doc",!0),e.setPortMode(e.getTrackPort(h),1,k.doc),console.info("MIDI reset: DOC")):console.debug(`Unknown Yamaha SysEx: 67, ${s}, ${a.join(", ")}`)}).add([1,17,15,89],(a,h,s)=>{s==115?(e.setEffectType(0,24,a[0]|16),e.dispatchEvent("efxreverb",e.getEffectType(0))):console.debug(`Unknown Yamaha SysEx: 67, ${s}, ${a.join(", ")}`)}).add([1,24],(a,h,s)=>{if(s==115){for(let i=0;i<16;i++){let n=e.chRedir(i,h,!0);e.setChCc(n,91,127)}console.info("DOC Global Reverb: on")}else console.debug(`Unknown Yamaha SysEx: 67, ${s}, ${a.join(", ")}`)}),r.add([14,31],(a,h,s)=>{e.setChCc(a[0],64,0),t(e,Q).ano(a[0]),e.switchMode("xg"),e.setPortMode(e.getTrackPort(h),1,k.xg),e.resetAce(),console.debug(`Yamaha DX7+ reset CH${a[0]+1}.`)}).add([76,112],async a=>{let h=a[0],s=H[h],i=xr[h],n=b.cvn*h;t(e,de)[i]=e.EXT_DX,t(e,Ce)[h]=1;let o=t(e,xt).subarray(n,n+b.cvn);o.fill(32),a.subarray(1).forEach((l,u)=>{if(u<10)o[u]=Math.max(l,32);else if(!(u<40)){if(u<56){let f=u+102;e.setChCc(h,f,l),e.dispatchEvent("cc",{part:h,cc:f,data:l})}}}),t(e,B)[h]=h&127,e.setChCc(h,0,35),e.setChCc(h,32,h>>7|4),e.pushChPrimitives(h),e.dispatchEvent("voice",{part:h}),console.debug(`DX7+ CH${h+1} dump: %o`,a)});let c=function(a,h,s,i){},p=function(a,h){e.dispatchEvent("mupromptex");let s=a*b.dpn,i=h[0],n=h[1];h.subarray(2).forEach((o,l)=>{let u=l+n,f=-1;u<16?([()=>{f=24},()=>{f=25},()=>{f=26},()=>{},()=>{f=28},()=>{f=29},()=>{f=30},()=>{f=31},()=>{},()=>{},()=>{},()=>{f=20},()=>{f=21},()=>{f=22},()=>{f=23},()=>{}][u]||(()=>{console.debug(`Unknown XG-style drum param ${u} on set ${a+1}.`)}))():u<32||(u<40?([()=>{f=48},()=>{f=49},!1,!1,()=>{f=52},()=>{f=53}][u-32]||(()=>{console.debug(`Unknown XG-style drum param ${u} on set ${a+1}.`)}))():u<80||([()=>{f=36}][u-80]||(()=>{console.debug(`Unknown XG-style drum param ${u} on set ${a+1}.`)}))()),f>=0?(O()&&console.debug(s,f,i,o),t(e,ie)[(s+ge[f])*b.dnc+i]=o):O()&&console.debug(`XG-style drum param ${u} has no writes.`)})},m=function(a,h,s){e.dispatchEvent("mupromptex");let i=a*b.dpn,n=(h<<7)+s[0];s.subarray(1).forEach((o,l)=>{let u=l+n,f=u&127,v=u>>7,y=-1;v>1&&([()=>{y=26},()=>{},()=>{y=28},()=>{y=29},()=>{y=30},()=>{},()=>{},()=>{y=31}][v-2]||(()=>{console.debug(`Unknown GS-style drum param ${v} on set ${a+1}.`)}))(),y>-1?(O()&&console.debug(i,y,f,o),t(e,ie)[(i+ge[y])*b.dnc+f]=o):O()&&console.debug(`GS-style drum param ${v} has no writes.`)})};t(this,ue).add([76,48],(a,h,s)=>{p(0,a)}).add([76,49],(a,h,s)=>{p(1,a)}).add([76,50],(a,h,s)=>{p(2,a)}).add([76,51],(a,h,s)=>{p(3,a)}).add([76,52],(a,h,s)=>{p(4,a)}).add([76,53],(a,h,s)=>{p(5,a)}).add([76,54],(a,h,s)=>{p(6,a)}).add([76,55],(a,h,s)=>{p(7,a)}),t(this,ue).add([89,0],(a,h,s)=>{if(e.eprom){let i=a[0],n=(a[1]<<14)+(a[2]<<7)+a[3]+(e.eprom.offset||0);O()&&console.debug(`MU1000 EPROM trail to 0x${n.toString(16).padStart(6,"0")}, ${i} bytes.`);let o=e.eprom.data;a.subarray(4).forEach((l,u)=>{let f=u>>3,v=u&7;if(v==7)for(let y=0;y<7;y++)o[n+7*f+y]+=(l>>6-y&1)<<7;else o[n+7*f+v]=l})}}).add([89,1],(a,h,s)=>{let i=(a[0]<<21)+(a[1]<<14)+(a[2]<<7)+a[3];O()&&console.debug(`MU1000 EPROM jump to 0x${i.toString(16).padStart(6,"0")}.`),e.eprom&&(e.eprom.offset=i)}).add([89,2],(a,h,s)=>{if(e.eprom){let i=(a[0]<<21)+(a[1]<<14)+(a[2]<<7)+a[3]+(e.eprom.offset||0);O()&&console.debug(`MU1000 EPROM write to 0x${i.toString(16).padStart(6,"0")}.`);let n=e.eprom.data;a.subarray(4).forEach((o,l)=>{let u=l>>3,f=l&7;if(f==7)for(let v=0;v<7;v++)n[i+7*u+v]+=(o>>6-v&1)<<7;else n[i+7*u+f]=o})}}).add([89,3],(a,h,s)=>{}),t(this,ue).add([39,48],(a,h,s)=>{}).add([43,0,0],(a,h,s)=>{e.dispatchEvent("mupromptex");let i=[0,0,0,0],n=(o,l)=>{i[l]=o};if(a.subarray(1).forEach((o,l)=>{let u=l+a[0];[n,n,n,n,()=>{x(this,X,o*129/16383*100),e.dispatchEvent("mastervolume",t(e,X))},()=>o-64,()=>o||128,()=>o,()=>o,()=>{console.debug(`TG300 variation on cc${o}.`)}][u](o,u)}),a[0]<4){let o=0;i.forEach(l=>{o=o<<4,o+=l}),o-=1024}}).add([43,1,0],(a,h,s)=>{e.dispatchEvent("mupromptex")}).add([43,2],(a,h,s)=>{e.dispatchEvent("mupromptex");let i=e.chRedir(a[0],h,!0),n=a[1],o=H[i],l=`TG300 CH${i+1} `;a.subarray(2).forEach((u,f)=>{f<5?([()=>{},()=>{e.setChCc(i,0,u),e.pushChPrimitives(i),e.dispatchEvent("voice",{part:i})},()=>{e.setChCc(i,32,u),e.pushChPrimitives(i),e.dispatchEvent("voice",{part:i})},()=>{t(e,B)[i]=u,e.dispatchEvent("voice",{part:i})},()=>{let v=e.chRedir(u,h,!0);t(e,Y)[i]=v,i!=v&&(e.buildRchTree(),console.info(`${l}receives from CH${v+1}`))}][f+n]||(()=>{}))(u,f+n):f<21||(f<47?([()=>{t(e,le)[i]=+!u},()=>{},()=>{},()=>{t(e,A)[b.rpn*i+3]=u,t(e,U)[b.rpnt*i+2]=1,e.dispatchEvent("pitch",{part:i,pitch:e.getPitchShift(i)})},()=>{},()=>{e.setChCc(i,7,u)},!1,!1,()=>{e.setChCc(i,10,u||128)},!1,!1,()=>{console.debug(`${l} AC1 at cc${u}`)},()=>{console.debug(`${l} AC2 at cc${u}`)},()=>{t(e,w)[o+$[128]]=u,e.allocateAce(i,128)},()=>{t(e,w)[o+$[93]]=u},()=>{t(e,w)[o+$[91]]=u},()=>{t(e,w)[o+$[94]]=u},()=>{t(e,w)[o+$[76]]=u},()=>{t(e,w)[o+$[77]]=u},()=>{t(e,w)[o+$[74]]=u},()=>{t(e,w)[o+$[71]]=u},()=>{t(e,w)[o+$[73]]=u},()=>{t(e,w)[o+$[75]]=u},()=>{t(e,w)[o+$[72]]=u},()=>{t(e,w)[o+$[78]]=u}][f+n-21]||(()=>{}))(u,f+n):f<95||([()=>{t(e,w)[o+$[65]]=u},()=>{t(e,w)[o+$[5]]=u}][f+n-95]||(()=>{}))(u,f+n))})}).add([43,7,0],(a,h,s)=>{let i=a[0];e.setLetterDisplay(a.subarray(1),"TG300 letter display",i)}).add([43,7,1],(a,h,s)=>{x(e,te,0),x(e,Ee,Date.now()+3200),t(e,pe,De).fill(0),a.forEach(function(i,n){let o=Math.floor(n/16),l=n%16,u=(l*3+o)*7,f=7,v=0;for(u-=l*5,o==2&&(f=2);v<f;)t(e,pe,De)[u+v]=i>>6-v&1,v++})}),t(this,be).add([66,18,0,0,127],(a,h,s)=>{e.switchMode("sc",!0),e.setPortMode(e.getTrackPort(h),2,k.sc),t(e,W)[k.sc][1]=t(e,L).sc,x(e,F,!1),t(e,Ie).fill(0),console.info(`GS system to ${["single","dual"][a[0]]} mode.`)}).add([66,18,64,0],(a,h,s)=>{switch(a[0]){case 127:{e.switchMode("gs",!0),e.setPortMode(e.getTrackPort(h),2,k.gs),t(e,W)[k.gs][1]=t(e,L).gs,x(e,F,!1),t(e,Ie).fill(0),console.info("MIDI reset: GS");break}default:{e.dispatchEvent("mupromptex");let i=[0,0,0,0],n=(o,l)=>{i[l]=o};if(a.subarray(1).forEach((o,l)=>{let u=l+a[0];[n,n,n,n,f=>{x(this,X,f*129/16383*100),e.dispatchEvent("mastervolume",t(e,X))},f=>{},f=>{}][u](o,l)}),a[0]<4){let o=0;i.forEach(l=>{o=o<<4,o+=l}),o-=1024}}}}).add([66,18,64,1],(a,h,s)=>{e.dispatchEvent("mupromptex");let i=a[0];if(i<16){let n="".padStart(i," ");a.subarray(1).forEach((o,l)=>{n+=String.fromCharCode(Math.max(32,o))}),n=n.padEnd(16," "),console.debug(`GS patch name: ${n}`)}else i<48||(i<65?a.subarray(1).forEach((n,o)=>{let l=`GS ${i+o>55?"chorus":"reverb"} `;([()=>{console.info(`${l}type: ${Vt[n]}`),e.setEffectType(0,40,n),e.dispatchEvent("efxreverb",e.getEffectType(0))},()=>{},()=>{},()=>{},()=>{},()=>{},!1,()=>{console.debug(`${l}predelay: ${n}ms`)},()=>{console.info(`${l}type: ${fr[n]}`),e.setEffectType(1,40,16+n),e.dispatchEvent("efxchorus",e.getEffectType(1))},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{console.debug(`${l}to reverb: ${ce(n)}`)},()=>{console.debug(`${l}to delay: ${ce(n)}`)}][i+o-48]||(()=>{}))()}):i<80?console.debug(`Unknown GS patch address: ${i}`):i<91?a.subarray(1).forEach((n,o)=>{let l="GS delay ";([()=>{console.info(`${l}type: ${ur[n]}`),e.setEffectType(2,40,32+n),e.dispatchEvent("efxdelay",e.getEffectType(2))},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{console.debug(`${l}to reverb: ${ce(n)}`)}][i+o-80]||(()=>{}))()}):console.debug(`Unknown GS patch address: ${i}`))}).add([66,18,64,2],(a,h,s)=>{let i="GS EQ ";a.subarray(1).forEach((n,o)=>{([()=>{console.debug(`${i}low freq: ${[200,400][n]}Hz`)},()=>{console.debug(`${i}low gain: ${n-64}dB`)},()=>{console.debug(`${i}high freq: ${[3e3,6e3][n]}Hz`)},()=>{console.debug(`${i}high gain: ${n-64}dB`)}][a[0]+o]||function(){console.warn(`Unknown GS EQ address: ${a[0]+o}`)})()})}).add([66,18,64,3],(a,h,s)=>{e.dispatchEvent("mupromptex");let i="GS EFX ",n=function(o,l){let u=pr(t(e,he).subarray(10,12),l,o);u&&console.debug(`${i}${Ft(t(e,he).subarray(10,12))} ${u}`)};a.subarray(1).forEach((o,l)=>{([()=>{e.setEffectTypeRaw(3,!1,32+o),e.dispatchEvent("efxinsert0",e.getEffectType(3))},()=>{e.setEffectTypeRaw(3,!0,o),console.info(`${i}type: ${Ft(t(e,he).subarray(10,12))}`),e.dispatchEvent("efxinsert0",e.getEffectType(3))},!1,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,()=>{console.debug(`${i}to reverb: ${ce(o)}dB`)},()=>{console.debug(`${i}to chorus: ${ce(o)}dB`)},()=>{console.debug(`${i}to delay: ${ce(o)}dB`)},!1,()=>{console.debug(`${i}1 source: ${o}`),o&&o<96&&e.allocateAceAll(o)},()=>{console.debug(`${i}1 depth: ${o-64}`)},()=>{console.debug(`${i}2 source: ${o}`),o&&o<96&&e.allocateAceAll(o)},()=>{console.debug(`${i}2 depth: ${o-64}`)},()=>{console.debug(`${i}to EQ: ${o?"ON":"OFF"}`)}][a[0]+l]||function(u,f){console.warn(`Unknown GS EFX address: ${f}`)})(o,a[0]+l)})}).add([66,18,65],(a,h,s)=>{m((a[0]>>4)+1<<1,a[0]&15,a.subarray(1))}).add([69,18,16],(a,h,s)=>{var i;switch(a[0]){case 0:{let n=a[1];e.setLetterDisplay(a.subarray(2),"GS display text",n);break}case 8:{let n=a[1],o=e.modelEx.sc;a.subarray(2).forEach((l,u)=>{([()=>{o.showBar=!(l&1),o.invBar=l>>1&1,o.invDisp=l>>2&1},()=>{o.peakHold=l<4?l:1}][u+n]||(()=>{console.debug("Unsupported GS display type SysEx.")}))()});break}case 32:{x(e,Ee,Date.now()+3200),a[1]==0&&(a[2]?(x(e,te,Math.max(Math.min(a[2]-1,9),0)),O()&&console.debug(`GS switch display page ${a[2]-1}.`)):(x(e,te,0),x(e,Ee,Date.now()),O()&&console.debug("GS disable display page.")));break}default:if(a[0]<6){t(e,te)>9&&x(e,te,0);let n=a[0]-1<<1|a[1]>>6;t(e,te)==n&&x(e,Ee,Date.now()+3200),(i=t(e,Ae)[n])!=null&&i.length||(t(e,Ae)[n]=new Uint8Array(256));let o=t(e,Ae)[n];O()&&console.debug(`GS frame draw page ${n}.`);let l=a[1]&63;o.fill(0),a.subarray(2).forEach(function(f,v){let y=v+l,T=Math.floor(y/16),D=y%16,M=(D*4+T)*5,I=5,K=0;for(M-=D*4,T==3&&(I=1);K<I;)o[M+K]=f>>4-K&1,K++})}else console.warn(`Unknown GS display section: ${a[0]}`)}}).add([69,18,32],(a,h,s)=>{let i=a[0],n=a[1],o=a.subarray(2);if(i>>4){console.warn(`SC-8850 partial screen dump out of bounds: invalid bundle.
`,a);return}let l=n+o.length,u=n*6-(n*2428>>16<<1),f=l*6-(l*2428>>16<<1);if(u>640){console.warn(`SC-8850 partial screen dump out of bounds: invalid buffer range.
`,a);return}f>640&&(console.info(`SC-8850 partial screen dump out of bounds: invalid buffer end, automatically restricted.
`,a),f=640);let v=new Uint8Array(f-u);o.forEach((D,M)=>{let I=M+n,K=(I*2428&65535)*27>>16==26,V=I*6-(I*2428>>16<<1),Re=K?2:0;for(;Re<6;)v[V+(5-Re)]=D>>Re&1,Re++});let y=i*108+n,T=y*6-(y*2428>>16<<1);e.dispatchEvent("screen",{type:"sc8850",offset:T,data:v}),O()&&console.debug(`SC-8850 screen dump: bundle ${i+1}, range ${u}~${f}`)});let C=function(a,h,s){e.dispatchEvent("mupromptex");let i=a[0],n=H[h],o=It[h],l=`GS CH${h+1} `;i<3?(a.subarray(1).forEach((u,f)=>{[()=>{t(e,w)[n+$[0]]=u,e.pushChPrimitives(h)},()=>{t(e,B)[h]=u},()=>{let v=0;u<16?v=e.chRedir(u,s,!0):v=b.ch,t(e,Y)[h]=v,h!=v&&(e.buildRchTree(),console.info(`${l}receives from CH${v+1}`))}][i+f]()}),e.dispatchEvent("voice",{part:h})):i<19||(i<44?a.subarray(1).forEach((u,f)=>{([()=>{t(e,le)[h]=+!u},!1,()=>{e.setChType(h,u<<1,k.gs),console.debug(`${l}type: ${u?"drum ":"melodic"}${u||""}`)},()=>{t(e,A)[o+3]=u,t(e,U)[b.rpnt*h+2]=1,e.dispatchEvent("pitch",{part:h,pitch:e.getPitchShift(h)})},!1,()=>{t(e,w)[n+$[7]]=u},!1,!1,()=>{t(e,w)[n+$[10]]=u||128},!1,!1,()=>{console.debug(`${l}CC 1: cc${u}`)},()=>{console.debug(`${l}CC 2: cc${u}`)},()=>{t(e,w)[n+$[93]]=u},()=>{t(e,w)[n+$[91]]=u},!1,!1,()=>{t(e,A)[o+1]=u,t(e,U)[b.rpnt*h+1]=1,e.dispatchEvent("pitch",{part:h,pitch:e.getPitchShift(h)})},()=>{t(e,A)[o+2]=u,t(e,U)[b.rpnt*h+1]=1,e.dispatchEvent("pitch",{part:h,pitch:e.getPitchShift(h)})},()=>{t(e,w)[n+$[94]]=u}][i+f-19]||(()=>{}))()}):i<76||console.debug(`Unknown GS part address: ${i}`))},E=function(a,h){let s=a[0],i=`GS CH${h+1} `;s<2?a.subarray(1).forEach((n,o)=>{[()=>{e.setChCc(h,32,n)},()=>{}][s+o]()}):s<32?console.warn(`Unknown GS misc address: ${s}`):s<35?a.subarray(1).forEach((n,o)=>{[()=>{console.debug(`${i}EQ: o${["ff","n"][n]}`)},()=>{},()=>{console.debug(`${i}EFX: o${["ff","n"][n]}`),t(e,ut)[h]=n,e.dispatchEvent("partefxtoggle",{part:h,active:n})}][s+o-32]()}):console.warn(`Unknown GS misc address: ${s}`)};t(this,be).add([66,18,64,16],(a,h)=>{C(a,e.chRedir(9,h,!0),h)}).add([66,18,64,17],(a,h)=>{C(a,e.chRedir(0,h,!0),h)}).add([66,18,64,18],(a,h)=>{C(a,e.chRedir(1,h,!0),h)}).add([66,18,64,19],(a,h)=>{C(a,e.chRedir(2,h,!0),h)}).add([66,18,64,20],(a,h)=>{C(a,e.chRedir(3,h,!0),h)}).add([66,18,64,21],(a,h)=>{C(a,e.chRedir(4,h,!0),h)}).add([66,18,64,22],(a,h)=>{C(a,e.chRedir(5,h,!0),h)}).add([66,18,64,23],(a,h)=>{C(a,e.chRedir(6,h,!0),h)}).add([66,18,64,24],(a,h)=>{C(a,e.chRedir(7,h,!0),h)}).add([66,18,64,25],(a,h)=>{C(a,e.chRedir(8,h,!0),h)}).add([66,18,64,26],(a,h)=>{C(a,e.chRedir(10,h,!0),h)}).add([66,18,64,27],(a,h)=>{C(a,e.chRedir(11,h,!0),h)}).add([66,18,64,28],(a,h)=>{C(a,e.chRedir(12,h,!0),h)}).add([66,18,64,29],(a,h)=>{C(a,e.chRedir(13,h,!0),h)}).add([66,18,64,30],(a,h)=>{C(a,e.chRedir(14,h,!0),h)}).add([66,18,64,31],(a,h)=>{C(a,e.chRedir(15,h,!0),h)}).add([66,18,64,64],(a,h)=>{E(a,e.chRedir(9,h,!0))}).add([66,18,64,65],(a,h)=>{E(a,e.chRedir(0,h,!0))}).add([66,18,64,66],(a,h)=>{E(a,e.chRedir(1,h,!0))}).add([66,18,64,67],(a,h)=>{E(a,e.chRedir(2,h,!0))}).add([66,18,64,68],(a,h)=>{E(a,e.chRedir(3,h,!0))}).add([66,18,64,69],(a,h)=>{E(a,e.chRedir(4,h,!0))}).add([66,18,64,70],(a,h)=>{E(a,e.chRedir(5,h,!0))}).add([66,18,64,71],(a,h)=>{E(a,e.chRedir(6,h,!0))}).add([66,18,64,72],(a,h)=>{E(a,e.chRedir(7,h,!0))}).add([66,18,64,73],(a,h)=>{E(a,e.chRedir(8,h,!0))}).add([66,18,64,74],(a,h)=>{E(a,e.chRedir(10,h,!0))}).add([66,18,64,75],(a,h)=>{E(a,e.chRedir(11,h,!0))}).add([66,18,64,76],(a,h)=>{E(a,e.chRedir(12,h,!0))}).add([66,18,64,77],(a,h)=>{E(a,e.chRedir(13,h,!0))}).add([66,18,64,78],(a,h)=>{E(a,e.chRedir(14,h,!0))}).add([66,18,64,79],(a,h)=>{E(a,e.chRedir(15,h,!0))}),t(this,Me).add([54,65],(a,h)=>{let s=t(e,L).x5=="81"?"05rw":"x5d";e.switchMode(s,!0),e.setPortMode(e.getTrackPort(h),1,k[s]);let i=a[a.length-1],n=a.subarray(0,a.length-1),o=Le(n);o!=i&&(console.info(`X5D multi parameters checksum mismatch! Expected ${o}, got ${i}.`),console.debug(a));let l=(a[1]<<7)+a[0],u=(a[3]<<7)+a[2],f=e.chRedir(l&15,h,!0),v=H[f];[()=>{u<1||(u<101?(e.setChType(f,e.CH_MELODIC,k.x5d),t(e,B)[f]=u-1,t(e,w)[v+$[0]]=t(e,L).x5):u<229?(e.setChType(f,e.CH_MELODIC,k.x5d),t(e,B)[f]=u-101,t(e,w)[v+$[0]]=56):(e.setChType(f,e.CH_DRUMS,k.x5d),t(e,B)[f]=wr[u-229]||0,t(e,w)[v+$[0]]=62)),e.pushChPrimitives(f),e.dispatchEvent("voice",{part:f})},()=>{t(e,w)[v+$[7]]=u},()=>{u<31&&(t(e,w)[v+$[10]]=Math.round((u-15)*4.2+64))},()=>{t(e,w)[v+$[93]]=kt(u)},()=>{t(e,w)[v+$[91]]=kt(u)},()=>{t(e,A)[f*b.rpn+3]=u>8191?u-16320:64+u,t(e,U)[b.rpnt*f+2]=1,e.dispatchEvent("pitch",{part:f,pitch:e.getPitchShift(f)})},()=>{t(e,A)[f*b.rpn+1]=u>8191?u-16320:64+u,t(e,U)[b.rpnt*f+1]=1,e.dispatchEvent("pitch",{part:f,pitch:e.getPitchShift(f)})},()=>{u>0&&(t(e,A)[f*b.rpn]=u,t(e,U)[b.rpnt*f]=1,e.dispatchEvent("pitch",{part:f,pitch:e.getPitchShift(f)}))},()=>{}][l>>4]()}).add([54,76,0],(a,h)=>{e.dispatchEvent("mupromptex");let s=t(e,L).x5=="81"?"05rw":"x5d";e.switchMode(s),e.setPortMode(e.getTrackPort(h),1,k[s]);let i="",n=t(e,L).x5,o=0,l=0,u="MSB	PRG	LSB	NME";ve(a,function(f,v){if(v<16400){let y=v%164;switch(!0){case y<10:{f>31&&(i+=String.fromCharCode(f));break}case y==10:break;case y==11:{u+=`
${n}	${o}	${l}	${i.trim().replace("Init Voice","")}`,o++,i="";break}}o>99&&(n=90,o=0)}}),e.userBank.clearRange({msb:t(e,L).x5,prg:[0,99],lsb:0}),e.userBank.load(u),O()&&console.debug(u),e.forceVoiceRefresh()}).add([54,77,0],(a,h)=>{e.dispatchEvent("mupromptex");let s=t(e,L).x5=="81"?"05rw":"x5d";e.switchMode(s),e.setPortMode(e.getTrackPort(h),1,k[s]);let i="",n=90,o=0,l=0,u="MSB	PRG	LSB	NME";ve(a,function(f,v){if(v<13600){let y=v%136;switch(!0){case y<10:{f>31&&(i+=String.fromCharCode(f));break}case y==11:{u+=`
${n}	${o}	${l}	${i.trim().replace("Init Combi","")}`,o++,i="";break}}}}),e.userBank.clearRange({msb:90,prg:[0,99],lsb:0}),e.userBank.load(u),O()&&console.debug(u),e.forceVoiceRefresh()}).add([54,78],(a,h)=>{let s=t(e,L).x5=="81"?"05rw":"x5d";e.switchMode(s),e.setPortMode(e.getTrackPort(h),1,k[s]),console.debug(`X5D mode switch requested: ${["combi","combi edit","prog","prog edit","multi","global"][a[0]]} mode.`)}).add([54,85],(a,h)=>{e.dispatchEvent("mupromptex");let s=t(e,L).x5=="81"?"05rw":"x5d";e.switchMode(s),e.setPortMode(e.getTrackPort(h),1,k[s]),ve(a,(i,n)=>{n>0&&n<3&&(e.setEffectType(n-1,44,i),e.dispatchEvent(`efx${["reverb","chorus"][n-1]}`,e.getEffectType(n-1)))})}).add([54,104],(a,h)=>{e.dispatchEvent("mupromptex");let s=t(e,L).x5=="81"?"05rw":"x5d";e.switchMode(s,!0);let i=e.getTrackPort(h);if(t(e,q)[i]&&t(e,q)[i]!=k[s])if(t(e,Se).dumpLimit==e.DUMP_MODE){console.warn(`Dump cancelled for track ${h}. Port ${String.fromCharCode(65+i)} mode "${z[t(e,q)[i]]}" mismatch, should be "${s}".`);return}else console.info(`Track ${h} is trying to perform a mismached mode dump on port ${String.fromCharCode(65+i)}.`);e.setPortMode(i,1,k[s]),ve(a,function(n,o,l,u){if(o<192){let f=e.chRedir(Math.floor(o/12),h,!0),v=H[f];switch(o%12){case 0:{n<128?(e.setChType(f,e.CH_MELODIC,k.x5d),t(e,w)[v+$[0]]=t(e,L).x5,t(e,B)[f]=n):(e.setChType(f,e.CH_DRUMS,k.x5d),t(e,w)[v+$[0]]=62,t(e,B)[f]=wr[n-128]),n>0&&e.setChActive(f,1),e.pushChPrimitives(f),e.dispatchEvent("voice",{part:f});break}case 1:{t(e,w)[v+$[7]]=n;break}case 2:{t(e,A)[f*b.rpn+3]=n>127?n-192:64+n,t(e,U)[b.rpnt*f+2]=1,e.dispatchEvent("pitch",{part:f,pitch:e.getPitchShift(f)});break}case 3:{t(e,A)[f*b.rpn+1]=n>127?n-192:64+n,t(e,U)[b.rpnt*f+1]=1,e.dispatchEvent("pitch",{part:f,pitch:e.getPitchShift(f)});break}case 4:{n<31&&(t(e,w)[v+$[10]]=Math.round((n-15)*4.2+64));break}case 5:{let y=n>>4,T=n&15;t(e,w)[v+$[91]]=kt(T),t(e,w)[v+$[93]]=kt(y);break}case 10:{t(e,R)[f]||(t(e,w)[v+$[0]]=n>>6?56:t(e,L).x5,e.pushChPrimitives(f),e.dispatchEvent("voice",{part:f}));break}case 11:{let y=e.chRedir(n&15,h,!0),T=n>>4;t(e,Y)[f]=n,(y!=f||T)&&(console.info(`X5D Part CH${f+1} receives from CH${y+1}.`),e.buildRchTree())}}}else{let f=e.chRedir(o-192,h,!0)}})}),t(this,be).add([22,18,127],(a,h,s)=>{e.switchMode("mt32",!0),e.setPortMode(e.getTrackPort(h),1,k.mt32),x(e,F,!1),e.userBank.clearRange({msb:0,lsb:127,prg:[0,127]}),console.info("MIDI reset: MT-32")}).add([22,18,0],(a,h,s)=>{e.switchMode("mt32");let i=e.chRedir(s,h,!0),n=a[1];a.subarray(2).forEach((o,l)=>{let u=l+n;t(e,Ue)[u+(i-1)*16]=o,([!1,()=>{let f=t(e,Ue)[i-1<<4];if(f<3){if(t(e,Ce)[i]=1,f==2)for(let v=0;v<name.length;v++)t(e,we)[(i-1)*b.cmt+v]=t(e,Ne)[o*b.cmt+v];else{let v=e.baseBank.get(0,o+(f<<6),127,"mt32").name;for(let y=0;y<v.length;y++)t(e,we)[(i-1)*b.cmt+y]=v.charCodeAt(y)}e.dispatchEvent("voice",{part:i})}},()=>{t(e,A)[i*b.rpn+3]=o+40,t(e,U)[b.rpnt*i+2]=1},()=>{t(e,A)[i*b.rpn+1]=o+14,t(e,U)[b.rpnt*i+1]=1},()=>{t(e,A)[i*b.rpn]=o,t(e,U)[b.rpnt*i]=1},!1,()=>{e.setChCc(i,91,o?127:0)},!1,()=>{e.setChCc(i,7,o)},()=>{e.setChCc(i,10,Math.ceil(o*9.05))}][u]||(()=>{}))()})}).add([22,18,1],(a,h,s)=>{e.switchMode("mt32");let i=s&7;console.debug(`MT-32 slot #${s+1} Drum: ${a}`);let n=a[0]<<7|a[1];a.subarray(2).forEach((o,l)=>{let u=l+n,f=(u>>2)+24,v=u&3,y=i*b.dpn;if(O()&&console.debug(`MT-32 temp drum note ${f} param ${v}: ${o}`),f<24){console.warn(`MT-32 dev drum write attempted on an OOB note: ${f}`);return}[()=>{},()=>{t(e,ie)[(y+ge[26])*b.dnc+f]=Math.round(o*1.27)},()=>{t(e,ie)[(y+ge[26])*b.dnc+f]=o*9+1&127},()=>{t(e,ie)[(y+ge[26])*b.dnc+f]=o?127:0}][v]()})}).add([22,18,2],(a,h,s)=>{e.switchMode("mt32");let i=e.chRedir(s,h,!0),n=a[1]+(a[0]<<7);n<10&&(t(e,Ce)[i]=1),a.subarray(2).forEach((o,l)=>{let u=l+n;u<14&&(t(e,we)[(i-1)*b.cmt+u]=o)}),e.dispatchEvent("voice",{part:i})}).add([22,18,3],(a,h,s)=>{e.switchMode("mt32");let i=s&7;if(a[0]){let n=(a[0]-1<<7)+a[1]-16;a.subarray(2).forEach((o,l)=>{let u=l+n,f=(u>>2)+24,v=u&3,y=i*b.dpn;if(O()&&console.debug(`MT-32 dev drum note ${f} param ${v}: ${o}`),f<24){console.warn(`MT-32 dev drum write attempted on an OOB note: ${f}`);return}[()=>{},()=>{t(e,ie)[(y+ge[26])*b.dnc+f]=Math.round(o*1.27)},()=>{t(e,ie)[(y+ge[26])*b.dnc+f]=o*9+1&127},()=>{t(e,ie)[(y+ge[26])*b.dnc+f]=o?127:0}][v]()})}else{let n=a[1];a.subarray(2).forEach((o,l)=>{let u=l+n;t(e,Ue)[u]=o;let f=e.chRedir(1+(u>>4),h,!0),v=u&15;([!1,()=>{let y=t(e,Ue)[f-1<<4];if(y<3)if(t(e,Ce)[f]=1,y==2)for(let T=0;T<name.length;T++)t(e,we)[(f-1)*b.cmt+T]=t(e,Ne)[o*b.cmt+T];else{let T=e.baseBank.get(0,o+(y<<6),127,"mt32").name;for(let D=0;D<T.length;D++)t(e,we)[(f-1)*b.cmt+D]=T.charCodeAt(D)}e.dispatchEvent("voice",{part:f})},()=>{t(e,A)[f*b.rpn+3]=o+40,t(e,U)[b.rpnt*f+2]=1},()=>{t(e,A)[f*b.rpn+1]=o+14,t(e,U)[b.rpnt*f+1]=1},()=>{t(e,A)[f*b.rpn]=o,t(e,U)[b.rpnt*f]=1},!1,()=>{e.setChCc(f,91,o?127:0)},!1,()=>{e.setChCc(f,7,o)},()=>{e.setChCc(f,10,Math.ceil(o*9.05))}][v]||(()=>{}))()})}}).add([22,18,4],(a,h,s)=>{e.switchMode("mt32");let i=a[1]+(a[0]<<7),n=[];a.subarray(2).forEach((o,l)=>{let u=l+i,f=e.chRedir(Math.floor(u/246+1),h,!0),v=u%246;v<14&&(t(e,we)[(f-1)*b.cmt+v]=o),v<10&&(t(e,Ce)[f]=1),n.indexOf(f)<0&&n.push(f)}),n.forEach(o=>{e.dispatchEvent("voice",{part:o})})}).add([22,18,5],(a,h,s)=>{e.switchMode("mt32");let i=(a[0]<<7)+a[1];a.subarray(2).forEach((n,o)=>{let l=i+o,u=Math.floor(l/8),f=l&7,v=u*8;t(e,pt)[l]=n,([!1,()=>{let y=t(e,pt)[v];if(y<3){let T="";if(y==2){let M=b.cmt*u;T=`MT-m:${n.toString().padStart(3,"0")}`}else T=e.baseBank.get(0,n+(y<<6),127,"mt32").name;e.userBank.clearRange({msb:0,lsb:127,prg:u});let D=`MSB	LSB	PRG	NME
49	127	${u}	${T}`;e.userBank.load(D,!0)}}][f]||(()=>{}))()}),e.forceVoiceRefresh()}).add([22,18,8],(a,h,s)=>{e.switchMode("mt32");let i=((a[0]&1)<<7)+a[1],n=a[0]>>1,o=!1;if(a.subarray(2).forEach((l,u)=>{let f=i+u;f<b.cmt&&(t(e,Ne)[n*b.cmt+f]=l,o=!0)}),o){e.userBank.clearRange({msb:0,lsb:127,prg:n});let l=`MSB	LSB	PRG	NME
49	127	${n}	MT-m:${n}`;e.userBank.load(l,!0)}e.forceVoiceRefresh()}).add([22,18,16],(a,h,s)=>{e.switchMode("mt32");let i=a[1],n=!1,o=function(l,u){t(e,Y)[u-12]=l,n=!0};a.subarray(2).forEach((l,u)=>{let f=u+i;([!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,o,o,o,o,o,o,o,o,o,()=>{x(e,X,l),e.dispatchEvent("mastervolume",t(e,X))}][f]||(()=>{}))(l,u)}),n&&e.buildRchTree()}).add([22,18,32],(a,h,s)=>{e.switchMode("mt32");let i=a[1],n=" ".repeat(i);a.subarray(2).forEach(o=>{o>31?n+=String.fromCharCode(o):n+=" "}),x(e,He,n.padStart(20," ")),x(e,_e,Date.now()+3200)}).add([22,18,82],(a,h)=>{let s=e.chRedir(0,h,!0);for(let i=0;i<16;i++)t(e,Q).ano(s+i),i&&i<10&&(t(e,B)[s+i]=Kt[i-1]);console.info("MT-32 alt reset complete.")}),t(this,Me).add([66,0],(a,h)=>{e.switchMode("ns5r",!0),e.setPortMode(e.getTrackPort(h),2,k.ns5r),x(e,F,!1),console.debug(`NS5R mode switch requested: ${["global","multi","prog edit","comb edit","drum edit","effect edit"][a[0]]} mode.`)}).add([66,1],(a,h)=>{let s=["ns5r","05rw"][a[0]];e.switchMode(s,!0),e.setPortMode(e.getTrackPort(h),2,k[s]),x(e,F,!1)}).add([66,18,0,0],(a,h)=>{let s=a[0];switch(s){case 124:case 126:case 127:{e.switchMode("ns5r",!0),e.setPortMode(e.getTrackPort(h),2,k.ns5r),x(e,F,!1);break}case 125:{e.initDrums(),console.info(`NS5R drum setup reset: ${a}`);break}default:if(s<10){let i=[0,0,0,0],n=(o,l)=>{i[l]=o};if(a.subarray(1).forEach((o,l)=>{[n,n,n,n,()=>{x(e,X,o*129/16383*100),e.dispatchEvent("mastervolume",t(e,X))},()=>o-64,()=>o-64,()=>{},()=>{},()=>{}][s+l]()}),a[0]<4){let o=0;i.forEach(l=>{o=o<<4,o+=l}),o-=1024}}}}).add([66,18,0,1],(a,h)=>{}).add([66,18,0,2],(a,h)=>{}).add([66,18,1],(a,h)=>{e.dispatchEvent("mupromptex");let s=e.chRedir(a[0],h,!0),i=H[s],n=a[1],o=`NS5R CH${s+1} `;a.subarray(2).forEach((l,u)=>{let f=n+u;f<3?([()=>{t(e,w)[i+$[0]]=l||$e.bank0,e.pushChPrimitives(s)},()=>{t(e,w)[i+$[32]]=l,e.pushChPrimitives(s)},()=>{t(e,B)[s]=l}][f](),e.dispatchEvent("voice",{part:s})):f<8||(f<14?[()=>{let v=e.chRedir(l,h,!0);t(e,Y)[s]=v,s!=v&&(e.buildRchTree(),console.info(`${o}receives from CH${v+1}`))},()=>{t(e,le)[s]=+!l},()=>{e.setChType(s,l,k.ns5r),console.debug(`${o}type: ${$t[l]}`)},()=>{t(e,A)[b.rpn*s+3]=l,t(e,U)[b.rpnt*s+2]=1,e.dispatchEvent("pitch",{part:s,pitch:e.getPitchShift(s)})},()=>{},()=>{}][f-8]():f<16||(f<33?[()=>{t(e,w)[i+$[7]]=l},()=>{t(e,w)[i+$[11]]=l},()=>{},()=>{},()=>{t(e,w)[i+$[10]]=l||128},()=>{},()=>{},()=>{t(e,w)[i+$[93]]=l},()=>{t(e,w)[i+$[91]]=l},()=>{t(e,w)[i+$[76]]=l},()=>{t(e,w)[i+$[77]]=l},()=>{t(e,w)[i+$[78]]=l},()=>{t(e,w)[i+$[74]]=l},()=>{t(e,w)[i+$[71]]=l},()=>{t(e,w)[i+$[73]]=l},()=>{t(e,w)[i+$[75]]=l},()=>{t(e,w)[i+$[72]]=l}][f-16]():f<112||f<114&&[()=>{t(e,w)[i+$[5]]=l},()=>{t(e,w)[i+$[65]]=l}][f-112]()))})}).add([66,18,8,0],(a,h)=>{let s=a[0];if(s<32)e.setLetterDisplay(a.subarray(1,33),"NS5R letter display");else{let i=s-32;x(e,Ee,Date.now()+3200),x(e,te,10),t(e,pe,De).fill(0);let n=a.subarray(1),o=4;n.forEach(function(l,u){let f=u+i,v=f>>4,y=f&15;if(f<80){let T=v<o?l:l>>3,D=0,M=v<o?6:3;for(;T>0;)t(e,pe,De)[y*32+v*7+(M-D)]=T&1,T=T>>1,D++}})}}).add([66,18,48],(a,h,s)=>{p(0,a)}).add([66,18,49],(a,h,s)=>{p(1,a)}).add([66,18,50],(a,h,s)=>{p(2,a)}).add([66,18,51],(a,h,s)=>{p(3,a)}).add([66,18,52],(a,h,s)=>{p(4,a)}).add([66,18,53],(a,h,s)=>{p(5,a)}).add([66,18,54],(a,h,s)=>{p(6,a)}).add([66,18,55],(a,h,s)=>{p(7,a)}).add([66,52],(a,h)=>{e.switchMode("ns5r"),x(e,F,!1);let s="";ve(a,(i,n)=>{n<8?(i>31&&(s+=String.fromCharCode(i)),n==7&&(e.aiEfxName=s)):n<10&&(e.setEffectType(n-8,44,i),e.dispatchEvent(`efx${["reverb","chorus"][n-8]}`,e.getEffectType(n-8)))})}).add([66,53],(a,h)=>{e.dispatchEvent("mupromptex"),e.switchMode("ns5r"),x(e,F,!1);let s="",i=a[a.length-1],n=a.subarray(0,a.length-1),o=Le(n);o!=i&&(console.info(`NS5R current multi dump checksum mismatch! Expected ${o}, got ${i}.`),console.debug(a));let l=e.getTrackPort(h);if(t(e,q)[l]&&t(e,q)[l]!=k.ns5r)if(t(e,Se).dumpLimit==e.DUMP_MODE){console.warn(`Dump cancelled for track ${h}. Port ${String.fromCharCode(65+l)} mode "${z[t(e,q)[l]]}" mismatch, should be "ns5r".`);return}else console.info(`Track ${h} is trying to perform a mismached mode dump on port ${String.fromCharCode(65+l)}.`);e.setPortMode(l,2,k.ns5r),ve(n,function(u,f){switch(!0){case f<2944:{let v=e.chRedir(Math.floor(f/92),h,!0),y=H[v];switch(f%92){case 0:{t(e,w)[y+$[0]]=u,e.pushChPrimitives(v),e.dispatchEvent("voice",{part:v});break}case 1:{t(e,w)[y+$[32]]=u,!u&&!t(e,w)[y+$[0]]&&(t(e,w)[y+$[0]]=$e.bank0),e.pushChPrimitives(v),e.dispatchEvent("voice",{part:v});break}case 2:{t(e,B)[v]=u,u>0&&e.setChActive(v,1),e.dispatchEvent("voice",{part:v});break}case 3:{let T=e.chRedir(u,h,!0);t(e,Y)[v]=T,v!=T&&(console.info(`NS5R CH${v+1} receives from CH${T+1}.`),e.buildRchTree());break}case 7:{t(e,R)[v]=u,e.dispatchEvent("voice",{part:v});break}case 8:{t(e,A)[v*b.rpn+3]=u<40||u>88?u+(u>63?-192:64):u,t(e,U)[b.rpnt*v+2]=1,e.dispatchEvent("pitch",{part:v,pitch:e.getPitchShift(v)});break}case 9:case 10:{t(e,w)[y+$[7]]=u;break}case 11:{t(e,w)[y+$[11]]=u;break}case 14:{t(e,w)[y+$[10]]=u||128;break}case 19:{t(e,w)[y+$[93]]=u;break}case 20:{t(e,w)[y+$[91]]=u;break}case 84:{t(e,w)[y+$[65]]=u;break}case 85:{t(e,w)[y+$[5]]=u;break}}break}case f<3096:break;case f<3134:{let v=f-3096;v<8?(u>31&&(s+=String.fromCharCode(u)),v==7&&(e.aiEfxName=s)):v<10&&(e.setEffectType(v-8,44,u),e.dispatchEvent(`efx${["reverb","chorus"][v-8]}`,e.getEffectType(v-8)));break}case f<8566:break}})}).add([66,54],(a,h)=>{e.dispatchEvent("mupromptex"),e.switchMode("ns5r");let s="",i=80,n=0,o=0,l="MSB	PRG	LSB	NME";ve(a,function(u,f){let v=f%158;switch(!0){case v<10:{u>31&&(s+=String.fromCharCode(u));break}case v==10:break;case v==11:{i=u&127;break}case v==12:{o=u&127;break}case v==13:{l+=`
${i}	${n}	${o}	${s.trim().replace("Init Voice","")}`,n++,s="";break}}}),e.userBank.clearRange({msb:80,lsb:0}),e.userBank.load(l),O()&&console.debug(l),e.forceVoiceRefresh()}).add([66,55],(a,h)=>{e.dispatchEvent("mupromptex"),e.switchMode("ns5r");let s="",i=88,n=0,o=0,l="MSB	PRG	LSB	NME";ve(a,function(u,f){let v=f%126;switch(!0){case v<10:{u>31&&(s+=String.fromCharCode(u));break}case v==11:break;case v==12:break;case v==13:{l+=`
${i}	${n}	${o}	${s.trim().replace("Init Combi","")}`,n++,s="";break}}}),e.userBank.clearRange({msb:88,lsb:0}),e.userBank.load(l),O()&&console.debug(l),e.forceVoiceRefresh()}).add([66,125],(a,h,s)=>{e.dispatchEvent("backlight",["green","orange","red",!1,"yellow","blue","purple"][a[0]]||"white")}).add([66,127],(a,h,s)=>{let i=a[a.length-1],n=a.subarray(0,a.length-1),o=Le(n);o!=i&&(console.info(`NS5R screen dump checksum mismatch! Expected ${o}, got ${i}.`),console.debug(a));let l=new Uint8Array(5760);ve(a,(u,f,v)=>{if(f<720)for(let y=0;y<8;y++)l[f*8+y]=u>>7-y&1}),e.dispatchEvent("screen",{type:"ns5r",data:l})}).add([76],(a,h,s)=>{t(e,Me).run([66,...a],h,s)}),t(this,tt).add([16,0,8,0],(a,h,s)=>{let i=(a[2]<<4)+a[3],n="K11 ";([()=>{e.switchMode("k11",!0),e.setPortMode(e.getTrackPort(h),2,k.k11),x(e,F,!1),t(e,W)[k.k11][1]=i?4:0,console.info("MIDI reset: GMega/K11")},()=>{e.setEffectType(0,24,i),console.debug(`${n}reverb type: ${i}`),e.dispatchEvent("efxreverb",e.getEffectType(0))},()=>{console.debug(`${n}reverb time: ${i}`)},()=>{console.debug(`${n}reverb time: ${i}`)},()=>{console.debug(`${n}reverb predelay: ${i}`)},()=>{console.debug(`${n}reverb predelay: ${i}`)},()=>{console.debug(`${n}depth high: ${i}`)},()=>{console.debug(`${n}depth high: ${i}`)},()=>{console.debug(`${n}depth low: ${i}`)},()=>{console.debug(`${n}depth low: ${i}`)}][a[0]]||(()=>{}))()}).add([16,0,8,1],(a,h,s)=>{e.dispatchEvent("mupromptex");let i=e.chRedir(a[1],h,!0),n=H[i],o=It[i],l=(a[3]<<4)+a[4],u=`K11 CH${i+1} `;([()=>{l<128?(e.setChType(i,e.CH_MELODIC,k.k11),t(e,w)[n+$[0]]=0,t(e,B)[i]=l):(e.setChType(i,e.CH_DRUMS,k.k11),t(e,B)[i]=l-128),e.pushChPrimitives(i),e.dispatchEvent("voice",{part:i})},()=>{let f=e.chRedir(l,h,!0);t(e,Y)[i]=f,i!=f&&(e.buildRchTree(),console.info(`${u}receives from CH${f+1}`))},()=>{t(e,w)[n+$[7]]=l},()=>{uupThis.setChActive(i,l)},()=>{t(e,w)[n+$[10]]=l},()=>{t(e,A)[o+3]=l+40,t(e,U)[b.rpnt*i+2]=1,e.dispatchEvent("pitch",{part:i,pitch:e.getPitchShift(i)})},()=>{t(e,A)[o+1]=l>>1,t(e,A)[o+2]=l&1,t(e,U)[b.rpnt*i+1]=1,e.dispatchEvent("pitch",{part:i,pitch:e.getPitchShift(i)})},()=>{t(e,w)[n+$[91]]=l?127:0},()=>{},()=>{t(e,w)[n+$[74]]=l},()=>{t(e,w)[n+$[73]]=l},()=>{t(e,w)[n+$[72]]=l}][a[0]]||(()=>{}))()}).add([16,0,9,0],(a,h,s)=>{e.dispatchEvent("mupromptex");let i=(a[2]<<4)+a[3],n="GMLX ";([()=>{console.debug(`${n}reverb type: ${i}`)},()=>{console.debug(`${n}reverb time: ${i}`)},()=>{console.debug(`${n}reverb predelay: ${i}`)},()=>{console.debug(`${n}depth high: ${i}`)},()=>{console.debug(`${n}depth low: ${i}`)}][a[0]]||(()=>{}))()}).add([16,0,9,3],(a,h,s)=>{e.dispatchEvent("mupromptex");let i=(a[2]<<4)+a[3],n=e.chRedir(a[1],h,!0),o=H[n];[()=>{i<128?(e.setChType(n,e.CH_MELODIC,k.k11),t(e,w)[o+$[0]]=0,t(e,w)[o+$[32]]=0,t(e,B)[n]=i):i<160?(e.setChType(n,e.CH_MELODIC,k.k11),t(e,w)[o+$[0]]=0,t(e,w)[o+$[32]]=7,t(e,B)[n]=i-100):(e.setChType(n,e.CH_DRUMS,k.k11),t(e,w)[o+$[0]]=122,t(e,w)[o+$[32]]=0,t(e,B)[n]=i-160),e.pushChPrimitives(n),e.dispatchEvent("voice",{part:n})},()=>{let l=e.chRedir(i,h,!0);t(e,Y)[n]=l,n!=l&&(e.buildRchTree(),console.info(`GMLX CH${n+1} receives from CH${l+1}`))}][a[0]]()}).add([16,0,9,4],(a,h,s)=>{e.dispatchEvent("mupromptex");let i=(a[2]<<4)+a[3],n=e.chRedir(a[1],h,!0),o=H[n],l=It[n],u=`GMLX CH${n+1} `;[()=>{e.setChActive(n,i)},()=>{t(e,w)[o+$[7]]=i},()=>{t(e,w)[o+$[10]]=i},()=>{t(e,w)[o+$[91]]=i?127:0},()=>{t(e,A)[l+3]=i+40,t(e,U)[b.rpnt*n+2]=1,e.dispatchEvent("pitch",{part:n,pitch:e.getPitchShift(n)})},()=>{t(e,A)[l+1]=i,t(e,U)[b.rpnt*n+1]=1,e.dispatchEvent("pitch",{part:n,pitch:e.getPitchShift(n)})},()=>{t(e,A)[l]=i,t(e,U)[b.rpnt*n]=1,e.dispatchEvent("pitch",{part:n,pitch:e.getPitchShift(n)})},()=>{}][a[0]]()}),t(this,rt).add([66,93,64],(a,h,s)=>{let i=a[2];switch(a[0]){case 0:{switch(a[1]){case 4:{e.dispatchEvent("mupromptex"),x(e,X,i*129/16383*100),e.dispatchEvent("mastervolume",t(e,X));break}case 5:{e.dispatchEvent("mupromptex"),i-64;break}case 6:{e.dispatchEvent("mupromptex"),console.debug(`SG global reverb: ${i?"on":"off"}`);break}case 127:{e.switchMode("sg",!0),e.setPortMode(e.getTrackPort(h),1,k.sg);break}}break}case 1:{switch(a[1]){case 48:{e.dispatchEvent("mupromptex"),console.debug(`SG reverb type: ${Vt[i]}`);break}}break}default:if(a[0]>>4==1){e.dispatchEvent("mupromptex");let n=e.chRedir(a[0]&15,h,!0);if(a[1]==2){let o=e.chRedir(i,h,!0);t(e,Y)[n]=o,n!=o&&(e.buildRchTree(),console.info(`SG CH${n+1} receives from CH${o+1}`))}else a[1]==19&&e.setChCc(n,7,i)}else console.warn(`Unknown AKAI SG SysEx: ${a}`)}}),t(this,at).add([9],(a,h,s)=>{e.dispatchEvent("mupromptex"),console.debug(`GZ set effect: ${["stage reverb","hall reverb","room reverb","chorus","tremolo","phaser","rotary speaker","enhancer","flanger","EQ"][a[0]]||"off"}`)}),t(this,ue).add([127,0],(a,h,s)=>{e.switchMode("motif");let i=new Uint8Array([127,1,...a]);t(e,ue).run(i,h,s)}).add([127,1,0,0],(a,h,s)=>{e.switchMode("s90es");let i="S90/Motif ES system ",n=a[0];a.subarray(1).forEach((o,l)=>{([()=>{x(e,X,o*12900/16383),e.dispatchEvent("mastervolume",t(e,X))}][n+l]||(()=>{console.info(`Unrecognized ${i}ID: ${n+l}`)}))()})}).add([127,1,0,36,54,1],(a,h,s)=>{e.switchMode("s90es");let i="S90/Motif ES reverb ",n=a[0];a.subarray(1).forEach((o,l)=>{([()=>{e.setEffectTypeRaw(0,!1,o&15|112)},()=>{e.setEffectTypeRaw(0,!0,o)}][n+l]||(()=>{}))()}),e.dispatchEvent("efxreverb",e.getEffectType(0))}).add([127,1,0,37,54,2],(a,h,s)=>{e.switchMode("s90es");let i="S90/Motif ES chorus ",n=a[0];a.subarray(1).forEach((o,l)=>{([()=>{e.setEffectTypeRaw(1,!1,o&15|112)},()=>{e.setEffectTypeRaw(1,!0,o)}][n+l]||(()=>{}))()}),e.dispatchEvent("efxchorus",e.getEffectType(1))}).add([127,1,0,34,54,3],(a,h,s)=>{e.switchMode("s90es");let i="S90/Motif ES insert 1 ",n=a[0];a.subarray(1).forEach((o,l)=>{([()=>{e.setEffectTypeRaw(3,!1,o&15|112)},()=>{e.setEffectTypeRaw(3,!0,o)}][n+l]||(()=>{}))()}),e.dispatchEvent("efxinsert0",e.getEffectType(3))}).add([127,1,0,34,54,4],(a,h,s)=>{e.switchMode("s90es");let i="S90/Motif ES insert 2 ",n=a[0];a.subarray(1).forEach((o,l)=>{([()=>{e.setEffectTypeRaw(4,!1,o&15|112)},()=>{e.setEffectTypeRaw(4,!0,o)}][n+l]||(()=>{}))()}),e.dispatchEvent("efxinsert1",e.getEffectType(4))}).add([127,1,0,35,54,17],(a,h,s)=>{e.switchMode("s90es");let i="S90/Motif ES variation ",n=a[0];a.subarray(1).forEach((o,l)=>{([()=>{e.setEffectTypeRaw(2,!1,o&15|112)},()=>{e.setEffectTypeRaw(2,!0,o)}][n+l]||(()=>{}))()}),e.dispatchEvent("efxdelay",e.getEffectType(2))}).add([127,1,0,58,55],(a,h,s)=>{e.dispatchEvent("mupromptex"),e.switchMode("s90es");let i=e.getTrackPort(h);if(t(e,q)[i]&&t(e,q)[i]!=t(e,L).smotif)if(t(e,Se).dumpLimit==e.DUMP_MODE){console.warn(`Dump cancelled for track ${h}. Port ${String.fromCharCode(65+i)} mode "${z[t(e,q)[i]]}" mismatch, should be "${z[t(e,L).smotif]}".`);return}else console.info(`Track ${h} is trying to perform a mismached mode dump on port ${String.fromCharCode(65+i)}.`);let n=e.chRedir(a[0],h,!0),o=H[n],l=a[1];a[0]>15&&(n=a[0]+32);let u=`Track ${h} S90/Motif ES bulk CH${n<128?n+1:"U"+(n-127)} `;console.debug(u,a),!(a[0]>15)&&a.subarray(2).forEach((f,v)=>{([()=>{t(e,w)[o+$[0]]=f,e.pushChPrimitives(n),e.dispatchEvent("voice",{part:n})},()=>{f&&e.setChActive(n,1),t(e,w)[o+$[32]]=f,e.getChPrimitive(n,1)==63&&e.setChType(n,[32,40].indexOf(f)>-1?e.CH_DRUMS:e.CH_MELODIC,t(e,_),!0),e.pushChPrimitives(n),e.dispatchEvent("voice",{part:n})},()=>{f&&e.setChActive(n,1),t(e,B)[n]=f,e.dispatchEvent("voice",{part:n})},()=>{let y=e.chRedir(f,h,!0);t(e,Y)[n]=y,n!=y&&(e.buildRchTree(),console.info(`${u}receives from CH${y+1}`))},()=>{t(e,le)[n]=f?0:1},!1,!1,!1,!1,!1,!1,!1,!1,()=>{f!=100&&e.setChActive(n,1),t(e,w)[o+$[7]]=f},()=>{f!=64&&e.setChActive(n,1),t(e,w)[o+$[10]]=f},!1,!1,!1,()=>{t(e,w)[o+$[91]]=f},()=>{f&&e.setChActive(n,1),t(e,w)[o+$[93]]=f},()=>{f&&e.setChActive(n,1),t(e,w)[o+$[94]]=f},()=>{f!=127&&e.setChActive(n,1),t(e,w)[o+$[128]]=f,e.allocateAce(n,128)},()=>{},()=>{f!=64&&e.setChActive(n,1),t(e,w)[o+$[74]]=f},()=>{f!=64&&e.setChActive(n,1),t(e,w)[o+$[71]]=f},!1,()=>{t(e,w)[o+$[65]]=f},()=>{t(e,w)[o+$[5]]=f},()=>{}][l+v]||(()=>{}))()})}).add([127,1,54,16],(a,h,s)=>{e.switchMode("s90es");let i=a[0];a.subarray(1).forEach((n,o)=>{let u=`S90/Motif ES EQ${(o>>2)+1} `;([()=>{let f=n-64},()=>{let f=ht[n]},()=>{let f=n/10},()=>{let f=n}][i+o&3]||(()=>{}))()})}),t(this,be).add([0,72,18,0,0,0,0],(a,h,s)=>{e.switchMode("sd",!0),e.setPortMode(e.getTrackPort(h),2,k.sd),console.info("MIDI reset: SD")}).add([0,72,18,16,0],(a,h,s)=>{e.dispatchEvent("mupromptex");let i=a[0]>>5,n=a[0]&31;switch(i){case 0:{let o=a[0]>>1,l=a[1];switch(o){case 1:{a.subarray(2).forEach((u,f,v)=>{let y=f+l;switch(y){case 0:{u&&(e.setEffectType(1,60,u-1),e.dispatchEvent("efxchorus",e.getEffectType(1)),console.debug(`SD MFX Cho: ${y} - ${u}`));break}}});break}case 2:{a.subarray(2).forEach((u,f)=>{let v=f+l;switch(v){case 0:{u&&(e.setEffectType(0,55+u,0),e.dispatchEvent("efxreverb",e.getEffectType(0)),console.debug(`SD MFX Rev: ${v} - ${u}`));break}}});break}case 3:case 4:case 5:{let u=o-1;a.subarray(2).forEach((f,v)=>{let y=v+l;switch(console.debug(`SD MFX ${u-2}: ${y} - ${f}`),y){case 0:{e.setEffectTypeRaw(u,62,f),e.dispatchEvent(`efx${u>2?"delay":"insert"+(u-4)}`,e.getEffectType(u));break}}}),console.debug(`SD MFX message:
%o`,a);break}default:console.debug(`Unknown SD-90 global effects message:
%o`,a)}break}case 1:{let o=e.chRedir(n,h,!0),l=a[1],u=H[o];a.subarray(2).forEach((f,v)=>{let y=l+v;y<37?([()=>{},()=>{},0,()=>{},()=>{switch(t(e,w)[u+$[0]]=f,f){case 104:case 105:case 106:case 107:case 120:{t(e,R)[o]||e.setChType(o,e.CH_DRUMS);break}default:t(e,R)[o]&&e.setChType(o,e.CH_MELODIC)}e.pushChPrimitives(o),e.dispatchEvent("voice",{part:o})},()=>{t(e,w)[u+$[32]]=f,e.pushChPrimitives(o),e.dispatchEvent("voice",{part:o})},()=>{t(e,B)[o]=f,e.dispatchEvent("voice",{part:o})},()=>{t(e,w)[u+$[7]]=f},()=>{t(e,w)[u+$[10]]=f},()=>{},()=>{},()=>{f<2&&(t(e,le)[o]=f)},()=>{f<2&&(t(e,w)[u+$[68]]=f?127:0)},()=>{},()=>{f<2&&(t(e,w)[u+$[65]]=f?127:0)},()=>{t(e,w)[u+$[5]]=f&15<<4|t(e,w)[u+$[5]]&15},()=>{t(e,w)[u+$[5]]=f&15|(t(e,w)[u+$[5]]&240)>>4},()=>{t(e,w)[u+$[74]]=f},()=>{t(e,w)[u+$[71]]=f},()=>{t(e,w)[u+$[73]]=f},()=>{t(e,w)[u+$[72]]=f},0,0,0,0,0,0,0,()=>{t(e,w)[u+$[128]]=f,e.allocateAce(128)},()=>{t(e,w)[u+$[93]]=f},()=>{t(e,w)[u+$[91]]=f},0,0,()=>{t(e,w)[u+$[75]]=f},()=>{t(e,w)[u+$[76]]=f},()=>{t(e,w)[u+$[77]]=f},()=>{t(e,w)[u+$[78]]=f}][y]||(()=>{}))():y<63||(y<64?(t(e,R)[o]?(t(e,w)[u+$[0]]=104|f,e.pushChPrimitives(o),e.dispatchEvent("voice",{part:o})):(t(e,w)[u+$[0]]=96|f,e.pushChPrimitives(o),e.dispatchEvent("voice",{part:o})),e.dispatchEvent("voice",{part:o})):console.debug(`Unknown SD-90 global CH${o+1} param setup message:
%o`,a))});break}case 2:{let o=e.chRedir(n,h,!0),l=a[1];console.debug(`Unknown SD-90 global CH${o+1} MIDI setup message:
%o`,a.subarray(2));break}default:console.warn(`Unknown SD-90 global part setup message:
%o`,a)}}),t(e,Me).add([0,1,73,78],(a,h,s)=>{e.switchMode("krs"),e.setPortMode(e.getTrackPort(h),1,k.krs),console.debug("Might be KORG KROSS 2 mode reset... Not sure.")}).add([0,1,73,117,2,37],(a,h,s)=>{e.switchMode("krs");let i=e.getTrackPort(h);if(t(e,q)[i]&&t(e,q)[i]!=k.krs)if(t(e,Se).dumpLimit==e.DUMP_MODE){console.warn(`Dump cancelled. Port ${String.fromCharCode(65+i)} mode "${z[t(e,q)[i]]}" mismatch, should be "krs".`);return}else console.info(`Track ${h} is trying to perform a mismached mode dump on port ${String.fromCharCode(65+i)}.`);e.setPortMode(e.getTrackPort(h),1,k.krs);let n="KROSS 2 BMT1 ",o="";ve(a,(l,u)=>{if(u<24)o+=String.fromCharCode(Math.max(32,l));else if(!(u<1276)){let f=u-1276,v=e.chRedir(Math.floor(f/44),h,!0),y=f%44,T=H[v];y<15?([()=>{l&&e.setChActive(v,1),t(e,B)[v]=l,e.dispatchEvent("voice",{part:v})},()=>{l&&e.setChActive(v,1),l<10?(t(e,w)[T+$[0]]=63,t(e,w)[T+$[32]]=l):l<20?(t(e,w)[T+$[0]]=121,t(e,w)[T+$[32]]=l-10):l<24&&(t(e,w)[T+$[0]]=[120,0,56,62][l-20],t(e,w)[T+$[32]]=0),e.pushChPrimitives(v),e.dispatchEvent("voice",{part:v})},()=>{let D=e.chRedir(l&15,h,!0);t(e,Y)[v]=D,console.info(`${n}CH${v+1} receives from CH${D+1}`)},!1,!1,()=>{t(e,w)[T+$[7]]=l},!1,()=>{},()=>{},!1,!1,!1,!1,!1,()=>{t(e,w)[T+$[10]]=l||128}][y]||(()=>{}))():y<36||([()=>{t(e,w)[T+$[74]]=(l+128&255)-64},()=>{t(e,w)[T+$[71]]=(l+128&255)-64},!1,!1,()=>{t(e,w)[T+$[73]]=(l+128&255)-64},()=>{t(e,w)[T+$[75]]=(l+128&255)-64},!1,()=>{t(e,w)[T+$[72]]=(l+128&255)-64}][y]||(()=>{}))()}}),o=o.trimRight(),e.dispatchEvent("metacommit",{type:"EORTitle",data:o})})}chRedir(e,r,d){let c=this;if(t(c,Ge)[r])return(t(c,Ge)[r]-1)*16+e;if(t(c,_)==k.sc||t(c,_)==k.sd){if(d==1)return e;let p=0,m=!0;for(;m;)t(c,Ie)[e+p]==0?(t(c,Ie)[e+p]=r,console.debug(`Assign track ${r} to channel ${e+p+1}.`),m=!1):t(this,Ie)[e+p]==r?m=!1:(p+=16,p>=128&&(p=0,m=!1));return e+p}else return e}getTrackPort(e){return this.chRedir(0,e,!0)>>4}forceVoiceRefresh(){for(let e=0;e<b.ch;e++)t(this,oe)[e]&&this.dispatchEvent("voice",{part:e})}buildRchTree(){let e=[];t(this,Y).forEach((r,d)=>{var c;r<b.ch&&((c=e[r])!=null&&c.constructor||(e[r]=[]),e[r].push(d))}),x(this,Mt,e)}buildRccMap(){let e=this;for(let r=0;r<b.ch;r++)t(e,Ze)[r]={};t(e,We).forEach((r,d)=>{r&&(t(e,Ze)[Math.floor(d/b.redir)][r]=d%b.redir|128)}),O()&&console.debug(t(e,Ze))}getActive(){return t(this,oe)}getChActive(e){return t(this,oe)[e]}getCc(e){if(typeof e!="number"||e<0||e>=b.ch)throw new RangeError(`Invalid part number: CH${e+1}`);let r=this,d=H[e];return t(r,w).subarray(d,d+b.cc)}getChCc(e,r){let d=this;if(ze.indexOf(r)<0)throw new Error("CC number not accepted");return t(d,w)[H[e]+$[r]]}setChCc(e=0,r,d){let c=this;if(ze.indexOf(r)<0)throw new Error("CC number not accepted");if((d==null?void 0:d.constructor)!=Number)throw new TypeError("Expected numbers for value");let p=d&255,m=H[e]+$[r];t(c,w)[m]=p,t(c,w)[m+b.chcc]=1,c.dispatchEvent("cc",{part:e,cc:r,data:p})}getCcAll(){return t(this,w).slice()}resetCc(e){}resetChCc(e,r,d){let c=this;d!=null&&d.constructor&&c.setChCc(e,r,d),t(c,w)[H[e]+$[r]+b.chcc]=0}resetCcAll(){}isChCcWritten(e,r){if(ze.indexOf(r)<0)throw new Error("CC number not accepted");return t(upThis,w)[H[e]+$[r]+b.chcc]}getChSource(){return t(this,Y)}getChType(){return t(this,R)}setChType(e,r,d=0,c=!1){r&=15;let p=this;d=d||p.getChModeId(e),t(p,R)[e]=r,r>0&&!c&&(p.setChCc(e,0,t(p,W)[d][2]),p.pushChPrimitives(e))}setChActive(e,r=0){t(this,oe)[e]!=r&&this.dispatchEvent("channeltoggle",{part:e,active:r}),t(this,oe)[e]=r}getExt(e){let r=b.ext*e,d=t(this,de).subarray(r,r+b.ext),c=new Uint8Array(d.length);return c.set(d),c[1]=c[1]||t(this,Bt),c}getPitch(){return t(this,Oe)}getProgram(){return t(this,B)}getTexts(){return t(this,fe).slice()}getVel(e){let r=new Map,d=this;return t(d,J).forEach(function(c,p){let m=c>>7,C=c&127;e==m&&t(d,Z)[c]>0&&r.set(C,{v:t(d,Z)[c],s:t(d,j)[p]})}),r}getBitmap(){return{bitmap:t(this,pe,De),expire:t(this,Ee)}}getLetter(){return{text:t(this,He),set:t(this,Tt),expire:t(this,_e)}}getMode(){return z[t(this,_)]}getMaster(){return{volume:t(this,X)}}getRawStrength(){let e=this;return t(this,J).forEach(function(r){let d=r>>7;t(e,Z)[r]>t(e,xe)[d]&&(t(e,xe)[d]=t(e,Z)[r])}),t(this,xe)}getStrength(){let e=[],r=this;return this.getRawStrength().forEach(function(d,c){e[c]=Math.floor(d*r.getChCc(c,7)*r.getChCc(c,11)*t(r,X)/803288)}),e}getRpn(){return t(this,A)}getNrpn(){return t(this,ft)}getSubDb(){return self==null?void 0:self.structuredClone(t(this,W))}getDetect(){return self==null?void 0:self.structuredClone(t(this,L))}getVoice(e,r,d,c="?"){var s;let p=this;(s=k[c])!=null&&s.constructor||(c="?");let m=k[c],C=e||t(p,W)[m][0],E=r,a=d||t(p,W)[m][1];C==$e.bank0&&(C=0),a==$e.bank0&&(a=0),c=="ns5r"&&C>0&&C<56&&(a=3);let h=p.userBank.get(C,E,a,c);if(c=="mt32"&&h.name.indexOf("MT-m:")==0){let i=parseInt(h.name.slice(5)),n=i*b.cmt,o="";t(p,Ne).subarray(n,n+10).forEach(u=>{u>31&&(o+=String.fromCharCode(u))});let l=`MSB	LSB	PRG	NME
49	127	${E}	${o}`;p.userBank.load(l,!0),h.name=o,h.ending=" "}return(h.ending!=" "||!h.name.length)&&(h=p.baseBank.get(C,E,a,c)),h}getChPrimitive(e,r,d){if(r>=b.vxPrim||(r==null?void 0:r.constructor)!=Number)throw new RangeError(`Invalid voice primitive component "${r}"`);if(typeof e!="number"||e<0||e>=b.ch)throw new RangeError(`Invalid part number: CH${e+1}`);let c=this,p=t(c,B)[r<<b.chShift|e];switch(r){case 1:case 2:{d&&(p=p||t(c,W)[c.getChModeId(e)][r-1]),p==$e.bank0&&(p=0);break}}return p}getChPrimitives(e,r){let d=this,c=new Uint8Array(3);return c[1]=t(d,B)[e],c[0]=d.getChPrimitive(e,1,r),c[2]=d.getChPrimitive(e,2,r),c}pushChPrimitives(e){let r=this;t(r,B)[1<<b.chShift|e]=r.getChCc(e,0),t(r,B)[2<<b.chShift|e]=r.getChCc(e,32),r.dispatchEvent("voice",{part:e})}getChVoice(e){let r=this,d=r.getVoice(...r.getChPrimitives(e),r.getChMode(e));if(t(r,Ce)[e]){let c="";switch(t(r,_)){case k.mt32:{t(r,we).subarray(b.cmt*(e-1),b.cmt*(e-1)+10).forEach(p=>{c+=String.fromCharCode(Math.max(p,32))}),c=c.trimRight();break}default:{let p=b.cvn*e;t(r,xt).subarray(p,p+b.cvn).forEach(m=>{c+=String.fromCharCode(Math.max(m,32))}),c=c.trimRight()}}c.length&&(d.ending="~",d.name=c)}return d}getRawPitch(){return t(this,Oe)}getPitchShift(e){let r=this,d=e*b.rpn,c=t(r,A)[d];return t(r,U)[e*b.rpnt]||t(r,_)==k.mt32&&(c=12),t(r,Oe)[e]/8192*c+(t(r,A)[d+3]-64)+((t(r,A)[d+1]<<7)+t(r,A)[d+2]-8192)/8192}getEffectType(e=0){let r=3*e+1;return t(this,he).subarray(r,r+2)}setEffectTypeRaw(e=0,r,d){let c=3*e;t(this,he)[c]=1,t(this,he)[c+1+ +r]=d}setEffectType(e=0,r,d){this.setEffectTypeRaw(e,!1,r),this.setEffectTypeRaw(e,!0,d)}getEffectSink(){return t(this,ut)}setLetterDisplay(e,r,d=0,c=3200){let p=this,m;x(p,He," ".repeat(d)),e.forEach(C=>{x(p,He,t(p,He)+String.fromCharCode(C>31?C:32)),C<32&&(m=m||new Set,m.add(C))}),x(p,Tt,Date.now()),x(p,_e,Date.now()+c),p.dispatchEvent("letter"),m&&(m=Array.from(m),m.forEach((C,E,a)=>{a[E]=C.toString(16).padStart(2,"0")}),console.warn(`${r}${r?" ":""}invalid code point${m.length>1?"s":""}: 0x${m.join(", 0x")}`))}setDetectionTargets(e="?",r=0){let d=this,c=-1;switch(e.replaceAll(", ",",").split(",").forEach(p=>{p=p.toLowerCase();let m=z.indexOf(Yr[p]||p);O()&&console.debug(`Mapped mode "${p}" to ID "${m}".`),m>-1&&(c=m)}),O()&&console.debug(`Set detection target to ID "${c}".`),c>0&&(t(d,L).x5=82,t(d,L).ds=k.krs),c){case k["05rw"]:{t(d,L).x5=81;break}case k.s90es:t(d,L).ds=k.s90es,t(d,L).smotif=k.s90es;case k.motif:t(d,L).ds=k.motif,t(d,L).smotif=k.motif}}setGsTargets(e=!1,r=4){if(!r)r=e?3:4;else{if(r>4||r<0)throw new Error(`Invalid GS level ${r}`);if(e&&r>>1!=1)throw new Error(`Invalid SC level ${r}`)}let d=this;t(d,L)[e?"sc":"gs"]=r,t(d,W)[k[e?"sc":"gs"]][1]=r,d.forceVoiceRefresh()}getConfigs(){return t(this,St)}setDumpLimit(e){if(e>2||e<0)throw new RangeError("Invalid dump limit.");t(this,Se).dumpLimit=e}allocateAce(e=0,r){let d=this;if(!r||r<128&&r>95){console.warn(`cc${r} cannot be allocated as an active custom effect.`);return}let c=!0,p=0,m=b.ace*e;for(;c&&p<b.ace;)t(d,re)[p+m]==r?c=!1:t(d,re)[p+m]||(c=!1,t(d,re)[p+m]=r,console.info(`Allocated cc${r} to ACE slot ${p} in CH${e+1}.`)),p++;p>=b.ace&&console.warn(`ACE slots are full in CH${e+1}.`)}allocateAceAll(e){let r=this;if(!e||e<128&&e>95){console.warn(`cc${e} cannot be allocated as an active custom effect.`);return}for(let d=0;d<b.ch;d++){let c=!0,p=0,m=b.ace*d;for(;c&&p<b.ace;)t(r,re)[p+m]==e?c=!1:t(r,re)[p+m]||(c=!1,t(r,re)[p+m]=e),p++;p>=b.ace&&console.warn(`ACE slots are full in CH${d+1}.`)}}releaseAce(e=0,r){let d=!0,c=b.ace*e,p=c+b.ace;for(;d&&c<p;)t(this,re)[c]==r&&(t(this,re)[c]=0,d=!1),c++;d&&O()&&console.debug(`No ACE slot was allocated to cc${r} in CH${e+1}.`)}resetAce(){t(this,re).fill(0),console.info("All ACE slots have been reset.")}getAce(){return t(this,re)}getChAce(e=0,r=0){if(r<0||r>=b.ace)throw new RangeError("No such ACE slot");let d=t(this,re)[b.ace*e+r];if(d){if(ze.indexOf(d)>=0)return this.getChCc(e,d);throw new Error(`Invalid ACE source in CH${e+1}: ${d}`)}else return 0}initDrums(){let e=this;t(e,ie).fill(64);for(let r=0;r<b.drm;r++){let d=r*b.dpn;for(let c in Cr){let p=Cr[c],m=(d+ge[c])*b.dnc;t(e,ie).subarray(m,m+b.dnc).fill(p)}}}init(e=0){let r=this;x(r,Ye,0),t(r,W)[k.xg][1]=0,r.dispatchEvent("banklevel",{mode:"xg",data:0}),t(r,oe).fill(0),t(r,w).fill(0),t(r,re).fill(0),t(r,B).fill(0),t(r,Z).fill(0),t(r,J).fill(0),t(r,le).fill(0),t(r,xe).fill(0),t(r,Oe).fill(0),t(r,ft).fill(0),t(r,U).fill(0),t(r,de).fill(0),t(r,q).fill(0),t(r,Qe).fill(0),t(r,We).fill(0),x(r,X,100),x(r,fe,[]),x(r,gt,500),x(r,bt,0),x(r,Ee,0),x(r,te,0),t(r,pe,De).fill(0),x(r,F,!1),x(r,mt,0),x(r,Te,!0),r.initDrums(),t(r,Y).forEach(function(d,c,p){p[c]=c}),e==0&&(r.dispatchEvent("mode","?"),x(r,_,0),t(r,Ie).fill(0),t(r,Ge).fill(0),x(r,_e,0),x(r,He,"")),Jr.forEach(d=>{r.setChCc(d,0,t(r,W)[r.getChModeId(d)][2])}),t(r,R).fill(r.CH_MELODIC),t(r,R)[9]=r.CH_DRUM1,t(r,R)[25]=r.CH_DRUM3,t(r,R)[41]=r.CH_DRUMS,t(r,R)[57]=r.CH_DRUMS,t(r,R)[73]=r.CH_DRUM5,t(r,R)[89]=r.CH_DRUM7,t(r,R)[105]=r.CH_DRUMS,t(r,R)[121]=r.CH_DRUMS;for(let d=0;d<b.drm;d++)t(r,ye)[d<<1]=0,t(r,ye)[d<<1|1]=b.invalidCh;t(r,pt).fill(0),t(r,Ne).fill(0),t(r,Ue).fill(0),t(r,we).fill(0),t(r,Ce).fill(0),t(r,he).fill(0),t(r,ut).fill(0),r.aiEfxName="",r.userBank.clearRange({msb:0,lsb:127,prg:[0,127]}),r.modelEx.sc.showBar=!0,r.modelEx.sc.invBar=!1,r.modelEx.sc.invDisp=!1,r.modelEx.sc.peakHold=1;for(let d=0;d<b.ch;d++){let c=H[d];t(r,w)[c+$[7]]=100,t(r,w)[c+$[11]]=127,t(r,w)[c+$[2]]=127,t(r,w)[c+$[10]]=64,t(r,w).subarray(c+$[71],c+$[71]+8).fill(64),t(r,w)[c+$[128]]=127,t(r,w).subarray(c+$[130],c+$[157]+1).fill(64),t(r,w)[c+$[91]]=40,t(r,w)[c+$[101]]=127,t(r,w)[c+$[100]]=127,t(r,w)[c+$[99]]=127,t(r,w)[c+$[98]]=127;let p=d*b.rpn;t(r,A)[p]=2,t(r,A)[p+1]=64,t(r,A)[p+2]=0,t(r,A)[p+3]=64,t(r,A)[p+4]=0,t(r,A)[p+5]=0;let m=d*b.ext;t(r,de)[m+1]=r.VLBC_BRTHEXPR;let C=d*b.redir;t(r,We)[C+8]=13}r.buildRchTree(),r.buildRccMap(),r.dispatchEvent("mastervolume",t(r,X)),r.dispatchEvent("efxreverb",r.getEffectType(0)),r.dispatchEvent("efxchorus",r.getEffectType(1)),r.dispatchEvent("efxdelay",r.getEffectType(2)),r.dispatchEvent("efxinsert0",r.getEffectType(3)),r.dispatchEvent("efxinsert1",r.getEffectType(4)),r.dispatchEvent("efxinsert2",r.getEffectType(5)),r.dispatchEvent("efxinsert3",r.getEffectType(6)),r.dispatchEvent("reset"),r.switchMode("?")}setChMode(e,r){let d=this;if(typeof e!="number"||e<0||e>=b.ch)throw new RangeError(`Invalid part number: CH${e+1}`);if(port<0||r>=z.length)throw new RangeError(`Invalid mode ID ${r}`);t(d,Qe)[e]=r,d.dispatchEvent("chmode",{part:e,id:r,mode:z[r]}),d.dispatchEvent("voice",{part:e})}getChMode(e,r){return z[this.getChModeId(e,r)]}getChModeId(e,r){return r?t(this,Qe)[e]||t(this,q)[e>>4]:t(this,Qe)[e]||t(this,q)[e>>4]||t(this,_)}setPortMode(e,r,d){let c=this;if(e<0||e>=b.ch>>4)throw new RangeError(`Invalid port ${e+1}`);if(r<1)throw new RangeError("Range must be a positive integer");if(e+r>=b.ch>>4)throw new RangeError("Range must be in bound");if(e<0||d>=z.length)throw new RangeError(`Invalid mode ID ${d}`);for(let p=e;p<e+r;p++){t(c,q)[p]=d;for(let m=p<<4;m<p+1<<4;m++)c.dispatchEvent("chmode",{part:m,id:d,mode:z[d]}),c.dispatchEvent("voice",{part:m})}}copyChSetup(e,r,d){if(e==r){console.warn(`Failed attempt at overwriting CH${e+1} with its own data.`);return}let c=this;if(d&&t(c,oe)[r]){console.warn(`Failed attempt at copying setup data from CH${e+1} to CH${r+1}.`);return}let p=H[e],m=H[r];t(c,B)[r]=t(c,B)[e],t(c,w).set(t(c,w).subarray(p,p+b.cc),m),c.pushChPrimitives(r)}setDrumFirstWrite(e,r){let d=this,c=t(d,R)[e];if(c<2)return;let p=c-2;if(t(d,ye)[p<<1])if(r)t(d,ye)[p<<1]=0,O()&&console.debug(`First write part for drum set ${p+1} has been reset.`);else return;else r?console.warn(`First write part for drum set ${p+1} is already blank.`):(t(d,ye)[p<<1]=1,t(d,ye)[p<<1|1]=e,console.debug(`First write part for drum set ${p+1} is set to CH${e+1}.`))}getChDrumFirstWrite(e){let r=this,d=t(r,R)[e];if(d<2)return;let c=d-2;return t(r,ye).subarray(c<<1,c+1<<1)}getDrumFirstWrite(e){if(e>=0&&e<b.drm)return t(this,ye).subarray(e<<1,e+1<<1)}switchMode(e,r=!1,d=!1){var m;let c=this,p=k[e];if(p>-1){if(t(c,_)==0||r){c.initOnReset&&r&&this.init(1),x(c,_,p),x(c,te,0);for(let E=0;E<b.ch;E++){let a=c.getChModeId(E,!0);t(c,R)[E]>0&&a==k["?"]&&(c.setChCc(E,0,t(c,W)[p][2]),O()&&console.debug(`CH${E+1} (${t(c,R)[E]}) (${c.getChMode(E)}), ${z[a]} (${t(c,W)[a][2]}) -> ${z[p]} (${t(c,W)[p][2]})`),c.pushChPrimitives(E))}switch(p){case k.mt32:{Kt.forEach((E,a)=>{let h=a+1;t(c,oe)[h]||(t(c,B)[h]=E,c.setChCc(h,91,127),c.pushChPrimitives(h))});for(let E=1;E<10;E++)c.dispatchEvent("voice",{part:E});break}}let C;switch(p){case k["?"]:case k.g2:{C=[52,4,52,18,0,0,0,0];break}case k.xg:{C=[1,0,65,0,5,0,0,0];break}case k.gm:case k.gs:case k.sc:{C=[40,4,40,18,40,32,32,0];break}case k.sd:{C=[58,0,60,0,61,0,61,0];break}case k["05rw"]:case k.x5d:case k.ns5r:{C=[44,1,44,19,44,0,44,0];break}case k.k11:case k.sg:{C=[24,0,0,0,0,0,0,0];break}case k.mt32:{C=[40,4,0,0,0,0,0,0];break}case k.doc:{C=[24,16,0,0,0,0,0,0];break}case k.motif:case k.s90es:{C=[113,0,117,0,114,0,0,0];break}default:C=[0,0,0,0,0,0,0,0]}for(let E=0;E<b.efx;E++)!t(c,he)[3*E]&&((m=C[E<<1])!=null&&m.constructor)&&(t(c,he)[3*E+1]=C[2*E],t(c,he)[3*E+2]=C[2*E+1],c.dispatchEvent(`efx${["reverb","chorus","delay","insert0"][E]}`,c.getEffectType(E)));d&&c.setDetectionTargets(e),c.dispatchEvent("mode",e),c.forceVoiceRefresh()}}else throw new Error(`Unknown mode ${e}`)}newStrength(){t(this,xe).fill(0)}runJson(e){var r;if(e.type>14)return e.type==15&&e.data.constructor!=Uint8Array&&(e.data=Uint8Array.from(e.data)),t(this,Pt)[e.type].call(this,e);{let d=this.chRedir(e.part,e.track),c=!1;(r=t(this,Mt)[d])==null||r.forEach(p=>{e.channel=p,c=!0,t(this,Pt)[e.type].call(this,e)}),c||console.warn(`${mr[e.type]?mr[e.type]:e.type}${[11,12].includes(e.type)?(e.data[0]!=null?e.data[0]:e.data).toString():""} event sent to CH${d+1} without any recipient.`)}t(this,fe).length>100&&t(this,fe).splice(100,t(this,fe).length-99)}runRaw(e){}async loadBank(e,r){let d=this;switch(e=e.toLowerCase(),e){case"s7e":{d.userBank.clearRange({msb:63,lsb:[21,22]}),d.userBank.clearRange({msb:63,lsb:[24,27]});break}case"pcg":{d.userBank.clearRange({msb:63,lsb:[6,9]}),d.userBank.clearRange({msb:63,lsb:[13,16]});break}default:throw new Error(`Unknown bank format ${e}`)}switch(e){case"s7e":case"pcg":{Ct.context=this,await d.userBank.load(await Ct.read(e,r),!1);break}}d.forceVoiceRefresh()}},_=new WeakMap,te=new WeakMap,Ee=new WeakMap,Ae=new WeakMap,pe=new WeakSet,De=function(){return t(this,Ae)[t(this,te)]},Sr=function(e){t(this,Ae)[t(this,te)]=e},oe=new WeakMap,Y=new WeakMap,R=new WeakMap,w=new WeakMap,re=new WeakMap,B=new WeakMap,Z=new WeakMap,le=new WeakMap,J=new WeakMap,j=new WeakMap,Oe=new WeakMap,xe=new WeakMap,qe=new WeakMap,de=new WeakMap,A=new WeakMap,U=new WeakMap,ft=new WeakMap,ie=new WeakMap,ye=new WeakMap,he=new WeakMap,ut=new WeakMap,We=new WeakMap,q=new WeakMap,Qe=new WeakMap,Ce=new WeakMap,xt=new WeakMap,Ue=new WeakMap,we=new WeakMap,pt=new WeakMap,Ne=new WeakMap,W=new WeakMap,L=new WeakMap,Se=new WeakMap,St=new WeakMap,X=new WeakMap,Ye=new WeakMap,gt=new WeakMap,bt=new WeakMap,He=new WeakMap,_e=new WeakMap,Tt=new WeakMap,mt=new WeakMap,Te=new WeakMap,F=new WeakMap,Bt=new WeakMap,Mt=new WeakMap,Ze=new WeakMap,fe=new WeakMap,Ie=new WeakMap,Ge=new WeakMap,ae=new WeakMap,Je=new WeakMap,Q=new WeakMap,Pt=new WeakMap,Lt=new WeakMap,je=new WeakMap,et=new WeakMap,ue=new WeakMap,be=new WeakMap,Me=new WeakMap,tt=new WeakMap,rt=new WeakMap,at=new WeakMap,kr);var Zt=Xr(Tr(),1);N();N();var Rt,Mr,Rr=(Mr=class{constructor(g,e,r,d){S(this,Rt,!1);x(this,Rt,g),this.start=e,this.end=r,this.data=d}get duration(){return this.ranged?this.end-this.start:0}get ranged(){return t(this,Rt)}},Rt=new WeakMap,Mr),Qt=class extends Rr{constructor(g,e,r){super(!0,g,e,r)}},Dr=class extends Rr{constructor(g,e){super(!1,g,g,e)}},st,Pr,Yt=(Pr=class extends Array{constructor(){super(...arguments);S(this,st,-1)}resetIndex(e){x(this,st,-1)}fresh(){this.sort(function(e,r){return e.start==r.start?0:(+(e.start>r.start)<<1)-1}),this.forEach(function(e,r){e.index=r})}step(e,r=!1){let d=[];if(r)for(let c=0;c<this.length&&!(this[c].start>e);c++){if(this[c].end<e)continue;d.push(this[c])}else{let c=this.getRange(t(this,st)==-1?0:e-1,e),p=this;c.forEach(function(m){m.index>t(p,st)&&(d.push(m),x(p,st,m.index))})}return d}getRange(e,r){var C;e>r&&([e,r]=[r,e]);let d=[],c=-1,p=Math.ceil(Math.sqrt(this.length)),m=!0;for(let E=0;E<this.length;E+=p)this[E+p]?c<0&&this[E+p].start>=e&&(c=E):c=c<0?E:c;for(;m;)((C=this[c])==null?void 0:C.end)<r?this[c].start>=e&&d.push(this[c]):m=!1,c++;return d}},st=new WeakMap,Pr);var na=0xffffffffffff,Ar=function(g){let e=new Yt,r=this,d=g.timeDivision,c=120,p=new Yt,m=0,C=0;p.push(new Qt(0,na,[120,0])),g.track.forEach(function(s){m=0,s.event.forEach(function(i){m+=i.deltaTime,i.type==255&&(i==null?void 0:i.metaType)==81&&(c=6e7/i.data,p[p.length-1]&&p.push(new Qt(m,0xffffffffffff,[c,0])))})}),p.fresh(),p.forEach(function(s,i,n){i>0&&(n[i-1].end=s.start)});let E=120;p.forEach(function(s,i,n){i>0&&(s.end==s.start?n.splice(n.indexOf(s),1):E==s.data[0]&&(n[i-1].end=s.end,n.splice(n.indexOf(s),1)),E=s.data[0])});let a=0,h=120;return p.forEach(function(s){let i=s.start,n=i/h/d*60+a;h=s.data[0],a=n-i/h/d*60,s.data[1]=a}),console.debug("All tempo changes: ",p),c=120,m=0,C=0,g.track.forEach(function(s,i){m=0,C=0;let n=i+1;s.event.forEach(function(o,l){m+=o.deltaTime;let u=p.step(m,!0)[0];u&&(c=u.data[0],C=u.data[1]);let f={type:o.type,data:o.data,track:n,part:0};o.type>14?f.meta=o.metaType:f.part=o.channel,e.push(new Dr(m/c/d*60+C,f))})}),e.fresh(),self.midiEvents=e,console.debug(`Parsed a type ${g.formatType} MIDI sequence.`),e};Zt.default.customInterpreter=gr;var G=function(g,e,r){g.addEventListener(r,d=>{e.dispatchEvent(r,d.data)})},it,Xe,vt,Be,nt,Et,ct,Dt,Ve,Fe,se,ot,Pe,lt,At,Ke,Or,us=(Or=class extends Ot{constructor(e,r=.5,d=.5){super();P(this,"device");S(this,it,void 0);S(this,Xe,{});S(this,vt,[]);S(this,Be,"");S(this,nt,[]);S(this,Et,[]);S(this,ct,new Uint8ClampedArray(128));S(this,Dt,new Uint8ClampedArray(128));S(this,Ve,.5);S(this,Fe,120);S(this,se,4);S(this,ot,4);S(this,Pe,0);S(this,lt,0);S(this,At,new Array(b.ch));S(this,Ke,new Uint8Array(b.ch));P(this,"smoothingAtk",0);P(this,"smoothingDcy",0);let c=this;c.smoothingAtk=r,c.smoothingDcy=d,c.device=e,c.addEventListener("meta",function(p){var m;(m=p==null?void 0:p.data)==null||m.forEach(function(C){(t(c,nt)[C.meta]||console.debug).call(c,C.meta,C.data)})}),G(c.device,c,"mode"),G(c.device,c,"mastervolume"),G(c.device,c,"channelactive"),G(c.device,c,"channelmin"),G(c.device,c,"channelmax"),G(c.device,c,"portrange"),G(c.device,c,"portstart"),G(c.device,c,"channelreset"),G(c.device,c,"channeltoggle"),G(c.device,c,"screen"),G(c.device,c,"metacommit"),G(c.device,c,"voice"),G(c.device,c,"pitch"),G(c.device,c,"note"),G(c.device,c,"reset"),G(c.device,c,"banklevel"),G(c.device,c,"efxreverb"),G(c.device,c,"efxchorus"),G(c.device,c,"efxdelay"),G(c.device,c,"efxinsert0"),G(c.device,c,"efxinsert1"),G(c.device,c,"efxinsert2"),G(c.device,c,"efxinsert3"),G(c.device,c,"partefxtoggle"),G(c.device,c,"chmode"),c.addEventListener("note",function({data:p}){t(c,Et).push(p)}),c.addEventListener("voice",({data:p})=>{var C;let m=c.getChVoice(p.part);t(c,At)[p.part]=m,t(c,Ke)[p.part]=(C=m.poly)!=null?C:1}),c.addEventListener("reset",({data:p})=>{t(c,Ke).fill(1)}),t(c,Ke).fill(1),t(c,nt)[3]=function(p,m){var C;((C=t(c,Be))==null?void 0:C.length)<1&&(x(c,Be,m),c.dispatchEvent("title",t(c,Be)))},t(c,nt)[81]=function(p,m){let C=c.noteProgress,E=t(c,Ve)||.5;x(c,Fe,6e7/m),x(c,Ve,m/1e6),x(c,Pe,t(c,Pe)+(C*(E/t(c,Ve))-C)),c.dispatchEvent("tempo",t(c,Fe))},t(c,nt)[88]=function(p,m){let C=c.noteProgress,E=c.noteOverall,a=c.noteBar,h=c.noteBeat,s=t(c,se),i=t(c,ot);x(c,se,m[0]),x(c,ot,1<<m[1]);let n=24*(32/m[3])/m[2];if(s!=t(c,se)){let o=a;x(c,Pe,t(c,Pe)-o*(t(c,se)-s)),h+1>=s&&(s<t(c,se)?x(c,Pe,t(c,Pe)-Math.ceil(t(c,se)-h-1)):x(c,Pe,t(c,Pe)+t(c,se)))}c.dispatchEvent("tsig",c.getTimeSig())}}reset(){var r;let e=this;e.dispatchEvent("reset"),(r=t(e,it))==null||r.resetIndex(),e.device.init(),x(e,Be,""),x(e,Ve,.5),x(e,Fe,120),x(e,se,4),x(e,ot,4),x(e,Pe,0),x(e,lt,0),e.dispatchEvent("tempo",t(e,Fe)),e.dispatchEvent("title",t(e,Be))}init(){this.reset(),x(this,it,void 0)}async loadFile(e){x(this,it,Ar(Zt.default.parse(new Uint8Array(await e.arrayBuffer()))))}async loadMap(e,r,d){let c=this,p=0,m=0,C=0,E=0,a,h;e.split(`
`).forEach((s,i)=>{var o;if(!s)return;let n=s.split("	");if(i){if(!E)return;let l="",u="";n.forEach((v,y)=>{switch(y){case a:{l=v;break}case h:{u=v;break}}});let f=!1;((o=t(c,Xe)[l])==null?void 0:o.priority)>d&&(f=!0,C++),!t(c,Xe)[l]||f||r?(t(c,Xe)[l]={name:u,priority:d},p++):self.debugMode&&console.debug(`Voice "${u}" (${l}) seems to be in conflict with (${t(c,Xe)[l]}).`),m++}else n.forEach((l,u)=>{switch(l){case"ID":{a=u,E++;break}case"Name":{h=u,E++;break}default:console.debug(`Unknown map field: ${l}`)}})}),console.debug(`Voice names: ${m} total, ${p} loaded (${p-C} + ${C}).`),c==null||c.device.forceVoiceRefresh()}async loadMapPaths(e){let r=this;e.forEach(async(d,c)=>{r.loadMap(await(await fetch(d)).text(),0,c)})}async loadEfx(e,r){let d=this,c=0,p=0,m,C,E;e.split(`
`).forEach((a,h)=>{if(a)if(h){let s=0,i;a.split("	").forEach((n,o)=>{switch(o){case m:{s|=parseInt(n,16)<<8;break}case C:{s|=parseInt(n,16);break}case E:{i=n;break}}}),!t(d,vt)[s]||r?(t(d,vt)[s]=i,c++):self.debugMode&&console.debug(`EFX ID 0x${s.toString(16).padStart(4,"0")} (${i}) seems to be in conflict.`),p++}else a.split("	").forEach((s,i)=>{switch(s){case"MSB":{m=i;break}case"LSB":{C=i;break}case"Name":{E=i;break}default:console.debug(`Unknown EFX field: ${s}`)}})}),console.debug(`EFX: ${p} total, ${c} loaded.`),d.dispatchEvent("efxreverb",d.device.getEffectType(0)),d.dispatchEvent("efxchorus",d.device.getEffectType(1)),d.dispatchEvent("efxdelay",d.device.getEffectType(2)),d.dispatchEvent("efxinsert0",d.device.getEffectType(3)),d.dispatchEvent("efxinsert1",d.device.getEffectType(4)),d.dispatchEvent("efxinsert2",d.device.getEffectType(5)),d.dispatchEvent("efxinsert3",d.device.getEffectType(6))}switchMode(e,r=!1){this.device.switchMode(e,r)}getMode(){return this.device.getMode()}getVoice(){return this.device.getVoice(...arguments)}getChVoice(e){return this.device.getChVoice(e)}getChPrimitive(e,r,d){return this.device.getChPrimitive(e,r,d)}getChPrimitives(e,r){return this.device.getChPrimitives(e,r)}getMapped(e){var r;return((r=t(this,Xe)[e])==null?void 0:r.name)||e}getEfx([e,r]){let d=e<<8|r;return t(this,vt)[d]||`0x${d.toString(16).padStart(4,"0")}`}getVoxBm(e){if(!e)throw new Error("Voice object must be valid");let r=this;if(!r.voxBm)throw new Error("Voice bitmap repository isn't yet initialized");let d=r.voxBm.getBm(e.name);if(!d)switch(e.mode){case"xg":{switch(e.sid[0]){case 0:case 80:case 81:case 83:case 84:case 96:case 97:case 99:case 100:{d=r.voxBm.getBm(r.getVoice($e.bank0,e.sid[1],$e.bank0,e.mode).name);break}}break}case"g2":case"sd":{switch(e.sid[0]){case 96:case 97:case 98:case 99:{d=r.voxBm.getBm(r.getVoice($e.bank0,e.sid[1],$e.bank0,e.mode).name);break}case 104:case 105:case 106:case 107:{d=r.voxBm.getBm(r.getVoice(120,e.sid[1],$e.bank0,e.mode).name);break}}break}case"gs":case"sc":case"k11":case"sg":case"gm":{switch(e.sid[0]){case 120:break;case 122:case 127:{d=r.voxBm.getBm(r.getVoice(120,e.sid[1],0,e.mode).name);break}default:d=r.voxBm.getBm(r.getVoice(0,e.sid[1],0,e.mode).name)}break}default:switch(e.sid[0]){case 56:{d=r.voxBm.getBm(r.getVoice(0,e.sid[1],0,e.mode).name);break}}}return d||(d=r.voxBm.getBm(r.getVoice(e.sid[0],e.sid[1],0,e.mode).name)),d}getChBm(e,r){let d=this;r=r||d.getChVoice(e);let c=d.getVoxBm(r);if(!c){if(!d.sysBm)return;switch(r.mode){case"xg":{switch(r.sid[0]){case 126:{r.sid[1]>>1==56&&(c=d.sysBm.getBm("cat_smpl"));break}case 16:{c=d.sysBm.getBm("cat_smpl");break}case 64:case 67:{c=d.sysBm.getBm("cat_sfx");break}case 32:case 33:case 34:case 35:case 36:case 48:case 82:{c=d.sysBm.getBm("cat_xg");break}}break}default:switch(r.sid[0]){case 63:case 32:case 33:case 34:case 35:case 36:case 48:case 82:{c=d.sysBm.getBm("cat_mex");break}}}}return c||(d.device.getChType()[e]?c=d.sysBm.getBm("cat_drm"):c=d.sysBm.getBm("no_vox")),c}get noteProgress(){return t(this,lt)/t(this,Ve)}get noteOverall(){return this.noteProgress-t(this,Pe)}get noteBar(){return Math.floor(this.noteOverall/t(this,se))}get noteBeat(){let e=this.noteOverall%t(this,se);return e<0&&(e+=t(this,se)),e}get noteOffset(){return t(this,Pe)}getTimeSig(){return[t(this,se),t(this,ot)]}getTempo(){return t(this,Fe)}eachVoice(e){t(this,At).forEach(e)}sendCmd(e){this.device.runJson(e)}render(e){var D;e>t(this,lt)&&x(this,lt,e);let r=((D=t(this,it))==null?void 0:D.step(e))||[],d=0,c=0,p=new Set,m={},C=[],E=this,a=[];for(E.device.getStrength().forEach((M,I)=>{t(E,Dt)[I]=M}),E.device.newStrength(),r.forEach(function(M){let I=M.data,K=E.device.runJson(I);switch(K==null?void 0:K.reply){case"meta":{a.push(K);break}}K!=null&&K.reply&&delete K.reply});t(E,Et).length>0;){let M=t(E,Et).shift(),I=M.part<<7|M.note;M.state?(p.add(I),m[I]=M.velo):p.has(I)&&(C.push({part:M.part,note:M.note,velo:m[I],state:E.device.NOTE_SUSTAIN}),d++,c+=t(E,Ke)[M.part])}(a==null?void 0:a.length)>0&&E.dispatchEvent("meta",a);let h=E.device.getActive(),s=[],i=E.device.getPitch(),n=E.device.getCcAll(),o=E.device.getProgram(),l=E.device.getChType(),u=[],f=E.device.getStrength();f.forEach(function(M,I,K){K[I]=Math.max(t(E,Dt)[I],M);let V=K[I]-t(E,ct)[I],Re=$.length*I;if(V>=0){let Nt=4*.25**(n[Re+$[73]]/64);t(E,ct)[I]+=Math.ceil(V-V*E.smoothingAtk**Nt)}else{let Nt=4*.25**(n[Re+$[72]]/64);t(E,ct)[I]+=Math.floor(V-V*E.smoothingDcy**Nt)}});let v=0,y=0;return h.forEach(function(M,I){M&&(s[I]=E.device.getVel(I),u[I]=E.device.getExt(I),v+=s[I].size,y+=s[I].size*t(E,Ke)[I])}),{extraPoly:d,extraPolyEC:c,extraNotes:C,curPoly:v,curPolyEC:y,chInUse:h,chKeyPr:s,chPitch:i,chProgr:o,chContr:n,chType:l,chExt:u,eventCount:r.length,title:t(E,Be),bitmap:E.device.getBitmap(),letter:E.device.getLetter(),texts:E.device.getTexts(),master:E.device.getMaster(),mode:E.device.getMode(),strength:t(E,ct).slice(),velo:f,rpn:E.device.getRpn(),tSig:E.getTimeSig(),tempo:E.getTempo(),noteBar:E.noteBar,noteBeat:E.noteBeat,ace:E.device.getAce(),rawVelo:E.device.getStrength(),rawStrength:E.device.getRawStrength(),rawPitch:E.device.getRawPitch(),efxSink:E.device.getEffectSink()}}},it=new WeakMap,Xe=new WeakMap,vt=new WeakMap,Be=new WeakMap,nt=new WeakMap,Et=new WeakMap,ct=new WeakMap,Dt=new WeakMap,Ve=new WeakMap,Fe=new WeakMap,se=new WeakMap,ot=new WeakMap,Pe=new WeakMap,lt=new WeakMap,At=new WeakMap,Ke=new WeakMap,Or);export{us as RootDisplay,b as allocated,$ as ccToPos,ge as dnToPos};
