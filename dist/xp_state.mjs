var va=Object.defineProperty;var Sa=(p,g,e)=>g in p?va(p,g,{enumerable:!0,configurable:!0,writable:!0,value:e}):p[g]=e;var A=(p,g,e)=>(Sa(p,typeof g!="symbol"?g+"":g,e),e),qt=(p,g,e)=>{if(!g.has(p))throw TypeError("Cannot "+e)};var a=(p,g,e)=>(qt(p,g,"read from private field"),e?e.call(p):g.get(p)),T=(p,g,e)=>{if(g.has(p))throw TypeError("Cannot add the same private member more than once");g instanceof WeakSet?g.add(p):g.set(p,e)},x=(p,g,e,r)=>(qt(p,g,"write to private field"),r?r.call(p,e):g.set(p,e),e);(function(){var p=function(C,S,w){var M,R;if(self.MessageEvent)switch(C){case"message":{R=new MessageEvent(C,{data:S,ports:w==null?void 0:w.ports}),Object.defineProperty(R,"source",{value:w==null?void 0:w.source});break}default:R=new Event(C)}else R=document.createEvent("Event"),R.initEvent(C,!1,!1),w&&C=="message"&&(R.data=S,w.source&&Object.defineProperty(R,"source",{value:w.source}),(M=w.ports)!=null&&M.length&&Object.defineProperty(R,"ports",{value:w.ports}));return R};self.BroadcastChannel?console.info("[Snowy] Snowy is disabled."):(console.info("[Snowy] Snowy is enabled. Path: ".concat(self.SNOWY_PATH||"/snowy.js")),e=[],r={},d=function(C){var S,w=this;if((this==null?void 0:this.constructor)!=d)throw new TypeError("Illegal constructor");e.push(this),(S=r[C])!=null&&S.constructor||(r[C]=[]),r[C].push(this);var M=Math.floor(Math.random()*281474976710656),R=[],t=0,o=[],l=!0,s=!1;Object.defineProperty(this,"id",{get:function(){return M}}),Object.defineProperty(this,"name",{value:C}),this.close=function(){var i,c=e.indexOf(w);c>-1?(g.postMessage({t:"d",c:C,i:M}),e.splice(c,1),(i=r[C])!=null&&i.constructor&&(c=r[C].indexOf(w),c>-1&&r[C].splice(c,1)),r[C].length||delete r[C],console.debug("[Snowy] BroadcastChannel closed."),s=!0):console.debug("[Snowy] BroadcastChannel already closed.")},this.postMessage=function(i){if(g){if(s)throw new Error("Channel already closed");g.postMessage({t:"m",c:C,i:M,m:t,d:i}),t++,t>4294967295&&(t=0)}else o.push(i),console.debug("[Snowy] Message is cached.")},this.flush=function(){if(g){if(l){for(g.postMessage({t:"r",c:C,i:M}),console.debug("[Snowy] ".concat(o.length," message(s) in cache."));o.length;){var i=o.shift();w.postMessage(i)}l=!1,console.debug("[Snowy] All cached messages are flushed away.")}}else throw new Error("Tried to flush when the ports are not ready")},this.receiveMessage=function(i){i.c==C?i.i!=M&&w.dispatchEvent(p("message",i.d,{source:w})):console.debug("[Snowy] Channel ID mismatch. Instance ".concat(M," receives from ").concat(C,", not ").concat(i.c,"."))};var n={};this.dispatchEvent=function(i){var c,f;if(Object.defineProperty(i,"target",{value:w}),Object.defineProperty(i,"currentTarget",{value:w}),(c=n[i.type])!=null&&c.length)for(var h=n[i.type],E=0;E<h.length;E++)((f=h[E])==null?void 0:f.constructor)==Function&&h[E].call(w,i);w["on".concat(i.type)]&&w["on".concat(i.type)].constructor==Function&&w["on".concat(i.type)].call(w,i)},this.addEventListener=function(i,c){var f;(f=n[i])!=null&&f.constructor||(n[i]=[]);var h=n[i].indexOf(c);h==-1&&n[i].push(c)},this.removeEventListener=function(i,c){var f,h;if((f=n[i])!=null&&f.length){var E=n[i].indexOf(c);E>-1&&n[i].splice(E,1)}!((h=n[i])!=null&&h.length)&&n[i].constructor&&delete n[i]}},self.BroadcastChannel=d,u=function(){if(g){g.addEventListener("message",function(S){var w=S.data,M=!1;switch(w.t){case"k":{M=!1,g.postMessage({t:"k"});break}case"m":{var R=r[w.c];if(R!=null&&R.length)for(var t=0;t<R.length;t++)R[t].receiveMessage(w);break}case"c":{for(var o=[],l=0;l<e.length;l++){var s=e[l].name;o.indexOf(s)<0&&o.push(s)}g.postMessage({t:"k",c:o});break}default:M=!0}M&&console.info("ReceiveBroadcast",w)});for(var C=0;C<e.length;C++)e[C].flush()}else throw new Error("Message port isn't yet ready");console.info("[Snowy] Snowy is active.")},b=function(){if(!g){var C=new SharedWorker(self.SNOWY_PATH||"/snowy.js");C.port.start();var S=function(w){w.data.t=="swc"&&(C.port.removeEventListener("message",S),g=C.port,g.postMessage({t:"k"}),u())};C.port.addEventListener("message",S)}},b());var g,e,r,d,u,b})();{let p=function(g,e){let r=new FileReader;return new Promise((d,u)=>{switch(r.addEventListener("abort",()=>{u(new Error("Blob read aborted"))}),r.addEventListener("error",b=>{u(r.error||b.data||new Error("Blob read error"))}),r.addEventListener("load",()=>{d(r.result)}),e.toLowerCase()){case"arraybuffer":case"buffer":{r.readAsArrayBuffer(g);break}case"string":case"text":{r.readAsText(g);break}default:u(new Error(`Unknown target ${e}`))}})};Blob.prototype.arrayBuffer=Blob.prototype.arrayBuffer||function(){return p(this,"buffer")},Blob.prototype.text=Blob.prototype.text||function(){return p(this,"text")}}String.prototype.replaceAll=String.prototype.replaceAll||function(p,g){let e=0,r=16,d=this,u=[];for(;e<r&&d.lastIndexOf(p)>-1;){let b=d.lastIndexOf(p);u.unshift(d.slice(b+p.length)),d=d.slice(0,b),b==0&&u.unshift(""),e++}return d.length&&u.unshift(d),u.join(g)||""},String.prototype.padStart=String.prototype.padStart||function(p,g){if(g){let e=this;for(;e.length<p;)e=`${g}${e}`;return e}},String.prototype.padEnd=String.prototype.padEnd||function(p,g){if(g){let e=this;for(;e.length<p;)e+=g;return e}};var Qt=function(p,g){let e=Math.min(p.length,g.length),r=p.slice(0,e),d=g.slice(0,e),u=0,b=0;for(;b<e&&u==0;)u=Math.sign(r[b]-d[b]),b++;return u},Ce=function(p=""){this.name=p,this.pool=[],this.point=function(g,e=!1){if(this.pool.length>0){let r=this.pool.length,d=1<<Math.floor(Math.log2(r)),u=d,b=64;for(;d>=1&&b>=0;){if(b<=0)throw new Error("TTL reached.");if(u==r)u-=d;else{let S=Qt(g,this.pool[u]);switch(S){case 0:{b=0;break}case 1:{u+d<=r&&(u+=d);break}case-1:{u!=0&&(u-=d);break}default:console.warn(`Unexpected result ${S}.`)}}d=d>>1,b--}let C=!0;if(u>=this.pool.length)C=!1;else{let S=this;this.pool[u].forEach(function(w,M,R){C&&w!=g[M]&&(C=!1)}),!C&&Qt(g,this.pool[u])>0&&u++}return C||e?u:-1}else return e?0:-1},this.add=function(g,e){return g.data=e,this.pool.splice(this.point(g,!0),0,g),this},this.default=function(g){console.warn(`No match in "${this.name||"(unknown)"}" for "${g}". Default action not defined.`)},this.get=function(g){let e=this.point(g);if(e>-1)return this.pool[e].data;this.default(g)},this.run=function(g,...e){let r=this.point(g);r>-1?g.subarray?this.pool[r].data(g.subarray(this.pool[r].length),...e):this.pool[r].data(g.slice(this.pool[r].length),...e):this.default(g,...e)}};var he,Jt,Zt=(Jt=class{constructor(){T(this,he,{})}addEventListener(p,g){a(this,he)[p]||(a(this,he)[p]=[]),a(this,he)[p].unshift(g)}removeEventListener(p,g){if(a(this,he)[p]){let e=a(this,he)[p].indexOf(g);e>-1&&a(this,he)[p].splice(e,1),a(this,he)[p].length<1&&delete a(this,he)[p]}}dispatchEvent(p,g){var d;let e=new Event(p),r=this;e.data=g,((d=a(this,he)[p])==null?void 0:d.length)>0&&a(this,he)[p].forEach(function(u){try{u==null||u.call(r,e)}catch(b){console.error(b)}}),this[`on${p}`]&&this[`on${p}`](e)}},he=new WeakMap,Jt);var xa=["MSB","PRG","LSB","NME","ELC","DRM","LVL","VXP"],Ta={krs:"KR",s90es:"ES",motif:"ES"},Ma={krs:"Kr",s90es:"SE",motif:"ME"},Pt={g2:new Set("gm,GM,g2,G2".split(",")),xg:new Set};for(let p of"XG,MU,AN,AP,DR,DX,PC,PF,SG,VL".split(","))Pt.xg.add(p),Pt.xg.add(p.toLowerCase());var Nt=function(p){let g=Math.floor(p/10),e=p%10;return`${g.toString(16)}${e}`},ae,jt,Ht=(jt=class{constructor(...p){A(this,"HINT_XG_MUBASIC",0);A(this,"HINT_XG_MU100",1);A(this,"HINT_XG_PSR",2);T(this,ae,void 0);A(this,"strictMode",!1);this.loadFiles(...p)}get bankInfo(){return a(this,ae)}get(p=0,g=0,e=0,r,d=0){var E,m,O;let u=[p,g,e],b,C=1,S=0,w,M,R,t=Array.from(arguments);switch(r){case"xg":{switch(p){case 0:{if(d===2)e>>4===7?t[2]+=16:e>>3===13&&(t[2]+=40);else switch(e){case 127:{t[2]=0;break}}break}case 16:{e===126&&(t[2]=0);break}case 32:{e>125&&(t[2]=0),t[2]+=4;break}case 33:{(e>125||e===3)&&(t[2]=0),t[2]+=5;break}case 34:case 35:case 36:{e>125&&(t[2]=0),t[2]+=5;break}case 79:case 80:case 81:case 82:case 83:case 84:t[0]+=16;case 95:case 96:case 97:case 98:case 99:case 100:{e===126&&(t[2]=0);break}case 48:case 64:case 126:case 127:{e===126&&(p===127&&g===0||(t[2]=0));break}case 121:{switch(e){case 126:{t[2]=0;break}case 16:{t[2]=15;break}default:t[2]=t[2]&15}break}}break}case"gs":case"sc":{p===0&&e<5?t[0]=49:p<128&&p>125&&e<5&&e!==2&&(t[2]=p,t[0]=49);break}case"mt32":{p===0&&(t[0]=49);break}case"sd":{switch(p){case 121:{t[0]=96;break}case 120:{t[0]=104;break}}t[0]>>1===40?t[2]|=16:t[0]>95&&t[0]<100&&(t[2]|=16,g>>4===7&&(t[0]=96));break}case"pa":{switch(p){case 120:{e==64?t[2]=2:t[2]=1;break}case 121:{switch(e){case 127:{t[2]=79;break}default:t[2]=(t[2]&63)+32}break}}break}case"g2":{p>>1===40?t[2]|=16:p>95&&p<100&&(t[2]|=16,g>>4===7&&(t[0]=96));break}case"sg":{p===8&&e===0&&(t[2]=5);break}case"05rw":case"x5d":{p&&p<56&&(t[0]=56);break}case"s90es":case"motif":case"an1x":case"cs1x":case"cs6x":{if(p===0)break;switch(p){case 63:{switch(r){case"s90es":{e<8?t[2]+=17:e<32?t[2]+=13:t[2]=(t[2]>>3)+19;break}case"motif":{e<8?t[2]+=28:e<32?t[2]+=13:t[2]=(t[2]>>3)+19;break}case"cs1x":{switch(e>>1){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:case 10:{t[2]+=34;break}case 32:{t[2]=34+((e&1)<<2);break}case 33:{t[2]=47+((e&1)<<2);break}case 61:{t[2]=34+((e&1)<<2);break}case 62:{t[2]=47+((e&1)<<2);break}}break}}break}case 32:{e>125&&(t[2]=0),t[2]+=4;break}case 33:{(e>125||e===3)&&(t[2]=0),t[2]+=5;break}case 34:case 35:case 36:{e>125&&(t[2]=0),t[2]+=5;break}case 79:case 80:case 81:case 82:case 83:case 84:t[0]+=16;case 95:case 96:case 97:case 98:case 99:case 100:{e===126&&(t[2]=0);break}}break}}let o=" ",l="M",s="",n=0,i=0;switch(t[0]){case 0:{switch(t[2]){case 127:{l="GM-a";break}case 126:{l="GM-n";break}case 7:{l="GM-k",s="GLX";break}case 5:{l="SG-a",s="000";break}case 4:{r==="gs"||r==="sc"?(l="GM-a",s="000"):(l="SP-l",s="C/M");break}case 3:case 2:case 1:{(r==="gs"||r==="sc")&&(l="GM-a",s="000");break}case 0:{l="GM-a";break}default:l="y",n=3}break}case 8:{r==="sg"?l="GM-s":l="r:";break}case 32:case 33:case 34:case 35:case 36:{r==="xg"&&(l=`${["AP","VL","PF","DX","AN"][p&7]}-${"abcdefgh"[e]}`,n=3);break}case 48:{s=`M${(t[2]>>3).toString().padStart(2,"0")}`,l=`y${s}`,n=1;break}case 49:{t[2]>>1===63?(l=`MT-${"ba"[t[2]&1]}`,s=`C${"-/"[t[2]&1]}M`):(l="GM-a",s="000");break}case 56:{l="GM-b";break}case 57:l=["yDOC","QY10","QY20"][t[2]-112]||"yMxv",s=["DOC","QY1","QY2"][t[2]-112]||"057";case 61:case 128:{l="rDrm";break}case 120:{l="gDrm";break}case 62:{l="kDrm";break}case 63:{if(t[2]<17){let P=t[2];l=P<10?"kP:":"kC:",l+=P%10}else if(t[2]<34)l=["Pre1","Pre2","Pre3","Pre4","Usr1","Usr2","DrmP","DrmU","Plg1","Plg2","Plg3","Pre1","Pre2","Pre3","Pre4","Pre5","Pre6"][t[2]-17];else if(t[2]<55){let P=t[2]-34;switch(P>12&&P--,e>>1){case 32:case 33:{l=`Pr${e-63}U`;break}case 61:case 62:{l=`Pr${e-121}U`;break}default:l=t[2]===46?"PrDr":`Pr${(P>>2)+1}${String.fromCharCode(65+(P&3))}`}}else l="Ds";n=1;break}case 64:{l="ySFX",s="SFX";break}case 67:{l="DX:S";break}case 80:case 81:case 82:case 83:{l=`Prg${"UABC"[t[0]-80]}`;break}case 88:case 89:case 90:case 91:{l=`Cmb${"UABC"[t[0]-88]}`;break}case 95:{l=`${["DR","PC"][t[2]]}-d`;break}case 96:{l=t[2]===106?"AP-a":t[2]>>4===1?"SDg":"PF",t[2]>63?i=63:t[2]>>4===1&&(i=16),n=3;break}case 97:{l=t[2]>>4===1?"SDa":"VL:",n=3,t[2]>>4===1?i=16:i=112;break}case 98:{l=t[2]>>4===1?"SDb":"SG-a",n=3,i=16;break}case 99:{l=t[2]>>4===1?"SDc":"DX",t[2]>63?i=63:t[2]>>4===1&&(i=16),n=3;break}case 100:{l="AN",t[2]>63?i=63:t[2]>>4===1&&(i=16),n=3;break}case 104:case 105:case 106:case 107:{l="SDd",i=104;break}case 121:{l=`GM${t[2]?"":"-a"}`,n=1;break}case 122:{l="lDrm";break}case 126:{l="yDrS";break}case 127:{t[2]===127?l="rDrm":l="yDrm";break}default:t[0]<48?l="r:":l="M"}l.length<4&&(l+=`${[p,e,t[0],t[2]][n]-i}`.padStart(4-l.length,"0")),s.length<3&&(s+=`${[p,e,p,e][n]}`.padStart(3-s.length,"0")),r==="xg"&&(p===0?t[2]<100?l=l.replace("y0","y:"):t[2]===125&&(l="y126"):p===16?(b=`Voice${((t[2]<<7)+t[1]+1).toString().padStart(3,"0")}`,o=" "):p===35&&e>>1===2&&(b=`DXCH_${(((t[2]&1)<<7)+g+1).toString().padStart(3,"0")}`,o=" "));let c=[t[0],t[1],t[2]];for(;!((b==null?void 0:b.length)>=0);)if(b=(E=a(this,ae)[t[1]||0][(t[0]<<8)+t[2]])==null?void 0:E.name,b){let P=a(this,ae)[t[1]||0][(t[0]<<8)+t[2]];C=(P==null?void 0:P.poly)||C,S=(P==null?void 0:P.type)||S,w=P==null?void 0:P.drum,M=P==null?void 0:P.level,R=P==null?void 0:P.voice}else if(this.strictMode)b="",o="?";else if(t[0]===0&&t[1]===0&&t[2]===0)b="Unloaded";else if(a(this,ae)[t[1]||0][t[0]<<8])t[0]===0?(t[2]=0,o="^"):t[2]<1?(t[0]=0,o="*"):(t[2]--,o="^");else if(p===48)t[0]=0,t[2]=0,o="!";else if(p===62)t[1]--,o=" ",t[1]<1&&!(b!=null&&b.length)&&(t[0]=0,o="!");else if(p<63)t[0]===0?(t[2]=0,o="^"):t[2]<1?(t[0]=0,o="*"):t[2]--;else if(p===80)b=`PrgU:${g.toString().padStart(3,"0")}`,o="!";else if(p===88)b=`CmbU:${g.toString().padStart(3,"0")}`,o="!";else if(p===121)b=`GM2Vox0${e}`,o="#";else if(p===122)if(t[1]===32?t[1]:t[1]%=7,b=(m=a(this,ae)[t[1]||0][(t[0]<<8)+t[2]])==null?void 0:m.name,b){o=" ";let P=a(this,ae)[t[1]||0][(t[0]<<8)+t[2]];C=(P==null?void 0:P.poly)||C,S=(P==null?void 0:P.type)||S,w=P==null?void 0:P.drum,M=P==null?void 0:P.level}else b="",o="*";else t[1]===0?(b=`${p.toString().padStart(3,"0")} ${g.toString().padStart(3,"0")} ${e.toString().padStart(3,"0")}`,o="!"):t[0]===0?(t[2]=0,o="^"):t[2]>0?t[2]--:t[1]>0?(t[1]=0,o="!"):(t[0]=0,o="?");let f=[t[0],t[1],t[2]];switch(o){case"^":{switch(r){case"gs":case"sc":case"ns5r":{o=" ";break}case"xg":{(e===126||e===152)&&(o=" ");break}}p===127&&(o=" ");break}case"*":break;case"!":break;case"?":break}let h="??";switch(t[0]){case 0:{t[2]===0?h="GM":t[2]===5||t[2]===7?h="KG":t[2]<154&&(h="XG");break}case 32:case 33:case 35:case 36:{t[2]>4?h=["AP","VL","PF","DX","AN"][t[0]-32]:h="GS";break}case 48:{h="MU";break}case 49:{t[2]>>1===63?h="MT":t[2]<5&&(h="GM");break}case 56:case 62:{h="AG";break}case 61:case 80:case 83:case 88:case 89:case 91:{h="AI";break}case 82:case 90:{h="XD";break}case 63:{t[2]<17?h="KR":t[2]<34?h="ES":t[2]<55?h="CS":h="DS";break}case 64:case 126:{h="XG";break}case 67:case 99:{h=t[2]>>4===1?"SD":"DX";break}case 81:{h="RW";break}case 95:{h=["DR","PC"][t[2]];break}case 96:{h=t[2]===106?"AP":t[2]>>4===1?"SD":"PF";break}case 97:{h=t[2]>>4===1?"SD":"VL";break}case 98:{h=t[2]>>4===1?"SD":"SG";break}case 100:{h="AN";break}case 104:case 105:case 106:case 107:{h="SD";break}case 120:{h=g===0?"GM":(O=["G2","PA","PA"][t[2]])!=null?O:"G2";break}case 128:{h=g===0?"GM":"GS";break}case 121:{h=t[2]?["G2","XG","PA","PA","PA"][t[2]>>4]:"GM";break}case 122:{h="KG";break}case 127:{h=t[2]===127?"MT":g===0?"GM":"XG";break}default:t[0]<48&&(t[0]===16&&r==="xg"?h="XG":h="GS")}switch(r){case"xg":{let P=0,ee=0,F="GM",le=!1,Ie=!1;if(Pt.xg.has(h)||Pt.g2.has(h)?o!==" "?p>>4===6?Ie=!0:p!==0&&(le=!0):c[2]!==f[2]&&(p===81?e>>3===14?(P=97,ee=112,Ie=!0,F="VL"):e>>3===15&&(le=!0):p===97&&(Ie=!0)):p>>4===6?Ie=!0:le=!0,Ie&&p===0&&e===0&&(ee=[0,126,152][d]),le)b="Silence",o="?",h="??";else if(Ie){let V=a(this,ae)[g][P<<8|ee];h=F,b=V==null?void 0:V.name,C=(V==null?void 0:V.poly)||C,S=(V==null?void 0:V.type)||S,w=V==null?void 0:V.drum,M=V==null?void 0:V.level,R=V==null?void 0:V.voice,o="^"}break}}if(o!==" ")switch(r){case"krs":case"s90es":case"motif":{b="",h=Ta[r],o="?";break}case"g2":{b="GM2 Ext?",o="?";break}case"pa":{o==="^"&&(b="Unknown",o="?");break}case"xg":{if(o!=="^"){switch(p){case 120:case 127:case 126:{b="SilntKit";break}default:b="Silence"}o="?"}break}default:self.debugMode&&(b="",o="?")}return o==="?"&&(C=0),{name:b||`${Ma[r]||r.toUpperCase()}${Nt(p||0)}${Nt(g||0)}${Nt(e||0)}`,poly:C,type:S,drum:w,level:M,voice:R,iid:c,eid:f,sid:u,hint:d,ending:o,sect:l,bank:s,standard:h,mode:r}}async load(p,g,e="(internal)",r){let d=this,u=[],b=0,C=0,S=0;p.split(`
`).forEach(function(w,M){var o;let R=w.split("	"),t=[];if(M===0){if(R.forEach(function(l,s){u[xa.indexOf(l)]=s}),u.length<4){console.debug("Debugger launched.");debugger}}else{let l=0,s=0,n=0,i,c=1,f=0,h,E,m;R.forEach(function(F,le){switch(le){case u[0]:{l=parseInt(F);break}case u[1]:{s=parseInt(F);break}case u[2]:{n=parseInt(F);break}case u[3]:{i=F;break}case u[4]:{F=parseInt(F),F<16?c=F+1:(f=(F&15)+1,c=f);break}case u[5]:{E=F;break}case u[6]:{typeof F=="string"&&(h=parseInt(F));break}case u[7]:{m=F;break}}}),a(d,ae)[s]=a(d,ae)[s]||[];let O=a(d,ae)[s],P={msb:l,prg:s,lsb:n,name:i,poly:c,type:f,drum:E,level:h,voice:m,priority:r},ee=!1;r<((o=O[l<<8|n])==null?void 0:o.priority)&&(ee=!0,S++),(!O[l<<8|n]||ee||g)&&(O[l<<8|n]=P,b++),C++}}),g||console.debug(`Map: From "${e}", ${C} total, ${b} loaded (${b-S} + ${S}).`)}clearRange(p){let g=p.prg!==void 0?p.prg.constructor===Array?p.prg:[p.prg,p.prg]:[0,127],e=p.msb!==void 0?p.msb.constructor===Array?p.msb:[p.msb,p.msb]:[0,127],r=p.lsb!==void 0?p.lsb.constructor===Array?p.lsb:[p.lsb,p.lsb]:[0,127];for(let d=e[0];d<=e[1];d++){let u=d<<8;for(let b=r[0];b<=r[1];b++){let C=u+b;for(let S=g[0];S<=g[1];S++)delete a(this,ae)[S][C]}}}init(){x(this,ae,[]);for(let p=0;p<128;p++)a(this,ae).push([""])}async loadFiles(...p){this.init();let g=this;p.forEach(async function(e,r){try{g.load(await(await fetch(`./data/bank/${e}.tsv`)).text(),!1,e,r)}catch(d){console.error(`Failed loading "${e}.tsv".`)}})}},ae=new WeakMap,jt);var st,ea,ta=(ea=class{constructor(){T(this,st,{});A(this,"context")}set(p,g){a(this,st)[p]=g}has(p){return!!a(this,st)[p]}async read(p,g){if(!this.has(p))throw new Error(`No decoder registered for "${p}"`);return await a(this,st)[p].call(this.context||this,g)}},st=new WeakMap,ea);var Pa=function(p,g){let e=!0;return g.forEach((r,d)=>{e=e&&p[d]===r}),e},yt=function(p){let g=0;return p.forEach(e=>{g*=256,g+=e}),g},Pe=new TextDecoder,gt=new ta;gt.set("s7e",async function(p){let g=new Uint8Array(await p.slice(0,65536).arrayBuffer()),e="MSB	LSB	PRG	NME",r=[0,0,0,0],d=32,u=0,b=0,C=!0,S=[],w=0;for(;C;){let M=g.subarray(u);([()=>{Pe.decode(M.subarray(0,4))==="YSFC"?(u+=80,b=1):u++},()=>{if(Pa(M.subarray(0,4),r))S.forEach((R,t,o)=>{let l=yt(g.subarray(R.start+4,R.start+8));R.length=l}),b=2;else{let R=Pe.decode(M.subarray(0,4)),t=yt(M.subarray(4,8));S.push({type:R,start:t}),u+=8}},()=>{let R=S[w],t=g.subarray(R.start,R.start+R.length),o=32;switch(R.type){case"ENVC":{let l=d;for(;l<t.length;){let s=t.subarray(l,l+o),n=Pe.decode(s.subarray(0,10)).trimEnd();n.slice(0,5)==="Init "&&(n=""),n&&(e+=`
063	${(s[17]+13).toString().padStart(3,"0")}	${s[19].toString().padStart(3,"0")}	${n}`),l+=o}break}case"EDVC":{let l=d;for(;l<t.length;){let s=t.subarray(l,l+o),n=Pe.decode(s.subarray(0,10)).trimEnd();n.slice(0,5)==="Init "&&(n=""),n&&(e+=`
063	024	${s[19].toString().padStart(3,"0")}	${n}`),l+=o}break}case"EPVC":{let l=32,s=d;for(;s<t.length;){let n=t.subarray(s,s+l),i=Pe.decode(n.subarray(0,10)).trimEnd();i==="----------"&&(i=""),i&&(e+=`
063	${(n[17]+1).toString().padStart(3,"0")}	${n[19].toString().padStart(3,"0")}	${i}`),s+=l}break}}w++,w>=S.length&&(b=3,C=!1)}][b]||(()=>{C=!1}))()}return e});gt.set("pcg",async function(p){let g=new Uint8Array(await p.arrayBuffer()),e="MSB	LSB	PRG	NME",r=100,d=0,u=0,b=!0,C=[],S=0;for(;b;){let w=g.subarray(r);([()=>{b=Pe.decode(w.subarray(0,4))==="INI2",u=w[15],r+=16,d=1},()=>{let M=Pe.decode(w.subarray(0,4)),R=w[5],t=w[7],o=w[11],l=yt(w.subarray(12,16)),s=yt(w.subarray(16,20)),n=yt(w.subarray(36,40)),i=Pe.decode(w.subarray(44,44+o));C.push({type:M,tipMsb:R,tipLsb:t,nameLen:o,length:l,start:s,entryLen:n,name:i}),r+=64,u--,u<1&&(d=2)},()=>{let M=C[S],R=g.subarray(M.start,M.start+M.length);switch(M.type){case"PRG1":break;case"PBK1":{let t=63,o=(M.tipMsb?6:0)+M.tipLsb;for(let l=0;l<128;l++){let s=l*M.entryLen,n=R.subarray(s,s+M.entryLen),i=Pe.decode(n.subarray(0,24)).trimEnd().replace("InitProg","");i.length&&o>5&&(e+=`
${t.toString().padStart(3,"0")}	${o.toString().padStart(3,"0")}	${l.toString().padStart(3,"0")}	${i}`)}break}case"CBK1":{let t=63,o=(M.tipMsb?3:0)+M.tipLsb+10;for(let l=0;l<128;l++){let s=l*M.entryLen,n=R.subarray(s,s+M.entryLen),i=Pe.decode(n.subarray(0,24)).trimEnd().replace("InitCombi","");i.length&&o>12&&(e+=`
${t.toString().padStart(3,"0")}	${o.toString().padStart(3,"0")}	${l.toString().padStart(3,"0")}	${i}`)}break}}S++,S>=C.length&&(d=3,b=!1)}][d]||(()=>{b=!1}))()}return e});var Et=["off","hall","room","stage","plate","delay LCR","delay LR","echo","cross delay","early reflections","gate reverb","reverse gate"].concat(new Array(4),["white room","tunnel","canyon","basement","karaoke"],new Array(43),["pass through","chorus","celeste","flanger","symphonic","rotary speaker","tremelo","auto pan","phaser","distortion","overdrive","amplifier","3-band EQ","2-band EQ","auto wah"],new Array(1),["pitch change","harmonic","touch wah","compressor","noise gate","voice channel","2-way rotary speaker","ensemble detune","ambience"],new Array(4),["talking mod","Lo-Fi","dist + delay","comp + dist + delay","wah + dist + delay","V dist","dual rotor speaker"]),Ct=["melodic","drums","drum set 1","drum set 2","drum set 3","drum set 4","drum set 5","drum set 6","drum set 7","drum set 8"],Ra=[17.1,18.6,20.2,21.8,23.3,24.9,26.5,28,29.6,31.2,32.8,34.3,35.9,37.5,39,40.6,42.2,43.7,45.3,46.9,48.4,50],it=[20,22,25,28,32,36,40,45,50,56,63,70,80,90,100,110,125,140,160,180,200,225,250,280,315,355,400,450,500,560,630,700,800,900,1e3,1100,1200,1400,1600,1800,2e3,2200,2500,2800,3200,3600,4e3,4500,5e3,5600,6300,7e3,8e3,9e3,1e4,11e3,12e3,14e3,16e3,18e3,2e4],aa=[0,.04,.08,.13,.17,.21,.25,.29,.34,.38,.42,.46,.51,.55,.59,.63,.67,.72,.76,.8,.84,.88,.93,.97,1.01,1.05,1.09,1.14,1.18,1.22,1.26,1.3,1.35,1.39,1.43,1.47,1.51,1.56,1.6,1.64,1.68,1.72,1.77,1.81,1.85,1.89,1.94,1.98,2.02,2.06,2.1,2.15,2.19,2.23,2.27,2.31,2.36,2.4,2.44,2.48,2.52,2.57,2.61,2.65,2.69,2.78,2.86,2.94,3.03,3.11,3.2,3.28,3.37,3.45,3.53,3.62,3.7,3.87,4.04,4.21,4,37,4.54,4.71,4.88,5.05,5.22,5.38,5.55,5.72,6.06,6.39,6.73,7.07,7.4,7.74,8.08,8.41,8.75,9.08,9.42,9.76,10.1,10.8,11.4,12.1,12.8,13.5,14.1,14.8,15.5,16.2,16.8,17.5,18.2,19.5,20.9,22.2,23.6,24.9,26.2,27.6,28.9,30.3,31.6,33,34.3,37,39.7],ra=function(p){let g=.1,e=-.3;return p>66?(g=5,e=315):p>56?(g=1,e=47):p>46&&(g=.5,e=18.5),g*p-e},sa=function(p){return p>105?Ra[p-106]:p>100?p*1.1-100:p/10},ia=",a,i,u,e,o,ka,ki,ku,ke,ko,ky,kw,sa,si,su,se,so,sh,ta,ti,tu,te,to,t,ch,t,s,na,ni,nu,ne,no,ny,nn,ha,hi,hu,he,ho,hy,fa,fi,fu,fe,fo,ma,mi,mu,me,mo,my,mm,ya,yu,ye,yo,ra,ri,ru,re,ro,ry,wa,wi,we,wo,ga,gi,gu,ge,go,gy,gw,za,zi,zu,ze,zo,ja,ji,ju,je,jo,jy,da,di,du,de,do,dy,ba,bi,bu,be,bo,by,va,vi,vu,ve,vo,pa,pi,pu,pe,po,py,nga,ngi,ngu,nge,ngo,ngy,ng,hha,hhi,hhu,hhe,hho,hhy,hhw,*,_,,,~,.".split(","),_t={};`hi*,
ka,„Åã
ki,„Åç
ku,„Åè
ke,„Åë
ko,„Åì
ky,„Åç!
kw,„Åèl
tsu,„Å§
ts,„Å§l
sa,„Åï
si,„Åô„ÅÉ
su,„Åô
se,„Åõ
so,„Åù
shi,„Åó
sh,„Åó!
ta,„Åü
ti,„Å¶„ÅÉ
tu,„Å®„ÅÖ
te,„Å¶
to,„Å®
tchy,„Å°!
tchi,„Å°
na,„Å™
ni,„Å´
nu,„Å¨
ne,„Å≠
no,„ÅÆ
ny,„Å´!
nn,„Çì
ha,„ÅØ
hi,„Å≤
hu,„Åª„ÅÖ
he,„Å∏
ho,„Åª
hy,„Å≤!
fa,„Åµ„ÅÅ
fi,„Åµ„ÅÉ
fu,„Åµ
fe,„Åµ„Åá
fo,„Åµ„Åâ
ma,„Åæ
mi,„Åø
mu,„ÇÄ
me,„ÇÅ
mo,„ÇÇ
my,„Åø!
mm,„á∫
ra,„Çâ
ri,„Çä
ru,„Çã
re,„Çå
ro,„Çç
ry,„Çä!
wa,„Çè
wi,„Çê
we,„Çë
wo,„Çí
nga,„Åã„Çö
ngi,„Åç„Çö
ngu,„Åè„Çö
nge,„Åë„Çö
ngo,„Åì„Çö
ngy,„Åç„Çö!
ng,„É≥
ga,„Åå
gi,„Åé
gu,„Åê
ge,„Åí
go,„Åî
gy,„Åé!
gw,„Åêl
za,„Åñ
zi,„Åö„ÅÉ
zu,„Åö
ze,„Åú
zo,„Åû
ja,„Åò„ÇÉ
ji,„Åò
ju,„Åò„ÇÖ
je,„Åò„Åá
jo,„Åò„Çá
jy,„Åò!
da,„Å†
di,„Åß„ÅÉ
du,„Å©„ÅÖ
de,„Åß
do,„Å©
dy,„Åß!
ba,„Å∞
bi,„Å≥
bu,„Å∂
be,„Åπ
bo,„Åº
by,„Å≥!
va,„Çî„ÅÅ
vi,„Çî„ÅÉ
vu,„Çî
ve,„Çî„Åá
vo,„Çî„Åâ
pa,„Å±
pi,„Å¥
pu,„Å∑
pe,„Éö
po,„ÅΩ
py,„Å¥!
!ya,„ÇÉ
!yu,„ÇÖ
!ye,„Åá
!yo,„Çá
ya,„ÇÑ
yu,„ÇÜ
ye,õÄÅ
yo,„Çà
!a,„ÇÉ
!u,„ÇÖ
!e,„Åá
!o,„Çá
!a,„ÇÉ
!u,„ÇÖ
!e,„Åá
!o,„Çá
la,„ÅÅ
li,„ÅÉ
lu,„ÅÖ
le,„Åá
lo,„Åâ
a,„ÅÇ
i,„ÅÑ
u,„ÅÜ
e,„Åà
o,„Åä
*,„Å£
~,
^,
_,`.split(`
`).forEach(p=>{let g=p.split(",");_t[g[0]]=g[1]});var na=function(p){let g=p;p[0]=="*"&&(g=g.slice(1)),["aa","ii","uu","ee","oo"].forEach(r=>{for(;g.indexOf(r)>-1;)g=g.replace(r,r[0])});for(let r in _t)g=g.replaceAll(r,_t[r]);g.indexOf("„Çì")==0&&g.length>1&&(g=g.slice(1));let e=g.indexOf("!");return e>-1&&g.length>1&&(g=g.slice(e+1)),g},ca=function(p){return p?p<96?`cc${p}`:["aftertouch","velocity","pitch bend"][p-96]:"off"},oa={"":["l9","Undefined fallback"],u8:["utf-8","Unicode"],l1:["l9","Pan-Latin"],jp:["sjis","Japanese"],kr:["iso-2022-kr","Korean"],hz:["gb18030","Simplified Chinese"],b5:["big5","Traditional Chinese"],cy:["koi8-ru","Cyrillic"],vn:["tcvn-5773-1993","Vietnamese"]},la={m:"Male",f:"Female",c:"Chorus",s:"Solo",p:"Plural",w:"Words",x:"Non-vocal"};var Gt=["room 1","room 2","room 3","hall 1","hall 2","plate","delay","panning delay"],ha=["chorus 1","chorus 2","chorus 3","chorus 4","feedback","flanger","short delay","short delay feedback"],da=["delay 1","delay 2","delay 3","delay 4","pan delay 1","pan delay 2","pan delay 3","pan delay 4","delay to reverb","pan repeat"];var Aa={0:"thru",256:"stereo EQ",257:"spectrum",258:"enhancer",259:"humanizer",272:"overdrive",273:"distortion",288:"phaser",289:"auto wah",290:"rotary",291:"stereo flanger",292:"step flanger",293:"tremelo",294:"auto pan",304:"compressor",305:"limiter",320:"hexa chorus",321:"tremelo chorus",322:"stereo chorus",323:"space D",324:"3D chorus",336:"stereo delay",337:"modulated delay",338:"3-tap delay",339:"4-tap delay",340:"tremelo control delay",341:"reverb",342:"gate reverb",343:"3D delay",352:"2-pitch shifter",353:"feedback pitch shifter",368:"3D auto",369:"3D manual",370:"Lo-Fi 1",371:"Lo-Fi 2",512:"overdrive - chorus",513:"overdrive - flanger",514:"overdrive - delay",515:"distortion - chorus",516:"distortion - flanger",517:"distortion - delay",518:"enhancer - chorus",519:"enhancer - flanger",520:"enhancer - delay",521:"chorus - delay",522:"flanger - delay",523:"chorus - flanger",524:"rotary multi",1024:"guitar multi 1",1025:"guitar multi 2",1026:"guitar multi 3",1027:"clean guitar multi 1",1028:"clean guitar multi 2",1029:"bass multi",1030:"rhodes multi",1280:"keyboard multi",4352:"chorus / delay",4353:"flanger / delay",4354:"chorus / flanger",4355:"overdrive / distortion",4356:"overdrive / rotary",4357:"overdrive / phaser",4358:"overdrive / auto wah",4359:"phaser / rotary",4360:"phaser / auto wah"},Oa={66307:["drive"],66309:["vowel",p=>"aiueo"[p]],94723:["pre-filter"],94724:["Lo-Fi type"],94725:["post-filter"],94979:["Lo-Fi type"],94980:["fill type",p=>["off","LPF","HPF"][p]],94984:["noise type",p=>["white","pink"][p]],94987:["disc type",p=>["LP","SP","EP","RND"]],94990:["hum type",p=>`${p+5}0Hz`],94993:["M/S",p=>["mono","stereo"][p]]},Bt=function(p){return Aa[(p[0]-32<<8)+p[1]]||`0x${p[0].toString(16).padStart(2,"0")}${p[1].toString(16).padStart(2,"0")}`},fa=function(p,g,e){let r=(p[0]-32<<16)+(p[1]<<8)+g,d=Oa[r]||{},u=d[0];if(u!=null&&u.length)return u+=`: ${(d[1]||function(){})(e)||e}`,u},Xt=[68,48,95,78,41,3,110,122,0];var Re=new TextEncoder;var fe=function(p=64){return Math.round(2e3*Math.log10(p/64))/100};var Ke=function(p){let g=0;return p.forEach(e=>{g+=e,g=g&127}),~g+1&127},me=function(p,g){let e=0,r=0;for(let d=0;d<p.length;d++){let u=(d&7)-1,b=(r>>u&1)<<7,C=p[d];C+=b,d&7?(g(C,e,p),e++):r=p[d]}};var Da=function(p,g){let e=0;for(let r=0;r<p.length;r++)if(r&1){e=e<<4|p[r]&15;let d=r>>1;g(e,d,p)}else e=p[r]&15},ua=function(p){let g=p.length>>1,e=new Uint8Array(g);return Da(p,(r,d)=>{e[d]=r}),e},mt=function(p){let g=Math.floor(p*14.2);return g<128?g:0},L=function(){var p;return(p=self==null?void 0:self.debugMode)!=null?p:!1},pa=function(p){let g=(p.length+1)*3>>2,e=new Uint8Array(g),r=p.length+3>>2;for(let d=0;d<r;d++){let u=d<<2,b=d*3,C=0;for(let S=0;S<4;S++)C<<=6,C|=p.charCodeAt(u+S)-32&63;e[b]=C>>16,e[b+1]=C>>8&255,e[b+2]=C&255}return e};var kr="‚ô≠ùÑ´,ùÑ´,‚ô≠,,‚ôØ,ùÑ™,ùÑ™‚ôØ".split(",");var de=[new Map,new Map];de[0].set("base64",Re.encode("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"));de[0].set("base64url",Re.encode("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"));de[0].set("hex",Re.encode("0123456789abcdef"));de[0].set("ovm43",Re.encode("0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_"));de[0].set("radix64",Re.encode("0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz+/"));de[0].set("radix64url",Re.encode("0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_"));de[0].set("xx",Re.encode("+-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz"));de[0].set("xxurl",Re.encode("_-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz"));de[0].set("z64",Re.encode("0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ+/"));de[0].set("z64url",Re.encode("0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ-_"));for(let[p,g]of de[0]){let e=new Uint8Array(128).fill(255);for(let r=0;r<g.length;r++)e[g[r]]=r;switch(p){case"hex":{for(let r=10;r<16;r++)e[r+55]=r;break}default:e[9]=254,e[10]=254,e[12]=254,e[13]=254,e[32]=254,e[61]=254}de[1].set(p,e)}console.debug(de);var La=(p="base64",g,e=!1)=>{};self.bufferTo=La;var At={red:"#ff7986",orange:"#fca022",grYellow:"#c9e10a",green:"#c1ff0a",white:"#b7e5e3",blue:"#2280ff"},Rt={black:"#000000",blue:"#0516bb",purple:"#48009a",inactive:22,medium:59,active:170,range:148},Ia=[[6,26],[7,35],[8,44],[9,53],[10,62],[11,71],[12,80],[13,89],[14,98],[15,107],[16,116],[17,125],[18,134],[19,143],[20,152],[21,161],[22,170]],wt={},Ua="06,68,2a,16,aa,3b".split(",");for(let p in Rt)wt[p]=[],Ua.forEach(g=>{wt[p].push(`${Rt[p]}${g}`)});var Ot=[];for(let p of Ia)Ot.push([`${Rt.black}${p[0].toString(16).padStart(2,"0")}`,`${Rt.black}${p[1].toString(16).padStart(2,"0")}`]),p.push(p[1]-p[0]);var Sr=`${At.orange}64`,xr=`${At.green}64`,Tr=`${At.white}64`,Mr=`${At.red}64`,Pr=wt.black[0],Rr=wt.black[2],Ar=wt.black[1];var z=["?","gm","gs","sc","xg","g2","mt32","doc","qy10","qy20","ns5r","x5d","05rw","k11","sg","sd","pa","krs","s90es","motif","cs6x","trin","an1x","cs1x"],Na={gm2:"g2","mt-32":"mt32","c/m":"mt32",ag10:"05rw","ag-10":"05rw","05r/w":"05rw",x5:"05rw",x5dr:"x5d",gmega:"k11","kross 2":"krs","motif es":"motif","s90 es":"s90es",trinity:"trin","tr-rack":"trin"},Ha=["melodic","drum","menu"],kt={"?":[0,0,120,0,0],gm:[0,0,120,0,0],gs:[0,0,128,0,0],sc:[0,0,128,0,0],xg:[0,0,127,0,0],g2:[0,0,120,0,0],mt32:[0,127,127,0,127],doc:[57,112,127,57,112],qy10:[57,113,127,57,113],qy20:[57,114,127,57,114],ns5r:[0,0,61,0,0],x5d:[82,0,62,56,0],"05rw":[81,0,62,56,0],k11:[0,0,122,0,0],sg:[0,0,122,0,0],sd:[97,0,105,0,0],pa:[0,0,120,121,0],krs:[121,0,120,0,0],s90es:[0,0,127,0,0],motif:[0,0,127,0,0],cs6x:[0,0,127,0,0],trin:[0,0,61,0,0],an1x:[36,3,127,0,0],cs1x:[0,0,127,63,0],cs2x:[0,0,127,63,0]},_a=[9,25,41,57,73,89,105,121],Ga=[0,3,81,84,88],ba={8:"Off",9:"On",10:"Note aftertouch",11:"cc",12:"pc",13:"Channel aftertouch",14:"Pitch"},Dt={0:0,1:1,2:3,5:4},ya={0:0,1:1,2:2,5:3},ga=[[0,24],[0,127],[0,127],[40,88],[0,127],[0,127]],Ft=[36,37,48,49,52,53],Ut=[20,21,22,23,24,25,26,28,29,30,31,36,37,48,49,52,53,64,65],Ea={26:127,29:0,30:0,31:0,52:12,53:54},Fe=[0,1,2,4,5,6,7,8,10,11,12,13,14,15,16,17,18,19,20,21,22,26,28,32,38,40,41,42,43,44,45,46,47,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,80,81,82,83,84,91,92,93,94,95,98,99,100,101,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157],Ba=[2,4,12,13,14,15,16,17,18,19,20,21,40,41,42,43,44,45,46,47,80,81,83,136,130,131,132,133,134,135,137,138,139,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157],Xa=[33,102,99,32,100,8,9,10],Ca=[0,16,25,40,32,64,24,48],ma="reverb,chorus,delay,insert0,insert1,insert2,insert3,insert4".split(","),we=[["VL",32,8,1],["SG",8,1,1],["DX",16,1,16],["AN",16,2,5],["PF",2,1,64],["DR",2,1,32],["PC",2,1,32],["AP",2,1,64]],$={};z.forEach((p,g)=>{$[p]=g});var v=[];Fe.forEach((p,g)=>{v[p]=g});var ke={length:Ut.length};Ut.forEach((p,g)=>{ke[p]=g});var Ka={};Ha.forEach((p,g)=>{Ka[p]=g});var Fa=function(p){let g=[],e=0;return p==null||p.forEach(function(r,d){r===247?g.push(p.subarray(e,d)):r===240&&(e=d+1)}),g.length||g.push(p.subarray(0)),L()&&console.debug(g),g};var Kt=8,y={port:Kt,ch:Kt<<4,chShift:Math.ceil(Math.log2(Kt))+4,cc:Fe.length,nn:128,pl:512,tr:256,cmt:14,rpn:6,rpnt:4,nrpn:Ft.length,ace:8,drm:8,dpn:Ut.length,dnc:128,ext:3,efx:8,cvn:12,redir:32,vxPrim:3,invalidCh:255};y.chcc=y.cc*y.ch;var $t={bank0:255},Va=new TextDecoder("l9"),G=new Uint16Array(y.ch),nt=new Uint16Array(y.ch),Ya=new Uint16Array(y.ch),Lt=new Uint16Array(y.ch),za=new Uint16Array(y.ch),ct=new Uint16Array(y.ch),wa=new Array(y.drm);for(let p=0;p<y.ch;p++)G[p]=p*y.cc,nt[p]=p*y.rpn,Ya[p]=p*y.nrpn,Lt[p]=p*y.ace,za[p]=p*y.ext,ct[p]=p*y.cvn;for(let p=0;p<y.drm;p++){wa[p]=new Uint16Array(y.dpn);let g=p*y.dpn*y.dnc;for(let e=0;e<y.dpn;e++)wa[p][e]=g+e*y.dnc}if(typeof(self==null?void 0:self.require)<"u")throw new Error("Environments supporting CommonJS is not supported.");var $e,Ue,ka,Wa=(ka=class{constructor(g){T(this,$e,void 0);T(this,Ue,!0);A(this,"autoRealtime",!1);g&&this.attach(g)}detach(){x(this,$e,void 0),x(this,Ue,!0),this.autoRealtime=!1}attach(g,e){if(typeof g<"u"&&typeof g.currentTime=="number")x(this,$e,g),x(this,Ue,!1),this.autoRealtime=!0;else throw new TypeError("Not a valid time source.")}timeMs(){return typeof(performance==null?void 0:performance.now)=="function"?performance.now():Object.hasOwn(self,"Temporal")?Temporal.Now.instant().epochMilliseconds:Date.now()}get realtime(){return a(this,Ue)||typeof a(this,$e)>"u"}set realtime(g){if(g)x(this,Ue,!0);else{if(typeof a(this,$e)>"u")throw new TypeError("No attached time source is present.");x(this,Ue,!1)}}get currentTime(){return this.realtime||!a(this,$e)?this.timeMs()*.001:a(this,$e).currentTime}now(){return this.realtime||!a(this,$e)?Math.floor(this.timeMs()):Math.round(a(this,$e).currentTime*1e3)}},$e=new WeakMap,Ue=new WeakMap,ka),_,se,ve,Se,Le,ot,qa,vt,ue,B,D,k,re,N,Z,ie,Q,X,Ne,Ae,Ve,ne,I,H,lt,oe,xe,pe,Ye,ze,W,ht,We,ye,qe,dt,He,Te,ft,_e,J,U,Oe,St,Y,Qe,ut,Vt,Yt,zt,Wt,Ge,Be,xt,pt,ge,K,Tt,q,bt,Je,be,De,Xe,ce,Ze,j,Mt,It,je,et,te,Ee,Me,tt,at,rt,$a,Qr=($a=class extends Zt{constructor(){super();T(this,Le);A(this,"NOTE_IDLE",0);A(this,"NOTE_ATTACK",1);A(this,"NOTE_DECAY",2);A(this,"NOTE_SUSTAIN",3);A(this,"NOTE_HELD",4);A(this,"NOTE_RELEASE",5);A(this,"NOTE_SOSTENUTO_ATTACK",8);A(this,"NOTE_SOSTENUTO_DECAY",9);A(this,"NOTE_SOSTENUTO_SUSTAIN",10);A(this,"NOTE_SOSTENUTO_HELD",11);A(this,"NOTE_MUTED_RECOVERABLE",16);A(this,"CH_MELODIC",0);A(this,"CH_DRUMS",1);A(this,"CH_DRUM1",2);A(this,"CH_DRUM2",3);A(this,"CH_DRUM3",4);A(this,"CH_DRUM4",5);A(this,"CH_DRUM5",6);A(this,"CH_DRUM6",7);A(this,"CH_DRUM7",8);A(this,"CH_DRUM8",9);A(this,"DUMP_ALL",0);A(this,"DUMP_ONCE",1);A(this,"DUMP_MODE",2);A(this,"EXT_NONE",0);A(this,"EXT_VL",1);A(this,"EXT_DX",3);A(this,"VLBC_SYSTEM",0);A(this,"VLBC_BRTHEXPR",1);A(this,"VLBC_VELOINIT",2);A(this,"VLBC_VELOALL",3);A(this,"CH_INACTIVE",0);A(this,"CH_ACTIVE",1);A(this,"CH_DISABLED",2);A(this,"KARAOKE_NONE",0);A(this,"KARAOKE_TEXT",1);A(this,"KARAOKE_XF",2);T(this,_,0);T(this,se,0);T(this,ve,0);T(this,Se,new Array(11));T(this,vt,16);T(this,ue,new Uint8Array(y.ch));T(this,B,new Uint8Array(y.ch));T(this,D,new Uint8Array(y.ch));T(this,k,new Uint8Array(y.chcc<<1));T(this,re,new Uint8Array(y.ch*y.ace));T(this,N,new Uint8Array(y.ch*y.vxPrim));T(this,Z,new Uint8Array(y.ch*y.nn));T(this,ie,new Uint8Array(y.ch));T(this,Q,new Uint16Array(y.pl));T(this,X,new Uint8Array(y.pl));T(this,Ne,new Int16Array(y.ch));T(this,Ae,new Uint8Array(y.ch));T(this,Ve,new Uint8Array(y.ch));T(this,ne,new Uint8Array(y.ch*y.ext));T(this,I,new Uint8Array(y.ch*y.rpn));T(this,H,new Uint8Array(y.ch*y.rpnt));T(this,lt,new Int8Array(y.ch*Ft.length));T(this,oe,new Uint8Array(y.drm*y.dpn*y.dnc));T(this,xe,new Uint8Array(y.drm*2));T(this,pe,new Uint8Array(y.efx*3));T(this,Ye,new Uint8Array(y.ch));T(this,ze,new Uint8Array(y.ch*y.redir));T(this,W,new Uint8Array(y.port));T(this,ht,new Uint8Array(y.port));T(this,We,new Uint8Array(y.ch));T(this,ye,new Uint8Array(y.ch));T(this,qe,new Uint8Array(y.ch*y.cvn));T(this,dt,new Uint8Array(y.ch));T(this,He,new Uint8Array(128));T(this,Te,new Uint8Array(y.cmt*8));T(this,ft,new Uint8Array(1024));T(this,_e,new Uint8Array(y.cmt*64));T(this,J,{});A(this,"clockSource",new Wa);A(this,"modelEx",{xg:{map:0,varSys:!1,insPart:new Uint8Array(5)},yPlg:[],vl:{module:0,breath:1,voiceCh:y.invalidCh},sc:{showBar:!0,invBar:!1,invDisp:!1,peakHold:1},cs1x:{perfCh:0},kross:{chToggle:!1},sg:{convLastSyll:0,runLineLen:0,maxLineLen:32,splitMask:!1}});T(this,U,void 0);T(this,Oe,void 0);T(this,St,void 0);T(this,Y,100);T(this,Qe,0);T(this,ut,500);T(this,Vt,0);T(this,Yt,0);T(this,zt,32);T(this,Wt,!1);T(this,Ge,"");T(this,Be,0);T(this,xt,0);T(this,pt,0);T(this,ge,!0);T(this,K,0);T(this,Tt,void 0);T(this,q,!1);T(this,bt,0);T(this,Je,new Array(y.ch));T(this,be,[]);T(this,De,new Uint8Array(y.ch));T(this,Xe,new Uint8Array(y.tr));A(this,"baseBank",new Ht("gm2","ns5r","xg","gs","sd","gmega","plg-vl","plg-pf","plg-dx","plg-an","plg-dr","plg-sg","kross","s90es","cs2x","pa"));A(this,"userBank",new Ht("gm2"));A(this,"initOnReset",!1);A(this,"aiEfxName","");A(this,"polyIndexShrink",!0);A(this,"polyIndexLatest",0);A(this,"polyIndexLast",0);A(this,"lcdHideBankInfo",!1);T(this,ce,[]);T(this,Ze,void 0);T(this,j,{nOff:(e,r)=>{let d=e*128+r,u=a(this,Q).lastIndexOf(d);if(u>-1)if(this.getChCc(e,64)>>6)a(this,X)[u]=this.NOTE_HELD,this.dispatchEvent("note",{part:e,note:r,velo:a(this,Z)[d],state:this.NOTE_HELD});else if(this.getChCc(e,66)>>6&&a(this,X)[u]===this.NOTE_SOSTENUTO_SUSTAIN)a(this,X)[u]=this.NOTE_SOSTENUTO_HELD,this.dispatchEvent("note",{part:e,note:r,velo:a(this,Z)[d],state:this.NOTE_SOSTENUTO_HELD});else{a(this,Q)[u]=0,a(this,Z)[d]=0,a(this,X)[u]=this.NOTE_IDLE;let b=this.getExt(e)[1];(b===this.VLBC_VELOINIT||b===this.VLBC_VELOALL)&&this.setChCc(e,129,0),this.dispatchEvent("note",{part:e,note:r,velo:0,state:this.NOTE_IDLE})}if(a(this,ie)[e]){for(let b=this.polyIndexLast;b>=0;b--)if(a(this,Q)[b]>>7===e&&a(this,X)[b]!==0){a(this,X)[b]===this.NOTE_MUTED_RECOVERABLE&&(a(this,X)[b]=this.NOTE_SUSTAIN);break}}if(this.polyIndexShrink&&this.polyIndexLast>0){let C=!1,S=this.polyIndexLast-8,w=this.polyIndexLast;for(;w>S&&a(this,X)[w]===0;w--)C=!0;C&&(this.polyIndexLast=w,a(this,X)[w+1]!==0&&console.error("Polyphonic slot shrinking edge case."))}},nOn:(e,r,d)=>{let u=e*128+r,b=0;if(a(this,ie)[e])for(let C=0;C<=this.polyIndexLast;C++)a(this,Q)[C]>>7===e&&a(this,X)[C]!==0&&(a(this,X)[C]=this.NOTE_MUTED_RECOVERABLE);for(;a(this,X)[b]>0&&a(this,Q)[b]!==u;)b++;if(b<y.pl){a(this,Q)[b]=u,a(this,Z)[u]=d,a(this,X)[b]=this.NOTE_SUSTAIN,a(this,Ae)[e]<d&&(a(this,Ae)[e]=d);let C=this.getExt(e)[1];(C===this.VLBC_VELOINIT||C===this.VLBC_VELOALL)&&this.setChCc(e,129,d),this.dispatchEvent("note",{part:e,note:r,velo:d,state:this.NOTE_SUSTAIN}),this.polyIndexLatest=b+1,b>this.polyIndexLast&&(this.polyIndexLast=b)}else console.error("Polyphony exceeded.")},nAt:(e,r,d)=>{},cAt:(e,r)=>{},hoOf:e=>{a(this,X).forEach((r,d)=>{if(r===this.NOTE_HELD){let u=a(this,Q)[d],b=u>>7;e===b&&(a(this,X)[d]=this.NOTE_IDLE,a(this,Q)[d]=0,a(this,Z)[u]=0,this.dispatchEvent("note",{part:e,note:u&127,velo:0,state:this.NOTE_IDLE}))}})},soOn:e=>{a(this,X).forEach((r,d)=>{let u;switch(r){case this.NOTE_ATTACK:{u=this.NOTE_SOSTENUTO_ATTACK;break}case this.NOTE_DECAY:{u=this.NOTE_SOSTENUTO_DECAY;break}case this.NOTE_SUSTAIN:{u=this.NOTE_SOSTENUTO_SUSTAIN;break}}if(u){a(this,X)[d]=u;let b=a(this,Q)[d];this.dispatchEvent("note",{part:e,note:b&127,velo:a(this,Z)[b],state:u})}})},soOf:e=>{a(this,X).forEach((r,d)=>{if(r===this.NOTE_SOSTENUTO_HELD){let u=a(this,Q)[d],b=u>>7;e===b&&(a(this,X)[d]=this.NOTE_IDLE,a(this,Q)[d]=0,a(this,Z)[u]=0,this.dispatchEvent("note",{part:e,note:u&127,velo:0,state:this.NOTE_IDLE}))}})},ano:e=>{a(this,Q).forEach(r=>{let d=r>>7,u=r&127;r===0&&a(this,Z)[0]===0||d===e&&a(this,j).nOff(d,u)})}});T(this,Mt,{8:function(e){let r=e.channel,d=e.data[0];a(this,j).nOff(r,d)},9:function(e){let r=e.channel,d=this;if(d.getChModeId(r)===$.xg&&a(d,D)[r]>1){let C=d.getChDrumFirstWrite(r);C[0]&&C[1]!==y.invalidCh&&!a(d,ue)[r]&&(d.copyChSetup(C[1],r),d.pushChPrimitives(r),console.debug(`Part CH${r+1} copied from CH${C[1]+1}.`))}d.setChActive(r,1);let u=e.data[0],b=e.data[1];b>0?a(d,j).nOn(r,u,b):a(d,j).nOff(r,u)},10:function(e){let r=e.channel,d=r*128+e.data[0];a(this,Q).indexOf(d)>-1&&(a(this,Z)[d]=data[1],this.getExt(r)[1]===this.VLBC_VELOALL&&this.setChCc(r,129,data[1]),this.dispatchEvent("note",{part:r,note:e.data[0],velo:e.data[1],state:this.NOTE_SUSTAIN}))},11:function(e){let r=e.channel,d=this,u=a(d,Je)[r],b=u[e.data[0]];b&&(e.data[0]=b),[0,32].indexOf(e.data[0])>-1&&(()=>{switch(a(this,_)){case $.s90es:case $.motif:{if(e.data[0]===0){[0,63].indexOf(e.data[1])>-1&&d.setChActive(r,1);break}e.data[1]&&d.setChActive(r,1);break}default:break}})();let C=r*y.ext,S=d.getChModeId(r);switch(e.data[0]){case 96:return;case 97:return;case 120:return;case 121:{a(this,j).ano(r),a(this,Ne)[r]=0,d.resetChCc(r,1,0),d.resetChCc(r,5,0),d.resetChCc(r,64,0),d.resetChCc(r,65,0),d.resetChCc(r,66,0),d.resetChCc(r,67,0),d.resetChCc(r,11,127),d.resetChCc(r,101,127),d.resetChCc(r,100,127),d.resetChCc(r,99,127),d.resetChCc(r,98,127);return}case 123:{a(this,j).ano(r);return}case 124:{a(this,j).ano(r);return}case 125:{a(this,j).ano(r);return}case 126:{a(this,ie)[r]=1,a(this,j).ano(r);return}case 127:{a(this,ie)[r]=0,a(this,j).ano(r);return}}if(v[e.data[0]]===void 0)console.warn(`cc${e.data[0]} is not accepted.`);else{switch(Ba.indexOf(e.data[0])>-1&&this.allocateAce(r,e.data[0]),e.data[0]){case 0:{switch(L()&&console.debug(`${z[a(d,_)]}, CH${r+1}: ${e.data[1]}`),a(this,_)===0?e.data[1]<48?(a(d,D)[r]>0&&(e.data[1]=d.getChPrimitive(r,1,!1),e.data[1]=kt.gs[2],console.debug(`Forced channel ${r+1} to stay drums.`)),e.data[1]>0&&(console.debug(`Roland GS detected with MSB: ${e.data[1]}`),d.switchMode("gs",0))):e.data[1]===56||e.data[1]===62?d.switchMode(a(d,U).x5===82?"x5d":"05rw",0):e.data[1]===63?d.switchMode(z[a(d,U).ds],0):e.data[1]===64||e.data[1]===127?d.switchMode("xg",0):(e.data[1]===120||e.data[1]===121)&&d.switchMode("g2",0):a(d,_)===$.gs||a(d,_)===$.sc?e.data[1]<56&&a(this,D)[r]>0&&(e.data[1]=this.getChPrimitive(r,1,!1),e.data[1]=kt.gs[2],console.debug(`Forced channel ${r+1} to stay drums.`)):a(this,_)===$.gm&&(e.data[1]<48?a(this,D)[r]>0&&(e.data[1]=kt.gs[2],this.switchMode("gs",1),console.debug(`Forced channel ${r+1} to stay drums.`)):(e.data[1]===64||e.data[1]===127)&&this.switchMode("xg",1)),a(this,_)){case $.xg:{[79,95,120,126,127].indexOf(e.data[1])>-1?a(this,D)[r]===0&&(this.setChType(r,this.CH_DRUM2),console.debug(`CH${r+1} set to drums by MSB.`)):a(this,D)[r]>0&&(this.setChType(r,this.CH_MELODIC),console.debug(`CH${r+1} set to melodic by MSB.`)),[33,81,97].indexOf(e.data[1])>-1?a(this,ne)[C]=this.EXT_VL:[35,67,83,99].indexOf(e.data[1])>-1?a(this,ne)[C]=this.EXT_DX:a(this,ne)[C]=this.EXT_NONE;break}case $["05rw"]:case $.x5d:case $.ns5r:{[61,62,126,127].indexOf(e.data[1])>-1?a(this,D)[r]===this.CH_MELODIC&&(this.setChType(r,this.CH_DRUM2),console.debug(`CH${r+1} set to drums by MSB.`)):a(this,D)[r]!==this.CH_MELODIC&&(this.setChType(r,this.CH_MELODIC),console.debug(`CH${r+1} set to melodic by MSB.`));break}case $.sd:{[104,105,106,107,120].indexOf(e.data[1])>-1?a(this,D)[r]===0&&(this.setChType(r,this.CH_DRUM2),console.debug(`CH${r+1} set to drums by MSB.`)):a(this,D)[r]>0&&(this.setChType(r,this.CH_MELODIC),console.debug(`CH${r+1} set to melodic by MSB.`));break}case $.g2:{e.data[1]===120?a(this,D)[r]===0&&(this.setChType(r,this.CH_DRUMS),console.debug(`CH${r+1} set to drums by MSB.`)):a(this,D)[r]>0&&(this.setChType(r,this.CH_MELODIC),console.debug(`CH${r+1} set to melodic by MSB.`));break}}break}case 2:{this.getExt(r)[1]===this.VLBC_BRTHEXPR&&this.setChCc(r,129,e.data[1]);break}case 6:{if(a(this,Ve)[r]){[$.xg,$.gs,$.sc,$.ns5r].indexOf(a(this,_))<0&&console.warn(`NRPN commits are not available under "${z[a(this,_)]}" mode, even when they are supported in Octavia.`);let w=this.getChCc(r,99),M=this.getChCc(r,98);if(w===1){let R=Xa.indexOf(M);if(R>-1)this.setChCc(r,71+R,e.data[1]),L()&&console.debug(`Redirected NRPN 1 ${M} to cc${71+R}.`),this.dispatchEvent("cc",{part:r,cc:71+R,data:e.data[1]});else{let t=Ft.indexOf(M);t>-1?a(this,lt)[r*10+t]=e.data[1]-64:console.warn(`NRPN 0x01${M.toString(16).padStart(2,"0")} is not supported.`),L()&&console.debug(`CH${r+1} voice NRPN ${M} commit`)}}else{if(Ut.indexOf(w)<0){let t=`NRPN 0x${w.toString(16).padStart(2,"0")}${M.toString(16).padStart(2,"0")} `;console.warn(w===127?`${t}is not necessary. Consider removing it.`:`${t}is not supported.`)}else{let t=a(this,D)[r]-2;t<0?console.warn(`CH${r+1} cannot accept drum NRPN as type ${Ct[a(this,D)[r]]}.`):a(this,oe)[(t*y.dpn+ke[w])*y.dnc+M]=e.data[1]}L()&&console.debug(`CH${r+1} (${Ct[a(this,D)[r]]}) drum NRPN ${w} commit`)}}else{let w=Dt[this.getChCc(r,100)],M=ya[this.getChCc(r,100)];if(this.getChCc(r,101)===0&&w!==void 0)switch(L()&&console.debug(`CH${r+1} RPN 0 ${this.getChCc(r,100)} commit: ${e.data[1]}`),e.data[1]=Math.min(Math.max(e.data[1],ga[w][0]),ga[w][1]),a(this,I)[r*y.rpn+w]=e.data[1],a(this,H)[r*y.rpnt+M]=1,S){case $.xg:case $.gs:case $.sc:case $.mt32:case $.s90es:case $.motif:case $.cs1x:case $.cs6x:{switch(this.getChCc(r,100)){case 1:case 2:{this.dispatchEvent("pitch",{part:r,pitch:this.getPitchShift(r)});break}}break}default:this.dispatchEvent("pitch",{part:r,pitch:this.getPitchShift(r)})}}break}case 32:{switch(L()&&console.debug(`${z[a(this,_)]}, CH${r+1} LSB: ${e.data[1]}`),a(this,_)){case $.s90es:case $.motif:{this.setChType(r,[32,40].indexOf(e.data[1])>-1?this.CH_DRUMS:this.CH_MELODIC,a(this,_),!0);break}}this.getExt(r)[0],this.EXT_DX;break}case 38:{if(!a(this,Ve)[r]){let w=Dt[this.getChCc(r,100)],M=ya[this.getChCc(r,100)];this.getChCc(r,101)===0&&w!==void 0&&(a(this,I)[r*y.rpn+w+1]=e.data[1],a(this,H)[r*y.rpnt+M]=1)}break}case 64:{e.data[1]<64&&a(this,j).hoOf(r);break}case 66:{e.data[1]>>6?a(this,j).soOn(r):a(this,j).soOf(r);break}case 98:case 99:{a(this,Ve)[r]=1;break}case 100:case 101:{a(this,Ve)[r]=0;break}}this.setChCc(r,e.data[0],e.data[1]),this.dispatchEvent("cc",{part:r,cc:e.data[0],data:e.data[1]})}d.getChModeId(r)===$.xg&&a(d,D)[r]&&d.setDrumFirstWrite(r)},12:function(e){let r=e.channel,d=this;switch(a(d,_)){case $.s90es:case $.motif:{e.data&&d.setChActive(r,1);break}default:d.setChActive(r,1)}let u=G[r];switch(d.getExt(r)[0]){case d.EXT_VL:break}a(d,N)[r]=e.data,a(d,ye)[r]=0,d.pushChPrimitives(r),L()&&console.debug(`T:${e.track} C:${r} P:${e.data}`),d.getChModeId(r)===$.xg&&a(d,D)[r]&&d.setDrumFirstWrite(r)},13:function(e){let r=this,d=e.channel;a(this,Q).forEach(function(u){let b=u>>7;d===b&&(a(r,Z)[u]=e.data,r.dispatchEvent("note",{part:d,note:u&127,velo:e.data,state:r.NOTE_SUSTAIN}))})},14:function(e){let r=e.channel;a(this,Ne)[r]=e.data[1]*128+e.data[0]-8192,this.dispatchEvent("pitch",{part:r,pitch:this.getPitchShift(r)})},15:function(e){Fa(e.data).forEach(r=>{let d=r[0],u=r[1];x(this,bt,r.length),(a(this,It)[d]||function(){console.debug(`Unknown manufacturer ${d}.`)})(u,r.subarray(2),e.track)})},248:function(e){},250:function(e){},251:function(e){},252:function(e){},254:function(e){},255:function(e){(a(this,ce)[e.meta]||function(d,u,b){}).call(this,e.data,e.track,e.meta),e.meta!==32&&x(this,Qe,0);let r=Ga.indexOf(e.meta)>-1;if(L()&&console.debug(e),r)return e.reply="meta",e}});T(this,It,{64:(e,r,d)=>{a(this,tt).run(r,d,e)},65:(e,r,d)=>{if(r[0]<16)if(r[1]===72){let u=r[r.length-1],b=Ke(r.subarray(3,r.length-1));u===b?a(this,Ee).run(r.subarray(0,r.length-1),d,e):console.warn(`Bad SD checksum ${u} - should be ${b}.`)}else a(this,Ee).run(r,d,e);else{let u=r[r.length-1],b=Ke(r.subarray(2,r.length-1));u===b?a(this,Ee).run(r.subarray(0,r.length-1),d,e):console.warn(`Bad GS checksum ${u} - should be ${b}.`)}},66:(e,r,d)=>{a(this,Me).run(r,d,e)},67:(e,r,d)=>{switch(e>>4){case 0:{let u=0;for(;r[u]===127&&u<4;)u++;let b=r[1+u]<<7|r[2+u];if(b+7+u!==r.length){console.warn(`Yamaha bulk dump length mismatch! Expected ${r.length-7-u}, received ${b}.`),console.debug(r);break}let C=Ke(r.subarray(1+u,r.length-1)),S=r[r.length-1];if(r[r.length-1]>>7)console.warn(`Yamaha bulk dump checksum invalid! Expected ${C}, received ${S}:
`),console.debug(r);else if(C!==S)console.warn(`Yamaha bulk dump checksum mismatch! Expected ${C}, received ${S}:
`),console.debug(r);else{let w=r.slice(2,r.length-1);for(let M=0;M<=u;M++)w[M]=r[M];a(this,te).run(w,d,e&15)}break}case 1:{a(this,te).run(r,d,e&15);break}case 2:{console.warn("Octavia doesn't yet support Yamaha bulk dump requests.");break}case 3:{console.warn("Octavia doesn't yet support Yamaha parameter requests.");break}case 7:{switch(e&15){case 14:{let u=new Uint8Array(r.length+1);u[0]=126,u.set(r,1),a(this,te).run(u,d,0);break}default:console.warn(`Unknown Yamaha special SysEx type: ${e}.`)}break}default:console.warn(`Unknown Yamaha SysEx type: ${e>>4}.`)}},68:(e,r,d)=>{a(this,rt).run(r,d,e)},71:(e,r,d)=>{a(this,at).run(r,d,e)},126:(e,r,d)=>{a(this,je).run(r,d,e)},127:(e,r,d)=>{this.switchMode("gm",0),a(this,et).run(r,d,e)}});T(this,je,void 0);T(this,et,void 0);T(this,te,void 0);T(this,Ee,void 0);T(this,Me,void 0);T(this,tt,void 0);T(this,at,void 0);T(this,rt,void 0);let e=this;for(let t=0;t<10;t++)a(e,Se)[t]=new Uint8Array(256);a(e,Se)[10]=new Uint8Array(512),x(e,Ze,new Ce),x(e,U,{x5:82,ds:$.krs,smotif:$.s90es,gs:4,sc:3,gm:$.gm,g2:$.g2}),x(e,Oe,{dumpLimit:e.DUMP_MODE}),x(e,St,new Proxy(a(e,Oe),{set:()=>{}}));for(let t in kt){let o=$[t];o===void 0?console.debug(`SubDB build error: "${t}" does not exist`):a(e,J)[o]=new Uint8Array(kt[t])}for(let t of we)e.modelEx.yPlg.push(new Uint8Array(t[1]));e.userBank.strictMode=!0,e.userBank.load(`MSB	PRG	LSB	NME
062	000	000	
122	000	000	
122	001	000	
122	002	000	
122	003	000	
122	004	000	
122	005	000	
122	006	000	`),e.addEventListener("metacommit",function(t){var l,s;let{data:o}=t;((l=a(e,be)[0])==null?void 0:l.type)===o.type&&((s=a(e,be)[0])!=null&&s.amend)?(a(e,be)[0].amend=o.amend,a(e,be)[0].data+=o.data):a(e,be).unshift(o)}),a(e,ce)[1]=function(t){var o,l,s,n;switch(t=t.replaceAll(`\r
`,`
`).replaceAll("\r",`
`),t.substring(0,2)){case"@I":{x(e,K,e.KARAOKE_TEXT),e.dispatchEvent("metacommit",{type:"Kar.Info",data:(o=t.substring(2))==null?void 0:o.trimStart()});break}case"@K":{x(e,K,e.KARAOKE_TEXT);let i=t.substring(2);i!=="MIDI KARAOKE FILE"&&e.dispatchEvent("metacommit",{type:"Kar.Mode",data:i==null?void 0:i.trimStart()}),console.debug(`Karaoke mode active: ${i}`);break}case"@L":{x(e,K,e.KARAOKE_TEXT),e.dispatchEvent("metacommit",{type:"Kar.Lang",data:(l=t.substring(2))==null?void 0:l.trimStart()});break}case"@T":{x(e,K,e.KARAOKE_TEXT),e.dispatchEvent("metacommit",{type:"KarTitle",data:(s=t.substring(2))==null?void 0:s.trimStart()});break}case"@V":{x(e,K,e.KARAOKE_TEXT),e.dispatchEvent("metacommit",{type:"Kar.Ver.",data:(n=t.substring(2))==null?void 0:n.trimStart()});break}case"Mi":{if(t.substring(2,16)==="dStamp-1.00: 0"){let i=t.length;for(let f=t.length;f>0;f--)if((t.charCodeAt(f-1)>>5)+1>>1===1){i=f;break}let c=t.substring(16,i);e.dispatchEvent("metacommit",{type:"MidStamp",data:pa(c)})}else t.split(`
`).forEach((i,c)=>{e.dispatchEvent("metacommit",{type:"Cmn.Text",data:i,mask:c!==0})});break}case"XF":{let i=t.slice(2).split(":");switch(i[0]){case"hd":{i.slice(1).forEach((c,f)=>{c.length&&e.dispatchEvent("metacommit",{type:["XfSngDte","XfSngRgn","XfSngCat","XfSongBt","XfSngIns","XfSngVoc","XfSngCmp","XfSngLrc","XfSngArr","XfSngPer","XfSngPrg","XfSngTag"][f],data:c})});break}case"ln":{i.slice(1).forEach((c,f)=>{c.length&&e.dispatchEvent("metacommit",{type:["XfKarLng","XfKarNme","XfKarCmp","XfKarLrc","XfKarArr","XfKarPer","XfKarPrg"][f],data:c})});break}default:e.dispatchEvent("metacommit",{type:"XfUnData",data:t})}break}default:switch(a(e,K)){case e.KARAOKE_TEXT:{switch(t[0]){case"\\":{e.dispatchEvent("metacommit",{type:"KarLyric",data:"",amend:!1}),e.dispatchEvent("metacommit",{type:"KarLyric",data:t.substring(1),amend:!0});break}case"/":{e.dispatchEvent("metacommit",{type:"KarLyric",data:"",mask:!0,amend:!1}),e.dispatchEvent("metacommit",{type:"KarLyric",data:t.substring(1),mask:!0,amend:!0});break}default:e.dispatchEvent("metacommit",{type:"KarLyric",data:t,amend:!0})}break}default:t.split(`
`).forEach((i,c)=>{e.dispatchEvent("metacommit",{type:"Cmn.Text",data:i,mask:c!==0})})}}},a(e,ce)[2]=function(t){e.dispatchEvent("metacommit",{type:"Copyrite",data:t})},a(e,ce)[3]=function(t,o){o<1&&a(e,Qe)<1&&e.dispatchEvent("metacommit",{type:"TrkTitle",data:t})},a(e,ce)[4]=function(t,o){e.dispatchEvent("metacommit",{type:"Instrmnt",data:t})},a(e,ce)[5]=function(t){switch(a(e,K)){case e.KARAOKE_XF:{let o="";for(let l of t)switch(l){case"^":case"%":{o+=" ";break}case">":{o+="	";break}case"<":{e.dispatchEvent("metacommit",{type:"KarLyric",data:o,mask:a(e,q),amend:!1}),o="",x(e,q,!1);break}case"/":{e.dispatchEvent("metacommit",{type:"KarLyric",data:o,mask:!1,amend:!1}),o="",x(e,q,!0);break}default:o+=l}o.length>0&&(e.dispatchEvent("metacommit",{type:"KarLyric",data:o,mask:a(e,q),amend:!0}),x(e,q,!1));break}default:{let o=0,l=!0,s=t.length-1;for(;l&&o<8;)switch(t.charCodeAt(o)){case 32:{o++;break}default:l=!1}switch(o>0&&(e.dispatchEvent("metacommit",{type:"C.Lyrics",data:t.substring(0,o),amend:!0,mask:a(e,q),untimed:!0}),x(e,q,!1)),t.charCodeAt(s)){case 10:{e.dispatchEvent("metacommit",{type:"C.Lyrics",data:t.substring(o,s),amend:!1,mask:a(e,q)}),x(e,q,!1);break}case 11:case 13:{e.dispatchEvent("metacommit",{type:"C.Lyrics",data:t.substring(o,s),amend:!1,mask:a(e,q)}),x(e,q,!0);break}case 32:{e.dispatchEvent("metacommit",{type:"C.Lyrics",data:t.substring(o,s),amend:!0,mask:a(e,q)}),e.dispatchEvent("metacommit",{type:"C.Lyrics",data:" ",amend:!0,mask:!1,untimed:!0}),x(e,q,!1);break}default:t.trim()===""?console.info("Blank line? Shouldn't happen."):e.dispatchEvent("metacommit",{type:"C.Lyrics",data:t,amend:!0,mask:a(e,q)}),x(e,q,!1)}break}}},a(e,ce)[6]=function(t){e.dispatchEvent("metacommit",{type:"C.Marker",data:t})},a(e,ce)[7]=function(t){switch(t[0]){case"$":{if(t.substring(1,5)==="Lyrc"){x(e,K,e.KARAOKE_XF);let o=t.substring(6).split(":"),l=o[0].replaceAll(" ","").split(",");l.forEach((n,i,c)=>{c[i]=parseInt(n)-1});let s=oa[o[2].substring(0,2).toLowerCase()];e.dispatchEvent("metacommit",{type:"XfMeloCh",data:`CH${o[0].replaceAll(" ","").split(",").join(", CH")}`,parsed:l}),e.dispatchEvent("metacommit",{type:"XfLyrOff",data:o[1],parsed:parseInt(o[1])}),e.dispatchEvent("metacommit",{type:"XfLyrEnc",data:s[1],parsed:s[0]}),x(e,q,!1)}else e.dispatchEvent("metacommit",{type:"CuePoint",data:t});break}case"#":{e.dispatchEvent("metacommit",{type:"XfScneNo",data:t.substring(1)});break}case"&":{t.length===2?(e.dispatchEvent("metacommit",{type:"XfSngPrt",data:la[t[1]]||`Unknown "${t[1]}"`}),x(e,q,!1)):e.dispatchEvent("metacommit",{type:"CuePoint",data:t});break}default:e.dispatchEvent("metacommit",{type:"CuePoint",data:t})}},a(e,ce)[32]=function(t){x(e,Qe,t[0]+1)},a(e,ce)[33]=function(t,o){L()&&console.debug(`Track ${o} requests assigning to port ${t}.`),a(e,Xe)[o]=t+1},a(e,ce)[81]=function(t,o){x(e,ut,t/1e3)},a(e,ce)[127]=function(t,o){a(e,Ze).run(t,o)},a(e,Ze).default=function(t){let o=[];for(let l=0;l<8&&l<t.length;l++)o.push(t[l].toString(16).padStart(2,"0").toUpperCase());console.warn(`Unrecognized implementation-specific byte sequence: ${o.join(" ")}${t.length>8?" ...":""}
%o`,t)},a(e,Ze).add([67,0,1],(t,o)=>{L()&&console.debug(`XGworks requests assigning track ${o} to port ${t[0]}.`),a(e,Xe)[o]=t[0]+1}).add([67,123,1],(t,o)=>{let l=[];for(let s=0;s<t.length;s+=2){let n=t[s]>>4,i=t[s]&15;if(n<7&&i&&i<8){let c=new Uint8Array(5);c[0]=i-1,c[1]=n-3<<2,c[2]=t[s|1],l.push(c)}}e.dispatchEvent("metacommit",{type:"ChordCtl",src:"yxf",data:l}),console.debug("Yamaha XF chord data: %o",l)}).add([67,123,2],(t,o)=>{var s;let l=new Uint8Array(2);l[0]=t[0]&15,l[1]=t[0]>>4,e.dispatchEvent("metacommit",{type:"RhrslMrk",src:"yxf",data:l}),console.debug(`Yamaha XF rehearsal mark: ${(s=["Intro","Ending","Fill-in"][l[0]])!=null?s:String.fromCharCode(62+l[0])}${"'".repeat(l[1])} %o`,l)}).add([67,123,96],(t,o)=>{let l=[0,0];t.subarray(1,3).forEach(s=>{l[0]=l[0]<<7,l[0]|=s&127}),t.subarray(3,5).forEach(s=>{l[1]=l[1]<<7,l[1]|=s&127}),e.dispatchEvent("metacommit",{type:"YStyleId",data:l}),console.debug(`Yamaha style ID: model ${l[0].toString(16)}, style ${l[1]+1}`)}),x(e,je,new Ce("universal non-realtime")),x(e,et,new Ce("universal realtime")),x(e,te,new Ce("Yamaha")),x(e,Ee,new Ce("Roland")),x(e,Me,new Ce("Korg")),x(e,tt,new Ce("Kawai")),x(e,at,new Ce("Akai")),x(e,rt,new Ce("Casio"));let r=new Ce("DX7+ Dump"),d=function(t){let o=[];for(let l=0;l<8&&l<t.length;l++)o.push(t[l].toString(16).padStart(2,"0").toUpperCase());console.info(`Unrecognized SysEx in "${this.name}" set: ${o.join(" ")}${t.length>8?" ...":""}
%o`,t)};a(e,je).default=d,a(e,et).default=d,a(e,te).default=d,a(e,Ee).default=d,a(e,Me).default=d,a(e,tt).default=d,a(e,at).default=d,a(e,rt).default=d,r.default=d,a(e,je).add([9],(t,o,l)=>{e.switchMode(["gm","?","g2"][t[0]-1],2),e.setPortMode(e.getTrackPort(o),1,[$.gm,$["?"],a(e,U).g2][t[0]-1]),x(e,K,a(e,K)||e.KARAOKE_NONE),console.info(`MIDI reset: ${["GM","Init","GM2"][t[0]-1]}`),t[0]===2&&e.init()}),a(e,et).add([4,1],(t,o,l)=>{e.invokeSysExIndicator(),x(e,Y,((t[1]<<7)+t[0])/16383*100),e.dispatchEvent("mastervolume",a(e,Y))}).add([4,3],(t,o,l)=>((t[1]<<7)+t[0]-8192)/8192).add([4,4],(t,o,l)=>t[1]-64).add([4,5],(t,o,l)=>{e.invokeSysExIndicator();let s=t[0],n=t[1],i=t[2],c=3,f=c+(s<<1),h=f+n;if(s!==1){console.error(`Unsupported GM2 global parameter set: slotpath length too long (${s})!
`,t);return}let E=0,m=0,O=0;switch(t.subarray(c,f).forEach(P=>{E=E<<7,E|=P}),L()&&console.debug(`GM2 global parameter: (${t.subarray(3,f)}; p: ${m}, v: ${O})`),E){case 129:{m===0&&(e.setEffectType(0,52,O),e.pushEffectType(0));break}case 130:{m===0&&(e.setEffectType(1,52,O|16),e.pushEffectType(1));break}default:L()&&console.debug("GM2 global paramater slot path unknown.")}}),a(this,te).add([76,0,0],(t,o,l)=>{switch(t[0]){case 125:{e.initDrums(),console.info(`XG drum setup reset on drum kit ${t[1]}.`);break}case 126:{e.switchMode("xg",2),e.setPortMode(e.getTrackPort(o),4,$.xg),e.modelEx.vl.module=0,x(e,K,a(e,K)||e.KARAOKE_NONE),console.info("MIDI reset: XG");break}default:{e.invokeSysExIndicator();let s=[0,0,0,0],n=(i,c)=>{s[c]=i};if(t.subarray(1).forEach((i,c)=>{let f=c+t[0];([n,n,n,n,h=>{x(this,Y,h*129/16383*100),e.dispatchEvent("mastervolume",a(e,Y))},h=>{},h=>{}][f]||(()=>{}))(i,c)}),t[0]<4){let i=0;s.forEach(c=>{i=i<<4,i+=c}),i-=1024,console.debug(`Master tune: ${i}`)}}}}).add([76,2,1],(t,o,l)=>{e.invokeSysExIndicator();let s="XG ";t[0]<32?(s+="reverb ",t.subarray(1).forEach((n,i)=>{([c=>{e.setEffectTypeRaw(0,!1,c),console.info(`${s}main type: ${Et[c]}`),e.pushEffectType(0)},c=>{e.setEffectTypeRaw(0,!0,c),console.debug(`${s}sub type: ${c+1}`),e.pushEffectType(0)},c=>{console.debug(`${s}time: ${ra(c)}s`)},c=>{console.debug(`${s}diffusion: ${c}`)},c=>{console.debug(`${s}initial delay: ${c}`)},c=>{console.debug(`${s}HPF cutoff: ${it[c]}Hz`)},c=>{console.debug(`${s}LPF cutoff: ${it[c]}Hz`)},c=>{console.debug(`${s}width: ${c}`)},c=>{console.debug(`${s}height: ${c}`)},c=>{console.debug(`${s}depth: ${c}`)},c=>{console.debug(`${s}wall type: ${c}`)},c=>{console.debug(`${s}dry/wet: ${c}`)},c=>{console.debug(`${s}send: ${fe(c)}dB`)},c=>{console.debug(`${s}pan: ${c-64}`)},!1,!1,c=>{console.debug(`${s}delay: ${c}`)},c=>{console.debug(`${s}density: ${c}`)},c=>{console.debug(`${s}balance: ${c}`)},c=>{},c=>{console.debug(`${s}feedback: ${c}`)},c=>{}][t[0]+i]||function(){console.warn(`Unknown XG reverb address: ${t[0]}.`)})(n)})):t[0]<64?(s+="chorus ",t.subarray(1).forEach((n,i)=>{([c=>{e.setEffectTypeRaw(1,!1,c),console.info(`${s}main type: ${Et[c]}`),e.pushEffectType(1)},c=>{e.setEffectTypeRaw(1,!0,c),console.debug(`${s}sub type: ${c+1}`),e.pushEffectType(1)},c=>{console.debug(`${s}LFO: ${aa[c]}Hz`)},c=>{},c=>{console.debug(`${s}feedback: ${c}`)},c=>{console.debug(`${s}delay offset: ${sa(c)}ms`)},c=>{},c=>{console.debug(`${s}low: ${it[c]}Hz`)},c=>{console.debug(`${s}low: ${c-64}dB`)},c=>{console.debug(`${s}high: ${it[c]}Hz`)},c=>{console.debug(`${s}high: ${c-64}dB`)},c=>{console.debug(`${s}dry/wet: ${c}`)},c=>{console.debug(`${s}send: ${fe(c)}dB`)},c=>{console.debug(`${s}pan: ${c-64}`)},c=>{console.debug(`${s}to reverb: ${fe(c)}dB`)},!1,c=>{},c=>{},c=>{},c=>{console.debug(`${s}LFO phase diff: ${(c-64)*3}deg`)},c=>{console.debug(`${s}input mode: ${c?"stereo":"mono"}`)},c=>{}][t[0]-32+i]||function(){console.warn(`Unknown XG chorus address: ${t[0]}.`)})(n)})):t[0]<86?(s+="variation ",t.subarray(1).forEach((n,i)=>{([c=>{e.setEffectTypeRaw(2,!1,c),console.info(`${s}main type: ${Et[c]}`),e.pushEffectType(2)},c=>{e.setEffectTypeRaw(2,!0,c),console.debug(`${s}sub type: ${c+1}`),e.pushEffectType(2)}][t[0]-64+i]||function(){})(n)})):t[0]<97?(s+="variation ",t.subarray(1).forEach((n,i)=>{[c=>{console.debug(`${s}send: ${fe(c)}dB`)},c=>{console.debug(`${s}pan: ${c-64}`)},c=>{console.debug(`${s}to reverb: ${fe(c)}dB`)},c=>{console.debug(`${s}to chorus: ${fe(c)}dB`)},c=>{e.modelEx.xg.varSys=!!c,console.debug(`${s}connection: ${c?"system":"insertion"}`)},c=>{if(e.modelEx.xg.varSys){console.warn(`${s}effect is applied system-wide. Setting its effective channel to CH${c+1} will not have any effect.`);return}if(c<64){let f=e.chRedir(c,o,!0);e.setXgChEffectSink(f,2),console.debug(`${s}channel: CH${c+1} (CH${f+1})`)}else e.setXgChEffectSink(y.invalidCh,2),console.info(`${s}channel: CH${c+1} (unsupported)`)},c=>{console.debug(`${s}mod wheel: ${c-64}`)},c=>{console.debug(`${s}bend wheel: ${c-64}`)},c=>{console.debug(`${s}channel after touch: ${c-64}`)},c=>{console.debug(`${s}AC1: ${c-64}`)},c=>{console.debug(`${s}AC2: ${c-64}`)}][t[0]-86+i](n)})):t[0]>111&&t[0]<118?s+="variation ":console.warn(`Unknown XG variation address: ${t[0]}`)}).add([76,2,64],(t,o,l)=>{t.subarray(1).forEach((s,n)=>{let i=n+t[0];if(i===0)console.debug(`XG EQ preset: ${["flat","jazz","pop","rock","classic"][s]}`);else{let c=i-1>>2,f=i-1&3,h=`XG EQ ${c} ${["gain","freq","Q","shape"][f]}: `;[()=>{console.debug(`${h}${s-64}dB`)},()=>{console.debug(`${h}${s} (raw)`)},()=>{console.debug(`${h}${s/10}`)},()=>{console.debug(`${h}${["shelf","peak"][+!!s]}`)}][f]()}})}).add([76,3],(t,o,l)=>{e.invokeSysExIndicator();let s=t[0],n=t[1],i=`XG Insertion ${t[0]+1} `;t.subarray(2).forEach((c,f)=>{([()=>{e.setEffectTypeRaw(3+s,!1,c),console.info(`${i}main type: ${Et[c]}`),e.pushEffectType(3+s)},()=>{e.setEffectTypeRaw(3+s,!0,c),console.debug(`${i}sub type: ${c+1}`),e.pushEffectType(3+s)},!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,()=>{if(c<64){let h=e.chRedir(c,o,!0);e.setXgChEffectSink(h,3+s),console.debug(`${i}channel: CH${c+1} (CH${h+1})`)}else e.setXgChEffectSink(y.invalidCh,3+s),console.info(`${i}channel: CH${c+1} (unsupported)`)}][n+f]||function(){})(c)})}).add([76,6,0],(t,o,l)=>{let s=t[0];s<64?e.setLetterDisplay(t.subarray(1),"XG letter display",s):x(e,Be,e.clockSource.now())}).add([76,7,0],(t,o,l)=>{let s=t[0];x(e,se,0),x(e,ve,e.clockSource.now()+3200),t.subarray(1).forEach(function(i,c){let f=c+s,h=f>>4,E=f&15,m=(E*3+h)*7,O=7,P=0;for(m-=E*5,h===2&&(O=2);P<O;)a(e,Le,ot)[m+P]=i>>6-P&1,P++})}).add([76,8],(t,o)=>{e.invokeSysExIndicator();let l=e.chRedir(t[0],o,!0),s=t[1],n=G[l],i=`XG CH${l+1} `,c=`Unknown XG part address ${s}.`,f=!0;t.subarray(2).forEach((h,E)=>{f=!0,s<1?console.debug(c):s<41?([()=>{e.setChCc(l,0,h),e.pushChPrimitives(l)},()=>{e.setChCc(l,32,h),e.pushChPrimitives(l)},()=>{a(e,N)[l]=h,e.pushChPrimitives(l)},()=>{f=!1;let m=e.chRedir(h,o,!0),O=a(e,B)[l];a(e,B)[l]=m,(l!==m||m!==O)&&(e.buildRchTree(),console.info(`${i}receives from CH${m+1}`)),a(e,ue)[l]||(e.copyChSetup(m,l,!0),console.debug(`${i}copied from CH${m+1}.`),e.setChActive(l,1),e.pushChPrimitives(l))},()=>{a(e,ie)[l]=+!h},()=>{},()=>{f=!1,e.setChType(l,h,$.xg),console.debug(`${i}type: ${Ct[h]||h}`),e.pushChPrimitives(l)},()=>{a(e,I)[y.rpn*l+3]=h,a(e,H)[y.rpnt*l+2]=1,e.dispatchEvent("pitch",{part:l,pitch:e.getPitchShift(l)})},!1,!1,()=>{e.setChCc(l,7,h)},!1,!1,()=>{e.setChCc(l,10,h||128)},!1,!1,()=>{e.setChCc(l,128,h),e.allocateAce(l,128)},()=>{e.setChCc(l,93,h)},()=>{e.setChCc(l,91,h)},()=>{e.setChCc(l,94,h)},()=>{e.setChCc(l,76,h)},()=>{e.setChCc(l,77,h)},()=>{e.setChCc(l,78,h)},()=>{e.setChCc(l,74,h)},()=>{e.setChCc(l,71,h)},()=>{e.setChCc(l,73,h)},()=>{e.setChCc(l,75,h)},()=>{e.setChCc(l,72,h)}][s+E-1]||(()=>{}))():s<48?console.debug(c):s<111?s>102&&s<105&&e.setChCc(l,[5,65][s&1],h):s<114?console.debug(c):s<116?console.debug(`${i}EQ ${["bass","treble"][s&1]} gain: ${h-64}dB`):s<118?console.debug(c):s<120?console.debug(`${i}EQ ${["bass","treble"][s&1]} freq: ${h}`):console.debug(c)}),f&&a(e,D)[l]>1&&e.setDrumFirstWrite(l)}).add([76,9],(t,o)=>{let l=e.chRedir(t[0],o,!0),s=t[1],n=G[l],i=`PLG-VL CH${l+1} `;t.subarray(2).forEach((c,f)=>{let h=f+s;switch(h){case 1:{console.info(`${i}breath mode: ${["system","breath","velocity","touch EG"][c]}`);break}case 0:case 27:case 28:break;default:if(h<27){let E=h-3>>1,m=["pressure","embouchure","tonguing","scream","breath noise","growl","throat formant","harmonic enhancer","damping","absorption","amplification","brightness"][E];h&1?h<23?(console.debug(`${i}${m} control source: ${ca(c)}`),c&&c<96&&e.allocateAce(l,130+E),a(e,ze)[y.redir*l+E+2]=c,e.buildRccMap()):console.debug(`${i}${m} scale break point: ${c}`):(console.debug(`${i}${m} depth: ${c-64}`),e.setChCc(l,130+E,c))}}})}).add([76,10],(t,o,l)=>{}).add([76,16],(t,o,l)=>{}).add([76,17,0,0],(t,o,l)=>{}).add([76,112],(t,o,l)=>{if(t[0]>=we.length){console.error(`Supplied invalid plugin board ID: ${t[0]}`);return}if(t[1]>=we[t[0]][1]){console.error(`Supplied invalid slot ID for board type "${we[t[0]][0]}" (${t[0]}): ${t[1]} (#${t[1]+1}))`);return}switch(t[1]>=we[t[0]][2]?console.warn(`While enabled in Octavia, slot #${t[1]+1} for board type "${we[t[0]][0]}" (${t[0]}) may not function outside software recreation.`):t[2]>63?console.debug(`XG disable PLG-${we[t[0]][0]} (${t[0]}) slot #${t[1]+1} as it's set to CH${t[2]+1}.`):console.debug(`XG enable PLG-${we[t[0]][0]} (${t[0]}) slot #${t[1]+1} for CH${t[2]+1}.`),e.modelEx.yPlg[t[0]][t[1]]=t[2]<64?e.chRedir(t[2],o,!0):y.invalidCh,t[0]){case 0:{a(e,ne)[y.ext*t[2]]=e.EXT_VL;break}case 2:{a(e,ne)[y.ext*t[2]]=e.EXT_DX;break}default:a(e,ne)[y.ext*t[2]]=e.EXT_NONE}}).add([73,0,0],(t,o)=>{let l=t[0],s="MU System - ";t.subarray(1).forEach((n,i)=>{var f,h;let c=l+i;c===8?(e.lcdContrast=Math.max(0,Math.min(8,9-n))<<2,console.debug(`${s}LCD contrast: ${n}.`)):c===18?(a(e,J)[$.xg][1]=(f=[0,126,152][n])!=null?f:127,console.debug(`${s}default bank: ${(h=["MU Basic","MU100 Native","PSR/LE"][n])!=null?h:n}.`),e.modelEx.xg.map=n,e.dispatchEvent("banklevel",{mode:"xg",data:n}),e.forceVoiceRefresh()):c>=64&&c<69&&[()=>{e.dispatchEvent("channelactive",n)},()=>{n<8?(e.dispatchEvent("channelmin",n<<4),console.debug(`Octavia System: Minimum CH${(n<<4)+1}`)):(e.dispatchEvent("channelreset"),console.info("Octavia System: Clear channel ranges"))},()=>{n<8?(e.dispatchEvent("channelmax",(n<<4)+15),console.debug(`Octavia System: Maximum CH${(n<<4)+16}`)):(e.dispatchEvent("channelreset"),console.info("Octavia System: Clear channel ranges"))},()=>{e.dispatchEvent("channelreset"),console.info("Octavia System: Clear channel ranges")},()=>{x(e,ge,!!n),console.info(`Octavia System: RS receiving ${["dis","en"][n]}abled.`)}][c-64]()})}).add([73,10,0],(t,o)=>{let l=t[0],s=`MU RS${a(e,ge)?"":" (ignored)"}: `;if(t[1]!==0){console.info(`${s}button ${l} pressed.`);return}if(l<16)switch(l){case 0:{a(e,ge)&&e.dispatchEvent("portrange",1),console.info(`${s}Show single port.`),e.lcdHideBankInfo=!1;break}case 1:{let n=e.chRedir(0,o,!0);a(e,ge)&&(e.dispatchEvent("portrange",2),e.dispatchEvent("portstart",n)),console.info(`${s}Show CH${n+1}~CH${n+32}.`),e.lcdHideBankInfo=!1;break}case 2:{let n=e.chRedir(0,o,!0);a(e,ge)&&(e.dispatchEvent("portrange",4),e.dispatchEvent("portstart",n)),console.info(`${s}Show CH${n+1}~CH${n+64}.`),e.lcdHideBankInfo=!1;break}case 3:{let n=e.chRedir(0,o,!0);a(e,ge)&&(e.dispatchEvent("portrange",2),e.dispatchEvent("portstart",n)),console.info(`${s}Show CH${n+1}~CH${n+32}, hide info.`),e.lcdHideBankInfo=!0;break}default:l>=4&&l<12?(e.lcdContrast=12-l<<1,console.debug(`${s}LCD contrast set to ${l-3}.`)):console.debug(`${s}unknown switch ${l} invoked.`)}else if(l<32){if(a(e,ge)){let n=e.chRedir(l-16+(a(e,pt)<<4),o,!0);e.dispatchEvent("channelactive",n)}}else if(l<36){let n=e.chRedir(l-32<<4,o,!0);a(e,ge)&&(e.dispatchEvent("portrange",1),e.dispatchEvent("portstart",n>>4),x(e,pt,l-32)),console.info(`${s}Show CH${n+1}~CH${n+16}.`)}}).add([73,11,0],(t,o)=>{let l="MU1000 System - channel ",s="Octavia System - channel ",n=t[0];t.subarray(1).forEach((i,c)=>{let f=n+c;([()=>{e.setChActive(i,1),e.dispatchEvent("channelactive",i),L()&&console.debug(`${l}current part: CH${i+1}`)},()=>{i<5?(e.dispatchEvent("portrange",1<<i),console.debug(`${l}port range: ${1<<i} port(s)`)):(e.dispatchEvent("portrange",0),console.debug(`${l}port range: reset`))},()=>{i<16?(e.dispatchEvent("portstart",i),console.debug(`${s}start port: ${"ABCDEFGHIJKLMNOP"[i]}`)):(e.dispatchEvent("portstart",255),console.debug(`${s}start port: reset`))}][f]||(()=>{console.debug(`${l}unknown address: ${f}`)}))()})}).add([87,0,0],(t,o)=>{var s;let l="VL70-m sound module ";switch(t[0]){case 126:{console.info(`${l}mode set to: ${(s=["VL-XG","VL70-m voice"][t[1]])!=null?s:`invalid (${t[1]})`}`),e.switchMode("xg",1),t[1]<2&&(e.modelEx.vl.module=t[1]+1),e.setPortMode(e.getTrackPort(o),1,$.xg);break}default:console.info(`Unknown ${l}address: ${t[0]}`)}}).add([93,3],(t,o)=>{let l=e.chRedir(t[0],o,!0),s=`PLG-SG CH${l+1} `,n=e.clockSource.now(),i=e.modelEx.sg;if(t[1]===0){let c="",f=0;t.subarray(2).forEach((h,E)=>{E%2===0?c+=ia[h]||h.toString().padStart("0"):f+=h*13}),(n>=i.convLastSyll||i.runLineLen>=i.maxLineLen)&&(e.dispatchEvent("metacommit",{type:"SGLyrics",data:"",amend:!1}),i.splitMask=n<i.convLastSyll,i.runLineLen=0),e.dispatchEvent("metacommit",{type:"SGLyrics",data:`${na(c)}`,amend:!0,mask:i.splitMask}),i.runLineLen++,i.splitMask=!1,i.convLastSyll=n+Math.ceil(f/2)+a(e,ut),L()&&console.debug(`${s}vocals: ${c}`)}else console.warn(`Unknown PLG-SG data: ${t}`)}).add([98,96],(t,o,l,s)=>{let n=e.chRedir(t[0],o,!0),i=G[n],c=t[1];t.subarray(2).forEach((f,h)=>{let E=c+h;if(!(E<10)){if(E===10)e.resetAce();else if(E<27){let m=E+131;e.setChCc(n,m,f),!(s!=null&&s.noAce)&&f>0&&f!==64&&e.allocateAce(n,m),e.dispatchEvent("cc",{part:n,cc:m,data:f})}}})}).add([1,20],(t,o,l)=>{l===115?(e.switchMode("doc",2),e.setPortMode(e.getTrackPort(o),1,$.doc),console.info("MIDI reset: DOC")):console.debug(`Unknown Yamaha SysEx: 67, ${l}, ${t.join(", ")}`)}).add([1,17,15,89],(t,o,l)=>{l===115?(e.setEffectType(0,24,t[0]|16),e.pushEffectType(0)):console.debug(`Unknown Yamaha SysEx: 67, ${l}, ${t.join(", ")}`)}).add([1,24],(t,o,l)=>{if(l===115){for(let s=0;s<16;s++){let n=e.chRedir(s,o,!0);e.setChCc(n,91,127)}console.info("DOC Global Reverb: on")}else console.debug(`Unknown Yamaha SysEx: 67, ${l}, ${t.join(", ")}`)}).add([126,0],(t,o,l)=>{var s,n,i;switch(t[1]){case 0:{e.dispatchEvent("metacommit",{type:"YMCSSect",data:"Disabled",raw:"Intro "}),console.debug("Yamaha Section Control is off.");break}case 127:{e.dispatchEvent("metacommit",{type:"YMCSSect",data:(s=["Intro","Main A","Main B","Fill-in AB","Fill-in BA","Ending","Blank"][t[0]-8])!=null?s:`invalid section ${t[0]}`,raw:(n=["Intro ","Main A","Main B","FillAB","FillBA","Ending","Blank "][t[0]-8])!=null?n:`ID: ${t[0]}`}),console.debug(`Yamaha Section Control switches to "${(i=["intro","main A","main B","fill-in AB","fill-in BA","ending","blank"][t[0]-8])!=null?i:`Invalid section ${t[0]}`}".`);break}default:console.debug(`Unknown YMCS section control: ${t[1]}`)}}).add([126,2],(t,o,l)=>{let s=[];for(let n=0;n<t.length;n+=2){let i=t[n]>>4,c=t[n]&15;if(i<7&&c&&c<8){let f=new Uint8Array(5);f[0]=c-1,f[1]=i-3<<2,f[2]=t[n|1],s.push(f)}}e.dispatchEvent("metacommit",{type:"ChordCtl",src:"ymcs",data:s}),console.debug("YMCS chord data: %o",s)});let u=function(t,o,l,s){},b=function(t,o){e.invokeSysExIndicator();let l=t*y.dpn,s=o[0],n=o[1];o.subarray(2).forEach((i,c)=>{let f=c+n,h=-1;f<16?([()=>{h=24},()=>{h=25},()=>{h=26},()=>{},()=>{h=28},()=>{h=29},()=>{h=30},()=>{h=31},()=>{},()=>{},()=>{},()=>{h=20},()=>{h=21},()=>{h=22},()=>{h=23},()=>{}][f]||(()=>{console.debug(`Unknown XG-style drum param ${f} on set ${t+1}.`)}))():f<32||(f<40?([()=>{h=48},()=>{h=49},!1,!1,()=>{h=52},()=>{h=53}][f-32]||(()=>{console.debug(`Unknown XG-style drum param ${f} on set ${t+1}.`)}))():f<80||([()=>{h=36}][f-80]||(()=>{console.debug(`Unknown XG-style drum param ${f} on set ${t+1}.`)}))()),h>=0?(L()&&console.debug(l,h,s,i),a(e,oe)[(l+ke[h])*y.dnc+s]=i):L()&&console.debug(`XG-style drum param ${f} has no writes.`)})},C=function(t,o,l){e.invokeSysExIndicator();let s=t*y.dpn,n=(o<<7)+l[0];l.subarray(1).forEach((i,c)=>{let f=c+n,h=f&127,E=f>>7,m=-1;E>1&&([()=>{m=26},()=>{},()=>{m=28},()=>{m=29},()=>{m=30},()=>{},()=>{},()=>{m=31}][E-2]||(()=>{console.debug(`Unknown GS-style drum param ${E} on set ${t+1}.`)}))(),m>-1?(L()&&console.debug(s,m,h,i),a(e,oe)[(s+ke[m])*y.dnc+h]=i):L()&&console.debug(`GS-style drum param ${E} has no writes.`)})};a(this,te).add([76,48],(t,o,l)=>{b(0,t)}).add([76,49],(t,o,l)=>{b(1,t)}).add([76,50],(t,o,l)=>{b(2,t)}).add([76,51],(t,o,l)=>{b(3,t)}).add([76,52],(t,o,l)=>{b(4,t)}).add([76,53],(t,o,l)=>{b(5,t)}).add([76,54],(t,o,l)=>{b(6,t)}).add([76,55],(t,o,l)=>{b(7,t)}),a(this,te).add([89,0],(t,o,l)=>{if(e.eprom){let s=t[0],n=(t[1]<<14)+(t[2]<<7)+t[3]+(e.eprom.offset||0);L()&&console.debug(`MU1000 EPROM trail to 0x${n.toString(16).padStart(6,"0")}, ${s} bytes.`);let i=e.eprom.data;t.subarray(4).forEach((c,f)=>{let h=f>>3,E=f&7;if(E===7)for(let m=0;m<7;m++)i[n+7*h+m]+=(c>>6-m&1)<<7;else i[n+7*h+E]=c})}}).add([89,1],(t,o,l)=>{let s=(t[0]<<21)+(t[1]<<14)+(t[2]<<7)+t[3];L()&&console.debug(`MU1000 EPROM jump to 0x${s.toString(16).padStart(6,"0")}.`),e.eprom&&(e.eprom.offset=s)}).add([89,2],(t,o,l)=>{if(e.eprom){let s=(t[0]<<21)+(t[1]<<14)+(t[2]<<7)+t[3]+(e.eprom.offset||0);L()&&console.debug(`MU1000 EPROM write to 0x${s.toString(16).padStart(6,"0")}.`);let n=e.eprom.data;t.subarray(4).forEach((i,c)=>{let f=c>>3,h=c&7;if(h===7)for(let E=0;E<7;E++)n[s+7*f+E]+=(i>>6-E&1)<<7;else n[s+7*f+h]=i})}}).add([89,3],(t,o,l)=>{}),a(this,te).add([39,48],(t,o,l)=>{}).add([43,0,0],(t,o,l)=>{e.invokeSysExIndicator();let s=[0,0,0,0],n=(i,c)=>{s[c]=i};if(t.subarray(1).forEach((i,c)=>{let f=c+t[0];[n,n,n,n,()=>{x(this,Y,i*129/16383*100),e.dispatchEvent("mastervolume",a(e,Y))},()=>i-64,()=>i||128,()=>i,()=>i,()=>{console.debug(`TG300 variation on cc${i}.`)}][f](i,f)}),t[0]<4){let i=0;s.forEach(c=>{i=i<<4,i+=c}),i-=1024,console.debug(`Master tune: ${i}`)}}).add([43,1,0],(t,o,l)=>{e.invokeSysExIndicator()}).add([43,2],(t,o,l)=>{e.invokeSysExIndicator();let s=e.chRedir(t[0],o,!0),n=t[1],i=G[s],c=`TG300 CH${s+1} `;t.subarray(2).forEach((f,h)=>{h<5?([()=>{},()=>{e.setChCc(s,0,f),e.pushChPrimitives(s)},()=>{e.setChCc(s,32,f),e.pushChPrimitives(s)},()=>{a(e,N)[s]=f,e.pushChPrimitives(s)},()=>{let E=e.chRedir(f,o,!0),m=a(e,B)[s];a(e,B)[s]=E,(s!==E||E!==m)&&(e.buildRchTree(),console.info(`${c}receives from CH${E+1}`))}][h+n]||(()=>{}))(f,h+n):h<21||(h<47?([()=>{a(e,ie)[s]=+!f},()=>{},()=>{},()=>{a(e,I)[y.rpn*s+3]=f,a(e,H)[y.rpnt*s+2]=1,e.dispatchEvent("pitch",{part:s,pitch:e.getPitchShift(s)})},()=>{},()=>{e.setChCc(s,7,f)},!1,!1,()=>{e.setChCc(s,10,f||128)},!1,!1,()=>{console.debug(`${c} AC1 at cc${f}`)},()=>{console.debug(`${c} AC2 at cc${f}`)},()=>{a(e,k)[i+v[128]]=f,e.allocateAce(s,128)},()=>{a(e,k)[i+v[93]]=f},()=>{a(e,k)[i+v[91]]=f},()=>{a(e,k)[i+v[94]]=f},()=>{a(e,k)[i+v[76]]=f},()=>{a(e,k)[i+v[77]]=f},()=>{a(e,k)[i+v[74]]=f},()=>{a(e,k)[i+v[71]]=f},()=>{a(e,k)[i+v[73]]=f},()=>{a(e,k)[i+v[75]]=f},()=>{a(e,k)[i+v[72]]=f},()=>{a(e,k)[i+v[78]]=f}][h+n-21]||(()=>{}))(f,h+n):h<95||([()=>{a(e,k)[i+v[65]]=f},()=>{a(e,k)[i+v[5]]=f}][h+n-95]||(()=>{}))(f,h+n))})}).add([43,7,0],(t,o,l)=>{let s=t[0];e.setLetterDisplay(t.subarray(1),"TG300 letter display",s)}).add([43,7,1],(t,o,l)=>{x(e,se,0),x(e,ve,e.clockSource.now()+3200),t.forEach(function(s,n){let i=n>>4,c=n&15,f=(c*3+i)*7,h=7,E=0;for(f-=c*5,i===2&&(h=2);E<h;)a(e,Le,ot)[f+E]=s>>6-E&1,E++})}),a(this,Ee).add([66,18,0,0,127],(t,o,l)=>{e.switchMode("sc",2),e.setPortMode(e.getTrackPort(o),2,$.sc),x(e,K,e.KARAOKE_NONE),a(e,De).fill(0),console.info(`GS system to ${["single","dual"][t[0]]} mode.`)}).add([66,18,64,0],(t,o,l)=>{switch(t[0]){case 127:{e.switchMode("gs",2),e.setPortMode(e.getTrackPort(o),4,$.gs),x(e,K,e.KARAOKE_NONE),a(e,De).fill(0),console.info("MIDI reset: GS");break}default:{e.invokeSysExIndicator();let s=[0,0,0,0],n=(i,c)=>{s[c]=i};if(t.subarray(1).forEach((i,c)=>{let f=c+t[0];[n,n,n,n,h=>{x(this,Y,h*129/16383*100),e.dispatchEvent("mastervolume",a(e,Y))},h=>{},h=>{}][f](i,c)}),t[0]<4){let i=0;s.forEach(c=>{i=i<<4,i+=c}),i-=1024,console.debug(`Master tune: ${i}`)}}}}).add([66,18,64,1],(t,o,l)=>{e.invokeSysExIndicator();let s=t[0];if(s<16){let n="".padStart(s," ");t.subarray(1).forEach((i,c)=>{n+=String.fromCharCode(Math.max(32,i))}),n=n.padEnd(16," "),console.debug(`GS patch name: ${n}`)}else s<48||(s<65?t.subarray(1).forEach((n,i)=>{let c=`GS ${s+i>55?"chorus":"reverb"} `;([()=>{console.info(`${c}type: ${Gt[n]}`),e.setEffectType(0,40,n),e.pushEffectType(0)},()=>{},()=>{},()=>{},()=>{},()=>{},!1,()=>{console.debug(`${c}predelay: ${n}ms`)},()=>{console.info(`${c}type: ${ha[n]}`),e.setEffectType(1,40,16+n),e.pushEffectType(1)},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{console.debug(`${c}to reverb: ${fe(n)}`)},()=>{console.debug(`${c}to delay: ${fe(n)}`)}][s+i-48]||(()=>{}))()}):s<80?console.debug(`Unknown GS patch address: ${s}`):s<91?t.subarray(1).forEach((n,i)=>{let c="GS delay ";([()=>{console.info(`${c}type: ${da[n]}`),e.setEffectType(2,40,32+n),e.pushEffectType(2)},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{console.debug(`${c}to reverb: ${fe(n)}`)}][s+i-80]||(()=>{}))()}):console.debug(`Unknown GS patch address: ${s}`))}).add([66,18,64,2],(t,o,l)=>{let s="GS EQ ";t.subarray(1).forEach((n,i)=>{([()=>{console.debug(`${s}low freq: ${[200,400][n]}Hz`)},()=>{console.debug(`${s}low gain: ${n-64}dB`)},()=>{console.debug(`${s}high freq: ${[3e3,6e3][n]}Hz`)},()=>{console.debug(`${s}high gain: ${n-64}dB`)}][t[0]+i]||function(){console.warn(`Unknown GS EQ address: ${t[0]+i}`)})()})}).add([66,18,64,3],(t,o,l)=>{e.invokeSysExIndicator();let s="GS EFX ",n=function(i,c){let f=fa(a(e,pe).subarray(10,12),c,i);f&&console.debug(`${s}${Bt(a(e,pe).subarray(10,12))} ${f}`)};t.subarray(1).forEach((i,c)=>{([()=>{e.setEffectTypeRaw(3,!1,32+i),e.pushEffectType(3)},()=>{e.setEffectTypeRaw(3,!0,i),console.info(`${s}type: ${Bt(a(e,pe).subarray(10,12))}`),e.pushEffectType(3)},!1,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,()=>{console.debug(`${s}to reverb: ${fe(i)}dB`)},()=>{console.debug(`${s}to chorus: ${fe(i)}dB`)},()=>{console.debug(`${s}to delay: ${fe(i)}dB`)},!1,()=>{console.debug(`${s}1 source: ${i}`),i&&i<96&&e.allocateAceAll(i)},()=>{console.debug(`${s}1 depth: ${i-64}`)},()=>{console.debug(`${s}2 source: ${i}`),i&&i<96&&e.allocateAceAll(i)},()=>{console.debug(`${s}2 depth: ${i-64}`)},()=>{console.debug(`${s}to EQ: ${i?"ON":"OFF"}`)}][t[0]+c]||function(f,h){console.warn(`Unknown GS EFX address: ${h}`)})(i,t[0]+c)})}).add([66,18,65],(t,o,l)=>{C((t[0]>>4)+1<<1,t[0]&15,t.subarray(1))}).add([66,18,72],(t,o,l)=>{let s=(t[0]&127)<<7|t[1]&127;console.debug(s,ua(t.subarray(2)))}).add([69,18,16],(t,o,l)=>{var s;switch(t[0]){case 0:{let n=t[1];e.setLetterDisplay(t.subarray(2),"GS display text",n);break}case 8:{let n=t[1],i=e.modelEx.sc;t.subarray(2).forEach((c,f)=>{([()=>{i.showBar=!(c&1),i.invBar=c>>1&1,i.invDisp=c>>2&1},()=>{i.peakHold=c<4?c:1}][f+n]||(()=>{console.debug("Unsupported GS display type SysEx.")}))()});break}case 32:{x(e,ve,e.clockSource.now()+3200),t[1]===0&&(t[2]?(x(e,se,Math.max(Math.min(t[2]-1,9),0)),L()&&console.debug(`GS switch display page ${t[2]-1}.`)):(x(e,se,0),x(e,ve,e.clockSource.now()),L()&&console.debug("GS disable display page.")));break}default:if(t[0]<6){a(e,se)>9&&x(e,se,0);let n=t[0]-1<<1|t[1]>>6;a(e,se)===n&&x(e,ve,e.clockSource.now()+3200),(s=a(e,Se)[n])!=null&&s.length||(a(e,Se)[n]=new Uint8Array(256));let i=a(e,Se)[n];L()&&console.debug(`GS frame draw page ${n}.`);let c=t[1]&63;t.subarray(2).forEach(function(h,E){let m=E+c,O=m>>4,P=m&15,ee=(P*4+O)*5,F=5,le=0;for(ee-=P*4,O===3&&(F=1);le<F;)i[ee+le]=h>>4-le&1,le++})}else console.warn(`Unknown GS display section: ${t[0]}`)}}).add([69,18,32],(t,o,l)=>{let s=t[0],n=t[1],i=t.subarray(2);if(s>>4){console.warn(`SC-8850 partial screen dump out of bounds: invalid bundle.
`,t);return}let c=n+i.length,f=n*6-(n*2428>>16<<1),h=c*6-(c*2428>>16<<1);if(f>640){console.warn(`SC-8850 partial screen dump out of bounds: invalid buffer range.
`,t);return}h>640&&(console.info(`SC-8850 partial screen dump out of bounds: invalid buffer end, automatically restricted.
`,t),h=640);let E=new Uint8Array(h-f);i.forEach((P,ee)=>{let F=ee+n,le=(F*2428&65535)*27>>16===26,Ie=F*6-(F*2428>>16<<1),V=le?2:0;for(;V<6;)E[Ie+(5-V)]=P>>V&1,V++});let m=s*108+n,O=m*6-(m*2428>>16<<1);e.dispatchEvent("screen",{type:"sc8850",offset:O,data:E}),L()&&console.debug(`SC-8850 screen dump: bundle ${s+1}, range ${f}~${h}`)});let S=function(t,o,l){e.invokeSysExIndicator();let s=t[0],n=G[o],i=nt[o],c=`GS CH${o+1} `;s<3?(t.subarray(1).forEach((f,h)=>{[()=>{a(e,k)[n+v[0]]=f,e.pushChPrimitives(o)},()=>{a(e,N)[o]=f},()=>{let E=0;f<16?E=e.chRedir(f,l,!0):E=y.ch;let m=a(e,B)[o];a(e,B)[o]=E,(o!==E||E!==m)&&(e.buildRchTree(),console.info(`${c}receives from CH${E+1}`))}][s+h]()}),e.pushChPrimitives(o)):s<19||(s<44?t.subarray(1).forEach((f,h)=>{([()=>{a(e,ie)[o]=+!f},!1,()=>{e.setChType(o,f<<1,$.gs),console.debug(`${c}type: ${f?"drum ":"melodic"}${f||""}`)},()=>{a(e,I)[i+3]=f,a(e,H)[y.rpnt*o+2]=1,e.dispatchEvent("pitch",{part:o,pitch:e.getPitchShift(o)})},!1,!1,()=>{a(e,k)[n+v[7]]=f},!1,!1,()=>{e.setChCc(o,10,f||128)},!1,!1,()=>{console.debug(`${c}CC 1: cc${f}`)},()=>{console.debug(`${c}CC 2: cc${f}`)},()=>{a(e,k)[n+v[93]]=f},()=>{a(e,k)[n+v[91]]=f},!1,!1,()=>{a(e,I)[i+1]=f,a(e,H)[y.rpnt*o+1]=1,e.dispatchEvent("pitch",{part:o,pitch:e.getPitchShift(o)})},()=>{a(e,I)[i+2]=f,a(e,H)[y.rpnt*o+1]=1,e.dispatchEvent("pitch",{part:o,pitch:e.getPitchShift(o)})},()=>{a(e,k)[n+v[94]]=f}][s+h-19]||(()=>{}))()}):s<76||console.debug(`Unknown GS part address: ${s}`))},w=function(t,o){let l=t[0],s=`GS CH${o+1} `;l<2?t.subarray(1).forEach((n,i)=>{[()=>{e.setChCc(o,32,n)},()=>{}][l+i]()}):l<32?console.warn(`Unknown GS misc address: ${l}`):l<35?t.subarray(1).forEach((n,i)=>{[()=>{console.debug(`${s}EQ: o${["ff","n"][n]}`)},()=>{},()=>{console.debug(`${s}EFX: o${["ff","n"][n]}`),e.setChEffectSink(o,n?3:0)}][l+i-32]()}):console.warn(`Unknown GS misc address: ${l}`)};a(this,Ee).add([66,18,64,16],(t,o)=>{S(t,e.chRedir(9,o,!0),o)}).add([66,18,64,17],(t,o)=>{S(t,e.chRedir(0,o,!0),o)}).add([66,18,64,18],(t,o)=>{S(t,e.chRedir(1,o,!0),o)}).add([66,18,64,19],(t,o)=>{S(t,e.chRedir(2,o,!0),o)}).add([66,18,64,20],(t,o)=>{S(t,e.chRedir(3,o,!0),o)}).add([66,18,64,21],(t,o)=>{S(t,e.chRedir(4,o,!0),o)}).add([66,18,64,22],(t,o)=>{S(t,e.chRedir(5,o,!0),o)}).add([66,18,64,23],(t,o)=>{S(t,e.chRedir(6,o,!0),o)}).add([66,18,64,24],(t,o)=>{S(t,e.chRedir(7,o,!0),o)}).add([66,18,64,25],(t,o)=>{S(t,e.chRedir(8,o,!0),o)}).add([66,18,64,26],(t,o)=>{S(t,e.chRedir(10,o,!0),o)}).add([66,18,64,27],(t,o)=>{S(t,e.chRedir(11,o,!0),o)}).add([66,18,64,28],(t,o)=>{S(t,e.chRedir(12,o,!0),o)}).add([66,18,64,29],(t,o)=>{S(t,e.chRedir(13,o,!0),o)}).add([66,18,64,30],(t,o)=>{S(t,e.chRedir(14,o,!0),o)}).add([66,18,64,31],(t,o)=>{S(t,e.chRedir(15,o,!0),o)}).add([66,18,64,64],(t,o)=>{w(t,e.chRedir(9,o,!0))}).add([66,18,64,65],(t,o)=>{w(t,e.chRedir(0,o,!0))}).add([66,18,64,66],(t,o)=>{w(t,e.chRedir(1,o,!0))}).add([66,18,64,67],(t,o)=>{w(t,e.chRedir(2,o,!0))}).add([66,18,64,68],(t,o)=>{w(t,e.chRedir(3,o,!0))}).add([66,18,64,69],(t,o)=>{w(t,e.chRedir(4,o,!0))}).add([66,18,64,70],(t,o)=>{w(t,e.chRedir(5,o,!0))}).add([66,18,64,71],(t,o)=>{w(t,e.chRedir(6,o,!0))}).add([66,18,64,72],(t,o)=>{w(t,e.chRedir(7,o,!0))}).add([66,18,64,73],(t,o)=>{w(t,e.chRedir(8,o,!0))}).add([66,18,64,74],(t,o)=>{w(t,e.chRedir(10,o,!0))}).add([66,18,64,75],(t,o)=>{w(t,e.chRedir(11,o,!0))}).add([66,18,64,76],(t,o)=>{w(t,e.chRedir(12,o,!0))}).add([66,18,64,77],(t,o)=>{w(t,e.chRedir(13,o,!0))}).add([66,18,64,78],(t,o)=>{w(t,e.chRedir(14,o,!0))}).add([66,18,64,79],(t,o)=>{w(t,e.chRedir(15,o,!0))}),a(this,Me).add([54,65],(t,o)=>{let l=a(e,U).x5===81?"05rw":"x5d";e.switchMode(l,1),e.setPortMode(e.getTrackPort(o),1,$[l]);let s=t[t.length-1],n=t.subarray(0,t.length-1),i=Ke(n);i!==s&&(console.info(`X5D multi parameters checksum mismatch! Expected ${i}, got ${s}.`),console.debug(t));let c=(t[1]<<7)+t[0],f=(t[3]<<7)+t[2],h=e.chRedir(c&15,o,!0),E=G[h];[()=>{f<1||(f<101?(e.setChType(h,e.CH_MELODIC,$.x5d),a(e,N)[h]=f-1,a(e,k)[E+v[0]]=a(e,U).x5):f<229?(e.setChType(h,e.CH_MELODIC,$.x5d),a(e,N)[h]=f-101,a(e,k)[E+v[0]]=56):(e.setChType(h,e.CH_DRUMS,$.x5d),a(e,N)[h]=Ca[f-229]||0,a(e,k)[E+v[0]]=62)),e.pushChPrimitives(h)},()=>{a(e,k)[E+v[7]]=f},()=>{f<31&&(a(e,k)[E+v[10]]=Math.round((f-15)*4.2+64))},()=>{a(e,k)[E+v[93]]=mt(f)},()=>{a(e,k)[E+v[91]]=mt(f)},()=>{a(e,I)[h*y.rpn+3]=f>8191?f-16320:64+f,a(e,H)[y.rpnt*h+2]=1,e.dispatchEvent("pitch",{part:h,pitch:e.getPitchShift(h)})},()=>{a(e,I)[h*y.rpn+1]=f>8191?f-16320:64+f,a(e,H)[y.rpnt*h+1]=1,e.dispatchEvent("pitch",{part:h,pitch:e.getPitchShift(h)})},()=>{f>0&&(a(e,I)[h*y.rpn]=f,a(e,H)[y.rpnt*h]=1,e.dispatchEvent("pitch",{part:h,pitch:e.getPitchShift(h)}))},()=>{}][c>>4]()}).add([54,76,0],(t,o)=>{e.invokeSysExIndicator();let l=a(e,U).x5===81?"05rw":"x5d";e.switchMode(l,1),e.setPortMode(e.getTrackPort(o),1,$[l]);let s="",n=a(e,U).x5,i=0,c=0,f="MSB	PRG	LSB	NME";me(t,function(h,E){if(E<16400){let m=E%164;switch(!0){case m<10:{h>31&&(s+=String.fromCharCode(h));break}case m===10:break;case m===11:{f+=`
${n}	${i}	${c}	${s.trim().replace("Init Voice","")}`,i++,s="";break}}i>99&&(n=90,i=0)}}),e.userBank.clearRange({msb:a(e,U).x5,prg:[0,99],lsb:0}),e.userBank.load(f),L()&&console.debug(f),e.forceVoiceRefresh()}).add([54,77,0],(t,o)=>{e.invokeSysExIndicator();let l=a(e,U).x5===81?"05rw":"x5d";e.switchMode(l,1),e.setPortMode(e.getTrackPort(o),1,$[l]);let s="",n=90,i=0,c=0,f="MSB	PRG	LSB	NME";me(t,function(h,E){if(E<13600){let m=E%136;switch(!0){case m<10:{h>31&&(s+=String.fromCharCode(h));break}case m===11:{f+=`
${n}	${i}	${c}	${s.trim().replace("Init Combi","")}`,i++,s="";break}}}}),e.userBank.clearRange({msb:90,prg:[0,99],lsb:0}),e.userBank.load(f),L()&&console.debug(f),e.forceVoiceRefresh()}).add([54,78],(t,o)=>{let l=a(e,U).x5===81?"05rw":"x5d";e.switchMode(l,0),e.setPortMode(e.getTrackPort(o),1,$[l]),console.debug(`X5D mode switch requested: ${["combi","combi edit","prog","prog edit","multi","global"][t[0]]} mode.`)}).add([54,85],(t,o)=>{e.invokeSysExIndicator();let l=a(e,U).x5===81?"05rw":"x5d";e.switchMode(l,1),e.setPortMode(e.getTrackPort(o),1,$[l]),me(t,(s,n)=>{n>0&&n<3&&(e.setEffectType(n-1,44,s),e.pushEffectType(n-1))})}).add([54,104],(t,o)=>{e.invokeSysExIndicator();let l=a(e,U).x5===81?"05rw":"x5d";e.switchMode(l,1);let s=e.getTrackPort(o);if(a(e,W)[s]&&a(e,W)[s]!==$[l])if(a(e,Oe).dumpLimit===e.DUMP_MODE){console.warn(`Dump cancelled for track ${o}. Port ${String.fromCharCode(65+s)} mode "${z[a(e,W)[s]]}" mismatch, should be "${l}".`);return}else console.info(`Track ${o} is trying to perform a mismached mode dump on port ${String.fromCharCode(65+s)}.`);e.setPortMode(s,1,$[l]),me(t,function(n,i,c,f){if(i<192){let h=e.chRedir(Math.floor(i/12),o,!0),E=G[h];switch(i%12){case 0:{n<128?(e.setChType(h,e.CH_MELODIC,$.x5d),a(e,k)[E+v[0]]=a(e,U).x5,a(e,N)[h]=n):(e.setChType(h,e.CH_DRUMS,$.x5d),a(e,k)[E+v[0]]=62,a(e,N)[h]=Ca[n-128]),n>0&&e.setChActive(h,1),e.pushChPrimitives(h);break}case 1:{a(e,k)[E+v[7]]=n;break}case 2:{a(e,I)[h*y.rpn+3]=n>127?n-192:64+n,a(e,H)[y.rpnt*h+2]=1,e.dispatchEvent("pitch",{part:h,pitch:e.getPitchShift(h)});break}case 3:{a(e,I)[h*y.rpn+1]=n>127?n-192:64+n,a(e,H)[y.rpnt*h+1]=1,e.dispatchEvent("pitch",{part:h,pitch:e.getPitchShift(h)});break}case 4:{n<31&&(a(e,k)[E+v[10]]=Math.round((n-15)*4.2+64));break}case 5:{let m=n>>4,O=n&15;a(e,k)[E+v[91]]=mt(O),a(e,k)[E+v[93]]=mt(m);break}case 10:{a(e,D)[h]||(a(e,k)[E+v[0]]=n>>6?56:a(e,U).x5,e.pushChPrimitives(h));break}case 11:{let m=e.chRedir(n&15,o,!0),O=n>>4;a(e,B)[h]=n,(m!==h||O)&&console.info(`X5D Part CH${h+1} receives from CH${m+1}.`)}}}else{let h=e.chRedir(i-192,o,!0)}}),e.buildRchTree()}),a(this,Ee).add([22,18,127],(t,o,l)=>{e.switchMode("mt32",2),e.setPortMode(e.getTrackPort(o),1,$.mt32),x(e,K,e.KARAOKE_NONE),e.userBank.clearRange({msb:0,lsb:127,prg:[0,127]}),console.info("MIDI reset: MT-32")}).add([22,18,0],(t,o,l)=>{e.switchMode("mt32",1);let s=e.chRedir(l,o,!0),n=t[1];t.subarray(2).forEach((i,c)=>{let f=c+n;a(e,He)[f+(s-1)*16]=i,([!1,()=>{let h=a(e,He)[s-1<<4];if(h<3){if(a(e,ye)[s]=1,h===2)for(let E=0;E<name.length;E++)a(e,Te)[(s-1)*y.cmt+E]=a(e,_e)[i*y.cmt+E];else{let E=e.baseBank.get(0,i+(h<<6),127,"mt32").name;for(let m=0;m<E.length;m++)a(e,Te)[(s-1)*y.cmt+m]=E.charCodeAt(m)}e.pushChPrimitives(s)}},()=>{a(e,I)[s*y.rpn+3]=i+40,a(e,H)[y.rpnt*s+2]=1},()=>{a(e,I)[s*y.rpn+1]=i+14,a(e,H)[y.rpnt*s+1]=1},()=>{a(e,I)[s*y.rpn]=i,a(e,H)[y.rpnt*s]=1},!1,()=>{e.setChCc(s,91,i?127:0)},!1,()=>{e.setChCc(s,7,i)},()=>{e.setChCc(s,10,Math.ceil(i*9.05))}][f]||(()=>{}))()})}).add([22,18,1],(t,o,l)=>{e.switchMode("mt32",1);let s=l&7;console.debug(`MT-32 slot #${l+1} Drum: ${t}`);let n=t[0]<<7|t[1];t.subarray(2).forEach((i,c)=>{let f=c+n,h=(f>>2)+24,E=f&3,m=s*y.dpn;if(L()&&console.debug(`MT-32 temp drum note ${h} param ${E}: ${i}`),h<24){console.warn(`MT-32 dev drum write attempted on an OOB note: ${h}`);return}[()=>{},()=>{a(e,oe)[(m+ke[26])*y.dnc+h]=Math.round(i*1.27)},()=>{a(e,oe)[(m+ke[26])*y.dnc+h]=i*9+1&127},()=>{a(e,oe)[(m+ke[26])*y.dnc+h]=i?127:0}][E]()})}).add([22,18,2],(t,o,l)=>{e.switchMode("mt32",1);let s=e.chRedir(l,o,!0),n=t[1]+(t[0]<<7);n<10&&(a(e,ye)[s]=1),t.subarray(2).forEach((i,c)=>{let f=c+n;f<14&&(a(e,Te)[(s-1)*y.cmt+f]=i)}),e.pushChPrimitives(s)}).add([22,18,3],(t,o,l)=>{e.switchMode("mt32",1);let s=l&7;if(t[0]){let n=(t[0]-1<<7)+t[1]-16;t.subarray(2).forEach((i,c)=>{let f=c+n,h=(f>>2)+24,E=f&3,m=s*y.dpn;if(L()&&console.debug(`MT-32 dev drum note ${h} param ${E}: ${i}`),h<24){console.warn(`MT-32 dev drum write attempted on an OOB note: ${h}`);return}[()=>{},()=>{a(e,oe)[(m+ke[26])*y.dnc+h]=Math.round(i*1.27)},()=>{a(e,oe)[(m+ke[26])*y.dnc+h]=i*9+1&127},()=>{a(e,oe)[(m+ke[26])*y.dnc+h]=i?127:0}][E]()})}else{let n=t[1];t.subarray(2).forEach((i,c)=>{let f=c+n;a(e,He)[f]=i;let h=e.chRedir(1+(f>>4),o,!0),E=f&15;([!1,()=>{let m=a(e,He)[h-1<<4];if(m<3)if(a(e,ye)[h]=1,m===2)for(let O=0;O<name.length;O++)a(e,Te)[(h-1)*y.cmt+O]=a(e,_e)[i*y.cmt+O];else{let O=e.baseBank.get(0,i+(m<<6),127,"mt32").name;for(let P=0;P<O.length;P++)a(e,Te)[(h-1)*y.cmt+P]=O.charCodeAt(P)}e.pushChPrimitives(h)},()=>{a(e,I)[h*y.rpn+3]=i+40,a(e,H)[y.rpnt*h+2]=1},()=>{a(e,I)[h*y.rpn+1]=i+14,a(e,H)[y.rpnt*h+1]=1},()=>{a(e,I)[h*y.rpn]=i,a(e,H)[y.rpnt*h]=1},!1,()=>{e.setChCc(h,91,i?127:0)},!1,()=>{e.setChCc(h,7,i)},()=>{e.setChCc(h,10,Math.ceil(i*9.05))}][E]||(()=>{}))()})}}).add([22,18,4],(t,o,l)=>{e.switchMode("mt32",1);let s=t[1]+(t[0]<<7),n=[];t.subarray(2).forEach((i,c)=>{let f=c+s,h=e.chRedir(Math.floor(f/246+1),o,!0),E=f%246;E<14&&(a(e,Te)[(h-1)*y.cmt+E]=i),E<10&&(a(e,ye)[h]=1),n.indexOf(h)<0&&n.push(h)}),n.forEach(i=>{e.pushChPrimitives(i)})}).add([22,18,5],(t,o,l)=>{e.switchMode("mt32",1);let s=(t[0]<<7)+t[1];t.subarray(2).forEach((n,i)=>{let c=s+i,f=Math.floor(c/8),h=c&7,E=f*8;a(e,ft)[c]=n,([!1,()=>{let m=a(e,ft)[E];if(m<3){let O="";if(m===2){let ee=y.cmt*f;O=`MT-m:${n.toString().padStart(3,"0")}`}else O=e.baseBank.get(0,n+(m<<6),127,"mt32").name;e.userBank.clearRange({msb:0,lsb:127,prg:f});let P=`MSB	LSB	PRG	NME
49	127	${f}	${O}`;e.userBank.load(P,!0)}}][h]||(()=>{}))()}),e.forceVoiceRefresh()}).add([22,18,8],(t,o,l)=>{e.switchMode("mt32",1);let s=((t[0]&1)<<7)+t[1],n=t[0]>>1,i=!1;if(t.subarray(2).forEach((c,f)=>{let h=s+f;h<y.cmt&&(a(e,_e)[n*y.cmt+h]=c,i=!0)}),i){e.userBank.clearRange({msb:0,lsb:127,prg:n});let c=`MSB	LSB	PRG	NME
49	127	${n}	MT-m:${n}`;e.userBank.load(c,!0)}e.forceVoiceRefresh()}).add([22,18,16],(t,o,l)=>{e.switchMode("mt32",1);let s=t[1],n=!1,i=function(c,f){a(e,B)[f-12]=c,n=!0};t.subarray(2).forEach((c,f)=>{let h=f+s;([!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,i,i,i,i,i,i,i,i,i,()=>{x(e,Y,c),e.dispatchEvent("mastervolume",a(e,Y))}][h]||(()=>{}))(c,f)}),n&&e.buildRchTree()}).add([22,18,32],(t,o,l)=>{e.switchMode("mt32",1);let s=t[1],n=" ".repeat(s);t.subarray(2).forEach(i=>{i>31?n+=String.fromCharCode(i):n+=" "}),x(e,Ge,n.padStart(20," ")),x(e,Be,e.clockSource.now()+3200)}).add([22,18,82],(t,o)=>{let l=e.chRedir(0,o,!0);for(let s=0;s<16;s++)a(e,j).ano(l+s),s&&s<10&&(a(e,N)[l+s]=Xt[s-1]);console.info("MT-32 alt reset complete.")}),a(this,Me).add([66,0],(t,o)=>{e.switchMode("ns5r",1),e.setPortMode(e.getTrackPort(o),2,$.ns5r),x(e,K,e.KARAOKE_NONE),console.debug(`NS5R mode switch requested: ${["global","multi","prog edit","comb edit","drum edit","effect edit"][t[0]]} mode.`)}).add([66,1],(t,o)=>{let l=["ns5r","05rw"][t[0]];e.switchMode(l,1),e.setPortMode(e.getTrackPort(o),2,$[l]),x(e,K,e.KARAOKE_NONE)}).add([66,18,0,0],(t,o)=>{let l=t[0];switch(l){case 124:case 126:case 127:{e.switchMode("ns5r",2),e.setPortMode(e.getTrackPort(o),2,$.ns5r),x(e,K,e.KARAOKE_NONE);break}case 125:{e.initDrums(),console.info(`NS5R drum setup reset on drum kit ${t[1]}.`);break}default:if(l<10){let s=[0,0,0,0],n=(i,c)=>{s[c]=i};if(t.subarray(1).forEach((i,c)=>{[n,n,n,n,()=>{x(e,Y,i*129/16383*100),e.dispatchEvent("mastervolume",a(e,Y))},()=>i-64,()=>i-64,()=>{},()=>{},()=>{}][l+c]()}),t[0]<4){let i=0;s.forEach(c=>{i=i<<4,i+=c}),i-=1024,console.debug(`Master tune: ${i}`)}}}}).add([66,18,0,1],(t,o)=>{}).add([66,18,0,2],(t,o)=>{}).add([66,18,1],(t,o)=>{e.invokeSysExIndicator();let l=e.chRedir(t[0],o,!0),s=G[l],n=t[1],i=`NS5R CH${l+1} `;t.subarray(2).forEach((c,f)=>{let h=n+f;h<3?([()=>{a(e,k)[s+v[0]]=c||$t.bank0,e.pushChPrimitives(l)},()=>{a(e,k)[s+v[32]]=c,e.pushChPrimitives(l)},()=>{a(e,N)[l]=c}][h](),e.pushChPrimitives(l)):h<8||(h<14?[()=>{let E=e.chRedir(c,o,!0),m=a(e,B)[l];a(e,B)[l]=E,(l!==E||E!==m)&&(e.buildRchTree(),console.info(`${i}receives from CH${E+1}`))},()=>{a(e,ie)[l]=+!c},()=>{e.setChType(l,c,$.ns5r),console.debug(`${i}type: ${Ct[c]}`)},()=>{a(e,I)[y.rpn*l+3]=c,a(e,H)[y.rpnt*l+2]=1,e.dispatchEvent("pitch",{part:l,pitch:e.getPitchShift(l)})},()=>{},()=>{}][h-8]():h<16||(h<33?[()=>{a(e,k)[s+v[7]]=c},()=>{a(e,k)[s+v[11]]=c},()=>{},()=>{},()=>{a(e,k)[s+v[10]]=c||128},()=>{},()=>{},()=>{a(e,k)[s+v[93]]=c},()=>{a(e,k)[s+v[91]]=c},()=>{a(e,k)[s+v[76]]=c},()=>{a(e,k)[s+v[77]]=c},()=>{a(e,k)[s+v[78]]=c},()=>{a(e,k)[s+v[74]]=c},()=>{a(e,k)[s+v[71]]=c},()=>{a(e,k)[s+v[73]]=c},()=>{a(e,k)[s+v[75]]=c},()=>{a(e,k)[s+v[72]]=c}][h-16]():h<112||h<114&&[()=>{a(e,k)[s+v[5]]=c},()=>{a(e,k)[s+v[65]]=c}][h-112]()))})}).add([66,18,8,0],(t,o)=>{let l=t[0];if(l<32)e.setLetterDisplay(t.subarray(1,33),"NS5R letter display");else{let s=l-32;x(e,ve,e.clockSource.now()+3200),x(e,se,10);let n=t.subarray(1),i=4;n.forEach(function(c,f){let h=f+s,E=h>>4,m=h&15;if(h<80){let O=E<i?c:c>>3,P=0,ee=E<i?6:3;for(;O>0;)a(e,Le,ot)[m*32+E*7+(ee-P)]=O&1,O=O>>1,P++}})}}).add([66,18,48],(t,o,l)=>{b(0,t)}).add([66,18,49],(t,o,l)=>{b(1,t)}).add([66,18,50],(t,o,l)=>{b(2,t)}).add([66,18,51],(t,o,l)=>{b(3,t)}).add([66,18,52],(t,o,l)=>{b(4,t)}).add([66,18,53],(t,o,l)=>{b(5,t)}).add([66,18,54],(t,o,l)=>{b(6,t)}).add([66,18,55],(t,o,l)=>{b(7,t)}).add([66,52],(t,o)=>{e.switchMode("ns5r",1),x(e,K,e.KARAOKE_NONE);let l="";me(t,(s,n)=>{n<8?(s>31&&(l+=String.fromCharCode(s)),n===7&&(e.aiEfxName=l)):n<10&&(e.setEffectType(n-8,44,s),e.pushEffectType(n-8))})}).add([66,53],(t,o)=>{e.invokeSysExIndicator(),e.switchMode("ns5r",1),x(e,K,e.KARAOKE_NONE);let l="",s=t[t.length-1],n=t.subarray(0,t.length-1),i=Ke(n);i!==s&&(console.info(`NS5R current multi dump checksum mismatch! Expected ${i}, got ${s}.`),console.debug(t));let c=e.getTrackPort(o);if(a(e,W)[c]&&a(e,W)[c]!==$.ns5r)if(a(e,Oe).dumpLimit===e.DUMP_MODE){console.warn(`Dump cancelled for track ${o}. Port ${String.fromCharCode(65+c)} mode "${z[a(e,W)[c]]}" mismatch, should be "ns5r".`);return}else console.info(`Track ${o} is trying to perform a mismached mode dump on port ${String.fromCharCode(65+c)}.`);e.setPortMode(c,2,$.ns5r),me(n,function(f,h){switch(!0){case h<2944:{let E=e.chRedir(Math.floor(h/92),o,!0),m=G[E];switch(h%92){case 0:{a(e,k)[m+v[0]]=f,e.pushChPrimitives(E),e.pushChPrimitives(E);break}case 1:{a(e,k)[m+v[32]]=f,!f&&!a(e,k)[m+v[0]]&&(a(e,k)[m+v[0]]=$t.bank0),e.pushChPrimitives(E);break}case 2:{a(e,N)[E]=f,f>0&&e.setChActive(E,1);break}case 3:{let O=e.chRedir(f,o,!0);a(e,B)[E]=O,E!==O&&console.info(`NS5R CH${E+1} receives from CH${O+1}.`);break}case 7:{a(e,D)[E]=f,e.pushChPrimitives(E);break}case 8:{a(e,I)[E*y.rpn+3]=f<40||f>88?f+(f>63?-192:64):f,a(e,H)[y.rpnt*E+2]=1,e.dispatchEvent("pitch",{part:E,pitch:e.getPitchShift(E)});break}case 9:case 10:{a(e,k)[m+v[7]]=f;break}case 11:{a(e,k)[m+v[11]]=f;break}case 14:{a(e,k)[m+v[10]]=f||128;break}case 19:{a(e,k)[m+v[93]]=f;break}case 20:{a(e,k)[m+v[91]]=f;break}case 84:{a(e,k)[m+v[65]]=f;break}case 85:{a(e,k)[m+v[5]]=f;break}}break}case h<3096:break;case h<3134:{let E=h-3096;E<8?(f>31&&(l+=String.fromCharCode(f)),E===7&&(e.aiEfxName=l)):E<10&&(e.setEffectType(E-8,44,f),e.pushEffectType(E-8));break}case h<8566:break}}),e.buildRchTree()}).add([66,54],(t,o)=>{e.invokeSysExIndicator(),e.switchMode("ns5r",1);let l="",s=80,n=0,i=0,c="MSB	PRG	LSB	NME";me(t,function(f,h){let E=h%158;switch(!0){case E<10:{f>31&&(l+=String.fromCharCode(f));break}case E===10:break;case E===11:{s=f&127;break}case E===12:{i=f&127;break}case E===13:{c+=`
${s}	${n}	${i}	${l.trim().replace("Init Voice","")}`,n++,l="";break}}}),e.userBank.clearRange({msb:80,lsb:0}),e.userBank.load(c),L()&&console.debug(c),e.forceVoiceRefresh()}).add([66,55],(t,o)=>{e.invokeSysExIndicator(),e.switchMode("ns5r",1);let l="",s=88,n=0,i=0,c="MSB	PRG	LSB	NME";me(t,function(f,h){let E=h%126;switch(!0){case E<10:{f>31&&(l+=String.fromCharCode(f));break}case E===11:break;case E===12:break;case E===13:{c+=`
${s}	${n}	${i}	${l.trim().replace("Init Combi","")}`,n++,l="";break}}}),e.userBank.clearRange({msb:88,lsb:0}),e.userBank.load(c),L()&&console.debug(c),e.forceVoiceRefresh()}).add([66,125],(t,o,l)=>{e.dispatchEvent("backlight",["green","orange","red",!1,"yellow","blue","purple"][t[0]]||"white")}).add([66,127],(t,o,l)=>{let s=t[t.length-1],n=t.subarray(0,t.length-1),i=Ke(n);i!==s&&(console.info(`NS5R screen dump checksum mismatch! Expected ${i}, got ${s}.`),console.debug(t));let c=new Uint8Array(5760);me(t,(f,h,E)=>{if(h<720)for(let m=0;m<8;m++)c[h*8+m]=f>>7-m&1}),e.dispatchEvent("screen",{type:"ns5r",data:c})}).add([76],(t,o,l)=>{a(e,Me).run([66,...t],o,l)}),a(e,tt).add([16,0,8,0],(t,o,l)=>{let s=(t[2]<<4)+t[3],n="K11 ";([()=>{e.switchMode("k11",2),e.setPortMode(e.getTrackPort(o),2,$.k11),x(e,K,e.KARAOKE_NONE),a(e,J)[$.k11][1]=s?4:0,console.info("MIDI reset: GMega/K11")},()=>{e.setEffectType(0,24,s),console.debug(`${n}reverb type: ${s}`),e.pushEffectType(0)},()=>{console.debug(`${n}reverb time: ${s}`)},()=>{console.debug(`${n}reverb time: ${s}`)},()=>{console.debug(`${n}reverb predelay: ${s}`)},()=>{console.debug(`${n}reverb predelay: ${s}`)},()=>{console.debug(`${n}depth high: ${s}`)},()=>{console.debug(`${n}depth high: ${s}`)},()=>{console.debug(`${n}depth low: ${s}`)},()=>{console.debug(`${n}depth low: ${s}`)}][t[0]]||(()=>{}))()}).add([16,0,8,1],(t,o,l)=>{e.invokeSysExIndicator();let s=e.chRedir(t[1],o,!0),n=G[s],i=nt[s],c=(t[3]<<4)+t[4],f=`GMega CH${s+1} `;([()=>{c<128?(e.setChType(s,e.CH_MELODIC,$.k11),a(e,k)[n+v[0]]=0,a(e,N)[s]=c):(e.setChType(s,e.CH_DRUMS,$.k11),a(e,N)[s]=c-128),e.pushChPrimitives(s)},()=>{let h=e.chRedir(c,o,!0),E=a(e,B)[s];a(e,B)[s]=h,(s!==h||h!==E)&&(e.buildRchTree(),console.info(`${f}receives from CH${h+1}`))},()=>{a(e,k)[n+v[7]]=c},()=>{uupThis.setChActive(s,c)},()=>{a(e,k)[n+v[10]]=c},()=>{a(e,I)[i+3]=c+40,a(e,H)[y.rpnt*s+2]=1,e.dispatchEvent("pitch",{part:s,pitch:e.getPitchShift(s)})},()=>{a(e,I)[i+1]=c>>1,a(e,I)[i+2]=c&1,a(e,H)[y.rpnt*s+1]=1,e.dispatchEvent("pitch",{part:s,pitch:e.getPitchShift(s)})},()=>{a(e,k)[n+v[91]]=c?127:0},()=>{},()=>{a(e,k)[n+v[74]]=c},()=>{a(e,k)[n+v[73]]=c},()=>{a(e,k)[n+v[72]]=c}][t[0]]||(()=>{}))()}).add([16,0,9,0],(t,o,l)=>{e.invokeSysExIndicator();let s=(t[2]<<4)+t[3],n="GMLX ";([()=>{console.debug(`${n}reverb type: ${s}`)},()=>{console.debug(`${n}reverb time: ${s}`)},()=>{console.debug(`${n}reverb predelay: ${s}`)},()=>{console.debug(`${n}depth high: ${s}`)},()=>{console.debug(`${n}depth low: ${s}`)}][t[0]]||(()=>{}))()}).add([16,0,9,3],(t,o,l)=>{e.invokeSysExIndicator();let s=(t[2]<<4)+t[3],n=e.chRedir(t[1],o,!0),i=G[n],c=`GMLX CH${n+1} `;[()=>{s<128?(e.setChType(n,e.CH_MELODIC,$.k11),a(e,k)[i+v[0]]=0,a(e,k)[i+v[32]]=0,a(e,N)[n]=s):s<160?(e.setChType(n,e.CH_MELODIC,$.k11),a(e,k)[i+v[0]]=0,a(e,k)[i+v[32]]=7,a(e,N)[n]=s-100):(e.setChType(n,e.CH_DRUMS,$.k11),a(e,k)[i+v[0]]=122,a(e,k)[i+v[32]]=0,a(e,N)[n]=s-160),e.pushChPrimitives(n)},()=>{let f=e.chRedir(s,o,!0),h=a(e,B)[n];a(e,B)[n]=f,(n!==f||f!==h)&&(e.buildRchTree(),console.info(`${c}receives from CH${f+1}`))}][t[0]]()}).add([16,0,9,4],(t,o,l)=>{e.invokeSysExIndicator();let s=(t[2]<<4)+t[3],n=e.chRedir(t[1],o,!0),i=G[n],c=nt[n];[()=>{e.setChActive(n,s)},()=>{a(e,k)[i+v[7]]=s},()=>{a(e,k)[i+v[10]]=s},()=>{a(e,k)[i+v[91]]=s?127:0},()=>{a(e,I)[c+3]=s+40,a(e,H)[y.rpnt*n+2]=1,e.dispatchEvent("pitch",{part:n,pitch:e.getPitchShift(n)})},()=>{a(e,I)[c+1]=s,a(e,H)[y.rpnt*n+1]=1,e.dispatchEvent("pitch",{part:n,pitch:e.getPitchShift(n)})},()=>{a(e,I)[c]=s,a(e,H)[y.rpnt*n]=1,e.dispatchEvent("pitch",{part:n,pitch:e.getPitchShift(n)})},()=>{}][t[0]]()}),a(this,at).add([66,93,64],(t,o,l)=>{let s=t[2];switch(t[0]){case 0:{switch(t[1]){case 4:{e.invokeSysExIndicator(),x(e,Y,s*129/16383*100),e.dispatchEvent("mastervolume",a(e,Y));break}case 5:{e.invokeSysExIndicator(),s-64;break}case 6:{e.invokeSysExIndicator(),console.debug(`SG global reverb: ${s?"on":"off"}`);break}case 127:{e.switchMode("sg",2),e.setPortMode(e.getTrackPort(o),1,$.sg);break}}break}case 1:{switch(t[1]){case 48:{e.invokeSysExIndicator(),console.debug(`SG reverb type: ${Gt[s]}`);break}}break}default:if(t[0]>>4===1){e.invokeSysExIndicator();let n=e.chRedir(t[0]&15,o,!0);if(t[1]===2){let i=e.chRedir(s,o,!0),c=a(e,B)[n];a(e,B)[n]=i,(n!==i||i!==c)&&(e.buildRchTree(),console.info(`SG CH${n+1} receives from CH${i+1}`))}else t[1]===19&&e.setChCc(n,7,s)}else console.warn(`Unknown AKAI SG SysEx: ${t}`)}}),a(this,rt).add([9],(t,o,l)=>{e.invokeSysExIndicator(),console.debug(`GZ set effect: ${["stage reverb","hall reverb","room reverb","chorus","tremolo","phaser","rotary speaker","enhancer","flanger","EQ"][t[0]]||"off"}`)}),a(this,te).add([127,0],(t,o,l)=>{e.switchMode("motif",1);let s=new Uint8Array([127,1,...t]);a(e,te).run(s,o,l)}).add([127,1,0,0],(t,o,l)=>{e.switchMode("s90es");let s="S90/Motif ES system ",n=t[0];t.subarray(1).forEach((i,c)=>{([()=>{x(e,Y,i*12900/16383),e.dispatchEvent("mastervolume",a(e,Y))}][n+c]||(()=>{console.info(`Unrecognized ${s}ID: ${n+c}`)}))()})}).add([127,1,14],(t,o,l)=>{e.switchMode("s90es");let s="S90/Motif ES bulk header ",n=[];n[95]=(i,c,f)=>{console.debug(`${s}multi edit buffer: ${i[1]}`)},(n[t[0]]||(()=>{console.info(`Unrecognized ${s}ID: ${t[0]}.`)}))(t.subarray(1))}).add([127,1,15],(t,o,l)=>{e.switchMode("s90es");let s="S90/Motif ES bulk footer ",n=[];n[95]=(i,c,f)=>{console.debug(`${s}multi edit buffer: ${i[1]}`)},(n[t[0]]||(()=>{console.info(`Unrecognized ${s}ID: ${t[0]}.`)}))(t.subarray(1))}).add([127,1,54,1],(t,o,l)=>{e.switchMode("s90es");let s="S90/Motif ES reverb ",n=t[0];t.subarray(1).forEach((i,c)=>{([()=>{e.setEffectTypeRaw(0,!1,i&15|128)},()=>{e.setEffectTypeRaw(0,!0,i)}][n+c]||(()=>{}))()}),e.pushEffectType(0)}).add([127,1,54,2],(t,o,l)=>{e.switchMode("s90es");let s="S90/Motif ES chorus ",n=t[0];t.subarray(1).forEach((i,c)=>{([()=>{e.setEffectTypeRaw(1,!1,i&15|128)},()=>{e.setEffectTypeRaw(1,!0,i)}][n+c]||(()=>{}))()}),e.pushEffectType(1)}).add([127,1,54,3],(t,o,l)=>{e.switchMode("s90es");let s="S90/Motif ES insert 1 ",n=t[0];t.subarray(1).forEach((i,c)=>{([()=>{e.setEffectTypeRaw(3,!1,i&15|128)},()=>{e.setEffectTypeRaw(3,!0,i)}][n+c]||(()=>{}))()}),e.pushEffectType(3)}).add([127,1,54,4],(t,o,l)=>{e.switchMode("s90es");let s="S90/Motif ES insert 2 ",n=t[0];t.subarray(1).forEach((i,c)=>{([()=>{e.setEffectTypeRaw(4,!1,i&15|128)},()=>{e.setEffectTypeRaw(4,!0,i)}][n+c]||(()=>{}))()}),e.pushEffectType(4)}).add([127,1,54,16],(t,o,l)=>{e.switchMode("s90es");let s=t[0];t.subarray(1).forEach((n,i)=>{let f=`S90/Motif ES EQ${(i>>2)+1} `;([()=>{let h=n-64},()=>{let h=it[n]},()=>{let h=n/10},()=>{let h=n}][s+i&3]||(()=>{}))()})}).add([127,1,54,17],(t,o,l)=>{e.switchMode("s90es");let s="S90/Motif ES variation ",n=t[0];t.subarray(1).forEach((i,c)=>{([()=>{e.setEffectTypeRaw(2,!1,i&15|128)},()=>{e.setEffectTypeRaw(2,!0,i)}][n+c]||(()=>{}))()}),e.pushEffectType(2)}).add([127,1,55],(t,o,l)=>{e.invokeSysExIndicator(),e.switchMode("s90es");let s=e.getTrackPort(o);if(a(e,W)[s]&&a(e,W)[s]!==a(e,U).smotif)if(a(e,Oe).dumpLimit===e.DUMP_MODE){console.warn(`Dump cancelled for track ${o}. Port ${String.fromCharCode(65+s)} mode "${z[a(e,W)[s]]}" mismatch, should be "${z[a(e,U).smotif]}".`);return}else console.info(`Track ${o} is trying to perform a mismached mode dump on port ${String.fromCharCode(65+s)}.`);let n=e.chRedir(t[0],o,!0),i=G[n],c=t[1];t[0]>15&&(n=t[0]+32);let f=`Track ${o} S90/Motif ES bulk CH${n<128?n+1:"U"+(n-127)} `;console.debug(f,t),!(t[0]>15)&&t.subarray(2).forEach((h,E)=>{([()=>{e.setChCc(n,0,h),e.pushChPrimitives(n)},()=>{h&&e.setChActive(n,1),e.setChCc(n,32,h),e.getChPrimitive(n,1)===63&&e.setChType(n,[32,40].indexOf(h)>-1?e.CH_DRUMS:e.CH_MELODIC,a(e,_),!0),e.pushChPrimitives(n)},()=>{h&&e.setChActive(n,1),a(e,N)[n]=h,e.pushChPrimitives(n)},()=>{let m=e.chRedir(h,o,!0),O=a(e,B)[n];a(e,B)[n]=m,(n!==m||m!==O)&&(e.buildRchTree(),console.info(`${f}receives from CH${m+1}`))},()=>{a(e,ie)[n]=h?0:1},!1,!1,!1,!1,!1,!1,!1,!1,()=>{h!==100&&e.setChActive(n,1),a(e,k)[i+v[7]]=h},()=>{h!==64&&e.setChActive(n,1),a(e,k)[i+v[10]]=h},!1,!1,!1,()=>{a(e,k)[i+v[91]]=h},()=>{h&&e.setChActive(n,1),a(e,k)[i+v[93]]=h},()=>{h&&e.setChActive(n,1),a(e,k)[i+v[94]]=h},()=>{e.setChCc(n,128,h),h!==127&&(e.setChActive(n,1),e.allocateAce(n,128))},()=>{},()=>{h!==64&&e.setChActive(n,1),a(e,k)[i+v[74]]=h},()=>{h!==64&&e.setChActive(n,1),a(e,k)[i+v[71]]=h},!1,()=>{a(e,k)[i+v[65]]=h},()=>{a(e,k)[i+v[5]]=h},()=>{}][c+E]||(()=>{}))()})}),a(e,te).add([100,14],(t,o,l)=>{var n;e.switchMode("cs6x"),e.setPortMode(e.getTrackPort(o),1,$.cs6x);let s=(n=["normal voice","plugin voice PLG","drums",,"performance",,"phrase clip"][t[0]>>4])!=null?n:"invalid";t[0]&!0?s+=" edit buffer":t[0]>>4==1?s+=`${(t[0]&1)+1}`:s+=` ${["INT","EXT"][t[0]&1]}`,console.debug(`CS6x bulk dump for ${s} started.`)}).add([100,15],(t,o,l)=>{var n;e.switchMode("cs6x");let s=(n=["normal voice","plugin voice PLG","drums",,"performance",,"phrase clip"][t[0]>>4])!=null?n:"invalid";t[0]&!0?s+=" edit buffer":t[0]>>4==1?s+=`${(t[0]&1)+1}`:s+=` ${["INT","EXT"][t[0]&1]}`,console.debug(`CS6x bulk dump for ${s} ended.`)}).add([100,76,112],(t,o,l)=>{e.switchMode("cs6x");let s=0,n=t[0];t.subarray(1).forEach((i,c)=>{let f=c+n;f<10?(e.setChCvnRegister(s,c,i&127),a(e,ye)[s]=1):f<12||f<13&&console.debug(`Plugin voice type: ${i}`)}),e.pushChPrimitives(s)}).add([100,76,0],(t,o,l)=>{e.switchMode("cs6x"),e.setPortMode(e.getTrackPort(o),1,$.cs6x);let s=0,n=t[0];t.subarray(1).forEach((i,c)=>{let f=c+n;([()=>{e.setChCc(s,7,i),i!==100&&e.setChActive(s,1)},,,()=>{a(e,ie)[s]=i==0,e.setChCc(s,64,0),a(e,j).ano(s),e.resetChAceAll(s)},,()=>{},,,()=>{e.setChCc(s,65,i?127:0)},()=>{e.setChCc(s,5,i)},,()=>{e.setChCc(s,91,i),i!==40&&e.setChActive(s,1)},()=>{e.setChCc(s,93,i),i&&e.setChActive(s,1)}][f]||(()=>{}))()})}).add([100,76,1],(t,o,l)=>{e.switchMode("cs6x");let s=0,n=t[0],i=!1;t.subarray(1).forEach((c,f)=>{let h=f+n;([()=>{e.setEffectTypeRaw(0,!1,c&15|128),i=!0},()=>{e.setEffectTypeRaw(0,!0,c),i=!0}][h]||(()=>{}))()}),i&&e.pushEffectType(0)}).add([100,76,2],(t,o,l)=>{e.switchMode("cs6x");let s=0,n=t[0],i=!1;t.subarray(1).forEach((c,f)=>{let h=f+n;([()=>{e.setEffectTypeRaw(1,!1,c&15|128),i=!0},()=>{e.setEffectTypeRaw(1,!0,c),i=!0}][h]||(()=>{}))()}),i&&e.pushEffectType(1)}).add([100,76,3],(t,o,l)=>{e.switchMode("cs6x");let s=0,n=t[0],i=!1;t.subarray(1).forEach((c,f)=>{let h=f+n;([()=>{e.setEffectTypeRaw(2,!1,c&15|128),i=!0},()=>{e.setEffectTypeRaw(2,!0,c),i=!0}][h]||(()=>{}))()}),i&&e.pushEffectType(2)}).add([100,76,5],(t,o,l)=>{e.switchMode("cs6x")}).add([100,76,16],(t,o,l)=>{e.switchMode("cs6x");let s=0,n=t[0],i=!1;if(t.subarray(1).forEach((c,f)=>{let h=f+n;([()=>{e.setChCc(s,0,c),i=!0},()=>{e.setChCc(s,32,c),i=!0,c&&e.setChActive(s,1)},()=>{a(e,N)[s]=c,i=!0,c&&e.setChActive(s,1)},()=>{a(e,H)[nt[s]+Dt[2]]=1,a(e,I)[nt[s]+Dt[2]]=c,c&&e.setChActive(s,1)}][h]||(()=>{}))()}),i){switch(e.pushChPrimitives(s),e.getChVoice(s).standard){case"DX":{a(e,ne)[s]=e.EXT_DX;break}case"VL":{a(e,ne)[s]=e.EXT_VL;break}}e.dispatchEvent("metacommit",{type:"OSysMeta",msg:"part.rename",data:{part:s}})}}).add([100,76,32],(t,o,l)=>{e.switchMode("cs6x");let s=0,n=t[0],i=a(e,ne)[s];switch(i){case e.EXT_DX:{t.length>2&&console.debug(t),t.subarray(1).forEach((c,f)=>{let h=f+n;if(h<6){let E=h+142;e.setChCc(s,E,c),c!==64&&e.allocateAce(s,E)}else if(h<12){let E=h+144;e.setChCc(s,E,c),c!==64&&e.allocateAce(s,E)}else([()=>{},()=>{},()=>{},()=>{}][h]||(()=>{}))()});break}case e.EXT_VL:{console.info(`Support for Modular System Plug-in writes is not yet present for plugin type ${i}.`);break}default:console.warn(`Unsupported plug-in type: ${i}`)}}),a(this,Ee).add([0,72,18,0,0,0,0],(t,o,l)=>{e.switchMode("sd",2),e.setPortMode(e.getTrackPort(o),2,$.sd),console.info("MIDI reset: SD")}).add([0,72,18,16,0],(t,o,l)=>{e.invokeSysExIndicator();let s=t[0]>>5,n=t[0]&31;switch(s){case 0:{let i=t[0]>>1,c=t[1];switch(i){case 1:{t.subarray(2).forEach((f,h,E)=>{let m=h+c;switch(m){case 0:{f&&(e.setEffectType(1,60,f-1),e.pushEffectType(1),console.debug(`SD MFX Cho: ${m} - ${f}`));break}}});break}case 2:{t.subarray(2).forEach((f,h)=>{let E=h+c;switch(E){case 0:{f&&(e.setEffectType(0,55+f,0),e.pushEffectType(0),console.debug(`SD MFX Rev: ${E} - ${f}`));break}}});break}case 3:case 4:case 5:{let f=i-1;t.subarray(2).forEach((h,E)=>{let m=E+c;switch(console.debug(`SD MFX ${f-2}: ${m} - ${h}`),m){case 0:{e.setEffectTypeRaw(f,62,h),e.pushEffectType(f);break}}}),console.debug(`SD MFX message:
%o`,t);break}default:console.debug(`Unknown SD-90 global effects message:
%o`,t)}break}case 1:{let i=e.chRedir(n,o,!0),c=t[1],f=G[i];t.subarray(2).forEach((h,E)=>{let m=c+E;m<37?([()=>{},()=>{},0,()=>{},()=>{switch(h){case 104:case 105:case 106:case 107:case 120:case 128:{a(e,D)[i]||e.setChType(i,e.CH_DRUMS);break}default:a(e,D)[i]&&e.setChType(i,e.CH_MELODIC)}e.setChCc(i,0,h),e.pushChPrimitives(i)},()=>{e.setChCc(i,32,h),e.pushChPrimitives(i)},()=>{a(e,N)[i]=h},()=>{a(e,k)[f+v[7]]=h},()=>{a(e,k)[f+v[10]]=h},()=>{},()=>{},()=>{h<2&&(a(e,ie)[i]=h)},()=>{h<2&&(a(e,k)[f+v[68]]=h?127:0)},()=>{},()=>{h<2&&(a(e,k)[f+v[65]]=h?127:0)},()=>{a(e,k)[f+v[5]]=h&15<<4|a(e,k)[f+v[5]]&15},()=>{a(e,k)[f+v[5]]=h&15|(a(e,k)[f+v[5]]&240)>>4},()=>{a(e,k)[f+v[74]]=h},()=>{a(e,k)[f+v[71]]=h},()=>{a(e,k)[f+v[73]]=h},()=>{a(e,k)[f+v[72]]=h},0,0,0,0,0,0,0,()=>{a(e,k)[f+v[128]]=h,e.allocateAce(128)},()=>{a(e,k)[f+v[93]]=h},()=>{a(e,k)[f+v[91]]=h},0,0,()=>{a(e,k)[f+v[75]]=h},()=>{a(e,k)[f+v[76]]=h},()=>{a(e,k)[f+v[77]]=h},()=>{a(e,k)[f+v[78]]=h}][m]||(()=>{}))():m<63||(m<64?(a(e,D)[i]?(e.setChCc(i,0,104|h),e.pushChPrimitives(i)):(e.setChCc(i,0,96|h),e.pushChPrimitives(i)),e.pushChPrimitives(i)):console.debug(`Unknown SD-90 global CH${i+1} param setup message:
%o`,t))});break}case 2:{let i=e.chRedir(n,o,!0),c=t[1];console.debug(`Unknown SD-90 global CH${i+1} MIDI setup message:
%o`,t.subarray(2));break}default:console.warn(`Unknown SD-90 global part setup message:
%o`,t)}}),a(e,Me).add([0,1,73,78],(t,o,l)=>{e.switchMode("krs",1),e.setPortMode(e.getTrackPort(o),1,$.krs),console.debug("Might be KORG KROSS 2 mode reset... Not sure.")}).add([0,1,73,117,2,37],(t,o,l)=>{e.switchMode("krs",1);let s=e.getTrackPort(o);if(a(e,W)[s]&&a(e,W)[s]!==$.krs)if(a(e,Oe).dumpLimit===e.DUMP_MODE){console.warn(`Dump cancelled. Port ${String.fromCharCode(65+s)} mode "${z[a(e,W)[s]]}" mismatch, should be "krs".`);return}else console.info(`Track ${o} is trying to perform a mismached mode dump on port ${String.fromCharCode(65+s)}.`);e.setPortMode(e.getTrackPort(o),1,$.krs);let n="KROSS 2 BMT1 ",i="";me(t,(c,f)=>{if(f<24)i+=String.fromCharCode(Math.max(32,c));else if(!(f<88)){if(f<468){let h=f-88,E=h*863>>16,m=h-E*76;([()=>{e.setEffectType(E+3,45,c),e.pushEffectType(E+3)},!1,()=>{console.debug(`${n}IFX${E+1} sends to ${c<=5&&c>0?`IFX${c}`:"direct out"}.`)}][m]||(()=>{}))()}else if(f<604){let h=f-468,E=h*964>>16,m=h-E*68;([()=>{e.setEffectType(1-E,45,c),e.dispatchEvent(["efxreverb","efxchorus"][1-E],{id:e.getEffectType(1-E)})},!1][m]||(()=>{}))()}else if(!(f<1276)){let h=f-1276,E=h*1490>>16,m=e.chRedir(E,o,!0),O=h-E*44;O<22?([()=>{c&&e.setChActive(m,1),a(e,N)[m]=c,e.pushChPrimitives(m)},()=>{c&&e.setChActive(m,1),c<10?(e.setChCc(m,0,63),e.setChCc(m,32,c)):c<20?(e.setChCc(m,0,121),e.setChCc(m,32,c-10)):c<24&&(e.setChCc(m,0,[120,0,56,62][c-20]),e.setChCc(m,32,0)),e.pushChPrimitives(m)},()=>{let P=e.chRedir(c&15,o,!0);a(e,B)[m]=P,P!==m&&console.info(`${n}CH${m+1} receives from CH${P+1}`);let ee=c>>5&1;e.modelEx.kross.chToggle&&(e.setChActive(m,ee),ee||console.debug(`KORG KROSS 2 CH${m+1} is disabled.`))},!1,!1,()=>{e.setChCc(m,7,c)},!1,()=>{},()=>{},!1,!1,!1,!1,!1,()=>{e.setChCc(m,10,c||128)}][O]||(()=>{}))():O<36?([()=>{let P=c&7;c&8&&(P=1),P>1&&console.debug(`${n}CH${m+1} sends to ${P>1?`IFX${P-1}`:"direct out"} (${c.toString(16)}).`),e.setChEffectSink(m,c>1&&c<7?c+1:0)}][O-22]||(()=>{}))():([()=>{e.setChCc(m,74,(c+128&255)-64)},()=>{e.setChCc(m,71,(c+128&255)-64)},!1,!1,()=>{e.setChCc(m,73,(c+128&255)-64)},()=>{e.setChCc(m,75,(c+128&255)-64)},!1,()=>{e.setChCc(m,72,(c+128&255)-64)}][O-36]||(()=>{}))()}}}),i=i.trimEnd(),e.dispatchEvent("metacommit",{type:"EORTitle",data:i})});let M=function(t,o,l){let s=e.chRedir(t,o,!0);e.setChMode(s,$.an1x),e.pushChPrimitives(s),console.debug(`Yamaha AN1x slot ${l+1} receives from CH${s+1}(${t+1}).`),e.modelEx.yPlg[3][l]=s};a(e,te).add([92,0,0],(t,o,l)=>{let s=t[0];t.subarray(1).forEach((n,i)=>{let c=i+s;c<2||([!1,!1,!1,!1,!1,!1,()=>{M(n,o,0)},()=>{M(n,o,1)}][c-2]||(()=>{}))()})}),a(e,te).add([75,80,0],(t,o,l)=>{let s=t[0];t.subarray(1).forEach((n,i)=>{let c=i+s;([()=>{e.modelEx.cs1x.perfCh=n,e.pushChPrimitives(n),console.debug(`Yamaha CS1x performance on CH${n+1}.`)},!1,!1,!1,()=>{},!1,()=>{switch(n){case 1:{e.switchMode("xg",2),e.setPortMode(e.getTrackPort(o),1,$.xg),console.debug("Yamaha CS1x set to XG mode.");break}case 3:{e.switchMode("cs1x",2),e.setPortMode(e.getTrackPort(o),1,$.cs1x),console.debug("Yamaha CS1x set to performance mode.");break}default:console.warn(`Unknown Yamaha CS1x mode: ${n}`)}},()=>{}][c]||(()=>{}))()})}).add([75,96,0],(t,o,l)=>{let s=t[0],n=!1,i=e.modelEx.cs1x.perfCh;t.subarray(1).forEach((c,f)=>{let h=f+s;h<8?(n=!0,a(e,ye)[i]=1,e.setChCvnRegister(i,h,c)):h<48?([!1,()=>{e.setChCc(i,7,c)}][h]||(()=>{}))():h<80?([()=>{e.setEffectTypeRaw(0,!1,c)},()=>{e.setEffectTypeRaw(0,!0,c),e.pushEffectType(0)},()=>{e.setEffectTypeRaw(1,!1,c)},()=>{e.setEffectTypeRaw(1,!0,c),e.pushEffectType(1)},()=>{e.setEffectTypeRaw(2,!1,c)},()=>{e.setEffectTypeRaw(2,!0,c),e.pushEffectType(2)}][h-48]||(()=>{}))():L()&&console.debug(`Unknown CS1x effect register: ${h}.`)}),n&&(e.setChActive(i,1),e.pushChPrimitives(i))});let R=(t,o,l)=>{let s=0;l.forEach((n,i)=>{([()=>{s=(n&1)<<7|s&127,e.setEffectTypeRaw(t,!1,28),e.setEffectTypeRaw(t,!0,s)},()=>{s=s&128|n&127,e.setEffectTypeRaw(t,!1,28),e.setEffectTypeRaw(t,!0,s),e.pushEffectType(t)}][i+o]||(()=>{}))()})};a(e,Me).add([96,0,1],(t,o,l)=>{let s=t[0];switch(t[1]){case 0:{R(0,t[2],t.subarray(3)),console.debug(`Partially parsed KORG PA EFX SysEX:
`,t);break}case 1:{R(1,t[2],t.subarray(3)),console.debug(`Partially parsed KORG PA EFX SysEX:
`,t);break}case 2:{R(2,t[2],t.subarray(3)),console.debug(`Partially parsed KORG PA EFX SysEX:
`,t);break}case 3:{R(3,t[2],t.subarray(3)),console.debug(`Partially parsed KORG PA EFX SysEX:
`,t);break}default:console.debug(`Unparsed KORG PA SysEX:
`,t)}})}get lcdContrast(){return a(this,vt)}set lcdContrast(e){(e<0||e>=Ot.length)&&(e=Ot.length-1),x(this,vt,e),this.dispatchEvent("lcdcontrast",e)}get detect(){return structuredClone(a(this,U))}chRedir(e,r,d){let u=this;if(a(u,Xe)[r])return(a(u,Xe)[r]-1)*16+e;if(a(u,_)===$.sc||a(u,_)===$.sd){if(d===1)return e;for(let S=0;S<y.ch;S++)if(a(u,De)[S]===r)return S&112|e&15;let b=0,C=!0;for(;C;)a(u,De)[e+b]===0?(a(u,De)[e+b]=r,console.info(`Allocated track ${r} to channel ${e+b+1}.`),C=!1):a(this,De)[e+b]===r?C=!1:(b+=16,b>=128&&(b=0,C=!1));return e+b}else return e}getTrackPort(e){return this.chRedir(0,e,!0)>>4}forceVoiceRefresh(){for(let e=0;e<y.ch;e++)a(this,ue)[e]&&this.dispatchEvent("voice",{part:e})}buildRchTree(){let e=[];a(this,B).forEach((r,d)=>{var u;r<y.ch&&((u=e[r])!=null&&u.constructor||(e[r]=[]),e[r].push(d))}),x(this,Tt,e)}buildRccMap(){let e=this;for(let r=0;r<y.ch;r++)a(e,Je)[r]={};a(e,ze).forEach((r,d)=>{r&&(a(e,Je)[Math.floor(d/y.redir)][r]=d%y.redir|128)}),L()&&console.debug(a(e,Je))}invokeSysExIndicator(){this.dispatchEvent("mupromptex",a(this,bt))}getActive(){return a(this,ue)}getChActive(e){return a(this,ue)[e]}getCc(e){if(typeof e!="number"||e<0||e>=y.ch)throw new RangeError(`Invalid part number: CH${e+1}`);let r=this,d=G[e];return a(r,k).subarray(d,d+y.cc)}getChCc(e,r){let d=this;if(Fe.indexOf(r)<0)throw new Error("CC number not accepted");return a(d,k)[G[e]+v[r]]}getChCcWritten(e,r){let d=this;if(Fe.indexOf(r)<0)throw new Error("CC number not accepted");return a(d,k)[y.chcc+G[e]+v[r]]}setChCc(e=0,r,d){let u=this;if(Fe.indexOf(r)<0)throw new Error("CC number not accepted");if((d==null?void 0:d.constructor)!==Number)throw new TypeError("Expected numbers for value");let b=d&255,C=G[e]+v[r];a(u,k)[C]=b,a(u,k)[C+y.chcc]=1,u.dispatchEvent("cc",{part:e,cc:r,data:b})}getCcAll(){return a(this,k).slice()}resetCc(e){let r=this,d=G[e]+y.chcc;a(r,k).fill(0,d,d+y.cc)}resetChCc(e,r,d){let u=this;d!=null&&d.constructor&&u.setChCc(e,r,d),a(u,k)[G[e]+v[r]+y.chcc]=0}resetCcAll(){a(this,k).fill(0,y.chcc,y.chcc<<1)}isChCcWritten(e,r){if(Fe.indexOf(r)<0)throw new Error("CC number not accepted");return a(upThis,k)[G[e]+v[r]+y.chcc]}getChSource(){return a(this,B)}getChType(e=0){return a(this,D)[e]}getChTypes(){return a(this,D)}setChType(e,r,d=0,u=!1){r&=15;let b=this;d=d||b.getChModeId(e),a(b,D)[e]=r,r>0&&!u&&(b.setChCc(e,0,a(b,J)[d][2]),b.pushChPrimitives(e))}setChActive(e,r=0){a(this,ue)[e]!==r&&this.dispatchEvent("channeltoggle",{part:e,active:r}),a(this,ue)[e]=r}getExt(e){let r=y.ext*e,d=a(this,ne).subarray(r,r+y.ext),u=new Uint8Array(d.length);switch(u.set(d),u[0]){case this.EXT_VL:{u[1]=u[1]||this.modelEx.vl.breath;break}}return u}getProgram(){return a(this,N)}getTexts(){return a(this,be).slice()}getVel(e){let r=new Map,d=this;return a(d,Q).forEach(function(u,b){let C=u>>7,S=u&127;e===C&&a(d,Z)[u]>0&&r.set(S,{v:a(d,Z)[u],s:a(d,X)[b]})}),r}getBitmap(){return{bitmap:a(this,Le,ot),expire:a(this,ve)}}getLetter(){return{text:a(this,Ge),set:a(this,xt),expire:a(this,Be)}}getMode(){return z[a(this,_)]}getMaster(){return{volume:a(this,Y)}}getRpn(){return a(this,I)}getNrpn(){return a(this,lt)}getSubDb(){return self==null?void 0:self.structuredClone(a(this,J))}getDetect(){return self==null?void 0:self.structuredClone(a(this,U))}getVoice(e,r,d,u="?",b=0){var o;let C=this;(o=$[u])!=null&&o.constructor||(u="?");let S=$[u],w=e||a(C,J)[S][0],M=r,R=d||a(C,J)[S][1];w===$t.bank0&&(w=0),R===$t.bank0&&(R=0),u==="ns5r"&&w>0&&w<56&&(R=3);let t=C.userBank.get(w,M,R,u,b);if(u==="mt32"&&t.name.indexOf("MT-m:")===0){let l=parseInt(t.name.slice(5)),s=l*y.cmt,n="";a(C,_e).subarray(s,s+10).forEach(c=>{c>31&&(n+=String.fromCharCode(c))});let i=`MSB	LSB	PRG	NME
49	127	${M}	${n}`;C.userBank.load(i,!0),t.name=n,t.ending=" "}return(t.ending!==" "||!t.name.length)&&(t=C.baseBank.get(w,M,R,u,b)),t}getChPrimitive(e,r,d){if(r>=y.vxPrim||(r==null?void 0:r.constructor)!==Number)throw new RangeError(`Invalid voice primitive component "${r}"`);if(typeof e!="number"||e<0||e>=y.ch)throw new RangeError(`Invalid part number: CH${e+1}`);let u=this,b=a(u,N)[r<<y.chShift|e];switch(r){case 1:case 2:{u.getChCcWritten(e,[255,0,32][r])||(b=b||a(u,J)[u.getChModeId(e)][r+2]),d&&(b=b||a(u,J)[u.getChModeId(e)][r-1]),b===$t.bank0&&(b=0);break}}return b}getChPrimitives(e,r){let d=this,u=new Uint8Array(3);return u[1]=a(d,N)[e],u[0]=d.getChPrimitive(e,1,r),u[2]=d.getChPrimitive(e,2,r),u}pushChPrimitives(e){let r=this;a(r,N)[1<<y.chShift|e]=r.getChCc(e,0),a(r,N)[2<<y.chShift|e]=r.getChCc(e,32),r.dispatchEvent("voice",{part:e})}getChCvnBuffer(e,r=y.cvn){if(r>y.cvn||r<1)throw new RangeError("Invalid custom voice name buffer length");let d=ct[e];return a(this,qe).subarray(d,d+r)}getChCvnRegister(e,r){if(r>=y.cvn||r<0)throw new RangeError("Invalid custom voice name register");return a(this,qe)[ct[e]+r]}setChCvnRegister(e,r,d=32){if(r>=y.cvn||r<0)throw new RangeError("Invalid custom voice name register");a(this,dt)[e]=1,a(this,qe)[ct[e]+r]=Math.max(32,d&255)}resetChCvn(e){a(this,qe).fill(32,ct[e],ct[e]+y.cvn),a(this,dt)[e]=0}getChCvnString(e,r){let d=Va.decode(this.getChCvnBuffer(e));return r||(d=d.trimEnd()),d}getChCvnIsWritten(e){return a(this,dt)[e]}getChVoice(e){var u,b;let r=this,d=r.getVoice(...r.getChPrimitives(e),r.getChMode(e),(b=(u=r.modelEx[r.getChMode(e)])==null?void 0:u.map)!=null?b:0);if(a(r,ye)[e]){let C="";switch(a(r,_)){case $.mt32:{a(r,Te).subarray(y.cmt*(e-1),y.cmt*(e-1)+10).forEach(S=>{C+=String.fromCharCode(Math.max(S,32))}),C=C.trimEnd();break}default:C=r.getChCvnString(e)}C.length&&(d.ending="~",d.name=C)}return d}getRawPitch(){return a(this,Ne)}getPitchShift(e){let r=this,d=e*y.rpn,u=a(r,I)[d];return a(r,H)[e*y.rpnt]?u>>7&&(u-=256):a(r,_)===$.mt32&&(u=12),a(r,Ne)[e]/8192*u+(a(r,I)[d+3]-64)+((a(r,I)[d+1]<<7)+a(r,I)[d+2]-8192)/8192}getEffectType(e=0){let r=3*e+1;return a(this,pe).subarray(r,r+2)}getPolyState(e=0){return a(this,X)[e]}setEffectTypeRaw(e=0,r,d){let u=3*e;a(this,pe)[u]=1,a(this,pe)[u+1+ +r]=d}setEffectType(e=0,r,d){this.setEffectTypeRaw(e,!1,r),this.setEffectTypeRaw(e,!0,d)}pushEffectType(e=0,r=!1){if(e<0||e>=y.efx)throw new RangeError(`Invalid EFX slot ${e}`);let d=this.getEffectType(e);r||d[0]===0&&d[1]>>4===15&&(r=!0),this.dispatchEvent(`efx${ma[e]}`,{id:d,hidden:r})}getEffectSink(){return a(this,Ye)}getChEffectSink(e){return a(this,Ye)[e]}setChEffectSink(e,r=0){let d=this;if(r<0||r>=y.efx)throw new RangeError(`Invalid EFX slot ${r}`);if(e<0||e>=y.ch)throw new RangeError(`Invalid CH${e+1}`);a(this,Ye)[e]=r,this.dispatchEvent("partefxtoggle",{part:e,active:r})}setXgChEffectSink(e,r=0){let d=this,u=d.modelEx.xg,b=r-2;if(r<0||b>=u.insPart.length)throw new RangeError(`Invalid XG insertion slot ${b}`);let C=u.insPart[b];u.insPart[b]=e,C!==y.invalidCh&&d.setChEffectSink(C,0),e===y.invalidCh?C!==y.invalidCh&&d.setChEffectSink(C,0):d.setChEffectSink(e,r)}setLetterDisplay(e,r,d=0,u=3200){let b=this,C;x(b,Ge," ".repeat(d)),e.forEach(S=>{x(b,Ge,a(b,Ge)+String.fromCharCode(S>31?S:32)),S<32&&(C=C||new Set,C.add(S))}),x(b,xt,b.clockSource.now()),x(b,Be,b.clockSource.now()+u),b.dispatchEvent("letter"),C&&(C=Array.from(C),C.forEach((S,w,M)=>{M[w]=S.toString(16).padStart(2,"0")}),console.warn(`${r}${r?" ":""}invalid code point${C.length>1?"s":""}: 0x${C.join(", 0x")}`))}setDetectionTargets(e="?",r=0){let d=this,u=-1;switch(e.replaceAll(", ",",").split(",").forEach(b=>{b=b.toLowerCase();let C=z.indexOf(Na[b]||b);L()&&console.debug(`Mapped mode "${b}" to ID "${C}".`),C>-1&&(u=C)}),L()&&console.debug(`Set detection target to ID "${u}".`),u>0&&(a(d,U).x5=82,a(d,U).ds=$.krs,a(d,U).gm=$.gm,a(d,U).g2=$.g2),u){case $["05rw"]:{a(d,U).x5=81;break}case $.s90es:{a(d,U).ds=$.s90es,a(d,U).smotif=$.s90es;break}case $.motif:{a(d,U).ds=$.motif,a(d,U).smotif=$.motif;break}case $.sd:{a(d,U).g2=$.sd;break}case $.pa:{a(d,U).g2=$.pa;break}}}setGsTargets(e=!1,r=4){if(!r)r=e?3:4;else{if(r>4||r<0)throw new Error(`Invalid GS level ${r}`);if(e&&r>>1!==1)throw new Error(`Invalid SC level ${r}`)}let d=this;a(d,U)[e?"sc":"gs"]=r,a(d,J)[$[e?"sc":"gs"]][1]=r,d.forceVoiceRefresh()}getConfigs(){return a(this,St)}setDumpLimit(e){if(e>2||e<0)throw new RangeError("Invalid dump limit.");a(this,Oe).dumpLimit=e}allocateAce(e=0,r){let d=this;if(!r||r<128&&r>95){console.warn(`cc${r} cannot be allocated as an active custom effect.`);return}let u=!0,b=0,C=y.ace*e;for(;u&&b<y.ace;)a(d,re)[b+C]===r?u=!1:a(d,re)[b+C]||(u=!1,a(d,re)[b+C]=r,console.debug(`Allocated cc${r} to ACE slot ${b} in CH${e+1}.`)),b++;b>=y.ace&&console.warn(`ACE slots are full in CH${e+1}.`)}allocateAceAll(e){let r=this;if(!e||e<128&&e>95){console.warn(`cc${e} cannot be allocated as an active custom effect.`);return}for(let d=0;d<y.ch;d++){let u=!0,b=0,C=y.ace*d;for(;u&&b<y.ace;)a(r,re)[b+C]===e?u=!1:a(r,re)[b+C]||(u=!1,a(r,re)[b+C]=e),b++;b>=y.ace&&console.warn(`ACE slots are full in CH${d+1}.`)}}resetAce(){a(this,re).fill(0),console.info("All ACE slots have been reset.")}resetChAceAll(e=0){a(this,re).subarray(Lt[e],Lt[e]+y.ace).fill(0)}resetChAce(e=0,r){let d=!0,u=Lt[e],b=u+y.ace;for(;d&&u<b;)a(this,re)[u]===r&&(a(this,re)[u]=0,d=!1),u++;d&&L()&&console.debug(`No ACE slot was allocated to cc${r} in CH${e+1}.`)}getAce(){return a(this,re)}getChAce(e=0,r=0){if(r<0||r>=y.ace)throw new RangeError("No such ACE slot");let d=a(this,re)[y.ace*e+r];if(d){if(Fe.indexOf(d)>=0)return this.getChCc(e,d);throw new Error(`Invalid ACE source in CH${e+1}: ${d}`)}else return 0}initDrums(){let e=this;a(e,oe).fill(64);for(let r=0;r<y.drm;r++){let d=r*y.dpn;for(let u in Ea){let b=Ea[u],C=(d+ke[u])*y.dnc;a(e,oe).subarray(C,C+y.dnc).fill(b)}}}init(e=0){let r=this;x(r,Qe,0),a(r,J)[$.xg][1]=0,r.modelEx.xg.map=0,r.dispatchEvent("banklevel",{mode:"xg",data:r.modelEx.xg.map}),a(r,ue).fill(0),a(r,k).fill(0),a(r,re).fill(0),a(r,N).fill(0),a(r,Z).fill(0),a(r,Q).fill(0),a(r,X).fill(0),a(r,ie).fill(0),a(r,Ae).fill(0),a(r,Ne).fill(0),a(r,lt).fill(0),a(r,H).fill(0),a(r,ne).fill(0),a(r,W).fill(0),a(r,ht).fill(0),a(r,We).fill(0),a(r,ze).fill(0),x(r,Y,100),x(r,be,[]),x(r,ut,500),r.modelEx.sg.convLastSyll=0,r.modelEx.sg.runLineLen=0,r.modelEx.sg.splitMask=!1,x(r,ve,0),x(r,se,0),r.lcdContrast=16,r.lcdHideBankInfo=!1;for(let d=0;d<a(r,Se).length;d++)a(r,Le,ot).fill(0);x(r,K,r.KARAOKE_NONE),x(r,pt,0),x(r,ge,!0),x(r,q,!1),x(r,bt,0),r.initDrums(),r.polyIndexLatest=0,r.polyIndexLast=0,a(r,B).forEach(function(d,u,b){b[u]=u}),e===0&&(r.dispatchEvent("mode","?"),x(r,_,0),a(r,De).fill(0),a(r,Xe).fill(0),x(r,Be,0),x(r,Ge,"")),_a.forEach(d=>{r.setChCc(d,0,a(r,J)[r.getChModeId(d)][2])}),a(r,D).fill(r.CH_MELODIC),a(r,D)[9]=r.CH_DRUM1,a(r,D)[25]=r.CH_DRUM3,a(r,D)[41]=r.CH_DRUMS,a(r,D)[57]=r.CH_DRUMS,a(r,D)[73]=r.CH_DRUM5,a(r,D)[89]=r.CH_DRUM7,a(r,D)[105]=r.CH_DRUMS,a(r,D)[121]=r.CH_DRUMS;for(let d=0;d<y.drm;d++)a(r,xe)[d<<1]=0,a(r,xe)[d<<1|1]=y.invalidCh;a(r,ft).fill(0),a(r,_e).fill(0),a(r,He).fill(0),a(r,Te).fill(0),a(r,ye).fill(0),a(r,pe).fill(0),a(r,Ye).fill(0),r.aiEfxName="",r.userBank.clearRange({msb:0,lsb:127,prg:[0,127]}),r.modelEx.xg.varSys=!1,r.modelEx.xg.insPart.fill(y.invalidCh);for(let d=0;d<we.length;d++){let u=r.modelEx.yPlg[d];u.fill(0,0,we[d][2]),u.fill(y.invalidCh,we[d][2])}r.modelEx.sc.showBar=!0,r.modelEx.sc.invBar=!1,r.modelEx.sc.invDisp=!1,r.modelEx.sc.peakHold=1,r.modelEx.cs1x.perfCh=0;for(let d=0;d<y.ch;d++){r.resetChCvn(d);let u=G[d];a(r,k)[u+v[7]]=100,a(r,k)[u+v[11]]=127,a(r,k)[u+v[2]]=127,a(r,k)[u+v[10]]=64,a(r,k).subarray(u+v[71],u+v[71]+8).fill(64),a(r,k)[u+v[128]]=127,a(r,k).subarray(u+v[130],u+v[157]+1).fill(64),a(r,k)[u+v[91]]=40,a(r,k)[u+v[101]]=127,a(r,k)[u+v[100]]=127,a(r,k)[u+v[99]]=127,a(r,k)[u+v[98]]=127;let b=d*y.rpn;a(r,I)[b]=2,a(r,I)[b+1]=64,a(r,I)[b+2]=0,a(r,I)[b+3]=64,a(r,I)[b+4]=0,a(r,I)[b+5]=0;let C=d*y.ext;a(r,ne)[C+1]=r.VLBC_BRTHEXPR;let S=d*y.redir;a(r,ze)[S+8]=13}r.switchMode("?",3),r.buildRchTree(),r.buildRccMap(),r.dispatchEvent("mastervolume",a(r,Y));for(let d=0;d<ma.length;d++)r.pushEffectType(d);r.dispatchEvent("reset")}setChMode(e,r){let d=this;if(typeof e!="number"||e<0||e>=y.ch)throw new RangeError(`Invalid part number: CH${e+1}`);if(e<0||r>=z.length)throw new RangeError(`Invalid mode ID ${r}`);a(d,We)[e]=r,d.dispatchEvent("chmode",{part:e,id:r,mode:z[r]}),d.pushChPrimitives(e)}getChMode(e,r){return z[this.getChModeId(e,r)]}getChModeId(e,r){return r?a(this,We)[e]||a(this,W)[e>>4]:a(this,We)[e]||a(this,W)[e>>4]||a(this,_)}getPortMode(e,r){return z[this.getPortModeId(e,r)]}getPortModeId(e,r){return r?a(this,W)[e]:a(this,W)[e]||a(this,_)}setPortMode(e,r,d){let u=this;if(e<0||e>=y.ch>>4)throw new RangeError(`Invalid port ${e+1}`);if(r<1)throw new RangeError("Range must be a positive integer");if(e+r>=y.ch>>4)throw new RangeError("Range must be in bound");if(e<0||d>=z.length)throw new RangeError(`Invalid mode ID ${d}`);a(u,ht)[e]=d;for(let b=e;b<e+r;b++){let C=a(u,ht)[b];if(r>1&&C!==0&&C!==d)break;a(u,W)[b]=d;for(let S=b<<4;S<b+1<<4;S++)u.dispatchEvent("chmode",{part:S,id:d,mode:z[d]}),u.pushChPrimitives(S)}}copyChSetup(e,r,d){if(e===r){console.warn(`Failed attempt at overwriting CH${e+1} with its own data.`);return}let u=this;if(d&&a(u,ue)[r]){console.warn(`Failed attempt at copying setup data from CH${e+1} to CH${r+1}.`);return}let b=G[e],C=G[r];a(u,N)[r]=a(u,N)[e],a(u,k).set(a(u,k).subarray(b,b+y.cc),C),u.pushChPrimitives(r)}setDrumFirstWrite(e,r){let d=this,u=a(d,D)[e];if(u<2)return;let b=u-2;if(a(d,xe)[b<<1])if(r)a(d,xe)[b<<1]=0,L()&&console.debug(`First write part for drum set ${b+1} has been reset.`);else return;else r?console.warn(`First write part for drum set ${b+1} is already blank.`):(a(d,xe)[b<<1]=1,a(d,xe)[b<<1|1]=e,console.debug(`First write part for drum set ${b+1} is set to CH${e+1}.`))}getChDrumFirstWrite(e){let r=this,d=a(r,D)[e];if(d<2)return;let u=d-2;return a(r,xe).subarray(u<<1,u+1<<1)}getDrumFirstWrite(e){if(e>=0&&e<y.drm)return a(this,xe).subarray(e<<1,e+1<<1)}switchMode(e,r=0,d=!1){L()&&console.debug(`Requested level ${r} mode change to "${e}".`);let u=this,b=$[e];if(b>-1){if(a(u,_)===0&&r!==3||r){if(u.initOnReset)switch(r){case 1:{a(u,_)===0&&u.init(1);break}case 2:{u.init(1);break}}switch(x(u,se,0),b){case $.gm:{b=a(u,U).gm;break}case $.g2:{b=a(u,U).g2;break}}switch(x(u,_,b),b){case $.gs:case $.sc:{a(u,J)[$[e]][1]=a(u,U)[e];break}}for(let w=0;w<y.ch;w++){let M=u.getChModeId(w,!0);a(u,D)[w]>0&&M===$["?"]&&(u.setChCc(w,0,a(u,J)[b][2]),L()&&console.debug(`CH${w+1} (${a(u,D)[w]}) (${u.getChMode(w)}), ${z[M]} (${a(u,J)[M][2]}) -> ${z[b]} (${a(u,J)[b][2]})`),u.pushChPrimitives(w))}switch(b){case $.mt32:{Xt.forEach((w,M)=>{let R=M+1;a(u,ue)[R]||(a(u,N)[R]=w,u.setChCc(R,91,127),u.pushChPrimitives(R))});for(let w=1;w<10;w++)u.pushChPrimitives(w);break}}let C,S;switch(b){case $["?"]:case $.g2:{C=[52,4,52,18,0,255,0,255,0,255,0,255,0,255,0,255];break}case $.xg:case $.cs1x:{C=[1,0,65,0,5,0,64,0,64,0,64,0,64,0,0,255],S=[64,0];break}case $.gm:case $.gs:case $.sc:{C=[40,4,40,18,40,32,32,0,0,255,0,255,0,255,0,255],S=[32,0];break}case $.sd:{C=[58,0,60,0,61,0,61,0],S=[61,0];break}case $["05rw"]:case $.x5d:case $.ns5r:{C=[44,1,44,19,0,255,0,255,0,255,0,255,0,255,0,255];break}case $.k11:case $.sg:{C=[24,0,0,255,0,255,0,255,0,255,0,255,0,255,0,255];break}case $.mt32:{C=[40,4,0,255,0,255,0,255,0,255,0,255,0,255,0,255];break}case $.doc:{C=[24,16,0,255,0,255,0,255,0,255,0,255,0,255,0,255];break}case $.motif:case $.s90es:case $.cs6x:{C=[129,0,133,0,130,0,128,0,128,0,0,255,0,255,0,255],S=[128,0];break}case $.pa:{C=[28,52,28,16,28,0,28,0,0,255,0,255,0,255,0,255],S=[28,0];break}case $.krs:{C=[45,0,45,0,0,255,45,0,45,0,45,0,45,0,45,0],S=[45,0];break}default:C=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}for(let w=0;w<y.efx;w++)if(!a(u,pe)[3*w]&&typeof C[w<<1]=="number"){a(u,pe)[3*w+1]=C[w<<1],a(u,pe)[3*w+2]=C[w<<1|1];let M=!1;(S==null?void 0:S.length)>0&&C[w<<1]===S[0]&&C[w<<1|1]===S[1]&&(M=!0),u.pushEffectType(w,M)}d&&u.setDetectionTargets(e),u.dispatchEvent("mode",z[b]),u.forceVoiceRefresh()}}else throw new Error(`Unknown mode ${e}`)}getRawStrength(){let e=this;return a(this,Q).forEach(function(r){let d=r>>7;a(e,Z)[r]>a(e,Ae)[d]&&(a(e,Ae)[d]=a(e,Z)[r])}),a(this,Ae)}getStrength(){let e=[],r=this;return this.getRawStrength().forEach(function(d,u){e[u]=Math.floor(d*r.getChCc(u,7)*r.getChCc(u,11)*a(r,Y)/803288)}),e}newStrength(){a(this,Ae).fill(0)}runJson(e){var r;if(e==null){console.warn(new Error("Invalid JSON data provided."));return}if(e.type>14)return e.type===15&&e.data.constructor!==Uint8Array&&(e.data=Uint8Array.from(e.data)),a(this,Mt)[e.type].call(this,e);{let d=this.chRedir(e.part,e.track),u=!1;(r=a(this,Tt)[d])==null||r.forEach(b=>{e.channel=b,u=!0,a(this,Mt)[e.type].call(this,e)}),u||console.warn(`${ba[e.type]?ba[e.type]:e.type}${[11,12].includes(e.type)?(e.data[0]!==void 0?e.data[0]:e.data).toString():""} event sent to CH${d+1} without any recipient.`)}a(this,be).length>100&&a(this,be).splice(100,a(this,be).length-99)}runRaw(e){}async loadBank(e,r){let d=this;switch(e=e.toLowerCase(),e){case"s7e":{d.userBank.clearRange({msb:63,lsb:[21,22]}),d.userBank.clearRange({msb:63,lsb:[24,27]});break}case"pcg":{d.userBank.clearRange({msb:63,lsb:[6,9]}),d.userBank.clearRange({msb:63,lsb:[13,16]});break}default:throw new Error(`Unknown bank format ${e}`)}switch(e){case"s7e":case"pcg":{gt.context=this,await d.userBank.load(await gt.read(e,r),!1);break}}d.forceVoiceRefresh()}},_=new WeakMap,se=new WeakMap,ve=new WeakMap,Se=new WeakMap,Le=new WeakSet,ot=function(){return a(this,Se)[a(this,se)]},qa=function(e){a(this,Se)[a(this,se)]=e},vt=new WeakMap,ue=new WeakMap,B=new WeakMap,D=new WeakMap,k=new WeakMap,re=new WeakMap,N=new WeakMap,Z=new WeakMap,ie=new WeakMap,Q=new WeakMap,X=new WeakMap,Ne=new WeakMap,Ae=new WeakMap,Ve=new WeakMap,ne=new WeakMap,I=new WeakMap,H=new WeakMap,lt=new WeakMap,oe=new WeakMap,xe=new WeakMap,pe=new WeakMap,Ye=new WeakMap,ze=new WeakMap,W=new WeakMap,ht=new WeakMap,We=new WeakMap,ye=new WeakMap,qe=new WeakMap,dt=new WeakMap,He=new WeakMap,Te=new WeakMap,ft=new WeakMap,_e=new WeakMap,J=new WeakMap,U=new WeakMap,Oe=new WeakMap,St=new WeakMap,Y=new WeakMap,Qe=new WeakMap,ut=new WeakMap,Vt=new WeakMap,Yt=new WeakMap,zt=new WeakMap,Wt=new WeakMap,Ge=new WeakMap,Be=new WeakMap,xt=new WeakMap,pt=new WeakMap,ge=new WeakMap,K=new WeakMap,Tt=new WeakMap,q=new WeakMap,bt=new WeakMap,Je=new WeakMap,be=new WeakMap,De=new WeakMap,Xe=new WeakMap,ce=new WeakMap,Ze=new WeakMap,j=new WeakMap,Mt=new WeakMap,It=new WeakMap,je=new WeakMap,et=new WeakMap,te=new WeakMap,Ee=new WeakMap,Me=new WeakMap,tt=new WeakMap,at=new WeakMap,rt=new WeakMap,$a);export{Qr as OctaviaDevice,Wa as TimeMuxer,y as allocated,v as ccBufferOffset,ke as dnToPos,ma as effectSlots,L as getDebugState,$t as overrides};
