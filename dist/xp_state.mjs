var Zt=Object.defineProperty;var jt=(b,e,a)=>e in b?Zt(b,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):b[e]=a;var P=(b,e,a)=>(jt(b,typeof e!="symbol"?e+"":e,a),a),xt=(b,e,a)=>{if(!e.has(b))throw TypeError("Cannot "+a)};var t=(b,e,a)=>(xt(b,e,"read from private field"),a?a.call(b):e.get(b)),S=(b,e,a)=>{if(e.has(b))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(b):e.set(b,a)},x=(b,e,a,f)=>(xt(b,e,"write to private field"),f?f.call(b,a):e.set(b,a),a);(function(){var b=function(C,k,r){var l,n;if(self.MessageEvent)switch(C){case"message":{n=new MessageEvent(C,{data:k,ports:r==null?void 0:r.ports}),Object.defineProperty(n,"source",{value:r==null?void 0:r.source});break}default:n=new Event(C)}else n=document.createEvent("Event"),n.initEvent(C,!1,!1),r&&C=="message"&&(n.data=k,r.source&&Object.defineProperty(n,"source",{value:r.source}),(l=r.ports)!=null&&l.length&&Object.defineProperty(n,"ports",{value:r.ports}));return n};self.BroadcastChannel?console.info("[Snowy] Snowy is disabled."):(console.info("[Snowy] Snowy is enabled. Path: ".concat(self.SNOWY_PATH||"/snowy.js")),a=[],f={},u=function(C){var k,r=this;if((this==null?void 0:this.constructor)!=u)throw new TypeError("Illegal constructor");a.push(this),(k=f[C])!=null&&k.constructor||(f[C]=[]),f[C].push(this);var l=Math.floor(Math.random()*281474976710656),n=[],s=0,i=[],o=!0,c=!1;Object.defineProperty(this,"id",{get:function(){return l}}),Object.defineProperty(this,"name",{value:C}),this.close=function(){var h,E=a.indexOf(r);E>-1?(e.postMessage({t:"d",c:C,i:l}),a.splice(E,1),(h=f[C])!=null&&h.constructor&&(E=f[C].indexOf(r),E>-1&&f[C].splice(E,1)),f[C].length||delete f[C],console.debug("[Snowy] BroadcastChannel closed."),c=!0):console.debug("[Snowy] BroadcastChannel already closed.")},this.postMessage=function(h){if(e){if(c)throw new Error("Channel already closed");e.postMessage({t:"m",c:C,i:l,m:s,d:h}),s++,s>4294967295&&(s=0)}else i.push(h),console.debug("[Snowy] Message is cached.")},this.flush=function(){if(e){if(o){for(e.postMessage({t:"r",c:C,i:l}),console.debug("[Snowy] ".concat(i.length," message(s) in cache."));i.length;){var h=i.shift();r.postMessage(h)}o=!1,console.debug("[Snowy] All cached messages are flushed away.")}}else throw new Error("Tried to flush when the ports are not ready")},this.receiveMessage=function(h){h.c==C?h.i!=l&&r.dispatchEvent(b("message",h.d,{source:r})):console.debug("[Snowy] Channel ID mismatch. Instance ".concat(l," receives from ").concat(C,", not ").concat(h.c,"."))};var d={};this.dispatchEvent=function(h){var E,y;if(Object.defineProperty(h,"target",{value:r}),Object.defineProperty(h,"currentTarget",{value:r}),(E=d[h.type])!=null&&E.length)for(var T=d[h.type],A=0;A<T.length;A++)((y=T[A])==null?void 0:y.constructor)==Function&&T[A].call(r,h);r["on".concat(h.type)]&&r["on".concat(h.type)].constructor==Function&&r["on".concat(h.type)].call(r,h)},this.addEventListener=function(h,E){var y;(y=d[h])!=null&&y.constructor||(d[h]=[]);var T=d[h].indexOf(E);T==-1&&d[h].push(E)},this.removeEventListener=function(h,E){var y,T;if((y=d[h])!=null&&y.length){var A=d[h].indexOf(E);A>-1&&d[h].splice(A,1)}!((T=d[h])!=null&&T.length)&&d[h].constructor&&delete d[h]}},self.BroadcastChannel=u,p=function(){if(e){e.addEventListener("message",function(k){var r=k.data,l=!1;switch(r.t){case"k":{l=!1,e.postMessage({t:"k"});break}case"m":{var n=f[r.c];if(n!=null&&n.length)for(var s=0;s<n.length;s++)n[s].receiveMessage(r);break}case"c":{for(var i=[],o=0;o<a.length;o++){var c=a[o].name;i.indexOf(c)<0&&i.push(c)}e.postMessage({t:"k",c:i});break}default:l=!0}l&&console.info("ReceiveBroadcast",r)});for(var C=0;C<a.length;C++)a[C].flush()}else throw new Error("Message port isn't yet ready");console.info("[Snowy] Snowy is active.")},$=function(){if(!e){var C=new SharedWorker(self.SNOWY_PATH||"/snowy.js");C.port.start();var k=function(r){r.data.t=="swc"&&(C.port.removeEventListener("message",k),e=C.port,e.postMessage({t:"k"}),p())};C.port.addEventListener("message",k)}},$());var e,a,f,u,p,$})();{let b=function(e,a){let f=new FileReader;return new Promise((u,p)=>{switch(f.addEventListener("abort",()=>{p(new Error("Blob read aborted"))}),f.addEventListener("error",$=>{p(f.error||$.data||new Error("Blob read error"))}),f.addEventListener("load",()=>{u(f.result)}),a.toLowerCase()){case"arraybuffer":case"buffer":{f.readAsArrayBuffer(e);break}case"string":case"text":{f.readAsText(e);break}default:p(new Error(`Unknown target ${a}`))}})};Blob.prototype.arrayBuffer=Blob.prototype.arrayBuffer||function(){return b(this,"buffer")},Blob.prototype.text=Blob.prototype.text||function(){return b(this,"text")}}String.prototype.replaceAll=String.prototype.replaceAll||function(b,e){let a=0,f=16,u=this,p=[];for(;a<f&&u.lastIndexOf(b)>-1;){let $=u.lastIndexOf(b);p.unshift(u.slice($+b.length)),u=u.slice(0,$),$==0&&p.unshift(""),a++}return u.length&&p.unshift(u),p.join(e)||""},String.prototype.padStart=String.prototype.padStart||function(b,e){if(e){let a=this;for(;a.length<b;)a=`${e}${a}`;return a}},String.prototype.padEnd=String.prototype.padEnd||function(b,e){if(e){let a=this;for(;a.length<b;)a+=e;return a}};var St=function(b,e){let a=Math.min(b.length,e.length),f=b.slice(0,a),u=e.slice(0,a),p=0,$=0;for(;$<a&&p==0;)p=Math.sign(f[$]-u[$]),$++;return p},de=function(b=""){this.name=b,this.pool=[],this.point=function(e,a=!1){if(this.pool.length>0){let f=this.pool.length,u=1<<Math.floor(Math.log2(f)),p=u,$=64;for(;u>=1&&$>=0;){if($<=0)throw new Error("TTL reached.");if(p==f)p-=u;else{let k=St(e,this.pool[p]);switch(k){case 0:{$=0;break}case 1:{p+u<=f&&(p+=u);break}case-1:{p!=0&&(p-=u);break}default:console.warn(`Unexpected result ${k}.`)}}u=u>>1,$--}let C=!0;if(p>=this.pool.length)C=!1;else{let k=this;this.pool[p].forEach(function(r,l,n){C&&r!=e[l]&&(C=!1)}),!C&&St(e,this.pool[p])>0&&p++}return C||a?p:-1}else return a?0:-1},this.add=function(e,a){return e.data=a,this.pool.splice(this.point(e,!0),0,e),this},this.default=function(e){console.warn(`No match in "${this.name||"(unknown)"}" for "${e}". Default action not defined.`)},this.get=function(e){let a=this.point(e);if(a>-1)return this.pool[a].data;this.default(e)},this.run=function(e,...a){let f=this.point(e);f>-1?e.subarray?this.pool[f].data(e.subarray(this.pool[f].length),...a):this.pool[f].data(e.slice(this.pool[f].length),...a):this.default(e,...a)}};var te,Tt,Mt=(Tt=class{constructor(){S(this,te,{})}addEventListener(b,e){t(this,te)[b]||(t(this,te)[b]=[]),t(this,te)[b].unshift(e)}removeEventListener(b,e){if(t(this,te)[b]){let a=t(this,te)[b].indexOf(e);a>-1&&t(this,te)[b].splice(a,1),t(this,te)[b].length<1&&delete t(this,te)[b]}}dispatchEvent(b,e){var u;let a=new Event(b),f=this;a.data=e,((u=t(this,te)[b])==null?void 0:u.length)>0&&t(this,te)[b].forEach(function(p){try{p==null||p.call(f,a)}catch($){console.error($)}}),this[`on${b}`]&&this[`on${b}`](a)}},te=new WeakMap,Tt);var er=["MSB","PRG","LSB","NME","ELC","DRM","LVL"],tr={krs:"KR",s90es:"ES",motif:"ES"},rr={krs:"Kr",s90es:"SE",motif:"ME"},Et=function(b){let e=Math.floor(b/10),a=b%10;return`${e.toString(16)}${a}`},Y,Pt,yt=(Pt=class{constructor(...b){S(this,Y,void 0);P(this,"strictMode",!1);this.loadFiles(...b)}get bankInfo(){return t(this,Y)}get(b=0,e=0,a=0,f,u=0){var T,A;let p=[b,e,a],$,C=1,k=0,r,l,n=Array.from(arguments);switch(f){case"xg":{switch(b){case 0:{a==126?n[2]=125:a==127&&(n[2]=0);break}case 16:{a==126&&(n[2]=0);break}case 32:{a>125&&(n[2]=0),n[2]+=4;break}case 33:{(a>125||a==3)&&(n[2]=0),n[2]+=5;break}case 34:case 35:case 36:{a>125&&(n[2]=0),n[2]+=5;break}case 79:case 80:case 81:case 82:case 83:case 84:n[0]+=16;case 95:case 96:case 97:case 98:case 99:case 100:{a==126&&(n[2]=0);break}case 48:case 64:case 126:case 127:{a==126&&(b==127&&e==0||(n[2]=0));break}}break}case"gs":case"sc":{b==0&&a<5?n[0]=49:b>125&&a<5&&a!=2&&(n[2]=b,n[0]=49);break}case"mt32":{b==0&&(n[0]=49);break}case"sd":{switch(b){case 121:{n[0]=96;break}case 120:{n[0]=104;break}}n[0]>>1==40?n[2]|=16:n[0]>95&&n[0]<100&&(n[2]|=16,e>>4==7&&(n[0]=96));break}case"g2":{b>>1==40?n[2]|=16:b>95&&b<100&&(n[2]|=16,e>>4==7&&(n[0]=96));break}case"sg":{b==8&&a==0&&(n[2]=5);break}case"05rw":case"x5d":{b&&b<56&&(n[0]=56);break}case"s90es":{if(b==0)break;a<8?n[2]+=17:a<32?n[2]+=13:n[2]=(n[2]>>3)+19;break}case"motif":{if(b==0)break;a<8?n[2]+=28:a<32?n[2]+=13:n[2]=(n[2]>>3)+19;break}}let s=" ",i="M",o="",c=0,d=0;switch(n[0]){case 0:{switch(n[2]){case 127:{i="GM-a";break}case 126:{i="GM-n";break}case 7:{i="GM-k",o="GLX";break}case 5:{i="SG-a",o="000";break}case 4:{f=="gs"||f=="sc"?(i="GM-a",o="000"):(i="SP-l",o="C/M");break}case 3:case 2:case 1:{(f=="gs"||f=="sc")&&(i="GM-a",o="000");break}case 0:{i="GM-a";break}default:i="y",c=3}break}case 8:{f=="sg"?i="GM-s":i="r:";break}case 32:case 33:case 34:case 35:case 36:{f=="xg"&&(i=`${["AP","VL","PF","DX","AN"][b&7]}-${"abcdefgh"[a]}`,c=3);break}case 48:{o=`M${(n[2]>>3).toString().padStart(2,"0")}`,i=`y${o}`,c=1;break}case 49:{n[2]>>1==63?(i=`MT-${"ba"[n[2]&1]}`,o=`C${"-/"[n[2]&1]}M`):(i="GM-a",o="000");break}case 56:{i="GM-b";break}case 57:i=["yDOC","QY10","QY20"][n[2]-112]||"yMxv",o=["DOC","QY1","QY2"][n[2]-112]||"057";case 61:case 120:{i="rDrm";break}case 62:{i="kDrm";break}case 63:{if(n[2]<17){let M=n[2];i=M<10?"kP:":"kC:",i+=M%10}else n[2]<34?i=["Pre1","Pre2","Pre3","Pre4","Usr1","Usr2","DrmP","DrmU","Plg1","Plg2","Plg3","Pre1","Pre2","Pre3","Pre4","Pre5","Pre6"][n[2]-17]:i="Ds";c=1;break}case 64:{i="ySFX",o="SFX";break}case 67:{i="DX:S";break}case 80:case 81:case 82:case 83:{i=`Prg${"UABC"[n[0]-80]}`;break}case 88:case 89:case 90:case 91:{i=`Cmb${"UABC"[n[0]-88]}`;break}case 95:{i=`${["DR","PC"][n[2]]}-d`;break}case 96:{i=n[2]==106?"AP-a":n[2]>>4==1?"SDg":"PF",n[2]>63?d=63:n[2]>>4==1&&(d=16),c=3;break}case 97:{i=n[2]>>4==1?"SDa":"VL:",c=3,n[2]>>4==1?d=16:d=112;break}case 98:{i=n[2]>>4==1?"SDb":"SG-a",c=3,d=16;break}case 99:{i=n[2]>>4==1?"SDc":"DX",n[2]>63?d=63:n[2]>>4==1&&(d=16),c=3;break}case 100:{i="AN",n[2]>63?d=63:n[2]>>4==1&&(d=16),c=3;break}case 104:case 105:case 106:case 107:{i="SDd",d=104;break}case 121:{i=`GM-${n[2]?"":"a"}`,c=3;break}case 122:{i="lDrm";break}case 126:{i="yDrS";break}case 127:{n[2]==127?i="rDrm":i="yDrm";break}default:n[0]<48?i="r:":i="M"}i.length<4&&(i+=`${[b,a,n[0],n[2]][c]-d}`.padStart(4-i.length,"0")),o.length<3&&(o+=`${[b,a,b,a][c]}`.padStart(3-o.length,"0")),f=="xg"&&(b==0?n[2]<100?i=i.replace("y0","y:"):n[2]==125&&(i="y126"):b==16?($=`Voice${((n[2]<<7)+n[1]+1).toString().padStart(3,"0")}`,s=" "):b==35&&a>>1==2&&($=`DXCH_${(((n[2]&1)<<7)+e+1).toString().padStart(3,"0")}`,s=" "));let h=[n[0],n[1],n[2]];for(;!(($==null?void 0:$.length)>=0);)if($=(T=t(this,Y)[n[1]||0][(n[0]<<8)+n[2]])==null?void 0:T.name,$){let M=t(this,Y)[n[1]||0][(n[0]<<8)+n[2]];C=(M==null?void 0:M.poly)||C,k=(M==null?void 0:M.type)||k,r=M==null?void 0:M.drum,l=M==null?void 0:M.level}else if(this.strictMode)$="",s="?";else if(n[0]==0&&n[1]==0&&n[2]==0)$="Unloaded";else if(t(this,Y)[n[1]||0][n[0]<<8])n[0]==0?(n[2]=0,s="^"):n[2]<1?(n[0]=0,s="*"):(n[2]--,s="^");else if(b==48)n[0]=0,n[2]=0,s="!";else if(b==62)n[1]--,s=" ",n[1]<1&&!($!=null&&$.length)&&(n[0]=0,s="!");else if(b<63)n[0]==0?(n[2]=0,s="^"):n[2]<1?(n[0]=0,s="*"):n[2]--;else if(b==80)$=`PrgU:${e.toString().padStart(3,"0")}`,s="!";else if(b==88)$=`CmbU:${e.toString().padStart(3,"0")}`,s="!";else if(b==121)$=`GM2Vox0${a}`,s="#";else if(b==122)if(n[1]==32?n[1]==0:n[1]%=7,$=(A=t(this,Y)[n[1]||0][(n[0]<<8)+n[2]])==null?void 0:A.name,$){s=" ";let M=t(this,Y)[n[1]||0][(n[0]<<8)+n[2]];C=(M==null?void 0:M.poly)||C,k=(M==null?void 0:M.type)||k,r=M==null?void 0:M.drum,l=M==null?void 0:M.level}else $="",s="*";else n[1]==0?($=`${b.toString().padStart(3,"0")} ${e.toString().padStart(3,"0")} ${a.toString().padStart(3,"0")}`,s="!"):n[0]==0?(n[2]=0,s="^"):n[2]>0?n[2]--:n[1]>0?(n[1]=0,s="!"):(n[0]=0,s="?");let E=[n[0],n[1],n[2]];switch(s){case"^":{switch(f){case"gs":case"sc":case"ns5r":{s=" ";break}}b==127&&s=="^"&&(s=" ");break}}let y="??";switch(n[0]){case 0:{n[2]==0?y="GM":n[2]==5||n[2]==7?y="KG":n[2]<126&&(y="XG");break}case 32:case 33:case 35:case 36:{n[2]>4?y=["AP","VL","PF","DX","AN"][n[0]-32]:y="GS";break}case 48:{y="MU";break}case 49:{n[2]>>1==63?y="MT":n[2]<5&&(y="GM");break}case 56:{y="AG";break}case 61:case 80:case 83:case 88:case 89:case 91:{y="AI";break}case 62:case 82:case 90:{y="XD";break}case 63:{n[2]<17?y="KR":n[2]<34?y="ES":y="DS";break}case 64:case 126:{y="XG";break}case 67:case 99:{y=n[2]>>4==1?"SD":"DX";break}case 81:{y="RW";break}case 95:{y=["DR","PC"][n[2]];break}case 96:{y=n[2]==106?"AP":n[2]>>4==1?"SD":"PF";break}case 97:{y=n[2]>>4==1?"SD":"VL";break}case 98:{y=n[2]>>4==1?"SD":"SG";break}case 100:{y="AN";break}case 104:case 105:case 106:case 107:{y="SD";break}case 120:{y="GS";break}case 121:{y=n[2]?"G2":"GM";break}case 122:{y="KG";break}case 127:{y=n[2]==127?"MT":e==0?"GM":"XG";break}default:n[0]<48&&(n[0]==16&&f=="xg"?y="XG":y="GS")}if(s!=" ")switch(f){case"krs":case"s90es":case"motif":{$="",y=tr[f];break}default:self.debugMode&&($="")}return{name:$||`${rr[f]||f.toUpperCase()}${Et(b||0)}${Et(e||0)}${Et(a||0)}`,poly:C,type:k,drum:r,level:l,iid:h,eid:E,sid:p,ending:s,sect:i,bank:o,standard:y,mode:f}}async load(b,e,a="(internal)",f){let u=this,p=[],$=0,C=0,k=0;b.split(`
`).forEach(function(r,l){var i;let n=r.split("	"),s=[];if(l==0){if(n.forEach(function(o,c){p[er.indexOf(o)]=c}),p.length<4){console.debug("Debugger launched.");debugger}}else{let o=0,c=0,d=0,h,E=1,y=0,T,A;n.forEach(function(q,We){switch(We){case p[0]:{o=parseInt(q);break}case p[1]:{c=parseInt(q);break}case p[2]:{d=parseInt(q);break}case p[3]:{h=q;break}case p[4]:{q=parseInt(q),q<16?E=q+1:(y=(q&15)+1,E=y);break}case p[5]:{A=q;break}case p[6]:{q!=null&&q.constructor&&(T=parseInt(q));break}}}),t(u,Y)[c]=t(u,Y)[c]||[];let M=t(u,Y)[c],Me={msb:o,prg:c,lsb:d,name:h,poly:E,type:y,drum:A,level:T,priority:f},we=!1;f<((i=M[o<<8|d])==null?void 0:i.priority)&&(we=!0,k++),(!M[o<<8|d]||we||e)&&(M[o<<8|d]=Me,$++),C++}}),e||console.debug(`Map "${a}": ${C} total, ${$} loaded (${$-k} + ${k}).`)}clearRange(b){let e=b.prg!=null?b.prg.constructor==Array?b.prg:[b.prg,b.prg]:[0,127],a=b.msb!=null?b.msb.constructor==Array?b.msb:[b.msb,b.msb]:[0,127],f=b.lsb!=null?b.lsb.constructor==Array?b.lsb:[b.lsb,b.lsb]:[0,127];for(let u=a[0];u<=a[1];u++){let p=u<<8;for(let $=f[0];$<=f[1];$++){let C=p+$;for(let k=e[0];k<=e[1];k++)delete t(this,Y)[k][C]}}}init(){x(this,Y,[]);for(let b=0;b<128;b++)t(this,Y).push([""])}async loadFiles(...b){this.init();let e=this;b.forEach(async function(a,f){try{e.load(await(await fetch(`./data/bank/${a}.tsv`)).text(),!1,a,f)}catch(u){console.error(`Failed loading "${a}.tsv".`)}})}},Y=new WeakMap,Pt);var qe,Rt,Dt=(Rt=class{constructor(){S(this,qe,{});P(this,"context")}set(b,e){t(this,qe)[b]=e}has(b){return!!t(this,qe)[b]}async read(b,e){if(!this.has(b))throw new Error(`No decoder registered for "${b}"`);return await t(this,qe)[b].call(this.context||this,e)}},qe=new WeakMap,Rt);var ar=function(b,e){let a=!0;return e.forEach((f,u)=>{a=a&&b[u]==f}),a},rt=function(b){let e=0;return b.forEach(a=>{e*=256,e+=a}),e},ye=new TextDecoder,at=new Dt;at.set("s7e",async function(b){let e=new Uint8Array(await b.slice(0,65536).arrayBuffer()),a="MSB	LSB	PRG	NME",f=[0,0,0,0],u=32,p=0,$=0,C=!0,k=[],r=0;for(;C;){let l=e.subarray(p);([()=>{ye.decode(l.subarray(0,4))=="YSFC"?(p+=80,$=1):p++},()=>{if(ar(l.subarray(0,4),f))k.forEach((n,s,i)=>{let o=rt(e.subarray(n.start+4,n.start+8));n.length=o}),$=2;else{let n=ye.decode(l.subarray(0,4)),s=rt(l.subarray(4,8));k.push({type:n,start:s}),p+=8}},()=>{let n=k[r],s=e.subarray(n.start,n.start+n.length),i=32;switch(n.type){case"ENVC":{let o=u;for(;o<s.length;){let c=s.subarray(o,o+i),d=ye.decode(c.subarray(0,10)).trimEnd();d.slice(0,5)=="Init "&&(d=""),d&&(a+=`
063	${(c[17]+13).toString().padStart(3,"0")}	${c[19].toString().padStart(3,"0")}	${d}`),o+=i}break}case"EDVC":{let o=u;for(;o<s.length;){let c=s.subarray(o,o+i),d=ye.decode(c.subarray(0,10)).trimEnd();d.slice(0,5)=="Init "&&(d=""),d&&(a+=`
063	024	${c[19].toString().padStart(3,"0")}	${d}`),o+=i}break}case"EPVC":{let o=32,c=u;for(;c<s.length;){let d=s.subarray(c,c+o),h=ye.decode(d.subarray(0,10)).trimEnd();h=="----------"&&(h=""),h&&(a+=`
063	${(d[17]+1).toString().padStart(3,"0")}	${d[19].toString().padStart(3,"0")}	${h}`),c+=o}break}}r++,r>=k.length&&($=3,C=!1)}][$]||(()=>{C=!1}))()}return a});at.set("pcg",async function(b){let e=new Uint8Array(await b.arrayBuffer()),a="MSB	LSB	PRG	NME",f=100,u=0,p=0,$=!0,C=[],k=0;for(;$;){let r=e.subarray(f);([()=>{$=ye.decode(r.subarray(0,4))=="INI2",p=r[15],f+=16,u=1},()=>{let l=ye.decode(r.subarray(0,4)),n=r[5],s=r[7],i=r[11],o=rt(r.subarray(12,16)),c=rt(r.subarray(16,20)),d=rt(r.subarray(36,40)),h=ye.decode(r.subarray(44,44+i));C.push({type:l,tipMsb:n,tipLsb:s,nameLen:i,length:o,start:c,entryLen:d,name:h}),f+=64,p--,p<1&&(u=2)},()=>{let l=C[k],n=e.subarray(l.start,l.start+l.length);switch(l.type){case"PRG1":break;case"PBK1":{let s=63,i=(l.tipMsb?6:0)+l.tipLsb;for(let o=0;o<128;o++){let c=o*l.entryLen,d=n.subarray(c,c+l.entryLen),h=ye.decode(d.subarray(0,24)).trimEnd().replace("InitProg","");h.length&&i>5&&(a+=`
${s.toString().padStart(3,"0")}	${i.toString().padStart(3,"0")}	${o.toString().padStart(3,"0")}	${h}`)}break}case"CBK1":{let s=63,i=(l.tipMsb?3:0)+l.tipLsb+10;for(let o=0;o<128;o++){let c=o*l.entryLen,d=n.subarray(c,c+l.entryLen),h=ye.decode(d.subarray(0,24)).trimEnd().replace("InitCombi","");h.length&&i>12&&(a+=`
${s.toString().padStart(3,"0")}	${i.toString().padStart(3,"0")}	${o.toString().padStart(3,"0")}	${h}`)}break}}k++,k>=C.length&&(u=3,$=!1)}][u]||(()=>{$=!1}))()}return a});var st=["off","hall","room","stage","plate","delay LCR","delay LR","echo","cross delay","early reflections","gate reverb","reverse gate"].concat(new Array(4),["white room","tunnel","canyon","basement","karaoke"],new Array(43),["pass through","chorus","celeste","flanger","symphonic","rotary speaker","tremelo","auto pan","phaser","distortion","overdrive","amplifier","3-band EQ","2-band EQ","auto wah"],new Array(1),["pitch change","harmonic","touch wah","compressor","noise gate","voice channel","2-way rotary speaker","ensemble detune","ambience"],new Array(4),["talking mod","Lo-Fi","dist + delay","comp + dist + delay","wah + dist + delay","V dist","dual rotor speaker"]),it=["melodic","drums","drum set 1","drum set 2","drum set 3","drum set 4","drum set 5","drum set 6","drum set 7","drum set 8"],sr=[17.1,18.6,20.2,21.8,23.3,24.9,26.5,28,29.6,31.2,32.8,34.3,35.9,37.5,39,40.6,42.2,43.7,45.3,46.9,48.4,50],Qe=[20,22,25,28,32,36,40,45,50,56,63,70,80,90,100,110,125,140,160,180,200,225,250,280,315,355,400,450,500,560,630,700,800,900,1e3,1100,1200,1400,1600,1800,2e3,2200,2500,2800,3200,3600,4e3,4500,5e3,5600,6300,7e3,8e3,9e3,1e4,11e3,12e3,14e3,16e3,18e3,2e4],Ot=[0,.04,.08,.13,.17,.21,.25,.29,.34,.38,.42,.46,.51,.55,.59,.63,.67,.72,.76,.8,.84,.88,.93,.97,1.01,1.05,1.09,1.14,1.18,1.22,1.26,1.3,1.35,1.39,1.43,1.47,1.51,1.56,1.6,1.64,1.68,1.72,1.77,1.81,1.85,1.89,1.94,1.98,2.02,2.06,2.1,2.15,2.19,2.23,2.27,2.31,2.36,2.4,2.44,2.48,2.52,2.57,2.61,2.65,2.69,2.78,2.86,2.94,3.03,3.11,3.2,3.28,3.37,3.45,3.53,3.62,3.7,3.87,4.04,4.21,4,37,4.54,4.71,4.88,5.05,5.22,5.38,5.55,5.72,6.06,6.39,6.73,7.07,7.4,7.74,8.08,8.41,8.75,9.08,9.42,9.76,10.1,10.8,11.4,12.1,12.8,13.5,14.1,14.8,15.5,16.2,16.8,17.5,18.2,19.5,20.9,22.2,23.6,24.9,26.2,27.6,28.9,30.3,31.6,33,34.3,37,39.7],At=function(b){let e=.1,a=-.3;return b>66?(e=5,a=315):b>56?(e=1,a=47):b>46&&(e=.5,a=18.5),e*b-a},Lt=function(b){return b>105?sr[b-106]:b>100?b*1.1-100:b/10},Ut=",a,i,u,e,o,ka,ki,ku,ke,ko,ky,kw,sa,si,su,se,so,sh,ta,ti,tu,te,to,t,ch,t,s,na,ni,nu,ne,no,ny,nn,ha,hi,hu,he,ho,hy,fa,fi,fu,fe,fo,ma,mi,mu,me,mo,my,mm,ya,yu,ye,yo,ra,ri,ru,re,ro,ry,wa,wi,we,wo,ga,gi,gu,ge,go,gy,gw,za,zi,zu,ze,zo,ja,ji,ju,je,jo,jy,da,di,du,de,do,dy,ba,bi,bu,be,bo,by,va,vi,vu,ve,vo,pa,pi,pu,pe,po,py,nga,ngi,ngu,nge,ngo,ngy,ng,hha,hhi,hhu,hhe,hho,hhy,hhw,*,_,,,~,.".split(","),mt={};`hi*,
ka,ã‹
ki,ã
ku,ã
ke,ã‘
ko,ã“
ky,ã!
kw,ãl
tsu,ã¤
ts,ã¤l
sa,ã•
si,ã™ãƒ
su,ã™
se,ã›
so,ã
shi,ã—
sh,ã—!
ta,ãŸ
ti,ã¦ãƒ
tu,ã¨ã…
te,ã¦
to,ã¨
tchy,ã¡!
tchi,ã¡
na,ãª
ni,ã«
nu,ã¬
ne,ã­
no,ã®
ny,ã«!
nn,ã‚“
ha,ã¯
hi,ã²
hu,ã»ã…
he,ã¸
ho,ã»
hy,ã²!
fa,ãµã
fi,ãµãƒ
fu,ãµ
fe,ãµã‡
fo,ãµã‰
ma,ã¾
mi,ã¿
mu,ã‚€
me,ã‚
mo,ã‚‚
my,ã¿!
mm,ã‡º
ra,ã‚‰
ri,ã‚Š
ru,ã‚‹
re,ã‚Œ
ro,ã‚
ry,ã‚Š!
wa,ã‚
wi,ã‚
we,ã‚‘
wo,ã‚’
nga,ã‹ã‚š
ngi,ãã‚š
ngu,ãã‚š
nge,ã‘ã‚š
ngo,ã“ã‚š
ngy,ãã‚š!
ng,ãƒ³
ga,ãŒ
gi,ãŽ
gu,ã
ge,ã’
go,ã”
gy,ãŽ!
gw,ãl
za,ã–
zi,ãšãƒ
zu,ãš
ze,ãœ
zo,ãž
ja,ã˜ã‚ƒ
ji,ã˜
ju,ã˜ã‚…
je,ã˜ã‡
jo,ã˜ã‚‡
jy,ã˜!
da,ã 
di,ã§ãƒ
du,ã©ã…
de,ã§
do,ã©
dy,ã§!
ba,ã°
bi,ã³
bu,ã¶
be,ã¹
bo,ã¼
by,ã³!
va,ã‚”ã
vi,ã‚”ãƒ
vu,ã‚”
ve,ã‚”ã‡
vo,ã‚”ã‰
pa,ã±
pi,ã´
pu,ã·
pe,ãƒš
po,ã½
py,ã´!
!ya,ã‚ƒ
!yu,ã‚…
!ye,ã‡
!yo,ã‚‡
ya,ã‚„
yu,ã‚†
ye,ð›€
yo,ã‚ˆ
!a,ã‚ƒ
!u,ã‚…
!e,ã‡
!o,ã‚‡
!a,ã‚ƒ
!u,ã‚…
!e,ã‡
!o,ã‚‡
la,ã
li,ãƒ
lu,ã…
le,ã‡
lo,ã‰
a,ã‚
i,ã„
u,ã†
e,ãˆ
o,ãŠ
*,ã£
~,
^,
_,`.split(`
`).forEach(b=>{let e=b.split(",");mt[e[0]]=e[1]});var Ht=function(b){let e=b;b[0]=="*"&&(e=e.slice(1)),["aa","ii","uu","ee","oo"].forEach(f=>{for(;e.indexOf(f)>-1;)e=e.replace(f,f[0])});for(let f in mt)e=e.replaceAll(f,mt[f]);e.indexOf("ã‚“")==0&&e.length>1&&(e=e.slice(1));let a=e.indexOf("!");return a>-1&&e.length>1&&(e=e.slice(a+1)),e},Bt=function(b){return b?b<96?`cc${b}`:["aftertouch","velocity","pitch bend"][b-96]:"off"};var vt=["room 1","room 2","room 3","hall 1","hall 2","plate","delay","panning delay"],Nt=["chorus 1","chorus 2","chorus 3","chorus 4","feedback","flanger","short delay","short delay feedback"],It=["delay 1","delay 2","delay 3","delay 4","pan delay 1","pan delay 2","pan delay 3","pan delay 4","delay to reverb","pan repeat"];var ir={0:"thru",256:"stereo EQ",257:"spectrum",258:"enhancer",259:"humanizer",272:"overdrive",273:"distortion",288:"phaser",289:"auto wah",290:"rotary",291:"stereo flanger",292:"step flanger",293:"tremelo",294:"auto pan",304:"compressor",305:"limiter",320:"hexa chorus",321:"tremelo chorus",322:"stereo chorus",323:"space D",324:"3D chorus",336:"stereo delay",337:"modulated delay",338:"3-tap delay",339:"4-tap delay",340:"tremelo control delay",341:"reverb",342:"gate reverb",343:"3D delay",352:"2-pitch shifter",353:"feedback pitch shifter",368:"3D auto",369:"3D manual",370:"Lo-Fi 1",371:"Lo-Fi 2",512:"overdrive - chorus",513:"overdrive - flanger",514:"overdrive - delay",515:"distortion - chorus",516:"distortion - flanger",517:"distortion - delay",518:"enhancer - chorus",519:"enhancer - flanger",520:"enhancer - delay",521:"chorus - delay",522:"flanger - delay",523:"chorus - flanger",524:"rotary multi",1024:"guitar multi 1",1025:"guitar multi 2",1026:"guitar multi 3",1027:"clean guitar multi 1",1028:"clean guitar multi 2",1029:"bass multi",1030:"rhodes multi",1280:"keyboard multi",4352:"chorus / delay",4353:"flanger / delay",4354:"chorus / flanger",4355:"overdrive / distortion",4356:"overdrive / rotary",4357:"overdrive / phaser",4358:"overdrive / auto wah",4359:"phaser / rotary",4360:"phaser / auto wah"},nr={66307:["drive"],66309:["vowel",b=>"aiueo"[b]],94723:["pre-filter"],94724:["Lo-Fi type"],94725:["post-filter"],94979:["Lo-Fi type"],94980:["fill type",b=>["off","LPF","HPF"][b]],94984:["noise type",b=>["white","pink"][b]],94987:["disc type",b=>["LP","SP","EP","RND"]],94990:["hum type",b=>`${b+5}0Hz`],94993:["M/S",b=>["mono","stereo"][b]]},$t=function(b){return ir[(b[0]-32<<8)+b[1]]||`0x${b[0].toString(16).padStart(2,"0")}${b[1].toString(16).padStart(2,"0")}`},Gt=function(b,e,a){let f=(b[0]-32<<16)+(b[1]<<8)+e,u=nr[f]||{},p=u[0];if(p!=null&&p.length)return p+=`: ${(u[1]||function(){})(a)||a}`,p},Ct=[68,48,95,78,41,3,110,122,0];var re=function(b=64){return Math.round(2e3*Math.log10(b/64))/100};var Pe=function(b){let e=0;return b.forEach(a=>{e+=a,e=e&127}),~e+1&127},fe=function(b,e){let a=0,f=0;for(let u=0;u<b.length;u++){let p=u%8-1,$=(f>>p&1)<<7,C=b[u];C+=$,u%8!=0?(e(C,a,b),a++):f=b[u]}};var nt=function(b){let e=Math.floor(b*14.2);return e<128?e:0},O=function(){return!!self.Bun||self.debugMode||!1};var _=["?","gm","gs","sc","xg","g2","mt32","doc","qy10","qy20","ns5r","x5d","05rw","k11","sg","sd","pa","krs","s90es","motif","trin"],cr={gm2:"g2","mt-32":"mt32","c/m":"mt32",ag10:"05rw","ag-10":"05rw","05r/w":"05rw",x5:"05rw",x5dr:"x5d",gmega:"k11","kross 2":"krs","motif es":"motif","s90 es":"s90es",trinity:"trin","tr-rack":"trin"},or=["melodic","drum","menu"],_t={"?":[0,0,120,0,0],gm:[0,0,127,0,0],gs:[0,0,120,0,0],sc:[0,0,120,0,0],xg:[0,0,127,0,0],g2:[0,0,120,0,0],mt32:[0,127,127,0,127],doc:[57,112,127,57,112],qy10:[57,113,127,57,113],qy20:[57,114,127,57,114],ns5r:[0,0,61,0,0],x5d:[82,0,62,56,0],"05rw":[81,0,62,56,0],k11:[0,0,122,0,0],sg:[0,0,122,0,0],sd:[97,0,105,0,0],krs:[121,0,120,0,0],s90es:[0,0,127,0,0],motif:[0,0,127,0,0],trin:[0,0,127,0,0]},lr=[9,25,41,57,73,89,105,121],hr=[0,3,81,84,88],Xt={8:"Off",9:"On",10:"Note aftertouch",11:"cc",12:"pc",13:"Channel aftertouch",14:"Pitch"},Vt={0:0,1:1,2:3,5:4},Ft={0:0,1:1,2:2,5:3},Kt=[[0,24],[0,127],[0,127],[40,88],[0,127],[0,127]],kt=[36,37,48,49,52,53],gt=[20,21,22,23,24,25,26,28,29,30,31,36,37,48,49,52,53,64,65],zt={26:127,29:0,30:0,31:0,52:12,53:54},Ue=[0,1,2,4,5,6,7,8,10,11,32,38,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,84,91,92,93,94,95,98,99,100,101,128,12,13,16,17,18,19,14,15,20,21,26,28,22,80,81,82,83,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157],dr=[2,4,12,13,14,15,16,17,18,19,20,21,80,81,83,136,130,131,132,133,134,135,137,138,139,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157],fr=[33,102,99,32,100,8,9,10],Wt=[0,16,25,40,32,64,24,48],w={};_.forEach((b,e)=>{w[b]=e});var v={length:Ue.length};Ue.forEach((b,e)=>{v[b]=e});var ue={length:gt.length};gt.forEach((b,e)=>{ue[b]=e});var ur={};or.forEach((b,e)=>{ur[b]=e});var pr=function(b){let e=[],a=0;return b==null||b.forEach(function(f,u){f==247?e.push(b.subarray(a,u)):f==240&&(a=u+1)}),e.length||e.push(b.subarray(0)),O()&&console.debug(e),e};var wt=8,g={port:wt,ch:wt<<4,chShift:Math.ceil(Math.log2(wt))+4,cc:Ue.length,nn:128,pl:512,tr:256,cmt:14,rpn:6,rpnt:4,nrpn:kt.length,ace:8,drm:8,dpn:gt.length,dnc:128,ext:3,efx:7,cvn:12,redir:32,vxPrim:3,invalidCh:255};g.chcc=g.cc*g.ch;var ct={bank0:128},B=new Uint16Array(g.ch),ut=new Uint16Array(g.ch),br=new Uint16Array(g.ch),gr=new Uint16Array(g.ch),Yt=new Uint16Array(g.ch),qt=new Array(g.drm);for(let b=0;b<g.ch;b++)B[b]=b*g.cc,ut[b]=b*g.rpn,br[b]=b*g.nrpn,gr[b]=b*g.ace,Yt[b]=b*g.ext;for(let b=0;b<g.drm;b++){qt[b]=new Uint16Array(g.dpn);let e=b*g.dpn*g.dnc;for(let a=0;a<g.dpn;a++)qt[b][a]=e+a*g.dnc}var N,J,pe,xe,le,ke,Jt,ae,K,R,m,Z,L,z,se,W,Q,Se,me,He,ie,D,H,Ye,ee,be,ne,Je,Be,X,Ne,ge,ot,Re,Ee,Ze,De,V,U,ve,lt,I,Ie,je,et,Oe,Ae,ht,tt,$e,G,pt,dt,Ge,ce,Te,Le,j,_e,F,ft,bt,Xe,Ve,oe,he,Ce,Fe,Ke,ze,Qt,ra=(Qt=class extends Mt{constructor(){super();S(this,le);P(this,"NOTE_IDLE",0);P(this,"NOTE_ATTACK",1);P(this,"NOTE_DECAY",2);P(this,"NOTE_SUSTAIN",3);P(this,"NOTE_HELD",4);P(this,"NOTE_RELEASE",5);P(this,"NOTE_SOSTENUTO_ATTACK",8);P(this,"NOTE_SOSTENUTO_DECAY",9);P(this,"NOTE_SOSTENUTO_SUSTAIN",10);P(this,"NOTE_SOSTENUTO_HELD",11);P(this,"CH_MELODIC",0);P(this,"CH_DRUMS",1);P(this,"CH_DRUM1",2);P(this,"CH_DRUM2",3);P(this,"CH_DRUM3",4);P(this,"CH_DRUM4",5);P(this,"CH_DRUM5",6);P(this,"CH_DRUM6",7);P(this,"CH_DRUM7",8);P(this,"CH_DRUM8",9);P(this,"DUMP_ALL",0);P(this,"DUMP_ONCE",1);P(this,"DUMP_MODE",2);P(this,"EXT_NONE",0);P(this,"EXT_VL",1);P(this,"EXT_DX",3);P(this,"VLBC_BRTHEXPR",1);P(this,"VLBC_VELOINIT",2);P(this,"VLBC_VELOALL",3);P(this,"CH_INACTIVE",0);P(this,"CH_ACTIVE",1);P(this,"CH_DISABLED",2);S(this,N,0);S(this,J,0);S(this,pe,0);S(this,xe,new Array(11));S(this,ae,new Uint8Array(g.ch));S(this,K,new Uint8Array(g.ch));S(this,R,new Uint8Array(g.ch));S(this,m,new Uint8Array(g.chcc<<1));S(this,Z,new Uint8Array(g.ch*g.ace));S(this,L,new Uint8Array(g.ch*g.vxPrim));S(this,z,new Uint8Array(g.ch*g.nn));S(this,se,new Uint8Array(g.ch));S(this,W,new Uint16Array(g.pl));S(this,Q,new Uint8Array(g.pl));S(this,Se,new Int16Array(g.ch));S(this,me,new Uint8Array(g.ch));S(this,He,new Uint8Array(g.ch));S(this,ie,new Uint8Array(g.ch*g.ext));S(this,D,new Uint8Array(g.ch*g.rpn));S(this,H,new Uint8Array(g.ch*g.rpnt));S(this,Ye,new Int8Array(g.ch*kt.length));S(this,ee,new Uint8Array(g.drm*g.dpn*g.dnc));S(this,be,new Uint8Array(g.drm*2));S(this,ne,new Uint8Array(g.efx*3));S(this,Je,new Uint8Array(g.ch));S(this,Be,new Uint8Array(g.ch*g.redir));S(this,X,new Uint8Array(g.port));S(this,Ne,new Uint8Array(g.ch));S(this,ge,new Uint8Array(g.ch));S(this,ot,new Uint8Array(g.ch*g.cvn));S(this,Re,new Uint8Array(128));S(this,Ee,new Uint8Array(g.cmt*8));S(this,Ze,new Uint8Array(1024));S(this,De,new Uint8Array(g.cmt*64));S(this,V,{});P(this,"modelEx",{sc:{showBar:!0,invBar:!1,invDisp:!1,peakHold:1}});S(this,U,void 0);S(this,ve,void 0);S(this,lt,void 0);S(this,I,100);S(this,Ie,0);S(this,je,500);S(this,et,0);S(this,Oe,"");S(this,Ae,0);S(this,ht,0);S(this,tt,0);S(this,$e,!0);S(this,G,!1);S(this,pt,1);S(this,dt,void 0);S(this,Ge,new Array(g.ch));S(this,ce,[]);S(this,Te,new Uint8Array(g.ch));S(this,Le,new Uint8Array(g.tr));P(this,"baseBank",new yt("gm2","ns5r","xg","gs","sd","gmega","plg-vl","plg-pf","plg-dx","plg-an","plg-dr","plg-sg","kross","s90es"));P(this,"userBank",new yt("gm"));P(this,"initOnReset",!1);P(this,"aiEfxName","");S(this,j,[]);S(this,_e,void 0);S(this,F,{nOff:(e,a)=>{let f=e*128+a,u=t(this,W).lastIndexOf(f);if(u>-1)if(this.getChCc(e,64)>>6)t(this,Q)[u]=this.NOTE_HELD,this.dispatchEvent("note",{part:e,note:a,velo:t(this,z)[f],state:this.NOTE_HELD});else if(this.getChCc(e,66)>>6&&t(this,Q)[u]==this.NOTE_SOSTENUTO_SUSTAIN)t(this,Q)[u]=this.NOTE_SOSTENUTO_HELD,this.dispatchEvent("note",{part:e,note:a,velo:t(this,z)[f],state:this.NOTE_SOSTENUTO_HELD});else{t(this,W)[u]=0,t(this,z)[f]=0,t(this,Q)[u]=this.NOTE_IDLE;let p=this.getExt(e)[1];(p==this.VLBC_VELOINIT||p==this.VLBC_VELOALL)&&this.setChCc(e,129,0),this.dispatchEvent("note",{part:e,note:a,velo:0,state:this.NOTE_IDLE})}},nOn:(e,a,f)=>{let u=e*128+a,p=0;for(t(this,se)[e]&&t(this,F).ano(e);t(this,Q)[p]>0&&t(this,W)[p]!=u;)p++;if(p<g.pl){t(this,W)[p]=u,t(this,z)[u]=f,t(this,Q)[p]=this.NOTE_SUSTAIN,t(this,me)[e]<f&&(t(this,me)[e]=f);let $=this.getExt(e)[1];($==this.VLBC_VELOINIT||$==this.VLBC_VELOALL)&&this.setChCc(e,129,f),this.dispatchEvent("note",{part:e,note:a,velo:f,state:this.NOTE_SUSTAIN})}else console.error("Polyphony exceeded.")},nAt:(e,a,f)=>{},cAt:(e,a)=>{},hoOf:e=>{t(this,Q).forEach((a,f)=>{if(a==this.NOTE_HELD){let u=t(this,W)[f],p=u>>7;e==p&&(t(this,Q)[f]=this.NOTE_IDLE,t(this,W)[f]=0,t(this,z)[u]=0,this.dispatchEvent("note",{part:e,note:u&127,velo:0,state:this.NOTE_IDLE}))}})},soOn:e=>{t(this,Q).forEach((a,f)=>{let u;switch(a){case this.NOTE_ATTACK:{u=this.NOTE_SOSTENUTO_ATTACK;break}case this.NOTE_DECAY:{u=this.NOTE_SOSTENUTO_DECAY;break}case this.NOTE_SUSTAIN:{u=this.NOTE_SOSTENUTO_SUSTAIN;break}}if(u){t(this,Q)[f]=u;let p=t(this,W)[f];this.dispatchEvent("note",{part:e,note:p&127,velo:t(this,z)[p],state:u})}})},soOf:e=>{t(this,Q).forEach((a,f)=>{if(a==this.NOTE_SOSTENUTO_HELD){let u=t(this,W)[f],p=u>>7;e==p&&(t(this,Q)[f]=this.NOTE_IDLE,t(this,W)[f]=0,t(this,z)[u]=0,this.dispatchEvent("note",{part:e,note:u&127,velo:0,state:this.NOTE_IDLE}))}})},ano:e=>{t(this,W).forEach((a,f,u)=>{let p=a>>7,$=a&127;a==0&&t(this,z)[0]==0||p==e&&t(this,F).nOff(p,$)})}});S(this,ft,{8:function(e){let a=e.channel,f=e.data[0];t(this,F).nOff(a,f)},9:function(e){let a=e.channel,f=this;if(f.getChModeId(a)==w.xg&&t(f,R)[a]>1){let $=f.getChDrumFirstWrite(a);$[0]&&$[1]!=g.invalidCh&&!t(f,ae)[a]&&(f.copyChSetup($[1],a),f.dispatchEvent("voice",{part:a}),console.debug(`Part CH${a+1} copied from CH${$[1]}.`))}f.setChActive(a,1);let u=e.data[0],p=e.data[1];p>0?t(f,F).nOn(a,u,p):t(f,F).nOff(a,u)},10:function(e){let a=e.channel,f=a*128+e.data[0];t(this,W).indexOf(f)>-1&&(t(this,z)[f]=data[1],this.getExt(a)[1]==this.VLBC_VELOALL&&this.setChCc(a,129,data[1]),this.dispatchEvent("note",{part:a,note:e.data[0],velo:e.data[1],state:this.NOTE_SUSTAIN}))},11:function(e){let a=e.channel,f=this,u=t(this,Ge)[a],p=u[e.data[0]];p&&(e.data[0]=p),[0,32].indexOf(e.data[0])>-1&&(()=>{switch(t(this,N)){case w.s90es:case w.motif:{if(e.data[0]==0){[0,63].indexOf(e.data[1])>-1&&this.setChActive(a,1);break}e.data[1]&&this.setChActive(a,1);break}default:{this.setChActive(a,1);break}}})();let $=a*g.ext,C=this.getChModeId(a);switch(e.data[0]){case 96:return;case 97:return;case 120:return;case 121:{t(this,F).ano(a),t(this,Se)[a]=0,f.resetChCc(a,1,0),f.resetChCc(a,5,0),f.resetChCc(a,64,0),f.resetChCc(a,65,0),f.resetChCc(a,66,0),f.resetChCc(a,67,0),f.resetChCc(a,11,127),f.resetChCc(a,101,127),f.resetChCc(a,100,127),f.resetChCc(a,99,127),f.resetChCc(a,98,127);return}case 123:{t(this,F).ano(a);return}case 124:{t(this,F).ano(a);return}case 125:{t(this,F).ano(a);return}case 126:{t(this,se)[a]=1,t(this,F).ano(a);return}case 127:{t(this,se)[a]=0,t(this,F).ano(a);return}}if(v[e.data[0]]==null)console.warn(`cc${e.data[0]} is not accepted.`);else{switch(dr.indexOf(e.data[0])>-1&&this.allocateAce(a,e.data[0]),e.data[0]){case 0:{switch(O()&&console.debug(`${_[t(this,N)]}, CH${a+1}: ${e.data[1]}`),t(this,N)==0?e.data[1]<48?(t(this,R)[a]>0&&(e.data[1]=this.getChPrimitive(a,1,!1),e.data[1]=120,console.debug(`Forced channel ${a+1} to stay drums.`)),e.data[1]>0&&(console.debug(`Roland GS detected with MSB: ${e.data[1]}`),this.switchMode("gs"))):e.data[1]==56?this.switchMode(t(this,U).x5==82?"x5d":"05rw"):e.data[1]==62?this.switchMode(t(this,U).x5==82?"x5d":"05rw"):e.data[1]==63?this.switchMode(_[t(this,U).ds]):(e.data[1]==64||e.data[1]==127)&&this.switchMode("xg"):t(this,N)==w.gs||t(this,N)==w.sc?e.data[1]<56&&t(this,R)[a]>0&&(e.data[1]=this.getChPrimitive(a,1,!1),e.data[1]=120,console.debug(`Forced channel ${a+1} to stay drums.`)):t(this,N)==w.gm&&(e.data[1]<48?t(this,R)[a]>0&&(e.data[1]=120,this.switchMode("gs",!0),console.debug(`Forced channel ${a+1} to stay drums.`)):(e.data[1]==64||e.data[1]==127)&&this.switchMode("xg",!0)),t(this,N)){case w.xg:{[79,95,126,127].indexOf(e.data[1])>-1?t(this,R)[a]==0&&(this.setChType(a,this.CH_DRUM2),console.debug(`CH${a+1} set to drums by MSB.`)):t(this,R)[a]>0&&(this.setChType(a,this.CH_MELODIC),console.debug(`CH${a+1} set to melodic by MSB.`)),[33,81,97].indexOf(e.data[1])>-1?t(this,ie)[$]=this.EXT_VL:[35,67,83,99].indexOf(e.data[1])>-1?t(this,ie)[$]=this.EXT_DX:t(this,ie)[$]=this.EXT_NONE;break}case w["05rw"]:case w.x5d:case w.ns5r:{[61,62,126,127].indexOf(e.data[1])>-1?t(this,R)[a]==this.CH_MELODIC&&(this.setChType(a,this.CH_DRUM2),console.debug(`CH${a+1} set to drums by MSB.`)):[80,81,82,83].indexOf(e.data[1])>-1||t(this,R)[a]!=this.CH_MELODIC&&(this.setChType(a,this.CH_MELODIC),console.debug(`CH${a+1} set to melodic by MSB.`));break}case w.sd:{[104,105,106,107].indexOf(e.data[1])>-1?t(this,R)[a]==0&&(this.setChType(a,this.CH_DRUM2),console.debug(`CH${a+1} set to drums by MSB.`)):t(this,R)[a]>0&&(this.setChType(a,this.CH_MELODIC),console.debug(`CH${a+1} set to melodic by MSB.`));break}case w.g2:{e.data[1]==120?t(this,R)[a]==0&&(this.setChType(a,this.CH_DRUMS),console.debug(`CH${a+1} set to drums by MSB.`)):t(this,R)[a]>0&&(this.setChType(a,this.CH_MELODIC),console.debug(`CH${a+1} set to melodic by MSB.`));break}}break}case 2:{this.getExt(a)[1]==this.VLBC_BRTHEXPR&&this.setChCc(a,129,e.data[1]);break}case 6:{if(t(this,He)[a]){[w.xg,w.gs,w.sc,w.ns5r].indexOf(t(this,N))<0&&console.warn(`NRPN commits are not available under "${_[t(this,N)]}" mode, even when they are supported in Octavia.`);let k=this.getChCc(a,99),r=this.getChCc(a,98);if(k==1){let l=fr.indexOf(r);if(l>-1)this.setChCc(a,71+l,e.data[1]),O()&&console.debug(`Redirected NRPN 1 ${r} to cc${71+l}.`),this.dispatchEvent("cc",{part:a,cc:71+l,data:e.data[1]});else{let n=kt.indexOf(r);n>-1?t(this,Ye)[a*10+n]=e.data[1]-64:console.warn(`NRPN 0x01${r.toString(16).padStart(2,"0")} is not supported.`),O()&&console.debug(`CH${a+1} voice NRPN ${r} commit`)}}else{if(gt.indexOf(k)<0){let n=`NRPN 0x${k.toString(16).padStart(2,"0")}${r.toString(16).padStart(2,"0")} `;k==127?console.warn(`${n}is not necessary. Consider removing it.`):console.warn(`${n}is not supported.`)}else{let n=t(this,R)[a]-2;n<0?console.warn(`CH${a+1} cannot accept drum NRPN as type ${it[t(this,R)[a]]}.`):t(this,ee)[(n*g.dpn+ue[k])*g.dnc+r]=e.data[1]}O()&&console.debug(`CH${a+1} (${it[t(this,R)[a]]}) drum NRPN ${k} commit`)}}else{let k=Vt[this.getChCc(a,100)],r=Ft[this.getChCc(a,100)];if(this.getChCc(a,101)==0&&k!=null)switch(O()&&console.debug(`CH${a+1} RPN 0 ${this.getChCc(a,100)} commit: ${e.data[1]}`),e.data[1]=Math.min(Math.max(e.data[1],Kt[k][0]),Kt[k][1]),t(this,D)[a*g.rpn+k]=e.data[1],t(this,H)[a*g.rpnt+r]=1,C){case w.xg:case w.gs:case w.sc:case w.mt32:case w.s90es:case w.motif:{switch(this.getChCc(a,100)){case 1:case 2:{this.dispatchEvent("pitch",{part:a,pitch:this.getPitchShift(a)});break}}break}default:this.dispatchEvent("pitch",{part:a,pitch:this.getPitchShift(a)})}}break}case 32:{switch(O()&&console.debug(`${_[t(this,N)]}, CH${a+1} LSB: ${e.data[1]}`),t(this,N)){case w.s90es:case w.motif:{this.setChType(a,[32,40].indexOf(e.data[1])>-1?this.CH_DRUMS:this.CH_MELODIC,t(this,N),!0);break}}this.getExt(a)[0]==this.EXT_DX;break}case 38:{if(!t(this,He)[a]){let k=Vt[this.getChCc(a,100)],r=Ft[this.getChCc(a,100)];this.getChCc(a,101)==0&&k!=null&&(t(this,D)[a*g.rpn+k+1]=e.data[1],t(this,H)[a*g.rpnt+r]=1)}break}case 64:{e.data[1]<64&&t(this,F).hoOf(a);break}case 66:{e.data[1]>>6?t(this,F).soOn(a):t(this,F).soOf(a);break}case 98:case 99:{t(this,He)[a]=1;break}case 100:case 101:{t(this,He)[a]=0;break}}this.setChCc(a,e.data[0],e.data[1]),this.dispatchEvent("cc",{part:a,cc:e.data[0],data:e.data[1]})}f.getChModeId(a)==w.xg&&t(f,R)[a]&&f.setDrumFirstWrite(a)},12:function(e){let a=e.channel,f=this;switch(t(f,N)){case w.s90es:case w.motif:{e.data&&f.setChActive(a,1);break}default:f.setChActive(a,1)}let u=B[a];switch(f.getExt(a)[0]){case f.EXT_VL:break}t(f,L)[a]=e.data,t(f,ge)[a]=0,f.pushChPrimitives(a),O()&&console.debug(`T:${e.track} C:${a} P:${e.data}`),f.dispatchEvent("voice",{part:a}),f.getChModeId(a)==w.xg&&t(f,R)[a]&&f.setDrumFirstWrite(a)},13:function(e){let a=this,f=e.channel;t(this,W).forEach(function(u){let p=u>>7;f==p&&(t(a,z)[u]=e.data,a.dispatchEvent("note",{part:f,note:u&127,velo:e.data,state:a.NOTE_SUSTAIN}))})},14:function(e){let a=e.channel;t(this,Se)[a]=e.data[1]*128+e.data[0]-8192,this.dispatchEvent("pitch",{part:a,pitch:this.getPitchShift(a)})},15:function(e){pr(e.data).forEach(a=>{let f=a[0],u=a[1];(t(this,bt)[f]||function(){console.debug(`Unknown manufacturer ${f}.`)})(u,a.subarray(2),e.track)})},248:function(e){},250:function(e){},251:function(e){},252:function(e){},254:function(e){},255:function(e){(t(this,j)[e.meta]||function(f,u,p){}).call(this,e.data,e.track,e.meta),e.meta!=32&&x(this,Ie,0);let a=hr.indexOf(e.meta)>-1;if(O()&&console.debug(e),a)return e.reply="meta",e}});S(this,bt,{64:(e,a,f)=>{t(this,Fe).run(a,f,e)},65:(e,a,f)=>{if(a[0]<16)if(a[1]==72){let u=a[a.length-1],p=Pe(a.subarray(3,a.length-1));u==p?t(this,he).run(a.subarray(0,a.length-1),f,e):console.warn(`Bad SD checksum ${u} - should be ${p}.`)}else t(this,he).run(a,f,e);else{let u=a[a.length-1],p=Pe(a.subarray(2,a.length-1));u==p?t(this,he).run(a.subarray(0,a.length-1),f,e):console.warn(`Bad GS checksum ${u} - should be ${p}.`)}},66:(e,a,f)=>{t(this,Ce).run(a,f,e)},67:(e,a,f)=>{t(this,oe).run(a,f,e)},68:(e,a,f)=>{t(this,ze).run(a,f,e)},71:(e,a,f)=>{t(this,Ke).run(a,f,e)},126:(e,a,f)=>{t(this,Xe).run(a,f,e)},127:(e,a,f)=>{this.switchMode("gm"),t(this,Ve).run(a,f,e)}});S(this,Xe,void 0);S(this,Ve,void 0);S(this,oe,void 0);S(this,he,void 0);S(this,Ce,void 0);S(this,Fe,void 0);S(this,Ke,void 0);S(this,ze,void 0);let e=this;x(e,le,new Uint8Array(256),Jt),t(e,xe)[10]=new Uint8Array(512),x(e,_e,new de),x(e,U,{x5:82,ds:w.krs,smotif:w.s90es,gs:4,sc:3}),x(e,ve,{dumpLimit:e.DUMP_MODE}),x(e,lt,new Proxy(t(e,ve),{set:()=>{}}));for(let r in _t){let l=w[r];l==null?console.debug(`SubDB build error: "${r}" does not exist`):t(e,V)[l]=new Uint8Array(_t[r])}e.userBank.strictMode=!0,e.userBank.load(`MSB	PRG	LSB	NME
062	000	000	
122	000	000	
122	001	000	
122	002	000	
122	003	000	
122	004	000	
122	005	000	
122	006	000	`),e.addEventListener("metacommit",function(r){var n,s;let{data:l}=r;((n=t(e,ce)[0])==null?void 0:n.type)==l.type&&((s=t(e,ce)[0])!=null&&s.amend)?(t(e,ce)[0].amend=l.amend,t(e,ce)[0].data+=l.data):t(e,ce).unshift(l)}),t(e,j)[1]=function(r){var l,n,s,i,o;switch(r=r.replaceAll(`\r
`,`
`).replaceAll("\r",`
`),r.slice(0,2)){case"@I":{x(this,G,!0),this.dispatchEvent("metacommit",{type:"Kar.Info",data:(l=r.slice(2))==null?void 0:l.trimLeft()});break}case"@K":{x(this,G,!0),this.dispatchEvent("metacommit",{type:"Kar.Mode",data:(n=r.slice(2))==null?void 0:n.trimLeft()}),console.debug(`Karaoke mode active: ${r.slice(2)}`);break}case"@L":{x(this,G,!0),this.dispatchEvent("metacommit",{type:"Kar.Lang",data:(s=r.slice(2))==null?void 0:s.trimLeft()});break}case"@T":{x(this,G,!0),this.dispatchEvent("metacommit",{type:"KarTitle",data:(i=r.slice(2))==null?void 0:i.trimLeft()});break}case"@V":{x(this,G,!0),this.dispatchEvent("metacommit",{type:"Kar.Ver.",data:(o=r.slice(2))==null?void 0:o.trimLeft()});break}case"XF":{let c=r.slice(2).split(":");switch(c[0]){case"hd":{c.slice(1).forEach((d,h)=>{d.length&&this.dispatchEvent("metacommit",{type:["XfSngDte","XfSngRgn","XfSngCat","XfSongBt","XfSngIns","XfSngVoc","XfSngCmp","XfSngLrc","XfSngArr","XfSngPer","XfSngPrg","XfSngTag"][h],data:d})});break}case"ln":{c.slice(1).forEach((d,h)=>{d.length&&this.dispatchEvent("metacommit",{type:["XfKarLng","XfKarNme","XfKarCmp","XfKarLrc","XfKarArr","XfKarPer","XfKarPrg"][h],data:d})});break}default:this.dispatchEvent("metacommit",{type:"XfUnData",data:r})}break}default:t(this,G)?r[0]=="\\"?(this.dispatchEvent("metacommit",{type:"KarLyric",data:"",amend:!1}),this.dispatchEvent("metacommit",{type:"KarLyric",data:r.slice(1),amend:!0})):r[0]=="/"?(this.dispatchEvent("metacommit",{type:"KarLyric",data:"",mask:!0,amend:!1}),this.dispatchEvent("metacommit",{type:"KarLyric",data:r.slice(1),mask:!0,amend:!0})):this.dispatchEvent("metacommit",{type:"KarLyric",data:r,amend:!0}):r.split(`
`).forEach((c,d)=>{this.dispatchEvent("metacommit",{type:"Cmn.Text",data:c,mask:d!=0})})}},t(e,j)[2]=function(r){this.dispatchEvent("metacommit",{type:"Copyrite",data:r})},t(e,j)[3]=function(r,l){l<1&&t(this,Ie)<1&&this.dispatchEvent("metacommit",{type:"TrkTitle",data:r})},t(e,j)[4]=function(r,l){this.dispatchEvent("metacommit",{type:"Instrmnt",data:r})},t(e,j)[5]=function(r){r.trim()==""?this.dispatchEvent("metacommit",{type:"C.Lyrics",data:"",amend:!1}):this.dispatchEvent("metacommit",{type:"C.Lyrics",data:r,amend:!0})},t(e,j)[6]=function(r){this.dispatchEvent("metacommit",{type:"C.Marker",data:r})},t(e,j)[7]=function(r){this.dispatchEvent("metacommit",{type:"CuePoint",data:r})},t(e,j)[32]=function(r){x(this,Ie,r[0]+1)},t(e,j)[33]=function(r,l){O()&&console.debug(`Track ${l} requests to get assigned to output ${r}.`),t(e,Le)[l]=r+1},t(e,j)[81]=function(r,l){x(e,je,r/1e3)},t(e,j)[127]=function(r,l){t(e,_e).run(r,l)},t(e,_e).default=function(r){console.warn(`Unrecognized sequencer-specific byte sequence: ${r}`)},t(e,_e).add([67,0,1],function(r,l){O()&&console.debug(`XGworks requests assigning track ${l} to output ${r[0]}.`),t(e,Le)[l]=r[0]+1}),x(e,Xe,new de("universal non-realtime")),x(e,Ve,new de("universal realtime")),x(e,oe,new de("Yamaha")),x(e,he,new de("Roland")),x(e,Ce,new de("Korg")),x(e,Fe,new de("Kawai")),x(e,Ke,new de("Akai")),x(e,ze,new de("Casio"));let a=new de("DX7+ Dump"),f=function(r){console.info(`Unrecognized SysEx in "${this.name}" set.
%o`,r)};t(e,Xe).default=f,t(e,Ve).default=f,t(e,oe).default=f,t(e,he).default=f,t(e,Ce).default=f,t(e,Fe).default=f,t(e,Ke).default=f,t(e,ze).default=f,a.default=f,t(e,Xe).add([9],(r,l,n)=>{e.switchMode(["gm","?","g2"][r[0]-1],!0),e.setPortMode(e.getTrackPort(l),1,w[["gm","?","g2"][r[0]-1]]),x(e,G,t(e,G)||!1),console.info(`MIDI reset: ${["GM","Init","GM2"][r[0]-1]}`),r[0]==2&&e.init()}),t(e,Ve).add([4,1],(r,l,n)=>{e.dispatchEvent("mupromptex"),x(e,I,((r[1]<<7)+r[0])/16383*100),e.dispatchEvent("mastervolume",t(e,I))}).add([4,3],(r,l,n)=>((r[1]<<7)+r[0]-8192)/8192).add([4,4],(r,l,n)=>r[1]-64).add([4,5],(r,l,n)=>{e.dispatchEvent("mupromptex");let s=r[0],i=r[1],o=r[2],c=3,d=c+(s<<1),h=d+i;if(s!=1){console.error(`Unsupported GM2 global parameter set: slotpath length too long (${s})!
`,r);return}let E=0,y=0,T=0;switch(r.subarray(c,d).forEach(A=>{E=E<<7,E|=A}),r.subarray(d,h).forEach((A,M)=>{y|=A<<M*7}),r.subarray(h).forEach((A,M)=>{T|=A<<M*7}),O()&&console.debug(`GM2 global parameter: (${r.subarray(3,d)}; p: ${y}, v: ${T})`),E){case 129:{y==0&&(e.setEffectType(0,52,T),e.dispatchEvent("efxreverb",e.getEffectType(0)));break}case 130:{y==0&&(e.setEffectType(1,52,T|16),e.dispatchEvent("efxchorus",e.getEffectType(1)));break}default:O()&&console.debug("GM2 global paramater slot path unknown.")}}),t(this,oe).add([76,0,0],(r,l,n)=>{switch(r[0]){case 125:{e.initDrums(),console.info(`XG drum setup reset: ${r}`);break}case 126:{e.switchMode("xg",!0),e.setPortMode(e.getTrackPort(l),4,w.xg),x(e,G,!1),console.info("MIDI reset: XG");break}default:{e.dispatchEvent("mupromptex");let s=[0,0,0,0],i=(o,c)=>{s[c]=o};if(r.subarray(1).forEach((o,c)=>{let d=c+r[0];([i,i,i,i,h=>{x(this,I,h*129/16383*100),e.dispatchEvent("mastervolume",t(e,I))},h=>{},h=>{}][d]||(()=>{}))(o,c)}),r[0]<4){let o=0;s.forEach(c=>{o=o<<4,o+=c}),o-=1024}}}}).add([76,2,1],(r,l,n)=>{e.dispatchEvent("mupromptex");let s="XG ";r[0]<32?(s+="reverb ",r.subarray(1).forEach((i,o)=>{([c=>{e.setEffectTypeRaw(0,!1,c),console.info(`${s}main type: ${st[c]}`),e.dispatchEvent("efxreverb",e.getEffectType(0))},c=>{e.setEffectTypeRaw(0,!0,c),console.debug(`${s}sub type: ${c+1}`),e.dispatchEvent("efxreverb",e.getEffectType(0))},c=>{console.debug(`${s}time: ${At(c)}s`)},c=>{console.debug(`${s}diffusion: ${c}`)},c=>{console.debug(`${s}initial delay: ${c}`)},c=>{console.debug(`${s}HPF cutoff: ${Qe[c]}Hz`)},c=>{console.debug(`${s}LPF cutoff: ${Qe[c]}Hz`)},c=>{console.debug(`${s}width: ${c}`)},c=>{console.debug(`${s}height: ${c}`)},c=>{console.debug(`${s}depth: ${c}`)},c=>{console.debug(`${s}wall type: ${c}`)},c=>{console.debug(`${s}dry/wet: ${c}`)},c=>{console.debug(`${s}send: ${re(c)}dB`)},c=>{console.debug(`${s}pan: ${c-64}`)},!1,!1,c=>{console.debug(`${s}delay: ${c}`)},c=>{console.debug(`${s}density: ${c}`)},c=>{console.debug(`${s}balance: ${c}`)},c=>{},c=>{console.debug(`${s}feedback: ${c}`)},c=>{}][r[0]+o]||function(){console.warn(`Unknown XG reverb address: ${r[0]}.`)})(i)})):r[0]<64?(s+="chorus ",r.subarray(1).forEach((i,o)=>{([c=>{e.setEffectTypeRaw(1,!1,c),console.info(`${s}main type: ${st[c]}`),e.dispatchEvent("efxchorus",e.getEffectType(1))},c=>{e.setEffectTypeRaw(1,!0,c),console.debug(`${s}sub type: ${c+1}`),e.dispatchEvent("efxchorus",e.getEffectType(1))},c=>{console.debug(`${s}LFO: ${Ot[c]}Hz`)},c=>{},c=>{console.debug(`${s}feedback: ${c}`)},c=>{console.debug(`${s}delay offset: ${Lt(c)}ms`)},c=>{},c=>{console.debug(`${s}low: ${Qe[c]}Hz`)},c=>{console.debug(`${s}low: ${c-64}dB`)},c=>{console.debug(`${s}high: ${Qe[c]}Hz`)},c=>{console.debug(`${s}high: ${c-64}dB`)},c=>{console.debug(`${s}dry/wet: ${c}`)},c=>{console.debug(`${s}send: ${re(c)}dB`)},c=>{console.debug(`${s}pan: ${c-64}`)},c=>{console.debug(`${s}to reverb: ${re(c)}dB`)},!1,c=>{},c=>{},c=>{},c=>{console.debug(`${s}LFO phase diff: ${(c-64)*3}deg`)},c=>{console.debug(`${s}input mode: ${c?"stereo":"mono"}`)},c=>{}][r[0]-32+o]||function(){console.warn(`Unknown XG chorus address: ${r[0]}.`)})(i)})):r[0]<86?(s+="variation ",r.subarray(1).forEach((i,o)=>{([c=>{e.setEffectTypeRaw(2,!1,c),console.info(`${s}main type: ${st[c]}`),e.dispatchEvent("efxdelay",e.getEffectType(2))},c=>{e.setEffectTypeRaw(2,!0,c),console.debug(`${s}sub type: ${c+1}`),e.dispatchEvent("efxdelay",e.getEffectType(2))}][r[0]-64+o]||function(){})(i)})):r[0]<97?(s+="variation ",r.subarray(1).forEach((i,o)=>{[c=>{console.debug(`${s}send: ${re(c)}dB`)},c=>{console.debug(`${s}pan: ${c-64}`)},c=>{console.debug(`${s}to reverb: ${re(c)}dB`)},c=>{console.debug(`${s}to chorus: ${re(c)}dB`)},c=>{console.debug(`${s}connection: ${c?"system":"insertion"}`)},c=>{console.debug(`${s}channel: CH${c+1}`)},c=>{console.debug(`${s}mod wheel: ${c-64}`)},c=>{console.debug(`${s}bend wheel: ${c-64}`)},c=>{console.debug(`${s}channel after touch: ${c-64}`)},c=>{console.debug(`${s}AC1: ${c-64}`)},c=>{console.debug(`${s}AC2: ${c-64}`)}][r[0]-86+o](i)})):r[0]>111&&r[0]<118?s+="variation ":console.warn(`Unknown XG variation address: ${r[0]}`)}).add([76,2,64],(r,l,n)=>{r.subarray(1).forEach((s,i)=>{let o=i+r[0];if(o==0)console.debug(`XG EQ preset: ${["flat","jazz","pop","rock","classic"][s]}`);else{let c=o-1>>2,d=o-1&3,h=`XG EQ ${c} ${["gain","freq","Q","shape"][d]}: `;[()=>{console.debug(`${h}${s-64}dB`)},()=>{console.debug(`${h}${s} (raw)`)},()=>{console.debug(`${h}${s/10}`)},()=>{console.debug(`${h}${["shelf","peak"][+!!s]}`)}][d]()}})}).add([76,3],(r,l,n)=>{e.dispatchEvent("mupromptex");let s=r[0],i=r[1],o=`XG Insertion ${r[0]+1} `;r.subarray(2).forEach((c,d)=>{([h=>{e.setEffectTypeRaw(3+s,!1,h),console.info(`${o}main type: ${st[h]}`),e.dispatchEvent(`efxinsert${s}`,e.getEffectType(3+s))},h=>{e.setEffectTypeRaw(3+s,!0,h),console.debug(`${o}sub type: ${h+1}`),e.dispatchEvent(`efxinsert${s}`,e.getEffectType(3+s))}][i+d]||function(){})(c)})}).add([76,6,0],(r,l,n)=>{let s=r[0];s<64?e.setLetterDisplay(r.subarray(1),"XG letter display",s):x(e,Ae,Date.now())}).add([76,7,0],(r,l,n)=>{let s=r[0];x(e,J,0),x(e,pe,Date.now()+3200),t(e,le,ke).fill(0);let i=r.subarray(1);for(let o=0;o<s;o++)i.unshift(0);i.forEach(function(o,c){let d=Math.floor(c/16),h=c%16,E=(h*3+d)*7,y=7,T=0;for(E-=h*5,d==2&&(y=2);T<y;)t(e,le,ke)[E+T]=o>>6-T&1,T++})}).add([76,8],(r,l)=>{e.dispatchEvent("mupromptex");let n=e.chRedir(r[0],l,!0),s=r[1],i=B[n],o=`XG CH${n+1} `,c=`Unknown XG part address ${s}.`,d=!0;r.subarray(2).forEach((h,E)=>{d=!0,s<1?console.debug(c):s<41?([()=>{e.setChCc(n,0,h),e.pushChPrimitives(n),e.dispatchEvent("voice",{part:n})},()=>{e.setChCc(n,32,h),e.pushChPrimitives(n),e.dispatchEvent("voice",{part:n})},()=>{t(e,L)[n]=h,e.dispatchEvent("voice",{part:n})},()=>{d=!1;let y=e.chRedir(h,l,!0);t(e,K)[n]=y,n!=y&&(e.buildRchTree(),console.info(`${o}receives from CH${y+1}`)),t(e,ae)[n]||(e.copyChSetup(y,n,!0),console.debug(`${o}copied from CH${y+1}.`),e.setChActive(n,1),e.dispatchEvent("voice",{part:n}))},()=>{t(e,se)[n]=+!h},()=>{},()=>{d=!1,e.setChType(n,h,w.xg),console.debug(`${o}type: ${it[h]||h}`),e.dispatchEvent("voice",{part:n})},()=>{t(e,D)[g.rpn*n+3]=h,t(e,H)[g.rpnt*n+2]=1,e.dispatchEvent("pitch",{part:n,pitch:e.getPitchShift(n)})},!1,!1,()=>{e.setChCc(n,7,h)},!1,!1,()=>{e.setChCc(n,10,h||128)},!1,!1,()=>{e.setChCc(n,128,h),e.allocateAce(n,128)},()=>{e.setChCc(n,93,h)},()=>{e.setChCc(n,91,h)},()=>{e.setChCc(n,94,h)},()=>{e.setChCc(n,76,h)},()=>{e.setChCc(n,77,h)},()=>{e.setChCc(n,78,h)},()=>{e.setChCc(n,74,h)},()=>{e.setChCc(n,71,h)},()=>{e.setChCc(n,73,h)},()=>{e.setChCc(n,75,h)},()=>{e.setChCc(n,72,h)}][s+E-1]||(()=>{}))():s<48?console.debug(c):s<111?s>102&&s<105&&e.setChCc(n,[5,65][s&1],h):s<114?console.debug(c):s<116?console.debug(`${o}EQ ${["bass","treble"][s&1]} gain: ${h-64}dB`):s<118?console.debug(c):s<120?console.debug(`${o}EQ ${["bass","treble"][s&1]} freq: ${h}`):console.debug(c)}),d&&t(e,R)[n]>1&&e.setDrumFirstWrite(n)}).add([76,9],(r,l)=>{let n=e.chRedir(r[0],l,!0),s=r[1],i=B[n],o=`PLG-VL CH${n+1} `;r.subarray(2).forEach((c,d)=>{let h=d+s;switch(h){case 1:{console.info(`${o}breath mode: ${["system","breath","velocity","touch EG"][c]}`);break}case 0:case 27:case 28:break;default:if(h<27){let E=h-3>>1,y=["pressure","embouchure","tonguing","scream","breath noise","growl","throat formant","harmonic enhancer","damping","absorption","amplification","brightness"][E];h&1?h<23?(console.debug(`${o}${y} control source: ${Bt(c)}`),c&&c<96&&e.allocateAce(n,130+E),t(e,Be)[g.redir*n+E+2]=c,e.buildRccMap()):console.debug(`${o}${y} scale break point: ${c}`):(console.debug(`${o}${y} depth: ${c-64}`),e.setChCc(n,130+E,c))}}})}).add([76,10],(r,l,n)=>{}).add([76,16],(r,l,n)=>{}).add([76,17,0,0],(r,l,n)=>{}).add([76,112],(r,l,n)=>{switch(console.debug(`XG enable PLG-${["VL","SG","DX","AN","PF","DR","PC","AP"][r[0]]} for CH${r[2]+1}.`),r[0]){case 0:{t(e,ie)[g.ext*r[2]]=e.EXT_VL;break}case 2:{t(e,ie)[g.ext*r[2]]=e.EXT_DX;break}default:t(e,ie)[g.ext*r[2]]=e.EXT_NONE}}).add([73,0,0],(r,l)=>{let n=r[0],s="MU1000 System - ";r.subarray(1).forEach((i,o)=>{let c=n+o;c==8?console.debug(`${s}LCD contrast: ${i}.`):c==18?(t(e,V)[w.xg][1]=i?126:0,console.debug(`${s}default bank: ${i?"MU100 Native":"MU Basic"}.`),e.dispatchEvent("banklevel",{mode:"xg",data:+!!i}),e.forceVoiceRefresh()):c>=64&&c<69&&[()=>{e.dispatchEvent("channelactive",i)},()=>{i<8?(e.dispatchEvent("channelmin",i<<4),console.debug(`Octavia System: Minimum CH${(i<<4)+1}`)):(e.dispatchEvent("channelreset"),console.info("Octavia System: Clear channel ranges"))},()=>{i<8?(e.dispatchEvent("channelmax",(i<<4)+15),console.debug(`Octavia System: Maximum CH${(i<<4)+16}`)):(e.dispatchEvent("channelreset"),console.info("Octavia System: Clear channel ranges"))},()=>{e.dispatchEvent("channelreset"),console.info("Octavia System: Clear channel ranges")},()=>{x(e,$e,!!i),console.info(`Octavia System: RS receiving ${["dis","en"][i]}abled.`)}][c-64]()})}).add([73,10,0],(r,l)=>{let n=r[0],s=`MU1000 RS${t(e,$e)?"":" (ignored)"}: `;if(n<16)switch(n){case 2:{let i=e.chRedir(0,l,!0);t(e,$e)&&(e.dispatchEvent("portrange",4),e.dispatchEvent("portstart",i)),console.info(`${s}Show CH${i+1}~CH${i+64}`);break}case 3:{let i=e.chRedir(r[1]<<5,l,!0);t(e,$e)&&(e.dispatchEvent("portrange",2),e.dispatchEvent("portstart",i)),console.info(`${s}Show CH${i+1}~CH${i+32}`);break}default:console.debug(`${s}unknown switch ${n} invoked.`)}else if(n<32){if(t(e,$e)){let i=e.chRedir(n-16+(t(e,tt)<<4),l,!0);e.dispatchEvent("channelactive",i)}}else if(n<36){let i=e.chRedir(n-32<<4,l,!0);t(e,$e)&&(e.dispatchEvent("portrange",1),e.dispatchEvent("portstart",i>>4),x(e,tt,n-32)),console.info(`${s}Show CH${i+1}~CH${i+16}`)}}).add([73,11,0],(r,l)=>{let n="MU1000 System - channel ",s="Octavia System - channel ",i=r[0];r.subarray(1).forEach((o,c)=>{let d=i+c;([()=>{e.setChActive(o,1),e.dispatchEvent("channelactive",o),O()&&console.debug(`${n}current part: CH${o+1}`)},()=>{o<5?(e.dispatchEvent("portrange",1<<o),console.debug(`${n}port range: ${1<<o} port(s)`)):(e.dispatchEvent("portrange",0),console.debug(`${n}port range: reset`))},()=>{o<16?(e.dispatchEvent("portstart",o),console.debug(`${s}start port: ${"ABCDEFGHIJKLMNOP"[o]}`)):(e.dispatchEvent("portstart",255),console.debug(`${s}start port: reset`))}][d]||(()=>{console.debug(`${n}unknown address: ${d}`)}))()})}).add([93,3],(r,l)=>{let n=e.chRedir(r[0],l,!0),s=`PLG-SG CH${n+1} `,i=Date.now();if(r[1]==0){let o="",c=0;r.subarray(2).forEach((d,h)=>{h%2==0?o+=Ut[d]||d.toString().padStart("0"):c+=d*13}),i>=t(e,et)&&this.dispatchEvent("metacommit",{type:"SGLyrics",data:"",amend:!1}),this.dispatchEvent("metacommit",{type:"SGLyrics",data:`${Ht(o)}`,amend:!0}),x(e,et,i+Math.ceil(c/2)+t(e,je)),O()&&console.debug(`${s}vocals: ${o}`)}else console.warn(`Unknown PLG-SG data: ${r}`)}).add([98,0],(r,l,n)=>{e.dispatchEvent("mupromptex");let s=r[0],i=r.length-5,o=r.length-1;if(s!=i){console.info(`PLG-DX native dump size mismatch! Gave ${s} instead of ${r.length-5}.`);return}let c=Pe(r.subarray(4,o));if(c!=r[o]){console.info(`Bad PLG-DX checksum ${r[o]} - should be ${c}.`);return}r[0]=98,t(e,oe).run(r.subarray(0,o),l,n,{noAce:!0})}).add([98,96],(r,l,n,s)=>{let i=e.chRedir(r[0],l,!0),o=B[i],c=r[1];r.subarray(2).forEach((d,h)=>{let E=c+h;if(!(E<10)){if(E==10)e.resetAce();else if(E<27){let y=E+131;s!=null&&s.noAce||e.allocateAce(i,y),e.setChCc(i,y,d),e.dispatchEvent("cc",{part:i,cc:y,data:d})}}})}).add([100,0],(r,l,n)=>{let s=r.subarray(0,r.length-1);if(r[0]+5!=r.length){console.warn(`Yamaha DX7+ dump SysEx size mismatch! Expected ${r.length}, but got ${r[0]}:
`,r);return}let i=Pe(s),o=r[r.length-1];if(i!=o){console.warn(`Yamaha DX7+ dump SysEx checksum mismatch! Expected ${i}, but got ${o}:
`,r);return}a.run(s.subarray(1))}).add([100,76],(r,l,n)=>{let s=r[0]>>4,i=r[0]&15,o=r[1];switch(s){case 2:{let c=e.chRedir(i,l,!0),d=B[c];r.subarray(2).forEach((h,E)=>{let y=E+o;if(!(y<7)){if(y<23){let T=y+135;e.allocateAce(c,T),e.setChCc(c,T,h),e.dispatchEvent("cc",{part:c,cc:T,data:h})}}});break}default:console.info("Unknown DX7+ multipart: %o",r)}}).add([1,20],(r,l,n)=>{n==115?(e.switchMode("doc",!0),e.setPortMode(e.getTrackPort(l),1,w.doc),console.info("MIDI reset: DOC")):console.debug(`Unknown Yamaha SysEx: 67, ${n}, ${r.join(", ")}`)}).add([1,17,15,89],(r,l,n)=>{n==115?(e.setEffectType(0,24,r[0]|16),e.dispatchEvent("efxreverb",e.getEffectType(0))):console.debug(`Unknown Yamaha SysEx: 67, ${n}, ${r.join(", ")}`)}).add([1,24],(r,l,n)=>{if(n==115){for(let s=0;s<16;s++){let i=e.chRedir(s,l,!0);e.setChCc(i,91,127)}console.info("DOC Global Reverb: on")}else console.debug(`Unknown Yamaha SysEx: 67, ${n}, ${r.join(", ")}`)}),a.add([14,31],(r,l,n)=>{e.setChCc(r[0],64,0),t(e,F).ano(r[0]),e.switchMode("xg"),e.setPortMode(e.getTrackPort(l),1,w.xg),e.resetAce(),console.debug(`Yamaha DX7+ reset CH${r[0]+1}.`)}).add([76,112],async r=>{let l=r[0],n=B[l],s=Yt[l],i=g.cvn*l;t(e,ie)[s]=e.EXT_DX,t(e,ge)[l]=1;let o=t(e,ot).subarray(i,i+g.cvn);o.fill(32),r.subarray(1).forEach((c,d)=>{if(d<10)o[d]=Math.max(c,32);else if(!(d<40)){if(d<56){let h=d+102;e.setChCc(l,h,c),e.dispatchEvent("cc",{part:l,cc:h,data:c})}}}),t(e,L)[l]=l&127,e.setChCc(l,0,35),e.setChCc(l,32,l>>7|4),e.pushChPrimitives(l),e.dispatchEvent("voice",{part:l}),console.debug(`DX7+ CH${l+1} dump: %o`,r)});let u=function(r,l,n,s){},p=function(r,l){e.dispatchEvent("mupromptex");let n=r*g.dpn,s=l[0],i=l[1];l.subarray(2).forEach((o,c)=>{let d=c+i,h=-1;d<16?([()=>{h=24},()=>{h=25},()=>{h=26},()=>{},()=>{h=28},()=>{h=29},()=>{h=30},()=>{h=31},()=>{},()=>{},()=>{},()=>{h=20},()=>{h=21},()=>{h=22},()=>{h=23},()=>{}][d]||(()=>{console.debug(`Unknown XG-style drum param ${d} on set ${r+1}.`)}))():d<32||(d<40?([()=>{h=48},()=>{h=49},!1,!1,()=>{h=52},()=>{h=53}][d-32]||(()=>{console.debug(`Unknown XG-style drum param ${d} on set ${r+1}.`)}))():d<80||([()=>{h=36}][d-80]||(()=>{console.debug(`Unknown XG-style drum param ${d} on set ${r+1}.`)}))()),h>=0?(O()&&console.debug(n,h,s,o),t(e,ee)[(n+ue[h])*g.dnc+s]=o):O()&&console.debug(`XG-style drum param ${d} has no writes.`)})},$=function(r,l,n){e.dispatchEvent("mupromptex");let s=r*g.dpn,i=(l<<7)+n[0];n.subarray(1).forEach((o,c)=>{let d=c+i,h=d&127,E=d>>7,y=-1;E>1&&([()=>{y=26},()=>{},()=>{y=28},()=>{y=29},()=>{y=30},()=>{},()=>{},()=>{y=31}][E-2]||(()=>{console.debug(`Unknown GS-style drum param ${E} on set ${r+1}.`)}))(),y>-1?(O()&&console.debug(s,y,h,o),t(e,ee)[(s+ue[y])*g.dnc+h]=o):O()&&console.debug(`GS-style drum param ${E} has no writes.`)})};t(this,oe).add([76,48],(r,l,n)=>{p(0,r)}).add([76,49],(r,l,n)=>{p(1,r)}).add([76,50],(r,l,n)=>{p(2,r)}).add([76,51],(r,l,n)=>{p(3,r)}).add([76,52],(r,l,n)=>{p(4,r)}).add([76,53],(r,l,n)=>{p(5,r)}).add([76,54],(r,l,n)=>{p(6,r)}).add([76,55],(r,l,n)=>{p(7,r)}),t(this,oe).add([89,0],(r,l,n)=>{if(e.eprom){let s=r[0],i=(r[1]<<14)+(r[2]<<7)+r[3]+(e.eprom.offset||0);O()&&console.debug(`MU1000 EPROM trail to 0x${i.toString(16).padStart(6,"0")}, ${s} bytes.`);let o=e.eprom.data;r.subarray(4).forEach((c,d)=>{let h=d>>3,E=d&7;if(E==7)for(let y=0;y<7;y++)o[i+7*h+y]+=(c>>6-y&1)<<7;else o[i+7*h+E]=c})}}).add([89,1],(r,l,n)=>{let s=(r[0]<<21)+(r[1]<<14)+(r[2]<<7)+r[3];O()&&console.debug(`MU1000 EPROM jump to 0x${s.toString(16).padStart(6,"0")}.`),e.eprom&&(e.eprom.offset=s)}).add([89,2],(r,l,n)=>{if(e.eprom){let s=(r[0]<<21)+(r[1]<<14)+(r[2]<<7)+r[3]+(e.eprom.offset||0);O()&&console.debug(`MU1000 EPROM write to 0x${s.toString(16).padStart(6,"0")}.`);let i=e.eprom.data;r.subarray(4).forEach((o,c)=>{let d=c>>3,h=c&7;if(h==7)for(let E=0;E<7;E++)i[s+7*d+E]+=(o>>6-E&1)<<7;else i[s+7*d+h]=o})}}).add([89,3],(r,l,n)=>{}),t(this,oe).add([39,48],(r,l,n)=>{}).add([43,0,0],(r,l,n)=>{e.dispatchEvent("mupromptex");let s=[0,0,0,0],i=(o,c)=>{s[c]=o};if(r.subarray(1).forEach((o,c)=>{let d=c+r[0];[i,i,i,i,()=>{x(this,I,o*129/16383*100),e.dispatchEvent("mastervolume",t(e,I))},()=>o-64,()=>o||128,()=>o,()=>o,()=>{console.debug(`TG300 variation on cc${o}.`)}][d](o,d)}),r[0]<4){let o=0;s.forEach(c=>{o=o<<4,o+=c}),o-=1024}}).add([43,1,0],(r,l,n)=>{e.dispatchEvent("mupromptex")}).add([43,2],(r,l,n)=>{e.dispatchEvent("mupromptex");let s=e.chRedir(r[0],l,!0),i=r[1],o=B[s],c=`TG300 CH${s+1} `;r.subarray(2).forEach((d,h)=>{h<5?([()=>{},()=>{e.setChCc(s,0,d),e.pushChPrimitives(s),e.dispatchEvent("voice",{part:s})},()=>{e.setChCc(s,32,d),e.pushChPrimitives(s),e.dispatchEvent("voice",{part:s})},()=>{t(e,L)[s]=d,e.dispatchEvent("voice",{part:s})},()=>{let E=e.chRedir(d,l,!0);t(e,K)[s]=E,s!=E&&(e.buildRchTree(),console.info(`${c}receives from CH${E+1}`))}][h+i]||(()=>{}))(d,h+i):h<21||(h<47?([()=>{t(e,se)[s]=+!d},()=>{},()=>{},()=>{t(e,D)[g.rpn*s+3]=d,t(e,H)[g.rpnt*s+2]=1,e.dispatchEvent("pitch",{part:s,pitch:e.getPitchShift(s)})},()=>{},()=>{e.setChCc(s,7,d)},!1,!1,()=>{e.setChCc(s,10,d||128)},!1,!1,()=>{console.debug(`${c} AC1 at cc${d}`)},()=>{console.debug(`${c} AC2 at cc${d}`)},()=>{t(e,m)[o+v[128]]=d,e.allocateAce(s,128)},()=>{t(e,m)[o+v[93]]=d},()=>{t(e,m)[o+v[91]]=d},()=>{t(e,m)[o+v[94]]=d},()=>{t(e,m)[o+v[76]]=d},()=>{t(e,m)[o+v[77]]=d},()=>{t(e,m)[o+v[74]]=d},()=>{t(e,m)[o+v[71]]=d},()=>{t(e,m)[o+v[73]]=d},()=>{t(e,m)[o+v[75]]=d},()=>{t(e,m)[o+v[72]]=d},()=>{t(e,m)[o+v[78]]=d}][h+i-21]||(()=>{}))(d,h+i):h<95||([()=>{t(e,m)[o+v[65]]=d},()=>{t(e,m)[o+v[5]]=d}][h+i-95]||(()=>{}))(d,h+i))})}).add([43,7,0],(r,l,n)=>{let s=r[0];e.setLetterDisplay(r.subarray(1),"TG300 letter display",s)}).add([43,7,1],(r,l,n)=>{x(e,J,0),x(e,pe,Date.now()+3200),t(e,le,ke).fill(0),r.forEach(function(s,i){let o=Math.floor(i/16),c=i%16,d=(c*3+o)*7,h=7,E=0;for(d-=c*5,o==2&&(h=2);E<h;)t(e,le,ke)[d+E]=s>>6-E&1,E++})}),t(this,he).add([66,18,0,0,127],(r,l,n)=>{e.switchMode("sc",!0),e.setPortMode(e.getTrackPort(l),2,w.sc),t(e,V)[w.sc][1]=t(e,U).sc,x(e,G,!1),t(e,Te).fill(0),console.info(`GS system to ${["single","dual"][r[0]]} mode.`)}).add([66,18,64,0],(r,l,n)=>{switch(r[0]){case 127:{e.switchMode("gs",!0),e.setPortMode(e.getTrackPort(l),2,w.gs),t(e,V)[w.gs][1]=t(e,U).gs,x(e,G,!1),t(e,Te).fill(0),console.info("MIDI reset: GS");break}default:{e.dispatchEvent("mupromptex");let s=[0,0,0,0],i=(o,c)=>{s[c]=o};if(r.subarray(1).forEach((o,c)=>{let d=c+r[0];[i,i,i,i,h=>{x(this,I,h*129/16383*100),e.dispatchEvent("mastervolume",t(e,I))},h=>{},h=>{}][d](o,c)}),r[0]<4){let o=0;s.forEach(c=>{o=o<<4,o+=c}),o-=1024}}}}).add([66,18,64,1],(r,l,n)=>{e.dispatchEvent("mupromptex");let s=r[0];if(s<16){let i="".padStart(s," ");r.subarray(1).forEach((o,c)=>{i+=String.fromCharCode(Math.max(32,o))}),i=i.padEnd(16," "),console.debug(`GS patch name: ${i}`)}else s<48||(s<65?r.subarray(1).forEach((i,o)=>{let c=`GS ${s+o>55?"chorus":"reverb"} `;([()=>{console.info(`${c}type: ${vt[i]}`),e.setEffectType(0,40,i),e.dispatchEvent("efxreverb",e.getEffectType(0))},()=>{},()=>{},()=>{},()=>{},()=>{},!1,()=>{console.debug(`${c}predelay: ${i}ms`)},()=>{console.info(`${c}type: ${Nt[i]}`),e.setEffectType(1,40,16+i),e.dispatchEvent("efxchorus",e.getEffectType(1))},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{console.debug(`${c}to reverb: ${re(i)}`)},()=>{console.debug(`${c}to delay: ${re(i)}`)}][s+o-48]||(()=>{}))()}):s<80?console.debug(`Unknown GS patch address: ${s}`):s<91?r.subarray(1).forEach((i,o)=>{let c="GS delay ";([()=>{console.info(`${c}type: ${It[i]}`),e.setEffectType(2,40,32+i),e.dispatchEvent("efxdelay",e.getEffectType(2))},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{console.debug(`${c}to reverb: ${re(i)}`)}][s+o-80]||(()=>{}))()}):console.debug(`Unknown GS patch address: ${s}`))}).add([66,18,64,2],(r,l,n)=>{let s="GS EQ ";r.subarray(1).forEach((i,o)=>{([()=>{console.debug(`${s}low freq: ${[200,400][i]}Hz`)},()=>{console.debug(`${s}low gain: ${i-64}dB`)},()=>{console.debug(`${s}high freq: ${[3e3,6e3][i]}Hz`)},()=>{console.debug(`${s}high gain: ${i-64}dB`)}][r[0]+o]||function(){console.warn(`Unknown GS EQ address: ${r[0]+o}`)})()})}).add([66,18,64,3],(r,l,n)=>{e.dispatchEvent("mupromptex");let s="GS EFX ",i=function(o,c){let d=Gt(t(e,ne).subarray(10,12),c,o);d&&console.debug(`${s}${$t(t(e,ne).subarray(10,12))} ${d}`)};r.subarray(1).forEach((o,c)=>{([()=>{e.setEffectTypeRaw(3,!1,32+o),e.dispatchEvent("efxinsert0",e.getEffectType(3))},()=>{e.setEffectTypeRaw(3,!0,o),console.info(`${s}type: ${$t(t(e,ne).subarray(10,12))}`),e.dispatchEvent("efxinsert0",e.getEffectType(3))},!1,i,i,i,i,i,i,i,i,i,i,i,i,i,i,i,i,i,i,i,i,()=>{console.debug(`${s}to reverb: ${re(o)}dB`)},()=>{console.debug(`${s}to chorus: ${re(o)}dB`)},()=>{console.debug(`${s}to delay: ${re(o)}dB`)},!1,()=>{console.debug(`${s}1 source: ${o}`),o&&o<96&&e.allocateAceAll(o)},()=>{console.debug(`${s}1 depth: ${o-64}`)},()=>{console.debug(`${s}2 source: ${o}`),o&&o<96&&e.allocateAceAll(o)},()=>{console.debug(`${s}2 depth: ${o-64}`)},()=>{console.debug(`${s}to EQ: ${o?"ON":"OFF"}`)}][r[0]+c]||function(d,h){console.warn(`Unknown GS EFX address: ${h}`)})(o,r[0]+c)})}).add([66,18,65],(r,l,n)=>{$((r[0]>>4)+1<<1,r[0]&15,r.subarray(1))}).add([69,18,16],(r,l,n)=>{var s;switch(r[0]){case 0:{let i=r[1];e.setLetterDisplay(r.subarray(2),"GS display text",i);break}case 8:{let i=r[1],o=e.modelEx.sc;r.subarray(2).forEach((c,d)=>{([()=>{o.showBar=!(c&1),o.invBar=c>>1&1,o.invDisp=c>>2&1},()=>{o.peakHold=c<4?c:1}][d+i]||(()=>{console.debug("Unsupported GS display type SysEx.")}))()});break}case 32:{x(e,pe,Date.now()+3200),r[1]==0&&(r[2]?(x(e,J,Math.max(Math.min(r[2]-1,9),0)),O()&&console.debug(`GS switch display page ${r[2]-1}.`)):(x(e,J,0),x(e,pe,Date.now()),O()&&console.debug("GS disable display page.")));break}default:if(r[0]<6){t(e,J)>9&&x(e,J,0);let i=r[0]-1<<1|r[1]>>6;t(e,J)==i&&x(e,pe,Date.now()+3200),(s=t(e,xe)[i])!=null&&s.length||(t(e,xe)[i]=new Uint8Array(256));let o=t(e,xe)[i];O()&&console.debug(`GS frame draw page ${i}.`);let c=r[1]&63;o.fill(0),r.subarray(2).forEach(function(h,E){let y=E+c,T=Math.floor(y/16),A=y%16,M=(A*4+T)*5,Me=5,we=0;for(M-=A*4,T==3&&(Me=1);we<Me;)o[M+we]=h>>4-we&1,we++})}else console.warn(`Unknown GS display section: ${r[0]}`)}}).add([69,18,32],(r,l,n)=>{let s=r[0],i=r[1],o=r.subarray(2);if(s>>4){console.warn(`SC-8850 partial screen dump out of bounds: invalid bundle.
`,r);return}let c=i+o.length,d=i*6-(i*2428>>16<<1),h=c*6-(c*2428>>16<<1);if(d>640){console.warn(`SC-8850 partial screen dump out of bounds: invalid buffer range.
`,r);return}h>640&&(console.info(`SC-8850 partial screen dump out of bounds: invalid buffer end, automatically restricted.
`,r),h=640);let E=new Uint8Array(h-d);o.forEach((A,M)=>{let Me=M+i,we=(Me*2428&65535)*27>>16==26,q=Me*6-(Me*2428>>16<<1),We=we?2:0;for(;We<6;)E[q+(5-We)]=A>>We&1,We++});let y=s*108+i,T=y*6-(y*2428>>16<<1);e.dispatchEvent("screen",{type:"sc8850",offset:T,data:E}),O()&&console.debug(`SC-8850 screen dump: bundle ${s+1}, range ${d}~${h}`)});let C=function(r,l,n){e.dispatchEvent("mupromptex");let s=r[0],i=B[l],o=ut[l],c=`GS CH${l+1} `;s<3?(r.subarray(1).forEach((d,h)=>{[()=>{t(e,m)[i+v[0]]=d,e.pushChPrimitives(l)},()=>{t(e,L)[l]=d},()=>{let E=0;d<16?E=e.chRedir(d,n,!0):E=g.ch,t(e,K)[l]=E,l!=E&&(e.buildRchTree(),console.info(`${c}receives from CH${E+1}`))}][s+h]()}),e.dispatchEvent("voice",{part:l})):s<19||(s<44?r.subarray(1).forEach((d,h)=>{([()=>{t(e,se)[l]=+!d},!1,()=>{e.setChType(l,d<<1,w.gs),console.debug(`${c}type: ${d?"drum ":"melodic"}${d||""}`)},()=>{t(e,D)[o+3]=d,t(e,H)[g.rpnt*l+2]=1,e.dispatchEvent("pitch",{part:l,pitch:e.getPitchShift(l)})},!1,()=>{t(e,m)[i+v[7]]=d},!1,!1,()=>{t(e,m)[i+v[10]]=d||128},!1,!1,()=>{console.debug(`${c}CC 1: cc${d}`)},()=>{console.debug(`${c}CC 2: cc${d}`)},()=>{t(e,m)[i+v[93]]=d},()=>{t(e,m)[i+v[91]]=d},!1,!1,()=>{t(e,D)[o+1]=d,t(e,H)[g.rpnt*l+1]=1,e.dispatchEvent("pitch",{part:l,pitch:e.getPitchShift(l)})},()=>{t(e,D)[o+2]=d,t(e,H)[g.rpnt*l+1]=1,e.dispatchEvent("pitch",{part:l,pitch:e.getPitchShift(l)})},()=>{t(e,m)[i+v[94]]=d}][s+h-19]||(()=>{}))()}):s<76||console.debug(`Unknown GS part address: ${s}`))},k=function(r,l){let n=r[0],s=`GS CH${l+1} `;n<2?r.subarray(1).forEach((i,o)=>{[()=>{e.setChCc(l,32,i)},()=>{}][n+o]()}):n<32?console.warn(`Unknown GS misc address: ${n}`):n<35?r.subarray(1).forEach((i,o)=>{[()=>{console.debug(`${s}EQ: o${["ff","n"][i]}`)},()=>{},()=>{console.debug(`${s}EFX: o${["ff","n"][i]}`),t(e,Je)[l]=i,e.dispatchEvent("partefxtoggle",{part:l,active:i})}][n+o-32]()}):console.warn(`Unknown GS misc address: ${n}`)};t(this,he).add([66,18,64,16],(r,l)=>{C(r,e.chRedir(9,l,!0),l)}).add([66,18,64,17],(r,l)=>{C(r,e.chRedir(0,l,!0),l)}).add([66,18,64,18],(r,l)=>{C(r,e.chRedir(1,l,!0),l)}).add([66,18,64,19],(r,l)=>{C(r,e.chRedir(2,l,!0),l)}).add([66,18,64,20],(r,l)=>{C(r,e.chRedir(3,l,!0),l)}).add([66,18,64,21],(r,l)=>{C(r,e.chRedir(4,l,!0),l)}).add([66,18,64,22],(r,l)=>{C(r,e.chRedir(5,l,!0),l)}).add([66,18,64,23],(r,l)=>{C(r,e.chRedir(6,l,!0),l)}).add([66,18,64,24],(r,l)=>{C(r,e.chRedir(7,l,!0),l)}).add([66,18,64,25],(r,l)=>{C(r,e.chRedir(8,l,!0),l)}).add([66,18,64,26],(r,l)=>{C(r,e.chRedir(10,l,!0),l)}).add([66,18,64,27],(r,l)=>{C(r,e.chRedir(11,l,!0),l)}).add([66,18,64,28],(r,l)=>{C(r,e.chRedir(12,l,!0),l)}).add([66,18,64,29],(r,l)=>{C(r,e.chRedir(13,l,!0),l)}).add([66,18,64,30],(r,l)=>{C(r,e.chRedir(14,l,!0),l)}).add([66,18,64,31],(r,l)=>{C(r,e.chRedir(15,l,!0),l)}).add([66,18,64,64],(r,l)=>{k(r,e.chRedir(9,l,!0))}).add([66,18,64,65],(r,l)=>{k(r,e.chRedir(0,l,!0))}).add([66,18,64,66],(r,l)=>{k(r,e.chRedir(1,l,!0))}).add([66,18,64,67],(r,l)=>{k(r,e.chRedir(2,l,!0))}).add([66,18,64,68],(r,l)=>{k(r,e.chRedir(3,l,!0))}).add([66,18,64,69],(r,l)=>{k(r,e.chRedir(4,l,!0))}).add([66,18,64,70],(r,l)=>{k(r,e.chRedir(5,l,!0))}).add([66,18,64,71],(r,l)=>{k(r,e.chRedir(6,l,!0))}).add([66,18,64,72],(r,l)=>{k(r,e.chRedir(7,l,!0))}).add([66,18,64,73],(r,l)=>{k(r,e.chRedir(8,l,!0))}).add([66,18,64,74],(r,l)=>{k(r,e.chRedir(10,l,!0))}).add([66,18,64,75],(r,l)=>{k(r,e.chRedir(11,l,!0))}).add([66,18,64,76],(r,l)=>{k(r,e.chRedir(12,l,!0))}).add([66,18,64,77],(r,l)=>{k(r,e.chRedir(13,l,!0))}).add([66,18,64,78],(r,l)=>{k(r,e.chRedir(14,l,!0))}).add([66,18,64,79],(r,l)=>{k(r,e.chRedir(15,l,!0))}),t(this,Ce).add([54,65],(r,l)=>{let n=t(e,U).x5=="81"?"05rw":"x5d";e.switchMode(n,!0),e.setPortMode(e.getTrackPort(l),1,w[n]);let s=r[r.length-1],i=r.subarray(0,r.length-1),o=Pe(i);o!=s&&(console.info(`X5D multi parameters checksum mismatch! Expected ${o}, got ${s}.`),console.debug(r));let c=(r[1]<<7)+r[0],d=(r[3]<<7)+r[2],h=e.chRedir(c&15,l,!0),E=B[h];[()=>{d<1||(d<101?(e.setChType(h,e.CH_MELODIC,w.x5d),t(e,L)[h]=d-1,t(e,m)[E+v[0]]=t(e,U).x5):d<229?(e.setChType(h,e.CH_MELODIC,w.x5d),t(e,L)[h]=d-101,t(e,m)[E+v[0]]=56):(e.setChType(h,e.CH_DRUMS,w.x5d),t(e,L)[h]=Wt[d-229]||0,t(e,m)[E+v[0]]=62)),e.pushChPrimitives(h),e.dispatchEvent("voice",{part:h})},()=>{t(e,m)[E+v[7]]=d},()=>{d<31&&(t(e,m)[E+v[10]]=Math.round((d-15)*4.2+64))},()=>{t(e,m)[E+v[93]]=nt(d)},()=>{t(e,m)[E+v[91]]=nt(d)},()=>{t(e,D)[h*g.rpn+3]=d>8191?d-16320:64+d,t(e,H)[g.rpnt*h+2]=1,e.dispatchEvent("pitch",{part:h,pitch:e.getPitchShift(h)})},()=>{t(e,D)[h*g.rpn+1]=d>8191?d-16320:64+d,t(e,H)[g.rpnt*h+1]=1,e.dispatchEvent("pitch",{part:h,pitch:e.getPitchShift(h)})},()=>{d>0&&(t(e,D)[h*g.rpn]=d,t(e,H)[g.rpnt*h]=1,e.dispatchEvent("pitch",{part:h,pitch:e.getPitchShift(h)}))},()=>{}][c>>4]()}).add([54,76,0],(r,l)=>{e.dispatchEvent("mupromptex");let n=t(e,U).x5=="81"?"05rw":"x5d";e.switchMode(n),e.setPortMode(e.getTrackPort(l),1,w[n]);let s="",i=t(e,U).x5,o=0,c=0,d="MSB	PRG	LSB	NME";fe(r,function(h,E){if(E<16400){let y=E%164;switch(!0){case y<10:{h>31&&(s+=String.fromCharCode(h));break}case y==10:break;case y==11:{d+=`
${i}	${o}	${c}	${s.trim().replace("Init Voice","")}`,o++,s="";break}}o>99&&(i=90,o=0)}}),e.userBank.clearRange({msb:t(e,U).x5,prg:[0,99],lsb:0}),e.userBank.load(d),O()&&console.debug(d),e.forceVoiceRefresh()}).add([54,77,0],(r,l)=>{e.dispatchEvent("mupromptex");let n=t(e,U).x5=="81"?"05rw":"x5d";e.switchMode(n),e.setPortMode(e.getTrackPort(l),1,w[n]);let s="",i=90,o=0,c=0,d="MSB	PRG	LSB	NME";fe(r,function(h,E){if(E<13600){let y=E%136;switch(!0){case y<10:{h>31&&(s+=String.fromCharCode(h));break}case y==11:{d+=`
${i}	${o}	${c}	${s.trim().replace("Init Combi","")}`,o++,s="";break}}}}),e.userBank.clearRange({msb:90,prg:[0,99],lsb:0}),e.userBank.load(d),O()&&console.debug(d),e.forceVoiceRefresh()}).add([54,78],(r,l)=>{let n=t(e,U).x5=="81"?"05rw":"x5d";e.switchMode(n),e.setPortMode(e.getTrackPort(l),1,w[n]),console.debug(`X5D mode switch requested: ${["combi","combi edit","prog","prog edit","multi","global"][r[0]]} mode.`)}).add([54,85],(r,l)=>{e.dispatchEvent("mupromptex");let n=t(e,U).x5=="81"?"05rw":"x5d";e.switchMode(n),e.setPortMode(e.getTrackPort(l),1,w[n]),fe(r,(s,i)=>{i>0&&i<3&&(e.setEffectType(i-1,44,s),e.dispatchEvent(`efx${["reverb","chorus"][i-1]}`,e.getEffectType(i-1)))})}).add([54,104],(r,l)=>{e.dispatchEvent("mupromptex");let n=t(e,U).x5=="81"?"05rw":"x5d";e.switchMode(n,!0);let s=e.getTrackPort(l);if(t(e,X)[s]&&t(e,X)[s]!=w[n])if(t(e,ve).dumpLimit==e.DUMP_MODE){console.warn(`Dump cancelled for track ${l}. Port ${String.fromCharCode(65+s)} mode "${_[t(e,X)[s]]}" mismatch, should be "${n}".`);return}else console.info(`Track ${l} is trying to perform a mismached mode dump on port ${String.fromCharCode(65+s)}.`);e.setPortMode(s,1,w[n]),fe(r,function(i,o,c,d){if(o<192){let h=e.chRedir(Math.floor(o/12),l,!0),E=B[h];switch(o%12){case 0:{i<128?(e.setChType(h,e.CH_MELODIC,w.x5d),t(e,m)[E+v[0]]=t(e,U).x5,t(e,L)[h]=i):(e.setChType(h,e.CH_DRUMS,w.x5d),t(e,m)[E+v[0]]=62,t(e,L)[h]=Wt[i-128]),i>0&&e.setChActive(h,1),e.pushChPrimitives(h),e.dispatchEvent("voice",{part:h});break}case 1:{t(e,m)[E+v[7]]=i;break}case 2:{t(e,D)[h*g.rpn+3]=i>127?i-192:64+i,t(e,H)[g.rpnt*h+2]=1,e.dispatchEvent("pitch",{part:h,pitch:e.getPitchShift(h)});break}case 3:{t(e,D)[h*g.rpn+1]=i>127?i-192:64+i,t(e,H)[g.rpnt*h+1]=1,e.dispatchEvent("pitch",{part:h,pitch:e.getPitchShift(h)});break}case 4:{i<31&&(t(e,m)[E+v[10]]=Math.round((i-15)*4.2+64));break}case 5:{let y=i>>4,T=i&15;t(e,m)[E+v[91]]=nt(T),t(e,m)[E+v[93]]=nt(y);break}case 10:{t(e,R)[h]||(t(e,m)[E+v[0]]=i>>6?56:t(e,U).x5,e.pushChPrimitives(h),e.dispatchEvent("voice",{part:h}));break}case 11:{let y=e.chRedir(i&15,l,!0),T=i>>4;t(e,K)[h]=i,(y!=h||T)&&(console.info(`X5D Part CH${h+1} receives from CH${y+1}.`),e.buildRchTree())}}}else{let h=e.chRedir(o-192,l,!0)}})}),t(this,he).add([22,18,127],(r,l,n)=>{e.switchMode("mt32",!0),e.setPortMode(e.getTrackPort(l),1,w.mt32),x(e,G,!1),e.userBank.clearRange({msb:0,lsb:127,prg:[0,127]}),console.info("MIDI reset: MT-32")}).add([22,18,0],(r,l,n)=>{e.switchMode("mt32");let s=e.chRedir(n,l,!0),i=r[1];r.subarray(2).forEach((o,c)=>{let d=c+i;t(e,Re)[d+(s-1)*16]=o,([!1,()=>{let h=t(e,Re)[s-1<<4];if(h<3){if(t(e,ge)[s]=1,h==2)for(let E=0;E<name.length;E++)t(e,Ee)[(s-1)*g.cmt+E]=t(e,De)[o*g.cmt+E];else{let E=e.baseBank.get(0,o+(h<<6),127,"mt32").name;for(let y=0;y<E.length;y++)t(e,Ee)[(s-1)*g.cmt+y]=E.charCodeAt(y)}e.dispatchEvent("voice",{part:s})}},()=>{t(e,D)[s*g.rpn+3]=o+40,t(e,H)[g.rpnt*s+2]=1},()=>{t(e,D)[s*g.rpn+1]=o+14,t(e,H)[g.rpnt*s+1]=1},()=>{t(e,D)[s*g.rpn]=o,t(e,H)[g.rpnt*s]=1},!1,()=>{e.setChCc(s,91,o?127:0)},!1,()=>{e.setChCc(s,7,o)},()=>{e.setChCc(s,10,Math.ceil(o*9.05))}][d]||(()=>{}))()})}).add([22,18,1],(r,l,n)=>{e.switchMode("mt32");let s=n&7;console.debug(`MT-32 slot #${n+1} Drum: ${r}`);let i=r[0]<<7|r[1];r.subarray(2).forEach((o,c)=>{let d=c+i,h=(d>>2)+24,E=d&3,y=s*g.dpn;if(O()&&console.debug(`MT-32 temp drum note ${h} param ${E}: ${o}`),h<24){console.warn(`MT-32 dev drum write attempted on an OOB note: ${h}`);return}[()=>{},()=>{t(e,ee)[(y+ue[26])*g.dnc+h]=Math.round(o*1.27)},()=>{t(e,ee)[(y+ue[26])*g.dnc+h]=o*9+1&127},()=>{t(e,ee)[(y+ue[26])*g.dnc+h]=o?127:0}][E]()})}).add([22,18,2],(r,l,n)=>{e.switchMode("mt32");let s=e.chRedir(n,l,!0),i=r[1]+(r[0]<<7);i<10&&(t(e,ge)[s]=1),r.subarray(2).forEach((o,c)=>{let d=c+i;d<14&&(t(e,Ee)[(s-1)*g.cmt+d]=o)}),e.dispatchEvent("voice",{part:s})}).add([22,18,3],(r,l,n)=>{e.switchMode("mt32");let s=n&7;if(r[0]){let i=(r[0]-1<<7)+r[1]-16;r.subarray(2).forEach((o,c)=>{let d=c+i,h=(d>>2)+24,E=d&3,y=s*g.dpn;if(O()&&console.debug(`MT-32 dev drum note ${h} param ${E}: ${o}`),h<24){console.warn(`MT-32 dev drum write attempted on an OOB note: ${h}`);return}[()=>{},()=>{t(e,ee)[(y+ue[26])*g.dnc+h]=Math.round(o*1.27)},()=>{t(e,ee)[(y+ue[26])*g.dnc+h]=o*9+1&127},()=>{t(e,ee)[(y+ue[26])*g.dnc+h]=o?127:0}][E]()})}else{let i=r[1];r.subarray(2).forEach((o,c)=>{let d=c+i;t(e,Re)[d]=o;let h=e.chRedir(1+(d>>4),l,!0),E=d&15;([!1,()=>{let y=t(e,Re)[h-1<<4];if(y<3)if(t(e,ge)[h]=1,y==2)for(let T=0;T<name.length;T++)t(e,Ee)[(h-1)*g.cmt+T]=t(e,De)[o*g.cmt+T];else{let T=e.baseBank.get(0,o+(y<<6),127,"mt32").name;for(let A=0;A<T.length;A++)t(e,Ee)[(h-1)*g.cmt+A]=T.charCodeAt(A)}e.dispatchEvent("voice",{part:h})},()=>{t(e,D)[h*g.rpn+3]=o+40,t(e,H)[g.rpnt*h+2]=1},()=>{t(e,D)[h*g.rpn+1]=o+14,t(e,H)[g.rpnt*h+1]=1},()=>{t(e,D)[h*g.rpn]=o,t(e,H)[g.rpnt*h]=1},!1,()=>{e.setChCc(h,91,o?127:0)},!1,()=>{e.setChCc(h,7,o)},()=>{e.setChCc(h,10,Math.ceil(o*9.05))}][E]||(()=>{}))()})}}).add([22,18,4],(r,l,n)=>{e.switchMode("mt32");let s=r[1]+(r[0]<<7),i=[];r.subarray(2).forEach((o,c)=>{let d=c+s,h=e.chRedir(Math.floor(d/246+1),l,!0),E=d%246;E<14&&(t(e,Ee)[(h-1)*g.cmt+E]=o),E<10&&(t(e,ge)[h]=1),i.indexOf(h)<0&&i.push(h)}),i.forEach(o=>{e.dispatchEvent("voice",{part:o})})}).add([22,18,5],(r,l,n)=>{e.switchMode("mt32");let s=(r[0]<<7)+r[1];r.subarray(2).forEach((i,o)=>{let c=s+o,d=Math.floor(c/8),h=c&7,E=d*8;t(e,Ze)[c]=i,([!1,()=>{let y=t(e,Ze)[E];if(y<3){let T="";if(y==2){let M=g.cmt*d;T=`MT-m:${i.toString().padStart(3,"0")}`}else T=e.baseBank.get(0,i+(y<<6),127,"mt32").name;e.userBank.clearRange({msb:0,lsb:127,prg:d});let A=`MSB	LSB	PRG	NME
49	127	${d}	${T}`;e.userBank.load(A,!0)}}][h]||(()=>{}))()}),e.forceVoiceRefresh()}).add([22,18,8],(r,l,n)=>{e.switchMode("mt32");let s=((r[0]&1)<<7)+r[1],i=r[0]>>1,o=!1;if(r.subarray(2).forEach((c,d)=>{let h=s+d;h<g.cmt&&(t(e,De)[i*g.cmt+h]=c,o=!0)}),o){e.userBank.clearRange({msb:0,lsb:127,prg:i});let c=`MSB	LSB	PRG	NME
49	127	${i}	MT-m:${i}`;e.userBank.load(c,!0)}e.forceVoiceRefresh()}).add([22,18,16],(r,l,n)=>{e.switchMode("mt32");let s=r[1],i=!1,o=function(c,d){t(e,K)[d-12]=c,i=!0};r.subarray(2).forEach((c,d)=>{let h=d+s;([!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,o,o,o,o,o,o,o,o,o,()=>{x(e,I,c),e.dispatchEvent("mastervolume",t(e,I))}][h]||(()=>{}))(c,d)}),i&&e.buildRchTree()}).add([22,18,32],(r,l,n)=>{e.switchMode("mt32");let s=r[1],i=" ".repeat(s);r.subarray(2).forEach(o=>{o>31?i+=String.fromCharCode(o):i+=" "}),x(e,Oe,i.padStart(20," ")),x(e,Ae,Date.now()+3200)}).add([22,18,82],(r,l)=>{let n=e.chRedir(0,l,!0);for(let s=0;s<16;s++)t(e,F).ano(n+s),s&&s<10&&(t(e,L)[n+s]=Ct[s-1]);console.info("MT-32 alt reset complete.")}),t(this,Ce).add([66,0],(r,l)=>{e.switchMode("ns5r",!0),e.setPortMode(e.getTrackPort(l),2,w.ns5r),x(e,G,!1),console.debug(`NS5R mode switch requested: ${["global","multi","prog edit","comb edit","drum edit","effect edit"][r[0]]} mode.`)}).add([66,1],(r,l)=>{let n=["ns5r","05rw"][r[0]];e.switchMode(n,!0),e.setPortMode(e.getTrackPort(l),2,w[n]),x(e,G,!1)}).add([66,18,0,0],(r,l)=>{let n=r[0];switch(n){case 124:case 126:case 127:{e.switchMode("ns5r",!0),e.setPortMode(e.getTrackPort(l),2,w.ns5r),x(e,G,!1);break}case 125:{e.initDrums(),console.info(`NS5R drum setup reset: ${r}`);break}default:if(n<10){let s=[0,0,0,0],i=(o,c)=>{s[c]=o};if(r.subarray(1).forEach((o,c)=>{[i,i,i,i,()=>{x(e,I,o*129/16383*100),e.dispatchEvent("mastervolume",t(e,I))},()=>o-64,()=>o-64,()=>{},()=>{},()=>{}][n+c]()}),r[0]<4){let o=0;s.forEach(c=>{o=o<<4,o+=c}),o-=1024}}}}).add([66,18,0,1],(r,l)=>{}).add([66,18,0,2],(r,l)=>{}).add([66,18,1],(r,l)=>{e.dispatchEvent("mupromptex");let n=e.chRedir(r[0],l,!0),s=B[n],i=r[1],o=`NS5R CH${n+1} `;r.subarray(2).forEach((c,d)=>{let h=i+d;h<3?([()=>{t(e,m)[s+v[0]]=c||ct.bank0,e.pushChPrimitives(n)},()=>{t(e,m)[s+v[32]]=c,e.pushChPrimitives(n)},()=>{t(e,L)[n]=c}][h](),e.dispatchEvent("voice",{part:n})):h<8||(h<14?[()=>{let E=e.chRedir(c,l,!0);t(e,K)[n]=E,n!=E&&(e.buildRchTree(),console.info(`${o}receives from CH${E+1}`))},()=>{t(e,se)[n]=+!c},()=>{e.setChType(n,c,w.ns5r),console.debug(`${o}type: ${it[c]}`)},()=>{t(e,D)[g.rpn*n+3]=c,t(e,H)[g.rpnt*n+2]=1,e.dispatchEvent("pitch",{part:n,pitch:e.getPitchShift(n)})},()=>{},()=>{}][h-8]():h<16||(h<33?[()=>{t(e,m)[s+v[7]]=c},()=>{t(e,m)[s+v[11]]=c},()=>{},()=>{},()=>{t(e,m)[s+v[10]]=c||128},()=>{},()=>{},()=>{t(e,m)[s+v[93]]=c},()=>{t(e,m)[s+v[91]]=c},()=>{t(e,m)[s+v[76]]=c},()=>{t(e,m)[s+v[77]]=c},()=>{t(e,m)[s+v[78]]=c},()=>{t(e,m)[s+v[74]]=c},()=>{t(e,m)[s+v[71]]=c},()=>{t(e,m)[s+v[73]]=c},()=>{t(e,m)[s+v[75]]=c},()=>{t(e,m)[s+v[72]]=c}][h-16]():h<112||h<114&&[()=>{t(e,m)[s+v[5]]=c},()=>{t(e,m)[s+v[65]]=c}][h-112]()))})}).add([66,18,8,0],(r,l)=>{let n=r[0];if(n<32)e.setLetterDisplay(r.subarray(1,33),"NS5R letter display");else{let s=n-32;x(e,pe,Date.now()+3200),x(e,J,10),t(e,le,ke).fill(0);let i=r.subarray(1),o=4;i.forEach(function(c,d){let h=d+s,E=h>>4,y=h&15;if(h<80){let T=E<o?c:c>>3,A=0,M=E<o?6:3;for(;T>0;)t(e,le,ke)[y*32+E*7+(M-A)]=T&1,T=T>>1,A++}})}}).add([66,18,48],(r,l,n)=>{p(0,r)}).add([66,18,49],(r,l,n)=>{p(1,r)}).add([66,18,50],(r,l,n)=>{p(2,r)}).add([66,18,51],(r,l,n)=>{p(3,r)}).add([66,18,52],(r,l,n)=>{p(4,r)}).add([66,18,53],(r,l,n)=>{p(5,r)}).add([66,18,54],(r,l,n)=>{p(6,r)}).add([66,18,55],(r,l,n)=>{p(7,r)}).add([66,52],(r,l)=>{e.switchMode("ns5r"),x(e,G,!1);let n="";fe(r,(s,i)=>{i<8?(s>31&&(n+=String.fromCharCode(s)),i==7&&(e.aiEfxName=n)):i<10&&(e.setEffectType(i-8,44,s),e.dispatchEvent(`efx${["reverb","chorus"][i-8]}`,e.getEffectType(i-8)))})}).add([66,53],(r,l)=>{e.dispatchEvent("mupromptex"),e.switchMode("ns5r"),x(e,G,!1);let n="",s=r[r.length-1],i=r.subarray(0,r.length-1),o=Pe(i);o!=s&&(console.info(`NS5R current multi dump checksum mismatch! Expected ${o}, got ${s}.`),console.debug(r));let c=e.getTrackPort(l);if(t(e,X)[c]&&t(e,X)[c]!=w.ns5r)if(t(e,ve).dumpLimit==e.DUMP_MODE){console.warn(`Dump cancelled for track ${l}. Port ${String.fromCharCode(65+c)} mode "${_[t(e,X)[c]]}" mismatch, should be "ns5r".`);return}else console.info(`Track ${l} is trying to perform a mismached mode dump on port ${String.fromCharCode(65+c)}.`);e.setPortMode(c,2,w.ns5r),fe(i,function(d,h){switch(!0){case h<2944:{let E=e.chRedir(Math.floor(h/92),l,!0),y=B[E];switch(h%92){case 0:{t(e,m)[y+v[0]]=d,e.pushChPrimitives(E),e.dispatchEvent("voice",{part:E});break}case 1:{t(e,m)[y+v[32]]=d,!d&&!t(e,m)[y+v[0]]&&(t(e,m)[y+v[0]]=ct.bank0),e.pushChPrimitives(E),e.dispatchEvent("voice",{part:E});break}case 2:{t(e,L)[E]=d,d>0&&e.setChActive(E,1),e.dispatchEvent("voice",{part:E});break}case 3:{let T=e.chRedir(d,l,!0);t(e,K)[E]=T,E!=T&&(console.info(`NS5R CH${E+1} receives from CH${T+1}.`),e.buildRchTree());break}case 7:{t(e,R)[E]=d,e.dispatchEvent("voice",{part:E});break}case 8:{t(e,D)[E*g.rpn+3]=d<40||d>88?d+(d>63?-192:64):d,t(e,H)[g.rpnt*E+2]=1,e.dispatchEvent("pitch",{part:E,pitch:e.getPitchShift(E)});break}case 9:case 10:{t(e,m)[y+v[7]]=d;break}case 11:{t(e,m)[y+v[11]]=d;break}case 14:{t(e,m)[y+v[10]]=d||128;break}case 19:{t(e,m)[y+v[93]]=d;break}case 20:{t(e,m)[y+v[91]]=d;break}case 84:{t(e,m)[y+v[65]]=d;break}case 85:{t(e,m)[y+v[5]]=d;break}}break}case h<3096:break;case h<3134:{let E=h-3096;E<8?(d>31&&(n+=String.fromCharCode(d)),E==7&&(e.aiEfxName=n)):E<10&&(e.setEffectType(E-8,44,d),e.dispatchEvent(`efx${["reverb","chorus"][E-8]}`,e.getEffectType(E-8)));break}case h<8566:break}})}).add([66,54],(r,l)=>{e.dispatchEvent("mupromptex"),e.switchMode("ns5r");let n="",s=80,i=0,o=0,c="MSB	PRG	LSB	NME";fe(r,function(d,h){let E=h%158;switch(!0){case E<10:{d>31&&(n+=String.fromCharCode(d));break}case E==10:break;case E==11:{s=d&127;break}case E==12:{o=d&127;break}case E==13:{c+=`
${s}	${i}	${o}	${n.trim().replace("Init Voice","")}`,i++,n="";break}}}),e.userBank.clearRange({msb:80,lsb:0}),e.userBank.load(c),O()&&console.debug(c),e.forceVoiceRefresh()}).add([66,55],(r,l)=>{e.dispatchEvent("mupromptex"),e.switchMode("ns5r");let n="",s=88,i=0,o=0,c="MSB	PRG	LSB	NME";fe(r,function(d,h){let E=h%126;switch(!0){case E<10:{d>31&&(n+=String.fromCharCode(d));break}case E==11:break;case E==12:break;case E==13:{c+=`
${s}	${i}	${o}	${n.trim().replace("Init Combi","")}`,i++,n="";break}}}),e.userBank.clearRange({msb:88,lsb:0}),e.userBank.load(c),O()&&console.debug(c),e.forceVoiceRefresh()}).add([66,125],(r,l,n)=>{e.dispatchEvent("backlight",["green","orange","red",!1,"yellow","blue","purple"][r[0]]||"white")}).add([66,127],(r,l,n)=>{let s=r[r.length-1],i=r.subarray(0,r.length-1),o=Pe(i);o!=s&&(console.info(`NS5R screen dump checksum mismatch! Expected ${o}, got ${s}.`),console.debug(r));let c=new Uint8Array(5760);fe(r,(d,h,E)=>{if(h<720)for(let y=0;y<8;y++)c[h*8+y]=d>>7-y&1}),e.dispatchEvent("screen",{type:"ns5r",data:c})}).add([76],(r,l,n)=>{t(e,Ce).run([66,...r],l,n)}),t(this,Fe).add([16,0,8,0],(r,l,n)=>{let s=(r[2]<<4)+r[3],i="K11 ";([()=>{e.switchMode("k11",!0),e.setPortMode(e.getTrackPort(l),2,w.k11),x(e,G,!1),t(e,V)[w.k11][1]=s?4:0,console.info("MIDI reset: GMega/K11")},()=>{e.setEffectType(0,24,s),console.debug(`${i}reverb type: ${s}`),e.dispatchEvent("efxreverb",e.getEffectType(0))},()=>{console.debug(`${i}reverb time: ${s}`)},()=>{console.debug(`${i}reverb time: ${s}`)},()=>{console.debug(`${i}reverb predelay: ${s}`)},()=>{console.debug(`${i}reverb predelay: ${s}`)},()=>{console.debug(`${i}depth high: ${s}`)},()=>{console.debug(`${i}depth high: ${s}`)},()=>{console.debug(`${i}depth low: ${s}`)},()=>{console.debug(`${i}depth low: ${s}`)}][r[0]]||(()=>{}))()}).add([16,0,8,1],(r,l,n)=>{e.dispatchEvent("mupromptex");let s=e.chRedir(r[1],l,!0),i=B[s],o=ut[s],c=(r[3]<<4)+r[4],d=`K11 CH${s+1} `;([()=>{c<128?(e.setChType(s,e.CH_MELODIC,w.k11),t(e,m)[i+v[0]]=0,t(e,L)[s]=c):(e.setChType(s,e.CH_DRUMS,w.k11),t(e,L)[s]=c-128),e.pushChPrimitives(s),e.dispatchEvent("voice",{part:s})},()=>{let h=e.chRedir(c,l,!0);t(e,K)[s]=h,s!=h&&(e.buildRchTree(),console.info(`${d}receives from CH${h+1}`))},()=>{t(e,m)[i+v[7]]=c},()=>{uupThis.setChActive(s,c)},()=>{t(e,m)[i+v[10]]=c},()=>{t(e,D)[o+3]=c+40,t(e,H)[g.rpnt*s+2]=1,e.dispatchEvent("pitch",{part:s,pitch:e.getPitchShift(s)})},()=>{t(e,D)[o+1]=c>>1,t(e,D)[o+2]=c&1,t(e,H)[g.rpnt*s+1]=1,e.dispatchEvent("pitch",{part:s,pitch:e.getPitchShift(s)})},()=>{t(e,m)[i+v[91]]=c?127:0},()=>{},()=>{t(e,m)[i+v[74]]=c},()=>{t(e,m)[i+v[73]]=c},()=>{t(e,m)[i+v[72]]=c}][r[0]]||(()=>{}))()}).add([16,0,9,0],(r,l,n)=>{e.dispatchEvent("mupromptex");let s=(r[2]<<4)+r[3],i="GMLX ";([()=>{console.debug(`${i}reverb type: ${s}`)},()=>{console.debug(`${i}reverb time: ${s}`)},()=>{console.debug(`${i}reverb predelay: ${s}`)},()=>{console.debug(`${i}depth high: ${s}`)},()=>{console.debug(`${i}depth low: ${s}`)}][r[0]]||(()=>{}))()}).add([16,0,9,3],(r,l,n)=>{e.dispatchEvent("mupromptex");let s=(r[2]<<4)+r[3],i=e.chRedir(r[1],l,!0),o=B[i];[()=>{s<128?(e.setChType(i,e.CH_MELODIC,w.k11),t(e,m)[o+v[0]]=0,t(e,m)[o+v[32]]=0,t(e,L)[i]=s):s<160?(e.setChType(i,e.CH_MELODIC,w.k11),t(e,m)[o+v[0]]=0,t(e,m)[o+v[32]]=7,t(e,L)[i]=s-100):(e.setChType(i,e.CH_DRUMS,w.k11),t(e,m)[o+v[0]]=122,t(e,m)[o+v[32]]=0,t(e,L)[i]=s-160),e.pushChPrimitives(i),e.dispatchEvent("voice",{part:i})},()=>{let c=e.chRedir(s,l,!0);t(e,K)[i]=c,i!=c&&(e.buildRchTree(),console.info(`GMLX CH${i+1} receives from CH${c+1}`))}][r[0]]()}).add([16,0,9,4],(r,l,n)=>{e.dispatchEvent("mupromptex");let s=(r[2]<<4)+r[3],i=e.chRedir(r[1],l,!0),o=B[i],c=ut[i],d=`GMLX CH${i+1} `;[()=>{e.setChActive(i,s)},()=>{t(e,m)[o+v[7]]=s},()=>{t(e,m)[o+v[10]]=s},()=>{t(e,m)[o+v[91]]=s?127:0},()=>{t(e,D)[c+3]=s+40,t(e,H)[g.rpnt*i+2]=1,e.dispatchEvent("pitch",{part:i,pitch:e.getPitchShift(i)})},()=>{t(e,D)[c+1]=s,t(e,H)[g.rpnt*i+1]=1,e.dispatchEvent("pitch",{part:i,pitch:e.getPitchShift(i)})},()=>{t(e,D)[c]=s,t(e,H)[g.rpnt*i]=1,e.dispatchEvent("pitch",{part:i,pitch:e.getPitchShift(i)})},()=>{}][r[0]]()}),t(this,Ke).add([66,93,64],(r,l,n)=>{let s=r[2];switch(r[0]){case 0:{switch(r[1]){case 4:{e.dispatchEvent("mupromptex"),x(e,I,s*129/16383*100),e.dispatchEvent("mastervolume",t(e,I));break}case 5:{e.dispatchEvent("mupromptex"),s-64;break}case 6:{e.dispatchEvent("mupromptex"),console.debug(`SG global reverb: ${s?"on":"off"}`);break}case 127:{e.switchMode("sg",!0),e.setPortMode(e.getTrackPort(l),1,w.sg);break}}break}case 1:{switch(r[1]){case 48:{e.dispatchEvent("mupromptex"),console.debug(`SG reverb type: ${vt[s]}`);break}}break}default:if(r[0]>>4==1){e.dispatchEvent("mupromptex");let i=e.chRedir(r[0]&15,l,!0);if(r[1]==2){let o=e.chRedir(s,l,!0);t(e,K)[i]=o,i!=o&&(e.buildRchTree(),console.info(`SG CH${i+1} receives from CH${o+1}`))}else r[1]==19&&e.setChCc(i,7,s)}else console.warn(`Unknown AKAI SG SysEx: ${r}`)}}),t(this,ze).add([9],(r,l,n)=>{e.dispatchEvent("mupromptex"),console.debug(`GZ set effect: ${["stage reverb","hall reverb","room reverb","chorus","tremolo","phaser","rotary speaker","enhancer","flanger","EQ"][r[0]]||"off"}`)}),t(this,oe).add([127,0],(r,l,n)=>{e.switchMode("motif");let s=new Uint8Array([127,1,...r]);t(e,oe).run(s,l,n)}).add([127,1,0,0],(r,l,n)=>{e.switchMode("s90es");let s="S90/Motif ES system ",i=r[0];r.subarray(1).forEach((o,c)=>{([()=>{x(e,I,o*12900/16383),e.dispatchEvent("mastervolume",t(e,I))}][i+c]||(()=>{console.info(`Unrecognized ${s}ID: ${i+c}`)}))()})}).add([127,1,0,36,54,1],(r,l,n)=>{e.switchMode("s90es");let s="S90/Motif ES reverb ",i=r[0];r.subarray(1).forEach((o,c)=>{([()=>{e.setEffectTypeRaw(0,!1,o&15|112)},()=>{e.setEffectTypeRaw(0,!0,o)}][i+c]||(()=>{}))()}),e.dispatchEvent("efxreverb",e.getEffectType(0))}).add([127,1,0,37,54,2],(r,l,n)=>{e.switchMode("s90es");let s="S90/Motif ES chorus ",i=r[0];r.subarray(1).forEach((o,c)=>{([()=>{e.setEffectTypeRaw(1,!1,o&15|112)},()=>{e.setEffectTypeRaw(1,!0,o)}][i+c]||(()=>{}))()}),e.dispatchEvent("efxchorus",e.getEffectType(1))}).add([127,1,0,34,54,3],(r,l,n)=>{e.switchMode("s90es");let s="S90/Motif ES insert 1 ",i=r[0];r.subarray(1).forEach((o,c)=>{([()=>{e.setEffectTypeRaw(3,!1,o&15|112)},()=>{e.setEffectTypeRaw(3,!0,o)}][i+c]||(()=>{}))()}),e.dispatchEvent("efxinsert0",e.getEffectType(3))}).add([127,1,0,34,54,4],(r,l,n)=>{e.switchMode("s90es");let s="S90/Motif ES insert 2 ",i=r[0];r.subarray(1).forEach((o,c)=>{([()=>{e.setEffectTypeRaw(4,!1,o&15|112)},()=>{e.setEffectTypeRaw(4,!0,o)}][i+c]||(()=>{}))()}),e.dispatchEvent("efxinsert1",e.getEffectType(4))}).add([127,1,0,35,54,17],(r,l,n)=>{e.switchMode("s90es");let s="S90/Motif ES variation ",i=r[0];r.subarray(1).forEach((o,c)=>{([()=>{e.setEffectTypeRaw(2,!1,o&15|112)},()=>{e.setEffectTypeRaw(2,!0,o)}][i+c]||(()=>{}))()}),e.dispatchEvent("efxdelay",e.getEffectType(2))}).add([127,1,0,58,55],(r,l,n)=>{e.dispatchEvent("mupromptex"),e.switchMode("s90es");let s=e.getTrackPort(l);if(t(e,X)[s]&&t(e,X)[s]!=t(e,U).smotif)if(t(e,ve).dumpLimit==e.DUMP_MODE){console.warn(`Dump cancelled for track ${l}. Port ${String.fromCharCode(65+s)} mode "${_[t(e,X)[s]]}" mismatch, should be "${_[t(e,U).smotif]}".`);return}else console.info(`Track ${l} is trying to perform a mismached mode dump on port ${String.fromCharCode(65+s)}.`);let i=e.chRedir(r[0],l,!0),o=B[i],c=r[1];r[0]>15&&(i=r[0]+32);let d=`Track ${l} S90/Motif ES bulk CH${i<128?i+1:"U"+(i-127)} `;console.debug(d,r),!(r[0]>15)&&r.subarray(2).forEach((h,E)=>{([()=>{t(e,m)[o+v[0]]=h,e.pushChPrimitives(i),e.dispatchEvent("voice",{part:i})},()=>{h&&e.setChActive(i,1),t(e,m)[o+v[32]]=h,e.getChPrimitive(i,1)==63&&e.setChType(i,[32,40].indexOf(h)>-1?e.CH_DRUMS:e.CH_MELODIC,t(e,N),!0),e.pushChPrimitives(i),e.dispatchEvent("voice",{part:i})},()=>{h&&e.setChActive(i,1),t(e,L)[i]=h,e.dispatchEvent("voice",{part:i})},()=>{let y=e.chRedir(h,l,!0);t(e,K)[i]=y,i!=y&&(e.buildRchTree(),console.info(`${d}receives from CH${y+1}`))},()=>{t(e,se)[i]=h?0:1},!1,!1,!1,!1,!1,!1,!1,!1,()=>{h!=100&&e.setChActive(i,1),t(e,m)[o+v[7]]=h},()=>{h!=64&&e.setChActive(i,1),t(e,m)[o+v[10]]=h},!1,!1,!1,()=>{t(e,m)[o+v[91]]=h},()=>{h&&e.setChActive(i,1),t(e,m)[o+v[93]]=h},()=>{h&&e.setChActive(i,1),t(e,m)[o+v[94]]=h},()=>{h!=127&&e.setChActive(i,1),t(e,m)[o+v[128]]=h,e.allocateAce(i,128)},()=>{},()=>{h!=64&&e.setChActive(i,1),t(e,m)[o+v[74]]=h},()=>{h!=64&&e.setChActive(i,1),t(e,m)[o+v[71]]=h},!1,()=>{t(e,m)[o+v[65]]=h},()=>{t(e,m)[o+v[5]]=h},()=>{}][c+E]||(()=>{}))()})}).add([127,1,54,16],(r,l,n)=>{e.switchMode("s90es");let s=r[0];r.subarray(1).forEach((i,o)=>{let d=`S90/Motif ES EQ${(o>>2)+1} `;([()=>{let h=i-64},()=>{let h=Qe[i]},()=>{let h=i/10},()=>{let h=i}][s+o&3]||(()=>{}))()})}),t(this,he).add([0,72,18,0,0,0,0],(r,l,n)=>{e.switchMode("sd",!0),e.setPortMode(e.getTrackPort(l),2,w.sd),console.info("MIDI reset: SD")}).add([0,72,18,16,0],(r,l,n)=>{e.dispatchEvent("mupromptex");let s=r[0]>>5,i=r[0]&31;switch(s){case 0:{let o=r[0]>>1,c=r[1];switch(o){case 1:{r.subarray(2).forEach((d,h,E)=>{let y=h+c;switch(y){case 0:{d&&(e.setEffectType(1,60,d-1),e.dispatchEvent("efxchorus",e.getEffectType(1)),console.debug(`SD MFX Cho: ${y} - ${d}`));break}}});break}case 2:{r.subarray(2).forEach((d,h)=>{let E=h+c;switch(E){case 0:{d&&(e.setEffectType(0,55+d,0),e.dispatchEvent("efxreverb",e.getEffectType(0)),console.debug(`SD MFX Rev: ${E} - ${d}`));break}}});break}case 3:case 4:case 5:{let d=o-1;r.subarray(2).forEach((h,E)=>{let y=E+c;switch(console.debug(`SD MFX ${d-2}: ${y} - ${h}`),y){case 0:{e.setEffectTypeRaw(d,62,h),e.dispatchEvent(`efx${d>2?"delay":"insert"+(d-4)}`,e.getEffectType(d));break}}}),console.debug(`SD MFX message:
%o`,r);break}default:console.debug(`Unknown SD-90 global effects message:
%o`,r)}break}case 1:{let o=e.chRedir(i,l,!0),c=r[1],d=B[o];r.subarray(2).forEach((h,E)=>{let y=c+E;y<37?([()=>{},()=>{},0,()=>{},()=>{switch(t(e,m)[d+v[0]]=h,h){case 104:case 105:case 106:case 107:case 120:{t(e,R)[o]||e.setChType(o,e.CH_DRUMS);break}default:t(e,R)[o]&&e.setChType(o,e.CH_MELODIC)}e.pushChPrimitives(o),e.dispatchEvent("voice",{part:o})},()=>{t(e,m)[d+v[32]]=h,e.pushChPrimitives(o),e.dispatchEvent("voice",{part:o})},()=>{t(e,L)[o]=h,e.dispatchEvent("voice",{part:o})},()=>{t(e,m)[d+v[7]]=h},()=>{t(e,m)[d+v[10]]=h},()=>{},()=>{},()=>{h<2&&(t(e,se)[o]=h)},()=>{h<2&&(t(e,m)[d+v[68]]=h?127:0)},()=>{},()=>{h<2&&(t(e,m)[d+v[65]]=h?127:0)},()=>{t(e,m)[d+v[5]]=h&15<<4|t(e,m)[d+v[5]]&15},()=>{t(e,m)[d+v[5]]=h&15|(t(e,m)[d+v[5]]&240)>>4},()=>{t(e,m)[d+v[74]]=h},()=>{t(e,m)[d+v[71]]=h},()=>{t(e,m)[d+v[73]]=h},()=>{t(e,m)[d+v[72]]=h},0,0,0,0,0,0,0,()=>{t(e,m)[d+v[128]]=h,e.allocateAce(128)},()=>{t(e,m)[d+v[93]]=h},()=>{t(e,m)[d+v[91]]=h},0,0,()=>{t(e,m)[d+v[75]]=h},()=>{t(e,m)[d+v[76]]=h},()=>{t(e,m)[d+v[77]]=h},()=>{t(e,m)[d+v[78]]=h}][y]||(()=>{}))():y<63||(y<64?(t(e,R)[o]?(t(e,m)[d+v[0]]=104|h,e.pushChPrimitives(o),e.dispatchEvent("voice",{part:o})):(t(e,m)[d+v[0]]=96|h,e.pushChPrimitives(o),e.dispatchEvent("voice",{part:o})),e.dispatchEvent("voice",{part:o})):console.debug(`Unknown SD-90 global CH${o+1} param setup message:
%o`,r))});break}case 2:{let o=e.chRedir(i,l,!0),c=r[1];console.debug(`Unknown SD-90 global CH${o+1} MIDI setup message:
%o`,r.subarray(2));break}default:console.warn(`Unknown SD-90 global part setup message:
%o`,r)}}),t(e,Ce).add([0,1,73,78],(r,l,n)=>{e.switchMode("krs"),e.setPortMode(e.getTrackPort(l),1,w.krs),console.debug("Might be KORG KROSS 2 mode reset... Not sure.")}).add([0,1,73,117,2,37],(r,l,n)=>{e.switchMode("krs");let s=e.getTrackPort(l);if(t(e,X)[s]&&t(e,X)[s]!=w.krs)if(t(e,ve).dumpLimit==e.DUMP_MODE){console.warn(`Dump cancelled. Port ${String.fromCharCode(65+s)} mode "${_[t(e,X)[s]]}" mismatch, should be "krs".`);return}else console.info(`Track ${l} is trying to perform a mismached mode dump on port ${String.fromCharCode(65+s)}.`);e.setPortMode(e.getTrackPort(l),1,w.krs);let i="KROSS 2 BMT1 ",o="";fe(r,(c,d)=>{if(d<24)o+=String.fromCharCode(Math.max(32,c));else if(!(d<1276)){let h=d-1276,E=e.chRedir(Math.floor(h/44),l,!0),y=h%44,T=B[E];y<15?([()=>{c&&e.setChActive(E,1),t(e,L)[E]=c,e.dispatchEvent("voice",{part:E})},()=>{c&&e.setChActive(E,1),c<10?(t(e,m)[T+v[0]]=63,t(e,m)[T+v[32]]=c):c<20?(t(e,m)[T+v[0]]=121,t(e,m)[T+v[32]]=c-10):c<24&&(t(e,m)[T+v[0]]=[120,0,56,62][c-20],t(e,m)[T+v[32]]=0),e.pushChPrimitives(E),e.dispatchEvent("voice",{part:E})},()=>{let A=e.chRedir(c&15,l,!0);t(e,K)[E]=A,console.info(`${i}CH${E+1} receives from CH${A+1}`)},!1,!1,()=>{t(e,m)[T+v[7]]=c},!1,()=>{},()=>{},!1,!1,!1,!1,!1,()=>{t(e,m)[T+v[10]]=c||128}][y]||(()=>{}))():y<36||([()=>{t(e,m)[T+v[74]]=(c+128&255)-64},()=>{t(e,m)[T+v[71]]=(c+128&255)-64},!1,!1,()=>{t(e,m)[T+v[73]]=(c+128&255)-64},()=>{t(e,m)[T+v[75]]=(c+128&255)-64},!1,()=>{t(e,m)[T+v[72]]=(c+128&255)-64}][y]||(()=>{}))()}}),o=o.trimRight(),e.dispatchEvent("metacommit",{type:"EORTitle",data:o})})}chRedir(e,a,f){let u=this;if(t(u,Le)[a])return(t(u,Le)[a]-1)*16+e;if(t(u,N)==w.sc||t(u,N)==w.sd){if(f==1)return e;let p=0,$=!0;for(;$;)t(u,Te)[e+p]==0?(t(u,Te)[e+p]=a,console.debug(`Assign track ${a} to channel ${e+p+1}.`),$=!1):t(this,Te)[e+p]==a?$=!1:(p+=16,p>=128&&(p=0,$=!1));return e+p}else return e}getTrackPort(e){return this.chRedir(0,e,!0)>>4}forceVoiceRefresh(){for(let e=0;e<g.ch;e++)t(this,ae)[e]&&this.dispatchEvent("voice",{part:e})}buildRchTree(){let e=[];t(this,K).forEach((a,f)=>{var u;a<g.ch&&((u=e[a])!=null&&u.constructor||(e[a]=[]),e[a].push(f))}),x(this,dt,e)}buildRccMap(){let e=this;for(let a=0;a<g.ch;a++)t(e,Ge)[a]={};t(e,Be).forEach((a,f)=>{a&&(t(e,Ge)[Math.floor(f/g.redir)][a]=f%g.redir|128)}),O()&&console.debug(t(e,Ge))}getActive(){return t(this,ae)}getChActive(e){return t(this,ae)[e]}getCc(e){if(typeof e!="number"||e<0||e>=g.ch)throw new RangeError(`Invalid part number: CH${e+1}`);let a=this,f=B[e];return t(a,m).subarray(f,f+g.cc)}getChCc(e,a){let f=this;if(Ue.indexOf(a)<0)throw new Error("CC number not accepted");return t(f,m)[B[e]+v[a]]}setChCc(e=0,a,f){let u=this;if(Ue.indexOf(a)<0)throw new Error("CC number not accepted");if((f==null?void 0:f.constructor)!=Number)throw new TypeError("Expected numbers for value");let p=f&255,$=B[e]+v[a];t(u,m)[$]=p,t(u,m)[$+g.chcc]=1,u.dispatchEvent("cc",{part:e,cc:a,data:p})}getCcAll(){return t(this,m).slice()}resetCc(e){}resetChCc(e,a,f){let u=this;f!=null&&f.constructor&&u.setChCc(e,a,f),t(u,m)[B[e]+v[a]+g.chcc]=0}resetCcAll(){}isChCcWritten(e,a){if(Ue.indexOf(a)<0)throw new Error("CC number not accepted");return t(upThis,m)[B[e]+v[a]+g.chcc]}getChSource(){return t(this,K)}getChType(){return t(this,R)}setChType(e,a,f=0,u=!1){a&=15;let p=this;f=f||p.getChModeId(e),t(p,R)[e]=a,a>0&&!u&&(p.setChCc(e,0,t(p,V)[f][2]),p.pushChPrimitives(e))}setChActive(e,a=0){t(this,ae)[e]!=a&&this.dispatchEvent("channeltoggle",{part:e,active:a}),t(this,ae)[e]=a}getExt(e){let a=g.ext*e,f=t(this,ie).subarray(a,a+g.ext),u=new Uint8Array(f.length);return u.set(f),u[1]=u[1]||t(this,pt),u}getPitch(){return t(this,Se)}getProgram(){return t(this,L)}getTexts(){return t(this,ce).slice()}getVel(e){let a=new Map,f=this;return t(f,W).forEach(function(u,p){let $=u>>7,C=u&127;e==$&&t(f,z)[u]>0&&a.set(C,{v:t(f,z)[u],s:t(f,Q)[p]})}),a}getBitmap(){return{bitmap:t(this,le,ke),expire:t(this,pe)}}getLetter(){return{text:t(this,Oe),set:t(this,ht),expire:t(this,Ae)}}getMode(){return _[t(this,N)]}getMaster(){return{volume:t(this,I)}}getRawStrength(){let e=this;return t(this,W).forEach(function(a){let f=a>>7;t(e,z)[a]>t(e,me)[f]&&(t(e,me)[f]=t(e,z)[a])}),t(this,me)}getStrength(){let e=[],a=this;return this.getRawStrength().forEach(function(f,u){e[u]=Math.floor(f*a.getChCc(u,7)*a.getChCc(u,11)*t(a,I)/803288)}),e}getRpn(){return t(this,D)}getNrpn(){return t(this,Ye)}getSubDb(){return self==null?void 0:self.structuredClone(t(this,V))}getDetect(){return self==null?void 0:self.structuredClone(t(this,U))}getVoice(e,a,f,u="?"){var n;let p=this;(n=w[u])!=null&&n.constructor||(u="?");let $=w[u],C=e||t(p,V)[$][0],k=a,r=f||t(p,V)[$][1];C==ct.bank0&&(C=0),r==ct.bank0&&(r=0),u=="ns5r"&&C>0&&C<56&&(r=3);let l=p.userBank.get(C,k,r,u);if(u=="mt32"&&l.name.indexOf("MT-m:")==0){let s=parseInt(l.name.slice(5)),i=s*g.cmt,o="";t(p,De).subarray(i,i+10).forEach(d=>{d>31&&(o+=String.fromCharCode(d))});let c=`MSB	LSB	PRG	NME
49	127	${k}	${o}`;p.userBank.load(c,!0),l.name=o,l.ending=" "}return(l.ending!=" "||!l.name.length)&&(l=p.baseBank.get(C,k,r,u)),l}getChPrimitive(e,a,f){if(a>=g.vxPrim||(a==null?void 0:a.constructor)!=Number)throw new RangeError(`Invalid voice primitive component "${a}"`);if(typeof e!="number"||e<0||e>=g.ch)throw new RangeError(`Invalid part number: CH${e+1}`);let u=this,p=t(u,L)[a<<g.chShift|e];switch(a){case 1:case 2:{f&&(p=p||t(u,V)[u.getChModeId(e)][a-1]),p==ct.bank0&&(p=0);break}}return p}getChPrimitives(e,a){let f=this,u=new Uint8Array(3);return u[1]=t(f,L)[e],u[0]=f.getChPrimitive(e,1,a),u[2]=f.getChPrimitive(e,2,a),u}pushChPrimitives(e){let a=this;t(a,L)[1<<g.chShift|e]=a.getChCc(e,0),t(a,L)[2<<g.chShift|e]=a.getChCc(e,32),a.dispatchEvent("voice",{part:e})}getChVoice(e){let a=this,f=a.getVoice(...a.getChPrimitives(e),a.getChMode(e));if(t(a,ge)[e]){let u="";switch(t(a,N)){case w.mt32:{t(a,Ee).subarray(g.cmt*(e-1),g.cmt*(e-1)+10).forEach(p=>{u+=String.fromCharCode(Math.max(p,32))}),u=u.trimRight();break}default:{let p=g.cvn*e;t(a,ot).subarray(p,p+g.cvn).forEach($=>{u+=String.fromCharCode(Math.max($,32))}),u=u.trimRight()}}u.length&&(f.ending="~",f.name=u)}return f}getRawPitch(){return t(this,Se)}getPitchShift(e){let a=this,f=e*g.rpn,u=t(a,D)[f];return t(a,H)[e*g.rpnt]||t(a,N)==w.mt32&&(u=12),t(a,Se)[e]/8192*u+(t(a,D)[f+3]-64)+((t(a,D)[f+1]<<7)+t(a,D)[f+2]-8192)/8192}getEffectType(e=0){let a=3*e+1;return t(this,ne).subarray(a,a+2)}setEffectTypeRaw(e=0,a,f){let u=3*e;t(this,ne)[u]=1,t(this,ne)[u+1+ +a]=f}setEffectType(e=0,a,f){this.setEffectTypeRaw(e,!1,a),this.setEffectTypeRaw(e,!0,f)}getEffectSink(){return t(this,Je)}setLetterDisplay(e,a,f=0,u=3200){let p=this,$;x(p,Oe," ".repeat(f)),e.forEach(C=>{x(p,Oe,t(p,Oe)+String.fromCharCode(C>31?C:32)),C<32&&($=$||new Set,$.add(C))}),x(p,ht,Date.now()),x(p,Ae,Date.now()+u),p.dispatchEvent("letter"),$&&($=Array.from($),$.forEach((C,k,r)=>{r[k]=C.toString(16).padStart(2,"0")}),console.warn(`${a}${a?" ":""}invalid code point${$.length>1?"s":""}: 0x${$.join(", 0x")}`))}setDetectionTargets(e="?",a=0){let f=this,u=-1;switch(e.replaceAll(", ",",").split(",").forEach(p=>{p=p.toLowerCase();let $=_.indexOf(cr[p]||p);O()&&console.debug(`Mapped mode "${p}" to ID "${$}".`),$>-1&&(u=$)}),O()&&console.debug(`Set detection target to ID "${u}".`),u>0&&(t(f,U).x5=82,t(f,U).ds=w.krs),u){case w["05rw"]:{t(f,U).x5=81;break}case w.s90es:t(f,U).ds=w.s90es,t(f,U).smotif=w.s90es;case w.motif:t(f,U).ds=w.motif,t(f,U).smotif=w.motif}}setGsTargets(e=!1,a=4){if(!a)a=e?3:4;else{if(a>4||a<0)throw new Error(`Invalid GS level ${a}`);if(e&&a>>1!=1)throw new Error(`Invalid SC level ${a}`)}let f=this;t(f,U)[e?"sc":"gs"]=a,t(f,V)[w[e?"sc":"gs"]][1]=a,f.forceVoiceRefresh()}getConfigs(){return t(this,lt)}setDumpLimit(e){if(e>2||e<0)throw new RangeError("Invalid dump limit.");t(this,ve).dumpLimit=e}allocateAce(e=0,a){let f=this;if(!a||a<128&&a>95){console.warn(`cc${a} cannot be allocated as an active custom effect.`);return}let u=!0,p=0,$=g.ace*e;for(;u&&p<g.ace;)t(f,Z)[p+$]==a?u=!1:t(f,Z)[p+$]||(u=!1,t(f,Z)[p+$]=a,console.info(`Allocated cc${a} to ACE slot ${p} in CH${e+1}.`)),p++;p>=g.ace&&console.warn(`ACE slots are full in CH${e+1}.`)}allocateAceAll(e){let a=this;if(!e||e<128&&e>95){console.warn(`cc${e} cannot be allocated as an active custom effect.`);return}for(let f=0;f<g.ch;f++){let u=!0,p=0,$=g.ace*f;for(;u&&p<g.ace;)t(a,Z)[p+$]==e?u=!1:t(a,Z)[p+$]||(u=!1,t(a,Z)[p+$]=e),p++;p>=g.ace&&console.warn(`ACE slots are full in CH${f+1}.`)}}releaseAce(e=0,a){let f=!0,u=g.ace*e,p=u+g.ace;for(;f&&u<p;)t(this,Z)[u]==a&&(t(this,Z)[u]=0,f=!1),u++;f&&O()&&console.debug(`No ACE slot was allocated to cc${a} in CH${e+1}.`)}resetAce(){t(this,Z).fill(0),console.info("All ACE slots have been reset.")}getAce(){return t(this,Z)}getChAce(e=0,a=0){if(a<0||a>=g.ace)throw new RangeError("No such ACE slot");let f=t(this,Z)[g.ace*e+a];if(f){if(Ue.indexOf(f)>=0)return this.getChCc(e,f);throw new Error(`Invalid ACE source in CH${e+1}: ${f}`)}else return 0}initDrums(){let e=this;t(e,ee).fill(64);for(let a=0;a<g.drm;a++){let f=a*g.dpn;for(let u in zt){let p=zt[u],$=(f+ue[u])*g.dnc;t(e,ee).subarray($,$+g.dnc).fill(p)}}}init(e=0){let a=this;x(a,Ie,0),t(a,V)[w.xg][1]=0,a.dispatchEvent("banklevel",{mode:"xg",data:0}),t(a,ae).fill(0),t(a,m).fill(0),t(a,Z).fill(0),t(a,L).fill(0),t(a,z).fill(0),t(a,W).fill(0),t(a,se).fill(0),t(a,me).fill(0),t(a,Se).fill(0),t(a,Ye).fill(0),t(a,H).fill(0),t(a,ie).fill(0),t(a,X).fill(0),t(a,Ne).fill(0),t(a,Be).fill(0),x(a,I,100),x(a,ce,[]),x(a,je,500),x(a,et,0),x(a,pe,0),x(a,J,0),t(a,le,ke).fill(0),x(a,G,!1),x(a,tt,0),x(a,$e,!0),a.initDrums(),t(a,K).forEach(function(f,u,p){p[u]=u}),e==0&&(a.dispatchEvent("mode","?"),x(a,N,0),t(a,Te).fill(0),t(a,Le).fill(0),x(a,Ae,0),x(a,Oe,"")),lr.forEach(f=>{a.setChCc(f,0,t(a,V)[a.getChModeId(f)][2])}),t(a,R).fill(a.CH_MELODIC),t(a,R)[9]=a.CH_DRUM1,t(a,R)[25]=a.CH_DRUM3,t(a,R)[41]=a.CH_DRUMS,t(a,R)[57]=a.CH_DRUMS,t(a,R)[73]=a.CH_DRUM5,t(a,R)[89]=a.CH_DRUM7,t(a,R)[105]=a.CH_DRUMS,t(a,R)[121]=a.CH_DRUMS;for(let f=0;f<g.drm;f++)t(a,be)[f<<1]=0,t(a,be)[f<<1|1]=g.invalidCh;t(a,Ze).fill(0),t(a,De).fill(0),t(a,Re).fill(0),t(a,Ee).fill(0),t(a,ge).fill(0),t(a,ne).fill(0),t(a,Je).fill(0),a.aiEfxName="",a.userBank.clearRange({msb:0,lsb:127,prg:[0,127]}),a.modelEx.sc.showBar=!0,a.modelEx.sc.invBar=!1,a.modelEx.sc.invDisp=!1,a.modelEx.sc.peakHold=1;for(let f=0;f<g.ch;f++){let u=B[f];t(a,m)[u+v[7]]=100,t(a,m)[u+v[11]]=127,t(a,m)[u+v[2]]=127,t(a,m)[u+v[10]]=64,t(a,m).subarray(u+v[71],u+v[71]+8).fill(64),t(a,m)[u+v[128]]=127,t(a,m).subarray(u+v[130],u+v[157]+1).fill(64),t(a,m)[u+v[91]]=40,t(a,m)[u+v[101]]=127,t(a,m)[u+v[100]]=127,t(a,m)[u+v[99]]=127,t(a,m)[u+v[98]]=127;let p=f*g.rpn;t(a,D)[p]=2,t(a,D)[p+1]=64,t(a,D)[p+2]=0,t(a,D)[p+3]=64,t(a,D)[p+4]=0,t(a,D)[p+5]=0;let $=f*g.ext;t(a,ie)[$+1]=a.VLBC_BRTHEXPR;let C=f*g.redir;t(a,Be)[C+8]=13}a.buildRchTree(),a.buildRccMap(),a.dispatchEvent("mastervolume",t(a,I)),a.dispatchEvent("efxreverb",a.getEffectType(0)),a.dispatchEvent("efxchorus",a.getEffectType(1)),a.dispatchEvent("efxdelay",a.getEffectType(2)),a.dispatchEvent("efxinsert0",a.getEffectType(3)),a.dispatchEvent("efxinsert1",a.getEffectType(4)),a.dispatchEvent("efxinsert2",a.getEffectType(5)),a.dispatchEvent("efxinsert3",a.getEffectType(6)),a.dispatchEvent("reset"),a.switchMode("?")}setChMode(e,a){let f=this;if(typeof e!="number"||e<0||e>=g.ch)throw new RangeError(`Invalid part number: CH${e+1}`);if(port<0||a>=_.length)throw new RangeError(`Invalid mode ID ${a}`);t(f,Ne)[e]=a,f.dispatchEvent("chmode",{part:e,id:a,mode:_[a]}),f.dispatchEvent("voice",{part:e})}getChMode(e,a){return _[this.getChModeId(e,a)]}getChModeId(e,a){return a?t(this,Ne)[e]||t(this,X)[e>>4]:t(this,Ne)[e]||t(this,X)[e>>4]||t(this,N)}setPortMode(e,a,f){let u=this;if(e<0||e>=g.ch>>4)throw new RangeError(`Invalid port ${e+1}`);if(a<1)throw new RangeError("Range must be a positive integer");if(e+a>=g.ch>>4)throw new RangeError("Range must be in bound");if(e<0||f>=_.length)throw new RangeError(`Invalid mode ID ${f}`);for(let p=e;p<e+a;p++){t(u,X)[p]=f;for(let $=p<<4;$<p+1<<4;$++)u.dispatchEvent("chmode",{part:$,id:f,mode:_[f]}),u.dispatchEvent("voice",{part:$})}}copyChSetup(e,a,f){if(e==a){console.warn(`Failed attempt at overwriting CH${e+1} with its own data.`);return}let u=this;if(f&&t(u,ae)[a]){console.warn(`Failed attempt at copying setup data from CH${e+1} to CH${a+1}.`);return}let p=B[e],$=B[a];t(u,L)[a]=t(u,L)[e],t(u,m).set(t(u,m).subarray(p,p+g.cc),$),u.pushChPrimitives(a)}setDrumFirstWrite(e,a){let f=this,u=t(f,R)[e];if(u<2)return;let p=u-2;if(t(f,be)[p<<1])if(a)t(f,be)[p<<1]=0,O()&&console.debug(`First write part for drum set ${p+1} has been reset.`);else return;else a?console.warn(`First write part for drum set ${p+1} is already blank.`):(t(f,be)[p<<1]=1,t(f,be)[p<<1|1]=e,console.debug(`First write part for drum set ${p+1} is set to CH${e+1}.`))}getChDrumFirstWrite(e){let a=this,f=t(a,R)[e];if(f<2)return;let u=f-2;return t(a,be).subarray(u<<1,u+1<<1)}getDrumFirstWrite(e){if(e>=0&&e<g.drm)return t(this,be).subarray(e<<1,e+1<<1)}switchMode(e,a=!1,f=!1){var $;let u=this,p=w[e];if(p>-1){if(t(u,N)==0||a){u.initOnReset&&a&&this.init(1),x(u,N,p),x(u,J,0);for(let k=0;k<g.ch;k++){let r=u.getChModeId(k,!0);t(u,R)[k]>0&&r==w["?"]&&(u.setChCc(k,0,t(u,V)[p][2]),O()&&console.debug(`CH${k+1} (${t(u,R)[k]}) (${u.getChMode(k)}), ${_[r]} (${t(u,V)[r][2]}) -> ${_[p]} (${t(u,V)[p][2]})`),u.pushChPrimitives(k))}switch(p){case w.mt32:{Ct.forEach((k,r)=>{let l=r+1;t(u,ae)[l]||(t(u,L)[l]=k,u.setChCc(l,91,127),u.pushChPrimitives(l))});for(let k=1;k<10;k++)u.dispatchEvent("voice",{part:k});break}}let C;switch(p){case w["?"]:case w.g2:{C=[52,4,52,18,0,0,0,0];break}case w.xg:{C=[1,0,65,0,5,0,0,0];break}case w.gm:case w.gs:case w.sc:{C=[40,4,40,18,40,32,32,0];break}case w.sd:{C=[58,0,60,0,61,0,61,0];break}case w["05rw"]:case w.x5d:case w.ns5r:{C=[44,1,44,19,44,0,44,0];break}case w.k11:case w.sg:{C=[24,0,0,0,0,0,0,0];break}case w.mt32:{C=[40,4,0,0,0,0,0,0];break}case w.doc:{C=[24,16,0,0,0,0,0,0];break}case w.motif:case w.s90es:{C=[113,0,117,0,114,0,0,0];break}default:C=[0,0,0,0,0,0,0,0]}for(let k=0;k<g.efx;k++)!t(u,ne)[3*k]&&(($=C[k<<1])!=null&&$.constructor)&&(t(u,ne)[3*k+1]=C[2*k],t(u,ne)[3*k+2]=C[2*k+1],u.dispatchEvent(`efx${["reverb","chorus","delay","insert0"][k]}`,u.getEffectType(k)));f&&u.setDetectionTargets(e),u.dispatchEvent("mode",e),u.forceVoiceRefresh()}}else throw new Error(`Unknown mode ${e}`)}newStrength(){t(this,me).fill(0)}runJson(e){var a;if(e.type>14)return e.type==15&&e.data.constructor!=Uint8Array&&(e.data=Uint8Array.from(e.data)),t(this,ft)[e.type].call(this,e);{let f=this.chRedir(e.part,e.track),u=!1;(a=t(this,dt)[f])==null||a.forEach(p=>{e.channel=p,u=!0,t(this,ft)[e.type].call(this,e)}),u||console.warn(`${Xt[e.type]?Xt[e.type]:e.type}${[11,12].includes(e.type)?(e.data[0]!=null?e.data[0]:e.data).toString():""} event sent to CH${f+1} without any recipient.`)}t(this,ce).length>100&&t(this,ce).splice(100,t(this,ce).length-99)}runRaw(e){}async loadBank(e,a){let f=this;switch(e=e.toLowerCase(),e){case"s7e":{f.userBank.clearRange({msb:63,lsb:[21,22]}),f.userBank.clearRange({msb:63,lsb:[24,27]});break}case"pcg":{f.userBank.clearRange({msb:63,lsb:[6,9]}),f.userBank.clearRange({msb:63,lsb:[13,16]});break}default:throw new Error(`Unknown bank format ${e}`)}switch(e){case"s7e":case"pcg":{at.context=this,await f.userBank.load(await at.read(e,a),!1);break}}f.forceVoiceRefresh()}},N=new WeakMap,J=new WeakMap,pe=new WeakMap,xe=new WeakMap,le=new WeakSet,ke=function(){return t(this,xe)[t(this,J)]},Jt=function(e){t(this,xe)[t(this,J)]=e},ae=new WeakMap,K=new WeakMap,R=new WeakMap,m=new WeakMap,Z=new WeakMap,L=new WeakMap,z=new WeakMap,se=new WeakMap,W=new WeakMap,Q=new WeakMap,Se=new WeakMap,me=new WeakMap,He=new WeakMap,ie=new WeakMap,D=new WeakMap,H=new WeakMap,Ye=new WeakMap,ee=new WeakMap,be=new WeakMap,ne=new WeakMap,Je=new WeakMap,Be=new WeakMap,X=new WeakMap,Ne=new WeakMap,ge=new WeakMap,ot=new WeakMap,Re=new WeakMap,Ee=new WeakMap,Ze=new WeakMap,De=new WeakMap,V=new WeakMap,U=new WeakMap,ve=new WeakMap,lt=new WeakMap,I=new WeakMap,Ie=new WeakMap,je=new WeakMap,et=new WeakMap,Oe=new WeakMap,Ae=new WeakMap,ht=new WeakMap,tt=new WeakMap,$e=new WeakMap,G=new WeakMap,pt=new WeakMap,dt=new WeakMap,Ge=new WeakMap,ce=new WeakMap,Te=new WeakMap,Le=new WeakMap,j=new WeakMap,_e=new WeakMap,F=new WeakMap,ft=new WeakMap,bt=new WeakMap,Xe=new WeakMap,Ve=new WeakMap,oe=new WeakMap,he=new WeakMap,Ce=new WeakMap,Fe=new WeakMap,Ke=new WeakMap,ze=new WeakMap,Qt);export{ra as OctaviaDevice,g as allocated,v as ccToPos,ue as dnToPos,O as getDebugState,ct as overrides};
