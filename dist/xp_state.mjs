var nr=Object.defineProperty;var cr=(p,e,r)=>e in p?nr(p,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):p[e]=r;var P=(p,e,r)=>(cr(p,typeof e!="symbol"?e+"":e,r),r),Pt=(p,e,r)=>{if(!e.has(p))throw TypeError("Cannot "+r)};var t=(p,e,r)=>(Pt(p,e,"read from private field"),r?r.call(p):e.get(p)),T=(p,e,r)=>{if(e.has(p))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(p):e.set(p,r)},S=(p,e,r,h)=>(Pt(p,e,"write to private field"),h?h.call(p,r):e.set(p,r),r),Ot=(p,e,r,h)=>({set _(u){S(p,e,u,r)},get _(){return t(p,e,h)}});(function(){var p=function(k,w,x){var a,s;if(self.MessageEvent)switch(k){case"message":{s=new MessageEvent(k,{data:w,ports:x==null?void 0:x.ports}),Object.defineProperty(s,"source",{value:x==null?void 0:x.source});break}default:s=new Event(k)}else s=document.createEvent("Event"),s.initEvent(k,!1,!1),x&&k=="message"&&(s.data=w,x.source&&Object.defineProperty(s,"source",{value:x.source}),(a=x.ports)!=null&&a.length&&Object.defineProperty(s,"ports",{value:x.ports}));return s};self.BroadcastChannel?console.info("[Snowy] Snowy is disabled."):(console.info("[Snowy] Snowy is enabled. Path: ".concat(self.SNOWY_PATH||"/snowy.js")),r=[],h={},u=function(k){var w,x=this;if((this==null?void 0:this.constructor)!=u)throw new TypeError("Illegal constructor");r.push(this),(w=h[k])!=null&&w.constructor||(h[k]=[]),h[k].push(this);var a=Math.floor(Math.random()*281474976710656),s=[],f=0,i=[],n=!0,o=!1;Object.defineProperty(this,"id",{get:function(){return a}}),Object.defineProperty(this,"name",{value:k}),this.close=function(){var d,l=r.indexOf(x);l>-1?(e.postMessage({t:"d",c:k,i:a}),r.splice(l,1),(d=h[k])!=null&&d.constructor&&(l=h[k].indexOf(x),l>-1&&h[k].splice(l,1)),h[k].length||delete h[k],console.debug("[Snowy] BroadcastChannel closed."),o=!0):console.debug("[Snowy] BroadcastChannel already closed.")},this.postMessage=function(d){if(e){if(o)throw new Error("Channel already closed");e.postMessage({t:"m",c:k,i:a,m:f,d}),f++,f>4294967295&&(f=0)}else i.push(d),console.debug("[Snowy] Message is cached.")},this.flush=function(){if(e){if(n){for(e.postMessage({t:"r",c:k,i:a}),console.debug("[Snowy] ".concat(i.length," message(s) in cache."));i.length;){var d=i.shift();x.postMessage(d)}n=!1,console.debug("[Snowy] All cached messages are flushed away.")}}else throw new Error("Tried to flush when the ports are not ready")},this.receiveMessage=function(d){d.c==k?d.i!=a&&x.dispatchEvent(p("message",d.d,{source:x})):console.debug("[Snowy] Channel ID mismatch. Instance ".concat(a," receives from ").concat(k,", not ").concat(d.c,"."))};var c={};this.dispatchEvent=function(d){var l,E;if(Object.defineProperty(d,"target",{value:x}),Object.defineProperty(d,"currentTarget",{value:x}),(l=c[d.type])!=null&&l.length)for(var C=c[d.type],M=0;M<C.length;M++)((E=C[M])==null?void 0:E.constructor)==Function&&C[M].call(x,d);x["on".concat(d.type)]&&x["on".concat(d.type)].constructor==Function&&x["on".concat(d.type)].call(x,d)},this.addEventListener=function(d,l){var E;(E=c[d])!=null&&E.constructor||(c[d]=[]);var C=c[d].indexOf(l);C==-1&&c[d].push(l)},this.removeEventListener=function(d,l){var E,C;if((E=c[d])!=null&&E.length){var M=c[d].indexOf(l);M>-1&&c[d].splice(M,1)}!((C=c[d])!=null&&C.length)&&c[d].constructor&&delete c[d]}},self.BroadcastChannel=u,b=function(){if(e){e.addEventListener("message",function(w){var x=w.data,a=!1;switch(x.t){case"k":{a=!1,e.postMessage({t:"k"});break}case"m":{var s=h[x.c];if(s!=null&&s.length)for(var f=0;f<s.length;f++)s[f].receiveMessage(x);break}case"c":{for(var i=[],n=0;n<r.length;n++){var o=r[n].name;i.indexOf(o)<0&&i.push(o)}e.postMessage({t:"k",c:i});break}default:a=!0}a&&console.info("ReceiveBroadcast",x)});for(var k=0;k<r.length;k++)r[k].flush()}else throw new Error("Message port isn't yet ready");console.info("[Snowy] Snowy is active.")},y=function(){if(!e){var k=new SharedWorker(self.SNOWY_PATH||"/snowy.js");k.port.start();var w=function(x){x.data.t=="swc"&&(k.port.removeEventListener("message",w),e=k.port,e.postMessage({t:"k"}),b())};k.port.addEventListener("message",w)}},y());var e,r,h,u,b,y})();{let p=function(e,r){let h=new FileReader;return new Promise((u,b)=>{switch(h.addEventListener("abort",()=>{b(new Error("Blob read aborted"))}),h.addEventListener("error",y=>{b(h.error||y.data||new Error("Blob read error"))}),h.addEventListener("load",()=>{u(h.result)}),r.toLowerCase()){case"arraybuffer":case"buffer":{h.readAsArrayBuffer(e);break}case"string":case"text":{h.readAsText(e);break}default:b(new Error(`Unknown target ${r}`))}})};Blob.prototype.arrayBuffer=Blob.prototype.arrayBuffer||function(){return p(this,"buffer")},Blob.prototype.text=Blob.prototype.text||function(){return p(this,"text")}}String.prototype.replaceAll=String.prototype.replaceAll||function(p,e){let r=0,h=16,u=this,b=[];for(;r<h&&u.lastIndexOf(p)>-1;){let y=u.lastIndexOf(p);b.unshift(u.slice(y+p.length)),u=u.slice(0,y),y==0&&b.unshift(""),r++}return u.length&&b.unshift(u),b.join(e)||""},String.prototype.padStart=String.prototype.padStart||function(p,e){if(e){let r=this;for(;r.length<p;)r=`${e}${r}`;return r}},String.prototype.padEnd=String.prototype.padEnd||function(p,e){if(e){let r=this;for(;r.length<p;)r+=e;return r}};var At=function(p,e){let r=Math.min(p.length,e.length),h=p.slice(0,r),u=e.slice(0,r),b=0,y=0;for(;y<r&&b==0;)b=Math.sign(h[y]-u[y]),y++;return b},fe=function(p=""){this.name=p,this.pool=[],this.point=function(e,r=!1){if(this.pool.length>0){let h=this.pool.length,u=1<<Math.floor(Math.log2(h)),b=u,y=64;for(;u>=1&&y>=0;){if(y<=0)throw new Error("TTL reached.");if(b==h)b-=u;else{let w=At(e,this.pool[b]);switch(w){case 0:{y=0;break}case 1:{b+u<=h&&(b+=u);break}case-1:{b!=0&&(b-=u);break}default:console.warn(`Unexpected result ${w}.`)}}u=u>>1,y--}let k=!0;if(b>=this.pool.length)k=!1;else{let w=this;this.pool[b].forEach(function(x,a,s){k&&x!=e[a]&&(k=!1)}),!k&&At(e,this.pool[b])>0&&b++}return k||r?b:-1}else return r?0:-1},this.add=function(e,r){return e.data=r,this.pool.splice(this.point(e,!0),0,e),this},this.default=function(e){console.warn(`No match in "${this.name||"(unknown)"}" for "${e}". Default action not defined.`)},this.get=function(e){let r=this.point(e);if(r>-1)return this.pool[r].data;this.default(e)},this.run=function(e,...r){let h=this.point(e);h>-1?e.subarray?this.pool[h].data(e.subarray(this.pool[h].length),...r):this.pool[h].data(e.slice(this.pool[h].length),...r):this.default(e,...r)}};var ae,Dt,Lt=(Dt=class{constructor(){T(this,ae,{})}addEventListener(p,e){t(this,ae)[p]||(t(this,ae)[p]=[]),t(this,ae)[p].unshift(e)}removeEventListener(p,e){if(t(this,ae)[p]){let r=t(this,ae)[p].indexOf(e);r>-1&&t(this,ae)[p].splice(r,1),t(this,ae)[p].length<1&&delete t(this,ae)[p]}}dispatchEvent(p,e){var u;let r=new Event(p),h=this;r.data=e,((u=t(this,ae)[p])==null?void 0:u.length)>0&&t(this,ae)[p].forEach(function(b){try{b==null||b.call(h,r)}catch(y){console.error(y)}}),this[`on${p}`]&&this[`on${p}`](r)}},ae=new WeakMap,Dt);var or=["MSB","PRG","LSB","NME","ELC","DRM","LVL"],lr={krs:"KR",s90es:"ES",motif:"ES"},hr={krs:"Kr",s90es:"SE",motif:"ME"},$t=function(p){let e=Math.floor(p/10),r=p%10;return`${e.toString(16)}${r}`},Q,Nt,wt=(Nt=class{constructor(...p){T(this,Q,void 0);P(this,"strictMode",!1);this.loadFiles(...p)}get bankInfo(){return t(this,Q)}get(p=0,e=0,r=0,h,u=0){var C,M;let b=[p,e,r],y,k=1,w=0,x,a,s=Array.from(arguments);switch(h){case"xg":{switch(p){case 0:{r===126?s[2]=125:r===127&&(s[2]=0);break}case 16:{r===126&&(s[2]=0);break}case 32:{r>125&&(s[2]=0),s[2]+=4;break}case 33:{(r>125||r===3)&&(s[2]=0),s[2]+=5;break}case 34:case 35:case 36:{r>125&&(s[2]=0),s[2]+=5;break}case 79:case 80:case 81:case 82:case 83:case 84:s[0]+=16;case 95:case 96:case 97:case 98:case 99:case 100:{r===126&&(s[2]=0);break}case 48:case 64:case 126:case 127:{r===126&&(p===127&&e===0||(s[2]=0));break}}break}case"gs":case"sc":{p===0&&r<5?s[0]=49:p>125&&r<5&&r!=2&&(s[2]=p,s[0]=49);break}case"mt32":{p===0&&(s[0]=49);break}case"sd":{switch(p){case 121:{s[0]=96;break}case 120:{s[0]=104;break}}s[0]>>1===40?s[2]|=16:s[0]>95&&s[0]<100&&(s[2]|=16,e>>4===7&&(s[0]=96));break}case"g2":{p>>1===40?s[2]|=16:p>95&&p<100&&(s[2]|=16,e>>4===7&&(s[0]=96));break}case"sg":{p===8&&r===0&&(s[2]=5);break}case"05rw":case"x5d":{p&&p<56&&(s[0]=56);break}case"s90es":{if(p===0)break;r<8?s[2]+=17:r<32?s[2]+=13:s[2]=(s[2]>>3)+19;break}case"motif":{if(p===0)break;r<8?s[2]+=28:r<32?s[2]+=13:s[2]=(s[2]>>3)+19;break}}let f=" ",i="M",n="",o=0,c=0;switch(s[0]){case 0:{switch(s[2]){case 127:{i="GM-a";break}case 126:{i="GM-n";break}case 7:{i="GM-k",n="GLX";break}case 5:{i="SG-a",n="000";break}case 4:{h==="gs"||h==="sc"?(i="GM-a",n="000"):(i="SP-l",n="C/M");break}case 3:case 2:case 1:{(h==="gs"||h==="sc")&&(i="GM-a",n="000");break}case 0:{i="GM-a";break}default:i="y",o=3}break}case 8:{h==="sg"?i="GM-s":i="r:";break}case 32:case 33:case 34:case 35:case 36:{h==="xg"&&(i=`${["AP","VL","PF","DX","AN"][p&7]}-${"abcdefgh"[r]}`,o=3);break}case 48:{n=`M${(s[2]>>3).toString().padStart(2,"0")}`,i=`y${n}`,o=1;break}case 49:{s[2]>>1===63?(i=`MT-${"ba"[s[2]&1]}`,n=`C${"-/"[s[2]&1]}M`):(i="GM-a",n="000");break}case 56:{i="GM-b";break}case 57:i=["yDOC","QY10","QY20"][s[2]-112]||"yMxv",n=["DOC","QY1","QY2"][s[2]-112]||"057";case 61:case 120:{i="rDrm";break}case 62:{i="kDrm";break}case 63:{if(s[2]<17){let R=s[2];i=R<10?"kP:":"kC:",i+=R%10}else s[2]<34?i=["Pre1","Pre2","Pre3","Pre4","Usr1","Usr2","DrmP","DrmU","Plg1","Plg2","Plg3","Pre1","Pre2","Pre3","Pre4","Pre5","Pre6"][s[2]-17]:i="Ds";o=1;break}case 64:{i="ySFX",n="SFX";break}case 67:{i="DX:S";break}case 80:case 81:case 82:case 83:{i=`Prg${"UABC"[s[0]-80]}`;break}case 88:case 89:case 90:case 91:{i=`Cmb${"UABC"[s[0]-88]}`;break}case 95:{i=`${["DR","PC"][s[2]]}-d`;break}case 96:{i=s[2]===106?"AP-a":s[2]>>4===1?"SDg":"PF",s[2]>63?c=63:s[2]>>4===1&&(c=16),o=3;break}case 97:{i=s[2]>>4===1?"SDa":"VL:",o=3,s[2]>>4===1?c=16:c=112;break}case 98:{i=s[2]>>4===1?"SDb":"SG-a",o=3,c=16;break}case 99:{i=s[2]>>4===1?"SDc":"DX",s[2]>63?c=63:s[2]>>4===1&&(c=16),o=3;break}case 100:{i="AN",s[2]>63?c=63:s[2]>>4===1&&(c=16),o=3;break}case 104:case 105:case 106:case 107:{i="SDd",c=104;break}case 121:{i=`GM-${s[2]?"":"a"}`,o=3;break}case 122:{i="lDrm";break}case 126:{i="yDrS";break}case 127:{s[2]===127?i="rDrm":i="yDrm";break}default:s[0]<48?i="r:":i="M"}i.length<4&&(i+=`${[p,r,s[0],s[2]][o]-c}`.padStart(4-i.length,"0")),n.length<3&&(n+=`${[p,r,p,r][o]}`.padStart(3-n.length,"0")),h==="xg"&&(p===0?s[2]<100?i=i.replace("y0","y:"):s[2]===125&&(i="y126"):p===16?(y=`Voice${((s[2]<<7)+s[1]+1).toString().padStart(3,"0")}`,f=" "):p===35&&r>>1===2&&(y=`DXCH_${(((s[2]&1)<<7)+e+1).toString().padStart(3,"0")}`,f=" "));let d=[s[0],s[1],s[2]];for(;!((y==null?void 0:y.length)>=0);)if(y=(C=t(this,Q)[s[1]||0][(s[0]<<8)+s[2]])==null?void 0:C.name,y){let R=t(this,Q)[s[1]||0][(s[0]<<8)+s[2]];k=(R==null?void 0:R.poly)||k,w=(R==null?void 0:R.type)||w,x=R==null?void 0:R.drum,a=R==null?void 0:R.level}else if(this.strictMode)y="",f="?";else if(s[0]===0&&s[1]===0&&s[2]===0)y="Unloaded";else if(t(this,Q)[s[1]||0][s[0]<<8])s[0]===0?(s[2]=0,f="^"):s[2]<1?(s[0]=0,f="*"):(s[2]--,f="^");else if(p===48)s[0]=0,s[2]=0,f="!";else if(p===62)s[1]--,f=" ",s[1]<1&&!(y!=null&&y.length)&&(s[0]=0,f="!");else if(p<63)s[0]===0?(s[2]=0,f="^"):s[2]<1?(s[0]=0,f="*"):s[2]--;else if(p===80)y=`PrgU:${e.toString().padStart(3,"0")}`,f="!";else if(p===88)y=`CmbU:${e.toString().padStart(3,"0")}`,f="!";else if(p===121)y=`GM2Vox0${r}`,f="#";else if(p===122)if(s[1]===32?s[1]:s[1]%=7,y=(M=t(this,Q)[s[1]||0][(s[0]<<8)+s[2]])==null?void 0:M.name,y){f=" ";let R=t(this,Q)[s[1]||0][(s[0]<<8)+s[2]];k=(R==null?void 0:R.poly)||k,w=(R==null?void 0:R.type)||w,x=R==null?void 0:R.drum,a=R==null?void 0:R.level}else y="",f="*";else s[1]===0?(y=`${p.toString().padStart(3,"0")} ${e.toString().padStart(3,"0")} ${r.toString().padStart(3,"0")}`,f="!"):s[0]===0?(s[2]=0,f="^"):s[2]>0?s[2]--:s[1]>0?(s[1]=0,f="!"):(s[0]=0,f="?");let l=[s[0],s[1],s[2]];switch(f){case"^":{switch(h){case"gs":case"sc":case"ns5r":{f=" ";break}}p===127&&f==="^"&&(f=" ");break}}let E="??";switch(s[0]){case 0:{s[2]===0?E="GM":s[2]===5||s[2]===7?E="KG":s[2]<126&&(E="XG");break}case 32:case 33:case 35:case 36:{s[2]>4?E=["AP","VL","PF","DX","AN"][s[0]-32]:E="GS";break}case 48:{E="MU";break}case 49:{s[2]>>1===63?E="MT":s[2]<5&&(E="GM");break}case 56:{E="AG";break}case 61:case 80:case 83:case 88:case 89:case 91:{E="AI";break}case 62:case 82:case 90:{E="XD";break}case 63:{s[2]<17?E="KR":s[2]<34?E="ES":E="DS";break}case 64:case 126:{E="XG";break}case 67:case 99:{E=s[2]>>4===1?"SD":"DX";break}case 81:{E="RW";break}case 95:{E=["DR","PC"][s[2]];break}case 96:{E=s[2]===106?"AP":s[2]>>4===1?"SD":"PF";break}case 97:{E=s[2]>>4===1?"SD":"VL";break}case 98:{E=s[2]>>4===1?"SD":"SG";break}case 100:{E="AN";break}case 104:case 105:case 106:case 107:{E="SD";break}case 120:{E=e===0?"GM":"GS";break}case 121:{E=s[2]?"G2":"GM";break}case 122:{E="KG";break}case 127:{E=s[2]===127?"MT":e===0?"GM":"XG";break}default:s[0]<48&&(s[0]===16&&h==="xg"?E="XG":E="GS")}if(f!=" ")switch(h){case"krs":case"s90es":case"motif":{y="",E=lr[h];break}default:self.debugMode&&(y="")}return{name:y||`${hr[h]||h.toUpperCase()}${$t(p||0)}${$t(e||0)}${$t(r||0)}`,poly:k,type:w,drum:x,level:a,iid:d,eid:l,sid:b,ending:f,sect:i,bank:n,standard:E,mode:h}}async load(p,e,r="(internal)",h){let u=this,b=[],y=0,k=0,w=0;p.split(`
`).forEach(function(x,a){var i;let s=x.split("	"),f=[];if(a===0){if(s.forEach(function(n,o){b[or.indexOf(n)]=o}),b.length<4){console.debug("Debugger launched.");debugger}}else{let n=0,o=0,c=0,d,l=1,E=0,C,M;s.forEach(function(X,Ct){switch(Ct){case b[0]:{n=parseInt(X);break}case b[1]:{o=parseInt(X);break}case b[2]:{c=parseInt(X);break}case b[3]:{d=X;break}case b[4]:{X=parseInt(X),X<16?l=X+1:(E=(X&15)+1,l=E);break}case b[5]:{M=X;break}case b[6]:{X!=null&&X.constructor&&(C=parseInt(X));break}}}),t(u,Q)[o]=t(u,Q)[o]||[];let R=t(u,Q)[o],re={msb:n,prg:o,lsb:c,name:d,poly:l,type:E,drum:M,level:C,priority:h},ke=!1;h<((i=R[n<<8|c])==null?void 0:i.priority)&&(ke=!0,w++),(!R[n<<8|c]||ke||e)&&(R[n<<8|c]=re,y++),k++}}),e||console.debug(`Map "${r}": ${k} total, ${y} loaded (${y-w} + ${w}).`)}clearRange(p){let e=p.prg!=null?p.prg.constructor===Array?p.prg:[p.prg,p.prg]:[0,127],r=p.msb!=null?p.msb.constructor===Array?p.msb:[p.msb,p.msb]:[0,127],h=p.lsb!=null?p.lsb.constructor===Array?p.lsb:[p.lsb,p.lsb]:[0,127];for(let u=r[0];u<=r[1];u++){let b=u<<8;for(let y=h[0];y<=h[1];y++){let k=b+y;for(let w=e[0];w<=e[1];w++)delete t(this,Q)[w][k]}}}init(){S(this,Q,[]);for(let p=0;p<128;p++)t(this,Q).push([""])}async loadFiles(...p){this.init();let e=this;p.forEach(async function(r,h){try{e.load(await(await fetch(`./data/bank/${r}.tsv`)).text(),!1,r,h)}catch(u){console.error(`Failed loading "${r}.tsv".`)}})}},Q=new WeakMap,Nt);var Ye,Ut,_t=(Ut=class{constructor(){T(this,Ye,{});P(this,"context")}set(p,e){t(this,Ye)[p]=e}has(p){return!!t(this,Ye)[p]}async read(p,e){if(!this.has(p))throw new Error(`No decoder registered for "${p}"`);return await t(this,Ye)[p].call(this.context||this,e)}},Ye=new WeakMap,Ut);var dr=function(p,e){let r=!0;return e.forEach((h,u)=>{r=r&&p[u]===h}),r},st=function(p){let e=0;return p.forEach(r=>{e*=256,e+=r}),e},me=new TextDecoder,it=new _t;it.set("s7e",async function(p){let e=new Uint8Array(await p.slice(0,65536).arrayBuffer()),r="MSB	LSB	PRG	NME",h=[0,0,0,0],u=32,b=0,y=0,k=!0,w=[],x=0;for(;k;){let a=e.subarray(b);([()=>{me.decode(a.subarray(0,4))==="YSFC"?(b+=80,y=1):b++},()=>{if(dr(a.subarray(0,4),h))w.forEach((s,f,i)=>{let n=st(e.subarray(s.start+4,s.start+8));s.length=n}),y=2;else{let s=me.decode(a.subarray(0,4)),f=st(a.subarray(4,8));w.push({type:s,start:f}),b+=8}},()=>{let s=w[x],f=e.subarray(s.start,s.start+s.length),i=32;switch(s.type){case"ENVC":{let n=u;for(;n<f.length;){let o=f.subarray(n,n+i),c=me.decode(o.subarray(0,10)).trimEnd();c.slice(0,5)==="Init "&&(c=""),c&&(r+=`
063	${(o[17]+13).toString().padStart(3,"0")}	${o[19].toString().padStart(3,"0")}	${c}`),n+=i}break}case"EDVC":{let n=u;for(;n<f.length;){let o=f.subarray(n,n+i),c=me.decode(o.subarray(0,10)).trimEnd();c.slice(0,5)==="Init "&&(c=""),c&&(r+=`
063	024	${o[19].toString().padStart(3,"0")}	${c}`),n+=i}break}case"EPVC":{let n=32,o=u;for(;o<f.length;){let c=f.subarray(o,o+n),d=me.decode(c.subarray(0,10)).trimEnd();d==="----------"&&(d=""),d&&(r+=`
063	${(c[17]+1).toString().padStart(3,"0")}	${c[19].toString().padStart(3,"0")}	${d}`),o+=n}break}}x++,x>=w.length&&(y=3,k=!1)}][y]||(()=>{k=!1}))()}return r});it.set("pcg",async function(p){let e=new Uint8Array(await p.arrayBuffer()),r="MSB	LSB	PRG	NME",h=100,u=0,b=0,y=!0,k=[],w=0;for(;y;){let x=e.subarray(h);([()=>{y=me.decode(x.subarray(0,4))==="INI2",b=x[15],h+=16,u=1},()=>{let a=me.decode(x.subarray(0,4)),s=x[5],f=x[7],i=x[11],n=st(x.subarray(12,16)),o=st(x.subarray(16,20)),c=st(x.subarray(36,40)),d=me.decode(x.subarray(44,44+i));k.push({type:a,tipMsb:s,tipLsb:f,nameLen:i,length:n,start:o,entryLen:c,name:d}),h+=64,b--,b<1&&(u=2)},()=>{let a=k[w],s=e.subarray(a.start,a.start+a.length);switch(a.type){case"PRG1":break;case"PBK1":{let f=63,i=(a.tipMsb?6:0)+a.tipLsb;for(let n=0;n<128;n++){let o=n*a.entryLen,c=s.subarray(o,o+a.entryLen),d=me.decode(c.subarray(0,24)).trimEnd().replace("InitProg","");d.length&&i>5&&(r+=`
${f.toString().padStart(3,"0")}	${i.toString().padStart(3,"0")}	${n.toString().padStart(3,"0")}	${d}`)}break}case"CBK1":{let f=63,i=(a.tipMsb?3:0)+a.tipLsb+10;for(let n=0;n<128;n++){let o=n*a.entryLen,c=s.subarray(o,o+a.entryLen),d=me.decode(c.subarray(0,24)).trimEnd().replace("InitCombi","");d.length&&i>12&&(r+=`
${f.toString().padStart(3,"0")}	${i.toString().padStart(3,"0")}	${n.toString().padStart(3,"0")}	${d}`)}break}}w++,w>=k.length&&(u=3,y=!1)}][u]||(()=>{y=!1}))()}return r});var nt=["off","hall","room","stage","plate","delay LCR","delay LR","echo","cross delay","early reflections","gate reverb","reverse gate"].concat(new Array(4),["white room","tunnel","canyon","basement","karaoke"],new Array(43),["pass through","chorus","celeste","flanger","symphonic","rotary speaker","tremelo","auto pan","phaser","distortion","overdrive","amplifier","3-band EQ","2-band EQ","auto wah"],new Array(1),["pitch change","harmonic","touch wah","compressor","noise gate","voice channel","2-way rotary speaker","ensemble detune","ambience"],new Array(4),["talking mod","Lo-Fi","dist + delay","comp + dist + delay","wah + dist + delay","V dist","dual rotor speaker"]),ct=["melodic","drums","drum set 1","drum set 2","drum set 3","drum set 4","drum set 5","drum set 6","drum set 7","drum set 8"],fr=[17.1,18.6,20.2,21.8,23.3,24.9,26.5,28,29.6,31.2,32.8,34.3,35.9,37.5,39,40.6,42.2,43.7,45.3,46.9,48.4,50],Qe=[20,22,25,28,32,36,40,45,50,56,63,70,80,90,100,110,125,140,160,180,200,225,250,280,315,355,400,450,500,560,630,700,800,900,1e3,1100,1200,1400,1600,1800,2e3,2200,2500,2800,3200,3600,4e3,4500,5e3,5600,6300,7e3,8e3,9e3,1e4,11e3,12e3,14e3,16e3,18e3,2e4],Bt=[0,.04,.08,.13,.17,.21,.25,.29,.34,.38,.42,.46,.51,.55,.59,.63,.67,.72,.76,.8,.84,.88,.93,.97,1.01,1.05,1.09,1.14,1.18,1.22,1.26,1.3,1.35,1.39,1.43,1.47,1.51,1.56,1.6,1.64,1.68,1.72,1.77,1.81,1.85,1.89,1.94,1.98,2.02,2.06,2.1,2.15,2.19,2.23,2.27,2.31,2.36,2.4,2.44,2.48,2.52,2.57,2.61,2.65,2.69,2.78,2.86,2.94,3.03,3.11,3.2,3.28,3.37,3.45,3.53,3.62,3.7,3.87,4.04,4.21,4,37,4.54,4.71,4.88,5.05,5.22,5.38,5.55,5.72,6.06,6.39,6.73,7.07,7.4,7.74,8.08,8.41,8.75,9.08,9.42,9.76,10.1,10.8,11.4,12.1,12.8,13.5,14.1,14.8,15.5,16.2,16.8,17.5,18.2,19.5,20.9,22.2,23.6,24.9,26.2,27.6,28.9,30.3,31.6,33,34.3,37,39.7],It=function(p){let e=.1,r=-.3;return p>66?(e=5,r=315):p>56?(e=1,r=47):p>46&&(e=.5,r=18.5),e*p-r},Ht=function(p){return p>105?fr[p-106]:p>100?p*1.1-100:p/10},Gt=",a,i,u,e,o,ka,ki,ku,ke,ko,ky,kw,sa,si,su,se,so,sh,ta,ti,tu,te,to,t,ch,t,s,na,ni,nu,ne,no,ny,nn,ha,hi,hu,he,ho,hy,fa,fi,fu,fe,fo,ma,mi,mu,me,mo,my,mm,ya,yu,ye,yo,ra,ri,ru,re,ro,ry,wa,wi,we,wo,ga,gi,gu,ge,go,gy,gw,za,zi,zu,ze,zo,ja,ji,ju,je,jo,jy,da,di,du,de,do,dy,ba,bi,bu,be,bo,by,va,vi,vu,ve,vo,pa,pi,pu,pe,po,py,nga,ngi,ngu,nge,ngo,ngy,ng,hha,hhi,hhu,hhe,hho,hhy,hhw,*,_,,,~,.".split(","),kt={};`hi*,
ka,ã‹
ki,ã
ku,ã
ke,ã‘
ko,ã“
ky,ã!
kw,ãl
tsu,ã¤
ts,ã¤l
sa,ã•
si,ã™ãƒ
su,ã™
se,ã›
so,ã
shi,ã—
sh,ã—!
ta,ãŸ
ti,ã¦ãƒ
tu,ã¨ã…
te,ã¦
to,ã¨
tchy,ã¡!
tchi,ã¡
na,ãª
ni,ã«
nu,ã¬
ne,ã­
no,ã®
ny,ã«!
nn,ã‚“
ha,ã¯
hi,ã²
hu,ã»ã…
he,ã¸
ho,ã»
hy,ã²!
fa,ãµã
fi,ãµãƒ
fu,ãµ
fe,ãµã‡
fo,ãµã‰
ma,ã¾
mi,ã¿
mu,ã‚€
me,ã‚
mo,ã‚‚
my,ã¿!
mm,ã‡º
ra,ã‚‰
ri,ã‚Š
ru,ã‚‹
re,ã‚Œ
ro,ã‚
ry,ã‚Š!
wa,ã‚
wi,ã‚
we,ã‚‘
wo,ã‚’
nga,ã‹ã‚š
ngi,ãã‚š
ngu,ãã‚š
nge,ã‘ã‚š
ngo,ã“ã‚š
ngy,ãã‚š!
ng,ãƒ³
ga,ãŒ
gi,ãŽ
gu,ã
ge,ã’
go,ã”
gy,ãŽ!
gw,ãl
za,ã–
zi,ãšãƒ
zu,ãš
ze,ãœ
zo,ãž
ja,ã˜ã‚ƒ
ji,ã˜
ju,ã˜ã‚…
je,ã˜ã‡
jo,ã˜ã‚‡
jy,ã˜!
da,ã 
di,ã§ãƒ
du,ã©ã…
de,ã§
do,ã©
dy,ã§!
ba,ã°
bi,ã³
bu,ã¶
be,ã¹
bo,ã¼
by,ã³!
va,ã‚”ã
vi,ã‚”ãƒ
vu,ã‚”
ve,ã‚”ã‡
vo,ã‚”ã‰
pa,ã±
pi,ã´
pu,ã·
pe,ãƒš
po,ã½
py,ã´!
!ya,ã‚ƒ
!yu,ã‚…
!ye,ã‡
!yo,ã‚‡
ya,ã‚„
yu,ã‚†
ye,ð›€
yo,ã‚ˆ
!a,ã‚ƒ
!u,ã‚…
!e,ã‡
!o,ã‚‡
!a,ã‚ƒ
!u,ã‚…
!e,ã‡
!o,ã‚‡
la,ã
li,ãƒ
lu,ã…
le,ã‡
lo,ã‰
a,ã‚
i,ã„
u,ã†
e,ãˆ
o,ãŠ
*,ã£
~,
^,
_,`.split(`
`).forEach(p=>{let e=p.split(",");kt[e[0]]=e[1]});var Xt=function(p){let e=p;p[0]=="*"&&(e=e.slice(1)),["aa","ii","uu","ee","oo"].forEach(h=>{for(;e.indexOf(h)>-1;)e=e.replace(h,h[0])});for(let h in kt)e=e.replaceAll(h,kt[h]);e.indexOf("ã‚“")==0&&e.length>1&&(e=e.slice(1));let r=e.indexOf("!");return r>-1&&e.length>1&&(e=e.slice(r+1)),e},Kt=function(p){return p?p<96?`cc${p}`:["aftertouch","velocity","pitch bend"][p-96]:"off"},Vt={u8:["utf-8","Unicode"],l1:["l9","Pan-Latin"],jp:["sjis","Japanese"],kr:["iso-2022-kr","Korean"],hz:["gb18030","Simplified Chinese"],b5:["big5","Traditional Chinese"],cy:["koi8-ru","Cyrillic"],vn:["tcvn-5773-1993","Vietnamese"]},Ft={m:"Male",f:"Female",c:"Chorus",s:"Solo",p:"Plural",w:"Words",x:"Non-vocal"};var xt=["room 1","room 2","room 3","hall 1","hall 2","plate","delay","panning delay"],zt=["chorus 1","chorus 2","chorus 3","chorus 4","feedback","flanger","short delay","short delay feedback"],Wt=["delay 1","delay 2","delay 3","delay 4","pan delay 1","pan delay 2","pan delay 3","pan delay 4","delay to reverb","pan repeat"];var ur={0:"thru",256:"stereo EQ",257:"spectrum",258:"enhancer",259:"humanizer",272:"overdrive",273:"distortion",288:"phaser",289:"auto wah",290:"rotary",291:"stereo flanger",292:"step flanger",293:"tremelo",294:"auto pan",304:"compressor",305:"limiter",320:"hexa chorus",321:"tremelo chorus",322:"stereo chorus",323:"space D",324:"3D chorus",336:"stereo delay",337:"modulated delay",338:"3-tap delay",339:"4-tap delay",340:"tremelo control delay",341:"reverb",342:"gate reverb",343:"3D delay",352:"2-pitch shifter",353:"feedback pitch shifter",368:"3D auto",369:"3D manual",370:"Lo-Fi 1",371:"Lo-Fi 2",512:"overdrive - chorus",513:"overdrive - flanger",514:"overdrive - delay",515:"distortion - chorus",516:"distortion - flanger",517:"distortion - delay",518:"enhancer - chorus",519:"enhancer - flanger",520:"enhancer - delay",521:"chorus - delay",522:"flanger - delay",523:"chorus - flanger",524:"rotary multi",1024:"guitar multi 1",1025:"guitar multi 2",1026:"guitar multi 3",1027:"clean guitar multi 1",1028:"clean guitar multi 2",1029:"bass multi",1030:"rhodes multi",1280:"keyboard multi",4352:"chorus / delay",4353:"flanger / delay",4354:"chorus / flanger",4355:"overdrive / distortion",4356:"overdrive / rotary",4357:"overdrive / phaser",4358:"overdrive / auto wah",4359:"phaser / rotary",4360:"phaser / auto wah"},pr={66307:["drive"],66309:["vowel",p=>"aiueo"[p]],94723:["pre-filter"],94724:["Lo-Fi type"],94725:["post-filter"],94979:["Lo-Fi type"],94980:["fill type",p=>["off","LPF","HPF"][p]],94984:["noise type",p=>["white","pink"][p]],94987:["disc type",p=>["LP","SP","EP","RND"]],94990:["hum type",p=>`${p+5}0Hz`],94993:["M/S",p=>["mono","stereo"][p]]},St=function(p){return ur[(p[0]-32<<8)+p[1]]||`0x${p[0].toString(16).padStart(2,"0")}${p[1].toString(16).padStart(2,"0")}`},qt=function(p,e,r){let h=(p[0]-32<<16)+(p[1]<<8)+e,u=pr[h]||{},b=u[0];if(b!=null&&b.length)return b+=`: ${(u[1]||function(){})(r)||r}`,b},Tt=[68,48,95,78,41,3,110,122,0];var se=function(p=64){return Math.round(2e3*Math.log10(p/64))/100};var Re=function(p){let e=0;return p.forEach(r=>{e+=r,e=e&127}),~e+1&127},ue=function(p,e){let r=0,h=0;for(let u=0;u<p.length;u++){let b=u%8-1,y=(h>>b&1)<<7,k=p[u];k+=y,u%8!=0?(e(k,r,p),r++):h=p[u]}};var ot=function(p){let e=Math.floor(p*14.2);return e<128?e:0},D=function(){var p;return self.Bun?!0:(p=self.debugMode)!=null?p:!1};var V=["?","gm","gs","sc","xg","g2","mt32","doc","qy10","qy20","ns5r","x5d","05rw","k11","sg","sd","pa","krs","s90es","motif","trin"],br={gm2:"g2","mt-32":"mt32","c/m":"mt32",ag10:"05rw","ag-10":"05rw","05r/w":"05rw",x5:"05rw",x5dr:"x5d",gmega:"k11","kross 2":"krs","motif es":"motif","s90 es":"s90es",trinity:"trin","tr-rack":"trin"},Er=["melodic","drum","menu"],Yt={"?":[0,0,120,0,0],gm:[0,0,120,0,0],gs:[0,0,120,0,0],sc:[0,0,120,0,0],xg:[0,0,127,0,0],g2:[0,0,120,0,0],mt32:[0,127,127,0,127],doc:[57,112,127,57,112],qy10:[57,113,127,57,113],qy20:[57,114,127,57,114],ns5r:[0,0,61,0,0],x5d:[82,0,62,56,0],"05rw":[81,0,62,56,0],k11:[0,0,122,0,0],sg:[0,0,122,0,0],sd:[97,0,105,0,0],krs:[121,0,120,0,0],s90es:[0,0,127,0,0],motif:[0,0,127,0,0],trin:[0,0,127,0,0]},gr=[9,25,41,57,73,89,105,121],yr=[0,3,81,84,88],Qt={8:"Off",9:"On",10:"Note aftertouch",11:"cc",12:"pc",13:"Channel aftertouch",14:"Pitch"},Jt={0:0,1:1,2:3,5:4},jt={0:0,1:1,2:2,5:3},Zt=[[0,24],[0,127],[0,127],[40,88],[0,127],[0,127]],Rt=[36,37,48,49,52,53],vt=[20,21,22,23,24,25,26,28,29,30,31,36,37,48,49,52,53,64,65],er={26:127,29:0,30:0,31:0,52:12,53:54},Je=[0,1,2,4,5,6,7,8,10,11,12,13,14,15,16,17,18,19,20,21,22,26,28,32,38,40,41,42,43,44,45,46,47,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,80,81,82,83,84,91,92,93,94,95,98,99,100,101,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157],mr=[2,4,12,13,14,15,16,17,18,19,20,21,40,41,42,43,44,45,46,47,80,81,83,136,130,131,132,133,134,135,137,138,139,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157],vr=[33,102,99,32,100,8,9,10],tr=[0,16,25,40,32,64,24,48],$={};V.forEach((p,e)=>{$[p]=e});var v=[];Je.forEach((p,e)=>{v[p]=e});var pe={length:vt.length};vt.forEach((p,e)=>{pe[p]=e});var Cr={};Er.forEach((p,e)=>{Cr[p]=e});var $r=function(p){let e=[],r=0;return p==null||p.forEach(function(h,u){h===247?e.push(p.subarray(r,u)):h===240&&(r=u+1)}),e.length||e.push(p.subarray(0)),D()&&console.debug(e),e};var Mt=8,g={port:Mt,ch:Mt<<4,chShift:Math.ceil(Math.log2(Mt))+4,cc:Je.length,nn:128,pl:512,tr:256,cmt:14,rpn:6,rpnt:4,nrpn:Rt.length,ace:8,drm:8,dpn:vt.length,dnc:128,ext:3,efx:7,cvn:12,redir:32,vxPrim:3,invalidCh:255};g.chcc=g.cc*g.ch;var lt={bank0:128},_=new Uint16Array(g.ch),Et=new Uint16Array(g.ch),wr=new Uint16Array(g.ch),kr=new Uint16Array(g.ch),sr=new Uint16Array(g.ch),rr=new Array(g.drm);for(let p=0;p<g.ch;p++)_[p]=p*g.cc,Et[p]=p*g.rpn,wr[p]=p*g.nrpn,kr[p]=p*g.ace,sr[p]=p*g.ext;for(let p=0;p<g.drm;p++){rr[p]=new Uint16Array(g.dpn);let e=p*g.dpn*g.dnc;for(let r=0;r<g.dpn;r++)rr[p][r]=e+r*g.dnc}var B,J,be,Se,he,xe,ir,ie,W,O,m,j,L,q,ee,K,H,Te,ve,Ne,ne,A,U,je,te,Ee,ce,Ze,Ue,F,et,_e,ge,ht,Pe,ye,tt,Oe,z,N,Ce,dt,G,Be,rt,Ie,He,gt,Ge,Ae,De,ft,at,$e,I,yt,ut,Xe,oe,Me,Le,Z,Ke,Y,pt,mt,Ve,Fe,le,de,we,ze,We,qe,ar,da=(ar=class extends Lt{constructor(){super();T(this,he);P(this,"NOTE_IDLE",0);P(this,"NOTE_ATTACK",1);P(this,"NOTE_DECAY",2);P(this,"NOTE_SUSTAIN",3);P(this,"NOTE_HELD",4);P(this,"NOTE_RELEASE",5);P(this,"NOTE_SOSTENUTO_ATTACK",8);P(this,"NOTE_SOSTENUTO_DECAY",9);P(this,"NOTE_SOSTENUTO_SUSTAIN",10);P(this,"NOTE_SOSTENUTO_HELD",11);P(this,"NOTE_MUTED_RECOVERABLE",16);P(this,"CH_MELODIC",0);P(this,"CH_DRUMS",1);P(this,"CH_DRUM1",2);P(this,"CH_DRUM2",3);P(this,"CH_DRUM3",4);P(this,"CH_DRUM4",5);P(this,"CH_DRUM5",6);P(this,"CH_DRUM6",7);P(this,"CH_DRUM7",8);P(this,"CH_DRUM8",9);P(this,"DUMP_ALL",0);P(this,"DUMP_ONCE",1);P(this,"DUMP_MODE",2);P(this,"EXT_NONE",0);P(this,"EXT_VL",1);P(this,"EXT_DX",3);P(this,"VLBC_SYSTEM",0);P(this,"VLBC_BRTHEXPR",1);P(this,"VLBC_VELOINIT",2);P(this,"VLBC_VELOALL",3);P(this,"CH_INACTIVE",0);P(this,"CH_ACTIVE",1);P(this,"CH_DISABLED",2);P(this,"KARAOKE_NONE",0);P(this,"KARAOKE_TEXT",1);P(this,"KARAOKE_XF",2);T(this,B,0);T(this,J,0);T(this,be,0);T(this,Se,new Array(11));T(this,ie,new Uint8Array(g.ch));T(this,W,new Uint8Array(g.ch));T(this,O,new Uint8Array(g.ch));T(this,m,new Uint8Array(g.chcc<<1));T(this,j,new Uint8Array(g.ch*g.ace));T(this,L,new Uint8Array(g.ch*g.vxPrim));T(this,q,new Uint8Array(g.ch*g.nn));T(this,ee,new Uint8Array(g.ch));T(this,K,new Uint16Array(g.pl));T(this,H,new Uint8Array(g.pl));T(this,Te,new Int16Array(g.ch));T(this,ve,new Uint8Array(g.ch));T(this,Ne,new Uint8Array(g.ch));T(this,ne,new Uint8Array(g.ch*g.ext));T(this,A,new Uint8Array(g.ch*g.rpn));T(this,U,new Uint8Array(g.ch*g.rpnt));T(this,je,new Int8Array(g.ch*Rt.length));T(this,te,new Uint8Array(g.drm*g.dpn*g.dnc));T(this,Ee,new Uint8Array(g.drm*2));T(this,ce,new Uint8Array(g.efx*3));T(this,Ze,new Uint8Array(g.ch));T(this,Ue,new Uint8Array(g.ch*g.redir));T(this,F,new Uint8Array(g.port));T(this,et,new Uint8Array(g.port));T(this,_e,new Uint8Array(g.ch));T(this,ge,new Uint8Array(g.ch));T(this,ht,new Uint8Array(g.ch*g.cvn));T(this,Pe,new Uint8Array(128));T(this,ye,new Uint8Array(g.cmt*8));T(this,tt,new Uint8Array(1024));T(this,Oe,new Uint8Array(g.cmt*64));T(this,z,{});P(this,"modelEx",{sc:{showBar:!0,invBar:!1,invDisp:!1,peakHold:1}});T(this,N,void 0);T(this,Ce,void 0);T(this,dt,void 0);T(this,G,100);T(this,Be,0);T(this,rt,500);T(this,Ie,0);T(this,He,0);T(this,gt,32);T(this,Ge,!1);T(this,Ae,"");T(this,De,0);T(this,ft,0);T(this,at,0);T(this,$e,!0);T(this,I,0);T(this,yt,1);T(this,ut,void 0);T(this,Xe,new Array(g.ch));T(this,oe,[]);T(this,Me,new Uint8Array(g.ch));T(this,Le,new Uint8Array(g.tr));P(this,"baseBank",new wt("gm2","ns5r","xg","gs","sd","gmega","plg-vl","plg-pf","plg-dx","plg-an","plg-dr","plg-sg","kross","s90es"));P(this,"userBank",new wt("gm2"));P(this,"initOnReset",!1);P(this,"aiEfxName","");P(this,"polyIndexShrink",!0);P(this,"polyIndexLatest",0);P(this,"polyIndexLast",0);T(this,Z,[]);T(this,Ke,void 0);T(this,Y,{nOff:(e,r)=>{let h=e*128+r,u=t(this,K).lastIndexOf(h);if(u>-1)if(this.getChCc(e,64)>>6)t(this,H)[u]=this.NOTE_HELD,this.dispatchEvent("note",{part:e,note:r,velo:t(this,q)[h],state:this.NOTE_HELD});else if(this.getChCc(e,66)>>6&&t(this,H)[u]===this.NOTE_SOSTENUTO_SUSTAIN)t(this,H)[u]=this.NOTE_SOSTENUTO_HELD,this.dispatchEvent("note",{part:e,note:r,velo:t(this,q)[h],state:this.NOTE_SOSTENUTO_HELD});else{t(this,K)[u]=0,t(this,q)[h]=0,t(this,H)[u]=this.NOTE_IDLE;let b=this.getExt(e)[1];(b===this.VLBC_VELOINIT||b===this.VLBC_VELOALL)&&this.setChCc(e,129,0),this.dispatchEvent("note",{part:e,note:r,velo:0,state:this.NOTE_IDLE})}if(t(this,ee)[e]){for(let b=this.polyIndexLast;b>=0;b--)if(t(this,K)[b]>>7===e&&t(this,H)[b]!==0){t(this,H)[b]===this.NOTE_MUTED_RECOVERABLE&&(t(this,H)[b]=this.NOTE_SUSTAIN);break}}this.polyIndexShrink&&this.polyIndexLast>0&&t(this,H)[this.polyIndexLast]===0&&this.polyIndexLast--},nOn:(e,r,h)=>{let u=e*128+r,b=0;if(t(this,ee)[e])for(let y=0;y<=this.polyIndexLast;y++)t(this,K)[y]>>7===e&&t(this,H)[y]!==0&&(t(this,H)[y]=this.NOTE_MUTED_RECOVERABLE);for(;t(this,H)[b]>0&&t(this,K)[b]!=u;)b++;if(b<g.pl){t(this,K)[b]=u,t(this,q)[u]=h,t(this,H)[b]=this.NOTE_SUSTAIN,t(this,ve)[e]<h&&(t(this,ve)[e]=h);let y=this.getExt(e)[1];(y===this.VLBC_VELOINIT||y===this.VLBC_VELOALL)&&this.setChCc(e,129,h),this.dispatchEvent("note",{part:e,note:r,velo:h,state:this.NOTE_SUSTAIN}),this.polyIndexLatest=b+1,b>this.polyIndexLast&&(this.polyIndexLast=b)}else console.error("Polyphony exceeded.")},nAt:(e,r,h)=>{},cAt:(e,r)=>{},hoOf:e=>{t(this,H).forEach((r,h)=>{if(r===this.NOTE_HELD){let u=t(this,K)[h],b=u>>7;e===b&&(t(this,H)[h]=this.NOTE_IDLE,t(this,K)[h]=0,t(this,q)[u]=0,this.dispatchEvent("note",{part:e,note:u&127,velo:0,state:this.NOTE_IDLE}))}})},soOn:e=>{t(this,H).forEach((r,h)=>{let u;switch(r){case this.NOTE_ATTACK:{u=this.NOTE_SOSTENUTO_ATTACK;break}case this.NOTE_DECAY:{u=this.NOTE_SOSTENUTO_DECAY;break}case this.NOTE_SUSTAIN:{u=this.NOTE_SOSTENUTO_SUSTAIN;break}}if(u){t(this,H)[h]=u;let b=t(this,K)[h];this.dispatchEvent("note",{part:e,note:b&127,velo:t(this,q)[b],state:u})}})},soOf:e=>{t(this,H).forEach((r,h)=>{if(r===this.NOTE_SOSTENUTO_HELD){let u=t(this,K)[h],b=u>>7;e===b&&(t(this,H)[h]=this.NOTE_IDLE,t(this,K)[h]=0,t(this,q)[u]=0,this.dispatchEvent("note",{part:e,note:u&127,velo:0,state:this.NOTE_IDLE}))}})},ano:e=>{t(this,K).forEach(r=>{let h=r>>7,u=r&127;r===0&&t(this,q)[0]===0||h===e&&t(this,Y).nOff(h,u)})}});T(this,pt,{8:function(e){let r=e.channel,h=e.data[0];t(this,Y).nOff(r,h)},9:function(e){let r=e.channel,h=this;if(h.getChModeId(r)===$.xg&&t(h,O)[r]>1){let y=h.getChDrumFirstWrite(r);y[0]&&y[1]!=g.invalidCh&&!t(h,ie)[r]&&(h.copyChSetup(y[1],r),h.dispatchEvent("voice",{part:r}),console.debug(`Part CH${r+1} copied from CH${y[1]+1}.`))}h.setChActive(r,1);let u=e.data[0],b=e.data[1];b>0?t(h,Y).nOn(r,u,b):t(h,Y).nOff(r,u)},10:function(e){let r=e.channel,h=r*128+e.data[0];t(this,K).indexOf(h)>-1&&(t(this,q)[h]=data[1],this.getExt(r)[1]===this.VLBC_VELOALL&&this.setChCc(r,129,data[1]),this.dispatchEvent("note",{part:r,note:e.data[0],velo:e.data[1],state:this.NOTE_SUSTAIN}))},11:function(e){let r=e.channel,h=this,u=t(h,Xe)[r],b=u[e.data[0]];b&&(e.data[0]=b),[0,32].indexOf(e.data[0])>-1&&(()=>{switch(t(this,B)){case $.s90es:case $.motif:{if(e.data[0]===0){[0,63].indexOf(e.data[1])>-1&&h.setChActive(r,1);break}e.data[1]&&h.setChActive(r,1);break}default:break}})();let y=r*g.ext,k=h.getChModeId(r);switch(e.data[0]){case 96:return;case 97:return;case 120:return;case 121:{t(this,Y).ano(r),t(this,Te)[r]=0,h.resetChCc(r,1,0),h.resetChCc(r,5,0),h.resetChCc(r,64,0),h.resetChCc(r,65,0),h.resetChCc(r,66,0),h.resetChCc(r,67,0),h.resetChCc(r,11,127),h.resetChCc(r,101,127),h.resetChCc(r,100,127),h.resetChCc(r,99,127),h.resetChCc(r,98,127);return}case 123:{t(this,Y).ano(r);return}case 124:{t(this,Y).ano(r);return}case 125:{t(this,Y).ano(r);return}case 126:{t(this,ee)[r]=1,t(this,Y).ano(r);return}case 127:{t(this,ee)[r]=0,t(this,Y).ano(r);return}}if(v[e.data[0]]===void 0)console.warn(`cc${e.data[0]} is not accepted.`);else{switch(mr.indexOf(e.data[0])>-1&&this.allocateAce(r,e.data[0]),e.data[0]){case 0:{switch(D()&&console.debug(`${V[t(this,B)]}, CH${r+1}: ${e.data[1]}`),t(this,B)===0?e.data[1]<48?(t(this,O)[r]>0&&(e.data[1]=this.getChPrimitive(r,1,!1),e.data[1]=120,console.debug(`Forced channel ${r+1} to stay drums.`)),e.data[1]>0&&(console.debug(`Roland GS detected with MSB: ${e.data[1]}`),this.switchMode("gs"))):e.data[1]===56?this.switchMode(t(this,N).x5===82?"x5d":"05rw"):e.data[1]===62?this.switchMode(t(this,N).x5===82?"x5d":"05rw"):e.data[1]===63?this.switchMode(V[t(this,N).ds]):(e.data[1]===64||e.data[1]===127)&&this.switchMode("xg"):t(this,B)===$.gs||t(this,B)===$.sc?e.data[1]<56&&t(this,O)[r]>0&&(e.data[1]=this.getChPrimitive(r,1,!1),e.data[1]=120,console.debug(`Forced channel ${r+1} to stay drums.`)):t(this,B)===$.gm&&(e.data[1]<48?t(this,O)[r]>0&&(e.data[1]=120,this.switchMode("gs",!0),console.debug(`Forced channel ${r+1} to stay drums.`)):(e.data[1]===64||e.data[1]===127)&&this.switchMode("xg",!0)),t(this,B)){case $.xg:{[79,95,126,127].indexOf(e.data[1])>-1?t(this,O)[r]===0&&(this.setChType(r,this.CH_DRUM2),console.debug(`CH${r+1} set to drums by MSB.`)):t(this,O)[r]>0&&(this.setChType(r,this.CH_MELODIC),console.debug(`CH${r+1} set to melodic by MSB.`)),[33,81,97].indexOf(e.data[1])>-1?t(this,ne)[y]=this.EXT_VL:[35,67,83,99].indexOf(e.data[1])>-1?t(this,ne)[y]=this.EXT_DX:t(this,ne)[y]=this.EXT_NONE;break}case $["05rw"]:case $.x5d:case $.ns5r:{[61,62,126,127].indexOf(e.data[1])>-1?t(this,O)[r]===this.CH_MELODIC&&(this.setChType(r,this.CH_DRUM2),console.debug(`CH${r+1} set to drums by MSB.`)):[80,81,82,83].indexOf(e.data[1])>-1||t(this,O)[r]!=this.CH_MELODIC&&(this.setChType(r,this.CH_MELODIC),console.debug(`CH${r+1} set to melodic by MSB.`));break}case $.sd:{[104,105,106,107].indexOf(e.data[1])>-1?t(this,O)[r]===0&&(this.setChType(r,this.CH_DRUM2),console.debug(`CH${r+1} set to drums by MSB.`)):t(this,O)[r]>0&&(this.setChType(r,this.CH_MELODIC),console.debug(`CH${r+1} set to melodic by MSB.`));break}case $.g2:{e.data[1]===120?t(this,O)[r]===0&&(this.setChType(r,this.CH_DRUMS),console.debug(`CH${r+1} set to drums by MSB.`)):t(this,O)[r]>0&&(this.setChType(r,this.CH_MELODIC),console.debug(`CH${r+1} set to melodic by MSB.`));break}}break}case 2:{this.getExt(r)[1]===this.VLBC_BRTHEXPR&&this.setChCc(r,129,e.data[1]);break}case 6:{if(t(this,Ne)[r]){[$.xg,$.gs,$.sc,$.ns5r].indexOf(t(this,B))<0&&console.warn(`NRPN commits are not available under "${V[t(this,B)]}" mode, even when they are supported in Octavia.`);let w=this.getChCc(r,99),x=this.getChCc(r,98);if(w===1){let a=vr.indexOf(x);if(a>-1)this.setChCc(r,71+a,e.data[1]),D()&&console.debug(`Redirected NRPN 1 ${x} to cc${71+a}.`),this.dispatchEvent("cc",{part:r,cc:71+a,data:e.data[1]});else{let s=Rt.indexOf(x);s>-1?t(this,je)[r*10+s]=e.data[1]-64:console.warn(`NRPN 0x01${x.toString(16).padStart(2,"0")} is not supported.`),D()&&console.debug(`CH${r+1} voice NRPN ${x} commit`)}}else{if(vt.indexOf(w)<0){let s=`NRPN 0x${w.toString(16).padStart(2,"0")}${x.toString(16).padStart(2,"0")} `;console.warn(w===127?`${s}is not necessary. Consider removing it.`:`${s}is not supported.`)}else{let s=t(this,O)[r]-2;s<0?console.warn(`CH${r+1} cannot accept drum NRPN as type ${ct[t(this,O)[r]]}.`):t(this,te)[(s*g.dpn+pe[w])*g.dnc+x]=e.data[1]}D()&&console.debug(`CH${r+1} (${ct[t(this,O)[r]]}) drum NRPN ${w} commit`)}}else{let w=Jt[this.getChCc(r,100)],x=jt[this.getChCc(r,100)];if(this.getChCc(r,101)===0&&w!=null)switch(D()&&console.debug(`CH${r+1} RPN 0 ${this.getChCc(r,100)} commit: ${e.data[1]}`),e.data[1]=Math.min(Math.max(e.data[1],Zt[w][0]),Zt[w][1]),t(this,A)[r*g.rpn+w]=e.data[1],t(this,U)[r*g.rpnt+x]=1,k){case $.xg:case $.gs:case $.sc:case $.mt32:case $.s90es:case $.motif:{switch(this.getChCc(r,100)){case 1:case 2:{this.dispatchEvent("pitch",{part:r,pitch:this.getPitchShift(r)});break}}break}default:this.dispatchEvent("pitch",{part:r,pitch:this.getPitchShift(r)})}}break}case 32:{switch(D()&&console.debug(`${V[t(this,B)]}, CH${r+1} LSB: ${e.data[1]}`),t(this,B)){case $.s90es:case $.motif:{this.setChType(r,[32,40].indexOf(e.data[1])>-1?this.CH_DRUMS:this.CH_MELODIC,t(this,B),!0);break}}this.getExt(r)[0],this.EXT_DX;break}case 38:{if(!t(this,Ne)[r]){let w=Jt[this.getChCc(r,100)],x=jt[this.getChCc(r,100)];this.getChCc(r,101)===0&&w!=null&&(t(this,A)[r*g.rpn+w+1]=e.data[1],t(this,U)[r*g.rpnt+x]=1)}break}case 64:{e.data[1]<64&&t(this,Y).hoOf(r);break}case 66:{e.data[1]>>6?t(this,Y).soOn(r):t(this,Y).soOf(r);break}case 98:case 99:{t(this,Ne)[r]=1;break}case 100:case 101:{t(this,Ne)[r]=0;break}}this.setChCc(r,e.data[0],e.data[1]),this.dispatchEvent("cc",{part:r,cc:e.data[0],data:e.data[1]})}h.getChModeId(r)===$.xg&&t(h,O)[r]&&h.setDrumFirstWrite(r)},12:function(e){let r=e.channel,h=this;switch(t(h,B)){case $.s90es:case $.motif:{e.data&&h.setChActive(r,1);break}default:h.setChActive(r,1)}let u=_[r];switch(h.getExt(r)[0]){case h.EXT_VL:break}t(h,L)[r]=e.data,t(h,ge)[r]=0,h.pushChPrimitives(r),D()&&console.debug(`T:${e.track} C:${r} P:${e.data}`),h.dispatchEvent("voice",{part:r}),h.getChModeId(r)===$.xg&&t(h,O)[r]&&h.setDrumFirstWrite(r)},13:function(e){let r=this,h=e.channel;t(this,K).forEach(function(u){let b=u>>7;h===b&&(t(r,q)[u]=e.data,r.dispatchEvent("note",{part:h,note:u&127,velo:e.data,state:r.NOTE_SUSTAIN}))})},14:function(e){let r=e.channel;t(this,Te)[r]=e.data[1]*128+e.data[0]-8192,this.dispatchEvent("pitch",{part:r,pitch:this.getPitchShift(r)})},15:function(e){$r(e.data).forEach(r=>{let h=r[0],u=r[1];(t(this,mt)[h]||function(){console.debug(`Unknown manufacturer ${h}.`)})(u,r.subarray(2),e.track)})},248:function(e){},250:function(e){},251:function(e){},252:function(e){},254:function(e){},255:function(e){(t(this,Z)[e.meta]||function(h,u,b){}).call(this,e.data,e.track,e.meta),e.meta!=32&&S(this,Be,0);let r=yr.indexOf(e.meta)>-1;if(D()&&console.debug(e),r)return e.reply="meta",e}});T(this,mt,{64:(e,r,h)=>{t(this,ze).run(r,h,e)},65:(e,r,h)=>{if(r[0]<16)if(r[1]===72){let u=r[r.length-1],b=Re(r.subarray(3,r.length-1));u===b?t(this,de).run(r.subarray(0,r.length-1),h,e):console.warn(`Bad SD checksum ${u} - should be ${b}.`)}else t(this,de).run(r,h,e);else{let u=r[r.length-1],b=Re(r.subarray(2,r.length-1));u===b?t(this,de).run(r.subarray(0,r.length-1),h,e):console.warn(`Bad GS checksum ${u} - should be ${b}.`)}},66:(e,r,h)=>{t(this,we).run(r,h,e)},67:(e,r,h)=>{t(this,le).run(r,h,e)},68:(e,r,h)=>{t(this,qe).run(r,h,e)},71:(e,r,h)=>{t(this,We).run(r,h,e)},126:(e,r,h)=>{t(this,Ve).run(r,h,e)},127:(e,r,h)=>{this.switchMode("gm"),t(this,Fe).run(r,h,e)}});T(this,Ve,void 0);T(this,Fe,void 0);T(this,le,void 0);T(this,de,void 0);T(this,we,void 0);T(this,ze,void 0);T(this,We,void 0);T(this,qe,void 0);let e=this;S(e,he,new Uint8Array(256),ir),t(e,Se)[10]=new Uint8Array(512),S(e,Ke,new fe),S(e,N,{x5:82,ds:$.krs,smotif:$.s90es,gs:4,sc:3}),S(e,Ce,{dumpLimit:e.DUMP_MODE}),S(e,dt,new Proxy(t(e,Ce),{set:()=>{}}));for(let a in Yt){let s=$[a];s===void 0?console.debug(`SubDB build error: "${a}" does not exist`):t(e,z)[s]=new Uint8Array(Yt[a])}e.userBank.strictMode=!0,e.userBank.load(`MSB	PRG	LSB	NME
062	000	000	
122	000	000	
122	001	000	
122	002	000	
122	003	000	
122	004	000	
122	005	000	
122	006	000	`),e.addEventListener("metacommit",function(a){var f,i;let{data:s}=a;((f=t(e,oe)[0])==null?void 0:f.type)===s.type&&((i=t(e,oe)[0])!=null&&i.amend)?(t(e,oe)[0].amend=s.amend,t(e,oe)[0].data+=s.data):t(e,oe).unshift(s)}),t(e,Z)[1]=function(a){var s,f,i,n,o;switch(a=a.replaceAll(`\r
`,`
`).replaceAll("\r",`
`),a.slice(0,2)){case"@I":{S(e,I,e.KARAOKE_TEXT),e.dispatchEvent("metacommit",{type:"Kar.Info",data:(s=a.slice(2))==null?void 0:s.trimLeft()});break}case"@K":{S(e,I,e.KARAOKE_TEXT),e.dispatchEvent("metacommit",{type:"Kar.Mode",data:(f=a.slice(2))==null?void 0:f.trimLeft()}),console.debug(`Karaoke mode active: ${a.slice(2)}`);break}case"@L":{S(e,I,e.KARAOKE_TEXT),e.dispatchEvent("metacommit",{type:"Kar.Lang",data:(i=a.slice(2))==null?void 0:i.trimLeft()});break}case"@T":{S(e,I,e.KARAOKE_TEXT),e.dispatchEvent("metacommit",{type:"KarTitle",data:(n=a.slice(2))==null?void 0:n.trimLeft()});break}case"@V":{S(e,I,e.KARAOKE_TEXT),e.dispatchEvent("metacommit",{type:"Kar.Ver.",data:(o=a.slice(2))==null?void 0:o.trimLeft()});break}case"XF":{let c=a.slice(2).split(":");switch(c[0]){case"hd":{c.slice(1).forEach((d,l)=>{d.length&&e.dispatchEvent("metacommit",{type:["XfSngDte","XfSngRgn","XfSngCat","XfSongBt","XfSngIns","XfSngVoc","XfSngCmp","XfSngLrc","XfSngArr","XfSngPer","XfSngPrg","XfSngTag"][l],data:d})});break}case"ln":{c.slice(1).forEach((d,l)=>{d.length&&e.dispatchEvent("metacommit",{type:["XfKarLng","XfKarNme","XfKarCmp","XfKarLrc","XfKarArr","XfKarPer","XfKarPrg"][l],data:d})});break}default:e.dispatchEvent("metacommit",{type:"XfUnData",data:a})}break}default:switch(t(e,I)){case e.KARAOKE_TEXT:{switch(a[0]){case"\\":{e.dispatchEvent("metacommit",{type:"KarLyric",data:"",amend:!1}),e.dispatchEvent("metacommit",{type:"KarLyric",data:a.slice(1),amend:!0});break}case"/":{e.dispatchEvent("metacommit",{type:"KarLyric",data:"",mask:!0,amend:!1}),e.dispatchEvent("metacommit",{type:"KarLyric",data:a.slice(1),mask:!0,amend:!0});break}default:e.dispatchEvent("metacommit",{type:"KarLyric",data:a,amend:!0})}break}default:a.split(`
`).forEach((c,d)=>{e.dispatchEvent("metacommit",{type:"Cmn.Text",data:c,mask:d!=0})})}}},t(e,Z)[2]=function(a){e.dispatchEvent("metacommit",{type:"Copyrite",data:a})},t(e,Z)[3]=function(a,s){s<1&&t(e,Be)<1&&e.dispatchEvent("metacommit",{type:"TrkTitle",data:a})},t(e,Z)[4]=function(a,s){e.dispatchEvent("metacommit",{type:"Instrmnt",data:a})};let r=!1;t(e,Z)[5]=function(a){switch(t(e,I)){case e.KARAOKE_XF:{let s="";for(let f of a)switch(f){case"^":{s+=" ";break}case">":break;case"<":{e.dispatchEvent("metacommit",{type:"KarLyric",data:s,mask:r,amend:!1}),s="",r=!1;break}case"/":case"%":{e.dispatchEvent("metacommit",{type:"KarLyric",data:s,mask:!1,amend:!0}),e.dispatchEvent("metacommit",{type:"KarLyric",data:"",mask:!0,amend:!1}),s="",r=!0;break}default:s+=f}s.length>0&&(e.dispatchEvent("metacommit",{type:"KarLyric",data:s,mask:r,amend:!0}),r=!1);break}default:{a.trim()===""?e.dispatchEvent("metacommit",{type:"C.Lyrics",data:"",amend:!1}):e.dispatchEvent("metacommit",{type:"C.Lyrics",data:a,amend:!0});break}}},t(e,Z)[6]=function(a){e.dispatchEvent("metacommit",{type:"C.Marker",data:a})},t(e,Z)[7]=function(a){switch(a[0]){case"$":{if(a.substring(1,5)==="Lyrc"){S(e,I,e.KARAOKE_XF);let s=a.substring(6).split(":"),f=s[0].replaceAll(" ","").split(",");f.forEach((n,o,c)=>{c[o]=parseInt(n)-1});let i=Vt[s[2].substring(0,2).toLowerCase()];e.dispatchEvent("metacommit",{type:"XfMeloCh",data:`CH${s[0].replaceAll(" ","").split(",").join(", CH")}`,parsed:f}),e.dispatchEvent("metacommit",{type:"XfLyrOff",data:s[1],parsed:parseInt(s[1])}),e.dispatchEvent("metacommit",{type:"XfLyrEnc",data:i[1],parsed:i[0]}),r=!1}else e.dispatchEvent("metacommit",{type:"CuePoint",data:a});break}case"#":{e.dispatchEvent("metacommit",{type:"XfScneNo",data:a.substring(1)});break}case"&":{a.length===2?(e.dispatchEvent("metacommit",{type:"XfSngPrt",data:Ft[a[1]]||`Unknown "${a[1]}"`}),r=!1):e.dispatchEvent("metacommit",{type:"CuePoint",data:a});break}default:e.dispatchEvent("metacommit",{type:"CuePoint",data:a})}},t(e,Z)[32]=function(a){S(e,Be,a[0]+1)},t(e,Z)[33]=function(a,s){D()&&console.debug(`Track ${s} requests to get assigned to output ${a}.`),t(e,Le)[s]=a+1},t(e,Z)[81]=function(a,s){S(e,rt,a/1e3)},t(e,Z)[127]=function(a,s){t(e,Ke).run(a,s)},t(e,Ke).default=function(a){console.warn(`Unrecognized sequencer-specific byte sequence: ${a}`)},t(e,Ke).add([67,0,1],function(a,s){D()&&console.debug(`XGworks requests assigning track ${s} to output ${a[0]}.`),t(e,Le)[s]=a[0]+1}),S(e,Ve,new fe("universal non-realtime")),S(e,Fe,new fe("universal realtime")),S(e,le,new fe("Yamaha")),S(e,de,new fe("Roland")),S(e,we,new fe("Korg")),S(e,ze,new fe("Kawai")),S(e,We,new fe("Akai")),S(e,qe,new fe("Casio"));let h=new fe("DX7+ Dump"),u=function(a){console.info(`Unrecognized SysEx in "${this.name}" set.
%o`,a)};t(e,Ve).default=u,t(e,Fe).default=u,t(e,le).default=u,t(e,de).default=u,t(e,we).default=u,t(e,ze).default=u,t(e,We).default=u,t(e,qe).default=u,h.default=u,t(e,Ve).add([9],(a,s,f)=>{e.switchMode(["gm","?","g2"][a[0]-1],!0),e.setPortMode(e.getTrackPort(s),1,$[["gm","?","g2"][a[0]-1]]),S(e,I,t(e,I)||e.KARAOKE_NONE),console.info(`MIDI reset: ${["GM","Init","GM2"][a[0]-1]}`),a[0]===2&&e.init()}),t(e,Fe).add([4,1],(a,s,f)=>{e.dispatchEvent("mupromptex"),S(e,G,((a[1]<<7)+a[0])/16383*100),e.dispatchEvent("mastervolume",t(e,G))}).add([4,3],(a,s,f)=>((a[1]<<7)+a[0]-8192)/8192).add([4,4],(a,s,f)=>a[1]-64).add([4,5],(a,s,f)=>{e.dispatchEvent("mupromptex");let i=a[0],n=a[1],o=a[2],c=3,d=c+(i<<1),l=d+n;if(i!=1){console.error(`Unsupported GM2 global parameter set: slotpath length too long (${i})!
`,a);return}let E=0,C=0,M=0;switch(a.subarray(c,d).forEach(R=>{E=E<<7,E|=R}),a.subarray(d,l).forEach((R,re)=>{C|=R<<re*7}),a.subarray(l).forEach((R,re)=>{M|=R<<re*7}),D()&&console.debug(`GM2 global parameter: (${a.subarray(3,d)}; p: ${C}, v: ${M})`),E){case 129:{C===0&&(e.setEffectType(0,52,M),e.dispatchEvent("efxreverb",e.getEffectType(0)));break}case 130:{C===0&&(e.setEffectType(1,52,M|16),e.dispatchEvent("efxchorus",e.getEffectType(1)));break}default:D()&&console.debug("GM2 global paramater slot path unknown.")}}),t(this,le).add([76,0,0],(a,s,f)=>{switch(a[0]){case 125:{e.initDrums(),console.info(`XG drum setup reset on drum kit ${a[1]}.`);break}case 126:{e.switchMode("xg",!0),e.setPortMode(e.getTrackPort(s),4,$.xg),S(e,I,t(e,I)||e.KARAOKE_NONE),console.info("MIDI reset: XG");break}default:{e.dispatchEvent("mupromptex");let i=[0,0,0,0],n=(o,c)=>{i[c]=o};if(a.subarray(1).forEach((o,c)=>{let d=c+a[0];([n,n,n,n,l=>{S(this,G,l*129/16383*100),e.dispatchEvent("mastervolume",t(e,G))},l=>{},l=>{}][d]||(()=>{}))(o,c)}),a[0]<4){let o=0;i.forEach(c=>{o=o<<4,o+=c}),o-=1024}}}}).add([76,2,1],(a,s,f)=>{e.dispatchEvent("mupromptex");let i="XG ";a[0]<32?(i+="reverb ",a.subarray(1).forEach((n,o)=>{([c=>{e.setEffectTypeRaw(0,!1,c),console.info(`${i}main type: ${nt[c]}`),e.dispatchEvent("efxreverb",e.getEffectType(0))},c=>{e.setEffectTypeRaw(0,!0,c),console.debug(`${i}sub type: ${c+1}`),e.dispatchEvent("efxreverb",e.getEffectType(0))},c=>{console.debug(`${i}time: ${It(c)}s`)},c=>{console.debug(`${i}diffusion: ${c}`)},c=>{console.debug(`${i}initial delay: ${c}`)},c=>{console.debug(`${i}HPF cutoff: ${Qe[c]}Hz`)},c=>{console.debug(`${i}LPF cutoff: ${Qe[c]}Hz`)},c=>{console.debug(`${i}width: ${c}`)},c=>{console.debug(`${i}height: ${c}`)},c=>{console.debug(`${i}depth: ${c}`)},c=>{console.debug(`${i}wall type: ${c}`)},c=>{console.debug(`${i}dry/wet: ${c}`)},c=>{console.debug(`${i}send: ${se(c)}dB`)},c=>{console.debug(`${i}pan: ${c-64}`)},!1,!1,c=>{console.debug(`${i}delay: ${c}`)},c=>{console.debug(`${i}density: ${c}`)},c=>{console.debug(`${i}balance: ${c}`)},c=>{},c=>{console.debug(`${i}feedback: ${c}`)},c=>{}][a[0]+o]||function(){console.warn(`Unknown XG reverb address: ${a[0]}.`)})(n)})):a[0]<64?(i+="chorus ",a.subarray(1).forEach((n,o)=>{([c=>{e.setEffectTypeRaw(1,!1,c),console.info(`${i}main type: ${nt[c]}`),e.dispatchEvent("efxchorus",e.getEffectType(1))},c=>{e.setEffectTypeRaw(1,!0,c),console.debug(`${i}sub type: ${c+1}`),e.dispatchEvent("efxchorus",e.getEffectType(1))},c=>{console.debug(`${i}LFO: ${Bt[c]}Hz`)},c=>{},c=>{console.debug(`${i}feedback: ${c}`)},c=>{console.debug(`${i}delay offset: ${Ht(c)}ms`)},c=>{},c=>{console.debug(`${i}low: ${Qe[c]}Hz`)},c=>{console.debug(`${i}low: ${c-64}dB`)},c=>{console.debug(`${i}high: ${Qe[c]}Hz`)},c=>{console.debug(`${i}high: ${c-64}dB`)},c=>{console.debug(`${i}dry/wet: ${c}`)},c=>{console.debug(`${i}send: ${se(c)}dB`)},c=>{console.debug(`${i}pan: ${c-64}`)},c=>{console.debug(`${i}to reverb: ${se(c)}dB`)},!1,c=>{},c=>{},c=>{},c=>{console.debug(`${i}LFO phase diff: ${(c-64)*3}deg`)},c=>{console.debug(`${i}input mode: ${c?"stereo":"mono"}`)},c=>{}][a[0]-32+o]||function(){console.warn(`Unknown XG chorus address: ${a[0]}.`)})(n)})):a[0]<86?(i+="variation ",a.subarray(1).forEach((n,o)=>{([c=>{e.setEffectTypeRaw(2,!1,c),console.info(`${i}main type: ${nt[c]}`),e.dispatchEvent("efxdelay",e.getEffectType(2))},c=>{e.setEffectTypeRaw(2,!0,c),console.debug(`${i}sub type: ${c+1}`),e.dispatchEvent("efxdelay",e.getEffectType(2))}][a[0]-64+o]||function(){})(n)})):a[0]<97?(i+="variation ",a.subarray(1).forEach((n,o)=>{[c=>{console.debug(`${i}send: ${se(c)}dB`)},c=>{console.debug(`${i}pan: ${c-64}`)},c=>{console.debug(`${i}to reverb: ${se(c)}dB`)},c=>{console.debug(`${i}to chorus: ${se(c)}dB`)},c=>{console.debug(`${i}connection: ${c?"system":"insertion"}`)},c=>{console.debug(`${i}channel: CH${c+1}`)},c=>{console.debug(`${i}mod wheel: ${c-64}`)},c=>{console.debug(`${i}bend wheel: ${c-64}`)},c=>{console.debug(`${i}channel after touch: ${c-64}`)},c=>{console.debug(`${i}AC1: ${c-64}`)},c=>{console.debug(`${i}AC2: ${c-64}`)}][a[0]-86+o](n)})):a[0]>111&&a[0]<118?i+="variation ":console.warn(`Unknown XG variation address: ${a[0]}`)}).add([76,2,64],(a,s,f)=>{a.subarray(1).forEach((i,n)=>{let o=n+a[0];if(o===0)console.debug(`XG EQ preset: ${["flat","jazz","pop","rock","classic"][i]}`);else{let c=o-1>>2,d=o-1&3,l=`XG EQ ${c} ${["gain","freq","Q","shape"][d]}: `;[()=>{console.debug(`${l}${i-64}dB`)},()=>{console.debug(`${l}${i} (raw)`)},()=>{console.debug(`${l}${i/10}`)},()=>{console.debug(`${l}${["shelf","peak"][+!!i]}`)}][d]()}})}).add([76,3],(a,s,f)=>{e.dispatchEvent("mupromptex");let i=a[0],n=a[1],o=`XG Insertion ${a[0]+1} `;a.subarray(2).forEach((c,d)=>{([l=>{e.setEffectTypeRaw(3+i,!1,l),console.info(`${o}main type: ${nt[l]}`),e.dispatchEvent(`efxinsert${i}`,e.getEffectType(3+i))},l=>{e.setEffectTypeRaw(3+i,!0,l),console.debug(`${o}sub type: ${l+1}`),e.dispatchEvent(`efxinsert${i}`,e.getEffectType(3+i))}][n+d]||function(){})(c)})}).add([76,6,0],(a,s,f)=>{let i=a[0];i<64?e.setLetterDisplay(a.subarray(1),"XG letter display",i):S(e,De,Date.now())}).add([76,7,0],(a,s,f)=>{let i=a[0];S(e,J,0),S(e,be,Date.now()+3200),t(e,he,xe).fill(0);let n=a.subarray(1);for(let o=0;o<i;o++)n.unshift(0);n.forEach(function(o,c){let d=Math.floor(c/16),l=c%16,E=(l*3+d)*7,C=7,M=0;for(E-=l*5,d===2&&(C=2);M<C;)t(e,he,xe)[E+M]=o>>6-M&1,M++})}).add([76,8],(a,s)=>{e.dispatchEvent("mupromptex");let f=e.chRedir(a[0],s,!0),i=a[1],n=_[f],o=`XG CH${f+1} `,c=`Unknown XG part address ${i}.`,d=!0;a.subarray(2).forEach((l,E)=>{d=!0,i<1?console.debug(c):i<41?([()=>{e.setChCc(f,0,l),e.pushChPrimitives(f),e.dispatchEvent("voice",{part:f})},()=>{e.setChCc(f,32,l),e.pushChPrimitives(f),e.dispatchEvent("voice",{part:f})},()=>{t(e,L)[f]=l,e.dispatchEvent("voice",{part:f})},()=>{d=!1;let C=e.chRedir(l,s,!0);t(e,W)[f]=C,f!=C&&(e.buildRchTree(),console.info(`${o}receives from CH${C+1}`)),t(e,ie)[f]||(e.copyChSetup(C,f,!0),console.debug(`${o}copied from CH${C+1}.`),e.setChActive(f,1),e.dispatchEvent("voice",{part:f}))},()=>{t(e,ee)[f]=+!l},()=>{},()=>{d=!1,e.setChType(f,l,$.xg),console.debug(`${o}type: ${ct[l]||l}`),e.dispatchEvent("voice",{part:f})},()=>{t(e,A)[g.rpn*f+3]=l,t(e,U)[g.rpnt*f+2]=1,e.dispatchEvent("pitch",{part:f,pitch:e.getPitchShift(f)})},!1,!1,()=>{e.setChCc(f,7,l)},!1,!1,()=>{e.setChCc(f,10,l||128)},!1,!1,()=>{e.setChCc(f,128,l),e.allocateAce(f,128)},()=>{e.setChCc(f,93,l)},()=>{e.setChCc(f,91,l)},()=>{e.setChCc(f,94,l)},()=>{e.setChCc(f,76,l)},()=>{e.setChCc(f,77,l)},()=>{e.setChCc(f,78,l)},()=>{e.setChCc(f,74,l)},()=>{e.setChCc(f,71,l)},()=>{e.setChCc(f,73,l)},()=>{e.setChCc(f,75,l)},()=>{e.setChCc(f,72,l)}][i+E-1]||(()=>{}))():i<48?console.debug(c):i<111?i>102&&i<105&&e.setChCc(f,[5,65][i&1],l):i<114?console.debug(c):i<116?console.debug(`${o}EQ ${["bass","treble"][i&1]} gain: ${l-64}dB`):i<118?console.debug(c):i<120?console.debug(`${o}EQ ${["bass","treble"][i&1]} freq: ${l}`):console.debug(c)}),d&&t(e,O)[f]>1&&e.setDrumFirstWrite(f)}).add([76,9],(a,s)=>{let f=e.chRedir(a[0],s,!0),i=a[1],n=_[f],o=`PLG-VL CH${f+1} `;a.subarray(2).forEach((c,d)=>{let l=d+i;switch(l){case 1:{console.info(`${o}breath mode: ${["system","breath","velocity","touch EG"][c]}`);break}case 0:case 27:case 28:break;default:if(l<27){let E=l-3>>1,C=["pressure","embouchure","tonguing","scream","breath noise","growl","throat formant","harmonic enhancer","damping","absorption","amplification","brightness"][E];l&1?l<23?(console.debug(`${o}${C} control source: ${Kt(c)}`),c&&c<96&&e.allocateAce(f,130+E),t(e,Ue)[g.redir*f+E+2]=c,e.buildRccMap()):console.debug(`${o}${C} scale break point: ${c}`):(console.debug(`${o}${C} depth: ${c-64}`),e.setChCc(f,130+E,c))}}})}).add([76,10],(a,s,f)=>{}).add([76,16],(a,s,f)=>{}).add([76,17,0,0],(a,s,f)=>{}).add([76,112],(a,s,f)=>{switch(console.debug(`XG enable PLG-${["VL","SG","DX","AN","PF","DR","PC","AP"][a[0]]} for CH${a[2]+1}.`),a[0]){case 0:{t(e,ne)[g.ext*a[2]]=e.EXT_VL;break}case 2:{t(e,ne)[g.ext*a[2]]=e.EXT_DX;break}default:t(e,ne)[g.ext*a[2]]=e.EXT_NONE}}).add([73,0,0],(a,s)=>{let f=a[0],i="MU1000 System - ";a.subarray(1).forEach((n,o)=>{let c=f+o;c===8?console.debug(`${i}LCD contrast: ${n}.`):c===18?(t(e,z)[$.xg][1]=n?126:0,console.debug(`${i}default bank: ${n?"MU100 Native":"MU Basic"}.`),e.dispatchEvent("banklevel",{mode:"xg",data:+!!n}),e.forceVoiceRefresh()):c>=64&&c<69&&[()=>{e.dispatchEvent("channelactive",n)},()=>{n<8?(e.dispatchEvent("channelmin",n<<4),console.debug(`Octavia System: Minimum CH${(n<<4)+1}`)):(e.dispatchEvent("channelreset"),console.info("Octavia System: Clear channel ranges"))},()=>{n<8?(e.dispatchEvent("channelmax",(n<<4)+15),console.debug(`Octavia System: Maximum CH${(n<<4)+16}`)):(e.dispatchEvent("channelreset"),console.info("Octavia System: Clear channel ranges"))},()=>{e.dispatchEvent("channelreset"),console.info("Octavia System: Clear channel ranges")},()=>{S(e,$e,!!n),console.info(`Octavia System: RS receiving ${["dis","en"][n]}abled.`)}][c-64]()})}).add([73,10,0],(a,s)=>{let f=a[0],i=`MU1000 RS${t(e,$e)?"":" (ignored)"}: `;if(f<16)switch(f){case 2:{let n=e.chRedir(0,s,!0);t(e,$e)&&(e.dispatchEvent("portrange",4),e.dispatchEvent("portstart",n)),console.info(`${i}Show CH${n+1}~CH${n+64}`);break}case 3:{let n=e.chRedir(a[1]<<5,s,!0);t(e,$e)&&(e.dispatchEvent("portrange",2),e.dispatchEvent("portstart",n)),console.info(`${i}Show CH${n+1}~CH${n+32}`);break}default:console.debug(`${i}unknown switch ${f} invoked.`)}else if(f<32){if(t(e,$e)){let n=e.chRedir(f-16+(t(e,at)<<4),s,!0);e.dispatchEvent("channelactive",n)}}else if(f<36){let n=e.chRedir(f-32<<4,s,!0);t(e,$e)&&(e.dispatchEvent("portrange",1),e.dispatchEvent("portstart",n>>4),S(e,at,f-32)),console.info(`${i}Show CH${n+1}~CH${n+16}`)}}).add([73,11,0],(a,s)=>{let f="MU1000 System - channel ",i="Octavia System - channel ",n=a[0];a.subarray(1).forEach((o,c)=>{let d=n+c;([()=>{e.setChActive(o,1),e.dispatchEvent("channelactive",o),D()&&console.debug(`${f}current part: CH${o+1}`)},()=>{o<5?(e.dispatchEvent("portrange",1<<o),console.debug(`${f}port range: ${1<<o} port(s)`)):(e.dispatchEvent("portrange",0),console.debug(`${f}port range: reset`))},()=>{o<16?(e.dispatchEvent("portstart",o),console.debug(`${i}start port: ${"ABCDEFGHIJKLMNOP"[o]}`)):(e.dispatchEvent("portstart",255),console.debug(`${i}start port: reset`))}][d]||(()=>{console.debug(`${f}unknown address: ${d}`)}))()})}).add([93,3],(a,s)=>{let f=e.chRedir(a[0],s,!0),i=`PLG-SG CH${f+1} `,n=Date.now();if(a[1]===0){let o="",c=0;a.subarray(2).forEach((d,l)=>{l%2===0?o+=Gt[d]||d.toString().padStart("0"):c+=d*13}),(n>=t(e,Ie)||t(e,He)>=t(e,gt))&&(e.dispatchEvent("metacommit",{type:"SGLyrics",data:"",amend:!1}),S(e,Ge,n<t(e,Ie)),S(e,He,0)),e.dispatchEvent("metacommit",{type:"SGLyrics",data:`${Xt(o)}`,amend:!0,mask:t(e,Ge)}),Ot(e,He)._++,S(e,Ge,!1),S(e,Ie,n+Math.ceil(c/2)+t(e,rt)),D()&&console.debug(`${i}vocals: ${o}`)}else console.warn(`Unknown PLG-SG data: ${a}`)}).add([98,0],(a,s,f)=>{e.dispatchEvent("mupromptex");let i=a[0],n=a.length-5,o=a.length-1;if(i!=n){console.info(`PLG-DX native dump size mismatch! Gave ${i} instead of ${a.length-5}.`);return}let c=Re(a.subarray(4,o));if(c!=a[o]){console.info(`Bad PLG-DX checksum ${a[o]} - should be ${c}.`);return}a[0]=98,t(e,le).run(a.subarray(0,o),s,f,{noAce:!0})}).add([98,96],(a,s,f,i)=>{let n=e.chRedir(a[0],s,!0),o=_[n],c=a[1];a.subarray(2).forEach((d,l)=>{let E=c+l;if(!(E<10)){if(E===10)e.resetAce();else if(E<27){let C=E+131;i!=null&&i.noAce||e.allocateAce(n,C),e.setChCc(n,C,d),e.dispatchEvent("cc",{part:n,cc:C,data:d})}}})}).add([100,0],(a,s,f)=>{let i=a.subarray(0,a.length-1);if(a[0]+5!=a.length){console.warn(`Yamaha DX7+ dump SysEx size mismatch! Expected ${a.length}, but got ${a[0]}:
`,a);return}let n=Re(i),o=a[a.length-1];if(n!=o){console.warn(`Yamaha DX7+ dump SysEx checksum mismatch! Expected ${n}, but got ${o}:
`,a);return}h.run(i.subarray(1))}).add([100,76],(a,s,f)=>{let i=a[0]>>4,n=a[0]&15,o=a[1];switch(i){case 2:{let c=e.chRedir(n,s,!0),d=_[c];a.subarray(2).forEach((l,E)=>{let C=E+o;if(!(C<7)){if(C<23){let M=C+135;e.allocateAce(c,M),e.setChCc(c,M,l),e.dispatchEvent("cc",{part:c,cc:M,data:l})}}});break}default:console.info("Unknown DX7+ multipart: %o",a)}}).add([1,20],(a,s,f)=>{f===115?(e.switchMode("doc",!0),e.setPortMode(e.getTrackPort(s),1,$.doc),console.info("MIDI reset: DOC")):console.debug(`Unknown Yamaha SysEx: 67, ${f}, ${a.join(", ")}`)}).add([1,17,15,89],(a,s,f)=>{f===115?(e.setEffectType(0,24,a[0]|16),e.dispatchEvent("efxreverb",e.getEffectType(0))):console.debug(`Unknown Yamaha SysEx: 67, ${f}, ${a.join(", ")}`)}).add([1,24],(a,s,f)=>{if(f===115){for(let i=0;i<16;i++){let n=e.chRedir(i,s,!0);e.setChCc(n,91,127)}console.info("DOC Global Reverb: on")}else console.debug(`Unknown Yamaha SysEx: 67, ${f}, ${a.join(", ")}`)}),h.add([14,31],(a,s,f)=>{e.setChCc(a[0],64,0),t(e,Y).ano(a[0]),e.switchMode("xg"),e.setPortMode(e.getTrackPort(s),1,$.xg),e.resetAce(),console.debug(`Yamaha DX7+ reset CH${a[0]+1}.`)}).add([76,112],async a=>{let s=a[0],f=_[s],i=sr[s],n=g.cvn*s;t(e,ne)[i]=e.EXT_DX,t(e,ge)[s]=1;let o=t(e,ht).subarray(n,n+g.cvn);o.fill(32),a.subarray(1).forEach((c,d)=>{if(d<10)o[d]=Math.max(c,32);else if(!(d<40)){if(d<56){let l=d+102;e.setChCc(s,l,c),e.dispatchEvent("cc",{part:s,cc:l,data:c})}}}),t(e,L)[s]=s&127,e.setChCc(s,0,35),e.setChCc(s,32,s>>7|4),e.pushChPrimitives(s),e.dispatchEvent("voice",{part:s}),console.debug(`DX7+ CH${s+1} dump: %o`,a)});let b=function(a,s,f,i){},y=function(a,s){e.dispatchEvent("mupromptex");let f=a*g.dpn,i=s[0],n=s[1];s.subarray(2).forEach((o,c)=>{let d=c+n,l=-1;d<16?([()=>{l=24},()=>{l=25},()=>{l=26},()=>{},()=>{l=28},()=>{l=29},()=>{l=30},()=>{l=31},()=>{},()=>{},()=>{},()=>{l=20},()=>{l=21},()=>{l=22},()=>{l=23},()=>{}][d]||(()=>{console.debug(`Unknown XG-style drum param ${d} on set ${a+1}.`)}))():d<32||(d<40?([()=>{l=48},()=>{l=49},!1,!1,()=>{l=52},()=>{l=53}][d-32]||(()=>{console.debug(`Unknown XG-style drum param ${d} on set ${a+1}.`)}))():d<80||([()=>{l=36}][d-80]||(()=>{console.debug(`Unknown XG-style drum param ${d} on set ${a+1}.`)}))()),l>=0?(D()&&console.debug(f,l,i,o),t(e,te)[(f+pe[l])*g.dnc+i]=o):D()&&console.debug(`XG-style drum param ${d} has no writes.`)})},k=function(a,s,f){e.dispatchEvent("mupromptex");let i=a*g.dpn,n=(s<<7)+f[0];f.subarray(1).forEach((o,c)=>{let d=c+n,l=d&127,E=d>>7,C=-1;E>1&&([()=>{C=26},()=>{},()=>{C=28},()=>{C=29},()=>{C=30},()=>{},()=>{},()=>{C=31}][E-2]||(()=>{console.debug(`Unknown GS-style drum param ${E} on set ${a+1}.`)}))(),C>-1?(D()&&console.debug(i,C,l,o),t(e,te)[(i+pe[C])*g.dnc+l]=o):D()&&console.debug(`GS-style drum param ${E} has no writes.`)})};t(this,le).add([76,48],(a,s,f)=>{y(0,a)}).add([76,49],(a,s,f)=>{y(1,a)}).add([76,50],(a,s,f)=>{y(2,a)}).add([76,51],(a,s,f)=>{y(3,a)}).add([76,52],(a,s,f)=>{y(4,a)}).add([76,53],(a,s,f)=>{y(5,a)}).add([76,54],(a,s,f)=>{y(6,a)}).add([76,55],(a,s,f)=>{y(7,a)}),t(this,le).add([89,0],(a,s,f)=>{if(e.eprom){let i=a[0],n=(a[1]<<14)+(a[2]<<7)+a[3]+(e.eprom.offset||0);D()&&console.debug(`MU1000 EPROM trail to 0x${n.toString(16).padStart(6,"0")}, ${i} bytes.`);let o=e.eprom.data;a.subarray(4).forEach((c,d)=>{let l=d>>3,E=d&7;if(E===7)for(let C=0;C<7;C++)o[n+7*l+C]+=(c>>6-C&1)<<7;else o[n+7*l+E]=c})}}).add([89,1],(a,s,f)=>{let i=(a[0]<<21)+(a[1]<<14)+(a[2]<<7)+a[3];D()&&console.debug(`MU1000 EPROM jump to 0x${i.toString(16).padStart(6,"0")}.`),e.eprom&&(e.eprom.offset=i)}).add([89,2],(a,s,f)=>{if(e.eprom){let i=(a[0]<<21)+(a[1]<<14)+(a[2]<<7)+a[3]+(e.eprom.offset||0);D()&&console.debug(`MU1000 EPROM write to 0x${i.toString(16).padStart(6,"0")}.`);let n=e.eprom.data;a.subarray(4).forEach((o,c)=>{let d=c>>3,l=c&7;if(l===7)for(let E=0;E<7;E++)n[i+7*d+E]+=(o>>6-E&1)<<7;else n[i+7*d+l]=o})}}).add([89,3],(a,s,f)=>{}),t(this,le).add([39,48],(a,s,f)=>{}).add([43,0,0],(a,s,f)=>{e.dispatchEvent("mupromptex");let i=[0,0,0,0],n=(o,c)=>{i[c]=o};if(a.subarray(1).forEach((o,c)=>{let d=c+a[0];[n,n,n,n,()=>{S(this,G,o*129/16383*100),e.dispatchEvent("mastervolume",t(e,G))},()=>o-64,()=>o||128,()=>o,()=>o,()=>{console.debug(`TG300 variation on cc${o}.`)}][d](o,d)}),a[0]<4){let o=0;i.forEach(c=>{o=o<<4,o+=c}),o-=1024}}).add([43,1,0],(a,s,f)=>{e.dispatchEvent("mupromptex")}).add([43,2],(a,s,f)=>{e.dispatchEvent("mupromptex");let i=e.chRedir(a[0],s,!0),n=a[1],o=_[i],c=`TG300 CH${i+1} `;a.subarray(2).forEach((d,l)=>{l<5?([()=>{},()=>{e.setChCc(i,0,d),e.pushChPrimitives(i),e.dispatchEvent("voice",{part:i})},()=>{e.setChCc(i,32,d),e.pushChPrimitives(i),e.dispatchEvent("voice",{part:i})},()=>{t(e,L)[i]=d,e.dispatchEvent("voice",{part:i})},()=>{let E=e.chRedir(d,s,!0);t(e,W)[i]=E,i!=E&&(e.buildRchTree(),console.info(`${c}receives from CH${E+1}`))}][l+n]||(()=>{}))(d,l+n):l<21||(l<47?([()=>{t(e,ee)[i]=+!d},()=>{},()=>{},()=>{t(e,A)[g.rpn*i+3]=d,t(e,U)[g.rpnt*i+2]=1,e.dispatchEvent("pitch",{part:i,pitch:e.getPitchShift(i)})},()=>{},()=>{e.setChCc(i,7,d)},!1,!1,()=>{e.setChCc(i,10,d||128)},!1,!1,()=>{console.debug(`${c} AC1 at cc${d}`)},()=>{console.debug(`${c} AC2 at cc${d}`)},()=>{t(e,m)[o+v[128]]=d,e.allocateAce(i,128)},()=>{t(e,m)[o+v[93]]=d},()=>{t(e,m)[o+v[91]]=d},()=>{t(e,m)[o+v[94]]=d},()=>{t(e,m)[o+v[76]]=d},()=>{t(e,m)[o+v[77]]=d},()=>{t(e,m)[o+v[74]]=d},()=>{t(e,m)[o+v[71]]=d},()=>{t(e,m)[o+v[73]]=d},()=>{t(e,m)[o+v[75]]=d},()=>{t(e,m)[o+v[72]]=d},()=>{t(e,m)[o+v[78]]=d}][l+n-21]||(()=>{}))(d,l+n):l<95||([()=>{t(e,m)[o+v[65]]=d},()=>{t(e,m)[o+v[5]]=d}][l+n-95]||(()=>{}))(d,l+n))})}).add([43,7,0],(a,s,f)=>{let i=a[0];e.setLetterDisplay(a.subarray(1),"TG300 letter display",i)}).add([43,7,1],(a,s,f)=>{S(e,J,0),S(e,be,Date.now()+3200),t(e,he,xe).fill(0),a.forEach(function(i,n){let o=Math.floor(n/16),c=n%16,d=(c*3+o)*7,l=7,E=0;for(d-=c*5,o===2&&(l=2);E<l;)t(e,he,xe)[d+E]=i>>6-E&1,E++})}),t(this,de).add([66,18,0,0,127],(a,s,f)=>{e.switchMode("sc",!0),e.setPortMode(e.getTrackPort(s),2,$.sc),t(e,z)[$.sc][1]=t(e,N).sc,S(e,I,e.KARAOKE_NONE),t(e,Me).fill(0),console.info(`GS system to ${["single","dual"][a[0]]} mode.`)}).add([66,18,64,0],(a,s,f)=>{switch(a[0]){case 127:{e.switchMode("gs",!0),e.setPortMode(e.getTrackPort(s),4,$.gs),t(e,z)[$.gs][1]=t(e,N).gs,S(e,I,e.KARAOKE_NONE),t(e,Me).fill(0),console.info("MIDI reset: GS");break}default:{e.dispatchEvent("mupromptex");let i=[0,0,0,0],n=(o,c)=>{i[c]=o};if(a.subarray(1).forEach((o,c)=>{let d=c+a[0];[n,n,n,n,l=>{S(this,G,l*129/16383*100),e.dispatchEvent("mastervolume",t(e,G))},l=>{},l=>{}][d](o,c)}),a[0]<4){let o=0;i.forEach(c=>{o=o<<4,o+=c}),o-=1024}}}}).add([66,18,64,1],(a,s,f)=>{e.dispatchEvent("mupromptex");let i=a[0];if(i<16){let n="".padStart(i," ");a.subarray(1).forEach((o,c)=>{n+=String.fromCharCode(Math.max(32,o))}),n=n.padEnd(16," "),console.debug(`GS patch name: ${n}`)}else i<48||(i<65?a.subarray(1).forEach((n,o)=>{let c=`GS ${i+o>55?"chorus":"reverb"} `;([()=>{console.info(`${c}type: ${xt[n]}`),e.setEffectType(0,40,n),e.dispatchEvent("efxreverb",e.getEffectType(0))},()=>{},()=>{},()=>{},()=>{},()=>{},!1,()=>{console.debug(`${c}predelay: ${n}ms`)},()=>{console.info(`${c}type: ${zt[n]}`),e.setEffectType(1,40,16+n),e.dispatchEvent("efxchorus",e.getEffectType(1))},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{console.debug(`${c}to reverb: ${se(n)}`)},()=>{console.debug(`${c}to delay: ${se(n)}`)}][i+o-48]||(()=>{}))()}):i<80?console.debug(`Unknown GS patch address: ${i}`):i<91?a.subarray(1).forEach((n,o)=>{let c="GS delay ";([()=>{console.info(`${c}type: ${Wt[n]}`),e.setEffectType(2,40,32+n),e.dispatchEvent("efxdelay",e.getEffectType(2))},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{console.debug(`${c}to reverb: ${se(n)}`)}][i+o-80]||(()=>{}))()}):console.debug(`Unknown GS patch address: ${i}`))}).add([66,18,64,2],(a,s,f)=>{let i="GS EQ ";a.subarray(1).forEach((n,o)=>{([()=>{console.debug(`${i}low freq: ${[200,400][n]}Hz`)},()=>{console.debug(`${i}low gain: ${n-64}dB`)},()=>{console.debug(`${i}high freq: ${[3e3,6e3][n]}Hz`)},()=>{console.debug(`${i}high gain: ${n-64}dB`)}][a[0]+o]||function(){console.warn(`Unknown GS EQ address: ${a[0]+o}`)})()})}).add([66,18,64,3],(a,s,f)=>{e.dispatchEvent("mupromptex");let i="GS EFX ",n=function(o,c){let d=qt(t(e,ce).subarray(10,12),c,o);d&&console.debug(`${i}${St(t(e,ce).subarray(10,12))} ${d}`)};a.subarray(1).forEach((o,c)=>{([()=>{e.setEffectTypeRaw(3,!1,32+o),e.dispatchEvent("efxinsert0",e.getEffectType(3))},()=>{e.setEffectTypeRaw(3,!0,o),console.info(`${i}type: ${St(t(e,ce).subarray(10,12))}`),e.dispatchEvent("efxinsert0",e.getEffectType(3))},!1,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,()=>{console.debug(`${i}to reverb: ${se(o)}dB`)},()=>{console.debug(`${i}to chorus: ${se(o)}dB`)},()=>{console.debug(`${i}to delay: ${se(o)}dB`)},!1,()=>{console.debug(`${i}1 source: ${o}`),o&&o<96&&e.allocateAceAll(o)},()=>{console.debug(`${i}1 depth: ${o-64}`)},()=>{console.debug(`${i}2 source: ${o}`),o&&o<96&&e.allocateAceAll(o)},()=>{console.debug(`${i}2 depth: ${o-64}`)},()=>{console.debug(`${i}to EQ: ${o?"ON":"OFF"}`)}][a[0]+c]||function(d,l){console.warn(`Unknown GS EFX address: ${l}`)})(o,a[0]+c)})}).add([66,18,65],(a,s,f)=>{k((a[0]>>4)+1<<1,a[0]&15,a.subarray(1))}).add([69,18,16],(a,s,f)=>{var i;switch(a[0]){case 0:{let n=a[1];e.setLetterDisplay(a.subarray(2),"GS display text",n);break}case 8:{let n=a[1],o=e.modelEx.sc;a.subarray(2).forEach((c,d)=>{([()=>{o.showBar=!(c&1),o.invBar=c>>1&1,o.invDisp=c>>2&1},()=>{o.peakHold=c<4?c:1}][d+n]||(()=>{console.debug("Unsupported GS display type SysEx.")}))()});break}case 32:{S(e,be,Date.now()+3200),a[1]===0&&(a[2]?(S(e,J,Math.max(Math.min(a[2]-1,9),0)),D()&&console.debug(`GS switch display page ${a[2]-1}.`)):(S(e,J,0),S(e,be,Date.now()),D()&&console.debug("GS disable display page.")));break}default:if(a[0]<6){t(e,J)>9&&S(e,J,0);let n=a[0]-1<<1|a[1]>>6;t(e,J)===n&&S(e,be,Date.now()+3200),(i=t(e,Se)[n])!=null&&i.length||(t(e,Se)[n]=new Uint8Array(256));let o=t(e,Se)[n];D()&&console.debug(`GS frame draw page ${n}.`);let c=a[1]&63;o.fill(0),a.subarray(2).forEach(function(l,E){let C=E+c,M=Math.floor(C/16),R=C%16,re=(R*4+M)*5,ke=5,X=0;for(re-=R*4,M===3&&(ke=1);X<ke;)o[re+X]=l>>4-X&1,X++})}else console.warn(`Unknown GS display section: ${a[0]}`)}}).add([69,18,32],(a,s,f)=>{let i=a[0],n=a[1],o=a.subarray(2);if(i>>4){console.warn(`SC-8850 partial screen dump out of bounds: invalid bundle.
`,a);return}let c=n+o.length,d=n*6-(n*2428>>16<<1),l=c*6-(c*2428>>16<<1);if(d>640){console.warn(`SC-8850 partial screen dump out of bounds: invalid buffer range.
`,a);return}l>640&&(console.info(`SC-8850 partial screen dump out of bounds: invalid buffer end, automatically restricted.
`,a),l=640);let E=new Uint8Array(l-d);o.forEach((R,re)=>{let ke=re+n,X=(ke*2428&65535)*27>>16===26,Ct=ke*6-(ke*2428>>16<<1),bt=X?2:0;for(;bt<6;)E[Ct+(5-bt)]=R>>bt&1,bt++});let C=i*108+n,M=C*6-(C*2428>>16<<1);e.dispatchEvent("screen",{type:"sc8850",offset:M,data:E}),D()&&console.debug(`SC-8850 screen dump: bundle ${i+1}, range ${d}~${l}`)});let w=function(a,s,f){e.dispatchEvent("mupromptex");let i=a[0],n=_[s],o=Et[s],c=`GS CH${s+1} `;i<3?(a.subarray(1).forEach((d,l)=>{[()=>{t(e,m)[n+v[0]]=d,e.pushChPrimitives(s)},()=>{t(e,L)[s]=d},()=>{let E=0;d<16?E=e.chRedir(d,f,!0):E=g.ch,t(e,W)[s]=E,s!=E&&(e.buildRchTree(),console.info(`${c}receives from CH${E+1}`))}][i+l]()}),e.dispatchEvent("voice",{part:s})):i<19||(i<44?a.subarray(1).forEach((d,l)=>{([()=>{t(e,ee)[s]=+!d},!1,()=>{e.setChType(s,d<<1,$.gs),console.debug(`${c}type: ${d?"drum ":"melodic"}${d||""}`)},()=>{t(e,A)[o+3]=d,t(e,U)[g.rpnt*s+2]=1,e.dispatchEvent("pitch",{part:s,pitch:e.getPitchShift(s)})},!1,()=>{t(e,m)[n+v[7]]=d},!1,!1,()=>{t(e,m)[n+v[10]]=d||128},!1,!1,()=>{console.debug(`${c}CC 1: cc${d}`)},()=>{console.debug(`${c}CC 2: cc${d}`)},()=>{t(e,m)[n+v[93]]=d},()=>{t(e,m)[n+v[91]]=d},!1,!1,()=>{t(e,A)[o+1]=d,t(e,U)[g.rpnt*s+1]=1,e.dispatchEvent("pitch",{part:s,pitch:e.getPitchShift(s)})},()=>{t(e,A)[o+2]=d,t(e,U)[g.rpnt*s+1]=1,e.dispatchEvent("pitch",{part:s,pitch:e.getPitchShift(s)})},()=>{t(e,m)[n+v[94]]=d}][i+l-19]||(()=>{}))()}):i<76||console.debug(`Unknown GS part address: ${i}`))},x=function(a,s){let f=a[0],i=`GS CH${s+1} `;f<2?a.subarray(1).forEach((n,o)=>{[()=>{e.setChCc(s,32,n)},()=>{}][f+o]()}):f<32?console.warn(`Unknown GS misc address: ${f}`):f<35?a.subarray(1).forEach((n,o)=>{[()=>{console.debug(`${i}EQ: o${["ff","n"][n]}`)},()=>{},()=>{console.debug(`${i}EFX: o${["ff","n"][n]}`),t(e,Ze)[s]=n,e.dispatchEvent("partefxtoggle",{part:s,active:n})}][f+o-32]()}):console.warn(`Unknown GS misc address: ${f}`)};t(this,de).add([66,18,64,16],(a,s)=>{w(a,e.chRedir(9,s,!0),s)}).add([66,18,64,17],(a,s)=>{w(a,e.chRedir(0,s,!0),s)}).add([66,18,64,18],(a,s)=>{w(a,e.chRedir(1,s,!0),s)}).add([66,18,64,19],(a,s)=>{w(a,e.chRedir(2,s,!0),s)}).add([66,18,64,20],(a,s)=>{w(a,e.chRedir(3,s,!0),s)}).add([66,18,64,21],(a,s)=>{w(a,e.chRedir(4,s,!0),s)}).add([66,18,64,22],(a,s)=>{w(a,e.chRedir(5,s,!0),s)}).add([66,18,64,23],(a,s)=>{w(a,e.chRedir(6,s,!0),s)}).add([66,18,64,24],(a,s)=>{w(a,e.chRedir(7,s,!0),s)}).add([66,18,64,25],(a,s)=>{w(a,e.chRedir(8,s,!0),s)}).add([66,18,64,26],(a,s)=>{w(a,e.chRedir(10,s,!0),s)}).add([66,18,64,27],(a,s)=>{w(a,e.chRedir(11,s,!0),s)}).add([66,18,64,28],(a,s)=>{w(a,e.chRedir(12,s,!0),s)}).add([66,18,64,29],(a,s)=>{w(a,e.chRedir(13,s,!0),s)}).add([66,18,64,30],(a,s)=>{w(a,e.chRedir(14,s,!0),s)}).add([66,18,64,31],(a,s)=>{w(a,e.chRedir(15,s,!0),s)}).add([66,18,64,64],(a,s)=>{x(a,e.chRedir(9,s,!0))}).add([66,18,64,65],(a,s)=>{x(a,e.chRedir(0,s,!0))}).add([66,18,64,66],(a,s)=>{x(a,e.chRedir(1,s,!0))}).add([66,18,64,67],(a,s)=>{x(a,e.chRedir(2,s,!0))}).add([66,18,64,68],(a,s)=>{x(a,e.chRedir(3,s,!0))}).add([66,18,64,69],(a,s)=>{x(a,e.chRedir(4,s,!0))}).add([66,18,64,70],(a,s)=>{x(a,e.chRedir(5,s,!0))}).add([66,18,64,71],(a,s)=>{x(a,e.chRedir(6,s,!0))}).add([66,18,64,72],(a,s)=>{x(a,e.chRedir(7,s,!0))}).add([66,18,64,73],(a,s)=>{x(a,e.chRedir(8,s,!0))}).add([66,18,64,74],(a,s)=>{x(a,e.chRedir(10,s,!0))}).add([66,18,64,75],(a,s)=>{x(a,e.chRedir(11,s,!0))}).add([66,18,64,76],(a,s)=>{x(a,e.chRedir(12,s,!0))}).add([66,18,64,77],(a,s)=>{x(a,e.chRedir(13,s,!0))}).add([66,18,64,78],(a,s)=>{x(a,e.chRedir(14,s,!0))}).add([66,18,64,79],(a,s)=>{x(a,e.chRedir(15,s,!0))}),t(this,we).add([54,65],(a,s)=>{let f=t(e,N).x5==="81"?"05rw":"x5d";e.switchMode(f,!0),e.setPortMode(e.getTrackPort(s),1,$[f]);let i=a[a.length-1],n=a.subarray(0,a.length-1),o=Re(n);o!=i&&(console.info(`X5D multi parameters checksum mismatch! Expected ${o}, got ${i}.`),console.debug(a));let c=(a[1]<<7)+a[0],d=(a[3]<<7)+a[2],l=e.chRedir(c&15,s,!0),E=_[l];[()=>{d<1||(d<101?(e.setChType(l,e.CH_MELODIC,$.x5d),t(e,L)[l]=d-1,t(e,m)[E+v[0]]=t(e,N).x5):d<229?(e.setChType(l,e.CH_MELODIC,$.x5d),t(e,L)[l]=d-101,t(e,m)[E+v[0]]=56):(e.setChType(l,e.CH_DRUMS,$.x5d),t(e,L)[l]=tr[d-229]||0,t(e,m)[E+v[0]]=62)),e.pushChPrimitives(l),e.dispatchEvent("voice",{part:l})},()=>{t(e,m)[E+v[7]]=d},()=>{d<31&&(t(e,m)[E+v[10]]=Math.round((d-15)*4.2+64))},()=>{t(e,m)[E+v[93]]=ot(d)},()=>{t(e,m)[E+v[91]]=ot(d)},()=>{t(e,A)[l*g.rpn+3]=d>8191?d-16320:64+d,t(e,U)[g.rpnt*l+2]=1,e.dispatchEvent("pitch",{part:l,pitch:e.getPitchShift(l)})},()=>{t(e,A)[l*g.rpn+1]=d>8191?d-16320:64+d,t(e,U)[g.rpnt*l+1]=1,e.dispatchEvent("pitch",{part:l,pitch:e.getPitchShift(l)})},()=>{d>0&&(t(e,A)[l*g.rpn]=d,t(e,U)[g.rpnt*l]=1,e.dispatchEvent("pitch",{part:l,pitch:e.getPitchShift(l)}))},()=>{}][c>>4]()}).add([54,76,0],(a,s)=>{e.dispatchEvent("mupromptex");let f=t(e,N).x5==="81"?"05rw":"x5d";e.switchMode(f),e.setPortMode(e.getTrackPort(s),1,$[f]);let i="",n=t(e,N).x5,o=0,c=0,d="MSB	PRG	LSB	NME";ue(a,function(l,E){if(E<16400){let C=E%164;switch(!0){case C<10:{l>31&&(i+=String.fromCharCode(l));break}case C===10:break;case C===11:{d+=`
${n}	${o}	${c}	${i.trim().replace("Init Voice","")}`,o++,i="";break}}o>99&&(n=90,o=0)}}),e.userBank.clearRange({msb:t(e,N).x5,prg:[0,99],lsb:0}),e.userBank.load(d),D()&&console.debug(d),e.forceVoiceRefresh()}).add([54,77,0],(a,s)=>{e.dispatchEvent("mupromptex");let f=t(e,N).x5==="81"?"05rw":"x5d";e.switchMode(f),e.setPortMode(e.getTrackPort(s),1,$[f]);let i="",n=90,o=0,c=0,d="MSB	PRG	LSB	NME";ue(a,function(l,E){if(E<13600){let C=E%136;switch(!0){case C<10:{l>31&&(i+=String.fromCharCode(l));break}case C===11:{d+=`
${n}	${o}	${c}	${i.trim().replace("Init Combi","")}`,o++,i="";break}}}}),e.userBank.clearRange({msb:90,prg:[0,99],lsb:0}),e.userBank.load(d),D()&&console.debug(d),e.forceVoiceRefresh()}).add([54,78],(a,s)=>{let f=t(e,N).x5==="81"?"05rw":"x5d";e.switchMode(f),e.setPortMode(e.getTrackPort(s),1,$[f]),console.debug(`X5D mode switch requested: ${["combi","combi edit","prog","prog edit","multi","global"][a[0]]} mode.`)}).add([54,85],(a,s)=>{e.dispatchEvent("mupromptex");let f=t(e,N).x5==="81"?"05rw":"x5d";e.switchMode(f),e.setPortMode(e.getTrackPort(s),1,$[f]),ue(a,(i,n)=>{n>0&&n<3&&(e.setEffectType(n-1,44,i),e.dispatchEvent(`efx${["reverb","chorus"][n-1]}`,e.getEffectType(n-1)))})}).add([54,104],(a,s)=>{e.dispatchEvent("mupromptex");let f=t(e,N).x5==="81"?"05rw":"x5d";e.switchMode(f,!0);let i=e.getTrackPort(s);if(t(e,F)[i]&&t(e,F)[i]!=$[f])if(t(e,Ce).dumpLimit===e.DUMP_MODE){console.warn(`Dump cancelled for track ${s}. Port ${String.fromCharCode(65+i)} mode "${V[t(e,F)[i]]}" mismatch, should be "${f}".`);return}else console.info(`Track ${s} is trying to perform a mismached mode dump on port ${String.fromCharCode(65+i)}.`);e.setPortMode(i,1,$[f]),ue(a,function(n,o,c,d){if(o<192){let l=e.chRedir(Math.floor(o/12),s,!0),E=_[l];switch(o%12){case 0:{n<128?(e.setChType(l,e.CH_MELODIC,$.x5d),t(e,m)[E+v[0]]=t(e,N).x5,t(e,L)[l]=n):(e.setChType(l,e.CH_DRUMS,$.x5d),t(e,m)[E+v[0]]=62,t(e,L)[l]=tr[n-128]),n>0&&e.setChActive(l,1),e.pushChPrimitives(l),e.dispatchEvent("voice",{part:l});break}case 1:{t(e,m)[E+v[7]]=n;break}case 2:{t(e,A)[l*g.rpn+3]=n>127?n-192:64+n,t(e,U)[g.rpnt*l+2]=1,e.dispatchEvent("pitch",{part:l,pitch:e.getPitchShift(l)});break}case 3:{t(e,A)[l*g.rpn+1]=n>127?n-192:64+n,t(e,U)[g.rpnt*l+1]=1,e.dispatchEvent("pitch",{part:l,pitch:e.getPitchShift(l)});break}case 4:{n<31&&(t(e,m)[E+v[10]]=Math.round((n-15)*4.2+64));break}case 5:{let C=n>>4,M=n&15;t(e,m)[E+v[91]]=ot(M),t(e,m)[E+v[93]]=ot(C);break}case 10:{t(e,O)[l]||(t(e,m)[E+v[0]]=n>>6?56:t(e,N).x5,e.pushChPrimitives(l),e.dispatchEvent("voice",{part:l}));break}case 11:{let C=e.chRedir(n&15,s,!0),M=n>>4;t(e,W)[l]=n,(C!=l||M)&&(console.info(`X5D Part CH${l+1} receives from CH${C+1}.`),e.buildRchTree())}}}else{let l=e.chRedir(o-192,s,!0)}})}),t(this,de).add([22,18,127],(a,s,f)=>{e.switchMode("mt32",!0),e.setPortMode(e.getTrackPort(s),1,$.mt32),S(e,I,e.KARAOKE_NONE),e.userBank.clearRange({msb:0,lsb:127,prg:[0,127]}),console.info("MIDI reset: MT-32")}).add([22,18,0],(a,s,f)=>{e.switchMode("mt32");let i=e.chRedir(f,s,!0),n=a[1];a.subarray(2).forEach((o,c)=>{let d=c+n;t(e,Pe)[d+(i-1)*16]=o,([!1,()=>{let l=t(e,Pe)[i-1<<4];if(l<3){if(t(e,ge)[i]=1,l===2)for(let E=0;E<name.length;E++)t(e,ye)[(i-1)*g.cmt+E]=t(e,Oe)[o*g.cmt+E];else{let E=e.baseBank.get(0,o+(l<<6),127,"mt32").name;for(let C=0;C<E.length;C++)t(e,ye)[(i-1)*g.cmt+C]=E.charCodeAt(C)}e.dispatchEvent("voice",{part:i})}},()=>{t(e,A)[i*g.rpn+3]=o+40,t(e,U)[g.rpnt*i+2]=1},()=>{t(e,A)[i*g.rpn+1]=o+14,t(e,U)[g.rpnt*i+1]=1},()=>{t(e,A)[i*g.rpn]=o,t(e,U)[g.rpnt*i]=1},!1,()=>{e.setChCc(i,91,o?127:0)},!1,()=>{e.setChCc(i,7,o)},()=>{e.setChCc(i,10,Math.ceil(o*9.05))}][d]||(()=>{}))()})}).add([22,18,1],(a,s,f)=>{e.switchMode("mt32");let i=f&7;console.debug(`MT-32 slot #${f+1} Drum: ${a}`);let n=a[0]<<7|a[1];a.subarray(2).forEach((o,c)=>{let d=c+n,l=(d>>2)+24,E=d&3,C=i*g.dpn;if(D()&&console.debug(`MT-32 temp drum note ${l} param ${E}: ${o}`),l<24){console.warn(`MT-32 dev drum write attempted on an OOB note: ${l}`);return}[()=>{},()=>{t(e,te)[(C+pe[26])*g.dnc+l]=Math.round(o*1.27)},()=>{t(e,te)[(C+pe[26])*g.dnc+l]=o*9+1&127},()=>{t(e,te)[(C+pe[26])*g.dnc+l]=o?127:0}][E]()})}).add([22,18,2],(a,s,f)=>{e.switchMode("mt32");let i=e.chRedir(f,s,!0),n=a[1]+(a[0]<<7);n<10&&(t(e,ge)[i]=1),a.subarray(2).forEach((o,c)=>{let d=c+n;d<14&&(t(e,ye)[(i-1)*g.cmt+d]=o)}),e.dispatchEvent("voice",{part:i})}).add([22,18,3],(a,s,f)=>{e.switchMode("mt32");let i=f&7;if(a[0]){let n=(a[0]-1<<7)+a[1]-16;a.subarray(2).forEach((o,c)=>{let d=c+n,l=(d>>2)+24,E=d&3,C=i*g.dpn;if(D()&&console.debug(`MT-32 dev drum note ${l} param ${E}: ${o}`),l<24){console.warn(`MT-32 dev drum write attempted on an OOB note: ${l}`);return}[()=>{},()=>{t(e,te)[(C+pe[26])*g.dnc+l]=Math.round(o*1.27)},()=>{t(e,te)[(C+pe[26])*g.dnc+l]=o*9+1&127},()=>{t(e,te)[(C+pe[26])*g.dnc+l]=o?127:0}][E]()})}else{let n=a[1];a.subarray(2).forEach((o,c)=>{let d=c+n;t(e,Pe)[d]=o;let l=e.chRedir(1+(d>>4),s,!0),E=d&15;([!1,()=>{let C=t(e,Pe)[l-1<<4];if(C<3)if(t(e,ge)[l]=1,C===2)for(let M=0;M<name.length;M++)t(e,ye)[(l-1)*g.cmt+M]=t(e,Oe)[o*g.cmt+M];else{let M=e.baseBank.get(0,o+(C<<6),127,"mt32").name;for(let R=0;R<M.length;R++)t(e,ye)[(l-1)*g.cmt+R]=M.charCodeAt(R)}e.dispatchEvent("voice",{part:l})},()=>{t(e,A)[l*g.rpn+3]=o+40,t(e,U)[g.rpnt*l+2]=1},()=>{t(e,A)[l*g.rpn+1]=o+14,t(e,U)[g.rpnt*l+1]=1},()=>{t(e,A)[l*g.rpn]=o,t(e,U)[g.rpnt*l]=1},!1,()=>{e.setChCc(l,91,o?127:0)},!1,()=>{e.setChCc(l,7,o)},()=>{e.setChCc(l,10,Math.ceil(o*9.05))}][E]||(()=>{}))()})}}).add([22,18,4],(a,s,f)=>{e.switchMode("mt32");let i=a[1]+(a[0]<<7),n=[];a.subarray(2).forEach((o,c)=>{let d=c+i,l=e.chRedir(Math.floor(d/246+1),s,!0),E=d%246;E<14&&(t(e,ye)[(l-1)*g.cmt+E]=o),E<10&&(t(e,ge)[l]=1),n.indexOf(l)<0&&n.push(l)}),n.forEach(o=>{e.dispatchEvent("voice",{part:o})})}).add([22,18,5],(a,s,f)=>{e.switchMode("mt32");let i=(a[0]<<7)+a[1];a.subarray(2).forEach((n,o)=>{let c=i+o,d=Math.floor(c/8),l=c&7,E=d*8;t(e,tt)[c]=n,([!1,()=>{let C=t(e,tt)[E];if(C<3){let M="";if(C===2){let re=g.cmt*d;M=`MT-m:${n.toString().padStart(3,"0")}`}else M=e.baseBank.get(0,n+(C<<6),127,"mt32").name;e.userBank.clearRange({msb:0,lsb:127,prg:d});let R=`MSB	LSB	PRG	NME
49	127	${d}	${M}`;e.userBank.load(R,!0)}}][l]||(()=>{}))()}),e.forceVoiceRefresh()}).add([22,18,8],(a,s,f)=>{e.switchMode("mt32");let i=((a[0]&1)<<7)+a[1],n=a[0]>>1,o=!1;if(a.subarray(2).forEach((c,d)=>{let l=i+d;l<g.cmt&&(t(e,Oe)[n*g.cmt+l]=c,o=!0)}),o){e.userBank.clearRange({msb:0,lsb:127,prg:n});let c=`MSB	LSB	PRG	NME
49	127	${n}	MT-m:${n}`;e.userBank.load(c,!0)}e.forceVoiceRefresh()}).add([22,18,16],(a,s,f)=>{e.switchMode("mt32");let i=a[1],n=!1,o=function(c,d){t(e,W)[d-12]=c,n=!0};a.subarray(2).forEach((c,d)=>{let l=d+i;([!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,o,o,o,o,o,o,o,o,o,()=>{S(e,G,c),e.dispatchEvent("mastervolume",t(e,G))}][l]||(()=>{}))(c,d)}),n&&e.buildRchTree()}).add([22,18,32],(a,s,f)=>{e.switchMode("mt32");let i=a[1],n=" ".repeat(i);a.subarray(2).forEach(o=>{o>31?n+=String.fromCharCode(o):n+=" "}),S(e,Ae,n.padStart(20," ")),S(e,De,Date.now()+3200)}).add([22,18,82],(a,s)=>{let f=e.chRedir(0,s,!0);for(let i=0;i<16;i++)t(e,Y).ano(f+i),i&&i<10&&(t(e,L)[f+i]=Tt[i-1]);console.info("MT-32 alt reset complete.")}),t(this,we).add([66,0],(a,s)=>{e.switchMode("ns5r",!0),e.setPortMode(e.getTrackPort(s),2,$.ns5r),S(e,I,e.KARAOKE_NONE),console.debug(`NS5R mode switch requested: ${["global","multi","prog edit","comb edit","drum edit","effect edit"][a[0]]} mode.`)}).add([66,1],(a,s)=>{let f=["ns5r","05rw"][a[0]];e.switchMode(f,!0),e.setPortMode(e.getTrackPort(s),2,$[f]),S(e,I,e.KARAOKE_NONE)}).add([66,18,0,0],(a,s)=>{let f=a[0];switch(f){case 124:case 126:case 127:{e.switchMode("ns5r",!0),e.setPortMode(e.getTrackPort(s),2,$.ns5r),S(e,I,e.KARAOKE_NONE);break}case 125:{e.initDrums(),console.info(`NS5R drum setup reset on drum kit ${a[1]}.`);break}default:if(f<10){let i=[0,0,0,0],n=(o,c)=>{i[c]=o};if(a.subarray(1).forEach((o,c)=>{[n,n,n,n,()=>{S(e,G,o*129/16383*100),e.dispatchEvent("mastervolume",t(e,G))},()=>o-64,()=>o-64,()=>{},()=>{},()=>{}][f+c]()}),a[0]<4){let o=0;i.forEach(c=>{o=o<<4,o+=c}),o-=1024}}}}).add([66,18,0,1],(a,s)=>{}).add([66,18,0,2],(a,s)=>{}).add([66,18,1],(a,s)=>{e.dispatchEvent("mupromptex");let f=e.chRedir(a[0],s,!0),i=_[f],n=a[1],o=`NS5R CH${f+1} `;a.subarray(2).forEach((c,d)=>{let l=n+d;l<3?([()=>{t(e,m)[i+v[0]]=c||lt.bank0,e.pushChPrimitives(f)},()=>{t(e,m)[i+v[32]]=c,e.pushChPrimitives(f)},()=>{t(e,L)[f]=c}][l](),e.dispatchEvent("voice",{part:f})):l<8||(l<14?[()=>{let E=e.chRedir(c,s,!0);t(e,W)[f]=E,f!=E&&(e.buildRchTree(),console.info(`${o}receives from CH${E+1}`))},()=>{t(e,ee)[f]=+!c},()=>{e.setChType(f,c,$.ns5r),console.debug(`${o}type: ${ct[c]}`)},()=>{t(e,A)[g.rpn*f+3]=c,t(e,U)[g.rpnt*f+2]=1,e.dispatchEvent("pitch",{part:f,pitch:e.getPitchShift(f)})},()=>{},()=>{}][l-8]():l<16||(l<33?[()=>{t(e,m)[i+v[7]]=c},()=>{t(e,m)[i+v[11]]=c},()=>{},()=>{},()=>{t(e,m)[i+v[10]]=c||128},()=>{},()=>{},()=>{t(e,m)[i+v[93]]=c},()=>{t(e,m)[i+v[91]]=c},()=>{t(e,m)[i+v[76]]=c},()=>{t(e,m)[i+v[77]]=c},()=>{t(e,m)[i+v[78]]=c},()=>{t(e,m)[i+v[74]]=c},()=>{t(e,m)[i+v[71]]=c},()=>{t(e,m)[i+v[73]]=c},()=>{t(e,m)[i+v[75]]=c},()=>{t(e,m)[i+v[72]]=c}][l-16]():l<112||l<114&&[()=>{t(e,m)[i+v[5]]=c},()=>{t(e,m)[i+v[65]]=c}][l-112]()))})}).add([66,18,8,0],(a,s)=>{let f=a[0];if(f<32)e.setLetterDisplay(a.subarray(1,33),"NS5R letter display");else{let i=f-32;S(e,be,Date.now()+3200),S(e,J,10),t(e,he,xe).fill(0);let n=a.subarray(1),o=4;n.forEach(function(c,d){let l=d+i,E=l>>4,C=l&15;if(l<80){let M=E<o?c:c>>3,R=0,re=E<o?6:3;for(;M>0;)t(e,he,xe)[C*32+E*7+(re-R)]=M&1,M=M>>1,R++}})}}).add([66,18,48],(a,s,f)=>{y(0,a)}).add([66,18,49],(a,s,f)=>{y(1,a)}).add([66,18,50],(a,s,f)=>{y(2,a)}).add([66,18,51],(a,s,f)=>{y(3,a)}).add([66,18,52],(a,s,f)=>{y(4,a)}).add([66,18,53],(a,s,f)=>{y(5,a)}).add([66,18,54],(a,s,f)=>{y(6,a)}).add([66,18,55],(a,s,f)=>{y(7,a)}).add([66,52],(a,s)=>{e.switchMode("ns5r"),S(e,I,e.KARAOKE_NONE);let f="";ue(a,(i,n)=>{n<8?(i>31&&(f+=String.fromCharCode(i)),n===7&&(e.aiEfxName=f)):n<10&&(e.setEffectType(n-8,44,i),e.dispatchEvent(`efx${["reverb","chorus"][n-8]}`,e.getEffectType(n-8)))})}).add([66,53],(a,s)=>{e.dispatchEvent("mupromptex"),e.switchMode("ns5r"),S(e,I,e.KARAOKE_NONE);let f="",i=a[a.length-1],n=a.subarray(0,a.length-1),o=Re(n);o!=i&&(console.info(`NS5R current multi dump checksum mismatch! Expected ${o}, got ${i}.`),console.debug(a));let c=e.getTrackPort(s);if(t(e,F)[c]&&t(e,F)[c]!=$.ns5r)if(t(e,Ce).dumpLimit===e.DUMP_MODE){console.warn(`Dump cancelled for track ${s}. Port ${String.fromCharCode(65+c)} mode "${V[t(e,F)[c]]}" mismatch, should be "ns5r".`);return}else console.info(`Track ${s} is trying to perform a mismached mode dump on port ${String.fromCharCode(65+c)}.`);e.setPortMode(c,2,$.ns5r),ue(n,function(d,l){switch(!0){case l<2944:{let E=e.chRedir(Math.floor(l/92),s,!0),C=_[E];switch(l%92){case 0:{t(e,m)[C+v[0]]=d,e.pushChPrimitives(E),e.dispatchEvent("voice",{part:E});break}case 1:{t(e,m)[C+v[32]]=d,!d&&!t(e,m)[C+v[0]]&&(t(e,m)[C+v[0]]=lt.bank0),e.pushChPrimitives(E),e.dispatchEvent("voice",{part:E});break}case 2:{t(e,L)[E]=d,d>0&&e.setChActive(E,1),e.dispatchEvent("voice",{part:E});break}case 3:{let M=e.chRedir(d,s,!0);t(e,W)[E]=M,E!=M&&(console.info(`NS5R CH${E+1} receives from CH${M+1}.`),e.buildRchTree());break}case 7:{t(e,O)[E]=d,e.dispatchEvent("voice",{part:E});break}case 8:{t(e,A)[E*g.rpn+3]=d<40||d>88?d+(d>63?-192:64):d,t(e,U)[g.rpnt*E+2]=1,e.dispatchEvent("pitch",{part:E,pitch:e.getPitchShift(E)});break}case 9:case 10:{t(e,m)[C+v[7]]=d;break}case 11:{t(e,m)[C+v[11]]=d;break}case 14:{t(e,m)[C+v[10]]=d||128;break}case 19:{t(e,m)[C+v[93]]=d;break}case 20:{t(e,m)[C+v[91]]=d;break}case 84:{t(e,m)[C+v[65]]=d;break}case 85:{t(e,m)[C+v[5]]=d;break}}break}case l<3096:break;case l<3134:{let E=l-3096;E<8?(d>31&&(f+=String.fromCharCode(d)),E===7&&(e.aiEfxName=f)):E<10&&(e.setEffectType(E-8,44,d),e.dispatchEvent(`efx${["reverb","chorus"][E-8]}`,e.getEffectType(E-8)));break}case l<8566:break}})}).add([66,54],(a,s)=>{e.dispatchEvent("mupromptex"),e.switchMode("ns5r");let f="",i=80,n=0,o=0,c="MSB	PRG	LSB	NME";ue(a,function(d,l){let E=l%158;switch(!0){case E<10:{d>31&&(f+=String.fromCharCode(d));break}case E===10:break;case E===11:{i=d&127;break}case E===12:{o=d&127;break}case E===13:{c+=`
${i}	${n}	${o}	${f.trim().replace("Init Voice","")}`,n++,f="";break}}}),e.userBank.clearRange({msb:80,lsb:0}),e.userBank.load(c),D()&&console.debug(c),e.forceVoiceRefresh()}).add([66,55],(a,s)=>{e.dispatchEvent("mupromptex"),e.switchMode("ns5r");let f="",i=88,n=0,o=0,c="MSB	PRG	LSB	NME";ue(a,function(d,l){let E=l%126;switch(!0){case E<10:{d>31&&(f+=String.fromCharCode(d));break}case E===11:break;case E===12:break;case E===13:{c+=`
${i}	${n}	${o}	${f.trim().replace("Init Combi","")}`,n++,f="";break}}}),e.userBank.clearRange({msb:88,lsb:0}),e.userBank.load(c),D()&&console.debug(c),e.forceVoiceRefresh()}).add([66,125],(a,s,f)=>{e.dispatchEvent("backlight",["green","orange","red",!1,"yellow","blue","purple"][a[0]]||"white")}).add([66,127],(a,s,f)=>{let i=a[a.length-1],n=a.subarray(0,a.length-1),o=Re(n);o!=i&&(console.info(`NS5R screen dump checksum mismatch! Expected ${o}, got ${i}.`),console.debug(a));let c=new Uint8Array(5760);ue(a,(d,l,E)=>{if(l<720)for(let C=0;C<8;C++)c[l*8+C]=d>>7-C&1}),e.dispatchEvent("screen",{type:"ns5r",data:c})}).add([76],(a,s,f)=>{t(e,we).run([66,...a],s,f)}),t(this,ze).add([16,0,8,0],(a,s,f)=>{let i=(a[2]<<4)+a[3],n="K11 ";([()=>{e.switchMode("k11",!0),e.setPortMode(e.getTrackPort(s),2,$.k11),S(e,I,e.KARAOKE_NONE),t(e,z)[$.k11][1]=i?4:0,console.info("MIDI reset: GMega/K11")},()=>{e.setEffectType(0,24,i),console.debug(`${n}reverb type: ${i}`),e.dispatchEvent("efxreverb",e.getEffectType(0))},()=>{console.debug(`${n}reverb time: ${i}`)},()=>{console.debug(`${n}reverb time: ${i}`)},()=>{console.debug(`${n}reverb predelay: ${i}`)},()=>{console.debug(`${n}reverb predelay: ${i}`)},()=>{console.debug(`${n}depth high: ${i}`)},()=>{console.debug(`${n}depth high: ${i}`)},()=>{console.debug(`${n}depth low: ${i}`)},()=>{console.debug(`${n}depth low: ${i}`)}][a[0]]||(()=>{}))()}).add([16,0,8,1],(a,s,f)=>{e.dispatchEvent("mupromptex");let i=e.chRedir(a[1],s,!0),n=_[i],o=Et[i],c=(a[3]<<4)+a[4],d=`K11 CH${i+1} `;([()=>{c<128?(e.setChType(i,e.CH_MELODIC,$.k11),t(e,m)[n+v[0]]=0,t(e,L)[i]=c):(e.setChType(i,e.CH_DRUMS,$.k11),t(e,L)[i]=c-128),e.pushChPrimitives(i),e.dispatchEvent("voice",{part:i})},()=>{let l=e.chRedir(c,s,!0);t(e,W)[i]=l,i!=l&&(e.buildRchTree(),console.info(`${d}receives from CH${l+1}`))},()=>{t(e,m)[n+v[7]]=c},()=>{uupThis.setChActive(i,c)},()=>{t(e,m)[n+v[10]]=c},()=>{t(e,A)[o+3]=c+40,t(e,U)[g.rpnt*i+2]=1,e.dispatchEvent("pitch",{part:i,pitch:e.getPitchShift(i)})},()=>{t(e,A)[o+1]=c>>1,t(e,A)[o+2]=c&1,t(e,U)[g.rpnt*i+1]=1,e.dispatchEvent("pitch",{part:i,pitch:e.getPitchShift(i)})},()=>{t(e,m)[n+v[91]]=c?127:0},()=>{},()=>{t(e,m)[n+v[74]]=c},()=>{t(e,m)[n+v[73]]=c},()=>{t(e,m)[n+v[72]]=c}][a[0]]||(()=>{}))()}).add([16,0,9,0],(a,s,f)=>{e.dispatchEvent("mupromptex");let i=(a[2]<<4)+a[3],n="GMLX ";([()=>{console.debug(`${n}reverb type: ${i}`)},()=>{console.debug(`${n}reverb time: ${i}`)},()=>{console.debug(`${n}reverb predelay: ${i}`)},()=>{console.debug(`${n}depth high: ${i}`)},()=>{console.debug(`${n}depth low: ${i}`)}][a[0]]||(()=>{}))()}).add([16,0,9,3],(a,s,f)=>{e.dispatchEvent("mupromptex");let i=(a[2]<<4)+a[3],n=e.chRedir(a[1],s,!0),o=_[n];[()=>{i<128?(e.setChType(n,e.CH_MELODIC,$.k11),t(e,m)[o+v[0]]=0,t(e,m)[o+v[32]]=0,t(e,L)[n]=i):i<160?(e.setChType(n,e.CH_MELODIC,$.k11),t(e,m)[o+v[0]]=0,t(e,m)[o+v[32]]=7,t(e,L)[n]=i-100):(e.setChType(n,e.CH_DRUMS,$.k11),t(e,m)[o+v[0]]=122,t(e,m)[o+v[32]]=0,t(e,L)[n]=i-160),e.pushChPrimitives(n),e.dispatchEvent("voice",{part:n})},()=>{let c=e.chRedir(i,s,!0);t(e,W)[n]=c,n!=c&&(e.buildRchTree(),console.info(`GMLX CH${n+1} receives from CH${c+1}`))}][a[0]]()}).add([16,0,9,4],(a,s,f)=>{e.dispatchEvent("mupromptex");let i=(a[2]<<4)+a[3],n=e.chRedir(a[1],s,!0),o=_[n],c=Et[n],d=`GMLX CH${n+1} `;[()=>{e.setChActive(n,i)},()=>{t(e,m)[o+v[7]]=i},()=>{t(e,m)[o+v[10]]=i},()=>{t(e,m)[o+v[91]]=i?127:0},()=>{t(e,A)[c+3]=i+40,t(e,U)[g.rpnt*n+2]=1,e.dispatchEvent("pitch",{part:n,pitch:e.getPitchShift(n)})},()=>{t(e,A)[c+1]=i,t(e,U)[g.rpnt*n+1]=1,e.dispatchEvent("pitch",{part:n,pitch:e.getPitchShift(n)})},()=>{t(e,A)[c]=i,t(e,U)[g.rpnt*n]=1,e.dispatchEvent("pitch",{part:n,pitch:e.getPitchShift(n)})},()=>{}][a[0]]()}),t(this,We).add([66,93,64],(a,s,f)=>{let i=a[2];switch(a[0]){case 0:{switch(a[1]){case 4:{e.dispatchEvent("mupromptex"),S(e,G,i*129/16383*100),e.dispatchEvent("mastervolume",t(e,G));break}case 5:{e.dispatchEvent("mupromptex"),i-64;break}case 6:{e.dispatchEvent("mupromptex"),console.debug(`SG global reverb: ${i?"on":"off"}`);break}case 127:{e.switchMode("sg",!0),e.setPortMode(e.getTrackPort(s),1,$.sg);break}}break}case 1:{switch(a[1]){case 48:{e.dispatchEvent("mupromptex"),console.debug(`SG reverb type: ${xt[i]}`);break}}break}default:if(a[0]>>4===1){e.dispatchEvent("mupromptex");let n=e.chRedir(a[0]&15,s,!0);if(a[1]===2){let o=e.chRedir(i,s,!0);t(e,W)[n]=o,n!=o&&(e.buildRchTree(),console.info(`SG CH${n+1} receives from CH${o+1}`))}else a[1]===19&&e.setChCc(n,7,i)}else console.warn(`Unknown AKAI SG SysEx: ${a}`)}}),t(this,qe).add([9],(a,s,f)=>{e.dispatchEvent("mupromptex"),console.debug(`GZ set effect: ${["stage reverb","hall reverb","room reverb","chorus","tremolo","phaser","rotary speaker","enhancer","flanger","EQ"][a[0]]||"off"}`)}),t(this,le).add([127,0],(a,s,f)=>{e.switchMode("motif");let i=new Uint8Array([127,1,...a]);t(e,le).run(i,s,f)}).add([127,1,0,0],(a,s,f)=>{e.switchMode("s90es");let i="S90/Motif ES system ",n=a[0];a.subarray(1).forEach((o,c)=>{([()=>{S(e,G,o*12900/16383),e.dispatchEvent("mastervolume",t(e,G))}][n+c]||(()=>{console.info(`Unrecognized ${i}ID: ${n+c}`)}))()})}).add([127,1,0,36,54,1],(a,s,f)=>{e.switchMode("s90es");let i="S90/Motif ES reverb ",n=a[0];a.subarray(1).forEach((o,c)=>{([()=>{e.setEffectTypeRaw(0,!1,o&15|128)},()=>{e.setEffectTypeRaw(0,!0,o)}][n+c]||(()=>{}))()}),e.dispatchEvent("efxreverb",e.getEffectType(0))}).add([127,1,0,37,54,2],(a,s,f)=>{e.switchMode("s90es");let i="S90/Motif ES chorus ",n=a[0];a.subarray(1).forEach((o,c)=>{([()=>{e.setEffectTypeRaw(1,!1,o&15|128)},()=>{e.setEffectTypeRaw(1,!0,o)}][n+c]||(()=>{}))()}),e.dispatchEvent("efxchorus",e.getEffectType(1))}).add([127,1,0,34,54,3],(a,s,f)=>{e.switchMode("s90es");let i="S90/Motif ES insert 1 ",n=a[0];a.subarray(1).forEach((o,c)=>{([()=>{e.setEffectTypeRaw(3,!1,o&15|128)},()=>{e.setEffectTypeRaw(3,!0,o)}][n+c]||(()=>{}))()}),e.dispatchEvent("efxinsert0",e.getEffectType(3))}).add([127,1,0,34,54,4],(a,s,f)=>{e.switchMode("s90es");let i="S90/Motif ES insert 2 ",n=a[0];a.subarray(1).forEach((o,c)=>{([()=>{e.setEffectTypeRaw(4,!1,o&15|128)},()=>{e.setEffectTypeRaw(4,!0,o)}][n+c]||(()=>{}))()}),e.dispatchEvent("efxinsert1",e.getEffectType(4))}).add([127,1,0,35,54,17],(a,s,f)=>{e.switchMode("s90es");let i="S90/Motif ES variation ",n=a[0];a.subarray(1).forEach((o,c)=>{([()=>{e.setEffectTypeRaw(2,!1,o&15|128)},()=>{e.setEffectTypeRaw(2,!0,o)}][n+c]||(()=>{}))()}),e.dispatchEvent("efxdelay",e.getEffectType(2))}).add([127,1,0,58,55],(a,s,f)=>{e.dispatchEvent("mupromptex"),e.switchMode("s90es");let i=e.getTrackPort(s);if(t(e,F)[i]&&t(e,F)[i]!=t(e,N).smotif)if(t(e,Ce).dumpLimit===e.DUMP_MODE){console.warn(`Dump cancelled for track ${s}. Port ${String.fromCharCode(65+i)} mode "${V[t(e,F)[i]]}" mismatch, should be "${V[t(e,N).smotif]}".`);return}else console.info(`Track ${s} is trying to perform a mismached mode dump on port ${String.fromCharCode(65+i)}.`);let n=e.chRedir(a[0],s,!0),o=_[n],c=a[1];a[0]>15&&(n=a[0]+32);let d=`Track ${s} S90/Motif ES bulk CH${n<128?n+1:"U"+(n-127)} `;console.debug(d,a),!(a[0]>15)&&a.subarray(2).forEach((l,E)=>{([()=>{t(e,m)[o+v[0]]=l,e.pushChPrimitives(n),e.dispatchEvent("voice",{part:n})},()=>{l&&e.setChActive(n,1),t(e,m)[o+v[32]]=l,e.getChPrimitive(n,1)===63&&e.setChType(n,[32,40].indexOf(l)>-1?e.CH_DRUMS:e.CH_MELODIC,t(e,B),!0),e.pushChPrimitives(n),e.dispatchEvent("voice",{part:n})},()=>{l&&e.setChActive(n,1),t(e,L)[n]=l,e.dispatchEvent("voice",{part:n})},()=>{let C=e.chRedir(l,s,!0);t(e,W)[n]=C,n!=C&&(e.buildRchTree(),console.info(`${d}receives from CH${C+1}`))},()=>{t(e,ee)[n]=l?0:1},!1,!1,!1,!1,!1,!1,!1,!1,()=>{l!=100&&e.setChActive(n,1),t(e,m)[o+v[7]]=l},()=>{l!=64&&e.setChActive(n,1),t(e,m)[o+v[10]]=l},!1,!1,!1,()=>{t(e,m)[o+v[91]]=l},()=>{l&&e.setChActive(n,1),t(e,m)[o+v[93]]=l},()=>{l&&e.setChActive(n,1),t(e,m)[o+v[94]]=l},()=>{e.setChCc(n,128,l),l!=127&&(e.setChActive(n,1),e.allocateAce(n,128))},()=>{},()=>{l!=64&&e.setChActive(n,1),t(e,m)[o+v[74]]=l},()=>{l!=64&&e.setChActive(n,1),t(e,m)[o+v[71]]=l},!1,()=>{t(e,m)[o+v[65]]=l},()=>{t(e,m)[o+v[5]]=l},()=>{}][c+E]||(()=>{}))()})}).add([127,1,54,16],(a,s,f)=>{e.switchMode("s90es");let i=a[0];a.subarray(1).forEach((n,o)=>{let d=`S90/Motif ES EQ${(o>>2)+1} `;([()=>{let l=n-64},()=>{let l=Qe[n]},()=>{let l=n/10},()=>{let l=n}][i+o&3]||(()=>{}))()})}),t(this,de).add([0,72,18,0,0,0,0],(a,s,f)=>{e.switchMode("sd",!0),e.setPortMode(e.getTrackPort(s),2,$.sd),console.info("MIDI reset: SD")}).add([0,72,18,16,0],(a,s,f)=>{e.dispatchEvent("mupromptex");let i=a[0]>>5,n=a[0]&31;switch(i){case 0:{let o=a[0]>>1,c=a[1];switch(o){case 1:{a.subarray(2).forEach((d,l,E)=>{let C=l+c;switch(C){case 0:{d&&(e.setEffectType(1,60,d-1),e.dispatchEvent("efxchorus",e.getEffectType(1)),console.debug(`SD MFX Cho: ${C} - ${d}`));break}}});break}case 2:{a.subarray(2).forEach((d,l)=>{let E=l+c;switch(E){case 0:{d&&(e.setEffectType(0,55+d,0),e.dispatchEvent("efxreverb",e.getEffectType(0)),console.debug(`SD MFX Rev: ${E} - ${d}`));break}}});break}case 3:case 4:case 5:{let d=o-1;a.subarray(2).forEach((l,E)=>{let C=E+c;switch(console.debug(`SD MFX ${d-2}: ${C} - ${l}`),C){case 0:{e.setEffectTypeRaw(d,62,l),e.dispatchEvent(`efx${d>2?"delay":"insert"+(d-4)}`,e.getEffectType(d));break}}}),console.debug(`SD MFX message:
%o`,a);break}default:console.debug(`Unknown SD-90 global effects message:
%o`,a)}break}case 1:{let o=e.chRedir(n,s,!0),c=a[1],d=_[o];a.subarray(2).forEach((l,E)=>{let C=c+E;C<37?([()=>{},()=>{},0,()=>{},()=>{switch(l){case 104:case 105:case 106:case 107:case 120:{t(e,O)[o]||e.setChType(o,e.CH_DRUMS);break}default:t(e,O)[o]&&e.setChType(o,e.CH_MELODIC)}e.setChCc(o,0,l),e.pushChPrimitives(o),e.dispatchEvent("voice",{part:o})},()=>{t(e,m)[d+v[32]]=l,e.pushChPrimitives(o),e.dispatchEvent("voice",{part:o})},()=>{t(e,L)[o]=l,e.dispatchEvent("voice",{part:o})},()=>{t(e,m)[d+v[7]]=l},()=>{t(e,m)[d+v[10]]=l},()=>{},()=>{},()=>{l<2&&(t(e,ee)[o]=l)},()=>{l<2&&(t(e,m)[d+v[68]]=l?127:0)},()=>{},()=>{l<2&&(t(e,m)[d+v[65]]=l?127:0)},()=>{t(e,m)[d+v[5]]=l&15<<4|t(e,m)[d+v[5]]&15},()=>{t(e,m)[d+v[5]]=l&15|(t(e,m)[d+v[5]]&240)>>4},()=>{t(e,m)[d+v[74]]=l},()=>{t(e,m)[d+v[71]]=l},()=>{t(e,m)[d+v[73]]=l},()=>{t(e,m)[d+v[72]]=l},0,0,0,0,0,0,0,()=>{t(e,m)[d+v[128]]=l,e.allocateAce(128)},()=>{t(e,m)[d+v[93]]=l},()=>{t(e,m)[d+v[91]]=l},0,0,()=>{t(e,m)[d+v[75]]=l},()=>{t(e,m)[d+v[76]]=l},()=>{t(e,m)[d+v[77]]=l},()=>{t(e,m)[d+v[78]]=l}][C]||(()=>{}))():C<63||(C<64?(t(e,O)[o]?(t(e,m)[d+v[0]]=104|l,e.pushChPrimitives(o),e.dispatchEvent("voice",{part:o})):(t(e,m)[d+v[0]]=96|l,e.pushChPrimitives(o),e.dispatchEvent("voice",{part:o})),e.dispatchEvent("voice",{part:o})):console.debug(`Unknown SD-90 global CH${o+1} param setup message:
%o`,a))});break}case 2:{let o=e.chRedir(n,s,!0),c=a[1];console.debug(`Unknown SD-90 global CH${o+1} MIDI setup message:
%o`,a.subarray(2));break}default:console.warn(`Unknown SD-90 global part setup message:
%o`,a)}}),t(e,we).add([0,1,73,78],(a,s,f)=>{e.switchMode("krs"),e.setPortMode(e.getTrackPort(s),1,$.krs),console.debug("Might be KORG KROSS 2 mode reset... Not sure.")}).add([0,1,73,117,2,37],(a,s,f)=>{e.switchMode("krs");let i=e.getTrackPort(s);if(t(e,F)[i]&&t(e,F)[i]!=$.krs)if(t(e,Ce).dumpLimit===e.DUMP_MODE){console.warn(`Dump cancelled. Port ${String.fromCharCode(65+i)} mode "${V[t(e,F)[i]]}" mismatch, should be "krs".`);return}else console.info(`Track ${s} is trying to perform a mismached mode dump on port ${String.fromCharCode(65+i)}.`);e.setPortMode(e.getTrackPort(s),1,$.krs);let n="KROSS 2 BMT1 ",o="";ue(a,(c,d)=>{if(d<24)o+=String.fromCharCode(Math.max(32,c));else if(!(d<1276)){let l=d-1276,E=e.chRedir(Math.floor(l/44),s,!0),C=l%44,M=_[E];C<15?([()=>{c&&e.setChActive(E,1),t(e,L)[E]=c,e.dispatchEvent("voice",{part:E})},()=>{c&&e.setChActive(E,1),c<10?(t(e,m)[M+v[0]]=63,t(e,m)[M+v[32]]=c):c<20?(t(e,m)[M+v[0]]=121,t(e,m)[M+v[32]]=c-10):c<24&&(t(e,m)[M+v[0]]=[120,0,56,62][c-20],t(e,m)[M+v[32]]=0),e.pushChPrimitives(E),e.dispatchEvent("voice",{part:E})},()=>{let R=e.chRedir(c&15,s,!0);t(e,W)[E]=R,console.info(`${n}CH${E+1} receives from CH${R+1}`)},!1,!1,()=>{t(e,m)[M+v[7]]=c},!1,()=>{},()=>{},!1,!1,!1,!1,!1,()=>{t(e,m)[M+v[10]]=c||128}][C]||(()=>{}))():C<36||([()=>{t(e,m)[M+v[74]]=(c+128&255)-64},()=>{t(e,m)[M+v[71]]=(c+128&255)-64},!1,!1,()=>{t(e,m)[M+v[73]]=(c+128&255)-64},()=>{t(e,m)[M+v[75]]=(c+128&255)-64},!1,()=>{t(e,m)[M+v[72]]=(c+128&255)-64}][C]||(()=>{}))()}}),o=o.trimRight(),e.dispatchEvent("metacommit",{type:"EORTitle",data:o})})}chRedir(e,r,h){let u=this;if(t(u,Le)[r])return(t(u,Le)[r]-1)*16+e;if(t(u,B)===$.sc||t(u,B)===$.sd){if(h===1)return e;let b=0,y=!0;for(;y;)t(u,Me)[e+b]===0?(t(u,Me)[e+b]=r,console.debug(`Assign track ${r} to channel ${e+b+1}.`),y=!1):t(this,Me)[e+b]===r?y=!1:(b+=16,b>=128&&(b=0,y=!1));return e+b}else return e}getTrackPort(e){return this.chRedir(0,e,!0)>>4}forceVoiceRefresh(){for(let e=0;e<g.ch;e++)t(this,ie)[e]&&this.dispatchEvent("voice",{part:e})}buildRchTree(){let e=[];t(this,W).forEach((r,h)=>{var u;r<g.ch&&((u=e[r])!=null&&u.constructor||(e[r]=[]),e[r].push(h))}),S(this,ut,e)}buildRccMap(){let e=this;for(let r=0;r<g.ch;r++)t(e,Xe)[r]={};t(e,Ue).forEach((r,h)=>{r&&(t(e,Xe)[Math.floor(h/g.redir)][r]=h%g.redir|128)}),D()&&console.debug(t(e,Xe))}getActive(){return t(this,ie)}getChActive(e){return t(this,ie)[e]}getCc(e){if(typeof e!="number"||e<0||e>=g.ch)throw new RangeError(`Invalid part number: CH${e+1}`);let r=this,h=_[e];return t(r,m).subarray(h,h+g.cc)}getChCc(e,r){let h=this;if(Je.indexOf(r)<0)throw new Error("CC number not accepted");return t(h,m)[_[e]+v[r]]}setChCc(e=0,r,h){let u=this;if(Je.indexOf(r)<0)throw new Error("CC number not accepted");if((h==null?void 0:h.constructor)!=Number)throw new TypeError("Expected numbers for value");let b=h&255,y=_[e]+v[r];t(u,m)[y]=b,t(u,m)[y+g.chcc]=1,u.dispatchEvent("cc",{part:e,cc:r,data:b})}getCcAll(){return t(this,m).slice()}resetCc(e){}resetChCc(e,r,h){let u=this;h!=null&&h.constructor&&u.setChCc(e,r,h),t(u,m)[_[e]+v[r]+g.chcc]=0}resetCcAll(){}isChCcWritten(e,r){if(Je.indexOf(r)<0)throw new Error("CC number not accepted");return t(upThis,m)[_[e]+v[r]+g.chcc]}getChSource(){return t(this,W)}getChType(){return t(this,O)}setChType(e,r,h=0,u=!1){r&=15;let b=this;h=h||b.getChModeId(e),t(b,O)[e]=r,r>0&&!u&&(b.setChCc(e,0,t(b,z)[h][2]),b.pushChPrimitives(e))}setChActive(e,r=0){t(this,ie)[e]!=r&&this.dispatchEvent("channeltoggle",{part:e,active:r}),t(this,ie)[e]=r}getExt(e){let r=g.ext*e,h=t(this,ne).subarray(r,r+g.ext),u=new Uint8Array(h.length);return u.set(h),u[1]=u[1]||t(this,yt),u}getPitch(){return t(this,Te)}getProgram(){return t(this,L)}getTexts(){return t(this,oe).slice()}getVel(e){let r=new Map,h=this;return t(h,K).forEach(function(u,b){let y=u>>7,k=u&127;e===y&&t(h,q)[u]>0&&r.set(k,{v:t(h,q)[u],s:t(h,H)[b]})}),r}getBitmap(){return{bitmap:t(this,he,xe),expire:t(this,be)}}getLetter(){return{text:t(this,Ae),set:t(this,ft),expire:t(this,De)}}getMode(){return V[t(this,B)]}getMaster(){return{volume:t(this,G)}}getRawStrength(){let e=this;return t(this,K).forEach(function(r){let h=r>>7;t(e,q)[r]>t(e,ve)[h]&&(t(e,ve)[h]=t(e,q)[r])}),t(this,ve)}getStrength(){let e=[],r=this;return this.getRawStrength().forEach(function(h,u){e[u]=Math.floor(h*r.getChCc(u,7)*r.getChCc(u,11)*t(r,G)/803288)}),e}getRpn(){return t(this,A)}getNrpn(){return t(this,je)}getSubDb(){return self==null?void 0:self.structuredClone(t(this,z))}getDetect(){return self==null?void 0:self.structuredClone(t(this,N))}getVoice(e,r,h,u="?"){var s;let b=this;(s=$[u])!=null&&s.constructor||(u="?");let y=$[u],k=e||t(b,z)[y][0],w=r,x=h||t(b,z)[y][1];k===lt.bank0&&(k=0),x===lt.bank0&&(x=0),u==="ns5r"&&k>0&&k<56&&(x=3);let a=b.userBank.get(k,w,x,u);if(u==="mt32"&&a.name.indexOf("MT-m:")===0){let f=parseInt(a.name.slice(5)),i=f*g.cmt,n="";t(b,Oe).subarray(i,i+10).forEach(c=>{c>31&&(n+=String.fromCharCode(c))});let o=`MSB	LSB	PRG	NME
49	127	${w}	${n}`;b.userBank.load(o,!0),a.name=n,a.ending=" "}return(a.ending!=" "||!a.name.length)&&(a=b.baseBank.get(k,w,x,u)),a}getChPrimitive(e,r,h){if(r>=g.vxPrim||(r==null?void 0:r.constructor)!=Number)throw new RangeError(`Invalid voice primitive component "${r}"`);if(typeof e!="number"||e<0||e>=g.ch)throw new RangeError(`Invalid part number: CH${e+1}`);let u=this,b=t(u,L)[r<<g.chShift|e];switch(r){case 1:case 2:{h&&(b=b||t(u,z)[u.getChModeId(e)][r-1]),b===lt.bank0&&(b=0);break}}return b}getChPrimitives(e,r){let h=this,u=new Uint8Array(3);return u[1]=t(h,L)[e],u[0]=h.getChPrimitive(e,1,r),u[2]=h.getChPrimitive(e,2,r),u}pushChPrimitives(e){let r=this;t(r,L)[1<<g.chShift|e]=r.getChCc(e,0),t(r,L)[2<<g.chShift|e]=r.getChCc(e,32),r.dispatchEvent("voice",{part:e})}getChVoice(e){let r=this,h=r.getVoice(...r.getChPrimitives(e),r.getChMode(e));if(t(r,ge)[e]){let u="";switch(t(r,B)){case $.mt32:{t(r,ye).subarray(g.cmt*(e-1),g.cmt*(e-1)+10).forEach(b=>{u+=String.fromCharCode(Math.max(b,32))}),u=u.trimRight();break}default:{let b=g.cvn*e;t(r,ht).subarray(b,b+g.cvn).forEach(y=>{u+=String.fromCharCode(Math.max(y,32))}),u=u.trimRight()}}u.length&&(h.ending="~",h.name=u)}return h}getRawPitch(){return t(this,Te)}getPitchShift(e){let r=this,h=e*g.rpn,u=t(r,A)[h];return t(r,U)[e*g.rpnt]||t(r,B)===$.mt32&&(u=12),t(r,Te)[e]/8192*u+(t(r,A)[h+3]-64)+((t(r,A)[h+1]<<7)+t(r,A)[h+2]-8192)/8192}getEffectType(e=0){let r=3*e+1;return t(this,ce).subarray(r,r+2)}getPolyState(e=0){return t(this,H)[e]}setEffectTypeRaw(e=0,r,h){let u=3*e;t(this,ce)[u]=1,t(this,ce)[u+1+ +r]=h}setEffectType(e=0,r,h){this.setEffectTypeRaw(e,!1,r),this.setEffectTypeRaw(e,!0,h)}getEffectSink(){return t(this,Ze)}setLetterDisplay(e,r,h=0,u=3200){let b=this,y;S(b,Ae," ".repeat(h)),e.forEach(k=>{S(b,Ae,t(b,Ae)+String.fromCharCode(k>31?k:32)),k<32&&(y=y||new Set,y.add(k))}),S(b,ft,Date.now()),S(b,De,Date.now()+u),b.dispatchEvent("letter"),y&&(y=Array.from(y),y.forEach((k,w,x)=>{x[w]=k.toString(16).padStart(2,"0")}),console.warn(`${r}${r?" ":""}invalid code point${y.length>1?"s":""}: 0x${y.join(", 0x")}`))}setDetectionTargets(e="?",r=0){let h=this,u=-1;switch(e.replaceAll(", ",",").split(",").forEach(b=>{b=b.toLowerCase();let y=V.indexOf(br[b]||b);D()&&console.debug(`Mapped mode "${b}" to ID "${y}".`),y>-1&&(u=y)}),D()&&console.debug(`Set detection target to ID "${u}".`),u>0&&(t(h,N).x5=82,t(h,N).ds=$.krs),u){case $["05rw"]:{t(h,N).x5=81;break}case $.s90es:t(h,N).ds=$.s90es,t(h,N).smotif=$.s90es;case $.motif:t(h,N).ds=$.motif,t(h,N).smotif=$.motif}}setGsTargets(e=!1,r=4){if(!r)r=e?3:4;else{if(r>4||r<0)throw new Error(`Invalid GS level ${r}`);if(e&&r>>1!=1)throw new Error(`Invalid SC level ${r}`)}let h=this;t(h,N)[e?"sc":"gs"]=r,t(h,z)[$[e?"sc":"gs"]][1]=r,h.forceVoiceRefresh()}getConfigs(){return t(this,dt)}setDumpLimit(e){if(e>2||e<0)throw new RangeError("Invalid dump limit.");t(this,Ce).dumpLimit=e}allocateAce(e=0,r){let h=this;if(!r||r<128&&r>95){console.warn(`cc${r} cannot be allocated as an active custom effect.`);return}let u=!0,b=0,y=g.ace*e;for(;u&&b<g.ace;)t(h,j)[b+y]===r?u=!1:t(h,j)[b+y]||(u=!1,t(h,j)[b+y]=r,console.info(`Allocated cc${r} to ACE slot ${b} in CH${e+1}.`)),b++;b>=g.ace&&console.warn(`ACE slots are full in CH${e+1}.`)}allocateAceAll(e){let r=this;if(!e||e<128&&e>95){console.warn(`cc${e} cannot be allocated as an active custom effect.`);return}for(let h=0;h<g.ch;h++){let u=!0,b=0,y=g.ace*h;for(;u&&b<g.ace;)t(r,j)[b+y]===e?u=!1:t(r,j)[b+y]||(u=!1,t(r,j)[b+y]=e),b++;b>=g.ace&&console.warn(`ACE slots are full in CH${h+1}.`)}}releaseAce(e=0,r){let h=!0,u=g.ace*e,b=u+g.ace;for(;h&&u<b;)t(this,j)[u]===r&&(t(this,j)[u]=0,h=!1),u++;h&&D()&&console.debug(`No ACE slot was allocated to cc${r} in CH${e+1}.`)}resetAce(){t(this,j).fill(0),console.info("All ACE slots have been reset.")}getAce(){return t(this,j)}getChAce(e=0,r=0){if(r<0||r>=g.ace)throw new RangeError("No such ACE slot");let h=t(this,j)[g.ace*e+r];if(h){if(Je.indexOf(h)>=0)return this.getChCc(e,h);throw new Error(`Invalid ACE source in CH${e+1}: ${h}`)}else return 0}initDrums(){let e=this;t(e,te).fill(64);for(let r=0;r<g.drm;r++){let h=r*g.dpn;for(let u in er){let b=er[u],y=(h+pe[u])*g.dnc;t(e,te).subarray(y,y+g.dnc).fill(b)}}}init(e=0){let r=this;S(r,Be,0),t(r,z)[$.xg][1]=0,r.dispatchEvent("banklevel",{mode:"xg",data:0}),t(r,ie).fill(0),t(r,m).fill(0),t(r,j).fill(0),t(r,L).fill(0),t(r,q).fill(0),t(r,K).fill(0),t(r,H).fill(0),t(r,ee).fill(0),t(r,ve).fill(0),t(r,Te).fill(0),t(r,je).fill(0),t(r,U).fill(0),t(r,ne).fill(0),t(r,F).fill(0),t(r,et).fill(0),t(r,_e).fill(0),t(r,Ue).fill(0),S(r,G,100),S(r,oe,[]),S(r,rt,500),S(r,Ie,0),S(r,He,0),S(r,Ge,!1),S(r,be,0),S(r,J,0),t(r,he,xe).fill(0),S(r,I,r.KARAOKE_NONE),S(r,at,0),S(r,$e,!0),r.initDrums(),r.polyIndexLatest=0,r.polyIndexLast=0,t(r,W).forEach(function(h,u,b){b[u]=u}),e===0&&(r.dispatchEvent("mode","?"),S(r,B,0),t(r,Me).fill(0),t(r,Le).fill(0),S(r,De,0),S(r,Ae,"")),gr.forEach(h=>{r.setChCc(h,0,t(r,z)[r.getChModeId(h)][2])}),t(r,O).fill(r.CH_MELODIC),t(r,O)[9]=r.CH_DRUM1,t(r,O)[25]=r.CH_DRUM3,t(r,O)[41]=r.CH_DRUMS,t(r,O)[57]=r.CH_DRUMS,t(r,O)[73]=r.CH_DRUM5,t(r,O)[89]=r.CH_DRUM7,t(r,O)[105]=r.CH_DRUMS,t(r,O)[121]=r.CH_DRUMS;for(let h=0;h<g.drm;h++)t(r,Ee)[h<<1]=0,t(r,Ee)[h<<1|1]=g.invalidCh;t(r,tt).fill(0),t(r,Oe).fill(0),t(r,Pe).fill(0),t(r,ye).fill(0),t(r,ge).fill(0),t(r,ce).fill(0),t(r,Ze).fill(0),r.aiEfxName="",r.userBank.clearRange({msb:0,lsb:127,prg:[0,127]}),r.modelEx.sc.showBar=!0,r.modelEx.sc.invBar=!1,r.modelEx.sc.invDisp=!1,r.modelEx.sc.peakHold=1;for(let h=0;h<g.ch;h++){let u=_[h];t(r,m)[u+v[7]]=100,t(r,m)[u+v[11]]=127,t(r,m)[u+v[2]]=127,t(r,m)[u+v[10]]=64,t(r,m).subarray(u+v[71],u+v[71]+8).fill(64),t(r,m)[u+v[128]]=127,t(r,m).subarray(u+v[130],u+v[157]+1).fill(64),t(r,m)[u+v[91]]=40,t(r,m)[u+v[101]]=127,t(r,m)[u+v[100]]=127,t(r,m)[u+v[99]]=127,t(r,m)[u+v[98]]=127;let b=h*g.rpn;t(r,A)[b]=2,t(r,A)[b+1]=64,t(r,A)[b+2]=0,t(r,A)[b+3]=64,t(r,A)[b+4]=0,t(r,A)[b+5]=0;let y=h*g.ext;t(r,ne)[y+1]=r.VLBC_BRTHEXPR;let k=h*g.redir;t(r,Ue)[k+8]=13}r.buildRchTree(),r.buildRccMap(),r.dispatchEvent("mastervolume",t(r,G)),r.dispatchEvent("efxreverb",r.getEffectType(0)),r.dispatchEvent("efxchorus",r.getEffectType(1)),r.dispatchEvent("efxdelay",r.getEffectType(2)),r.dispatchEvent("efxinsert0",r.getEffectType(3)),r.dispatchEvent("efxinsert1",r.getEffectType(4)),r.dispatchEvent("efxinsert2",r.getEffectType(5)),r.dispatchEvent("efxinsert3",r.getEffectType(6)),r.dispatchEvent("reset"),r.switchMode("?")}setChMode(e,r){let h=this;if(typeof e!="number"||e<0||e>=g.ch)throw new RangeError(`Invalid part number: CH${e+1}`);if(port<0||r>=V.length)throw new RangeError(`Invalid mode ID ${r}`);t(h,_e)[e]=r,h.dispatchEvent("chmode",{part:e,id:r,mode:V[r]}),h.dispatchEvent("voice",{part:e})}getChMode(e,r){return V[this.getChModeId(e,r)]}getChModeId(e,r){return r?t(this,_e)[e]||t(this,F)[e>>4]:t(this,_e)[e]||t(this,F)[e>>4]||t(this,B)}setPortMode(e,r,h){let u=this;if(e<0||e>=g.ch>>4)throw new RangeError(`Invalid port ${e+1}`);if(r<1)throw new RangeError("Range must be a positive integer");if(e+r>=g.ch>>4)throw new RangeError("Range must be in bound");if(e<0||h>=V.length)throw new RangeError(`Invalid mode ID ${h}`);t(u,et)[e]=h;for(let b=e;b<e+r;b++){let y=t(u,et)[b];if(r>1&&y!==0&&y!==h)break;t(u,F)[b]=h;for(let k=b<<4;k<b+1<<4;k++)u.dispatchEvent("chmode",{part:k,id:h,mode:V[h]}),u.dispatchEvent("voice",{part:k})}}copyChSetup(e,r,h){if(e===r){console.warn(`Failed attempt at overwriting CH${e+1} with its own data.`);return}let u=this;if(h&&t(u,ie)[r]){console.warn(`Failed attempt at copying setup data from CH${e+1} to CH${r+1}.`);return}let b=_[e],y=_[r];t(u,L)[r]=t(u,L)[e],t(u,m).set(t(u,m).subarray(b,b+g.cc),y),u.pushChPrimitives(r)}setDrumFirstWrite(e,r){let h=this,u=t(h,O)[e];if(u<2)return;let b=u-2;if(t(h,Ee)[b<<1])if(r)t(h,Ee)[b<<1]=0,D()&&console.debug(`First write part for drum set ${b+1} has been reset.`);else return;else r?console.warn(`First write part for drum set ${b+1} is already blank.`):(t(h,Ee)[b<<1]=1,t(h,Ee)[b<<1|1]=e,console.debug(`First write part for drum set ${b+1} is set to CH${e+1}.`))}getChDrumFirstWrite(e){let r=this,h=t(r,O)[e];if(h<2)return;let u=h-2;return t(r,Ee).subarray(u<<1,u+1<<1)}getDrumFirstWrite(e){if(e>=0&&e<g.drm)return t(this,Ee).subarray(e<<1,e+1<<1)}switchMode(e,r=!1,h=!1){var y;let u=this,b=$[e];if(b>-1){if(t(u,B)===0||r){u.initOnReset&&r&&this.init(1),S(u,B,b),S(u,J,0);for(let w=0;w<g.ch;w++){let x=u.getChModeId(w,!0);t(u,O)[w]>0&&x===$["?"]&&(u.setChCc(w,0,t(u,z)[b][2]),D()&&console.debug(`CH${w+1} (${t(u,O)[w]}) (${u.getChMode(w)}), ${V[x]} (${t(u,z)[x][2]}) -> ${V[b]} (${t(u,z)[b][2]})`),u.pushChPrimitives(w))}switch(b){case $.mt32:{Tt.forEach((w,x)=>{let a=x+1;t(u,ie)[a]||(t(u,L)[a]=w,u.setChCc(a,91,127),u.pushChPrimitives(a))});for(let w=1;w<10;w++)u.dispatchEvent("voice",{part:w});break}}let k;switch(b){case $["?"]:case $.g2:{k=[52,4,52,18,0,0,0,0];break}case $.xg:{k=[1,0,65,0,5,0,0,0];break}case $.gm:case $.gs:case $.sc:{k=[40,4,40,18,40,32,32,0];break}case $.sd:{k=[58,0,60,0,61,0,61,0];break}case $["05rw"]:case $.x5d:case $.ns5r:{k=[44,1,44,19,44,0,44,0];break}case $.k11:case $.sg:{k=[24,0,0,0,0,0,0,0];break}case $.mt32:{k=[40,4,0,0,0,0,0,0];break}case $.doc:{k=[24,16,0,0,0,0,0,0];break}case $.motif:case $.s90es:{k=[129,0,133,0,130,0,0,0];break}default:k=[0,0,0,0,0,0,0,0]}for(let w=0;w<g.efx;w++)!t(u,ce)[3*w]&&((y=k[w<<1])!=null&&y.constructor)&&(t(u,ce)[3*w+1]=k[2*w],t(u,ce)[3*w+2]=k[2*w+1],u.dispatchEvent(`efx${["reverb","chorus","delay","insert0"][w]}`,u.getEffectType(w)));h&&u.setDetectionTargets(e),u.dispatchEvent("mode",e),u.forceVoiceRefresh()}}else throw new Error(`Unknown mode ${e}`)}newStrength(){t(this,ve).fill(0)}runJson(e){var r;if(e.type>14)return e.type===15&&e.data.constructor!=Uint8Array&&(e.data=Uint8Array.from(e.data)),t(this,pt)[e.type].call(this,e);{let h=this.chRedir(e.part,e.track),u=!1;(r=t(this,ut)[h])==null||r.forEach(b=>{e.channel=b,u=!0,t(this,pt)[e.type].call(this,e)}),u||console.warn(`${Qt[e.type]?Qt[e.type]:e.type}${[11,12].includes(e.type)?(e.data[0]!=null?e.data[0]:e.data).toString():""} event sent to CH${h+1} without any recipient.`)}t(this,oe).length>100&&t(this,oe).splice(100,t(this,oe).length-99)}runRaw(e){}async loadBank(e,r){let h=this;switch(e=e.toLowerCase(),e){case"s7e":{h.userBank.clearRange({msb:63,lsb:[21,22]}),h.userBank.clearRange({msb:63,lsb:[24,27]});break}case"pcg":{h.userBank.clearRange({msb:63,lsb:[6,9]}),h.userBank.clearRange({msb:63,lsb:[13,16]});break}default:throw new Error(`Unknown bank format ${e}`)}switch(e){case"s7e":case"pcg":{it.context=this,await h.userBank.load(await it.read(e,r),!1);break}}h.forceVoiceRefresh()}},B=new WeakMap,J=new WeakMap,be=new WeakMap,Se=new WeakMap,he=new WeakSet,xe=function(){return t(this,Se)[t(this,J)]},ir=function(e){t(this,Se)[t(this,J)]=e},ie=new WeakMap,W=new WeakMap,O=new WeakMap,m=new WeakMap,j=new WeakMap,L=new WeakMap,q=new WeakMap,ee=new WeakMap,K=new WeakMap,H=new WeakMap,Te=new WeakMap,ve=new WeakMap,Ne=new WeakMap,ne=new WeakMap,A=new WeakMap,U=new WeakMap,je=new WeakMap,te=new WeakMap,Ee=new WeakMap,ce=new WeakMap,Ze=new WeakMap,Ue=new WeakMap,F=new WeakMap,et=new WeakMap,_e=new WeakMap,ge=new WeakMap,ht=new WeakMap,Pe=new WeakMap,ye=new WeakMap,tt=new WeakMap,Oe=new WeakMap,z=new WeakMap,N=new WeakMap,Ce=new WeakMap,dt=new WeakMap,G=new WeakMap,Be=new WeakMap,rt=new WeakMap,Ie=new WeakMap,He=new WeakMap,gt=new WeakMap,Ge=new WeakMap,Ae=new WeakMap,De=new WeakMap,ft=new WeakMap,at=new WeakMap,$e=new WeakMap,I=new WeakMap,yt=new WeakMap,ut=new WeakMap,Xe=new WeakMap,oe=new WeakMap,Me=new WeakMap,Le=new WeakMap,Z=new WeakMap,Ke=new WeakMap,Y=new WeakMap,pt=new WeakMap,mt=new WeakMap,Ve=new WeakMap,Fe=new WeakMap,le=new WeakMap,de=new WeakMap,we=new WeakMap,ze=new WeakMap,We=new WeakMap,qe=new WeakMap,ar);export{da as OctaviaDevice,g as allocated,v as ccToPos,pe as dnToPos,D as getDebugState,lt as overrides};
